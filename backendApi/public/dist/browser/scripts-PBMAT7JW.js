/**
 * @license
 * Video.js 8.18.1 <http://videojs.com/>
 * Copyright Brightcove, Inc. <https://www.brightcove.com/>
 * Available under Apache License Version 2.0
 * <https://github.com/videojs/video.js/blob/main/LICENSE>
 *
 * Includes vtt.js <https://github.com/mozilla/vtt.js>
 * Available under Apache License Version 2.0
 * <https://github.com/mozilla/vtt.js/blob/main/LICENSE>
 */(function(Un,or){typeof exports=="object"&&typeof module<"u"?module.exports=or():typeof define=="function"&&define.amd?define(or):(Un=typeof globalThis<"u"?globalThis:Un||self,Un.videojs=or())})(this,function(){"use strict";var Un="8.18.1";const or={},Hr=function(i,e){return or[i]=or[i]||[],e&&(or[i]=or[i].concat(e)),or[i]},Ii=function(i,e){Hr(i,e)},Ea=function(i,e){const t=Hr(i).indexOf(e);return t<=-1?!1:(or[i]=or[i].slice(),or[i].splice(t,1),!0)},fs=function(i,e){Hr(i,[].concat(e).map(t=>{const r=(...o)=>(Ea(i,r),t(...o));return r}))},ri={prefixed:!0},ki=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],ai=ki[0];let Di;for(let i=0;i<ki.length;i++)if(ki[i][1]in document){Di=ki[i];break}if(Di){for(let i=0;i<Di.length;i++)ri[ai[i]]=Di[i];ri.prefixed=Di[0]!==ai[0]}let Bt=[];const hn=(i,e,t)=>(r,o,f)=>{const p=e.levels[o],E=new RegExp(`^(${p})$`);let N=i;if(r!=="log"&&f.unshift(r.toUpperCase()+":"),t&&(N=`%c${i}`,f.unshift(t)),f.unshift(N+":"),Bt){Bt.push([].concat(f));const he=Bt.length-1e3;Bt.splice(0,he>0?he:0)}if(!window.console)return;let $=window.console[r];!$&&r==="debug"&&($=window.console.info||window.console.log),!(!$||!p||!E.test(r))&&$[Array.isArray(f)?"apply":"call"](window.console,f)};function Gn(i,e=":",t=""){let r="info",o;function f(...p){o("log",r,p)}return o=hn(i,f,t),f.createLogger=(p,E,N)=>{const $=E!==void 0?E:e,he=N!==void 0?N:t,Te=`${i} ${$} ${p}`;return Gn(Te,$,he)},f.createNewLogger=(p,E,N)=>Gn(p,E,N),f.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:r},f.level=p=>{if(typeof p=="string"){if(!f.levels.hasOwnProperty(p))throw new Error(`"${p}" in not a valid log level`);r=p}return r},f.history=()=>Bt?[].concat(Bt):[],f.history.filter=p=>(Bt||[]).filter(E=>new RegExp(`.*${p}.*`).test(E[0])),f.history.clear=()=>{Bt&&(Bt.length=0)},f.history.disable=()=>{Bt!==null&&(Bt.length=0,Bt=null)},f.history.enable=()=>{Bt===null&&(Bt=[])},f.error=(...p)=>o("error",r,p),f.warn=(...p)=>o("warn",r,p),f.debug=(...p)=>o("debug",r,p),f}const zt=Gn("VIDEOJS"),_a=zt.createLogger,$i=Object.prototype.toString,js=function(i){return pr(i)?Object.keys(i):[]};function fn(i,e){js(i).forEach(t=>e(i[t],t))}function Ja(i,e,t=0){return js(i).reduce((r,o)=>e(r,i[o],o),t)}function pr(i){return!!i&&typeof i=="object"}function es(i){return pr(i)&&$i.call(i)==="[object Object]"&&i.constructor===Object}function oi(...i){const e={};return i.forEach(t=>{t&&fn(t,(r,o)=>{if(!es(r)){e[o]=r;return}es(e[o])||(e[o]={}),e[o]=oi(e[o],r)})}),e}function Za(i={}){const e=[];for(const t in i)if(i.hasOwnProperty(t)){const r=i[t];e.push(r)}return e}function pn(i,e,t,r=!0){const o=p=>Object.defineProperty(i,e,{value:p,enumerable:!0,writable:!0}),f={configurable:!0,enumerable:!0,get(){const p=t();return o(p),p}};return r&&(f.set=o),Object.defineProperty(i,e,f)}var Ct=Object.freeze({__proto__:null,each:fn,reduce:Ja,isObject:pr,isPlain:es,merge:oi,values:Za,defineLazyProperty:pn});let kn=!1,eo=null,_e=!1,Pt,je=!1,en=!1,ts=!1,_t=!1,to=null,Ks=null;const Co=!!(window.cast&&window.cast.framework&&window.cast.framework.CastReceiverContext);let Qe=null,qs=!1,$s=!1,Ti=!1,ba=!1,Vn=!1,Hn=!1,ps=!1;const ti=!!(gn()&&("ontouchstart"in window||window.navigator.maxTouchPoints||window.DocumentTouch&&window.document instanceof window.DocumentTouch)),Dn=window.navigator&&window.navigator.userAgentData;if(Dn&&Dn.platform&&Dn.brands&&(_e=Dn.platform==="Android",en=!!Dn.brands.find(i=>i.brand==="Microsoft Edge"),ts=!!Dn.brands.find(i=>i.brand==="Chromium"),_t=!en&&ts,to=Ks=(Dn.brands.find(i=>i.brand==="Chromium")||{}).version||null,$s=Dn.platform==="Windows"),!ts){const i=window.navigator&&window.navigator.userAgent||"";kn=/iPod/i.test(i),eo=function(){const e=i.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),_e=/Android/i.test(i),Pt=function(){const e=i.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),r=e[2]&&parseFloat(e[2]);return t&&r?parseFloat(e[1]+"."+e[2]):t||null}(),je=/Firefox/i.test(i),en=/Edg/i.test(i),ts=/Chrome/i.test(i)||/CriOS/i.test(i),_t=!en&&ts,to=Ks=function(){const e=i.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),Qe=function(){const e=/MSIE\s(\d+)\.\d/.exec(i);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(i)&&/rv:11.0/.test(i)&&(t=11),t}(),Vn=/Tizen/i.test(i),Hn=/Web0S/i.test(i),ps=Vn||Hn,qs=/Safari/i.test(i)&&!_t&&!_e&&!en&&!ps,$s=/Windows/i.test(i),Ti=/iPad/i.test(i)||qs&&ti&&!/iPhone/i.test(i),ba=/iPhone/i.test(i)&&!Ti}const Gi=ba||Ti||kn,gs=(qs||Gi)&&!_t;var ko=Object.freeze({__proto__:null,get IS_IPOD(){return kn},get IOS_VERSION(){return eo},get IS_ANDROID(){return _e},get ANDROID_VERSION(){return Pt},get IS_FIREFOX(){return je},get IS_EDGE(){return en},get IS_CHROMIUM(){return ts},get IS_CHROME(){return _t},get CHROMIUM_VERSION(){return to},get CHROME_VERSION(){return Ks},IS_CHROMECAST_RECEIVER:Co,get IE_VERSION(){return Qe},get IS_SAFARI(){return qs},get IS_WINDOWS(){return $s},get IS_IPAD(){return Ti},get IS_IPHONE(){return ba},get IS_TIZEN(){return Vn},get IS_WEBOS(){return Hn},get IS_SMART_TV(){return ps},TOUCH_ENABLED:ti,IS_IOS:Gi,IS_ANY_SAFARI:gs});function Do(i){return typeof i=="string"&&!!i.trim()}function io(i){if(i.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function gn(){return document===window.document}function ms(i){return pr(i)&&i.nodeType===1}function mn(){try{return window.parent!==window.self}catch{return!0}}function vs(i){return function(e,t){if(!Do(e))return document[i](null);Do(t)&&(t=document.querySelector(t));const r=ms(t)?t:document;return r[i]&&r[i](e)}}function Rt(i="div",e={},t={},r){const o=document.createElement(i);return Object.getOwnPropertyNames(e).forEach(function(f){const p=e[f];f==="textContent"?ii(o,p):(o[f]!==p||f==="tabIndex")&&(o[f]=p)}),Object.getOwnPropertyNames(t).forEach(function(f){o.setAttribute(f,t[f])}),r&&mr(o,r),o}function ii(i,e){return typeof i.textContent>"u"?i.innerText=e:i.textContent=e,i}function gr(i,e){e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)}function ys(i,e){return io(e),i.classList.contains(e)}function Gt(i,...e){return i.classList.add(...e.reduce((t,r)=>t.concat(r.split(/\s+/)),[])),i}function Aa(i,...e){return i?(i.classList.remove(...e.reduce((t,r)=>t.concat(r.split(/\s+/)),[])),i):(zt.warn("removeClass was called with an element that doesn't exist"),null)}function ro(i,e,t){return typeof t=="function"&&(t=t(i,e)),typeof t!="boolean"&&(t=void 0),e.split(/\s+/).forEach(r=>i.classList.toggle(r,t)),i}function Ts(i,e){Object.getOwnPropertyNames(e).forEach(function(t){const r=e[t];r===null||typeof r>"u"||r===!1?i.removeAttribute(t):i.setAttribute(t,r===!0?"":r)})}function wn(i){const e={},t=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(i&&i.attributes&&i.attributes.length>0){const r=i.attributes;for(let o=r.length-1;o>=0;o--){const f=r[o].name;let p=r[o].value;t.includes(f)&&(p=p!==null),e[f]=p}}return e}function Ae(i,e){return i.getAttribute(e)}function Es(i,e,t){i.setAttribute(e,t)}function lr(i,e){i.removeAttribute(e)}function Ln(){document.body.focus(),document.onselectstart=function(){return!1}}function Sa(){document.onselectstart=function(){return!0}}function In(i){if(i&&i.getBoundingClientRect&&i.parentNode){const e=i.getBoundingClientRect(),t={};return["bottom","height","left","right","top","width"].forEach(r=>{e[r]!==void 0&&(t[r]=e[r])}),t.height||(t.height=parseFloat(qr(i,"height"))),t.width||(t.width=parseFloat(qr(i,"width"))),t}}function is(i){if(!i||i&&!i.offsetParent)return{left:0,top:0,width:0,height:0};const e=i.offsetWidth,t=i.offsetHeight;let r=0,o=0;for(;i.offsetParent&&i!==document[ri.fullscreenElement];)r+=i.offsetLeft,o+=i.offsetTop,i=i.offsetParent;return{left:r,top:o,width:e,height:t}}function no(i,e){const t={x:0,y:0};if(Gi){let he=i;for(;he&&he.nodeName.toLowerCase()!=="html";){const Te=qr(he,"transform");if(/^matrix/.test(Te)){const we=Te.slice(7,-1).split(/,\s/).map(Number);t.x+=we[4],t.y+=we[5]}else if(/^matrix3d/.test(Te)){const we=Te.slice(9,-1).split(/,\s/).map(Number);t.x+=we[12],t.y+=we[13]}if(he.assignedSlot&&he.assignedSlot.parentElement&&window.WebKitCSSMatrix){const we=window.getComputedStyle(he.assignedSlot.parentElement).transform,Me=new window.WebKitCSSMatrix(we);t.x+=Me.m41,t.y+=Me.m42}he=he.parentNode||he.host}}const r={},o=is(e.target),f=is(i),p=f.width,E=f.height;let N=e.offsetY-(f.top-o.top),$=e.offsetX-(f.left-o.left);return e.changedTouches&&($=e.changedTouches[0].pageX-f.left,N=e.changedTouches[0].pageY+f.top,Gi&&($-=t.x,N-=t.y)),r.y=1-Math.max(0,Math.min(1,N/E)),r.x=Math.max(0,Math.min(1,$/p)),r}function so(i){return pr(i)&&i.nodeType===3}function Ws(i){for(;i.firstChild;)i.removeChild(i.firstChild);return i}function yl(i){return typeof i=="function"&&(i=i()),(Array.isArray(i)?i:[i]).map(e=>{if(typeof e=="function"&&(e=e()),ms(e)||so(e))return e;if(typeof e=="string"&&/\S/.test(e))return document.createTextNode(e)}).filter(e=>e)}function mr(i,e){return yl(e).forEach(t=>i.appendChild(t)),i}function vr(i,e){return mr(Ws(i),e)}function xa(i){return i.button===void 0&&i.buttons===void 0||i.button===0&&i.buttons===void 0||i.type==="mouseup"&&i.button===0&&i.buttons===0||i.type==="mousedown"&&i.button===0&&i.buttons===0?!0:!(i.button!==0||i.buttons!==1)}const jr=vs("querySelector"),Kr=vs("querySelectorAll");function qr(i,e){if(!i||!e)return"";if(typeof window.getComputedStyle=="function"){let t;try{t=window.getComputedStyle(i)}catch{return""}return t?t.getPropertyValue(e)||t[e]:""}return""}function Vi(i){[...document.styleSheets].forEach(e=>{try{const t=[...e.cssRules].map(o=>o.cssText).join(""),r=document.createElement("style");r.textContent=t,i.document.head.appendChild(r)}catch{const r=document.createElement("link");r.rel="stylesheet",r.type=e.type,r.media=e.media.mediaText,r.href=e.href,i.document.head.appendChild(r)}})}var zs=Object.freeze({__proto__:null,isReal:gn,isEl:ms,isInFrame:mn,createEl:Rt,textContent:ii,prependTo:gr,hasClass:ys,addClass:Gt,removeClass:Aa,toggleClass:ro,setAttributes:Ts,getAttributes:wn,getAttribute:Ae,setAttribute:Es,removeAttribute:lr,blockTextSelection:Ln,unblockTextSelection:Sa,getBoundingClientRect:In,findPosition:is,getPointerPosition:no,isTextNode:so,emptyEl:Ws,normalizeContent:yl,appendContent:mr,insertContent:vr,isSingleLeftClick:xa,$:jr,$$:Kr,computedStyle:qr,copyStyleSheetsToWindow:Vi});let qt=!1,tn;const Ys=function(){if(tn.options.autoSetup===!1)return;const i=Array.prototype.slice.call(document.getElementsByTagName("video")),e=Array.prototype.slice.call(document.getElementsByTagName("audio")),t=Array.prototype.slice.call(document.getElementsByTagName("video-js")),r=i.concat(e,t);if(r&&r.length>0)for(let o=0,f=r.length;o<f;o++){const p=r[o];if(p&&p.getAttribute)p.player===void 0&&p.getAttribute("data-setup")!==null&&tn(p);else{Rr(1);break}}else qt||Rr(1)};function Rr(i,e){gn()&&(e&&(tn=e),window.setTimeout(Ys,i))}function Xs(){qt=!0,window.removeEventListener("load",Xs)}gn()&&(document.readyState==="complete"?Xs():window.addEventListener("load",Xs));const Wi=function(i){const e=document.createElement("style");return e.className=i,e},wo=function(i,e){i.styleSheet?i.styleSheet.cssText=e:i.textContent=e};var At=new WeakMap;let Rn=3;function Pr(){return Rn++}function Lo(i,e){if(!At.has(i))return;const t=At.get(i);t.handlers[e].length===0&&(delete t.handlers[e],i.removeEventListener?i.removeEventListener(e,t.dispatcher,!1):i.detachEvent&&i.detachEvent("on"+e,t.dispatcher)),Object.getOwnPropertyNames(t.handlers).length<=0&&(delete t.handlers,delete t.dispatcher,delete t.disabled),Object.getOwnPropertyNames(t).length===0&&At.delete(i)}function Mt(i,e,t,r){t.forEach(function(o){i(e,o,r)})}function rn(i){if(i.fixed_)return i;function e(){return!0}function t(){return!1}if(!i||!i.isPropagationStopped||!i.isImmediatePropagationStopped){const r=i||window.event;i={};const o=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const f in r)o.includes(f)||f==="returnValue"&&r.preventDefault||(i[f]=r[f]);if(i.target||(i.target=i.srcElement||document),i.relatedTarget||(i.relatedTarget=i.fromElement===i.target?i.toElement:i.fromElement),i.preventDefault=function(){r.preventDefault&&r.preventDefault(),i.returnValue=!1,r.returnValue=!1,i.defaultPrevented=!0},i.defaultPrevented=!1,i.stopPropagation=function(){r.stopPropagation&&r.stopPropagation(),i.cancelBubble=!0,r.cancelBubble=!0,i.isPropagationStopped=e},i.isPropagationStopped=t,i.stopImmediatePropagation=function(){r.stopImmediatePropagation&&r.stopImmediatePropagation(),i.isImmediatePropagationStopped=e,i.stopPropagation()},i.isImmediatePropagationStopped=t,i.clientX!==null&&i.clientX!==void 0){const f=document.documentElement,p=document.body;i.pageX=i.clientX+(f&&f.scrollLeft||p&&p.scrollLeft||0)-(f&&f.clientLeft||p&&p.clientLeft||0),i.pageY=i.clientY+(f&&f.scrollTop||p&&p.scrollTop||0)-(f&&f.clientTop||p&&p.clientTop||0)}i.which=i.charCode||i.keyCode,i.button!==null&&i.button!==void 0&&(i.button=i.button&1?0:i.button&4?1:i.button&2?2:0)}return i.fixed_=!0,i}let nn;const Qs=function(){if(typeof nn!="boolean"){nn=!1;try{const i=Object.defineProperty({},"passive",{get(){nn=!0}});window.addEventListener("test",null,i),window.removeEventListener("test",null,i)}catch{}}return nn},_s=["touchstart","touchmove"];function yr(i,e,t){if(Array.isArray(e))return Mt(yr,i,e,t);At.has(i)||At.set(i,{});const r=At.get(i);if(r.handlers||(r.handlers={}),r.handlers[e]||(r.handlers[e]=[]),t.guid||(t.guid=Pr()),r.handlers[e].push(t),r.dispatcher||(r.disabled=!1,r.dispatcher=function(o,f){if(r.disabled)return;o=rn(o);const p=r.handlers[o.type];if(p){const E=p.slice(0);for(let N=0,$=E.length;N<$&&!o.isImmediatePropagationStopped();N++)try{E[N].call(i,o,f)}catch(he){zt.error(he)}}}),r.handlers[e].length===1)if(i.addEventListener){let o=!1;Qs()&&_s.indexOf(e)>-1&&(o={passive:!0}),i.addEventListener(e,r.dispatcher,o)}else i.attachEvent&&i.attachEvent("on"+e,r.dispatcher)}function fi(i,e,t){if(!At.has(i))return;const r=At.get(i);if(!r.handlers)return;if(Array.isArray(e))return Mt(fi,i,e,t);const o=function(p,E){r.handlers[E]=[],Lo(p,E)};if(e===void 0){for(const p in r.handlers)Object.prototype.hasOwnProperty.call(r.handlers||{},p)&&o(i,p);return}const f=r.handlers[e];if(f){if(!t){o(i,e);return}if(t.guid)for(let p=0;p<f.length;p++)f[p].guid===t.guid&&f.splice(p--,1);Lo(i,e)}}function Tr(i,e,t){const r=At.has(i)?At.get(i):{},o=i.parentNode||i.ownerDocument;if(typeof e=="string"?e={type:e,target:i}:e.target||(e.target=i),e=rn(e),r.dispatcher&&r.dispatcher.call(i,e,t),o&&!e.isPropagationStopped()&&e.bubbles===!0)Tr.call(null,o,e,t);else if(!o&&!e.defaultPrevented&&e.target&&e.target[e.type]){At.has(e.target)||At.set(e.target,{});const f=At.get(e.target);e.target[e.type]&&(f.disabled=!0,typeof e.target[e.type]=="function"&&e.target[e.type](),f.disabled=!1)}return!e.defaultPrevented}function bs(i,e,t){if(Array.isArray(e))return Mt(bs,i,e,t);const r=function(){fi(i,e,r),t.apply(this,arguments)};r.guid=t.guid=t.guid||Pr(),yr(i,e,r)}function Ca(i,e,t){const r=function(){fi(i,e,r),t.apply(this,arguments)};r.guid=t.guid=t.guid||Pr(),yr(i,e,r)}var El=Object.freeze({__proto__:null,fixEvent:rn,on:yr,off:fi,trigger:Tr,one:bs,any:Ca});const sn=30,pi=function(i,e,t){e.guid||(e.guid=Pr());const r=e.bind(i);return r.guid=t?t+"_"+e.guid:e.guid,r},Pn=function(i,e){let t=window.performance.now();return function(...o){const f=window.performance.now();f-t>=e&&(i(...o),t=f)}},Ei=function(i,e,t,r=window){let o;const f=()=>{r.clearTimeout(o),o=null},p=function(){const E=this,N=arguments;let $=function(){o=null,$=null,t||i.apply(E,N)};!o&&t&&i.apply(E,N),r.clearTimeout(o),o=r.setTimeout($,e)};return p.cancel=f,p};var Io=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:sn,bind_:pi,throttle:Pn,debounce:Ei});let ur;class _i{on(e,t){const r=this.addEventListener;this.addEventListener=()=>{},yr(this,e,t),this.addEventListener=r}off(e,t){fi(this,e,t)}one(e,t){const r=this.addEventListener;this.addEventListener=()=>{},bs(this,e,t),this.addEventListener=r}any(e,t){const r=this.addEventListener;this.addEventListener=()=>{},Ca(this,e,t),this.addEventListener=r}trigger(e){const t=e.type||e;typeof e=="string"&&(e={type:t}),e=rn(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),Tr(this,e)}queueTrigger(e){ur||(ur=new Map);const t=e.type||e;let r=ur.get(this);r||(r=new Map,ur.set(this,r));const o=r.get(t);r.delete(t),window.clearTimeout(o);const f=window.setTimeout(()=>{r.delete(t),r.size===0&&(r=null,ur.delete(this)),this.trigger(e)},0);r.set(t,f)}}_i.prototype.allowedEvents_={},_i.prototype.addEventListener=_i.prototype.on,_i.prototype.removeEventListener=_i.prototype.off,_i.prototype.dispatchEvent=_i.prototype.trigger;const an=i=>typeof i.name=="function"?i.name():typeof i.name=="string"?i.name:i.name_?i.name_:i.constructor&&i.constructor.name?i.constructor.name:typeof i,on=i=>i instanceof _i||!!i.eventBusEl_&&["on","one","off","trigger"].every(e=>typeof i[e]=="function"),_l=(i,e)=>{on(i)?e():(i.eventedCallbacks||(i.eventedCallbacks=[]),i.eventedCallbacks.push(e))},Sr=i=>typeof i=="string"&&/\S/.test(i)||Array.isArray(i)&&!!i.length,ao=(i,e,t)=>{if(!i||!i.nodeName&&!on(i))throw new Error(`Invalid target for ${an(e)}#${t}; must be a DOM node or evented object.`)},Js=(i,e,t)=>{if(!Sr(i))throw new Error(`Invalid event type for ${an(e)}#${t}; must be a non-empty string or array.`)},bl=(i,e,t)=>{if(typeof i!="function")throw new Error(`Invalid listener for ${an(e)}#${t}; must be a function.`)},Zs=(i,e,t)=>{const r=e.length<3||e[0]===i||e[0]===i.eventBusEl_;let o,f,p;return r?(o=i.eventBusEl_,e.length>=3&&e.shift(),[f,p]=e):(o=e[0],f=e[1],p=e[2]),ao(o,i,t),Js(f,i,t),bl(p,i,t),p=pi(i,p),{isTargetingSelf:r,target:o,type:f,listener:p}},jn=(i,e,t,r)=>{ao(i,i,e),i.nodeName?El[e](i,t,r):i[e](t,r)},Su={on(...i){const{isTargetingSelf:e,target:t,type:r,listener:o}=Zs(this,i,"on");if(jn(t,"on",r,o),!e){const f=()=>this.off(t,r,o);f.guid=o.guid;const p=()=>this.off("dispose",f);p.guid=o.guid,jn(this,"on","dispose",f),jn(t,"on","dispose",p)}},one(...i){const{isTargetingSelf:e,target:t,type:r,listener:o}=Zs(this,i,"one");if(e)jn(t,"one",r,o);else{const f=(...p)=>{this.off(t,r,f),o.apply(null,p)};f.guid=o.guid,jn(t,"one",r,f)}},any(...i){const{isTargetingSelf:e,target:t,type:r,listener:o}=Zs(this,i,"any");if(e)jn(t,"any",r,o);else{const f=(...p)=>{this.off(t,r,f),o.apply(null,p)};f.guid=o.guid,jn(t,"any",r,f)}},off(i,e,t){if(!i||Sr(i))fi(this.eventBusEl_,i,e);else{const r=i,o=e;ao(r,this,"off"),Js(o,this,"off"),bl(t,this,"off"),t=pi(this,t),this.off("dispose",t),r.nodeName?(fi(r,o,t),fi(r,"dispose",t)):on(r)&&(r.off(o,t),r.off("dispose",t))}},trigger(i,e){ao(this.eventBusEl_,this,"trigger");const t=i&&typeof i!="string"?i.type:i;if(!Sr(t))throw new Error(`Invalid event type for ${an(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return Tr(this.eventBusEl_,i,e)}};function oo(i,e={}){const{eventBusKey:t}=e;if(t){if(!i[t].nodeName)throw new Error(`The eventBusKey "${t}" does not refer to an element.`);i.eventBusEl_=i[t]}else i.eventBusEl_=Rt("span",{className:"vjs-event-bus"});return Object.assign(i,Su),i.eventedCallbacks&&i.eventedCallbacks.forEach(r=>{r()}),i.on("dispose",()=>{i.off(),[i,i.el_,i.eventBusEl_].forEach(function(r){r&&At.has(r)&&At.delete(r)}),window.setTimeout(()=>{i.eventBusEl_=null},0)}),i}const rs={state:{},setState(i){typeof i=="function"&&(i=i());let e;return fn(i,(t,r)=>{this.state[r]!==t&&(e=e||{},e[r]={from:this.state[r],to:t}),this.state[r]=t}),e&&on(this)&&this.trigger({changes:e,type:"statechanged"}),e}};function cr(i,e){return Object.assign(i,rs),i.state=Object.assign({},i.state,e),typeof i.handleStateChanged=="function"&&on(i)&&i.on("statechanged",i.handleStateChanged),i}const As=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toLowerCase())},Ri=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},Al=function(i,e){return Ri(i)===Ri(e)};var Tt=Object.freeze({__proto__:null,toLowerCase:As,toTitleCase:Ri,titleCaseEquals:Al});class lt{constructor(e,t,r){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=oi({},this.options_),t=this.options_=oi(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const o=e&&e.id&&e.id()||"no_player";this.id_=`${o}_component_${Pr()}`}this.name_=t.name||null,t.el?this.el_=t.el:t.createEl!==!1&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(o=>this.addClass(o)),["on","off","one","any","trigger"].forEach(o=>{this[o]=void 0}),t.evented!==!1&&(oo(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),cr(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,t.initChildren!==!1&&this.initChildren(),this.ready(r),t.reportTouchActivity!==!1&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let t=this.children_.length-1;t>=0;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return!!this.isDisposed_}player(){return this.player_}options(e){return e?(this.options_=oi(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,r){return Rt(e,t,r)}localize(e,t,r=e){const o=this.player_.language&&this.player_.language(),f=this.player_.languages&&this.player_.languages(),p=f&&f[o],E=o&&o.split("-")[0],N=f&&f[E];let $=r;return p&&p[e]?$=p[e]:N&&N[e]&&($=N[e]),t&&($=$.replace(/\{(\d+)\}/g,function(he,Te){const we=t[Te-1];let Me=we;return typeof we>"u"&&(Me=he),Me})),$}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((r,o)=>r.concat(o),[]);let t=this;for(let r=0;r<e.length;r++)if(t=t.getChild(e[r]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const r="http://www.w3.org/2000/svg",o=Rt("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),f=document.createElementNS(r,"svg");f.setAttributeNS(null,"viewBox","0 0 512 512");const p=document.createElementNS(r,"use");return f.appendChild(p),p.setAttributeNS(null,"href",`#vjs-icon-${e}`),o.appendChild(f),this.iconIsSet_?t.replaceChild(o,t.querySelector(".vjs-icon-placeholder")):t.appendChild(o),this.iconIsSet_=!0,o}addChild(e,t={},r=this.children_.length){let o,f;if(typeof e=="string"){f=Ri(e);const p=t.componentClass||f;t.name=f;const E=lt.getComponent(p);if(!E)throw new Error(`Component ${p} does not exist`);if(typeof E!="function")return null;o=new E(this.player_||this,t)}else o=e;if(o.parentComponent_&&o.parentComponent_.removeChild(o),this.children_.splice(r,0,o),o.parentComponent_=this,typeof o.id=="function"&&(this.childIndex_[o.id()]=o),f=f||o.name&&Ri(o.name()),f&&(this.childNameIndex_[f]=o,this.childNameIndex_[As(f)]=o),typeof o.el=="function"&&o.el()){let p=null;this.children_[r+1]&&(this.children_[r+1].el_?p=this.children_[r+1].el_:ms(this.children_[r+1])&&(p=this.children_[r+1])),this.contentEl().insertBefore(o.el(),p)}return o}removeChild(e){if(typeof e=="string"&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let o=this.children_.length-1;o>=0;o--)if(this.children_[o]===e){t=!0,this.children_.splice(o,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[Ri(e.name())]=null,this.childNameIndex_[As(e.name())]=null;const r=e.el();r&&r.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,r=p=>{const E=p.name;let N=p.opts;if(t[E]!==void 0&&(N=t[E]),N===!1)return;N===!0&&(N={}),N.playerOptions=this.options_.playerOptions;const $=this.addChild(E,N);$&&(this[E]=$)};let o;const f=lt.getComponent("Tech");Array.isArray(e)?o=e:o=Object.keys(e),o.concat(Object.keys(this.options_).filter(function(p){return!o.some(function(E){return typeof E=="string"?p===E:p===E.name})})).map(p=>{let E,N;return typeof p=="string"?(E=p,N=e[E]||this.options_[E]||{}):(E=p.name,N=p),{name:E,opts:N}}).filter(p=>{const E=lt.getComponent(p.opts.componentClass||Ri(p.name));return E&&!f.isTech(E)}).forEach(r)}}buildCSSClass(){return""}ready(e,t=!1){if(e){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(e);return}t?e.call(this):this.setTimeout(e,1)}}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(t){t.call(this)},this),this.trigger("ready")},1)}$(e,t){return jr(e,t||this.contentEl())}$$(e,t){return Kr(e,t||this.contentEl())}hasClass(e){return ys(this.el_,e)}addClass(...e){Gt(this.el_,...e)}removeClass(...e){Aa(this.el_,...e)}toggleClass(e,t){ro(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return Ae(this.el_,e)}setAttribute(e,t){Es(this.el_,e,t)}removeAttribute(e){lr(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,r){if(t!==void 0){(t===null||t!==t)&&(t=0),(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?this.el_.style[e]=t:t==="auto"?this.el_.style[e]="":this.el_.style[e]=t+"px",r||this.trigger("componentresize");return}if(!this.el_)return 0;const o=this.el_.style[e],f=o.indexOf("px");return parseInt(f!==-1?o.slice(0,f):this.el_["offset"+Ri(e)],10)}currentDimension(e){let t=0;if(e!=="width"&&e!=="height")throw new Error("currentDimension only accepts width or height value");if(t=qr(this.el_,e),t=parseFloat(t),t===0||isNaN(t)){const r=`offset${Ri(e)}`;t=this.el_[r]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect(),t={x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},r={x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2};return{boundingClientRect:t,center:r}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(e.key!=="Tab"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)&&e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;const r=10,o=200;let f;this.on("touchstart",function(E){E.touches.length===1&&(t={pageX:E.touches[0].pageX,pageY:E.touches[0].pageY},e=window.performance.now(),f=!0)}),this.on("touchmove",function(E){if(E.touches.length>1)f=!1;else if(t){const N=E.touches[0].pageX-t.pageX,$=E.touches[0].pageY-t.pageY;Math.sqrt(N*N+$*$)>r&&(f=!1)}});const p=function(){f=!1};this.on("touchleave",p),this.on("touchcancel",p),this.on("touchend",function(E){t=null,f===!0&&window.performance.now()-e<o&&(E.preventDefault(),this.trigger("tap"))})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=pi(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const r=function(o){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",r),this.on("touchcancel",r)}setTimeout(e,t){var r;return e=pi(this,e),this.clearTimersOnDispose_(),r=window.setTimeout(()=>{this.setTimeoutIds_.has(r)&&this.setTimeoutIds_.delete(r),e()},t),this.setTimeoutIds_.add(r),r}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),window.clearTimeout(e)),e}setInterval(e,t){e=pi(this,e),this.clearTimersOnDispose_();const r=window.setInterval(e,t);return this.setIntervalIds_.add(r),r}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),window.clearInterval(e)),e}requestAnimationFrame(e){this.clearTimersOnDispose_();var t;return e=pi(this,e),t=window.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=pi(this,t);const r=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,r),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),window.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((r,o)=>this[t](o))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return!!this.el_.disabled}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(f){const p=window.getComputedStyle(f,null),E=p.getPropertyValue("visibility");return p.getPropertyValue("display")!=="none"&&!["hidden","collapse"].includes(E)}function r(f){return!(!t(f.parentElement)||!t(f)||f.style.opacity==="0"||window.getComputedStyle(f).height==="0px"||window.getComputedStyle(f).width==="0px")}function o(f){if(f.offsetWidth+f.offsetHeight+f.getBoundingClientRect().height+f.getBoundingClientRect().width===0)return!1;const p={x:f.getBoundingClientRect().left+f.offsetWidth/2,y:f.getBoundingClientRect().top+f.offsetHeight/2};if(p.x<0||p.x>(document.documentElement.clientWidth||window.innerWidth)||p.y<0||p.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let E=document.elementFromPoint(p.x,p.y);for(;E;){if(E===f)return!0;if(E.parentNode)E=E.parentNode;else return!1}}return e||(e=this.el()),!!(o(e)&&r(e)&&(!e.parentElement||e.tabIndex>=0))}static registerComponent(e,t){if(typeof e!="string"||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const r=lt.getComponent("Tech"),o=r&&r.isTech(t),f=lt===t||lt.prototype.isPrototypeOf(t.prototype);if(o||!f){let E;throw o?E="techs must be registered using Tech.registerTech()":E="must be a Component subclass",new Error(`Illegal component, "${e}"; ${E}.`)}e=Ri(e),lt.components_||(lt.components_={});const p=lt.getComponent("Player");if(e==="Player"&&p&&p.players){const E=p.players,N=Object.keys(E);if(E&&N.length>0&&N.map($=>E[$]).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return lt.components_[e]=t,lt.components_[As(e)]=t,t}static getComponent(e){if(!(!e||!lt.components_))return lt.components_[e]}}lt.registerComponent("Component",lt);function ka(i,e,t){if(typeof e!="number"||e<0||e>t)throw new Error(`Failed to execute '${i}' on 'TimeRanges': The index provided (${e}) is non-numeric or out of bounds (0-${t}).`)}function Ro(i,e,t,r){return ka(i,r,t.length-1),t[r][e]}function ea(i){let e;return i===void 0||i.length===0?e={length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:e={length:i.length,start:Ro.bind(null,"start",0,i),end:Ro.bind(null,"end",1,i)},window.Symbol&&window.Symbol.iterator&&(e[window.Symbol.iterator]=()=>(i||[]).values()),e}function $r(i,e){return Array.isArray(i)?ea(i):i===void 0||e===void 0?ea():ea([[i,e]])}const Ss=function(i,e){i=i<0?0:i;let t=Math.floor(i%60),r=Math.floor(i/60%60),o=Math.floor(i/3600);const f=Math.floor(e/60%60),p=Math.floor(e/3600);return(isNaN(i)||i===1/0)&&(o=r=t="-"),o=o>0||p>0?o+":":"",r=((o||f>=10)&&r<10?"0"+r:r)+":",t=t<10?"0"+t:t,o+r+t};let Da=Ss;function wa(i){Da=i}function ta(){Da=Ss}function Kn(i,e=i){return Da(i,e)}var xu=Object.freeze({__proto__:null,createTimeRanges:$r,createTimeRange:$r,setFormatTime:wa,resetFormatTime:ta,formatTime:Kn});function ia(i,e){let t=0,r,o;if(!e)return 0;(!i||!i.length)&&(i=$r(0,0));for(let f=0;f<i.length;f++)r=i.start(f),o=i.end(f),o>e&&(o=e),t+=o-r;return t/e}function wi(i){if(i instanceof wi)return i;typeof i=="number"?this.code=i:typeof i=="string"?this.message=i:pr(i)&&(typeof i.code=="number"&&(this.code=i.code),Object.assign(this,i)),this.message||(this.message=wi.defaultMessages[this.code]||"")}wi.prototype.code=0,wi.prototype.message="",wi.prototype.status=null,wi.prototype.metadata=null,wi.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],wi.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."},wi.MEDIA_ERR_CUSTOM=0,wi.prototype.MEDIA_ERR_CUSTOM=0,wi.MEDIA_ERR_ABORTED=1,wi.prototype.MEDIA_ERR_ABORTED=1,wi.MEDIA_ERR_NETWORK=2,wi.prototype.MEDIA_ERR_NETWORK=2,wi.MEDIA_ERR_DECODE=3,wi.prototype.MEDIA_ERR_DECODE=3,wi.MEDIA_ERR_SRC_NOT_SUPPORTED=4,wi.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4,wi.MEDIA_ERR_ENCRYPTED=5,wi.prototype.MEDIA_ERR_ENCRYPTED=5;function Ji(i){return i!=null&&typeof i.then=="function"}function Wr(i){Ji(i)&&i.then(null,e=>{})}const La=function(i){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,r,o)=>(i[r]&&(t[r]=i[r]),t),{cues:i.cues&&Array.prototype.map.call(i.cues,function(t){return{startTime:t.startTime,endTime:t.endTime,text:t.text,id:t.id}})})};var Sl={textTracksToJson:function(i){const e=i.$$("track"),t=Array.prototype.map.call(e,o=>o.track);return Array.prototype.map.call(e,function(o){const f=La(o.track);return o.src&&(f.src=o.src),f}).concat(Array.prototype.filter.call(i.textTracks(),function(o){return t.indexOf(o)===-1}).map(La))},jsonToTextTracks:function(i,e){return i.forEach(function(t){const r=e.addRemoteTextTrack(t).track;!t.src&&t.cues&&t.cues.forEach(o=>r.addCue(o))}),e.textTracks()},trackToJson_:La};const xs="vjs-modal-dialog";class Cs extends lt{constructor(e,t){super(e,t),this.handleKeyDown_=r=>this.handleKeyDown(r),this.close_=r=>this.close(r),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=Rt("div",{className:`${xs}-content`},{role:"document"}),this.descEl_=Rt("p",{className:`${xs}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),ii(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${xs} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_){this.options_.fillAlways&&this.fill();return}const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if(typeof e=="boolean"){const t=this.closeable_=!!e;let r=this.getChild("closeButton");if(t&&!r){const o=this.contentEl_;this.contentEl_=this.el_,r=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=o,this.on(r,"close",this.close_)}!t&&r&&(this.off(r,"close",this.close_),this.removeChild(r),r.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),r=t.parentNode,o=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,r.removeChild(t),this.empty(),vr(t,e),this.trigger("modalfill"),o?r.insertBefore(t,o):r.appendChild(t);const f=this.getChild("closeButton");f&&r.appendChild(f.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),Ws(this.contentEl()),this.trigger("modalempty")}content(e){return typeof e<"u"&&(this.content_=e),this.content_}conditionalFocus_(){const e=document.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),e.key==="Escape"&&this.closeable()){e.preventDefault(),this.close();return}if(e.key!=="Tab")return;const t=this.focusableEls_(),r=this.el_.querySelector(":focus");let o;for(let f=0;f<t.length;f++)if(r===t[f]){o=f;break}document.activeElement===this.el_&&(o=0),e.shiftKey&&o===0?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&o===t.length-1&&(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,t=>(t instanceof window.HTMLAnchorElement||t instanceof window.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof window.HTMLInputElement||t instanceof window.HTMLSelectElement||t instanceof window.HTMLTextAreaElement||t instanceof window.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof window.HTMLIFrameElement||t instanceof window.HTMLObjectElement||t instanceof window.HTMLEmbedElement||t.hasAttribute("tabindex")&&t.getAttribute("tabindex")!==-1||t.hasAttribute("contenteditable"))}}Cs.prototype.options_={pauseOnOpen:!0,temporary:!0},lt.registerComponent("ModalDialog",Cs);class ks extends _i{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},on(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let r=0,o=this.length;r<o;r++)if(this[r]===e){t=this[r],t.off&&t.off(),this.tracks_.splice(r,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let r=0,o=this.length;r<o;r++){const f=this[r];if(f.id===e){t=f;break}}return t}}ks.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const i in ks.prototype.allowedEvents_)ks.prototype["on"+i]=null;const Po=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].enabled=!1)};class xl extends ks{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){Po(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&Po(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,Po(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const Oo=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].selected=!1)};class Cl extends ks{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){Oo(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let t=0;t<this.length;t++)if(this[t].selected)return t;return-1},set(){}})}addTrack(e){e.selected&&Oo(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,Oo(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class Mo extends ks{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),["metadata","chapters"].indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}}class kl{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,r=e.length;t<r;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),this.trackElements_.indexOf(e)===-1&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let r=0,o=this.trackElements_.length;r<o;r++)if(e===this.trackElements_[r].track){t=this.trackElements_[r];break}return t}removeTrackElement_(e){for(let t=0,r=this.trackElements_.length;t<r;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&typeof this.trackElements_[t].track.off=="function"&&this.trackElements_[t].track.off(),typeof this.trackElements_[t].off=="function"&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class Jt{constructor(e){Jt.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let r=0;const o=e.length;this.cues_=e,this.length_=e.length;const f=function(p){""+p in this||Object.defineProperty(this,""+p,{get(){return this.cues_[p]}})};if(t<o)for(r=t;r<o;r++)f.call(this,r)}getCueById(e){let t=null;for(let r=0,o=this.length;r<o;r++){const f=this[r];if(f.id===e){t=f;break}}return t}}const Nt={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},No={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},lo={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},Ia={disabled:"disabled",hidden:"hidden",showing:"showing"};class uo extends _i{constructor(e={}){super();const t={id:e.id||"vjs_track_"+Pr(),kind:e.kind||"",language:e.language||""};let r=e.label||"";for(const o in t)Object.defineProperty(this,o,{get(){return t[o]},set(){}});Object.defineProperty(this,"label",{get(){return r},set(o){o!==r&&(r=o,this.trigger("labelchange"))}})}}const Ra=function(i){return new URL(i,document.baseURI)},Ds=function(i){return new URL(i,document.baseURI).href},Or=function(i){if(typeof i=="string"){const t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(i);if(t)return t.pop().toLowerCase()}return""},ra=function(i,e=window.location){return Ra(i).origin!==e.origin};var ku=Object.freeze({__proto__:null,parseUrl:Ra,getAbsoluteURL:Ds,getFileExtension:Or,isCrossOrigin:ra}),ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function On(i,e){return e={exports:{}},i(e,e.exports),e.exports}var ws;typeof window<"u"?ws=window:typeof ns<"u"?ws=ns:typeof self<"u"?ws=self:ws={};var xr=ws,na=On(function(i){function e(){return i.exports=e=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var f in o)({}).hasOwnProperty.call(o,f)&&(t[f]=o[f])}return t},i.exports.__esModule=!0,i.exports.default=i.exports,e.apply(null,arguments)}i.exports=e,i.exports.__esModule=!0,i.exports.default=i.exports}),Hi=vn(na),Dl=Ll,wl=Object.prototype.toString;function Ll(i){if(!i)return!1;var e=wl.call(i);return e==="[object Function]"||typeof i=="function"&&e!=="[object RegExp]"||typeof window<"u"&&(i===window.setTimeout||i===window.alert||i===window.confirm||i===window.prompt)}function gi(i,e){var t=typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t)return(t=t.call(i)).next.bind(t);if(Array.isArray(i)||(t=Du(i))||e&&i&&typeof i.length=="number"){t&&(i=t);var r=0;return function(){return r>=i.length?{done:!0}:{done:!1,value:i[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Du(i,e){if(i){if(typeof i=="string")return Pa(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Pa(i,e)}}function Pa(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}var wu=function(){function i(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var e=i.prototype;return e.getIsEnabled=function(){return this.enabled_},e.enable=function(){this.enabled_=!0},e.disable=function(){this.enabled_=!1},e.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},e.addInterceptor=function(r,o){this.typeToInterceptorsMap_.has(r)||this.typeToInterceptorsMap_.set(r,new Set);var f=this.typeToInterceptorsMap_.get(r);return f.has(o)?!1:(f.add(o),!0)},e.removeInterceptor=function(r,o){var f=this.typeToInterceptorsMap_.get(r);return f&&f.has(o)?(f.delete(o),!0):!1},e.clearInterceptorsByType=function(r){var o=this.typeToInterceptorsMap_.get(r);return o?(this.typeToInterceptorsMap_.delete(r),this.typeToInterceptorsMap_.set(r,new Set),!0):!1},e.clear=function(){return this.typeToInterceptorsMap_.size?(this.typeToInterceptorsMap_=new Map,!0):!1},e.getForType=function(r){return this.typeToInterceptorsMap_.get(r)||new Set},e.execute=function(r,o){for(var f=this.getForType(r),p=gi(f),E;!(E=p()).done;){var N=E.value;try{o=N(o)}catch{}}return o},i}(),Ls=wu,J=function(){function i(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var e=i.prototype;return e.getIsEnabled=function(){return this.enabled_},e.enable=function(){this.enabled_=!0},e.disable=function(){this.enabled_=!1},e.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},e.getMaxAttempts=function(){return this.maxAttempts_},e.setMaxAttempts=function(r){this.maxAttempts_=r},e.getDelayFactor=function(){return this.delayFactor_},e.setDelayFactor=function(r){this.delayFactor_=r},e.getFuzzFactor=function(){return this.fuzzFactor_},e.setFuzzFactor=function(r){this.fuzzFactor_=r},e.getInitialDelay=function(){return this.initialDelay_},e.setInitialDelay=function(r){this.initialDelay_=r},e.createRetry=function(r){var o=r===void 0?{}:r,f=o.maxAttempts,p=o.delayFactor,E=o.fuzzFactor,N=o.initialDelay;return new ee({maxAttempts:f||this.maxAttempts_,delayFactor:p||this.delayFactor_,fuzzFactor:E||this.fuzzFactor_,initialDelay:N||this.initialDelay_})},i}(),ee=function(){function i(t){this.maxAttempts_=t.maxAttempts,this.delayFactor_=t.delayFactor,this.fuzzFactor_=t.fuzzFactor,this.currentDelay_=t.initialDelay,this.currentAttempt_=1}var e=i.prototype;return e.moveToNextAttempt=function(){this.currentAttempt_++;var r=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+r},e.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},e.getCurrentDelay=function(){return this.currentDelay_},e.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},e.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},e.getCurrentFuzzedDelay=function(){var r=this.getCurrentMinPossibleDelay(),o=this.getCurrentMaxPossibleDelay();return r+Math.random()*(o-r)},i}(),j=J,y=function(e,t){return t===void 0&&(t=!1),function(r,o,f){if(r){e(r);return}if(o.statusCode>=400&&o.statusCode<=599){var p=f;if(t)if(xr.TextDecoder){var E=F(o.headers&&o.headers["content-type"]);try{p=new TextDecoder(E).decode(f)}catch{}}else p=String.fromCharCode.apply(null,new Uint8Array(f));e({cause:p});return}e(null,f)}};function F(i){return i===void 0&&(i=""),i.toLowerCase().split(";").reduce(function(e,t){var r=t.split("="),o=r[0],f=r[1];return o.trim()==="charset"?f.trim():e},"utf-8")}var re=y;Q.httpHandler=re,Q.requestInterceptorsStorage=new Ls,Q.responseInterceptorsStorage=new Ls,Q.retryManager=new j;/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Bjrklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */var C=function(e){var t={};return e&&e.trim().split(`
`).forEach(function(r){var o=r.indexOf(":"),f=r.slice(0,o).trim().toLowerCase(),p=r.slice(o+1).trim();typeof t[f]>"u"?t[f]=p:Array.isArray(t[f])?t[f].push(p):t[f]=[t[f],p]}),t},z=Q,G=Q;Q.XMLHttpRequest=xr.XMLHttpRequest||W,Q.XDomainRequest="withCredentials"in new Q.XMLHttpRequest?Q.XMLHttpRequest:xr.XDomainRequest,de(["get","put","post","patch","head","delete"],function(i){Q[i==="delete"?"del":i]=function(e,t,r){return t=le(e,t,r),t.method=i.toUpperCase(),X(t)}});function de(i,e){for(var t=0;t<i.length;t++)e(i[t])}function te(i){for(var e in i)if(i.hasOwnProperty(e))return!1;return!0}function le(i,e,t){var r=i;return Dl(e)?(t=e,typeof i=="string"&&(r={uri:i})):r=na({},e,{uri:i}),r.callback=t,r}function Q(i,e,t){return e=le(i,e,t),X(e)}function X(i){if(typeof i.callback>"u")throw new Error("callback argument missing");if(i.requestType&&Q.requestInterceptorsStorage.getIsEnabled()){var e={uri:i.uri||i.url,headers:i.headers||{},body:i.body,metadata:i.metadata||{},retry:i.retry,timeout:i.timeout},t=Q.requestInterceptorsStorage.execute(i.requestType,e);i.uri=t.uri,i.headers=t.headers,i.body=t.body,i.metadata=t.metadata,i.retry=t.retry,i.timeout=t.timeout}var r=!1,o=function(We,dt,Dt){r||(r=!0,i.callback(We,dt,Dt))};function f(){$.readyState===4&&!Q.responseInterceptorsStorage.getIsEnabled()&&setTimeout(N,0)}function p(){var st=void 0;if($.response?st=$.response:st=$.responseText||ie($),$e)try{st=JSON.parse(st)}catch{}return st}function E(st){if(clearTimeout(tt),clearTimeout(i.retryTimeout),st instanceof Error||(st=new Error(""+(st||"Unknown XMLHttpRequest Error"))),st.statusCode=0,!Te&&Q.retryManager.getIsEnabled()&&i.retry&&i.retry.shouldRetry()){i.retryTimeout=setTimeout(function(){i.retry.moveToNextAttempt(),i.xhr=$,X(i)},i.retry.getCurrentFuzzedDelay());return}if(i.requestType&&Q.responseInterceptorsStorage.getIsEnabled()){var We={headers:Je.headers||{},body:Je.body,responseUrl:$.responseURL,responseType:$.responseType},dt=Q.responseInterceptorsStorage.execute(i.requestType,We);Je.body=dt.body,Je.headers=dt.headers}return o(st,Je)}function N(){if(!Te){var st;clearTimeout(tt),clearTimeout(i.retryTimeout),i.useXDR&&$.status===void 0?st=200:st=$.status===1223?204:$.status;var We=Je,dt=null;if(st!==0?(We={body:p(),statusCode:st,method:Me,headers:{},url:we,rawRequest:$},$.getAllResponseHeaders&&(We.headers=C($.getAllResponseHeaders()))):dt=new Error("Internal XMLHttpRequest Error"),i.requestType&&Q.responseInterceptorsStorage.getIsEnabled()){var Dt={headers:We.headers||{},body:We.body,responseUrl:$.responseURL,responseType:$.responseType},kt=Q.responseInterceptorsStorage.execute(i.requestType,Dt);We.body=kt.body,We.headers=kt.headers}return o(dt,We,We.body)}}var $=i.xhr||null;$||(i.cors||i.useXDR?$=new Q.XDomainRequest:$=new Q.XMLHttpRequest);var he,Te,we=$.url=i.uri||i.url,Me=$.method=i.method||"GET",Ge=i.body||i.data,ke=$.headers=i.headers||{},qe=!!i.sync,$e=!1,tt,Je={body:void 0,headers:{},statusCode:0,method:Me,url:we,rawRequest:$};if("json"in i&&i.json!==!1&&($e=!0,ke.accept||ke.Accept||(ke.Accept="application/json"),Me!=="GET"&&Me!=="HEAD"&&(ke["content-type"]||ke["Content-Type"]||(ke["Content-Type"]="application/json"),Ge=JSON.stringify(i.json===!0?Ge:i.json))),$.onreadystatechange=f,$.onload=N,$.onerror=E,$.onprogress=function(){},$.onabort=function(){Te=!0,clearTimeout(i.retryTimeout)},$.ontimeout=E,$.open(Me,we,!qe,i.username,i.password),qe||($.withCredentials=!!i.withCredentials),!qe&&i.timeout>0&&(tt=setTimeout(function(){if(!Te){Te=!0,$.abort("timeout");var st=new Error("XMLHttpRequest timeout");st.code="ETIMEDOUT",E(st)}},i.timeout)),$.setRequestHeader)for(he in ke)ke.hasOwnProperty(he)&&$.setRequestHeader(he,ke[he]);else if(i.headers&&!te(i.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in i&&($.responseType=i.responseType),"beforeSend"in i&&typeof i.beforeSend=="function"&&i.beforeSend($),$.send(Ge||null),$}function ie(i){try{if(i.responseType==="document")return i.responseXML;var e=i.responseXML&&i.responseXML.documentElement.nodeName==="parsererror";if(i.responseType===""&&!e)return i.responseXML}catch{}return null}function W(){}z.default=G;const se=function(i,e){const t=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()),r=[];t.oncue=function(o){e.addCue(o)},t.onparsingerror=function(o){r.push(o)},t.onflush=function(){e.trigger({type:"loadeddata",target:e})},t.parse(i),r.length>0&&(window.console&&window.console.groupCollapsed&&window.console.groupCollapsed(`Text Track parsing errors for ${e.src}`),r.forEach(o=>zt.error(o)),window.console&&window.console.groupEnd&&window.console.groupEnd()),t.flush()},Y=function(i,e){const t={uri:i},r=ra(i);r&&(t.cors=r);const o=e.tech_.crossOrigin()==="use-credentials";o&&(t.withCredentials=o),z(t,pi(this,function(f,p,E){if(f)return zt.error(f,p);e.loaded_=!0,typeof window.WebVTT!="function"?e.tech_&&e.tech_.any(["vttjsloaded","vttjserror"],N=>{if(N.type==="vttjserror"){zt.error(`vttjs failed to load, stopping trying to process ${e.src}`);return}return se(E,e)}):se(E,e)}))};class V extends uo{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=oi(e,{kind:lo[e.kind]||"subtitles",language:e.language||e.srclang||""});let r=Ia[t.mode]||"disabled";const o=t.default;(t.kind==="metadata"||t.kind==="chapters")&&(r="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=this.tech_.preloadTextTracks!==!1;const f=new Jt(this.cues_),p=new Jt(this.activeCues_);let E=!1;this.timeupdateHandler=pi(this,function($={}){if(!this.tech_.isDisposed()){if(!this.tech_.isReady_){$.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,E&&(this.trigger("cuechange"),E=!1),$.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});const N=()=>{this.stopTracking()};this.tech_.one("dispose",N),r!=="disabled"&&this.startTracking(),Object.defineProperties(this,{default:{get(){return o},set(){}},mode:{get(){return r},set($){Ia[$]&&r!==$&&(r=$,!this.preload_&&r!=="disabled"&&this.cues.length===0&&Y(this.src,this),this.stopTracking(),r!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?f:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(this.cues.length===0)return p;const $=this.tech_.currentTime(),he=[];for(let Te=0,we=this.cues.length;Te<we;Te++){const Me=this.cues[Te];Me.startTime<=$&&Me.endTime>=$&&he.push(Me)}if(E=!1,he.length!==this.activeCues_.length)E=!0;else for(let Te=0;Te<he.length;Te++)this.activeCues_.indexOf(he[Te])===-1&&(E=!0);return this.activeCues_=he,p.setCues_(this.activeCues_),p},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||t.kind!=="subtitles"&&t.kind!=="captions")&&Y(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new window.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const o in e)o in t||(t[o]=e[o]);t.id=e.id,t.originalCue_=e}const r=this.tech_.textTracks();for(let o=0;o<r.length;o++)r[o]!==this&&r[o].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;for(;t--;){const r=this.cues_[t];if(r===e||r.originalCue_&&r.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}V.prototype.allowedEvents_={cuechange:"cuechange"};class M extends uo{constructor(e={}){const t=oi(e,{kind:No[e.kind]||""});super(t);let r=!1;Object.defineProperty(this,"enabled",{get(){return r},set(o){typeof o!="boolean"||o===r||(r=o,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class b extends uo{constructor(e={}){const t=oi(e,{kind:Nt[e.kind]||""});super(t);let r=!1;Object.defineProperty(this,"selected",{get(){return r},set(o){typeof o!="boolean"||o===r||(r=o,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class I extends _i{constructor(e={}){super();let t;const r=new V(e);this.kind=r.kind,this.src=r.src,this.srclang=r.language,this.label=r.label,this.default=r.default,Object.defineProperties(this,{readyState:{get(){return t}},track:{get(){return r}}}),t=I.NONE,r.addEventListener("loadeddata",()=>{t=I.LOADED,this.trigger({type:"load",target:this})})}}I.prototype.allowedEvents_={load:"load"},I.NONE=0,I.LOADING=1,I.LOADED=2,I.ERROR=3;const w={audio:{ListClass:xl,TrackClass:M,capitalName:"Audio"},video:{ListClass:Cl,TrackClass:b,capitalName:"Video"},text:{ListClass:Mo,TrackClass:V,capitalName:"Text"}};Object.keys(w).forEach(function(i){w[i].getterName=`${i}Tracks`,w[i].privateName=`${i}Tracks_`});const P={remoteText:{ListClass:Mo,TrackClass:V,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:kl,TrackClass:I,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},_=Object.assign({},w,P);P.names=Object.keys(P),w.names=Object.keys(w),_.names=[].concat(P.names).concat(w.names);var v={},A=typeof ns<"u"?ns:typeof window<"u"?window:{},D;typeof document<"u"?D=document:(D=A["__GLOBAL_DOCUMENT_CACHE@4"],D||(D=A["__GLOBAL_DOCUMENT_CACHE@4"]=v));var O=D,K=Object.create||function(){function i(){}return function(e){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return i.prototype=e,new i}}();function k(i,e){this.name="ParsingError",this.code=i.code,this.message=e||i.message}k.prototype=K(Error.prototype),k.prototype.constructor=k,k.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function L(i){function e(r,o,f,p){return(r|0)*3600+(o|0)*60+(f|0)+(p|0)/1e3}var t=i.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return t?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):t[1]>59?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null}function R(){this.values=K(null)}R.prototype={set:function(i,e){!this.get(i)&&e!==""&&(this.values[i]=e)},get:function(i,e,t){return t?this.has(i)?this.values[i]:e[t]:this.has(i)?this.values[i]:e},has:function(i){return i in this.values},alt:function(i,e,t){for(var r=0;r<t.length;++r)if(e===t[r]){this.set(i,e);break}},integer:function(i,e){/^-?\d+$/.test(e)&&this.set(i,parseInt(e,10))},percent:function(i,e){return e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e),e>=0&&e<=100)?(this.set(i,e),!0):!1}};function Z(i,e,t,r){var o=r?i.split(r):[i];for(var f in o)if(typeof o[f]=="string"){var p=o[f].split(t);if(p.length===2){var E=p[0].trim(),N=p[1].trim();e(E,N)}}}function ae(i,e,t){var r=i;function o(){var E=L(i);if(E===null)throw new k(k.Errors.BadTimeStamp,"Malformed timestamp: "+r);return i=i.replace(/^[^\sa-zA-Z-]+/,""),E}function f(E,N){var $=new R;Z(E,function(he,Te){switch(he){case"region":for(var we=t.length-1;we>=0;we--)if(t[we].id===Te){$.set(he,t[we].region);break}break;case"vertical":$.alt(he,Te,["rl","lr"]);break;case"line":var Me=Te.split(","),Ge=Me[0];$.integer(he,Ge),$.percent(he,Ge)&&$.set("snapToLines",!1),$.alt(he,Ge,["auto"]),Me.length===2&&$.alt("lineAlign",Me[1],["start","center","end"]);break;case"position":Me=Te.split(","),$.percent(he,Me[0]),Me.length===2&&$.alt("positionAlign",Me[1],["start","center","end"]);break;case"size":$.percent(he,Te);break;case"align":$.alt(he,Te,["start","center","end","left","right"]);break}},/:/,/\s/),N.region=$.get("region",null),N.vertical=$.get("vertical","");try{N.line=$.get("line","auto")}catch{}N.lineAlign=$.get("lineAlign","start"),N.snapToLines=$.get("snapToLines",!0),N.size=$.get("size",100);try{N.align=$.get("align","center")}catch{N.align=$.get("align","middle")}try{N.position=$.get("position","auto")}catch{N.position=$.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},N.align)}N.positionAlign=$.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},N.align)}function p(){i=i.replace(/^\s+/,"")}if(p(),e.startTime=o(),p(),i.substr(0,3)!=="-->")throw new k(k.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+r);i=i.substr(3),p(),e.endTime=o(),p(),f(i,e)}var fe=O.createElement&&O.createElement("textarea"),ce={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},me={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},Ee={v:"title",lang:"lang"},be={rt:"ruby"};function Re(i,e){function t(){if(!e)return null;function Ge(qe){return e=e.substr(qe.length),qe}var ke=e.match(/^([^<]*)(<[^>]*>?)?/);return Ge(ke[1]?ke[1]:ke[2])}function r(Ge){return fe.innerHTML=Ge,Ge=fe.textContent,fe.textContent="",Ge}function o(Ge,ke){return!be[ke.localName]||be[ke.localName]===Ge.localName}function f(Ge,ke){var qe=ce[Ge];if(!qe)return null;var $e=i.document.createElement(qe),tt=Ee[Ge];return tt&&ke&&($e[tt]=ke.trim()),$e}for(var p=i.document.createElement("div"),E=p,N,$=[];(N=t())!==null;){if(N[0]==="<"){if(N[1]==="/"){$.length&&$[$.length-1]===N.substr(2).replace(">","")&&($.pop(),E=E.parentNode);continue}var he=L(N.substr(1,N.length-2)),Te;if(he){Te=i.document.createProcessingInstruction("timestamp",he),E.appendChild(Te);continue}var we=N.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!we||(Te=f(we[1],we[3]),!Te)||!o(E,Te))continue;if(we[2]){var Me=we[2].split(".");Me.forEach(function(Ge){var ke=/^bg_/.test(Ge),qe=ke?Ge.slice(3):Ge;if(me.hasOwnProperty(qe)){var $e=ke?"background-color":"color",tt=me[qe];Te.style[$e]=tt}}),Te.className=Me.join(" ")}$.push(we[1]),E.appendChild(Te),E=Te;continue}E.appendChild(i.document.createTextNode(r(N)))}return p}var Ce=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function Ne(i){for(var e=0;e<Ce.length;e++){var t=Ce[e];if(i>=t[0]&&i<=t[1])return!0}return!1}function Ue(i){var e=[],t="",r;if(!i||!i.childNodes)return"ltr";function o(E,N){for(var $=N.childNodes.length-1;$>=0;$--)E.push(N.childNodes[$])}function f(E){if(!E||!E.length)return null;var N=E.pop(),$=N.textContent||N.innerText;if($){var he=$.match(/^.*(\n|\r)/);return he?(E.length=0,he[0]):$}if(N.tagName==="ruby")return f(E);if(N.childNodes)return o(E,N),f(E)}for(o(e,i);t=f(e);)for(var p=0;p<t.length;p++)if(r=t.charCodeAt(p),Ne(r))return"rtl";return"ltr"}function Xe(i){if(typeof i.line=="number"&&(i.snapToLines||i.line>=0&&i.line<=100))return i.line;if(!i.track||!i.track.textTrackList||!i.track.textTrackList.mediaElement)return-1;for(var e=i.track,t=e.textTrackList,r=0,o=0;o<t.length&&t[o]!==e;o++)t[o].mode==="showing"&&r++;return++r*-1}function ut(){}ut.prototype.applyStyles=function(i,e){e=e||this.div;for(var t in i)i.hasOwnProperty(t)&&(e.style[t]=i[t])},ut.prototype.formatStyle=function(i,e){return i===0?0:i+e};function gt(i,e,t){ut.call(this),this.cue=e,this.cueDiv=Re(i,e.text);var r={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(r,this.cueDiv),this.div=i.document.createElement("div"),r={direction:Ue(this.cueDiv),writingMode:e.vertical===""?"horizontal-tb":e.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:e.align==="middle"?"center":e.align,font:t.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(r),this.div.appendChild(this.cueDiv);var o=0;switch(e.positionAlign){case"start":case"line-left":o=e.position;break;case"center":o=e.position-e.size/2;break;case"end":case"line-right":o=e.position-e.size;break}e.vertical===""?this.applyStyles({left:this.formatStyle(o,"%"),width:this.formatStyle(e.size,"%")}):this.applyStyles({top:this.formatStyle(o,"%"),height:this.formatStyle(e.size,"%")}),this.move=function(f){this.applyStyles({top:this.formatStyle(f.top,"px"),bottom:this.formatStyle(f.bottom,"px"),left:this.formatStyle(f.left,"px"),right:this.formatStyle(f.right,"px"),height:this.formatStyle(f.height,"px"),width:this.formatStyle(f.width,"px")})}}gt.prototype=K(ut.prototype),gt.prototype.constructor=gt;function ft(i){var e,t,r,o;if(i.div){t=i.div.offsetHeight,r=i.div.offsetWidth,o=i.div.offsetTop;var f=(f=i.div.childNodes)&&(f=f[0])&&f.getClientRects&&f.getClientRects();i=i.div.getBoundingClientRect(),e=f?Math.max(f[0]&&f[0].height||0,i.height/f.length):0}this.left=i.left,this.right=i.right,this.top=i.top||o,this.height=i.height||t,this.bottom=i.bottom||o+(i.height||t),this.width=i.width||r,this.lineHeight=e!==void 0?e:i.lineHeight}ft.prototype.move=function(i,e){switch(e=e!==void 0?e:this.lineHeight,i){case"+x":this.left+=e,this.right+=e;break;case"-x":this.left-=e,this.right-=e;break;case"+y":this.top+=e,this.bottom+=e;break;case"-y":this.top-=e,this.bottom-=e;break}},ft.prototype.overlaps=function(i){return this.left<i.right&&this.right>i.left&&this.top<i.bottom&&this.bottom>i.top},ft.prototype.overlapsAny=function(i){for(var e=0;e<i.length;e++)if(this.overlaps(i[e]))return!0;return!1},ft.prototype.within=function(i){return this.top>=i.top&&this.bottom<=i.bottom&&this.left>=i.left&&this.right<=i.right},ft.prototype.overlapsOppositeAxis=function(i,e){switch(e){case"+x":return this.left<i.left;case"-x":return this.right>i.right;case"+y":return this.top<i.top;case"-y":return this.bottom>i.bottom}},ft.prototype.intersectPercentage=function(i){var e=Math.max(0,Math.min(this.right,i.right)-Math.max(this.left,i.left)),t=Math.max(0,Math.min(this.bottom,i.bottom)-Math.max(this.top,i.top)),r=e*t;return r/(this.height*this.width)},ft.prototype.toCSSCompatValues=function(i){return{top:this.top-i.top,bottom:i.bottom-this.bottom,left:this.left-i.left,right:i.right-this.right,height:this.height,width:this.width}},ft.getSimpleBoxPosition=function(i){var e=i.div?i.div.offsetHeight:i.tagName?i.offsetHeight:0,t=i.div?i.div.offsetWidth:i.tagName?i.offsetWidth:0,r=i.div?i.div.offsetTop:i.tagName?i.offsetTop:0;i=i.div?i.div.getBoundingClientRect():i.tagName?i.getBoundingClientRect():i;var o={left:i.left,right:i.right,top:i.top||r,height:i.height||e,bottom:i.bottom||r+(i.height||e),width:i.width||t};return o};function St(i,e,t,r){function o(qe,$e){for(var tt,Je=new ft(qe),st=1,We=0;We<$e.length;We++){for(;qe.overlapsOppositeAxis(t,$e[We])||qe.within(t)&&qe.overlapsAny(r);)qe.move($e[We]);if(qe.within(t))return qe;var dt=qe.intersectPercentage(t);st>dt&&(tt=new ft(qe),st=dt),qe=new ft(Je)}return tt||Je}var f=new ft(e),p=e.cue,E=Xe(p),N=[];if(p.snapToLines){var $;switch(p.vertical){case"":N=["+y","-y"],$="height";break;case"rl":N=["+x","-x"],$="width";break;case"lr":N=["-x","+x"],$="width";break}var he=f.lineHeight,Te=he*Math.round(E),we=t[$]+he,Me=N[0];Math.abs(Te)>we&&(Te=Te<0?-1:1,Te*=Math.ceil(we/he)*he),E<0&&(Te+=p.vertical===""?t.height:t.width,N=N.reverse()),f.move(Me,Te)}else{var Ge=f.lineHeight/t.height*100;switch(p.lineAlign){case"center":E-=Ge/2;break;case"end":E-=Ge;break}switch(p.vertical){case"":e.applyStyles({top:e.formatStyle(E,"%")});break;case"rl":e.applyStyles({left:e.formatStyle(E,"%")});break;case"lr":e.applyStyles({right:e.formatStyle(E,"%")});break}N=["+y","-x","+x","-y"],f=new ft(e)}var ke=o(f,N);e.move(ke.toCSSCompatValues(t))}function Et(){}Et.StringDecoder=function(){return{decode:function(i){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}},Et.convertCueToDOMTree=function(i,e){return!i||!e?null:Re(i,e)};var ve=.05,Oe="sans-serif",Ke="1.5%";Et.processCues=function(i,e,t){if(!i||!e||!t)return null;for(;t.firstChild;)t.removeChild(t.firstChild);var r=i.document.createElement("div");r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",r.style.margin=Ke,t.appendChild(r);function o(he){for(var Te=0;Te<he.length;Te++)if(he[Te].hasBeenReset||!he[Te].displayState)return!0;return!1}if(!o(e)){for(var f=0;f<e.length;f++)r.appendChild(e[f].displayState);return}var p=[],E=ft.getSimpleBoxPosition(r),N=Math.round(E.height*ve*100)/100,$={font:N+"px "+Oe};(function(){for(var he,Te,we=0;we<e.length;we++)Te=e[we],he=new gt(i,Te,$),r.appendChild(he.div),St(i,he,E,p),Te.displayState=he.div,p.push(ft.getSimpleBoxPosition(he))})()},Et.Parser=function(i,e,t){t||(t=e,e={}),e||(e={}),this.window=i,this.vttjs=e,this.state="INITIAL",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[]},Et.Parser.prototype={reportOrThrowError:function(i){if(i instanceof k)this.onparsingerror&&this.onparsingerror(i);else throw i},parse:function(i){var e=this;i&&(e.buffer+=e.decoder.decode(i,{stream:!0}));function t(){for(var he=e.buffer,Te=0;Te<he.length&&he[Te]!=="\r"&&he[Te]!==`
`;)++Te;var we=he.substr(0,Te);return he[Te]==="\r"&&++Te,he[Te]===`
`&&++Te,e.buffer=he.substr(Te),we}function r(he){var Te=new R;if(Z(he,function(Me,Ge){switch(Me){case"id":Te.set(Me,Ge);break;case"width":Te.percent(Me,Ge);break;case"lines":Te.integer(Me,Ge);break;case"regionanchor":case"viewportanchor":var ke=Ge.split(",");if(ke.length!==2)break;var qe=new R;if(qe.percent("x",ke[0]),qe.percent("y",ke[1]),!qe.has("x")||!qe.has("y"))break;Te.set(Me+"X",qe.get("x")),Te.set(Me+"Y",qe.get("y"));break;case"scroll":Te.alt(Me,Ge,["up"]);break}},/=/,/\s/),Te.has("id")){var we=new(e.vttjs.VTTRegion||e.window.VTTRegion);we.width=Te.get("width",100),we.lines=Te.get("lines",3),we.regionAnchorX=Te.get("regionanchorX",0),we.regionAnchorY=Te.get("regionanchorY",100),we.viewportAnchorX=Te.get("viewportanchorX",0),we.viewportAnchorY=Te.get("viewportanchorY",100),we.scroll=Te.get("scroll",""),e.onregion&&e.onregion(we),e.regionList.push({id:Te.get("id"),region:we})}}function o(he){var Te=new R;Z(he,function(we,Me){switch(we){case"MPEGT":Te.integer(we+"S",Me);break;case"LOCA":Te.set(we+"L",L(Me));break}},/[^\d]:/,/,/),e.ontimestampmap&&e.ontimestampmap({MPEGTS:Te.get("MPEGTS"),LOCAL:Te.get("LOCAL")})}function f(he){he.match(/X-TIMESTAMP-MAP/)?Z(he,function(Te,we){switch(Te){case"X-TIMESTAMP-MAP":o(we);break}},/=/):Z(he,function(Te,we){switch(Te){case"Region":r(we);break}},/:/)}try{var p;if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;p=t();var E=p.match(/^WEBVTT([ \t].*)?$/);if(!E||!E[0])throw new k(k.Errors.BadSignature);e.state="HEADER"}for(var N=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(N?N=!1:p=t(),e.state){case"HEADER":/:/.test(p)?f(p):p||(e.state="ID");continue;case"NOTE":p||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(p)){e.state="NOTE";break}if(!p)continue;e.cue=new(e.vttjs.VTTCue||e.window.VTTCue)(0,0,"");try{e.cue.align="center"}catch{e.cue.align="middle"}if(e.state="CUE",p.indexOf("-->")===-1){e.cue.id=p;continue}case"CUE":try{ae(p,e.cue,e.regionList)}catch(he){e.reportOrThrowError(he),e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var $=p.indexOf("-->")!==-1;if(!p||$&&(N=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+=`
`),e.cue.text+=p.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":p||(e.state="ID");continue}}}catch(he){e.reportOrThrowError(he),e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var i=this;try{if(i.buffer+=i.decoder.decode(),(i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL")throw new k(k.Errors.BadSignature)}catch(e){i.reportOrThrowError(e)}return i.onflush&&i.onflush(),this}};var nt=Et,vt="auto",mt={"":1,lr:1,rl:1},Qt={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function Yt(i){if(typeof i!="string")return!1;var e=mt[i.toLowerCase()];return e?i.toLowerCase():!1}function Wt(i){if(typeof i!="string")return!1;var e=Qt[i.toLowerCase()];return e?i.toLowerCase():!1}function ni(i,e,t){this.hasBeenReset=!1;var r="",o=!1,f=i,p=e,E=t,N=null,$="",he=!0,Te="auto",we="start",Me="auto",Ge="auto",ke=100,qe="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return r},set:function($e){r=""+$e}},pauseOnExit:{enumerable:!0,get:function(){return o},set:function($e){o=!!$e}},startTime:{enumerable:!0,get:function(){return f},set:function($e){if(typeof $e!="number")throw new TypeError("Start time must be set to a number.");f=$e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return p},set:function($e){if(typeof $e!="number")throw new TypeError("End time must be set to a number.");p=$e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return E},set:function($e){E=""+$e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return N},set:function($e){N=$e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return $},set:function($e){var tt=Yt($e);if(tt===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");$=tt,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return he},set:function($e){he=!!$e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return Te},set:function($e){if(typeof $e!="number"&&$e!==vt)throw new SyntaxError("Line: an invalid number or illegal string was specified.");Te=$e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return we},set:function($e){var tt=Wt($e);tt?(we=tt,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return Me},set:function($e){if($e<0||$e>100)throw new Error("Position must be between 0 and 100.");Me=$e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return Ge},set:function($e){var tt=Wt($e);tt?(Ge=tt,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return ke},set:function($e){if($e<0||$e>100)throw new Error("Size must be between 0 and 100.");ke=$e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return qe},set:function($e){var tt=Wt($e);if(!tt)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");qe=tt,this.hasBeenReset=!0}}}),this.displayState=void 0}ni.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var Vt=ni,bi={"":!0,up:!0};function sr(i){if(typeof i!="string")return!1;var e=bi[i.toLowerCase()];return e?i.toLowerCase():!1}function mi(i){return typeof i=="number"&&i>=0&&i<=100}function Mr(){var i=100,e=3,t=0,r=100,o=0,f=100,p="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return i},set:function(E){if(!mi(E))throw new Error("Width must be between 0 and 100.");i=E}},lines:{enumerable:!0,get:function(){return e},set:function(E){if(typeof E!="number")throw new TypeError("Lines must be set to a number.");e=E}},regionAnchorY:{enumerable:!0,get:function(){return r},set:function(E){if(!mi(E))throw new Error("RegionAnchorX must be between 0 and 100.");r=E}},regionAnchorX:{enumerable:!0,get:function(){return t},set:function(E){if(!mi(E))throw new Error("RegionAnchorY must be between 0 and 100.");t=E}},viewportAnchorY:{enumerable:!0,get:function(){return f},set:function(E){if(!mi(E))throw new Error("ViewportAnchorY must be between 0 and 100.");f=E}},viewportAnchorX:{enumerable:!0,get:function(){return o},set:function(E){if(!mi(E))throw new Error("ViewportAnchorX must be between 0 and 100.");o=E}},scroll:{enumerable:!0,get:function(){return p},set:function(E){var N=sr(E);N===!1?console.warn("Scroll: an invalid or illegal string was specified."):p=N}}})}var Li=Mr,Zi=On(function(i){var e=i.exports={WebVTT:nt,VTTCue:Vt,VTTRegion:Li};xr.vttjs=e,xr.WebVTT=e.WebVTT;var t=e.VTTCue,r=e.VTTRegion,o=xr.VTTCue,f=xr.VTTRegion;e.shim=function(){xr.VTTCue=t,xr.VTTRegion=r},e.restore=function(){xr.VTTCue=o,xr.VTTRegion=f},xr.VTTCue||e.shim()});Zi.WebVTT,Zi.VTTCue,Zi.VTTRegion;function er(i,e,t,r,o={}){const f=i.textTracks();o.kind=e,t&&(o.label=t),r&&(o.language=r),o.tech=i;const p=new _.text.TrackClass(o);return f.addTrack(p),p}class Lt extends lt{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=r=>this.onDurationChange(r),this.trackProgress_=r=>this.trackProgress(r),this.trackCurrentTime_=r=>this.trackCurrentTime(r),this.stopTrackingCurrentTime_=r=>this.stopTrackingCurrentTime(r),this.disposeSourceHandler_=r=>this.disposeSourceHandler(r),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),_.names.forEach(r=>{const o=_[r];e&&e[o.getterName]&&(this[o.privateName]=e[o.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(r=>{e[`native${r}Tracks`]===!1&&(this[`featuresNative${r}Tracks`]=!1)}),e.nativeCaptions===!1||e.nativeTextTracks===!1?this.featuresNativeTextTracks=!1:(e.nativeCaptions===!0||e.nativeTextTracks===!0)&&(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=e.preloadTextTracks!==!1,this.autoRemoteTextTracks_=new _.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(pi(this,function(){const t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),this.bufferedPercent_=t,t===1&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return $r(0,0)}bufferedPercent(){return ia(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(w.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(t=>{const r=this[`${t}Tracks`]()||[];let o=r.length;for(;o--;){const f=r[o];t==="text"&&this.removeRemoteTextTrack(f),r.removeTrack(f)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const r=e[t];this.removeRemoteTextTrack(r)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return e!==void 0&&(this.error_=new wi(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?$r(0,0):$r()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){w.names.forEach(e=>{const t=w[e],r=()=>{this.trigger(`${e}trackchange`)},o=this[t.getterName]();o.addEventListener("removetrack",r),o.addEventListener("addtrack",r),this.on("dispose",()=>{o.removeEventListener("removetrack",r),o.removeEventListener("addtrack",r)})})}addWebVttScript_(){if(!window.WebVTT)if(document.body.contains(this.el())){if(!this.options_["vtt.js"]&&es(Zi)&&Object.keys(Zi).length>0){this.trigger("vttjsloaded");return}const e=document.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),window.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),r=E=>e.addTrack(E.track),o=E=>e.removeTrack(E.track);t.on("addtrack",r),t.on("removetrack",o),this.addWebVttScript_();const f=()=>this.trigger("texttrackchange"),p=()=>{f();for(let E=0;E<e.length;E++){const N=e[E];N.removeEventListener("cuechange",f),N.mode==="showing"&&N.addEventListener("cuechange",f)}};p(),e.addEventListener("change",p),e.addEventListener("addtrack",p),e.addEventListener("removetrack",p),this.on("dispose",function(){t.off("addtrack",r),t.off("removetrack",o),e.removeEventListener("change",p),e.removeEventListener("addtrack",p),e.removeEventListener("removetrack",p);for(let E=0;E<e.length;E++)e[E].removeEventListener("cuechange",f)})}addTextTrack(e,t,r){if(!e)throw new Error("TextTrack kind is required but was not provided");return er(this,e,t,r)}createRemoteTextTrack(e){const t=oi(e,{tech:this});return new P.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const r=this.createRemoteTextTrack(e);return typeof t!="boolean"&&(t=!1),this.remoteTextTrackEls().addTrackElement_(r),this.remoteTextTracks().addTrack(r.track),t===!1&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(r.track)),r}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=Pr();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return Lt.canPlayType(e.type)}static isTech(e){return e.prototype instanceof Lt||e instanceof Lt||e===Lt}static registerTech(e,t){if(Lt.techs_||(Lt.techs_={}),!Lt.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!Lt.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!Lt.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=Ri(e),Lt.techs_[e]=t,Lt.techs_[As(e)]=t,e!=="Tech"&&Lt.defaultTechOrder_.push(e),t}static getTech(e){if(e){if(Lt.techs_&&Lt.techs_[e])return Lt.techs_[e];if(e=Ri(e),window&&window.videojs&&window.videojs[e])return zt.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),window.videojs[e]}}}_.names.forEach(function(i){const e=_[i];Lt.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}}),Lt.prototype.featuresVolumeControl=!0,Lt.prototype.featuresMuteControl=!0,Lt.prototype.featuresFullscreenResize=!1,Lt.prototype.featuresPlaybackRate=!1,Lt.prototype.featuresProgressEvents=!1,Lt.prototype.featuresSourceset=!1,Lt.prototype.featuresTimeupdateEvents=!1,Lt.prototype.featuresNativeTextTracks=!1,Lt.prototype.featuresVideoFrameCallback=!1,Lt.withSourceHandlers=function(i){i.registerSourceHandler=function(t,r){let o=i.sourceHandlers;o||(o=i.sourceHandlers=[]),r===void 0&&(r=o.length),o.splice(r,0,t)},i.canPlayType=function(t){const r=i.sourceHandlers||[];let o;for(let f=0;f<r.length;f++)if(o=r[f].canPlayType(t),o)return o;return""},i.selectSourceHandler=function(t,r){const o=i.sourceHandlers||[];let f;for(let p=0;p<o.length;p++)if(f=o[p].canHandleSource(t,r),f)return o[p];return null},i.canPlaySource=function(t,r){const o=i.selectSourceHandler(t,r);return o?o.canHandleSource(t,r):""},["seekable","seeking","duration"].forEach(function(t){const r=this[t];typeof r=="function"&&(this[t]=function(){return this.sourceHandler_&&this.sourceHandler_[t]?this.sourceHandler_[t].apply(this.sourceHandler_,arguments):r.apply(this,arguments)})},i.prototype),i.prototype.setSource=function(t){let r=i.selectSourceHandler(t,this.options_);r||(i.nativeSourceHandler?r=i.nativeSourceHandler:zt.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),r!==i.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=r.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},i.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},lt.registerComponent("Tech",Lt),Lt.registerTech("Tech",Lt),Lt.defaultTechOrder_=[];const ji={},ln={},tr={};function Fo(i,e){ji[i]=ji[i]||[],ji[i].push(e)}function Oa(i,e,t){i.setTimeout(()=>Nr(e,ji[e.type],t,i),1)}function Ma(i,e){i.forEach(t=>t.setTech&&t.setTech(e))}function zr(i,e,t){return i.reduceRight(yn(t),e[t]())}function sa(i,e,t,r){return e[t](i.reduce(yn(t),r))}function Is(i,e,t,r=null){const o="call"+Ri(t),f=i.reduce(yn(o),r),p=f===tr,E=p?null:e[t](f);return ss(i,t,E,p),E}const qn={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Na={setCurrentTime:1,setMuted:1,setVolume:1},Rs={play:1,pause:1};function yn(i){return(e,t)=>e===tr?tr:t[i]?t[i](e):e}function ss(i,e,t,r){for(let o=i.length-1;o>=0;o--){const f=i[o];f[e]&&f[e](r,t)}}function ht(i){ln.hasOwnProperty(i.id())&&delete ln[i.id()]}function zi(i,e){const t=ln[i.id()];let r=null;if(t==null)return r=e(i),ln[i.id()]=[[e,r]],r;for(let o=0;o<t.length;o++){const[f,p]=t[o];f===e&&(r=p)}return r===null&&(r=e(i),t.push([e,r])),r}function Nr(i={},e=[],t,r,o=[],f=!1){const[p,...E]=e;if(typeof p=="string")Nr(i,ji[p],t,r,o,f);else if(p){const N=zi(r,p);if(!N.setSource)return o.push(N),Nr(i,E,t,r,o,f);N.setSource(Object.assign({},i),function($,he){if($)return Nr(i,E,t,r,o,f);o.push(N),Nr(he,i.type===he.type?E:ji[he.type],t,r,o,f)})}else E.length?Nr(i,E,t,r,o,f):f?t(i,o):Nr(i,ji["*"],t,r,o,!0)}const Il={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Yr=function(i=""){const e=Or(i);return Il[e.toLowerCase()]||""},Bo=(i,e)=>{if(!e)return"";if(i.cache_.source.src===e&&i.cache_.source.type)return i.cache_.source.type;const t=i.cache_.sources.filter(o=>o.src===e);if(t.length)return t[0].type;const r=i.$$("source");for(let o=0;o<r.length;o++){const f=r[o];if(f.type&&f.src&&f.src===e)return f.type}return Yr(e)},Rl=function(i){if(Array.isArray(i)){let e=[];i.forEach(function(t){t=Rl(t),Array.isArray(t)?e=e.concat(t):pr(t)&&e.push(t)}),i=e}else typeof i=="string"&&i.trim()?i=[co({src:i})]:pr(i)&&typeof i.src=="string"&&i.src&&i.src.trim()?i=[co(i)]:i=[];return i};function co(i){if(!i.type){const e=Yr(i.src);e&&(i.type=e)}return i}var Uo=`<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play">
      <path d="M16 10v28l22-14z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">
      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">
      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">
      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">
      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">
      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">
      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">
      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">
      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">
      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">
      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">
      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">
      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>
    </symbol>
    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">
      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">
      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>
    </symbol>
    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">
      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">
      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">
      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">
      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-share">
      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">
      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-square">
      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">
      <circle cx="24" cy="24" r="20"></circle>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">
      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">
      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">
      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">
      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">
      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">
      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">
      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">
      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">
      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>
    </symbol>
    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">
      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">
      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">
      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">
      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">
      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">
      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>
    </symbol>
    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">
      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>
      <path fill="none" d="M-1-3h24v24H-1z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">
      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">
      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>
    </symbol>
    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">
      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">
      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">
      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>
    </symbol>
  </defs>
</svg>`;const Go=Vn?10009:Hn?461:8,as={codes:{play:415,pause:19,ff:417,rw:412,back:Go},names:{415:"play",19:"pause",417:"ff",412:"rw",[Go]:"back"},isEventKey(i,e){return e=e.toLowerCase(),!!(this.names[i.keyCode]&&this.names[i.keyCode]===e)},getEventName(i){if(this.names[i.keyCode])return this.names[i.keyCode];if(this.codes[i.code]){const e=this.codes[i.code];return this.names[e]}return null}},Kc=5;class Pl extends _i{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const r=t.key.substring(5).toLowerCase();this.move(r)}else if(as.isEventKey(t,"play")||as.isEventKey(t,"pause")||as.isEventKey(t,"ff")||as.isEventKey(t,"rw")){t.preventDefault();const r=as.getEventName(t);this.performMediaAction_(r)}else as.isEventKey(t,"Back")&&e.target&&typeof e.target.closeable=="function"&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+Kc);break;case"rw":this.userSeek_(this.player_.currentTime()-Kc);break}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let r=null;const o=this.getCurrentComponent(e.target);t&&(r=!!t.closest(".video-js"),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(!e.currentTarget.contains(e.relatedTarget)&&!r||!t)&&(o&&o.name()==="CloseButton"?this.refocusComponent():(this.pause(),o&&o.el()&&(this.lastFocusedComponent_=o)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function r(o){for(const f of o)f.hasOwnProperty("el_")&&f.getIsFocusable()&&f.getIsAvailableToBeFocused(f.el())&&t.push(f),f.hasOwnProperty("children_")&&f.children_.length>0&&r(f.children_)}return e.children_.forEach(o=>{if(o.hasOwnProperty("el_"))if(o.getIsFocusable&&o.getIsAvailableToBeFocused&&o.getIsFocusable()&&o.getIsAvailableToBeFocused(o.el())){t.push(o);return}else o.hasOwnProperty("children_")&&o.children_.length>0?r(o.children_):o.hasOwnProperty("items")&&o.items.length>0?r(o.items):this.findSuitableDOMChild(o)&&t.push(o);if(o.name_==="ErrorDisplay"&&o.opened_){const f=o.el_.querySelector(".vjs-errors-ok-button-container");f&&f.querySelectorAll("button").forEach((E,N)=>{t.push({name:()=>"ModalButton"+(N+1),el:()=>E,getPositions:()=>{const $=E.getBoundingClientRect(),he={x:$.x,y:$.y,width:$.width,height:$.height,top:$.top,right:$.right,bottom:$.bottom,left:$.left},Te={x:$.left+$.width/2,y:$.top+$.height/2,width:0,height:0,top:$.top+$.height/2,right:$.left+$.width/2,bottom:$.top+$.height/2,left:$.left+$.width/2};return{boundingClientRect:he,center:Te}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:$=>!0,focus:()=>E.focus()})})}}),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){function t(r){if(e.getIsFocusable(r)&&e.getIsAvailableToBeFocused(r))return r;for(let o=0;o<r.children.length;o++){const f=r.children[o],p=t(f);if(p)return p}return null}return e.el()?t(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length){for(const r of this.focusableComponents)if(r.el()===t)return r}}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name()){this.focusableComponents.splice(t,1),this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents});return}}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const r=t.getPositions(),o=this.focusableComponents.filter(p=>p!==t&&this.isInDirection_(r.boundingClientRect,p.getPositions().boundingClientRect,e)),f=this.findBestCandidate_(r.center,o,e);f?this.focus(f):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,r){let o=1/0,f=null;for(const p of t){const E=p.getPositions().center,N=this.calculateDistance_(e,E,r);N<o&&(o=N,f=p)}return f}isInDirection_(e,t,r){switch(r){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name()){this.focus(this.focusableComponents[e]);return}}else this.focus(this.updateFocusableComponents()[0])}focus(e){typeof e=="object"&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,r){const o=Math.abs(e.x-t.x),f=Math.abs(e.y-t.y);let p;switch(r){case"right":case"left":p=o+f*100;break;case"up":p=f*2+o*.5;break;case"down":p=f*5+o;break;default:p=o+f}return p}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if(t.constructor.name==="TextTrackSelect"){e.focus(t);break}}}class Hh extends lt{constructor(e,t,r){const o=oi({createEl:!1},t);if(super(e,o,r),!t.playerOptions.sources||t.playerOptions.sources.length===0)for(let f=0,p=t.playerOptions.techOrder;f<p.length;f++){const E=Ri(p[f]);let N=Lt.getTech(E);if(E||(N=lt.getComponent(E)),N&&N.isSupported()){e.loadTech_(E);break}}else e.src(t.playerOptions.sources)}}lt.registerComponent("MediaLoader",Hh);class Ol extends lt{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=r=>this.handleMouseOver(r),this.handleMouseOut_=r=>this.handleMouseOut(r),this.handleClick_=r=>this.handleClick(r),this.handleKeyDown_=r=>this.handleKeyDown(r),this.emitTapEvents(),this.enable()}createEl(e="div",t={},r={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),e==="button"&&zt.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),r=Object.assign({role:"button"},r),this.tabIndex_=t.tabIndex;const o=Rt(e,t,r);return this.player_.options_.experimentalSvgIcons||o.appendChild(Rt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(o),o}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=Rt("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(e===void 0)return this.controlText_||"Need Text";const r=this.localize(e);this.controlText_=e,ii(this.controlTextEl_,r),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",r)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){e.key===" "||e.key==="Enter"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}lt.registerComponent("ClickableComponent",Ol);class Ml extends Ol{constructor(e,t){super(e,t),this.update(),this.update_=r=>this.update(r),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return Rt("div",{className:"vjs-poster"})}crossOrigin(e){if(typeof e>"u")return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.$("img")&&(this.$("img").crossOrigin=e)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){if(!e){this.el_.textContent="";return}this.$("img")||this.el_.appendChild(Rt("picture",{className:"vjs-poster",tabIndex:-1},{},Rt("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?Wr(this.player_.play()):this.player_.pause())}}Ml.prototype.crossorigin=Ml.prototype.crossOrigin,lt.registerComponent("PosterImage",Ml);const Tn="#222",qc="#ccc",$c={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function ho(i,e){let t;if(i.length===4)t=i[1]+i[1]+i[2]+i[2]+i[3]+i[3];else if(i.length===7)t=i.slice(1);else throw new Error("Invalid color code provided, "+i+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(t.slice(0,2),16)+","+parseInt(t.slice(2,4),16)+","+parseInt(t.slice(4,6),16)+","+e+")"}function os(i,e,t){try{i.style[e]=t}catch{return}}function Wc(i){return i?`${i}px`:""}class jh extends lt{constructor(e,t,r){super(e,t,r);const o=p=>this.updateDisplay(p),f=p=>{this.updateDisplayOverlay(),this.updateDisplay(p)};e.on("loadstart",p=>this.toggleDisplay(p)),e.on("texttrackchange",o),e.on("loadedmetadata",p=>{this.updateDisplayOverlay(),this.preselectTrack(p)}),e.ready(pi(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks){this.hide();return}e.on("fullscreenchange",f),e.on("playerresize",f);const p=window.screen.orientation||window,E=window.screen.orientation?"change":"orientationchange";p.addEventListener(E,f),e.on("dispose",()=>p.removeEventListener(E,f));const N=this.options_.playerOptions.tracks||[];for(let $=0;$<N.length;$++)this.player_.addRemoteTextTrack(N[$],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),r=this.player_.cache_.selectedLanguage;let o,f,p;for(let E=0;E<t.length;E++){const N=t[E];r&&r.enabled&&r.language&&r.language===N.language&&N.kind in e?N.kind===r.kind?p=N:p||(p=N):r&&!r.enabled?(p=null,o=null,f=null):N.default&&(N.kind==="descriptions"&&!o?o=N:N.kind in e&&!f&&(f=N))}p?p.mode="showing":f?f.mode="showing":o&&(o.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){typeof window.WebVTT=="function"&&window.WebVTT.processCues(window,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const p=[];for(let E=0;E<e.length;++E){const N=e[E];N.mode==="showing"&&p.push(N)}this.updateForTrack(p);return}let r=null,o=null,f=e.length;for(;f--;){const p=e[f];p.mode==="showing"&&(p.kind==="descriptions"?r=p:o=p)}if(o?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(o)):r&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(r)),!window.CSS.supports("inset","10px")){const p=this.el_,E=p.querySelectorAll(".vjs-text-track-cue"),N=this.player_.controlBar.el_.getBoundingClientRect().height,$=this.player_.el_.getBoundingClientRect().height;p.style="",os(p,"position","relative"),os(p,"height",$-N+"px"),os(p,"top","unset"),ps?os(p,"bottom",$+"px"):os(p,"bottom","0px"),E.length>0&&E.forEach(he=>{if(he.style.inset){const Te=he.style.inset.split(" ");Te.length===3&&Object.assign(he.style,{top:Te[0],right:Te[1],bottom:Te[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!window.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),r=e/t,o=this.player_.videoWidth()/this.player_.videoHeight();let f=0,p=0;Math.abs(r-o)>.1&&(r>o?f=Math.round((e-t*o)/2):p=Math.round((t-e/o)/2)),os(this.el_,"insetInline",Wc(f)),os(this.el_,"insetBlock",Wc(p))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),r=e.activeCues;let o=r.length;for(;o--;){const f=r[o];if(!f)continue;const p=f.displayState;if(t.color&&(p.firstChild.style.color=t.color),t.textOpacity&&os(p.firstChild,"color",ho(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(p.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&os(p.firstChild,"backgroundColor",ho(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?os(p,"backgroundColor",ho(t.windowColor,t.windowOpacity)):p.style.backgroundColor=t.windowColor),t.edgeStyle&&(t.edgeStyle==="dropshadow"?p.firstChild.style.textShadow=`2px 2px 3px ${Tn}, 2px 2px 4px ${Tn}, 2px 2px 5px ${Tn}`:t.edgeStyle==="raised"?p.firstChild.style.textShadow=`1px 1px ${Tn}, 2px 2px ${Tn}, 3px 3px ${Tn}`:t.edgeStyle==="depressed"?p.firstChild.style.textShadow=`1px 1px ${qc}, 0 1px ${qc}, -1px -1px ${Tn}, 0 -1px ${Tn}`:t.edgeStyle==="uniform"&&(p.firstChild.style.textShadow=`0 0 4px ${Tn}, 0 0 4px ${Tn}, 0 0 4px ${Tn}, 0 0 4px ${Tn}`)),t.fontPercent&&t.fontPercent!==1){const E=window.parseFloat(p.style.fontSize);p.style.fontSize=E*t.fontPercent+"px",p.style.height="auto",p.style.top="auto"}t.fontFamily&&t.fontFamily!=="default"&&(t.fontFamily==="small-caps"?p.firstChild.style.fontVariant="small-caps":p.firstChild.style.fontFamily=$c[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),typeof window.WebVTT!="function"||e.every(r=>!r.activeCues))return;const t=[];for(let r=0;r<e.length;++r){const o=e[r];for(let f=0;f<o.activeCues.length;++f)t.push(o.activeCues[f])}window.WebVTT.processCues(window,t,this.el_);for(let r=0;r<e.length;++r){const o=e[r];for(let f=0;f<o.activeCues.length;++f){const p=o.activeCues[f].displayState;Gt(p,"vjs-text-track-cue","vjs-text-track-cue-"+(o.language?o.language:r)),o.language&&Es(p,"lang",o.language)}this.player_.textTrackSettings&&this.updateDisplayState(o)}}}lt.registerComponent("TextTrackDisplay",jh);class Kh extends lt{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),r=Rt("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),o=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return o.appendChild(r),o}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}lt.registerComponent("LoadingSpinner",Kh);class Cr extends Ol{createEl(e,t={},r={}){e="button",t=Object.assign({className:this.buildCSSClass()},t),r=Object.assign({type:"button"},r);const o=Rt(e,t,r);return this.player_.options_.experimentalSvgIcons||o.appendChild(Rt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(o),o}addChild(e,t={}){const r=this.constructor.name;return zt.warn(`Adding an actionable (user controllable) child to a Button (${r}) is not supported; use a ClickableComponent instead.`),lt.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){if(e.key===" "||e.key==="Enter"){e.stopPropagation();return}super.handleKeyDown(e)}}lt.registerComponent("Button",Cr);class Lu extends Cr{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",r=>this.handleMouseDown(r))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(this.mouseused_&&"clientX"in e&&"clientY"in e){Wr(t),this.player_.tech(!0)&&this.player_.tech(!0).focus();return}const r=this.player_.getChild("controlBar"),o=r&&r.getChild("playToggle");if(!o){this.player_.tech(!0).focus();return}const f=()=>o.focus();Ji(t)?t.then(f,()=>{}):this.setTimeout(f,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}Lu.prototype.controlText_="Play Video",lt.registerComponent("BigPlayButton",Lu);class Iu extends Cr{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){e.key==="Escape"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}lt.registerComponent("CloseButton",Iu);class Ru extends Cr{constructor(e,t={}){super(e,t),t.replay=t.replay===void 0||t.replay,this.setIcon("play"),this.on(e,"play",r=>this.handlePlay(r)),this.on(e,"pause",r=>this.handlePause(r)),t.replay&&this.on(e,"ended",r=>this.handleEnded(r))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?Wr(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",t=>this.handleSeeked(t))}}Ru.prototype.controlText_="Play",lt.registerComponent("PlayToggle",Ru);class fo extends lt{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],r=>this.update(r)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),r=Rt("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)}\xA0`},{role:"presentation"});return t.appendChild(r),this.contentEl_=Rt("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){!this.player_.options_.enableSmoothSeeking&&e.type==="seeking"||this.updateContent(e)}updateTextNode_(e=0){e=Kn(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let t=this.textNode_;t&&this.contentEl_.firstChild!==t&&(t=null,zt.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=document.createTextNode(this.formattedTime_),this.textNode_&&(t?this.contentEl_.replaceChild(this.textNode_,t):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}fo.prototype.labelText_="Time",fo.prototype.controlText_="Time",lt.registerComponent("TimeDisplay",fo);class Nl extends fo{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;this.player_.ended()?t=this.player_.duration():t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}Nl.prototype.labelText_="Current Time",Nl.prototype.controlText_="Current Time",lt.registerComponent("CurrentTimeDisplay",Nl);class Pu extends fo{constructor(e,t){super(e,t);const r=o=>this.updateContent(o);this.on(e,"durationchange",r),this.on(e,"loadstart",r),this.on(e,"loadedmetadata",r)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}Pu.prototype.labelText_="Duration",Pu.prototype.controlText_="Duration",lt.registerComponent("DurationDisplay",Pu);class qh extends lt{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),r=super.createEl("span",{textContent:"/"});return t.appendChild(r),e.appendChild(t),e}}lt.registerComponent("TimeDivider",qh);class Ou extends fo{constructor(e,t){super(e,t),this.on(e,"durationchange",r=>this.updateContent(r))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return this.options_.displayNegative!==!1&&e.insertBefore(Rt("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if(typeof this.player_.duration()!="number")return;let t;this.player_.ended()?t=0:this.player_.remainingTimeDisplay?t=this.player_.remainingTimeDisplay():t=this.player_.remainingTime(),this.updateTextNode_(t)}}Ou.prototype.labelText_="Remaining Time",Ou.prototype.controlText_="Remaining Time",lt.registerComponent("RemainingTimeDisplay",Ou);class zc extends lt{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",r=>this.updateShowing(r))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Rt("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Rt("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}\xA0`})),this.contentEl_.appendChild(document.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}lt.registerComponent("LiveDisplay",zc);class Yc extends Cr{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=r=>this.updateLiveEdgeStatus(r),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=Rt("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}Yc.prototype.controlText_="Seek to live, currently playing live",lt.registerComponent("SeekToLive",Yc);function po(i,e,t){return i=Number(i),Math.min(t,Math.max(e,isNaN(i)?e:i))}var $h=Object.freeze({__proto__:null,clamp:po});class Fl extends lt{constructor(e,t){super(e,t),this.handleMouseDown_=r=>this.handleMouseDown(r),this.handleMouseUp_=r=>this.handleMouseUp(r),this.handleKeyDown_=r=>this.handleKeyDown(r),this.handleClick_=r=>this.handleClick(r),this.handleMouseMove_=r=>this.handleMouseMove(r),this.update_=r=>this.update(r),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},r={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),r=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},r),super.createEl(e,t,r)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!_t&&e.preventDefault(),Ln(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;Sa(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(e*100).toFixed(2)+"%"})),e}getProgress(){return Number(po(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=no(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,r=t&&t.enabled,o=t&&t.horizontalSeek;r?o&&e.key==="ArrowLeft"||!o&&e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):o&&e.key==="ArrowRight"||!o&&e.key==="ArrowUp"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e):e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):e.key==="ArrowUp"||e.key==="ArrowRight"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}lt.registerComponent("Slider",Fl);const Mu=(i,e)=>po(i/e*100,0,100).toFixed(2)+"%";class Wh extends lt{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",r=>this.update(r))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=Rt("span",{className:"vjs-control-text"}),r=Rt("span",{textContent:this.localize("Loaded")}),o=document.createTextNode(": ");return this.percentageEl_=Rt("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(r),t.appendChild(o),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const t=this.player_.liveTracker,r=this.player_.buffered(),o=t&&t.isLive()?t.seekableEnd():this.player_.duration(),f=this.player_.bufferedEnd(),p=this.partEls_,E=Mu(f,o);this.percent_!==E&&(this.el_.style.width=E,ii(this.percentageEl_,E),this.percent_=E);for(let N=0;N<r.length;N++){const $=r.start(N),he=r.end(N);let Te=p[N];Te||(Te=this.el_.appendChild(Rt()),p[N]=Te),!(Te.dataset.start===$&&Te.dataset.end===he)&&(Te.dataset.start=$,Te.dataset.end=he,Te.style.left=Mu($,f),Te.style.width=Mu(he-$,f))}for(let N=p.length;N>r.length;N--)this.el_.removeChild(p[N-1]);p.length=r.length})}}lt.registerComponent("LoadProgressBar",Wh);class Er extends lt{constructor(e,t){super(e,t),this.update=Pn(pi(this,this.update),sn)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,r){const o=is(this.el_),f=In(this.player_.el()),p=e.width*t;if(!f||!o)return;let E=e.left-f.left+p,N=e.width-p+(f.right-e.right);N||(N=e.width-p,E=p);let $=o.width/2;E<$?$+=$-E:N<$&&($=N),$<0?$=0:$>o.width&&($=o.width),$=Math.round($),this.el_.style.right=`-${$}px`,this.write(r)}write(e){ii(this.el_,e)}updateTime(e,t,r,o){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let f;const p=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const E=this.player_.liveTracker.liveWindow(),N=E-t*E;f=(N<1?"":"-")+Kn(N,E)}else f=Kn(r,p);this.update(e,t,f),o&&o()})}}lt.registerComponent("TimeTooltip",Er);class Nu extends lt{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=Pn(pi(this,this.update),sn)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t){const r=this.getChild("timeTooltip");if(!r)return;const o=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();r.updateTime(e,t,o)}}Nu.prototype.options_={children:[]},!Gi&&!_e&&Nu.prototype.options_.children.push("timeTooltip"),lt.registerComponent("PlayProgressBar",Nu);class Bl extends lt{constructor(e,t){super(e,t),this.update=Pn(pi(this,this.update),sn)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const r=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,r,()=>{this.el_.style.left=`${e.width*t}px`})}}Bl.prototype.options_={children:["timeTooltip"]},lt.registerComponent("MouseTimeDisplay",Bl);const Ul=5,Xc=12;class go extends Fl{constructor(e,t){super(e,t),this.setEventHandlers_()}setEventHandlers_(){this.update_=pi(this,this.update),this.update=Pn(this.update_,sn),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.on(document,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){document.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,sn))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if(document.visibilityState==="hidden")return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const r=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),o=this.player_.liveTracker;let f=this.player_.duration();o&&o.isLive()&&(f=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(t*100).toFixed(2)),this.percent_=t),(this.currentTime_!==r||this.duration_!==f)&&(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[Kn(r,f),Kn(f,f)],"{1} of {2}")),this.currentTime_=r,this.duration_=f),this.bar&&this.bar.update(In(this.el()),this.getProgress())}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}getPercent(){const e=this.getCurrentTime_();let t;const r=this.player_.liveTracker;return r&&r.isLive()?(t=(e-r.seekableStart())/r.liveWindow(),r.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){xa(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!xa(e)||isNaN(this.player_.duration()))return;!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);let r;const o=this.calculateDistance(e),f=this.player_.liveTracker;if(!f||!f.isLive())r=o*this.player_.duration(),r===this.player_.duration()&&(r=r-.1);else{if(o>=.99){f.seekToLiveEdge();return}const p=f.seekableStart(),E=f.liveCurrentTime();if(r=p+o*f.liveWindow(),r>=E&&(r=E),r<=p&&(r=p+.1),r===1/0)return}this.userSeek_(r),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Wr(this.player_.play()):this.update_()}stepForward(){this.userSeek_(this.player_.currentTime()+Ul)}stepBack(){this.userSeek_(this.player_.currentTime()-Ul)}handleAction(e){this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(e.key===" "||e.key==="Enter")e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(e.key==="Home")e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(e.key==="End")e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const r=parseInt(e.key,10)*.1;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*r):this.userSeek_(this.player_.duration()*r)}else e.key==="PageDown"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-Ul*Xc)):e.key==="PageUp"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+Ul*Xc)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.off(document,"visibilitychange",this.toggleVisibility_),super.dispose()}}go.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},!Gi&&!_e&&go.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),lt.registerComponent("SeekBar",go);class Gl extends lt{constructor(e,t){super(e,t),this.handleMouseMove=Pn(pi(this,this.handleMouseMove),sn),this.throttledHandleMouseSeek=Pn(pi(this,this.handleMouseSeek),sn),this.handleMouseUpHandler_=r=>this.handleMouseUp(r),this.handleMouseDownHandler_=r=>this.handleMouseDown(r),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const r=t.getChild("playProgressBar"),o=t.getChild("mouseTimeDisplay");if(!r&&!o)return;const f=t.el(),p=is(f);let E=no(f,e).x;E=po(E,0,1),o&&o.update(p,E),r&&r.update(p,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&Wr(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,r=this.getChild("seekBar");r&&r.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}Gl.prototype.options_={children:["seekBar"]},lt.registerComponent("ProgressControl",Gl);class Fa extends Cr{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],r=>this.handlePictureInPictureChange(r)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],r=>this.handlePictureInPictureEnabledChange(r)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){if(!(this.player_.currentType().substring(0,5)==="audio"||this.player_.audioPosterMode()||this.player_.audioOnlyMode())){this.show();return}this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()}handlePictureInPictureEnabledChange(){document.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in window?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){typeof document.exitPictureInPicture=="function"&&super.show()}}Fa.prototype.controlText_="Picture-in-Picture",lt.registerComponent("PictureInPictureToggle",Fa);class Qc extends Cr{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",r=>this.handleFullscreenChange(r)),document[e.fsApi_.fullscreenEnabled]===!1&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}Qc.prototype.controlText_="Fullscreen",lt.registerComponent("FullscreenToggle",Qc);const Jc=function(i,e){e.tech_&&!e.tech_.featuresVolumeControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresVolumeControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class aa extends lt{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}lt.registerComponent("VolumeLevel",aa);class kr extends lt{constructor(e,t){super(e,t),this.update=Pn(pi(this,this.update),sn)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,r,o){if(!r){const f=In(this.el_),p=In(this.player_.el()),E=e.width*t;if(!p||!f)return;const N=e.left-p.left+E,$=e.width-E+(p.right-e.right);let he=f.width/2;N<he?he+=he-N:$<he&&(he=$),he<0?he=0:he>f.width&&(he=f.width),this.el_.style.right=`-${he}px`}this.write(`${o}%`)}write(e){ii(this.el_,e)}updateVolume(e,t,r,o,f){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,r,o.toFixed(0)),f&&f()})}}lt.registerComponent("VolumeLevelTooltip",kr);class Fu extends lt{constructor(e,t){super(e,t),this.update=Pn(pi(this,this.update),sn)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,r){const o=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,r,o,()=>{r?this.el_.style.bottom=`${e.height*t}px`:this.el_.style.left=`${e.width*t}px`})}}Fu.prototype.options_={children:["volumeLevelTooltip"]},lt.registerComponent("MouseVolumeLevelDisplay",Fu);class mo extends Fl{constructor(e,t){super(e,t),this.on("slideractive",r=>this.updateLastVolume_(r)),this.on(e,"volumechange",r=>this.updateARIAAttributes(r)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){xa(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const r=this.el(),o=In(r),f=this.vertical();let p=no(r,e);p=f?p.y:p.x,p=po(p,0,1),t.update(o,p,f)}xa(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(this.player_.volume()*100)}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{this.player_.volume()===0&&this.player_.lastVolume_(e)})}}mo.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},!Gi&&!_e&&mo.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),mo.prototype.playerEvent="volumechange",lt.registerComponent("VolumeBar",mo);class Zc extends lt{constructor(e,t={}){t.vertical=t.vertical||!1,(typeof t.volumeBar>"u"||es(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),Jc(this,e),this.throttledHandleMouseMove=Pn(pi(this,this.handleMouseMove),sn),this.handleMouseUpHandler_=r=>this.handleMouseUp(r),this.on("mousedown",r=>this.handleMouseDown(r)),this.on("touchstart",r=>this.handleMouseDown(r)),this.on("mousemove",r=>this.handleMouseMove(r)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}Zc.prototype.options_={children:["volumeBar"]},lt.registerComponent("VolumeControl",Zc);const Vo=function(i,e){e.tech_&&!e.tech_.featuresMuteControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresMuteControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class ed extends Cr{constructor(e,t){super(e,t),Vo(this,e),this.on(e,["loadstart","volumechange"],r=>this.update(r))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),r=this.player_.lastVolume_();if(t===0){const o=r<.1?.1:r;this.player_.volume(o),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),Gi&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),Aa(this.el_,[0,1,2,3].reduce((r,o)=>r+`${o?" ":""}vjs-vol-${o}`,"")),Gt(this.el_,`vjs-vol-${t}`)}updateControlText_(){const t=this.player_.muted()||this.player_.volume()===0?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)}}ed.prototype.controlText_="Mute",lt.registerComponent("MuteToggle",ed);class td extends lt{constructor(e,t={}){typeof t.inline<"u"?t.inline=t.inline:t.inline=!0,(typeof t.volumeControl>"u"||es(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=r=>this.handleKeyPress(r),this.on(e,["loadstart"],r=>this.volumePanelState_(r)),this.on(this.muteToggle,"keyup",r=>this.handleKeyPress(r)),this.on(this.volumeControl,"keyup",r=>this.handleVolumeControlKeyUp(r)),this.on("keydown",r=>this.handleKeyPress(r)),this.on("mouseover",r=>this.handleMouseOver(r)),this.on("mouseout",r=>this.handleMouseOut(r)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){e.key==="Escape"&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),yr(document,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),fi(document,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){e.key==="Escape"&&this.handleMouseOut()}}td.prototype.options_={children:["muteToggle","volumeControl"]},lt.registerComponent("VolumePanel",td);class Bu extends Cr{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),r=this.player_.liveTracker,o=r&&r.isLive()?r.seekableEnd():this.player_.duration();let f;t+this.skipTime<=o?f=t+this.skipTime:f=o,this.player_.currentTime(f)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}Bu.prototype.controlText_="Skip Forward",lt.registerComponent("SkipForward",Bu);class id extends Cr{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),r=this.player_.liveTracker,o=r&&r.isLive()&&r.seekableStart();let f;o&&t-this.skipTime<=o?f=o:t>=this.skipTime?f=t-this.skipTime:f=0,this.player_.currentTime(f)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}id.prototype.controlText_="Skip Backward",lt.registerComponent("SkipBackward",id);class rd extends lt{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",r=>this.handleKeyDown(r)),this.boundHandleBlur_=r=>this.handleBlur(r),this.boundHandleTapClick_=r=>this.handleTapClick(r)}addEventListenerForItem(e){e instanceof lt&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof lt&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=Rt(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),yr(t,"click",function(r){r.preventDefault(),r.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||document.activeElement;if(!this.children().some(r=>r.el()===t)){const r=this.menuButton_;r&&r.buttonPressed_&&t!==r.el().firstChild&&r.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const r=t.filter(o=>o.el()===e.target)[0];if(!r)return;r.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}}handleKeyDown(e){e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(e.key==="ArrowRight"||e.key==="ArrowUp")&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}lt.registerComponent("Menu",rd);class oa extends lt{constructor(e,t={}){super(e,t),this.menuButton_=new Cr(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const r=Cr.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+r,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const o=f=>this.handleClick(f);this.handleMenuKeyUp_=f=>this.handleMenuKeyUp(f),this.on(this.menuButton_,"tap",o),this.on(this.menuButton_,"click",o),this.on(this.menuButton_,"keydown",f=>this.handleKeyDown(f)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),yr(document,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",f=>this.handleMouseLeave(f)),this.on("keydown",f=>this.handleSubmenuKeyDown(f))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new rd(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=Rt("li",{className:"vjs-menu-title",textContent:Ri(this.options_.title),tabIndex:-1}),r=new lt(this.player_,{el:t});e.addItem(r)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";const t=Cr.prototype.buildCSSClass();return`vjs-menu-button ${e} ${t} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),fi(document,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){e.key==="Esc"||e.key==="Tab"?(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus())):(e.key==="Up"||e.key==="Down"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(e.key==="Esc"||e.key==="Tab")&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(e.key==="Esc"||e.key==="Tab")&&(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),Gi&&mn())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}lt.registerComponent("MenuButton",oa);class Ho extends oa{constructor(e,t){const r=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!r)return;const o=pi(this,this.update);r.addEventListener("removetrack",o),r.addEventListener("addtrack",o),r.addEventListener("labelchange",o),this.player_.on("ready",o),this.player_.on("dispose",function(){r.removeEventListener("removetrack",o),r.removeEventListener("addtrack",o),r.removeEventListener("labelchange",o)})}}lt.registerComponent("TrackButton",Ho);class la extends Ol{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,r){this.nonIconControl=!0;const o=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),r),f=Rt("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?o.appendChild(f):o.replaceChild(f,o.querySelector(".vjs-icon-placeholder")),o}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}lt.registerComponent("MenuItem",la);class Fr extends la{constructor(e,t){const r=t.track,o=e.textTracks();t.label=r.label||r.language||"Unknown",t.selected=r.mode==="showing",super(e,t),this.track=r,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const f=(...E)=>{this.handleTracksChange.apply(this,E)},p=(...E)=>{this.handleSelectedLanguageChange.apply(this,E)};if(e.on(["loadstart","texttrackchange"],f),o.addEventListener("change",f),o.addEventListener("selectedlanguagechange",p),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],f),o.removeEventListener("change",f),o.removeEventListener("selectedlanguagechange",p)}),o.onchange===void 0){let E;this.on(["tap","click"],function(){if(typeof window.Event!="object")try{E=new window.Event("change")}catch{}E||(E=document.createEvent("Event"),E.initEvent("change",!0,!0)),o.dispatchEvent(E)})}this.handleTracksChange()}handleClick(e){const t=this.track,r=this.player_.textTracks();if(super.handleClick(e),!!r)for(let o=0;o<r.length;o++){const f=r[o];this.kinds.indexOf(f.kind)!==-1&&(f===t?f.mode!=="showing"&&(f.mode="showing"):f.mode!=="disabled"&&(f.mode="disabled"))}}handleTracksChange(e){const t=this.track.mode==="showing";t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if(this.track.mode==="showing"){const t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}lt.registerComponent("TextTrackMenuItem",Fr);class nd extends Fr{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let r=!0;for(let o=0,f=t.length;o<f;o++){const p=t[o];if(this.options_.kinds.indexOf(p.kind)>-1&&p.mode==="showing"){r=!1;break}}r!==this.isSelected_&&this.selected(r)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let r=!0;for(let o=0,f=t.length;o<f;o++){const p=t[o];if(["captions","descriptions","subtitles"].indexOf(p.kind)>-1&&p.mode==="showing"){r=!1;break}}r&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}lt.registerComponent("OffTextTrackMenuItem",nd);class Ba extends Ho{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=Fr){let r;this.label_&&(r=`${this.label_} off`),e.push(new nd(this.player_,{kinds:this.kinds_,kind:this.kind_,label:r})),this.hideThreshold_+=1;const o=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let f=0;f<o.length;f++){const p=o[f];if(this.kinds_.indexOf(p.kind)>-1){const E=new t(this.player_,{track:p,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});E.addClass(`vjs-${p.kind}-menu-item`),e.push(E)}}return e}}lt.registerComponent("TextTrackButton",Ba);class Uu extends la{constructor(e,t){const r=t.track,o=t.cue,f=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=o.text,t.selected=o.startTime<=f&&f<o.endTime,super(e,t),this.track=r,this.cue=o}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}lt.registerComponent("ChaptersTrackMenuItem",Uu);class Vl extends Ba{constructor(e,t,r){super(e,t,r),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(o=>{o.selected(this.track_.activeCues[0]===o.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&e.track.kind!=="chapters")return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const r=e[t];if(r.kind===this.kind_)return r}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(Ri(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let r=0,o=t.length;r<o;r++){const f=t[r],p=new Uu(this.player_,{track:this.track_,cue:f});e.push(p)}return e}}Vl.prototype.kind_="chapters",Vl.prototype.controlText_="Chapters",lt.registerComponent("ChaptersButton",Vl);class Gu extends Ba{constructor(e,t,r){super(e,t,r),this.setIcon("audio-description");const o=e.textTracks(),f=pi(this,this.handleTracksChange);o.addEventListener("change",f),this.on("dispose",function(){o.removeEventListener("change",f)})}handleTracksChange(e){const t=this.player().textTracks();let r=!1;for(let o=0,f=t.length;o<f;o++){const p=t[o];if(p.kind!==this.kind_&&p.mode==="showing"){r=!0;break}}r?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}Gu.prototype.kind_="descriptions",Gu.prototype.controlText_="Descriptions",lt.registerComponent("DescriptionsButton",Gu);class Vu extends Ba{constructor(e,t,r){super(e,t,r),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}Vu.prototype.kind_="subtitles",Vu.prototype.controlText_="Subtitles",lt.registerComponent("SubtitlesButton",Vu);class Hl extends Fr{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}lt.registerComponent("CaptionSettingsMenuItem",Hl);class $n extends Ba{constructor(e,t,r){super(e,t,r),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Hl(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}$n.prototype.kind_="captions",$n.prototype.controlText_="Captions",lt.registerComponent("CaptionsButton",$n);class jo extends Fr{createEl(e,t,r){const o=super.createEl(e,t,r),f=o.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",o):f.appendChild(Rt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),f.appendChild(Rt("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),o}}lt.registerComponent("SubsCapsMenuItem",jo);class Ko extends Ba{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(Ri(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new Hl(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,jo),e}}Ko.prototype.kinds_=["captions","subtitles"],Ko.prototype.controlText_="Subtitles",lt.registerComponent("SubsCapsButton",Ko);class sd extends la{constructor(e,t){const r=t.track,o=e.audioTracks();t.label=r.label||r.language||"Unknown",t.selected=r.enabled,super(e,t),this.track=r,this.addClass(`vjs-${r.kind}-menu-item`);const f=(...p)=>{this.handleTracksChange.apply(this,p)};o.addEventListener("change",f),this.on("dispose",()=>{o.removeEventListener("change",f)})}createEl(e,t,r){const o=super.createEl(e,t,r),f=o.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(f.appendChild(Rt("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),f.appendChild(Rt("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),o}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const t=this.player_.audioTracks();for(let r=0;r<t.length;r++){const o=t[r];o!==this.track&&(o.enabled=o===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}lt.registerComponent("AudioTrackMenuItem",sd);class jl extends Ho{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let r=0;r<t.length;r++){const o=t[r];e.push(new sd(this.player_,{track:o,selectable:!0,multiSelectable:!1}))}return e}}jl.prototype.controlText_="Audio Track",lt.registerComponent("AudioTrackButton",jl);class Ps extends la{constructor(e,t){const r=t.rate,o=parseFloat(r,10);t.label=r,t.selected=o===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=r,this.rate=o,this.on(e,"ratechange",f=>this.update(f))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}Ps.prototype.contentElType="button",lt.registerComponent("PlaybackRateMenuItem",Ps);class ad extends oa{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",r=>this.updateVisibility(r)),this.on(e,"ratechange",r=>this.updateLabel(r)),this.on(e,"playbackrateschange",r=>this.handlePlaybackRateschange(r))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Rt("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let r=e.length-1;r>=0;r--)t.push(new Ps(this.player(),{rate:e[r]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}ad.prototype.controlText_="Playback Rate",lt.registerComponent("PlaybackRateMenuButton",ad);class od extends lt{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},r={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,r)}}lt.registerComponent("Spacer",od);class ld extends od{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:"\xA0"})}}lt.registerComponent("CustomControlSpacer",ld);class ud extends lt{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}ud.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},lt.registerComponent("ControlBar",ud);class qo extends Cs{constructor(e,t){super(e,t),this.on(e,"error",r=>{this.open(r)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}qo.prototype.options_=Object.assign({},Cs.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),lt.registerComponent("ErrorDisplay",qo);class cd extends lt{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){return this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim(),Rt("select",{id:this.options_.id},{},this.options_.SelectOptions.map(t=>{const r=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${Pr()}`)+"-"+t[1].replace(/\W+/g,""),o=Rt("option",{id:r,value:this.localize(t[0]),textContent:t[1]});return o.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${r}`),o}))}}lt.registerComponent("TextTrackSelect",cd);class Os extends lt{constructor(e,t={}){super(e,t);const r=Rt("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(r);const o=this.options_.selects;for(const f of o){const p=this.options_.selectConfigs[f],E=p.className,N=p.id.replace("%s",this.options_.id_);let $=null;const he=`vjs_select_${Pr()}`;if(this.options_.type==="colors"){$=Rt("span",{className:E});const we=Rt("label",{id:N,className:"vjs-label",textContent:p.label});we.setAttribute("for",he),$.appendChild(we)}const Te=new cd(e,{SelectOptions:p.options,legendId:this.options_.legendId,id:he,labelId:N});this.addChild(Te),this.options_.type==="colors"&&($.appendChild(Te.el()),this.el().appendChild($))}}createEl(){return Rt("fieldset",{className:this.options_.className})}}lt.registerComponent("TextTrackFieldset",Os);class Hu extends lt{constructor(e,t={}){super(e,t);const r=this.options_.textTrackComponentid,o=new Os(e,{id_:r,legendId:`captions-text-legend-${r}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(o);const f=new Os(e,{id_:r,legendId:`captions-background-${r}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(f);const p=new Os(e,{id_:r,legendId:`captions-window-${r}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(p)}createEl(){return Rt("div",{className:"vjs-track-settings-colors"})}}lt.registerComponent("TextTrackSettingsColors",Hu);class ju extends lt{constructor(e,t={}){super(e,t);const r=this.options_.textTrackComponentid,o=new Os(e,{id_:r,legendId:`captions-font-size-${r}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(o);const f=new Os(e,{id_:r,legendId:`captions-edge-style-${r}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(f);const p=new Os(e,{id_:r,legendId:`captions-font-family-${r}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(p)}createEl(){return Rt("div",{className:"vjs-track-settings-font"})}}lt.registerComponent("TextTrackSettingsFont",ju);class dd extends lt{constructor(e,t={}){super(e,t);const r=this.localize("restore all settings to the default values"),o=new Cr(e,{controlText:r,className:"vjs-default-button"});o.el().classList.remove("vjs-control","vjs-button"),o.el().textContent=this.localize("Reset"),this.addChild(o);const f=new Cr(e,{controlText:r,className:"vjs-done-button"});f.el().classList.remove("vjs-control","vjs-button"),f.el().textContent=this.localize("Done"),this.addChild(f)}createEl(){return Rt("div",{className:"vjs-track-settings-controls"})}}lt.registerComponent("TrackSettingsControls",dd);const Ku="vjs-text-track-settings",hd=["#000","Black"],fd=["#00F","Blue"],qu=["#0FF","Cyan"],$u=["#0F0","Green"],Ua=["#F0F","Magenta"],Kl=["#F00","Red"],Wu=["#FFF","White"],pd=["#FF0","Yellow"],zu=["1","Opaque"],ql=["0.5","Semi-Transparent"],gd=["0","Transparent"],ua={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[hd,Wu,Kl,$u,fd,pd,Ua,qu],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[zu,ql,gd],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Wu,hd,Kl,$u,fd,pd,Ua,qu],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:i=>i==="1.00"?null:Number(i)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[zu,ql],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[gd,ql,zu],className:"vjs-window-opacity vjs-opacity"}};ua.windowColor.options=ua.backgroundColor.options;function md(i,e){if(e&&(i=e(i)),i&&i!=="none")return i}function zh(i,e){const t=i.options[i.options.selectedIndex].value;return md(t,e)}function vd(i,e,t){if(e){for(let r=0;r<i.options.length;r++)if(md(i.options[r].value,t)===e){i.selectedIndex=r;break}}}class Yh extends Cs{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=Rt("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),t.persistTextTrackSettings===void 0&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new Hu(e,{textTrackComponentid:this.id_,selectConfigs:ua,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const r=new ju(e,{textTrackComponentid:this.id_,selectConfigs:ua,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(r);const o=new dd(e);this.addChild(o)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),fn(ua,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return Ja(ua,(e,t,r)=>{const o=zh(this.$(t.selector),t.parser);return o!==void 0&&(e[r]=o),e},{})}setValues(e){fn(ua,(t,r)=>{vd(this.$(t.selector),e[r],t.parser)})}setDefaults(){fn(ua,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(window.localStorage.getItem(Ku))}catch(t){zt.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?window.localStorage.setItem(Ku,JSON.stringify(e)):window.localStorage.removeItem(Ku)}catch(t){zt.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}}lt.registerComponent("TextTrackSettings",Yh);class yd extends lt{constructor(e,t){let r=t.ResizeObserver||window.ResizeObserver;t.ResizeObserver===null&&(r=!1);const o=oi({createEl:!r,reportTouchActivity:!1},t);super(e,o),this.ResizeObserver=t.ResizeObserver||window.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=Ei(()=>{this.resizeHandler()},100,!1,this),r?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const f=this.debouncedHandler_;let p=this.unloadListener_=function(){fi(this,"resize",f),fi(this,"unload",p),p=null};yr(this.el_.contentWindow,"unload",p),yr(this.el_.contentWindow,"resize",f)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}lt.registerComponent("ResizeManager",yd);const Xh={trackingThreshold:20,liveTolerance:15};class Qh extends lt{constructor(e,t){const r=oi(Xh,t,{createEl:!1});super(e,r),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=o=>this.handlePlay(o),this.handleFirstTimeupdate_=o=>this.handleFirstTimeupdate(o),this.handleSeeked_=o=>this.handleSeeked(o),this.seekToLiveEdge_=o=>this.seekToLiveEdge(o),this.reset_(),this.on(this.player_,"durationchange",o=>this.handleDurationchange(o)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(window.performance.now().toFixed(4)),r=this.lastTime_===-1?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+r;const o=this.liveCurrentTime(),f=this.player_.currentTime();let p=this.player_.paused()||this.seekedBehindLive_||Math.abs(o-f)>this.options_.liveTolerance;(!this.timeupdateSeen_||o===1/0)&&(p=!1),p!==this.behindLiveEdge_&&(this.behindLiveEdge_=p,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,sn),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let r=e?e.length:0;for(;r--;)t.push(e.end(r));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let r=e?e.length:0;for(;r--;)t.push(e.start(r));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return typeof this.trackingInterval_=="number"}seekToLiveEdge(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}lt.registerComponent("LiveTracker",Qh);class Td extends lt{constructor(e,t){super(e,t),this.on("statechanged",r=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:Rt("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${Pr()}`}),description:Rt("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${Pr()}`})},Rt("div",{className:"vjs-title-bar"},{},Za(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,r={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(o=>{const f=this.state[o],p=this.els[o],E=r[o];Ws(p),f&&ii(p,f),t&&(t.removeAttribute(E),f&&t.setAttribute(E,p.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}lt.registerComponent("TitleBar",Td);const Wn={initialDisplay:4e3,position:[],takeFocus:!1};class Ms extends Cr{constructor(e,t){t=oi(Wn,t),super(e,t),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],r=>{this.removeClass("force-display")})}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map(e=>`vjs-${e}`).join(" ")}`}createEl(){const e=Rt("button",{},{type:"button",class:this.buildCSSClass()},Rt("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}}lt.registerComponent("TransientButton",Ms);const Yu=i=>{const e=i.el();if(e.hasAttribute("src"))return i.triggerSourceset(e.src),!0;const t=i.$$("source"),r=[];let o="";if(!t.length)return!1;for(let f=0;f<t.length;f++){const p=t[f].src;p&&r.indexOf(p)===-1&&r.push(p)}return r.length?(r.length===1&&(o=r[0]),i.triggerSourceset(o),!0):!1},Jh=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(i){const e=document.createElement(this.nodeName.toLowerCase());e.innerHTML=i;const t=document.createDocumentFragment();for(;e.childNodes.length;)t.appendChild(e.childNodes[0]);return this.innerText="",window.Element.prototype.appendChild.call(this,t),this.innerHTML}}),Ed=(i,e)=>{let t={};for(let r=0;r<i.length&&(t=Object.getOwnPropertyDescriptor(i[r],e),!(t&&t.set&&t.get));r++);return t.enumerable=!0,t.configurable=!0,t},Zh=i=>Ed([i.el(),window.HTMLMediaElement.prototype,window.Element.prototype,Jh],"innerHTML"),_d=function(i){const e=i.el();if(e.resetSourceWatch_)return;const t={},r=Zh(i),o=f=>(...p)=>{const E=f.apply(e,p);return Yu(i),E};["append","appendChild","insertAdjacentHTML"].forEach(f=>{e[f]&&(t[f]=e[f],e[f]=o(t[f]))}),Object.defineProperty(e,"innerHTML",oi(r,{set:o(r.set)})),e.resetSourceWatch_=()=>{e.resetSourceWatch_=null,Object.keys(t).forEach(f=>{e[f]=t[f]}),Object.defineProperty(e,"innerHTML",r)},i.one("sourceset",e.resetSourceWatch_)},ef=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?Ds(window.Element.prototype.getAttribute.call(this,"src")):""},set(i){return window.Element.prototype.setAttribute.call(this,"src",i),i}}),Ga=i=>Ed([i.el(),window.HTMLMediaElement.prototype,ef],"src"),bd=function(i){if(!i.featuresSourceset)return;const e=i.el();if(e.resetSourceset_)return;const t=Ga(i),r=e.setAttribute,o=e.load;Object.defineProperty(e,"src",oi(t,{set:f=>{const p=t.set.call(e,f);return i.triggerSourceset(e.src),p}})),e.setAttribute=(f,p)=>{const E=r.call(e,f,p);return/src/i.test(f)&&i.triggerSourceset(e.src),E},e.load=()=>{const f=o.call(e);return Yu(i)||(i.triggerSourceset(""),_d(i)),f},e.currentSrc?i.triggerSourceset(e.currentSrc):Yu(i)||_d(i),e.resetSourceset_=()=>{e.resetSourceset_=null,e.load=o,e.setAttribute=r,Object.defineProperty(e,"src",t),e.resetSourceWatch_&&e.resetSourceWatch_()}};class xt extends Lt{constructor(e,t){super(e,t);const r=e.source;let o=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&this.el_.tagName==="VIDEO",r&&(this.el_.currentSrc!==r.src||e.tag&&e.tag.initNetworkState_===3)?this.setSource(r):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const f=this.el_.childNodes;let p=f.length;const E=[];for(;p--;){const N=f[p];N.nodeName.toLowerCase()==="track"&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(N),this.remoteTextTracks().addTrack(N.track),this.textTracks().addTrack(N.track),!o&&!this.el_.hasAttribute("crossorigin")&&ra(N.src)&&(o=!0)):E.push(N))}for(let N=0;N<E.length;N++)this.el_.removeChild(E[N])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&o&&zt.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),this.restoreMetadataTracksInIOSNativePlayer_(),(ti||ba)&&e.nativeControlsForTouch===!0&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),xt.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){bd(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const r=()=>{t=[];for(let f=0;f<e.length;f++){const p=e[f];p.kind==="metadata"&&t.push({track:p,storedMode:p.mode})}};r(),e.addEventListener("change",r),this.on("dispose",()=>e.removeEventListener("change",r));const o=()=>{for(let f=0;f<t.length;f++){const p=t[f];p.track.mode==="disabled"&&p.track.mode!==p.storedMode&&(p.track.mode=p.storedMode)}e.removeEventListener("change",o)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",r),e.removeEventListener("change",o),e.addEventListener("change",o)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",r),e.addEventListener("change",r),e.removeEventListener("change",o)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const r=e.toLowerCase();this[`${r}TracksListeners_`]&&Object.keys(this[`${r}TracksListeners_`]).forEach(o=>{this.el()[`${r}Tracks`].removeEventListener(o,this[`${r}TracksListeners_`][o])}),this[`featuresNative${e}Tracks`]=!t,this[`${r}TracksListeners_`]=null,this.proxyNativeTracksForType_(r)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=w[e],r=this.el()[t.getterName],o=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!r||!r.addEventListener)return;const f={change:E=>{const N={type:"change",target:o,currentTarget:o,srcElement:o};o.trigger(N),e==="text"&&this[P.remoteText.getterName]().trigger(N)},addtrack(E){o.addTrack(E.track)},removetrack(E){o.removeTrack(E.track)}},p=function(){const E=[];for(let N=0;N<o.length;N++){let $=!1;for(let he=0;he<r.length;he++)if(r[he]===o[N]){$=!0;break}$||E.push(o[N])}for(;E.length;)o.removeTrack(E.shift())};this[t.getterName+"Listeners_"]=f,Object.keys(f).forEach(E=>{const N=f[E];r.addEventListener(E,N),this.on("dispose",$=>r.removeEventListener(E,N))}),this.on("loadstart",p),this.on("dispose",E=>this.off("loadstart",p))}proxyNativeTracks_(){w.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){const r=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(r,e),xt.disposeMediaElement(e),e=r}else{e=document.createElement("video");const r=this.options_.tag&&wn(this.options_.tag),o=oi({},r);(!ti||this.options_.nativeControlsForTouch!==!0)&&delete o.controls,Ts(e,Object.assign(o,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&Es(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let r=0;r<t.length;r++){const o=t[r],f=this.options_[o];typeof f<"u"&&(f?Es(e,o,o):lr(e,o),e[o]=f)}return e}handleLateInit_(e){if(e.networkState===0||e.networkState===3)return;if(e.readyState===0){let r=!1;const o=function(){r=!0};this.on("loadstart",o);const f=function(){r||this.trigger("loadstart")};this.on("loadedmetadata",f),this.ready(function(){this.off("loadstart",o),this.off("loadedmetadata",f),r||this.trigger("loadstart")});return}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(r){this.trigger(r)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&gs?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){zt(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&_e&&_t&&this.el_.currentTime===0){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return typeof this.el_.webkitEnterFullScreen=="function"}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)Wr(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(e===void 0)return this.el_.src;this.setSrc(e)}reset(){xt.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,r){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,r):super.addTextTrack(e,t,r)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=document.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const r=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(r),r}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let r=t.length;for(;r--;)(e===t[r]||e===t[r].track)&&this.el().removeChild(t[r])}}getVideoPlaybackQuality(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();const e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),window.performance&&(e.creationTime=window.performance.now()),e}}pn(xt,"TEST_VID",function(){if(!gn())return;const i=document.createElement("video"),e=document.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",i.appendChild(e),i}),xt.isSupported=function(){try{xt.TEST_VID.volume=.5}catch{return!1}return!!(xt.TEST_VID&&xt.TEST_VID.canPlayType)},xt.canPlayType=function(i){return xt.TEST_VID.canPlayType(i)},xt.canPlaySource=function(i,e){return xt.canPlayType(i.type)},xt.canControlVolume=function(){try{const i=xt.TEST_VID.volume;xt.TEST_VID.volume=i/2+.1;const e=i!==xt.TEST_VID.volume;return e&&Gi?(window.setTimeout(()=>{xt&&xt.prototype&&(xt.prototype.featuresVolumeControl=i!==xt.TEST_VID.volume)}),!1):e}catch{return!1}},xt.canMuteVolume=function(){try{const i=xt.TEST_VID.muted;return xt.TEST_VID.muted=!i,xt.TEST_VID.muted?Es(xt.TEST_VID,"muted","muted"):lr(xt.TEST_VID,"muted","muted"),i!==xt.TEST_VID.muted}catch{return!1}},xt.canControlPlaybackRate=function(){if(_e&&_t&&Ks<58)return!1;try{const i=xt.TEST_VID.playbackRate;return xt.TEST_VID.playbackRate=i/2+.1,i!==xt.TEST_VID.playbackRate}catch{return!1}},xt.canOverrideAttributes=function(){try{const i=()=>{};Object.defineProperty(document.createElement("video"),"src",{get:i,set:i}),Object.defineProperty(document.createElement("audio"),"src",{get:i,set:i}),Object.defineProperty(document.createElement("video"),"innerHTML",{get:i,set:i}),Object.defineProperty(document.createElement("audio"),"innerHTML",{get:i,set:i})}catch{return!1}return!0},xt.supportsNativeTextTracks=function(){return gs||Gi&&_t},xt.supportsNativeVideoTracks=function(){return!!(xt.TEST_VID&&xt.TEST_VID.videoTracks)},xt.supportsNativeAudioTracks=function(){return!!(xt.TEST_VID&&xt.TEST_VID.audioTracks)},xt.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([i,e]){pn(xt.prototype,i,()=>xt[e](),!0)}),xt.prototype.featuresVolumeControl=xt.canControlVolume(),xt.prototype.movingMediaElementInDOM=!Gi,xt.prototype.featuresFullscreenResize=!0,xt.prototype.featuresProgressEvents=!0,xt.prototype.featuresTimeupdateEvents=!0,xt.prototype.featuresVideoFrameCallback=!!(xt.TEST_VID&&xt.TEST_VID.requestVideoFrameCallback),xt.disposeMediaElement=function(i){if(i){for(i.parentNode&&i.parentNode.removeChild(i);i.hasChildNodes();)i.removeChild(i.firstChild);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()}},xt.resetMediaElement=function(i){if(!i)return;const e=i.querySelectorAll("source");let t=e.length;for(;t--;)i.removeChild(e[t]);i.removeAttribute("src"),typeof i.load=="function"&&function(){try{i.load()}catch{}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(i){xt.prototype[i]=function(){return this.el_[i]||this.el_.hasAttribute(i)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(i){xt.prototype["set"+Ri(i)]=function(e){this.el_[i]=e,e?this.el_.setAttribute(i,i):this.el_.removeAttribute(i)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(i){xt.prototype[i]=function(){return this.el_[i]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(i){xt.prototype["set"+Ri(i)]=function(e){this.el_[i]=e}}),["pause","load","play"].forEach(function(i){xt.prototype[i]=function(){return this.el_[i]()}}),Lt.withSourceHandlers(xt),xt.nativeSourceHandler={},xt.nativeSourceHandler.canPlayType=function(i){try{return xt.TEST_VID.canPlayType(i)}catch{return""}},xt.nativeSourceHandler.canHandleSource=function(i,e){if(i.type)return xt.nativeSourceHandler.canPlayType(i.type);if(i.src){const t=Or(i.src);return xt.nativeSourceHandler.canPlayType(`video/${t}`)}return""},xt.nativeSourceHandler.handleSource=function(i,e,t){e.setSrc(i.src)},xt.nativeSourceHandler.dispose=function(){},xt.registerSourceHandler(xt.nativeSourceHandler),Lt.registerTech("Html5",xt);const Ad=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],$o={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},$l=["tiny","xsmall","small","medium","large","xlarge","huge"],Wo={};$l.forEach(i=>{const e=i.charAt(0)==="x"?`x-${i.substring(1)}`:i;Wo[i]=`vjs-layout-${e}`});const Wl={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class Pi extends lt{constructor(e,t,r){if(e.id=e.id||t.id||`vjs_video_${Pr()}`,t=Object.assign(Pi.getTagSettings(e),t),t.initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const p=e.closest("[lang]");p&&(t.language=p.getAttribute("lang"))}if(super(null,t,r),this.boundDocumentFullscreenChange_=p=>this.documentFullscreenChange_(p),this.boundFullWindowOnEscKey_=p=>this.fullWindowOnEscKey(p),this.boundUpdateStyleEl_=p=>this.updateStyleEl_(p),this.boundApplyInitTime_=p=>this.applyInitTime_(p),this.boundUpdateCurrentBreakpoint_=p=>this.updateCurrentBreakpoint_(p),this.boundHandleTechClick_=p=>this.handleTechClick_(p),this.boundHandleTechDoubleClick_=p=>this.handleTechDoubleClick_(p),this.boundHandleTechTouchStart_=p=>this.handleTechTouchStart_(p),this.boundHandleTechTouchMove_=p=>this.handleTechTouchMove_(p),this.boundHandleTechTouchEnd_=p=>this.handleTechTouchEnd_(p),this.boundHandleTechTap_=p=>this.handleTechTap_(p),this.boundUpdatePlayerHeightOnAudioOnlyMode_=p=>this.updatePlayerHeightOnAudioOnlyMode_(p),this.isFullscreen_=!1,this.log=_a(this.id_),this.fsApi_=ri,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&wn(e),this.language(this.options_.language),t.languages){const p={};Object.getOwnPropertyNames(t.languages).forEach(function(E){p[E.toLowerCase()]=t.languages[E]}),this.languages_=p}else this.languages_=Pi.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(p=>{if(typeof this[p]!="function")throw new Error(`plugin "${p}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),oo(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(yr(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const o=oi(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach(p=>{this[p](t.plugins[p])}),t.debug&&this.debug(!0),this.options_.playerOptions=o,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const E=new window.DOMParser().parseFromString(Uo,"image/svg+xml");if(E.querySelector("parsererror"))zt.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const $=E.documentElement;$.style.display="none",this.el_.appendChild($),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio(e.nodeName.toLowerCase()==="audio"),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),t.spatialNavigation&&t.spatialNavigation.enabled&&(this.spatialNavigation=new Pl(this),this.addClass("vjs-spatial-navigation-enabled")),ti&&this.addClass("vjs-touch-enabled"),Gi||this.addClass("vjs-workinghover"),Pi.players[this.id_]=this;const f=Un.split(".")[0];this.addClass(`vjs-v${f}`),this.userActive(!0),this.reportUserActivity(),this.one("play",p=>this.listenForUserActivity_(p)),this.on("keydown",p=>this.handleKeyDown(p)),this.on("languagechange",p=>this.handleLanguagechange(p)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),fi(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),fi(document,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),Pi.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),ht(this),_.names.forEach(e=>{const t=_[e],r=this[t.getterName]();r&&r.off&&r.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e=this.tag,t,r=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player");const o=this.tag.tagName.toLowerCase()==="video-js";r?t=this.el_=e.parentNode:o||(t=this.el_=super.createEl("div"));const f=wn(e);if(o){for(t=this.el_=e,e=this.tag=document.createElement("video");t.children.length;)e.appendChild(t.firstChild);ys(t,"video-js")||Gt(t,"video-js"),t.appendChild(e),r=this.playerElIngest_=t,Object.keys(t).forEach(N=>{try{e[N]=t[N]}catch{}})}e.setAttribute("tabindex","-1"),f.tabindex="-1",_t&&$s&&(e.setAttribute("role","application"),f.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in f&&delete f.width,"height"in f&&delete f.height,Object.getOwnPropertyNames(f).forEach(function(N){o&&N==="class"||t.setAttribute(N,f[N]),o&&e.setAttribute(N,f[N])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=t.player=this,this.addClass("vjs-paused");const p=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(N=>ko[N]).map(N=>"vjs-device-"+N.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...p),window.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=Wi("vjs-styles-dimensions");const N=jr(".vjs-styles-defaults"),$=jr("head");$.insertBefore(this.styleEl_,N?N.nextSibling:$.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const E=e.getElementsByTagName("a");for(let N=0;N<E.length;N++){const $=E.item(N);Gt($,"vjs-hidden"),$.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!r&&e.parentNode.insertBefore(t,e),gr(e,t),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t}crossOrigin(e){if(typeof e>"u")return this.techGet_("crossOrigin");if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){zt.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const r=e+"_";if(t===void 0)return this[r]||0;if(t===""||t==="auto"){this[r]=void 0,this.updateStyleEl_();return}const o=parseFloat(t);if(isNaN(o)){zt.error(`Improper value "${t}" supplied for for ${e}`);return}this[r]=o,this.updateStyleEl_()}fluid(e){if(e===void 0)return!!this.fluid_;this.fluid_=!!e,on(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),_l(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(window.VIDEOJS_NO_DYNAMIC_STYLE===!0){const E=typeof this.width_=="number"?this.width_:this.options_.width,N=typeof this.height_=="number"?this.height_:this.options_.height,$=this.tech_&&this.tech_.el();$&&(E>=0&&($.width=E),N>=0&&($.height=N));return}let e,t,r,o;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?r=this.aspectRatio_:this.videoWidth()>0?r=this.videoWidth()+":"+this.videoHeight():r="16:9";const f=r.split(":"),p=f[1]/f[0];this.width_!==void 0?e=this.width_:this.height_!==void 0?e=this.height_/p:e=this.videoWidth()||300,this.height_!==void 0?t=this.height_:t=e*p,/^[^a-zA-Z]/.test(this.id())?o="dimensions-"+this.id():o=this.id()+"-dimensions",this.addClass(o),wo(this.styleEl_,`
      .${o} {
        width: ${e}px;
        height: ${t}px;
      }

      .${o}.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: ${p*100}%;
      }
    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const r=Ri(e),o=e.charAt(0).toLowerCase()+e.slice(1);r!=="Html5"&&this.tag&&(Lt.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=r,this.isReady_=!1;let f=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(f=!1);const p={source:t,autoplay:f,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${o}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};_.names.forEach(N=>{const $=_[N];p[$.getterName]=this[$.privateName]}),Object.assign(p,this.options_[r]),Object.assign(p,this.options_[o]),Object.assign(p,this.options_[e.toLowerCase()]),this.tag&&(p.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(p.startTime=this.cache_.currentTime);const E=Lt.getTech(e);if(!E)throw new Error(`No Tech named '${r}' exists! '${r}' should be registered using videojs.registerTech()'`);this.tech_=new E(p),this.tech_.ready(pi(this,this.handleTechReady_),!0),Sl.jsonToTextTracks(this.textTracksJson_||[],this.tech_),Ad.forEach(N=>{this.on(this.tech_,N,$=>this[`handleTech${Ri(N)}_`]($))}),Object.keys($o).forEach(N=>{this.on(this.tech_,N,$=>{if(this.tech_.playbackRate()===0&&this.tech_.seeking()){this.queuedCallbacks_.push({callback:this[`handleTech${$o[N]}_`].bind(this),event:$});return}this[`handleTech${$o[N]}_`]($)})}),this.on(this.tech_,"loadstart",N=>this.handleTechLoadStart_(N)),this.on(this.tech_,"sourceset",N=>this.handleTechSourceset_(N)),this.on(this.tech_,"waiting",N=>this.handleTechWaiting_(N)),this.on(this.tech_,"ended",N=>this.handleTechEnded_(N)),this.on(this.tech_,"seeking",N=>this.handleTechSeeking_(N)),this.on(this.tech_,"play",N=>this.handleTechPlay_(N)),this.on(this.tech_,"pause",N=>this.handleTechPause_(N)),this.on(this.tech_,"durationchange",N=>this.handleTechDurationChange_(N)),this.on(this.tech_,"fullscreenchange",(N,$)=>this.handleTechFullscreenChange_(N,$)),this.on(this.tech_,"fullscreenerror",(N,$)=>this.handleTechFullscreenError_(N,$)),this.on(this.tech_,"enterpictureinpicture",N=>this.handleTechEnterPictureInPicture_(N)),this.on(this.tech_,"leavepictureinpicture",N=>this.handleTechLeavePictureInPicture_(N)),this.on(this.tech_,"error",N=>this.handleTechError_(N)),this.on(this.tech_,"posterchange",N=>this.handleTechPosterChange_(N)),this.on(this.tech_,"textdata",N=>this.handleTechTextData_(N)),this.on(this.tech_,"ratechange",N=>this.handleTechRateChange_(N)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(r!=="Html5"||!this.tag)&&gr(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){_.names.forEach(e=>{const t=_[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=Sl.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return e===void 0&&zt.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_}version(){return{"video.js":Un}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||typeof e!="string")return;const t=()=>{const o=this.muted();this.muted(!0);const f=()=>{this.muted(o)};this.playTerminatedQueue_.push(f);const p=this.play();if(Ji(p))return p.catch(E=>{throw f(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${E||""}`)})};let r;if(e==="any"&&!this.muted()?(r=this.play(),Ji(r)&&(r=r.catch(t))):e==="muted"&&!this.muted()?r=t():r=this.play(),!!Ji(r))return r.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})})}updateSourceCaches_(e=""){let t=e,r="";typeof t!="string"&&(t=e.src,r=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!r&&(r=Bo(this,t)),this.cache_.source=oi({},e,{src:t,type:r});const o=this.cache_.sources.filter(N=>N.src&&N.src===t),f=[],p=this.$$("source"),E=[];for(let N=0;N<p.length;N++){const $=wn(p[N]);f.push($),$.src&&$.src===t&&E.push($.src)}E.length&&!o.length?this.cache_.sources=f:o.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=f=>this.updateSourceCaches_(f);const r=this.currentSource().src,o=e.src;r&&!/^blob:/.test(r)&&/^blob:/.test(o)&&(!this.lastSource_||this.lastSource_.tech!==o&&this.lastSource_.player!==r)&&(t=()=>{}),t(o),e.src||this.tech_.any(["sourceset","loadstart"],f=>{if(f.type==="sourceset")return;const p=this.techGet_("currentSrc");this.lastSource_.tech=p,this.updateSourceCaches_(p)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?Wr(this.play()):this.pause())}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),r=>r.contains(e.target))||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const r=this.el();let o=document[this.fsApi_.fullscreenElement]===r;!o&&r.matches&&(o=r.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(o)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in Na)return sa(this.middleware_,this.tech_,e,t);if(e in Rs)return Is(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(r){throw zt(r),r}},!0)}techGet_(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in qn)return zr(this.middleware_,this.tech_,e);if(e in Rs)return Is(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw this.tech_[e]===void 0?(zt(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t):t.name==="TypeError"?(zt(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t):(zt(t),t)}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=Wr){this.playCallbacks_.push(e);const t=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),r=!!(gs||Gi);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t){this.waitToPlay_=p=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!t&&r&&this.load();return}const o=this.techGet_("play");r&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),o===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(o)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(t){t()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(r){r(e)})}pause(){this.techCall_("pause")}paused(){return this.techGet_("paused")!==!1}played(){return this.techGet_("played")||$r(0,0)}scrubbing(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){if(e===void 0)return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime;if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0,isFinite(e)&&(this.cache_.currentTime=Number(e))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return(!e||!e.length)&&(e=$r(0,0)),e}seekable(){let e=this.techGet_("seekable");return(!e||!e.length)&&(e=$r(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return ia(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let r=e.end(e.length-1);return r>t&&(r=t),r}volume(e){let t;if(e!==void 0){t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),t>0&&this.lastVolume_(t);return}return t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t}muted(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1}defaultMuted(e){return e!==void 0&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(e!==void 0){const t=this.isFullscreen_;this.isFullscreen_=!!e,this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((r,o)=>{function f(){t.off("fullscreenerror",E),t.off("fullscreenchange",p)}function p(){f(),r()}function E($,he){f(),o(he)}t.one("fullscreenchange",p),t.one("fullscreenerror",E);const N=t.requestFullscreenHelper_(e);N&&(N.then(f,f),N.then(r,o))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(t=e)),this.fsApi_.requestFullscreen){const r=this.el_[this.fsApi_.requestFullscreen](t);return r&&r.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),r}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,r)=>{function o(){e.off("fullscreenerror",p),e.off("fullscreenchange",f)}function f(){o(),t()}function p(N,$){o(),r($)}e.one("fullscreenchange",f),e.one("fullscreenerror",p);const E=e.exitFullscreenHelper_();E&&(E.then(o,o),E.then(t,r))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=document[this.fsApi_.exitFullscreen]();return e&&Wr(e.then(()=>this.isFullscreen(!1))),e}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,yr(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow="hidden",Gt(document.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){e.key==="Escape"&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,fi(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow=this.docOrigOverflow,Aa(document.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&window.documentPictureInPicture){const e=document.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(Rt("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),window.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>(Vi(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",r=>{const o=r.target.querySelector(".video-js");e.parentNode.replaceChild(o,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in document&&this.disablePictureInPicture()===!1?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){if(window.documentPictureInPicture&&window.documentPictureInPicture.window)return window.documentPictureInPicture.window.close(),Promise.resolve();if("pictureInPictureEnabled"in document)return document.exitPictureInPicture()}handleKeyDown(e){const{userActions:t}=this.options_;!t||!t.hotkeys||(o=>{const f=o.tagName.toLowerCase();if(o.isContentEditable)return!0;const p=["button","checkbox","hidden","radio","reset","submit"];return f==="input"?p.indexOf(o.type)===-1:["textarea"].indexOf(f)!==-1})(this.el_.ownerDocument.activeElement)||(typeof t.hotkeys=="function"?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:r=p=>e.key.toLowerCase()==="f",muteKey:o=p=>e.key.toLowerCase()==="m",playPauseKey:f=p=>e.key.toLowerCase()==="k"||e.key.toLowerCase()===" "}=t;if(r.call(this,e)){e.preventDefault(),e.stopPropagation();const p=lt.getComponent("FullscreenToggle");document[this.fsApi_.fullscreenEnabled]!==!1&&p.prototype.handleClick.call(this,e)}else o.call(this,e)?(e.preventDefault(),e.stopPropagation(),lt.getComponent("MuteToggle").prototype.handleClick.call(this,e)):f.call(this,e)&&(e.preventDefault(),e.stopPropagation(),lt.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let r=0,o=this.options_.techOrder;r<o.length;r++){const f=o[r];let p=Lt.getTech(f);if(p||(p=lt.getComponent(f)),!p){zt.error(`The "${f}" tech is undefined. Skipped browser support check for that tech.`);continue}if(p.isSupported()&&(t=p.canPlayType(e),t))return t}return""}selectSource(e){const t=this.options_.techOrder.map(E=>[E,Lt.getTech(E)]).filter(([E,N])=>N?N.isSupported():(zt.error(`The "${E}" tech is undefined. Skipped browser support check for that tech.`),!1)),r=function(E,N,$){let he;return E.some(Te=>N.some(we=>{if(he=$(Te,we),he)return!0})),he};let o;const f=E=>(N,$)=>E($,N),p=([E,N],$)=>{if(N.canPlaySource($,this.options_[E.toLowerCase()]))return{source:$,tech:E}};return this.options_.sourceOrder?o=r(e,t,f(p)):o=r(t,e,p),o||!1}handleSrc_(e,t){if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const r=Rl(e);if(!r.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,t||(this.cache_.sources=r),this.updateSourceCaches_(r[0]),Oa(this,r[0],(o,f)=>{if(this.middleware_=f,t||(this.cache_.sources=r),this.updateSourceCaches_(o),this.src_(o)){if(r.length>1)return this.handleSrc_(r.slice(1));this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),this.triggerReady();return}Ma(f,this.tech_)}),r.length>1){const o=()=>{this.error(null),this.handleSrc_(r.slice(1),!0)},f=()=>{this.off("error",o)};this.one("error",o),this.one("playing",f),this.resetRetryOnError_=()=>{this.off("error",o),this.off("playing",f)}}}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return t?Al(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1):!0}load(){if(this.tech_&&this.tech_.vhs){this.src(this.currentSource());return}this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();Wr(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),on(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:r,remainingTimeDisplay:o}=this.controlBar||{},{seekBar:f}=r||{};e&&e.updateContent(),t&&t.updateContent(),o&&o.updateContent(),f&&(f.update(),f.loadProgressBar&&f.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return Object.keys(e).length!==0&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")}autoplay(e){if(e===void 0)return this.options_.autoplay||!1;let t;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),t=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,t=typeof t>"u"?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return e!==void 0&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")}poster(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(e===void 0)return this.error_||null;if(Hr("beforeerror").forEach(t=>{const r=t(this,e);if(!(pr(r)&&!Array.isArray(r)||typeof r=="string"||typeof r=="number"||r===null)){this.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=r}),this.options_.suppressNotSupportedError&&e&&e.code===4){const t=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),this.one("loadstart",function(){this.off(["click","touchstart"],t)});return}if(e===null){this.error_=null,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new wi(e),this.addClass("vjs-error"),zt.error(`(CODE:${this.error_.code} ${wi.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),Hr("error").forEach(t=>t(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,r;const o=pi(this,this.reportUserActivity),f=function(Te){(Te.screenX!==t||Te.screenY!==r)&&(t=Te.screenX,r=Te.screenY,o())},p=function(){o(),this.clearInterval(e),e=this.setInterval(o,250)},E=function(Te){o(),this.clearInterval(e)};this.on("mousedown",p),this.on("mousemove",f),this.on("mouseup",E),this.on("mouseleave",E);const N=this.getChild("controlBar");N&&!Gi&&!_e&&(N.on("mouseenter",function(Te){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),N.on("mouseleave",function(Te){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",o),this.on("keyup",o);let $;const he=function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout($);const Te=this.options_.inactivityTimeout;Te<=0||($=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},Te))};this.setInterval(he,250)}playbackRate(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1}defaultPlaybackRate(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");!e||this.audioOnlyCache_.controlBarHeight===e.currentHeight()||(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),r=t&&t.currentHeight();e.forEach(o=>{o!==t&&o.el_&&!o.hasClass("vjs-hidden")&&(o.hide(),this.audioOnlyCache_.hiddenChildren.push(o))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=r,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(r),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const t=[];return this.isInPictureInPicture()&&t.push(this.exitPictureInPicture()),this.isFullscreen()&&t.push(this.exitFullscreen()),this.audioPosterMode()&&t.push(this.audioPosterMode(!1)),Promise.all(t).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return typeof e!="boolean"||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.disablePosterModeUI_()}))}addTextTrack(e,t,r){if(this.tech_)return this.tech_.addTextTrack(e,t,r)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),on(this)&&this.trigger("languagechange"))}languages(){return oi(Pi.prototype.options_.languages,this.languages_)}toJSON(){const e=oi(this.options_),t=e.tracks;e.tracks=[];for(let r=0;r<t.length;r++){let o=t[r];o=oi(o),o.player=void 0,e.tracks[r]=o}return e}createModal(e,t){t=t||{},t.content=e||"";const r=new Cs(this,t);return this.addChild(r),r.on("dispose",()=>{this.removeChild(r)}),r.open(),r}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let r=0;r<$l.length;r++){const o=$l[r],f=this.breakpoints_[o];if(t<=f){if(e===o)return;e&&this.removeClass(Wo[e]),this.addClass(Wo[o]),this.breakpoint_=o;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return e===void 0?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},Wl,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(e===void 0)return this.responsive_;e=!!e;const t=this.responsive_;if(e!==t)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return Wo[this.breakpoint_]||""}loadMedia(e,t){if(!e||typeof e!="object")return;const r=this.crossOrigin();this.reset(),this.cache_.media=oi(e);const{artist:o,artwork:f,description:p,poster:E,src:N,textTracks:$,title:he}=this.cache_.media;!f&&E&&(this.cache_.media.artwork=[{src:E,type:Yr(E)}]),r&&this.crossOrigin(r),N&&this.src(N),E&&this.poster(E),Array.isArray($)&&$.forEach(Te=>this.addRemoteTextTrack(Te,!1)),this.titleBar&&this.titleBar.update({title:he,description:p||o||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t=this.currentSources(),r=Array.prototype.map.call(this.remoteTextTracks(),f=>({kind:f.kind,label:f.label,language:f.language,src:f.src})),o={src:t,textTracks:r};return e&&(o.poster=e,o.artwork=[{src:o.poster,type:Yr(o.poster)}]),o}return oi(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},r=wn(e),o=r["data-setup"];if(ys(e,"vjs-fill")&&(r.fill=!0),ys(e,"vjs-fluid")&&(r.fluid=!0),o!==null)try{Object.assign(r,JSON.parse(o||"{}"))}catch(f){zt.error("data-setup",f)}if(Object.assign(t,r),e.hasChildNodes()){const f=e.childNodes;for(let p=0,E=f.length;p<E;p++){const N=f[p],$=N.nodeName.toLowerCase();$==="source"?t.sources.push(wn(N)):$==="track"&&t.tracks.push(wn(N))}}return t}debug(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(t=>typeof t=="number")&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}_.names.forEach(function(i){const e=_[i];Pi.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}}),Pi.prototype.crossorigin=Pi.prototype.crossOrigin,Pi.players={};const zo=window.navigator;Pi.prototype.options_={techOrder:Lt.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:zo&&(zo.languages&&zo.languages[0]||zo.userLanguage||zo.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1},Ad.forEach(function(i){Pi.prototype[`handleTech${Ri(i)}_`]=function(){return this.trigger(i)}}),lt.registerComponent("Player",Pi);const Va="plugin",ca="activePlugins_",vo={},Yo=i=>vo.hasOwnProperty(i),zl=i=>Yo(i)?vo[i]:void 0,Xu=(i,e)=>{i[ca]=i[ca]||{},i[ca][e]=!0},yo=(i,e,t)=>{const r=(t?"before":"")+"pluginsetup";i.trigger(r,e),i.trigger(r+":"+e.name,e)},Yl=function(i,e){const t=function(){yo(this,{name:i,plugin:e,instance:null},!0);const r=e.apply(this,arguments);return Xu(this,i),yo(this,{name:i,plugin:e,instance:r}),r};return Object.keys(e).forEach(function(r){t[r]=e[r]}),t},Sd=(i,e)=>(e.prototype.name=i,function(...t){yo(this,{name:i,plugin:e,instance:null},!0);const r=new e(this,...t);return this[i]=()=>r,yo(this,r.getEventHash()),r});class Xr{constructor(e){if(this.constructor===Xr)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),oo(this),delete this.trigger,cr(this,this.constructor.defaultState),Xu(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return Tr(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[ca][e]=!1,this.player=this.state=null,t[e]=Sd(e,vo[e])}static isBasic(e){const t=typeof e=="string"?zl(e):e;return typeof t=="function"&&!Xr.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if(typeof e!="string")throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(Yo(e))zt.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(Pi.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if(typeof t!="function")throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return vo[e]=t,e!==Va&&(Xr.isBasic(t)?Pi.prototype[e]=Yl(e,t):Pi.prototype[e]=Sd(e,t)),t}static deregisterPlugin(e){if(e===Va)throw new Error("Cannot de-register base plugin.");Yo(e)&&(delete vo[e],delete Pi.prototype[e])}static getPlugins(e=Object.keys(vo)){let t;return e.forEach(r=>{const o=zl(r);o&&(t=t||{},t[r]=o)}),t}static getPluginVersion(e){const t=zl(e);return t&&t.VERSION||""}}Xr.getPlugin=zl,Xr.BASE_PLUGIN_NAME=Va,Xr.registerPlugin(Va,Xr),Pi.prototype.usingPlugin=function(i){return!!this[ca]&&this[ca][i]===!0},Pi.prototype.hasPlugin=function(i){return!!Yo(i)};function tf(i,e){let t=!1;return function(...r){return t||zt.warn(i),t=!0,e.apply(this,r)}}function zn(i,e,t,r){return tf(`${e} is deprecated and will be removed in ${i}.0; please use ${t} instead.`,r)}var Qu={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};const xd=i=>i.indexOf("#")===0?i.slice(1):i;function it(i,e,t){let r=it.getPlayer(i);if(r)return e&&zt.warn(`Player "${i}" is already initialised. Options will not be applied.`),t&&r.ready(t),r;const o=typeof i=="string"?jr("#"+xd(i)):i;if(!ms(o))throw new TypeError("The element or ID supplied is not valid. (videojs)");const p=("getRootNode"in o?o.getRootNode()instanceof window.ShadowRoot:!1)?o.getRootNode():o.ownerDocument.body;(!o.ownerDocument.defaultView||!p.contains(o))&&zt.warn("The element supplied is not included in the DOM"),e=e||{},e.restoreEl===!0&&(e.restoreEl=(o.parentNode&&o.parentNode.hasAttribute&&o.parentNode.hasAttribute("data-vjs-player")?o.parentNode:o).cloneNode(!0)),Hr("beforesetup").forEach(N=>{const $=N(o,oi(e));if(!pr($)||Array.isArray($)){zt.error("please return an object in beforesetup hooks");return}e=oi(e,$)});const E=lt.getComponent("Player");return r=new E(o,e,t),Hr("setup").forEach(N=>N(r)),r}if(it.hooks_=or,it.hooks=Hr,it.hook=Ii,it.hookOnce=fs,it.removeHook=Ea,window.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&gn()){let i=jr(".vjs-styles-defaults");if(!i){i=Wi("vjs-styles-defaults");const e=jr("head");e&&e.insertBefore(i,e.firstChild),wo(i,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}Rr(1,it),it.VERSION=Un,it.options=Pi.prototype.options_,it.getPlayers=()=>Pi.players,it.getPlayer=i=>{const e=Pi.players;let t;if(typeof i=="string"){const r=xd(i),o=e[r];if(o)return o;t=jr("#"+r)}else t=i;if(ms(t)){const{player:r,playerId:o}=t;if(r||e[o])return r||e[o]}},it.getAllPlayers=()=>Object.keys(Pi.players).map(i=>Pi.players[i]).filter(Boolean),it.players=Pi.players,it.getComponent=lt.getComponent,it.registerComponent=(i,e)=>(Lt.isTech(e)&&zt.warn(`The ${i} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),lt.registerComponent.call(lt,i,e)),it.getTech=Lt.getTech,it.registerTech=Lt.registerTech,it.use=Fo,Object.defineProperty(it,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(it.middleware,"TERMINATOR",{value:tr,writeable:!1,enumerable:!0}),it.browser=ko,it.obj=Ct,it.mergeOptions=zn(9,"videojs.mergeOptions","videojs.obj.merge",oi),it.defineLazyProperty=zn(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",pn),it.bind=zn(9,"videojs.bind","native Function.prototype.bind",pi),it.registerPlugin=Xr.registerPlugin,it.deregisterPlugin=Xr.deregisterPlugin,it.plugin=(i,e)=>(zt.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Xr.registerPlugin(i,e)),it.getPlugins=Xr.getPlugins,it.getPlugin=Xr.getPlugin,it.getPluginVersion=Xr.getPluginVersion,it.addLanguage=function(i,e){return i=(""+i).toLowerCase(),it.options.languages=oi(it.options.languages,{[i]:e}),it.options.languages[i]},it.log=zt,it.createLogger=_a,it.time=xu,it.createTimeRange=zn(9,"videojs.createTimeRange","videojs.time.createTimeRanges",$r),it.createTimeRanges=zn(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",$r),it.formatTime=zn(9,"videojs.formatTime","videojs.time.formatTime",Kn),it.setFormatTime=zn(9,"videojs.setFormatTime","videojs.time.setFormatTime",wa),it.resetFormatTime=zn(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",ta),it.parseUrl=zn(9,"videojs.parseUrl","videojs.url.parseUrl",Ra),it.isCrossOrigin=zn(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",ra),it.EventTarget=_i,it.any=Ca,it.on=yr,it.one=bs,it.off=fi,it.trigger=Tr,it.xhr=z,it.TextTrack=V,it.AudioTrack=M,it.VideoTrack=b,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(i=>{it[i]=function(){return zt.warn(`videojs.${i}() is deprecated; use videojs.dom.${i}() instead`),zs[i].apply(null,arguments)}}),it.computedStyle=zn(9,"videojs.computedStyle","videojs.dom.computedStyle",qr),it.dom=zs,it.fn=Io,it.num=$h,it.str=Tt,it.url=ku,it.Error=Qu,On(function(i,e){/*! @name videojs-contrib-quality-levels @version 4.1.0 @license Apache-2.0 */(function(t,r){i.exports=r(it)})(ns,function(t){function r(he){return he&&typeof he=="object"&&"default"in he?he:{default:he}}var o=r(t);class f{constructor(Te){let we=this;return we.id=Te.id,we.label=we.id,we.width=Te.width,we.height=Te.height,we.bitrate=Te.bandwidth,we.frameRate=Te.frameRate,we.enabled_=Te.enabled,Object.defineProperty(we,"enabled",{get(){return we.enabled_()},set(Me){we.enabled_(Me)}}),we}}class p extends o.default.EventTarget{constructor(){super();let Te=this;return Te.levels_=[],Te.selectedIndex_=-1,Object.defineProperty(Te,"selectedIndex",{get(){return Te.selectedIndex_}}),Object.defineProperty(Te,"length",{get(){return Te.levels_.length}}),Te[Symbol.iterator]=()=>Te.levels_.values(),Te}addQualityLevel(Te){let we=this.getQualityLevelById(Te.id);if(we)return we;const Me=this.levels_.length;return we=new f(Te),""+Me in this||Object.defineProperty(this,Me,{get(){return this.levels_[Me]}}),this.levels_.push(we),this.trigger({qualityLevel:we,type:"addqualitylevel"}),we}removeQualityLevel(Te){let we=null;for(let Me=0,Ge=this.length;Me<Ge;Me++)if(this[Me]===Te){we=this.levels_.splice(Me,1)[0],this.selectedIndex_===Me?this.selectedIndex_=-1:this.selectedIndex_>Me&&this.selectedIndex_--;break}return we&&this.trigger({qualityLevel:Te,type:"removequalitylevel"}),we}getQualityLevelById(Te){for(let we=0,Me=this.length;we<Me;we++){const Ge=this[we];if(Ge.id===Te)return Ge}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}p.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const he in p.prototype.allowedEvents_)p.prototype["on"+he]=null;var E="4.1.0";const N=function(he,Te){const we=he.qualityLevels,Me=new p,Ge=function(){Me.dispose(),he.qualityLevels=we,he.off("dispose",Ge)};return he.on("dispose",Ge),he.qualityLevels=()=>Me,he.qualityLevels.VERSION=E,Me},$=function(he){return N(this,o.default.obj.merge({},he))};return o.default.registerPlugin("qualityLevels",$),$.VERSION=E,$})});var Xl="https://example.com",Ql=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=window.location&&window.location.href||"");var r=/^\/\//.test(e),o=!window.location&&!/\/\//i.test(e);e=new window.URL(e,window.location||Xl);var f=new URL(t,e);return o?f.href.slice(Xl.length):r?f.href.slice(f.protocol.length):f.href},Ju=function(){function i(){this.listeners={}}var e=i.prototype;return e.on=function(r,o){this.listeners[r]||(this.listeners[r]=[]),this.listeners[r].push(o)},e.off=function(r,o){if(!this.listeners[r])return!1;var f=this.listeners[r].indexOf(o);return this.listeners[r]=this.listeners[r].slice(0),this.listeners[r].splice(f,1),f>-1},e.trigger=function(r){var o=this.listeners[r];if(o)if(arguments.length===2)for(var f=o.length,p=0;p<f;++p)o[p].call(this,arguments[1]);else for(var E=Array.prototype.slice.call(arguments,1),N=o.length,$=0;$<N;++$)o[$].apply(this,E)},e.dispose=function(){this.listeners={}},e.pipe=function(r){this.on("data",function(o){r.push(o)})},i}(),Zu=function(e){return window.atob?window.atob(e):Buffer.from(e,"base64").toString("binary")};function ec(i){for(var e=Zu(i),t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}/*! @name m3u8-parser @version 7.2.0 @license Apache-2.0 */class Cd extends Ju{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const rf="	",Jl=function(i){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(i||""),t={};return e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),t},nf=function(){const t="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+t+")")},Dr=function(i){const e={};if(!i)return e;const t=i.split(nf());let r=t.length,o;for(;r--;)t[r]!==""&&(o=/([^=]*)=(.*)/.exec(t[r]).slice(1),o[0]=o[0].replace(/^\s+|\s+$/g,""),o[1]=o[1].replace(/^\s+|\s+$/g,""),o[1]=o[1].replace(/^['"](.*)['"]$/g,"$1"),e[o[0]]=o[1]);return e},tc=i=>{const e=i.split("x"),t={};return e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),t};class kd extends Ju{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,r;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((f,p)=>{const E=p(e);return E===e?f:f.concat([E])},[e]).forEach(f=>{for(let p=0;p<this.customParsers.length;p++)if(this.customParsers[p].call(this,f))return;if(f.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:f.slice(1)});return}if(f=f.replace("\r",""),t=/^#EXTM3U/.exec(f),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(f),t){r={type:"tag",tagType:"inf"},t[1]&&(r.duration=parseFloat(t[1])),t[2]&&(r.title=t[2]),this.trigger("data",r);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(f),t){r={type:"tag",tagType:"targetduration"},t[1]&&(r.duration=parseInt(t[1],10)),this.trigger("data",r);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(f),t){r={type:"tag",tagType:"version"},t[1]&&(r.version=parseInt(t[1],10)),this.trigger("data",r);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(f),t){r={type:"tag",tagType:"media-sequence"},t[1]&&(r.number=parseInt(t[1],10)),this.trigger("data",r);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(f),t){r={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(r.number=parseInt(t[1],10)),this.trigger("data",r);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(f),t){r={type:"tag",tagType:"playlist-type"},t[1]&&(r.playlistType=t[1]),this.trigger("data",r);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(f),t){r=Hi(Jl(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",r);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(f),t){r={type:"tag",tagType:"allow-cache"},t[1]&&(r.allowed=!/NO/.test(t[1])),this.trigger("data",r);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(f),t){if(r={type:"tag",tagType:"map"},t[1]){const p=Dr(t[1]);p.URI&&(r.uri=p.URI),p.BYTERANGE&&(r.byterange=Jl(p.BYTERANGE))}this.trigger("data",r);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(f),t){r={type:"tag",tagType:"stream-inf"},t[1]&&(r.attributes=Dr(t[1]),r.attributes.RESOLUTION&&(r.attributes.RESOLUTION=tc(r.attributes.RESOLUTION)),r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes["FRAME-RATE"]&&(r.attributes["FRAME-RATE"]=parseFloat(r.attributes["FRAME-RATE"])),r.attributes["PROGRAM-ID"]&&(r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10))),this.trigger("data",r);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(f),t){r={type:"tag",tagType:"media"},t[1]&&(r.attributes=Dr(t[1])),this.trigger("data",r);return}if(t=/^#EXT-X-ENDLIST/.exec(f),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(f),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(f),t){r={type:"tag",tagType:"program-date-time"},t[1]&&(r.dateTimeString=t[1],r.dateTimeObject=new Date(t[1])),this.trigger("data",r);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(f),t){r={type:"tag",tagType:"key"},t[1]&&(r.attributes=Dr(t[1]),r.attributes.IV&&(r.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(r.attributes.IV=r.attributes.IV.substring(2)),r.attributes.IV=r.attributes.IV.match(/.{8}/g),r.attributes.IV[0]=parseInt(r.attributes.IV[0],16),r.attributes.IV[1]=parseInt(r.attributes.IV[1],16),r.attributes.IV[2]=parseInt(r.attributes.IV[2],16),r.attributes.IV[3]=parseInt(r.attributes.IV[3],16),r.attributes.IV=new Uint32Array(r.attributes.IV))),this.trigger("data",r);return}if(t=/^#EXT-X-START:(.*)$/.exec(f),t){r={type:"tag",tagType:"start"},t[1]&&(r.attributes=Dr(t[1]),r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]),r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)),this.trigger("data",r);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(f),t){r={type:"tag",tagType:"cue-out-cont"},t[1]?r.data=t[1]:r.data="",this.trigger("data",r);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(f),t){r={type:"tag",tagType:"cue-out"},t[1]?r.data=t[1]:r.data="",this.trigger("data",r);return}if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(f),t){r={type:"tag",tagType:"cue-in"},t[1]?r.data=t[1]:r.data="",this.trigger("data",r);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(f),t&&t[1]){r={type:"tag",tagType:"skip"},r.attributes=Dr(t[1]),r.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(r.attributes["SKIPPED-SEGMENTS"]=parseInt(r.attributes["SKIPPED-SEGMENTS"],10)),r.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(r.attributes["RECENTLY-REMOVED-DATERANGES"]=r.attributes["RECENTLY-REMOVED-DATERANGES"].split(rf)),this.trigger("data",r);return}if(t=/^#EXT-X-PART:(.*)$/.exec(f),t&&t[1]){r={type:"tag",tagType:"part"},r.attributes=Dr(t[1]),["DURATION"].forEach(function(p){r.attributes.hasOwnProperty(p)&&(r.attributes[p]=parseFloat(r.attributes[p]))}),["INDEPENDENT","GAP"].forEach(function(p){r.attributes.hasOwnProperty(p)&&(r.attributes[p]=/YES/.test(r.attributes[p]))}),r.attributes.hasOwnProperty("BYTERANGE")&&(r.attributes.byterange=Jl(r.attributes.BYTERANGE)),this.trigger("data",r);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(f),t&&t[1]){r={type:"tag",tagType:"server-control"},r.attributes=Dr(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(p){r.attributes.hasOwnProperty(p)&&(r.attributes[p]=parseFloat(r.attributes[p]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(p){r.attributes.hasOwnProperty(p)&&(r.attributes[p]=/YES/.test(r.attributes[p]))}),this.trigger("data",r);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(f),t&&t[1]){r={type:"tag",tagType:"part-inf"},r.attributes=Dr(t[1]),["PART-TARGET"].forEach(function(p){r.attributes.hasOwnProperty(p)&&(r.attributes[p]=parseFloat(r.attributes[p]))}),this.trigger("data",r);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(f),t&&t[1]){r={type:"tag",tagType:"preload-hint"},r.attributes=Dr(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(p){if(r.attributes.hasOwnProperty(p)){r.attributes[p]=parseInt(r.attributes[p],10);const E=p==="BYTERANGE-LENGTH"?"length":"offset";r.attributes.byterange=r.attributes.byterange||{},r.attributes.byterange[E]=r.attributes[p],delete r.attributes[p]}}),this.trigger("data",r);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(f),t&&t[1]){r={type:"tag",tagType:"rendition-report"},r.attributes=Dr(t[1]),["LAST-MSN","LAST-PART"].forEach(function(p){r.attributes.hasOwnProperty(p)&&(r.attributes[p]=parseInt(r.attributes[p],10))}),this.trigger("data",r);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(f),t&&t[1]){r={type:"tag",tagType:"daterange"},r.attributes=Dr(t[1]),["ID","CLASS"].forEach(function(E){r.attributes.hasOwnProperty(E)&&(r.attributes[E]=String(r.attributes[E]))}),["START-DATE","END-DATE"].forEach(function(E){r.attributes.hasOwnProperty(E)&&(r.attributes[E]=new Date(r.attributes[E]))}),["DURATION","PLANNED-DURATION"].forEach(function(E){r.attributes.hasOwnProperty(E)&&(r.attributes[E]=parseFloat(r.attributes[E]))}),["END-ON-NEXT"].forEach(function(E){r.attributes.hasOwnProperty(E)&&(r.attributes[E]=/YES/i.test(r.attributes[E]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(E){r.attributes.hasOwnProperty(E)&&(r.attributes[E]=r.attributes[E].toString(16))});const p=/^X-([A-Z]+-)+[A-Z]+$/;for(const E in r.attributes){if(!p.test(E))continue;const N=/[0-9A-Fa-f]{6}/g.test(r.attributes[E]),$=/^\d+(\.\d+)?$/.test(r.attributes[E]);r.attributes[E]=N?r.attributes[E].toString(16):$?parseFloat(r.attributes[E]):String(r.attributes[E])}this.trigger("data",r);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(f),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(f),t){this.trigger("data",{type:"tag",tagType:"i-frames-only"});return}if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(f),t){r={type:"tag",tagType:"content-steering"},r.attributes=Dr(t[1]),this.trigger("data",r);return}if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(f),t){r={type:"tag",tagType:"i-frame-playlist"},r.attributes=Dr(t[1]),r.attributes.URI&&(r.uri=r.attributes.URI),r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes.RESOLUTION&&(r.attributes.RESOLUTION=tc(r.attributes.RESOLUTION)),r.attributes["AVERAGE-BANDWIDTH"]&&(r.attributes["AVERAGE-BANDWIDTH"]=parseInt(r.attributes["AVERAGE-BANDWIDTH"],10)),r.attributes["FRAME-RATE"]&&(r.attributes["FRAME-RATE"]=parseFloat(r.attributes["FRAME-RATE"])),this.trigger("data",r);return}if(t=/^#EXT-X-DEFINE:(.*)$/.exec(f),t){r={type:"tag",tagType:"define"},r.attributes=Dr(t[1]),this.trigger("data",r);return}this.trigger("data",{type:"tag",data:f.slice(4)})})}addParser({expression:e,customType:t,dataParser:r,segment:o}){typeof r!="function"&&(r=f=>f),this.customParsers.push(f=>{if(e.exec(f))return this.trigger("data",{type:"custom",data:r(f),customType:t,segment:o}),!0})}addTagMapper({expression:e,map:t}){const r=o=>e.test(o)?t(o):o;this.tagMappers.push(r)}}const sf=i=>i.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),ls=function(i){const e={};return Object.keys(i).forEach(function(t){e[sf(t)]=i[t]}),e},Zl=function(i){const{serverControl:e,targetDuration:t,partTargetDuration:r}=i;if(!e)return;const o="#EXT-X-SERVER-CONTROL",f="holdBack",p="partHoldBack",E=t&&t*3,N=r&&r*2;t&&!e.hasOwnProperty(f)&&(e[f]=E,this.trigger("info",{message:`${o} defaulting HOLD-BACK to targetDuration * 3 (${E}).`})),E&&e[f]<E&&(this.trigger("warn",{message:`${o} clamping HOLD-BACK (${e[f]}) to targetDuration * 3 (${E})`}),e[f]=E),r&&!e.hasOwnProperty(p)&&(e[p]=r*3,this.trigger("info",{message:`${o} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[p]}).`})),r&&e[p]<N&&(this.trigger("warn",{message:`${o} clamping PART-HOLD-BACK (${e[p]}) to partTargetDuration * 2 (${N}).`}),e[p]=N)};class ic extends Ju{constructor(e={}){super(),this.lineStream=new Cd,this.parseStream=new kd,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,r=[];let o={},f,p,E=!1;const N=function(){},$={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},he="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let Te=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let we=0,Me=0;const Ge={};this.on("end",()=>{o.uri||!o.parts&&!o.preloadHints||(!o.map&&f&&(o.map=f),!o.key&&p&&(o.key=p),!o.timeline&&typeof Te=="number"&&(o.timeline=Te),this.manifest.preloadSegment=o)}),this.parseStream.on("data",function(ke){let qe,$e;if(t.manifest.definitions){for(const tt in t.manifest.definitions)if(ke.uri&&(ke.uri=ke.uri.replace(`{$${tt}}`,t.manifest.definitions[tt])),ke.attributes)for(const Je in ke.attributes)typeof ke.attributes[Je]=="string"&&(ke.attributes[Je]=ke.attributes[Je].replace(`{$${tt}}`,t.manifest.definitions[tt]))}({tag(){({version(){ke.version&&(this.manifest.version=ke.version)},"allow-cache"(){this.manifest.allowCache=ke.allowed,"allowed"in ke||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const tt={};"length"in ke&&(o.byterange=tt,tt.length=ke.length,"offset"in ke||(ke.offset=we)),"offset"in ke&&(o.byterange=tt,tt.offset=ke.offset),we=tt.offset+tt.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),ke.title&&(o.title=ke.title),ke.duration>0&&(o.duration=ke.duration),ke.duration===0&&(o.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=r},key(){if(!ke.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(ke.attributes.METHOD==="NONE"){p=null;return}if(!ke.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(ke.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:ke.attributes};return}if(ke.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:ke.attributes.URI};return}if(ke.attributes.KEYFORMAT===he){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(ke.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(ke.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),ke.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(ke.attributes.KEYID&&ke.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:ke.attributes.KEYFORMAT,keyId:ke.attributes.KEYID.substring(2)},pssh:ec(ke.attributes.URI.split(",")[1])};return}ke.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),p={method:ke.attributes.METHOD||"AES-128",uri:ke.attributes.URI},typeof ke.attributes.IV<"u"&&(p.iv=ke.attributes.IV)},"media-sequence"(){if(!isFinite(ke.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+ke.number});return}this.manifest.mediaSequence=ke.number},"discontinuity-sequence"(){if(!isFinite(ke.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+ke.number});return}this.manifest.discontinuitySequence=ke.number,Te=ke.number},"playlist-type"(){if(!/VOD|EVENT/.test(ke.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+ke.playlist});return}this.manifest.playlistType=ke.playlistType},map(){f={},ke.uri&&(f.uri=ke.uri),ke.byterange&&(f.byterange=ke.byterange),p&&(f.key=p)},"stream-inf"(){if(this.manifest.playlists=r,this.manifest.mediaGroups=this.manifest.mediaGroups||$,!ke.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}o.attributes||(o.attributes={}),Hi(o.attributes,ke.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||$,!(ke.attributes&&ke.attributes.TYPE&&ke.attributes["GROUP-ID"]&&ke.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const tt=this.manifest.mediaGroups[ke.attributes.TYPE];tt[ke.attributes["GROUP-ID"]]=tt[ke.attributes["GROUP-ID"]]||{},qe=tt[ke.attributes["GROUP-ID"]],$e={default:/yes/i.test(ke.attributes.DEFAULT)},$e.default?$e.autoselect=!0:$e.autoselect=/yes/i.test(ke.attributes.AUTOSELECT),ke.attributes.LANGUAGE&&($e.language=ke.attributes.LANGUAGE),ke.attributes.URI&&($e.uri=ke.attributes.URI),ke.attributes["INSTREAM-ID"]&&($e.instreamId=ke.attributes["INSTREAM-ID"]),ke.attributes.CHARACTERISTICS&&($e.characteristics=ke.attributes.CHARACTERISTICS),ke.attributes.FORCED&&($e.forced=/yes/i.test(ke.attributes.FORCED)),qe[ke.attributes.NAME]=$e},discontinuity(){Te+=1,o.discontinuity=!0,this.manifest.discontinuityStarts.push(r.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=ke.dateTimeString,this.manifest.dateTimeObject=ke.dateTimeObject),o.dateTimeString=ke.dateTimeString,o.dateTimeObject=ke.dateTimeObject;const{lastProgramDateTime:tt}=this;this.lastProgramDateTime=new Date(ke.dateTimeString).getTime(),tt===null&&this.manifest.segments.reduceRight((Je,st)=>(st.programDateTime=Je-st.duration*1e3,st.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(ke.duration)||ke.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+ke.duration});return}this.manifest.targetDuration=ke.duration,Zl.call(this,this.manifest)},start(){if(!ke.attributes||isNaN(ke.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:ke.attributes["TIME-OFFSET"],precise:ke.attributes.PRECISE}},"cue-out"(){o.cueOut=ke.data},"cue-out-cont"(){o.cueOutCont=ke.data},"cue-in"(){o.cueIn=ke.data},skip(){this.manifest.skip=ls(ke.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",ke.attributes,["SKIPPED-SEGMENTS"])},part(){E=!0;const tt=this.manifest.segments.length,Je=ls(ke.attributes);o.parts=o.parts||[],o.parts.push(Je),Je.byterange&&(Je.byterange.hasOwnProperty("offset")||(Je.byterange.offset=Me),Me=Je.byterange.offset+Je.byterange.length);const st=o.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${st} for segment #${tt}`,ke.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((We,dt)=>{We.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${dt} lacks required attribute(s): LAST-PART`})})},"server-control"(){const tt=this.manifest.serverControl=ls(ke.attributes);tt.hasOwnProperty("canBlockReload")||(tt.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),Zl.call(this,this.manifest),tt.canSkipDateranges&&!tt.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const tt=this.manifest.segments.length,Je=ls(ke.attributes),st=Je.type&&Je.type==="PART";o.preloadHints=o.preloadHints||[],o.preloadHints.push(Je),Je.byterange&&(Je.byterange.hasOwnProperty("offset")||(Je.byterange.offset=st?Me:0,st&&(Me=Je.byterange.offset+Je.byterange.length)));const We=o.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${We} for segment #${tt}`,ke.attributes,["TYPE","URI"]),!!Je.type)for(let dt=0;dt<o.preloadHints.length-1;dt++){const Dt=o.preloadHints[dt];Dt.type&&Dt.type===Je.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${We} for segment #${tt} has the same TYPE ${Je.type} as preload hint #${dt}`})}},"rendition-report"(){const tt=ls(ke.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(tt);const Je=this.manifest.renditionReports.length-1,st=["LAST-MSN","URI"];E&&st.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${Je}`,ke.attributes,st)},"part-inf"(){this.manifest.partInf=ls(ke.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",ke.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),Zl.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(ls(ke.attributes));const tt=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${tt}`,ke.attributes,["ID","START-DATE"]);const Je=this.manifest.dateRanges[tt];Je.endDate&&Je.startDate&&new Date(Je.endDate)<new Date(Je.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),Je.duration&&Je.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),Je.plannedDuration&&Je.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const st=!!Je.endOnNext;if(st&&!Je.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),st&&(Je.duration||Je.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),Je.duration&&Je.endDate){const dt=Je.startDate.getTime()+Je.duration*1e3;this.manifest.dateRanges[tt].endDate=new Date(dt)}if(!Ge[Je.id])Ge[Je.id]=Je;else{for(const dt in Ge[Je.id])if(Je[dt]&&JSON.stringify(Ge[Je.id][dt])!==JSON.stringify(Je[dt])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const We=this.manifest.dateRanges.findIndex(dt=>dt.id===Je.id);this.manifest.dateRanges[We]=Hi(this.manifest.dateRanges[We],Je),Ge[Je.id]=Hi(Ge[Je.id],Je),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=ls(ke.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",ke.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const tt=(Je,st)=>{if(Je in this.manifest.definitions){this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${Je}`});return}this.manifest.definitions[Je]=st};if("QUERYPARAM"in ke.attributes){if("NAME"in ke.attributes||"IMPORT"in ke.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}const Je=this.params.get(ke.attributes.QUERYPARAM);if(!Je){this.trigger("error",{message:`EXT-X-DEFINE: No query param ${ke.attributes.QUERYPARAM}`});return}tt(ke.attributes.QUERYPARAM,decodeURIComponent(Je));return}if("NAME"in ke.attributes){if("IMPORT"in ke.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}if(!("VALUE"in ke.attributes)||typeof ke.attributes.VALUE!="string"){this.trigger("error",{message:`EXT-X-DEFINE: No value for ${ke.attributes.NAME}`});return}tt(ke.attributes.NAME,ke.attributes.VALUE);return}if("IMPORT"in ke.attributes){if(!this.mainDefinitions[ke.attributes.IMPORT]){this.trigger("error",{message:`EXT-X-DEFINE: No value ${ke.attributes.IMPORT} to import, or IMPORT used on main playlist`});return}tt(ke.attributes.IMPORT,this.mainDefinitions[ke.attributes.IMPORT]);return}this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:ke.attributes,uri:ke.uri,timeline:Te}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",ke.attributes,["BANDWIDTH","URI"])}}[ke.tagType]||N).call(t)},uri(){o.uri=ke.uri,r.push(o),this.manifest.targetDuration&&!("duration"in o)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),o.duration=this.manifest.targetDuration),p&&(o.key=p),o.timeline=Te,f&&(o.map=f),Me=0,this.lastProgramDateTime!==null&&(o.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=o.duration*1e3),o={}},comment(){},custom(){ke.segment?(o.custom=o.custom||{},o.custom[ke.customType]=ke.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[ke.customType]=ke.data)}})[ke.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(e,t,r){const o=[];r.forEach(function(f){t.hasOwnProperty(f)||o.push(f)}),o.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${o.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var Ha={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},af=["video","audio","text"],Dd=["Video","Audio","Text"],rc=function(e){return e&&e.replace(/avc1\.(\d+)\.(\d+)/i,function(t,r,o){var f=("00"+Number(r).toString(16)).slice(-2),p=("00"+Number(o).toString(16)).slice(-2);return"avc1."+f+"00"+p})},Yn=function(e){e===void 0&&(e="");var t=e.split(","),r=[];return t.forEach(function(o){o=o.trim();var f;af.forEach(function(p){var E=Ha[p].exec(o.toLowerCase());if(!(!E||E.length<=1)){f=p;var N=o.substring(0,E[1].length),$=o.replace(N,"");r.push({type:N,details:$,mediaType:p})}}),f||r.push({type:o,details:"",mediaType:"unknown"})}),r},of=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var r=e.mediaGroups.AUDIO[t];if(!r)return null;for(var o in r){var f=r[o];if(f.default&&f.playlists)return Yn(f.playlists[0].attributes.CODECS)}return null},nc=function(e){return e===void 0&&(e=""),Ha.audio.test(e.trim().toLowerCase())},lf=function(e){return e===void 0&&(e=""),Ha.text.test(e.trim().toLowerCase())},To=function(e){if(!(!e||typeof e!="string")){var t=e.toLowerCase().split(",").map(function(f){return rc(f.trim())}),r="video";t.length===1&&nc(t[0])?r="audio":t.length===1&&lf(t[0])&&(r="application");var o="mp4";return t.every(function(f){return Ha.mp4.test(f)})?o="mp4":t.every(function(f){return Ha.webm.test(f)})?o="webm":t.every(function(f){return Ha.ogg.test(f)})&&(o="ogg"),r+"/"+o+';codecs="'+e+'"'}},da=function(e,t){return e===void 0&&(e=""),t===void 0&&(t=!1),window.MediaSource&&window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported(To(e))||t&&window.ManagedMediaSource&&window.ManagedMediaSource.isTypeSupported&&window.ManagedMediaSource.isTypeSupported(To(e))||!1},eu=function(e){return e===void 0&&(e=""),e.toLowerCase().split(",").every(function(t){t=t.trim();for(var r=0;r<Dd.length;r++){var o=Dd[r];if(Ha["muxer"+o].test(t))return!0}return!1})},En="mp4a.40.2",Br="avc1.4d400d",sc=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,ja=/^application\/dash\+xml/i,Ka=function(e){return sc.test(e)?"hls":ja.test(e)?"dash":e==="application/vnd.videojs.vhs+json"?"vhs-json":null},uf=function(e){return e.toString(2).length},ac=function(e){return Math.ceil(uf(e)/8)},oc=function(e){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},cf=function(e){return oc(e)},Ft=function(e){return e instanceof Uint8Array?e:(!Array.isArray(e)&&!cf(e)&&!(e instanceof ArrayBuffer)&&(typeof e!="number"||typeof e=="number"&&e!==e?e=0:e=[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},wr=window.BigInt||Number,tu=[wr("0x1"),wr("0x100"),wr("0x10000"),wr("0x1000000"),wr("0x100000000"),wr("0x10000000000"),wr("0x1000000000000"),wr("0x100000000000000"),wr("0x10000000000000000")];(function(){var i=new Uint16Array([65484]),e=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);return e[0]===255?"big":e[0]===204?"little":"unknown"})();var df=function(e,t){var r=t===void 0?{}:t,o=r.signed,f=o===void 0?!1:o,p=r.le,E=p===void 0?!1:p;e=Ft(e);var N=E?"reduce":"reduceRight",$=e[N]?e[N]:Array.prototype[N],he=$.call(e,function(we,Me,Ge){var ke=E?Ge:Math.abs(Ge+1-e.length);return we+wr(Me)*tu[ke]},wr(0));if(f){var Te=tu[e.length]/wr(2)-wr(1);he=wr(he),he>Te&&(he-=Te,he-=Te,he-=wr(2))}return Number(he)},hf=function(e,t){var r=t===void 0?{}:t,o=r.le,f=o===void 0?!1:o;(typeof e!="bigint"&&typeof e!="number"||typeof e=="number"&&e!==e)&&(e=0),e=wr(e);for(var p=ac(e),E=new Uint8Array(new ArrayBuffer(p)),N=0;N<p;N++){var $=f?N:Math.abs(N+1-E.length);E[$]=Number(e/tu[N]&wr(255)),e<0&&(E[$]=Math.abs(~E[$]),E[$]-=N===0?1:2)}return E},wd=function(e,t){if(typeof e!="string"&&e&&typeof e.toString=="function"&&(e=e.toString()),typeof e!="string")return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return r},ff=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t=t.filter(function(E){return E&&(E.byteLength||E.length)&&typeof E!="string"}),t.length<=1)return Ft(t[0]);var o=t.reduce(function(E,N,$){return E+(N.byteLength||N.length)},0),f=new Uint8Array(o),p=0;return t.forEach(function(E){E=Ft(E),f.set(E,p),p+=E.byteLength}),f},Fi=function(e,t,r){var o=r===void 0?{}:r,f=o.offset,p=f===void 0?0:f,E=o.mask,N=E===void 0?[]:E;e=Ft(e),t=Ft(t);var $=t.every?t.every:Array.prototype.every;return t.length&&e.length-p>=t.length&&$.call(t,function(he,Te){var we=N[Te]?N[Te]&e[p+Te]:e[p+Te];return he===we})},pf=function(e,t,r){t.forEach(function(o){for(var f in e.mediaGroups[o])for(var p in e.mediaGroups[o][f]){var E=e.mediaGroups[o][f][p];r(E,o,f,p)}})};function gf(i,e,t){if(t===void 0&&(t=Array.prototype),i&&typeof t.find=="function")return t.find.call(i,e);for(var r=0;r<i.length;r++)if(Object.prototype.hasOwnProperty.call(i,r)){var o=i[r];if(e.call(void 0,o,r,i))return o}}function lc(i,e){return e===void 0&&(e=Object),e&&typeof e.freeze=="function"?e.freeze(i):i}function us(i,e){if(i===null||typeof i!="object")throw new TypeError("target is not an object");for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t]);return i}var Ld=lc({HTML:"text/html",isHTML:function(i){return i===Ld.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Id=lc({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(i){return i===Id.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}),mf=us,Rd=gf,vf=lc,Pd=Ld,yf=Id,Xo={assign:mf,find:Rd,freeze:vf,MIME_TYPE:Pd,NAMESPACE:yf},cs=Xo.find,Qo=Xo.NAMESPACE;function Od(i){return i!==""}function uc(i){return i?i.split(/[\t\n\f\r ]+/).filter(Od):[]}function cc(i,e){return i.hasOwnProperty(e)||(i[e]=!0),i}function iu(i){if(!i)return[];var e=uc(i);return Object.keys(e.reduce(cc,{}))}function Md(i){return function(e){return i&&i.indexOf(e)!==-1}}function Jo(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function un(i,e){var t=i.prototype;if(!(t instanceof e)){let r=function(){};r.prototype=e.prototype,r=new r,Jo(t,r),i.prototype=t=r}t.constructor!=i&&(typeof i!="function"&&console.error("unknown Class:"+i),t.constructor=i)}var cn={},Xn=cn.ELEMENT_NODE=1,Eo=cn.ATTRIBUTE_NODE=2,ru=cn.TEXT_NODE=3,Nd=cn.CDATA_SECTION_NODE=4,Zo=cn.ENTITY_REFERENCE_NODE=5,Tf=cn.ENTITY_NODE=6,el=cn.PROCESSING_INSTRUCTION_NODE=7,Fd=cn.COMMENT_NODE=8,Bd=cn.DOCUMENT_NODE=9,dc=cn.DOCUMENT_TYPE_NODE=10,Ns=cn.DOCUMENT_FRAGMENT_NODE=11,Ef=cn.NOTATION_NODE=12,Ur={},_r={};Ur.INDEX_SIZE_ERR=(_r[1]="Index size error",1),Ur.DOMSTRING_SIZE_ERR=(_r[2]="DOMString size error",2);var Qr=Ur.HIERARCHY_REQUEST_ERR=(_r[3]="Hierarchy request error",3);Ur.WRONG_DOCUMENT_ERR=(_r[4]="Wrong document",4),Ur.INVALID_CHARACTER_ERR=(_r[5]="Invalid character",5),Ur.NO_DATA_ALLOWED_ERR=(_r[6]="No data allowed",6),Ur.NO_MODIFICATION_ALLOWED_ERR=(_r[7]="No modification allowed",7);var Ud=Ur.NOT_FOUND_ERR=(_r[8]="Not found",8);Ur.NOT_SUPPORTED_ERR=(_r[9]="Not supported",9);var Gd=Ur.INUSE_ATTRIBUTE_ERR=(_r[10]="Attribute in use",10);Ur.INVALID_STATE_ERR=(_r[11]="Invalid state",11),Ur.SYNTAX_ERR=(_r[12]="Syntax error",12),Ur.INVALID_MODIFICATION_ERR=(_r[13]="Invalid modification",13),Ur.NAMESPACE_ERR=(_r[14]="Invalid namespace",14),Ur.INVALID_ACCESS_ERR=(_r[15]="Invalid access",15);function ir(i,e){if(e instanceof Error)var t=e;else t=this,Error.call(this,_r[i]),this.message=_r[i],Error.captureStackTrace&&Error.captureStackTrace(this,ir);return t.code=i,e&&(this.message=this.message+": "+e),t}ir.prototype=Error.prototype,Jo(Ur,ir);function Fs(){}Fs.prototype={length:0,item:function(i){return i>=0&&i<this.length?this[i]:null},toString:function(i,e){for(var t=[],r=0;r<this.length;r++)h(this[r],t,i,e);return t.join("")},filter:function(i){return Array.prototype.filter.call(this,i)},indexOf:function(i){return Array.prototype.indexOf.call(this,i)}};function qa(i,e){this._node=i,this._refresh=e,nu(this)}function nu(i){var e=i._node._inc||i._node.ownerDocument._inc;if(i._inc!==e){var t=i._refresh(i._node);if(S(i,"length",t.length),!i.$$length||t.length<i.$$length)for(var r=t.length;r in i;r++)Object.prototype.hasOwnProperty.call(i,r)&&delete i[r];Jo(t,i),i._inc=e}}qa.prototype.item=function(i){return nu(this),this[i]||null},un(qa,Fs);function su(){}function hc(i,e){for(var t=i.length;t--;)if(i[t]===e)return t}function Vd(i,e,t,r){if(r?e[hc(e,r)]=t:e[e.length++]=t,i){t.ownerElement=i;var o=i.ownerDocument;o&&(r&&Kd(o,i,r),_f(o,i,t))}}function Hd(i,e,t){var r=hc(e,t);if(r>=0){for(var o=e.length-1;r<o;)e[r]=e[++r];if(e.length=o,i){var f=i.ownerDocument;f&&(Kd(f,i,t),t.ownerElement=null)}}else throw new ir(Ud,new Error(i.tagName+"@"+t))}su.prototype={length:0,item:Fs.prototype.item,getNamedItem:function(i){for(var e=this.length;e--;){var t=this[e];if(t.nodeName==i)return t}},setNamedItem:function(i){var e=i.ownerElement;if(e&&e!=this._ownerElement)throw new ir(Gd);var t=this.getNamedItem(i.nodeName);return Vd(this._ownerElement,this,i,t),t},setNamedItemNS:function(i){var e=i.ownerElement,t;if(e&&e!=this._ownerElement)throw new ir(Gd);return t=this.getNamedItemNS(i.namespaceURI,i.localName),Vd(this._ownerElement,this,i,t),t},removeNamedItem:function(i){var e=this.getNamedItem(i);return Hd(this._ownerElement,this,e),e},removeNamedItemNS:function(i,e){var t=this.getNamedItemNS(i,e);return Hd(this._ownerElement,this,t),t},getNamedItemNS:function(i,e){for(var t=this.length;t--;){var r=this[t];if(r.localName==e&&r.namespaceURI==i)return r}return null}};function fc(){}fc.prototype={hasFeature:function(i,e){return!0},createDocument:function(i,e,t){var r=new il;if(r.implementation=this,r.childNodes=new Fs,r.doctype=t||null,t&&r.appendChild(t),e){var o=r.createElementNS(i,e);r.appendChild(o)}return r},createDocumentType:function(i,e,t){var r=new lu;return r.name=i,r.nodeName=i,r.publicId=e||"",r.systemId=t||"",r}};function di(){}di.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(i,e){return rl(this,i,e)},replaceChild:function(i,e){rl(this,i,e,mc),e&&this.removeChild(e)},removeChild:function(i){return qd(this,i)},appendChild:function(i){return this.insertBefore(i,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(i){return m(this.ownerDocument||this,this,i)},normalize:function(){for(var i=this.firstChild;i;){var e=i.nextSibling;e&&e.nodeType==ru&&i.nodeType==ru?(this.removeChild(e),i.appendData(e.data)):(i.normalize(),i=e)}},isSupported:function(i,e){return this.ownerDocument.implementation.hasFeature(i,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(i){for(var e=this;e;){var t=e._nsMap;if(t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&t[r]===i)return r}e=e.nodeType==Eo?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(i){for(var e=this;e;){var t=e._nsMap;if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i];e=e.nodeType==Eo?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(i){var e=this.lookupPrefix(i);return e==null}};function jd(i){return i=="<"&&"&lt;"||i==">"&&"&gt;"||i=="&"&&"&amp;"||i=='"'&&"&quot;"||"&#"+i.charCodeAt()+";"}Jo(cn,di),Jo(cn,di.prototype);function tl(i,e){if(e(i))return!0;if(i=i.firstChild)do if(tl(i,e))return!0;while(i=i.nextSibling)}function il(){this.ownerDocument=this}function _f(i,e,t){i&&i._inc++;var r=t.namespaceURI;r===Qo.XMLNS&&(e._nsMap[t.prefix?t.localName:""]=t.value)}function Kd(i,e,t,r){i&&i._inc++;var o=t.namespaceURI;o===Qo.XMLNS&&delete e._nsMap[t.prefix?t.localName:""]}function pc(i,e,t){if(i&&i._inc){i._inc++;var r=e.childNodes;if(t)r[r.length++]=t;else{for(var o=e.firstChild,f=0;o;)r[f++]=o,o=o.nextSibling;r.length=f,delete r[r.length]}}}function qd(i,e){var t=e.previousSibling,r=e.nextSibling;return t?t.nextSibling=r:i.firstChild=r,r?r.previousSibling=t:i.lastChild=t,e.parentNode=null,e.previousSibling=null,e.nextSibling=null,pc(i.ownerDocument,i),e}function $d(i){return i&&(i.nodeType===di.DOCUMENT_NODE||i.nodeType===di.DOCUMENT_FRAGMENT_NODE||i.nodeType===di.ELEMENT_NODE)}function bf(i){return i&&(Mn(i)||gc(i)||Bs(i)||i.nodeType===di.DOCUMENT_FRAGMENT_NODE||i.nodeType===di.COMMENT_NODE||i.nodeType===di.PROCESSING_INSTRUCTION_NODE)}function Bs(i){return i&&i.nodeType===di.DOCUMENT_TYPE_NODE}function Mn(i){return i&&i.nodeType===di.ELEMENT_NODE}function gc(i){return i&&i.nodeType===di.TEXT_NODE}function au(i,e){var t=i.childNodes||[];if(cs(t,Mn)||Bs(e))return!1;var r=cs(t,Bs);return!(e&&r&&t.indexOf(r)>t.indexOf(e))}function Wd(i,e){var t=i.childNodes||[];function r(f){return Mn(f)&&f!==e}if(cs(t,r))return!1;var o=cs(t,Bs);return!(e&&o&&t.indexOf(o)>t.indexOf(e))}function zd(i,e,t){if(!$d(i))throw new ir(Qr,"Unexpected parent node type "+i.nodeType);if(t&&t.parentNode!==i)throw new ir(Ud,"child not in parent");if(!bf(e)||Bs(e)&&i.nodeType!==di.DOCUMENT_NODE)throw new ir(Qr,"Unexpected node type "+e.nodeType+" for parent node type "+i.nodeType)}function Af(i,e,t){var r=i.childNodes||[],o=e.childNodes||[];if(e.nodeType===di.DOCUMENT_FRAGMENT_NODE){var f=o.filter(Mn);if(f.length>1||cs(o,gc))throw new ir(Qr,"More than one element or text in fragment");if(f.length===1&&!au(i,t))throw new ir(Qr,"Element in fragment can not be inserted before doctype")}if(Mn(e)&&!au(i,t))throw new ir(Qr,"Only one element can be added and only after doctype");if(Bs(e)){if(cs(r,Bs))throw new ir(Qr,"Only one doctype is allowed");var p=cs(r,Mn);if(t&&r.indexOf(p)<r.indexOf(t))throw new ir(Qr,"Doctype can only be inserted before an element");if(!t&&p)throw new ir(Qr,"Doctype can not be appended since element is present")}}function mc(i,e,t){var r=i.childNodes||[],o=e.childNodes||[];if(e.nodeType===di.DOCUMENT_FRAGMENT_NODE){var f=o.filter(Mn);if(f.length>1||cs(o,gc))throw new ir(Qr,"More than one element or text in fragment");if(f.length===1&&!Wd(i,t))throw new ir(Qr,"Element in fragment can not be inserted before doctype")}if(Mn(e)&&!Wd(i,t))throw new ir(Qr,"Only one element can be added and only after doctype");if(Bs(e)){if(cs(r,function(N){return Bs(N)&&N!==t}))throw new ir(Qr,"Only one doctype is allowed");var p=cs(r,Mn);if(t&&r.indexOf(p)<r.indexOf(t))throw new ir(Qr,"Doctype can only be inserted before an element")}}function rl(i,e,t,r){zd(i,e,t),i.nodeType===di.DOCUMENT_NODE&&(r||Af)(i,e,t);var o=e.parentNode;if(o&&o.removeChild(e),e.nodeType===Ns){var f=e.firstChild;if(f==null)return e;var p=e.lastChild}else f=p=e;var E=t?t.previousSibling:i.lastChild;f.previousSibling=E,p.nextSibling=t,E?E.nextSibling=f:i.firstChild=f,t==null?i.lastChild=p:t.previousSibling=p;do f.parentNode=i;while(f!==p&&(f=f.nextSibling));return pc(i.ownerDocument||i,i),e.nodeType==Ns&&(e.firstChild=e.lastChild=null),e}function Sf(i,e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=i,e.previousSibling=i.lastChild,e.nextSibling=null,e.previousSibling?e.previousSibling.nextSibling=e:i.firstChild=e,i.lastChild=e,pc(i.ownerDocument,i,e),e}il.prototype={nodeName:"#document",nodeType:Bd,doctype:null,documentElement:null,_inc:1,insertBefore:function(i,e){if(i.nodeType==Ns){for(var t=i.firstChild;t;){var r=t.nextSibling;this.insertBefore(t,e),t=r}return i}return rl(this,i,e),i.ownerDocument=this,this.documentElement===null&&i.nodeType===Xn&&(this.documentElement=i),i},removeChild:function(i){return this.documentElement==i&&(this.documentElement=null),qd(this,i)},replaceChild:function(i,e){rl(this,i,e,mc),i.ownerDocument=this,e&&this.removeChild(e),Mn(i)&&(this.documentElement=i)},importNode:function(i,e){return g(this,i,e)},getElementById:function(i){var e=null;return tl(this.documentElement,function(t){if(t.nodeType==Xn&&t.getAttribute("id")==i)return e=t,!0}),e},getElementsByClassName:function(i){var e=iu(i);return new qa(this,function(t){var r=[];return e.length>0&&tl(t.documentElement,function(o){if(o!==t&&o.nodeType===Xn){var f=o.getAttribute("class");if(f){var p=i===f;if(!p){var E=iu(f);p=e.every(Md(E))}p&&r.push(o)}}}),r})},createElement:function(i){var e=new $a;e.ownerDocument=this,e.nodeName=i,e.tagName=i,e.localName=i,e.childNodes=new Fs;var t=e.attributes=new su;return t._ownerElement=e,e},createDocumentFragment:function(){var i=new u;return i.ownerDocument=this,i.childNodes=new Fs,i},createTextNode:function(i){var e=new vc;return e.ownerDocument=this,e.appendData(i),e},createComment:function(i){var e=new yc;return e.ownerDocument=this,e.appendData(i),e},createCDATASection:function(i){var e=new Tc;return e.ownerDocument=this,e.appendData(i),e},createProcessingInstruction:function(i,e){var t=new l;return t.ownerDocument=this,t.tagName=t.nodeName=t.target=i,t.nodeValue=t.data=e,t},createAttribute:function(i){var e=new ou;return e.ownerDocument=this,e.name=i,e.nodeName=i,e.localName=i,e.specified=!0,e},createEntityReference:function(i){var e=new d;return e.ownerDocument=this,e.nodeName=i,e},createElementNS:function(i,e){var t=new $a,r=e.split(":"),o=t.attributes=new su;return t.childNodes=new Fs,t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.namespaceURI=i,r.length==2?(t.prefix=r[0],t.localName=r[1]):t.localName=e,o._ownerElement=t,t},createAttributeNS:function(i,e){var t=new ou,r=e.split(":");return t.ownerDocument=this,t.nodeName=e,t.name=e,t.namespaceURI=i,t.specified=!0,r.length==2?(t.prefix=r[0],t.localName=r[1]):t.localName=e,t}},un(il,di);function $a(){this._nsMap={}}$a.prototype={nodeType:Xn,hasAttribute:function(i){return this.getAttributeNode(i)!=null},getAttribute:function(i){var e=this.getAttributeNode(i);return e&&e.value||""},getAttributeNode:function(i){return this.attributes.getNamedItem(i)},setAttribute:function(i,e){var t=this.ownerDocument.createAttribute(i);t.value=t.nodeValue=""+e,this.setAttributeNode(t)},removeAttribute:function(i){var e=this.getAttributeNode(i);e&&this.removeAttributeNode(e)},appendChild:function(i){return i.nodeType===Ns?this.insertBefore(i,null):Sf(this,i)},setAttributeNode:function(i){return this.attributes.setNamedItem(i)},setAttributeNodeNS:function(i){return this.attributes.setNamedItemNS(i)},removeAttributeNode:function(i){return this.attributes.removeNamedItem(i.nodeName)},removeAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);t&&this.removeAttributeNode(t)},hasAttributeNS:function(i,e){return this.getAttributeNodeNS(i,e)!=null},getAttributeNS:function(i,e){var t=this.getAttributeNodeNS(i,e);return t&&t.value||""},setAttributeNS:function(i,e,t){var r=this.ownerDocument.createAttributeNS(i,e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},getAttributeNodeNS:function(i,e){return this.attributes.getNamedItemNS(i,e)},getElementsByTagName:function(i){return new qa(this,function(e){var t=[];return tl(e,function(r){r!==e&&r.nodeType==Xn&&(i==="*"||r.tagName==i)&&t.push(r)}),t})},getElementsByTagNameNS:function(i,e){return new qa(this,function(t){var r=[];return tl(t,function(o){o!==t&&o.nodeType===Xn&&(i==="*"||o.namespaceURI===i)&&(e==="*"||o.localName==e)&&r.push(o)}),r})}},il.prototype.getElementsByTagName=$a.prototype.getElementsByTagName,il.prototype.getElementsByTagNameNS=$a.prototype.getElementsByTagNameNS,un($a,di);function ou(){}ou.prototype.nodeType=Eo,un(ou,di);function ha(){}ha.prototype={data:"",substringData:function(i,e){return this.data.substring(i,i+e)},appendData:function(i){i=this.data+i,this.nodeValue=this.data=i,this.length=i.length},insertData:function(i,e){this.replaceData(i,0,e)},appendChild:function(i){throw new Error(_r[Qr])},deleteData:function(i,e){this.replaceData(i,e,"")},replaceData:function(i,e,t){var r=this.data.substring(0,i),o=this.data.substring(i+e);t=r+t+o,this.nodeValue=this.data=t,this.length=t.length}},un(ha,di);function vc(){}vc.prototype={nodeName:"#text",nodeType:ru,splitText:function(i){var e=this.data,t=e.substring(i);e=e.substring(0,i),this.data=this.nodeValue=e,this.length=e.length;var r=this.ownerDocument.createTextNode(t);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},un(vc,ha);function yc(){}yc.prototype={nodeName:"#comment",nodeType:Fd},un(yc,ha);function Tc(){}Tc.prototype={nodeName:"#cdata-section",nodeType:Nd},un(Tc,ha);function lu(){}lu.prototype.nodeType=dc,un(lu,di);function Yd(){}Yd.prototype.nodeType=Ef,un(Yd,di);function Ec(){}Ec.prototype.nodeType=Tf,un(Ec,di);function d(){}d.prototype.nodeType=Zo,un(d,di);function u(){}u.prototype.nodeName="#document-fragment",u.prototype.nodeType=Ns,un(u,di);function l(){}l.prototype.nodeType=el,un(l,di);function n(){}n.prototype.serializeToString=function(i,e,t){return s.call(i,e,t)},di.prototype.toString=s;function s(i,e){var t=[],r=this.nodeType==9&&this.documentElement||this,o=r.prefix,f=r.namespaceURI;if(f&&o==null){var o=r.lookupPrefix(f);if(o==null)var p=[{namespace:f,prefix:null}]}return h(this,t,i,e,p),t.join("")}function a(i,e,t){var r=i.prefix||"",o=i.namespaceURI;if(!o||r==="xml"&&o===Qo.XML||o===Qo.XMLNS)return!1;for(var f=t.length;f--;){var p=t[f];if(p.prefix===r)return p.namespace!==o}return!0}function c(i,e,t){i.push(" ",e,'="',t.replace(/[<>&"\t\n\r]/g,jd),'"')}function h(i,e,t,r,o){if(o||(o=[]),r)if(i=r(i),i){if(typeof i=="string"){e.push(i);return}}else return;switch(i.nodeType){case Xn:var f=i.attributes,p=f.length,$e=i.firstChild,E=i.tagName;t=Qo.isHTML(i.namespaceURI)||t;var N=E;if(!t&&!i.prefix&&i.namespaceURI){for(var $,he=0;he<f.length;he++)if(f.item(he).name==="xmlns"){$=f.item(he).value;break}if(!$)for(var Te=o.length-1;Te>=0;Te--){var we=o[Te];if(we.prefix===""&&we.namespace===i.namespaceURI){$=we.namespace;break}}if($!==i.namespaceURI)for(var Te=o.length-1;Te>=0;Te--){var we=o[Te];if(we.namespace===i.namespaceURI){we.prefix&&(N=we.prefix+":"+E);break}}}e.push("<",N);for(var Me=0;Me<p;Me++){var Ge=f.item(Me);Ge.prefix=="xmlns"?o.push({prefix:Ge.localName,namespace:Ge.value}):Ge.nodeName=="xmlns"&&o.push({prefix:"",namespace:Ge.value})}for(var Me=0;Me<p;Me++){var Ge=f.item(Me);if(a(Ge,t,o)){var ke=Ge.prefix||"",qe=Ge.namespaceURI;c(e,ke?"xmlns:"+ke:"xmlns",qe),o.push({prefix:ke,namespace:qe})}h(Ge,e,t,r,o)}if(E===N&&a(i,t,o)){var ke=i.prefix||"",qe=i.namespaceURI;c(e,ke?"xmlns:"+ke:"xmlns",qe),o.push({prefix:ke,namespace:qe})}if($e||t&&!/^(?:meta|link|img|br|hr|input)$/i.test(E)){if(e.push(">"),t&&/^script$/i.test(E))for(;$e;)$e.data?e.push($e.data):h($e,e,t,r,o.slice()),$e=$e.nextSibling;else for(;$e;)h($e,e,t,r,o.slice()),$e=$e.nextSibling;e.push("</",N,">")}else e.push("/>");return;case Bd:case Ns:for(var $e=i.firstChild;$e;)h($e,e,t,r,o.slice()),$e=$e.nextSibling;return;case Eo:return c(e,i.name,i.value);case ru:return e.push(i.data.replace(/[<&>]/g,jd));case Nd:return e.push("<![CDATA[",i.data,"]]>");case Fd:return e.push("<!--",i.data,"-->");case dc:var tt=i.publicId,Je=i.systemId;if(e.push("<!DOCTYPE ",i.name),tt)e.push(" PUBLIC ",tt),Je&&Je!="."&&e.push(" ",Je),e.push(">");else if(Je&&Je!=".")e.push(" SYSTEM ",Je,">");else{var st=i.internalSubset;st&&e.push(" [",st,"]"),e.push(">")}return;case el:return e.push("<?",i.target," ",i.data,"?>");case Zo:return e.push("&",i.nodeName,";");default:e.push("??",i.nodeName)}}function g(i,e,t){var r;switch(e.nodeType){case Xn:r=e.cloneNode(!1),r.ownerDocument=i;case Ns:break;case Eo:t=!0;break}if(r||(r=e.cloneNode(!1)),r.ownerDocument=i,r.parentNode=null,t)for(var o=e.firstChild;o;)r.appendChild(g(i,o,t)),o=o.nextSibling;return r}function m(i,e,t){var r=new e.constructor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var f=e[o];typeof f!="object"&&f!=r[o]&&(r[o]=f)}switch(e.childNodes&&(r.childNodes=new Fs),r.ownerDocument=i,r.nodeType){case Xn:var p=e.attributes,E=r.attributes=new su,N=p.length;E._ownerElement=r;for(var $=0;$<N;$++)r.setAttributeNode(m(i,p.item($),!0));break;case Eo:t=!0}if(t)for(var he=e.firstChild;he;)r.appendChild(m(i,he,t)),he=he.nextSibling;return r}function S(i,e,t){i[e]=t}try{if(Object.defineProperty){let i=function(e){switch(e.nodeType){case Xn:case Ns:var t=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&t.push(i(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}};Object.defineProperty(qa.prototype,"length",{get:function(){return nu(this),this.$$length}}),Object.defineProperty(di.prototype,"textContent",{get:function(){return i(this)},set:function(e){switch(this.nodeType){case Xn:case Ns:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),S=function(e,t,r){e["$$"+t]=r}}}catch{}var x=lu,U=ir,ne=fc,ue=$a,ge=di,ye=Fs,Se=n,xe={DocumentType:x,DOMException:U,DOMImplementation:ne,Element:ue,Node:ge,NodeList:ye,XMLSerializer:Se},De=On(function(i,e){var t=Xo.freeze;e.XML_ENTITIES=t({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),e.HTML_ENTITIES=t({Aacute:"\xC1",aacute:"\xE1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223E",acd:"\u223F",acE:"\u223E\u0333",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",Acy:"\u0410",acy:"\u0430",AElig:"\xC6",aelig:"\xE6",af:"\u2061",Afr:"\u{1D504}",afr:"\u{1D51E}",Agrave:"\xC0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03B1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2A3F",AMP:"&",amp:"&",And:"\u2A53",and:"\u2227",andand:"\u2A55",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsd:"\u2221",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",Aogon:"\u0104",aogon:"\u0105",Aopf:"\u{1D538}",aopf:"\u{1D552}",ap:"\u2248",apacir:"\u2A6F",apE:"\u2A70",ape:"\u224A",apid:"\u224B",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224A",Aring:"\xC5",aring:"\xE5",Ascr:"\u{1D49C}",ascr:"\u{1D4B6}",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224D",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",Backslash:"\u2216",Barv:"\u2AE7",barvee:"\u22BD",Barwed:"\u2306",barwed:"\u2305",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",Because:"\u2235",because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",Bernoullis:"\u212C",Beta:"\u0392",beta:"\u03B2",beth:"\u2136",between:"\u226C",Bfr:"\u{1D505}",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bNot:"\u2AED",bnot:"\u2310",Bopf:"\u{1D539}",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxbox:"\u29C9",boxDL:"\u2557",boxDl:"\u2556",boxdL:"\u2555",boxdl:"\u2510",boxDR:"\u2554",boxDr:"\u2553",boxdR:"\u2552",boxdr:"\u250C",boxH:"\u2550",boxh:"\u2500",boxHD:"\u2566",boxHd:"\u2564",boxhD:"\u2565",boxhd:"\u252C",boxHU:"\u2569",boxHu:"\u2567",boxhU:"\u2568",boxhu:"\u2534",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxUL:"\u255D",boxUl:"\u255C",boxuL:"\u255B",boxul:"\u2518",boxUR:"\u255A",boxUr:"\u2559",boxuR:"\u2558",boxur:"\u2514",boxV:"\u2551",boxv:"\u2502",boxVH:"\u256C",boxVh:"\u256B",boxvH:"\u256A",boxvh:"\u253C",boxVL:"\u2563",boxVl:"\u2562",boxvL:"\u2561",boxvl:"\u2524",boxVR:"\u2560",boxVr:"\u255F",boxvR:"\u255E",boxvr:"\u251C",bprime:"\u2035",Breve:"\u02D8",breve:"\u02D8",brvbar:"\xA6",Bscr:"\u212C",bscr:"\u{1D4B7}",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsol:"\\",bsolb:"\u29C5",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",Bumpeq:"\u224E",bumpeq:"\u224F",Cacute:"\u0106",cacute:"\u0107",Cap:"\u22D2",cap:"\u2229",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",capcup:"\u2A47",capdot:"\u2A40",CapitalDifferentialD:"\u2145",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",Cayleys:"\u212D",ccaps:"\u2A4D",Ccaron:"\u010C",ccaron:"\u010D",Ccedil:"\xC7",ccedil:"\xE7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2A4C",ccupssm:"\u2A50",Cdot:"\u010A",cdot:"\u010B",cedil:"\xB8",Cedilla:"\xB8",cemptyv:"\u29B2",cent:"\xA2",CenterDot:"\xB7",centerdot:"\xB7",Cfr:"\u212D",cfr:"\u{1D520}",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03A7",chi:"\u03C7",cir:"\u25CB",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",CircleDot:"\u2299",circledR:"\xAE",circledS:"\u24C8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cirE:"\u29C3",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",Colon:"\u2237",colon:":",Colone:"\u2A74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",Congruent:"\u2261",Conint:"\u222F",conint:"\u222E",ContourIntegral:"\u222E",Copf:"\u2102",copf:"\u{1D554}",coprod:"\u2210",Coproduct:"\u2210",COPY:"\xA9",copy:"\xA9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21B5",Cross:"\u2A2F",cross:"\u2717",Cscr:"\u{1D49E}",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",Cup:"\u22D3",cup:"\u222A",cupbrcap:"\u2A48",CupCap:"\u224D",cupcap:"\u2A46",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",Dagger:"\u2021",dagger:"\u2020",daleth:"\u2138",Darr:"\u21A1",dArr:"\u21D3",darr:"\u2193",dash:"\u2010",Dashv:"\u2AE4",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",Dcaron:"\u010E",dcaron:"\u010F",Dcy:"\u0414",dcy:"\u0434",DD:"\u2145",dd:"\u2146",ddagger:"\u2021",ddarr:"\u21CA",DDotrahd:"\u2911",ddotseq:"\u2A77",deg:"\xB0",Del:"\u2207",Delta:"\u0394",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",Dfr:"\u{1D507}",dfr:"\u{1D521}",dHar:"\u2965",dharl:"\u21C3",dharr:"\u21C2",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",diam:"\u22C4",Diamond:"\u22C4",diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",DifferentialD:"\u2146",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",Dopf:"\u{1D53B}",dopf:"\u{1D555}",Dot:"\xA8",dot:"\u02D9",DotDot:"\u20DC",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrow:"\u2193",Downarrow:"\u21D3",downarrow:"\u2193",DownArrowBar:"\u2913",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVector:"\u21BD",DownLeftVectorBar:"\u2956",DownRightTeeVector:"\u295F",DownRightVector:"\u21C1",DownRightVectorBar:"\u2957",DownTee:"\u22A4",DownTeeArrow:"\u21A7",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",Dscr:"\u{1D49F}",dscr:"\u{1D4B9}",DScy:"\u0405",dscy:"\u0455",dsol:"\u29F6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",DZcy:"\u040F",dzcy:"\u045F",dzigrarr:"\u27FF",Eacute:"\xC9",eacute:"\xE9",easter:"\u2A6E",Ecaron:"\u011A",ecaron:"\u011B",ecir:"\u2256",Ecirc:"\xCA",ecirc:"\xEA",ecolon:"\u2255",Ecy:"\u042D",ecy:"\u044D",eDDot:"\u2A77",Edot:"\u0116",eDot:"\u2251",edot:"\u0117",ee:"\u2147",efDot:"\u2252",Efr:"\u{1D508}",efr:"\u{1D522}",eg:"\u2A9A",Egrave:"\xC8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",Element:"\u2208",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25FB",emptyv:"\u2205",EmptyVerySmallSquare:"\u25AB",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",ENG:"\u014A",eng:"\u014B",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\u{1D53C}",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",Epsilon:"\u0395",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",Equal:"\u2A75",equals:"=",EqualTilde:"\u2242",equest:"\u225F",Equilibrium:"\u21CC",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erarr:"\u2971",erDot:"\u2253",Escr:"\u2130",escr:"\u212F",esdot:"\u2250",Esim:"\u2A73",esim:"\u2242",Eta:"\u0397",eta:"\u03B7",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",ExponentialE:"\u2147",exponentiale:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",Ffr:"\u{1D509}",ffr:"\u{1D523}",filig:"\uFB01",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",Fopf:"\u{1D53D}",fopf:"\u{1D557}",ForAll:"\u2200",forall:"\u2200",fork:"\u22D4",forkv:"\u2AD9",Fouriertrf:"\u2131",fpartint:"\u2A0D",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",Fscr:"\u2131",fscr:"\u{1D4BB}",gacute:"\u01F5",Gamma:"\u0393",gamma:"\u03B3",Gammad:"\u03DC",gammad:"\u03DD",gap:"\u2A86",Gbreve:"\u011E",gbreve:"\u011F",Gcedil:"\u0122",Gcirc:"\u011C",gcirc:"\u011D",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",gE:"\u2267",ge:"\u2265",gEl:"\u2A8C",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",ges:"\u2A7E",gescc:"\u2AA9",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",Gfr:"\u{1D50A}",gfr:"\u{1D524}",Gg:"\u22D9",gg:"\u226B",ggg:"\u22D9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gl:"\u2277",gla:"\u2AA5",glE:"\u2A92",glj:"\u2AA4",gnap:"\u2A8A",gnapprox:"\u2A8A",gnE:"\u2269",gne:"\u2A88",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",Gopf:"\u{1D53E}",gopf:"\u{1D558}",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",Gt:"\u226B",GT:">",gt:">",gtcc:"\u2AA7",gtcir:"\u2A7A",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",Hacek:"\u02C7",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",HARDcy:"\u042A",hardcy:"\u044A",hArr:"\u21D4",harr:"\u2194",harrcir:"\u2948",harrw:"\u21AD",Hat:"^",hbar:"\u210F",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",Hfr:"\u210C",hfr:"\u{1D525}",HilbertSpace:"\u210B",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",Hopf:"\u210D",hopf:"\u{1D559}",horbar:"\u2015",HorizontalLine:"\u2500",Hscr:"\u210B",hscr:"\u{1D4BD}",hslash:"\u210F",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224E",HumpEqual:"\u224F",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xCD",iacute:"\xED",ic:"\u2063",Icirc:"\xCE",icirc:"\xEE",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xA1",iff:"\u21D4",Ifr:"\u2111",ifr:"\u{1D526}",Igrave:"\xCC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Im:"\u2111",Imacr:"\u012A",imacr:"\u012B",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",imof:"\u22B7",imped:"\u01B5",Implies:"\u21D2",in:"\u2208",incare:"\u2105",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",Int:"\u222C",int:"\u222B",intcal:"\u22BA",integers:"\u2124",Integral:"\u222B",intercal:"\u22BA",Intersection:"\u22C2",intlarhk:"\u2A17",intprod:"\u2A3C",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012E",iogon:"\u012F",Iopf:"\u{1D540}",iopf:"\u{1D55A}",Iota:"\u0399",iota:"\u03B9",iprod:"\u2A3C",iquest:"\xBF",Iscr:"\u2110",iscr:"\u{1D4BE}",isin:"\u2208",isindot:"\u22F5",isinE:"\u22F9",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xCF",iuml:"\xEF",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\u{1D50D}",jfr:"\u{1D527}",jmath:"\u0237",Jopf:"\u{1D541}",jopf:"\u{1D55B}",Jscr:"\u{1D4A5}",jscr:"\u{1D4BF}",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039A",kappa:"\u03BA",kappav:"\u03F0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041A",kcy:"\u043A",Kfr:"\u{1D50E}",kfr:"\u{1D528}",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040C",kjcy:"\u045C",Kopf:"\u{1D542}",kopf:"\u{1D55C}",Kscr:"\u{1D4A6}",kscr:"\u{1D4C0}",lAarr:"\u21DA",Lacute:"\u0139",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",Lambda:"\u039B",lambda:"\u03BB",Lang:"\u27EA",lang:"\u27E8",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",Laplacetrf:"\u2112",laquo:"\xAB",Larr:"\u219E",lArr:"\u21D0",larr:"\u2190",larrb:"\u21E4",larrbfs:"\u291F",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",lat:"\u2AAB",lAtail:"\u291B",latail:"\u2919",late:"\u2AAD",lates:"\u2AAD\uFE00",lBarr:"\u290E",lbarr:"\u290C",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",Lcaron:"\u013D",lcaron:"\u013E",Lcedil:"\u013B",lcedil:"\u013C",lceil:"\u2308",lcub:"{",Lcy:"\u041B",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",lE:"\u2266",le:"\u2264",LeftAngleBracket:"\u27E8",LeftArrow:"\u2190",Leftarrow:"\u21D0",leftarrow:"\u2190",LeftArrowBar:"\u21E4",LeftArrowRightArrow:"\u21C6",leftarrowtail:"\u21A2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVector:"\u21C3",LeftDownVectorBar:"\u2959",LeftFloor:"\u230A",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",LeftRightArrow:"\u2194",Leftrightarrow:"\u21D4",leftrightarrow:"\u2194",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",LeftRightVector:"\u294E",LeftTee:"\u22A3",LeftTeeArrow:"\u21A4",LeftTeeVector:"\u295A",leftthreetimes:"\u22CB",LeftTriangle:"\u22B2",LeftTriangleBar:"\u29CF",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVector:"\u21BF",LeftUpVectorBar:"\u2958",LeftVector:"\u21BC",LeftVectorBar:"\u2952",lEg:"\u2A8B",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",les:"\u2A7D",lescc:"\u2AA8",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2AA1",lesssim:"\u2272",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",lfisht:"\u297C",lfloor:"\u230A",Lfr:"\u{1D50F}",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lHar:"\u2962",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",Ll:"\u22D8",ll:"\u226A",llarr:"\u21C7",llcorner:"\u231E",Lleftarrow:"\u21DA",llhard:"\u296B",lltri:"\u25FA",Lmidot:"\u013F",lmidot:"\u0140",lmoust:"\u23B0",lmoustache:"\u23B0",lnap:"\u2A89",lnapprox:"\u2A89",lnE:"\u2268",lne:"\u2A87",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",LongLeftArrow:"\u27F5",Longleftarrow:"\u27F8",longleftarrow:"\u27F5",LongLeftRightArrow:"\u27F7",Longleftrightarrow:"\u27FA",longleftrightarrow:"\u27F7",longmapsto:"\u27FC",LongRightArrow:"\u27F6",Longrightarrow:"\u27F9",longrightarrow:"\u27F6",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",Lopf:"\u{1D543}",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",Lscr:"\u2112",lscr:"\u{1D4C1}",Lsh:"\u21B0",lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",Lstrok:"\u0141",lstrok:"\u0142",Lt:"\u226A",LT:"<",lt:"<",ltcc:"\u2AA6",ltcir:"\u2A79",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",ltrPar:"\u2996",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",Mcy:"\u041C",mcy:"\u043C",mdash:"\u2014",mDDot:"\u223A",measuredangle:"\u2221",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",mfr:"\u{1D52A}",mho:"\u2127",micro:"\xB5",mid:"\u2223",midast:"*",midcir:"\u2AF0",middot:"\xB7",minus:"\u2212",minusb:"\u229F",minusd:"\u2238",minusdu:"\u2A2A",MinusPlus:"\u2213",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",Mopf:"\u{1D544}",mopf:"\u{1D55E}",mp:"\u2213",Mscr:"\u2133",mscr:"\u{1D4C2}",mstpos:"\u223E",Mu:"\u039C",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natur:"\u266E",natural:"\u266E",naturals:"\u2115",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",Ncy:"\u041D",ncy:"\u043D",ndash:"\u2013",ne:"\u2260",nearhk:"\u2924",neArr:"\u21D7",nearr:"\u2197",nearrow:"\u2197",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,nexist:"\u2204",nexists:"\u2204",Nfr:"\u{1D511}",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",nGg:"\u22D9\u0338",ngsim:"\u2275",nGt:"\u226B\u20D2",ngt:"\u226F",ngtr:"\u226F",nGtv:"\u226B\u0338",nhArr:"\u21CE",nharr:"\u21AE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",NJcy:"\u040A",njcy:"\u045A",nlArr:"\u21CD",nlarr:"\u219A",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nLeftarrow:"\u21CD",nleftarrow:"\u219A",nLeftrightarrow:"\u21CE",nleftrightarrow:"\u21AE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nLl:"\u22D8\u0338",nlsim:"\u2274",nLt:"\u226A\u20D2",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nLtv:"\u226A\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xA0",Nopf:"\u2115",nopf:"\u{1D55F}",Not:"\u2AEC",not:"\xAC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",notin:"\u2209",notindot:"\u22F5\u0338",notinE:"\u22F9\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",NotLeftTriangle:"\u22EA",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangle:"\u22EB",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",npar:"\u2226",nparallel:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",npre:"\u2AAF\u0338",nprec:"\u2280",npreceq:"\u2AAF\u0338",nrArr:"\u21CF",nrarr:"\u219B",nrarrc:"\u2933\u0338",nrarrw:"\u219D\u0338",nRightarrow:"\u21CF",nrightarrow:"\u219B",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",Nscr:"\u{1D4A9}",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",Ntilde:"\xD1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",Nu:"\u039D",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224D\u20D2",nVDash:"\u22AF",nVdash:"\u22AE",nvDash:"\u22AD",nvdash:"\u22AC",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvHarr:"\u2904",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwarhk:"\u2923",nwArr:"\u21D6",nwarr:"\u2196",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xD3",oacute:"\xF3",oast:"\u229B",ocir:"\u229A",Ocirc:"\xD4",ocirc:"\xF4",Ocy:"\u041E",ocy:"\u043E",odash:"\u229D",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29BF",Ofr:"\u{1D512}",ofr:"\u{1D52C}",ogon:"\u02DB",Ograve:"\xD2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",Omacr:"\u014C",omacr:"\u014D",Omega:"\u03A9",omega:"\u03C9",Omicron:"\u039F",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",Oopf:"\u{1D546}",oopf:"\u{1D560}",opar:"\u29B7",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",operp:"\u29B9",oplus:"\u2295",Or:"\u2A54",or:"\u2228",orarr:"\u21BB",ord:"\u2A5D",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oS:"\u24C8",Oscr:"\u{1D4AA}",oscr:"\u2134",Oslash:"\xD8",oslash:"\xF8",osol:"\u2298",Otilde:"\xD5",otilde:"\xF5",Otimes:"\u2A37",otimes:"\u2297",otimesas:"\u2A36",Ouml:"\xD6",ouml:"\xF6",ovbar:"\u233D",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",par:"\u2225",para:"\xB6",parallel:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",PartialD:"\u2202",Pcy:"\u041F",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",Pfr:"\u{1D513}",pfr:"\u{1D52D}",Phi:"\u03A6",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",Pi:"\u03A0",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plus:"+",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",PlusMinus:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",Poincareplane:"\u210C",pointint:"\u2A15",Popf:"\u2119",popf:"\u{1D561}",pound:"\xA3",Pr:"\u2ABB",pr:"\u227A",prap:"\u2AB7",prcue:"\u227C",prE:"\u2AB3",pre:"\u2AAF",prec:"\u227A",precapprox:"\u2AB7",preccurlyeq:"\u227C",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",precsim:"\u227E",Prime:"\u2033",prime:"\u2032",primes:"\u2119",prnap:"\u2AB9",prnE:"\u2AB5",prnsim:"\u22E8",prod:"\u220F",Product:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",Proportion:"\u2237",Proportional:"\u221D",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",Pscr:"\u{1D4AB}",pscr:"\u{1D4C5}",Psi:"\u03A8",psi:"\u03C8",puncsp:"\u2008",Qfr:"\u{1D514}",qfr:"\u{1D52E}",qint:"\u2A0C",Qopf:"\u211A",qopf:"\u{1D562}",qprime:"\u2057",Qscr:"\u{1D4AC}",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",QUOT:'"',quot:'"',rAarr:"\u21DB",race:"\u223D\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",Rang:"\u27EB",rang:"\u27E9",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raquo:"\xBB",Rarr:"\u21A0",rArr:"\u21D2",rarr:"\u2192",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21A3",rarrw:"\u219D",rAtail:"\u291C",ratail:"\u291A",ratio:"\u2236",rationals:"\u211A",RBarr:"\u2910",rBarr:"\u290F",rbarr:"\u290D",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",Re:"\u211C",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",rect:"\u25AD",REG:"\xAE",reg:"\xAE",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",rfisht:"\u297D",rfloor:"\u230B",Rfr:"\u211C",rfr:"\u{1D52F}",rHar:"\u2964",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",Rho:"\u03A1",rho:"\u03C1",rhov:"\u03F1",RightAngleBracket:"\u27E9",RightArrow:"\u2192",Rightarrow:"\u21D2",rightarrow:"\u2192",RightArrowBar:"\u21E5",RightArrowLeftArrow:"\u21C4",rightarrowtail:"\u21A3",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVector:"\u21C2",RightDownVectorBar:"\u2955",RightFloor:"\u230B",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",RightTee:"\u22A2",RightTeeArrow:"\u21A6",RightTeeVector:"\u295B",rightthreetimes:"\u22CC",RightTriangle:"\u22B3",RightTriangleBar:"\u29D0",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVector:"\u21BE",RightUpVectorBar:"\u2954",RightVector:"\u21C0",RightVectorBar:"\u2953",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoust:"\u23B1",rmoustache:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",Ropf:"\u211D",ropf:"\u{1D563}",roplus:"\u2A2E",rotimes:"\u2A35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",Rrightarrow:"\u21DB",rsaquo:"\u203A",Rscr:"\u211B",rscr:"\u{1D4C7}",Rsh:"\u21B1",rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",RuleDelayed:"\u29F4",ruluhar:"\u2968",rx:"\u211E",Sacute:"\u015A",sacute:"\u015B",sbquo:"\u201A",Sc:"\u2ABC",sc:"\u227B",scap:"\u2AB8",Scaron:"\u0160",scaron:"\u0161",sccue:"\u227D",scE:"\u2AB4",sce:"\u2AB0",Scedil:"\u015E",scedil:"\u015F",Scirc:"\u015C",scirc:"\u015D",scnap:"\u2ABA",scnE:"\u2AB6",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",Scy:"\u0421",scy:"\u0441",sdot:"\u22C5",sdotb:"\u22A1",sdote:"\u2A66",searhk:"\u2925",seArr:"\u21D8",searr:"\u2198",searrow:"\u2198",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\u{1D516}",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xAD",Sigma:"\u03A3",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",SOFTcy:"\u042C",softcy:"\u044C",sol:"/",solb:"\u29C4",solbar:"\u233F",Sopf:"\u{1D54A}",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",Sqrt:"\u221A",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",squ:"\u25A1",Square:"\u25A1",square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25AA",squf:"\u25AA",srarr:"\u2192",Sscr:"\u{1D4AE}",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",Star:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",Sub:"\u22D0",sub:"\u2282",subdot:"\u2ABD",subE:"\u2AC5",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",Subset:"\u22D0",subset:"\u2282",subseteq:"\u2286",subseteqq:"\u2AC5",SubsetEqual:"\u2286",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succ:"\u227B",succapprox:"\u2AB8",succcurlyeq:"\u227D",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",SuchThat:"\u220B",Sum:"\u2211",sum:"\u2211",sung:"\u266A",Sup:"\u22D1",sup:"\u2283",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",supdot:"\u2ABE",supdsub:"\u2AD8",supE:"\u2AC6",supe:"\u2287",supedot:"\u2AC4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",Supset:"\u22D1",supset:"\u2283",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swarhk:"\u2926",swArr:"\u21D9",swarr:"\u2199",swarrow:"\u2199",swnwar:"\u292A",szlig:"\xDF",Tab:"	",target:"\u2316",Tau:"\u03A4",tau:"\u03C4",tbrk:"\u23B4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",Tfr:"\u{1D517}",tfr:"\u{1D531}",there4:"\u2234",Therefore:"\u2234",therefore:"\u2234",Theta:"\u0398",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",ThickSpace:"\u205F\u200A",thinsp:"\u2009",ThinSpace:"\u2009",thkap:"\u2248",thksim:"\u223C",THORN:"\xDE",thorn:"\xFE",Tilde:"\u223C",tilde:"\u02DC",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",times:"\xD7",timesb:"\u22A0",timesbar:"\u2A31",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",top:"\u22A4",topbot:"\u2336",topcir:"\u2AF1",Topf:"\u{1D54B}",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",TRADE:"\u2122",trade:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",TripleDot:"\u20DB",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",Tscr:"\u{1D4AF}",tscr:"\u{1D4C9}",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040B",tshcy:"\u045B",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",Uacute:"\xDA",uacute:"\xFA",Uarr:"\u219F",uArr:"\u21D1",uarr:"\u2191",Uarrocir:"\u2949",Ubrcy:"\u040E",ubrcy:"\u045E",Ubreve:"\u016C",ubreve:"\u016D",Ucirc:"\xDB",ucirc:"\xFB",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21C5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",Ufr:"\u{1D518}",ufr:"\u{1D532}",Ugrave:"\xD9",ugrave:"\xF9",uHar:"\u2963",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",Umacr:"\u016A",umacr:"\u016B",uml:"\xA8",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",uogon:"\u0173",Uopf:"\u{1D54C}",uopf:"\u{1D566}",UpArrow:"\u2191",Uparrow:"\u21D1",uparrow:"\u2191",UpArrowBar:"\u2912",UpArrowDownArrow:"\u21C5",UpDownArrow:"\u2195",Updownarrow:"\u21D5",updownarrow:"\u2195",UpEquilibrium:"\u296E",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",Upsi:"\u03D2",upsi:"\u03C5",upsih:"\u03D2",Upsilon:"\u03A5",upsilon:"\u03C5",UpTee:"\u22A5",UpTeeArrow:"\u21A5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",Uring:"\u016E",uring:"\u016F",urtri:"\u25F9",Uscr:"\u{1D4B0}",uscr:"\u{1D4CA}",utdot:"\u22F0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",Uuml:"\xDC",uuml:"\xFC",uwangle:"\u29A7",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",vArr:"\u21D5",varr:"\u2195",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",Vbar:"\u2AEB",vBar:"\u2AE8",vBarv:"\u2AE9",Vcy:"\u0412",vcy:"\u0432",VDash:"\u22AB",Vdash:"\u22A9",vDash:"\u22A8",vdash:"\u22A2",Vdashl:"\u2AE6",Vee:"\u22C1",vee:"\u2228",veebar:"\u22BB",veeeq:"\u225A",vellip:"\u22EE",Verbar:"\u2016",verbar:"|",Vert:"\u2016",vert:"|",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",Vopf:"\u{1D54D}",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",Vscr:"\u{1D4B1}",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",Vvdash:"\u22AA",vzigzag:"\u299A",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2A5F",Wedge:"\u22C0",wedge:"\u2227",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\u{1D51A}",wfr:"\u{1D534}",Wopf:"\u{1D54E}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\u{1D4B2}",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",Xfr:"\u{1D51B}",xfr:"\u{1D535}",xhArr:"\u27FA",xharr:"\u27F7",Xi:"\u039E",xi:"\u03BE",xlArr:"\u27F8",xlarr:"\u27F5",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",Xopf:"\u{1D54F}",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrArr:"\u27F9",xrarr:"\u27F6",Xscr:"\u{1D4B3}",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",Yacute:"\xDD",yacute:"\xFD",YAcy:"\u042F",yacy:"\u044F",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042B",ycy:"\u044B",yen:"\xA5",Yfr:"\u{1D51C}",yfr:"\u{1D536}",YIcy:"\u0407",yicy:"\u0457",Yopf:"\u{1D550}",yopf:"\u{1D56A}",Yscr:"\u{1D4B4}",yscr:"\u{1D4CE}",YUcy:"\u042E",yucy:"\u044E",Yuml:"\u0178",yuml:"\xFF",Zacute:"\u0179",zacute:"\u017A",Zcaron:"\u017D",zcaron:"\u017E",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017B",zdot:"\u017C",zeetrf:"\u2128",ZeroWidthSpace:"\u200B",Zeta:"\u0396",zeta:"\u03B6",Zfr:"\u2128",zfr:"\u{1D537}",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21DD",Zopf:"\u2124",zopf:"\u{1D56B}",Zscr:"\u{1D4B5}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"}),e.entityMap=e.HTML_ENTITIES});De.XML_ENTITIES,De.HTML_ENTITIES,De.entityMap;var Fe=Xo.NAMESPACE,He=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,rt=new RegExp("[\\-\\.0-9"+He.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),ze=new RegExp("^"+He.source+rt.source+"*(?::"+He.source+rt.source+"*)?$"),Ve=0,Ze=1,et=2,ot=3,ct=4,yt=5,wt=6,It=7;function Ht(i,e){this.message=i,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,Ht)}Ht.prototype=new Error,Ht.prototype.name=Ht.name;function jt(){}jt.prototype={parse:function(i,e,t){var r=this.domBuilder;r.startDocument(),Yi(e,e={}),Zt(i,e,t,r,this.errorHandler),r.endDocument()}};function Zt(i,e,t,r,o){function f(hi){if(hi>65535){hi-=65536;var dr=55296+(hi>>10),Ya=56320+(hi&1023);return String.fromCharCode(dr,Ya)}else return String.fromCharCode(hi)}function p(hi){var dr=hi.slice(1,-1);return Object.hasOwnProperty.call(t,dr)?t[dr]:dr.charAt(0)==="#"?f(parseInt(dr.substr(1).replace("x","0x"))):(o.error("entity not found:"+hi),hi)}function E(hi){if(hi>ke){var dr=i.substring(ke,hi).replace(/&#?\w+;/g,p);we&&N(ke),r.characters(dr,0,hi-ke),ke=hi}}function N(hi,dr){for(;hi>=he&&(dr=Te.exec(i));)$=dr.index,he=$+dr[0].length,we.lineNumber++;we.columnNumber=hi-$+1}for(var $=0,he=0,Te=/.*(?:\r\n?|\n)|.*$/g,we=r.locator,Me=[{currentNSMap:e}],Ge={},ke=0;;){try{var qe=i.indexOf("<",ke);if(qe<0){if(!i.substr(ke).match(/^\s*$/)){var $e=r.doc,tt=$e.createTextNode(i.substr(ke));$e.appendChild(tt),r.currentElement=tt}return}switch(qe>ke&&E(qe),i.charAt(qe+1)){case"/":var si=i.indexOf(">",qe+3),Je=i.substring(qe+2,si).replace(/[ \t\n\r]+$/g,""),st=Me.pop();si<0?(Je=i.substring(qe+2).replace(/[\s<].*/,""),o.error("end tag name: "+Je+" is not complete:"+st.tagName),si=qe+1+Je.length):Je.match(/\s</)&&(Je=Je.replace(/[\s<].*/,""),o.error("end tag name: "+Je+" maybe not complete"),si=qe+1+Je.length);var We=st.localNSMap,dt=st.tagName==Je,Dt=dt||st.tagName&&st.tagName.toLowerCase()==Je.toLowerCase();if(Dt){if(r.endElement(st.uri,st.localName,Je),We)for(var kt in We)Object.prototype.hasOwnProperty.call(We,kt)&&r.endPrefixMapping(kt);dt||o.fatalError("end tag name: "+Je+" is not match the current start tagName:"+st.tagName)}else Me.push(st);si++;break;case"?":we&&N(qe),si=Si(i,qe,r);break;case"!":we&&N(qe),si=Lr(i,qe,r,o);break;default:we&&N(qe);var Xt=new Bi,Ui=Me[Me.length-1].currentNSMap,si=Kt(i,qe,Xt,Ui,p,o),Mi=Xt.length;if(!Xt.closed&&rr(i,si,Xt.tagName,Ge)&&(Xt.closed=!0,t.nbsp||o.warning("unclosed xml attribute")),we&&Mi){for(var Ot=ei(we,{}),ui=0;ui<Mi;ui++){var xn=Xt[ui];N(xn.offset),xn.locator=ei(we,{})}r.locator=Ot,Ai(Xt,r,Ui)&&Me.push(Xt),r.locator=we}else Ai(Xt,r,Ui)&&Me.push(Xt);Fe.isHTML(Xt.uri)&&!Xt.closed?si=li(i,si,Xt.tagName,p,r):si++}}catch(hi){if(hi instanceof Ht)throw hi;o.error("element parse error: "+hi),si=-1}si>ke?ke=si:E(Math.max(qe,ke)+1)}}function ei(i,e){return e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber,e}function Kt(i,e,t,r,o,f){function p(we,Me,Ge){t.attributeNames.hasOwnProperty(we)&&f.fatalError("Attribute "+we+" redefined"),t.addValue(we,Me.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,o),Ge)}for(var E,N,$=++e,he=Ve;;){var Te=i.charAt($);switch(Te){case"=":if(he===Ze)E=i.slice(e,$),he=ot;else if(he===et)he=ot;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(he===ot||he===Ze)if(he===Ze&&(f.warning('attribute value must after "="'),E=i.slice(e,$)),e=$+1,$=i.indexOf(Te,e),$>0)N=i.slice(e,$),p(E,N,e-1),he=yt;else throw new Error("attribute value no end '"+Te+"' match");else if(he==ct)N=i.slice(e,$),p(E,N,e),f.warning('attribute "'+E+'" missed start quot('+Te+")!!"),e=$+1,he=yt;else throw new Error('attribute value must after "="');break;case"/":switch(he){case Ve:t.setTagName(i.slice(e,$));case yt:case wt:case It:he=It,t.closed=!0;case ct:case Ze:break;case et:t.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return f.error("unexpected end of input"),he==Ve&&t.setTagName(i.slice(e,$)),$;case">":switch(he){case Ve:t.setTagName(i.slice(e,$));case yt:case wt:case It:break;case ct:case Ze:N=i.slice(e,$),N.slice(-1)==="/"&&(t.closed=!0,N=N.slice(0,-1));case et:he===et&&(N=E),he==ct?(f.warning('attribute "'+N+'" missed quot(")!'),p(E,N,e)):((!Fe.isHTML(r[""])||!N.match(/^(?:disabled|checked|selected)$/i))&&f.warning('attribute "'+N+'" missed value!! "'+N+'" instead!!'),p(N,N,e));break;case ot:throw new Error("attribute value missed!!")}return $;case"\x80":Te=" ";default:if(Te<=" ")switch(he){case Ve:t.setTagName(i.slice(e,$)),he=wt;break;case Ze:E=i.slice(e,$),he=et;break;case ct:var N=i.slice(e,$);f.warning('attribute "'+N+'" missed quot(")!!'),p(E,N,e);case yt:he=wt;break}else switch(he){case et:t.tagName,(!Fe.isHTML(r[""])||!E.match(/^(?:disabled|checked|selected)$/i))&&f.warning('attribute "'+E+'" missed value!! "'+E+'" instead2!!'),p(E,E,e),e=$,he=Ze;break;case yt:f.warning('attribute space is required"'+E+'"!!');case wt:he=Ze,e=$;break;case ot:he=ct,e=$;break;case It:throw new Error("elements closed character '/' and '>' must be connected to")}}$++}}function Ai(i,e,t){for(var r=i.tagName,o=null,Te=i.length;Te--;){var f=i[Te],p=f.qName,E=f.value,we=p.indexOf(":");if(we>0)var N=f.prefix=p.slice(0,we),$=p.slice(we+1),he=N==="xmlns"&&$;else $=p,N=null,he=p==="xmlns"&&"";f.localName=$,he!==!1&&(o==null&&(o={},Yi(t,t={})),t[he]=o[he]=E,f.uri=Fe.XMLNS,e.startPrefixMapping(he,E))}for(var Te=i.length;Te--;){f=i[Te];var N=f.prefix;N&&(N==="xml"&&(f.uri=Fe.XML),N!=="xmlns"&&(f.uri=t[N||""]))}var we=r.indexOf(":");we>0?(N=i.prefix=r.slice(0,we),$=i.localName=r.slice(we+1)):(N=null,$=i.localName=r);var Me=i.uri=t[N||""];if(e.startElement(Me,$,r,i),i.closed){if(e.endElement(Me,$,r),o)for(N in o)Object.prototype.hasOwnProperty.call(o,N)&&e.endPrefixMapping(N)}else return i.currentNSMap=t,i.localNSMap=o,!0}function li(i,e,t,r,o){if(/^(?:script|textarea)$/i.test(t)){var f=i.indexOf("</"+t+">",e),p=i.substring(e+1,f);if(/[&<]/.test(p))return/^script$/i.test(t)?(o.characters(p,0,p.length),f):(p=p.replace(/&#?\w+;/g,r),o.characters(p,0,p.length),f)}return e+1}function rr(i,e,t,r){var o=r[t];return o==null&&(o=i.lastIndexOf("</"+t+">"),o<e&&(o=i.lastIndexOf("</"+t)),r[t]=o),o<e}function Yi(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}function Lr(i,e,t,r){var o=i.charAt(e+2);switch(o){case"-":if(i.charAt(e+3)==="-"){var f=i.indexOf("-->",e+4);return f>e?(t.comment(i,e+4,f-e-4),f+3):(r.error("Unclosed comment"),-1)}else return-1;default:if(i.substr(e+3,6)=="CDATA["){var f=i.indexOf("]]>",e+9);return t.startCDATA(),t.characters(i,e+9,f-e-9),t.endCDATA(),f+3}var p=_n(i,e),E=p.length;if(E>1&&/!doctype/i.test(p[0][0])){var N=p[1][0],$=!1,he=!1;E>3&&(/^public$/i.test(p[2][0])?($=p[3][0],he=E>4&&p[4][0]):/^system$/i.test(p[2][0])&&(he=p[3][0]));var Te=p[E-1];return t.startDTD(N,$,he),t.endDTD(),Te.index+Te[0].length}}return-1}function Si(i,e,t){var r=i.indexOf("?>",e);if(r){var o=i.substring(e,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return o?(o[0].length,t.processingInstruction(o[1],o[2]),r+2):-1}return-1}function Bi(){this.attributeNames={}}Bi.prototype={setTagName:function(i){if(!ze.test(i))throw new Error("invalid tagName:"+i);this.tagName=i},addValue:function(i,e,t){if(!ze.test(i))throw new Error("invalid attribute:"+i);this.attributeNames[i]=this.length,this[this.length++]={qName:i,value:e,offset:t}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function _n(i,e){var t,r=[],o=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(o.lastIndex=e,o.exec(i);t=o.exec(i);)if(r.push(t),t[1])return r}var bn=jt,ci=Ht,Gr={XMLReader:bn,ParseError:ci},dn=xe.DOMImplementation,Oi=Xo.NAMESPACE,ar=Gr.ParseError,br=Gr.XMLReader;function Jr(i){return i.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function Ki(i){this.options=i||{locator:{}}}Ki.prototype.parseFromString=function(i,e){var t=this.options,r=new br,o=t.domBuilder||new Gs,f=t.errorHandler,p=t.locator,E=t.xmlns||{},N=/\/x?html?$/.test(e),$=N?De.HTML_ENTITIES:De.XML_ENTITIES;p&&o.setDocumentLocator(p),r.errorHandler=Us(f,o,p),r.domBuilder=t.domBuilder||o,N&&(E[""]=Oi.HTML),E.xml=E.xml||Oi.XML;var he=t.normalizeLineEndings||Jr;return i&&typeof i=="string"?r.parse(he(i),E,$):r.errorHandler.error("invalid doc source"),o.doc};function Us(i,e,t){if(!i){if(e instanceof Gs)return e;i=e}var r={},o=i instanceof Function;t=t||{};function f(p){var E=i[p];!E&&o&&(E=i.length==2?function(N){i(p,N)}:i),r[p]=E&&function(N){E("[xmldom "+p+"]	"+N+fa(t))}||function(){}}return f("warning"),f("error"),f("fatalError"),r}function Gs(){this.cdata=!1}function An(i,e){e.lineNumber=i.lineNumber,e.columnNumber=i.columnNumber}Gs.prototype={startDocument:function(){this.doc=new dn().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(i,e,t,r){var o=this.doc,f=o.createElementNS(i,t||e),p=r.length;nl(this,f),this.currentElement=f,this.locator&&An(this.locator,f);for(var E=0;E<p;E++){var i=r.getURI(E),N=r.getValue(E),t=r.getQName(E),$=o.createAttributeNS(i,t);this.locator&&An(r.getLocator(E),$),$.value=$.nodeValue=N,f.setAttributeNode($)}},endElement:function(i,e,t){var r=this.currentElement;r.tagName,this.currentElement=r.parentNode},startPrefixMapping:function(i,e){},endPrefixMapping:function(i){},processingInstruction:function(i,e){var t=this.doc.createProcessingInstruction(i,e);this.locator&&An(this.locator,t),nl(this,t)},ignorableWhitespace:function(i,e,t){},characters:function(i,e,t){if(i=Qn.apply(this,arguments),i){if(this.cdata)var r=this.doc.createCDATASection(i);else var r=this.doc.createTextNode(i);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(i)&&this.doc.appendChild(r),this.locator&&An(this.locator,r)}},skippedEntity:function(i){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(i){(this.locator=i)&&(i.lineNumber=0)},comment:function(i,e,t){i=Qn.apply(this,arguments);var r=this.doc.createComment(i);this.locator&&An(this.locator,r),nl(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(i,e,t){var r=this.doc.implementation;if(r&&r.createDocumentType){var o=r.createDocumentType(i,e,t);this.locator&&An(this.locator,o),nl(this,o),this.doc.doctype=o}},warning:function(i){console.warn("[xmldom warning]	"+i,fa(this.locator))},error:function(i){console.error("[xmldom error]	"+i,fa(this.locator))},fatalError:function(i){throw new ar(i,this.locator)}};function fa(i){if(i)return`
@`+(i.systemId||"")+"#[line:"+i.lineNumber+",col:"+i.columnNumber+"]"}function Qn(i,e,t){return typeof i=="string"?i.substr(e,t):i.length>=e+t||e?new java.lang.String(i,e,t)+"":i}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(i){Gs.prototype[i]=function(){return null}});function nl(i,e){i.currentElement?i.currentElement.appendChild(e):i.doc.appendChild(e)}var uu=Gs,xf=Jr,_c=Ki,Cf={__DOMHandler:uu,normalizeLineEndings:xf,DOMParser:_c},Xd=Cf.DOMParser;/*! @name mpd-parser @version 1.3.0 @license Apache-2.0 */const cu=i=>!!i&&typeof i=="object",vi=(...i)=>i.reduce((e,t)=>(typeof t!="object"||Object.keys(t).forEach(r=>{Array.isArray(e[r])&&Array.isArray(t[r])?e[r]=e[r].concat(t[r]):cu(e[r])&&cu(t[r])?e[r]=vi(e[r],t[r]):e[r]=t[r]}),e),{}),bc=i=>Object.keys(i).map(e=>i[e]),Qd=(i,e)=>{const t=[];for(let r=i;r<e;r++)t.push(r);return t},_o=i=>i.reduce((e,t)=>e.concat(t),[]),Jd=i=>{if(!i.length)return[];const e=[];for(let t=0;t<i.length;t++)e.push(i[t]);return e},kf=(i,e)=>i.reduce((t,r,o)=>(r[e]&&t.push(o),t),[]),Df=(i,e)=>bc(i.reduce((t,r)=>(r.forEach(o=>{t[e(o)]=o}),t),{}));var bo={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",INVALID_NUMBER_OF_CONTENT_STEERING:"INVALID_NUMBER_OF_CONTENT_STEERING",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const pa=({baseUrl:i="",source:e="",range:t="",indexRange:r=""})=>{const o={uri:e,resolvedUri:Ql(i||"",e)};if(t||r){const p=(t||r).split("-");let E=window.BigInt?window.BigInt(p[0]):parseInt(p[0],10),N=window.BigInt?window.BigInt(p[1]):parseInt(p[1],10);E<Number.MAX_SAFE_INTEGER&&typeof E=="bigint"&&(E=Number(E)),N<Number.MAX_SAFE_INTEGER&&typeof N=="bigint"&&(N=Number(N));let $;typeof N=="bigint"||typeof E=="bigint"?$=window.BigInt(N)-window.BigInt(E)+window.BigInt(1):$=N-E+1,typeof $=="bigint"&&$<Number.MAX_SAFE_INTEGER&&($=Number($)),o.byterange={length:$,offset:E}}return o},Zd=i=>{let e;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=window.BigInt(i.offset)+window.BigInt(i.length)-window.BigInt(1):e=i.offset+i.length-1,`${i.offset}-${e}`},eh=i=>(i&&typeof i!="number"&&(i=parseInt(i,10)),isNaN(i)?null:i),wf={static(i){const{duration:e,timescale:t=1,sourceDuration:r,periodDuration:o}=i,f=eh(i.endNumber),p=e/t;return typeof f=="number"?{start:0,end:f}:typeof o=="number"?{start:0,end:o/p}:{start:0,end:r/p}},dynamic(i){const{NOW:e,clientOffset:t,availabilityStartTime:r,timescale:o=1,duration:f,periodStart:p=0,minimumUpdatePeriod:E=0,timeShiftBufferDepth:N=1/0}=i,$=eh(i.endNumber),he=(e+t)/1e3,Te=r+p,Me=he+E-Te,Ge=Math.ceil(Me*o/f),ke=Math.floor((he-Te-N)*o/f),qe=Math.floor((he-Te)*o/f);return{start:Math.max(0,ke),end:typeof $=="number"?$:Math.min(Ge,qe)}}},vv=i=>e=>{const{duration:t,timescale:r=1,periodStart:o,startNumber:f=1}=i;return{number:f+e,duration:t/r,timeline:o,time:e*t}},Lf=i=>{const{type:e,duration:t,timescale:r=1,periodDuration:o,sourceDuration:f}=i,{start:p,end:E}=wf[e](i),N=Qd(p,E).map(vv(i));if(e==="static"){const $=N.length-1,he=typeof o=="number"?o:f;N[$].duration=he-t/r*$}return N},Op=i=>{const{baseUrl:e,initialization:t={},sourceDuration:r,indexRange:o="",periodStart:f,presentationTime:p,number:E=0,duration:N}=i;if(!e)throw new Error(bo.NO_BASE_URL);const $=pa({baseUrl:e,source:t.sourceURL,range:t.range}),he=pa({baseUrl:e,source:e,indexRange:o});if(he.map=$,N){const Te=Lf(i);Te.length&&(he.duration=Te[0].duration,he.timeline=Te[0].timeline)}else r&&(he.duration=r,he.timeline=f);return he.presentationTime=p||f,he.number=E,[he]},If=(i,e,t)=>{const r=i.sidx.map?i.sidx.map:null,o=i.sidx.duration,f=i.timeline||0,p=i.sidx.byterange,E=p.offset+p.length,N=e.timescale,$=e.references.filter(qe=>qe.referenceType!==1),he=[],Te=i.endList?"static":"dynamic",we=i.sidx.timeline;let Me=we,Ge=i.mediaSequence||0,ke;typeof e.firstOffset=="bigint"?ke=window.BigInt(E)+e.firstOffset:ke=E+e.firstOffset;for(let qe=0;qe<$.length;qe++){const $e=e.references[qe],tt=$e.referencedSize,Je=$e.subsegmentDuration;let st;typeof ke=="bigint"?st=ke+window.BigInt(tt)-window.BigInt(1):st=ke+tt-1;const We=`${ke}-${st}`,Dt=Op({baseUrl:t,timescale:N,timeline:f,periodStart:we,presentationTime:Me,number:Ge,duration:Je,sourceDuration:o,indexRange:We,type:Te})[0];r&&(Dt.map=r),he.push(Dt),typeof ke=="bigint"?ke+=window.BigInt(tt):ke+=tt,Me+=Je/N,Ge++}return i.segments=he,i},yv=["AUDIO","SUBTITLES"],Tv=1/60,Mp=i=>Df(i,({timeline:e})=>e).sort((e,t)=>e.timeline>t.timeline?1:-1),Ev=(i,e)=>{for(let t=0;t<i.length;t++)if(i[t].attributes.NAME===e)return i[t];return null},Np=i=>{let e=[];return pf(i,yv,(t,r,o,f)=>{e=e.concat(t.playlists||[])}),e},Fp=({playlist:i,mediaSequence:e})=>{i.mediaSequence=e,i.segments.forEach((t,r)=>{t.number=i.mediaSequence+r})},_v=({oldPlaylists:i,newPlaylists:e,timelineStarts:t})=>{e.forEach(r=>{r.discontinuitySequence=t.findIndex(function({timeline:N}){return N===r.timeline});const o=Ev(i,r.attributes.NAME);if(!o||r.sidx)return;const f=r.segments[0],p=o.segments.findIndex(function(N){return Math.abs(N.presentationTime-f.presentationTime)<Tv});if(p===-1){Fp({playlist:r,mediaSequence:o.mediaSequence+o.segments.length}),r.segments[0].discontinuity=!0,r.discontinuityStarts.unshift(0),(!o.segments.length&&r.timeline>o.timeline||o.segments.length&&r.timeline>o.segments[o.segments.length-1].timeline)&&r.discontinuitySequence--;return}o.segments[p].discontinuity&&!f.discontinuity&&(f.discontinuity=!0,r.discontinuityStarts.unshift(0),r.discontinuitySequence--),Fp({playlist:r,mediaSequence:o.segments[p].number})})},bv=({oldManifest:i,newManifest:e})=>{const t=i.playlists.concat(Np(i)),r=e.playlists.concat(Np(e));return e.timelineStarts=Mp([i.timelineStarts,e.timelineStarts]),_v({oldPlaylists:t,newPlaylists:r,timelineStarts:e.timelineStarts}),e},th=i=>i&&i.uri+"-"+Zd(i.byterange),Rf=i=>{const e=i.reduce(function(r,o){return r[o.attributes.baseUrl]||(r[o.attributes.baseUrl]=[]),r[o.attributes.baseUrl].push(o),r},{});let t=[];return Object.values(e).forEach(r=>{const o=bc(r.reduce((f,p)=>{const E=p.attributes.id+(p.attributes.lang||"");return f[E]?(p.segments&&(p.segments[0]&&(p.segments[0].discontinuity=!0),f[E].segments.push(...p.segments)),p.attributes.contentProtection&&(f[E].attributes.contentProtection=p.attributes.contentProtection)):(f[E]=p,f[E].attributes.timelineStarts=[]),f[E].attributes.timelineStarts.push({start:p.attributes.periodStart,timeline:p.attributes.periodStart}),f},{}));t=t.concat(o)}),t.map(r=>(r.discontinuityStarts=kf(r.segments||[],"discontinuity"),r))},Pf=(i,e)=>{const t=th(i.sidx),r=t&&e[t]&&e[t].sidx;return r&&If(i,r,i.sidx.resolvedUri),i},Av=(i,e={})=>{if(!Object.keys(e).length)return i;for(const t in i)i[t]=Pf(i[t],e);return i},Sv=({attributes:i,segments:e,sidx:t,mediaSequence:r,discontinuitySequence:o,discontinuityStarts:f},p)=>{const E={attributes:{NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,discontinuitySequence:o,discontinuityStarts:f,timelineStarts:i.timelineStarts,mediaSequence:r,segments:e};return i.contentProtection&&(E.contentProtection=i.contentProtection),i.serviceLocation&&(E.attributes.serviceLocation=i.serviceLocation),t&&(E.sidx=t),p&&(E.attributes.AUDIO="audio",E.attributes.SUBTITLES="subs"),E},xv=({attributes:i,segments:e,mediaSequence:t,discontinuityStarts:r,discontinuitySequence:o})=>{typeof e>"u"&&(e=[{uri:i.baseUrl,timeline:i.periodStart,resolvedUri:i.baseUrl||"",duration:i.sourceDuration,number:0}],i.duration=i.sourceDuration);const f={NAME:i.id,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1};i.codecs&&(f.CODECS=i.codecs);const p={attributes:f,uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,timelineStarts:i.timelineStarts,discontinuityStarts:r,discontinuitySequence:o,mediaSequence:t,segments:e};return i.serviceLocation&&(p.attributes.serviceLocation=i.serviceLocation),p},Cv=(i,e={},t=!1)=>{let r;const o=i.reduce((f,p)=>{const E=p.attributes.role&&p.attributes.role.value||"",N=p.attributes.lang||"";let $=p.attributes.label||"main";if(N&&!p.attributes.label){const Te=E?` (${E})`:"";$=`${p.attributes.lang}${Te}`}f[$]||(f[$]={language:N,autoselect:!0,default:E==="main",playlists:[],uri:""});const he=Pf(Sv(p,t),e);return f[$].playlists.push(he),typeof r>"u"&&E==="main"&&(r=p,r.default=!0),f},{});if(!r){const f=Object.keys(o)[0];o[f].default=!0}return o},kv=(i,e={})=>i.reduce((t,r)=>{const o=r.attributes.label||r.attributes.lang||"text";return t[o]||(t[o]={language:o,default:!1,autoselect:!1,playlists:[],uri:""}),t[o].playlists.push(Pf(xv(r),e)),t},{}),Dv=i=>i.reduce((e,t)=>(t&&t.forEach(r=>{const{channel:o,language:f}=r;e[f]={autoselect:!1,default:!1,instreamId:o,language:f},r.hasOwnProperty("aspectRatio")&&(e[f].aspectRatio=r.aspectRatio),r.hasOwnProperty("easyReader")&&(e[f].easyReader=r.easyReader),r.hasOwnProperty("3D")&&(e[f]["3D"]=r["3D"])}),e),{}),wv=({attributes:i,segments:e,sidx:t,discontinuityStarts:r})=>{const o={attributes:{NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,discontinuityStarts:r,timelineStarts:i.timelineStarts,segments:e};return i.frameRate&&(o.attributes["FRAME-RATE"]=i.frameRate),i.contentProtection&&(o.contentProtection=i.contentProtection),i.serviceLocation&&(o.attributes.serviceLocation=i.serviceLocation),t&&(o.sidx=t),o},Lv=({attributes:i})=>i.mimeType==="video/mp4"||i.mimeType==="video/webm"||i.contentType==="video",Iv=({attributes:i})=>i.mimeType==="audio/mp4"||i.mimeType==="audio/webm"||i.contentType==="audio",Rv=({attributes:i})=>i.mimeType==="text/vtt"||i.contentType==="text",Pv=(i,e)=>{i.forEach(t=>{t.mediaSequence=0,t.discontinuitySequence=e.findIndex(function({timeline:r}){return r===t.timeline}),t.segments&&t.segments.forEach((r,o)=>{r.number=o})})},Bp=i=>i?Object.keys(i).reduce((e,t)=>{const r=i[t];return e.concat(r.playlists)},[]):[],Ov=({dashPlaylists:i,locations:e,contentSteering:t,sidxMapping:r={},previousManifest:o,eventStream:f})=>{if(!i.length)return{};const{sourceDuration:p,type:E,suggestedPresentationDelay:N,minimumUpdatePeriod:$}=i[0].attributes,he=Rf(i.filter(Lv)).map(wv),Te=Rf(i.filter(Iv)),we=Rf(i.filter(Rv)),Me=i.map(st=>st.attributes.captionServices).filter(Boolean),Ge={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:p,playlists:Av(he,r)};$>=0&&(Ge.minimumUpdatePeriod=$*1e3),e&&(Ge.locations=e),t&&(Ge.contentSteering=t),E==="dynamic"&&(Ge.suggestedPresentationDelay=N),f&&f.length>0&&(Ge.eventStream=f);const ke=Ge.playlists.length===0,qe=Te.length?Cv(Te,r,ke):null,$e=we.length?kv(we,r):null,tt=he.concat(Bp(qe),Bp($e)),Je=tt.map(({timelineStarts:st})=>st);return Ge.timelineStarts=Mp(Je),Pv(tt,Ge.timelineStarts),qe&&(Ge.mediaGroups.AUDIO.audio=qe),$e&&(Ge.mediaGroups.SUBTITLES.subs=$e),Me.length&&(Ge.mediaGroups["CLOSED-CAPTIONS"].cc=Dv(Me)),o?bv({oldManifest:o,newManifest:Ge}):Ge},Mv=(i,e,t)=>{const{NOW:r,clientOffset:o,availabilityStartTime:f,timescale:p=1,periodStart:E=0,minimumUpdatePeriod:N=0}=i,$=(r+o)/1e3,he=f+E,we=$+N-he;return Math.ceil((we*p-e)/t)},Up=(i,e)=>{const{type:t,minimumUpdatePeriod:r=0,media:o="",sourceDuration:f,timescale:p=1,startNumber:E=1,periodStart:N}=i,$=[];let he=-1;for(let Te=0;Te<e.length;Te++){const we=e[Te],Me=we.d,Ge=we.r||0,ke=we.t||0;he<0&&(he=ke),ke&&ke>he&&(he=ke);let qe;if(Ge<0){const Je=Te+1;Je===e.length?t==="dynamic"&&r>0&&o.indexOf("$Number$")>0?qe=Mv(i,he,Me):qe=(f*p-he)/Me:qe=(e[Je].t-he)/Me}else qe=Ge+1;const $e=E+$.length+qe;let tt=E+$.length;for(;tt<$e;)$.push({number:tt,duration:Me/p,time:he,timeline:N}),he+=Me,tt++}return $},Nv=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,Fv=i=>(e,t,r,o)=>{if(e==="$$")return"$";if(typeof i[t]>"u")return e;const f=""+i[t];return t==="RepresentationID"||(r?o=parseInt(o,10):o=1,f.length>=o)?f:`${new Array(o-f.length+1).join("0")}${f}`},Gp=(i,e)=>i.replace(Nv,Fv(e)),Bv=(i,e)=>!i.duration&&!e?[{number:i.startNumber||1,duration:i.sourceDuration,time:0,timeline:i.periodStart}]:i.duration?Lf(i):Up(i,e),Uv=(i,e)=>{const t={RepresentationID:i.id,Bandwidth:i.bandwidth||0},{initialization:r={sourceURL:"",range:""}}=i,o=pa({baseUrl:i.baseUrl,source:Gp(r.sourceURL,t),range:r.range});return Bv(i,e).map(p=>{t.Number=p.number,t.Time=p.time;const E=Gp(i.media||"",t),N=i.timescale||1,$=i.presentationTimeOffset||0,he=i.periodStart+(p.time-$)/N;return{uri:E,timeline:p.timeline,duration:p.duration,resolvedUri:Ql(i.baseUrl||"",E),map:o,number:p.number,presentationTime:he}})},Gv=(i,e)=>{const{baseUrl:t,initialization:r={}}=i,o=pa({baseUrl:t,source:r.sourceURL,range:r.range}),f=pa({baseUrl:t,source:e.media,range:e.mediaRange});return f.map=o,f},Vv=(i,e)=>{const{duration:t,segmentUrls:r=[],periodStart:o}=i;if(!t&&!e||t&&e)throw new Error(bo.SEGMENT_TIME_UNSPECIFIED);const f=r.map(N=>Gv(i,N));let p;return t&&(p=Lf(i)),e&&(p=Up(i,e)),p.map((N,$)=>{if(f[$]){const he=f[$],Te=i.timescale||1,we=i.presentationTimeOffset||0;return he.timeline=N.timeline,he.duration=N.duration,he.number=N.number,he.presentationTime=o+(N.time-we)/Te,he}}).filter(N=>N)},Hv=({attributes:i,segmentInfo:e})=>{let t,r;e.template?(r=Uv,t=vi(i,e.template)):e.base?(r=Op,t=vi(i,e.base)):e.list&&(r=Vv,t=vi(i,e.list));const o={attributes:i};if(!r)return o;const f=r(t,e.segmentTimeline);if(t.duration){const{duration:p,timescale:E=1}=t;t.duration=p/E}else f.length?t.duration=f.reduce((p,E)=>Math.max(p,Math.ceil(E.duration)),0):t.duration=0;return o.attributes=t,o.segments=f,e.base&&t.indexRange&&(o.sidx=f[0],o.segments=[]),o},jv=i=>i.map(Hv),Xi=(i,e)=>Jd(i.childNodes).filter(({tagName:t})=>t===e),Ac=i=>i.textContent.trim(),Kv=i=>parseFloat(i.split("/").reduce((e,t)=>e/t)),du=i=>{const E=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(i);if(!E)return 0;const[N,$,he,Te,we,Me]=E.slice(1);return parseFloat(N||0)*31536e3+parseFloat($||0)*2592e3+parseFloat(he||0)*86400+parseFloat(Te||0)*3600+parseFloat(we||0)*60+parseFloat(Me||0)},qv=i=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(i)&&(i+="Z"),Date.parse(i)),Vp={mediaPresentationDuration(i){return du(i)},availabilityStartTime(i){return qv(i)/1e3},minimumUpdatePeriod(i){return du(i)},suggestedPresentationDelay(i){return du(i)},type(i){return i},timeShiftBufferDepth(i){return du(i)},start(i){return du(i)},width(i){return parseInt(i,10)},height(i){return parseInt(i,10)},bandwidth(i){return parseInt(i,10)},frameRate(i){return Kv(i)},startNumber(i){return parseInt(i,10)},timescale(i){return parseInt(i,10)},presentationTimeOffset(i){return parseInt(i,10)},duration(i){const e=parseInt(i,10);return isNaN(e)?du(i):e},d(i){return parseInt(i,10)},t(i){return parseInt(i,10)},r(i){return parseInt(i,10)},presentationTime(i){return parseInt(i,10)},DEFAULT(i){return i}},Ar=i=>i&&i.attributes?Jd(i.attributes).reduce((e,t)=>{const r=Vp[t.name]||Vp.DEFAULT;return e[t.name]=r(t.value),e},{}):{},$v={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},ih=(i,e)=>e.length?_o(i.map(function(t){return e.map(function(r){const o=Ac(r),f=Ql(t.baseUrl,o),p=vi(Ar(r),{baseUrl:f});return f!==o&&!p.serviceLocation&&t.serviceLocation&&(p.serviceLocation=t.serviceLocation),p})})):i,Of=i=>{const e=Xi(i,"SegmentTemplate")[0],t=Xi(i,"SegmentList")[0],r=t&&Xi(t,"SegmentURL").map(Te=>vi({tag:"SegmentURL"},Ar(Te))),o=Xi(i,"SegmentBase")[0],f=t||e,p=f&&Xi(f,"SegmentTimeline")[0],E=t||o||e,N=E&&Xi(E,"Initialization")[0],$=e&&Ar(e);$&&N?$.initialization=N&&Ar(N):$&&$.initialization&&($.initialization={sourceURL:$.initialization});const he={template:$,segmentTimeline:p&&Xi(p,"S").map(Te=>Ar(Te)),list:t&&vi(Ar(t),{segmentUrls:r,initialization:Ar(N)}),base:o&&vi(Ar(o),{initialization:Ar(N)})};return Object.keys(he).forEach(Te=>{he[Te]||delete he[Te]}),he},Wv=(i,e,t)=>r=>{const o=Xi(r,"BaseURL"),f=ih(e,o),p=vi(i,Ar(r)),E=Of(r);return f.map(N=>({segmentInfo:vi(t,E),attributes:vi(p,N)}))},zv=i=>i.reduce((e,t)=>{const r=Ar(t);r.schemeIdUri&&(r.schemeIdUri=r.schemeIdUri.toLowerCase());const o=$v[r.schemeIdUri];if(o){e[o]={attributes:r};const f=Xi(t,"cenc:pssh")[0];if(f){const p=Ac(f);e[o].pssh=p&&ec(p)}}return e},{}),Yv=i=>{if(i.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{let r,o;return o=t,/^CC\d=/.test(t)?[r,o]=t.split("="):/^CC\d$/.test(t)&&(r=t),{channel:r,language:o}});if(i.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{const r={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){const[o,f=""]=t.split("=");r.channel=o,r.language=t,f.split(",").forEach(p=>{const[E,N]=p.split(":");E==="lang"?r.language=N:E==="er"?r.easyReader=Number(N):E==="war"?r.aspectRatio=Number(N):E==="3D"&&(r["3D"]=Number(N))})}else r.language=t;return r.channel&&(r.channel="SERVICE"+r.channel),r})},Xv=i=>_o(Xi(i.node,"EventStream").map(e=>{const t=Ar(e),r=t.schemeIdUri;return Xi(e,"Event").map(o=>{const f=Ar(o),p=f.presentationTime||0,E=t.timescale||1,N=f.duration||0,$=p/E+i.attributes.start;return{schemeIdUri:r,value:t.value,id:f.id,start:$,end:$+N/E,messageData:Ac(o)||f.messageData,contentEncoding:t.contentEncoding,presentationTimeOffset:t.presentationTimeOffset||0}})})),Qv=(i,e,t)=>r=>{const o=Ar(r),f=ih(e,Xi(r,"BaseURL")),p=Xi(r,"Role")[0],E={role:Ar(p)};let N=vi(i,o,E);const $=Xi(r,"Accessibility")[0],he=Yv(Ar($));he&&(N=vi(N,{captionServices:he}));const Te=Xi(r,"Label")[0];if(Te&&Te.childNodes.length){const qe=Te.childNodes[0].nodeValue.trim();N=vi(N,{label:qe})}const we=zv(Xi(r,"ContentProtection"));Object.keys(we).length&&(N=vi(N,{contentProtection:we}));const Me=Of(r),Ge=Xi(r,"Representation"),ke=vi(t,Me);return _o(Ge.map(Wv(N,f,ke)))},Jv=(i,e)=>(t,r)=>{const o=ih(e,Xi(t.node,"BaseURL")),f=vi(i,{periodStart:t.attributes.start});typeof t.attributes.duration=="number"&&(f.periodDuration=t.attributes.duration);const p=Xi(t.node,"AdaptationSet"),E=Of(t.node);return _o(p.map(Qv(f,o,E)))},Zv=(i,e)=>{if(i.length>1&&e({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!i.length)return null;const t=vi({serverURL:Ac(i[0])},Ar(i[0]));return t.queryBeforeStart=t.queryBeforeStart==="true",t},e0=({attributes:i,priorPeriodAttributes:e,mpdType:t})=>typeof i.start=="number"?i.start:e&&typeof e.start=="number"&&typeof e.duration=="number"?e.start+e.duration:!e&&t==="static"?0:null,t0=(i,e={})=>{const{manifestUri:t="",NOW:r=Date.now(),clientOffset:o=0,eventHandler:f=function(){}}=e,p=Xi(i,"Period");if(!p.length)throw new Error(bo.INVALID_NUMBER_OF_PERIOD);const E=Xi(i,"Location"),N=Ar(i),$=ih([{baseUrl:t}],Xi(i,"BaseURL")),he=Xi(i,"ContentSteering");N.type=N.type||"static",N.sourceDuration=N.mediaPresentationDuration||0,N.NOW=r,N.clientOffset=o,E.length&&(N.locations=E.map(Ac));const Te=[];return p.forEach((we,Me)=>{const Ge=Ar(we),ke=Te[Me-1];Ge.start=e0({attributes:Ge,priorPeriodAttributes:ke?ke.attributes:null,mpdType:N.type}),Te.push({node:we,attributes:Ge})}),{locations:N.locations,contentSteeringInfo:Zv(he,f),representationInfo:_o(Te.map(Jv(N,$))),eventStream:_o(Te.map(Xv))}},Hp=i=>{if(i==="")throw new Error(bo.DASH_EMPTY_MANIFEST);const e=new Xd;let t,r;try{t=e.parseFromString(i,"application/xml"),r=t&&t.documentElement.tagName==="MPD"?t.documentElement:null}catch{}if(!r||r&&r.getElementsByTagName("parsererror").length>0)throw new Error(bo.DASH_INVALID_XML);return r},i0=i=>{const e=Xi(i,"UTCTiming")[0];if(!e)return null;const t=Ar(e);switch(t.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":t.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":t.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":t.method="DIRECT",t.value=Date.parse(t.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(bo.UNSUPPORTED_UTC_TIMING_SCHEME)}return t},r0=(i,e={})=>{const t=t0(Hp(i),e),r=jv(t.representationInfo);return Ov({dashPlaylists:r,locations:t.locations,contentSteering:t.contentSteeringInfo,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest,eventStream:t.eventStream})},n0=i=>i0(Hp(i));var jp=Math.pow(2,32),s0=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t;return e.getBigUint64?(t=e.getBigUint64(0),t<Number.MAX_SAFE_INTEGER?Number(t):t):e.getUint32(0)*jp+e.getUint32(4)},a0={getUint64:s0,MAX_UINT32:jp},Kp=a0.getUint64,o0=function(i){var e=new DataView(i.buffer,i.byteOffset,i.byteLength),t={version:i[0],flags:new Uint8Array(i.subarray(1,4)),references:[],referenceId:e.getUint32(4),timescale:e.getUint32(8)},r=12;t.version===0?(t.earliestPresentationTime=e.getUint32(r),t.firstOffset=e.getUint32(r+4),r+=8):(t.earliestPresentationTime=Kp(i.subarray(r)),t.firstOffset=Kp(i.subarray(r+8)),r+=16),r+=2;var o=e.getUint16(r);for(r+=2;o>0;r+=12,o--)t.references.push({referenceType:(i[r]&128)>>>7,referencedSize:e.getUint32(r)&2147483647,subsegmentDuration:e.getUint32(r+4),startsWithSap:!!(i[r+8]&128),sapType:(i[r+8]&112)>>>4,sapDeltaTime:e.getUint32(r+8)&268435455});return t},l0=o0,u0=Ft([73,68,51]),c0=function(e,t){t===void 0&&(t=0),e=Ft(e);var r=e[t+5],o=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],f=(r&16)>>4;return f?o+20:o+10},Sc=function i(e,t){return t===void 0&&(t=0),e=Ft(e),e.length-t<10||!Fi(e,u0,{offset:t})?t:(t+=c0(e,t),i(e,t))},qp=function(e){return typeof e=="string"?wd(e):e},d0=function(e){return Array.isArray(e)?e.map(function(t){return qp(t)}):[qp(e)]},h0=function i(e,t,r){r===void 0&&(r=!1),t=d0(t),e=Ft(e);var o=[];if(!t.length)return o;for(var f=0;f<e.length;){var p=(e[f]<<24|e[f+1]<<16|e[f+2]<<8|e[f+3])>>>0,E=e.subarray(f+4,f+8);if(p===0)break;var N=f+p;if(N>e.length){if(r)break;N=e.length}var $=e.subarray(f+8,N);Fi(E,t[0])&&(t.length===1?o.push($):o.push.apply(o,i($,t.slice(1),r))),f=N}return o},rh={EBML:Ft([26,69,223,163]),DocType:Ft([66,130]),Segment:Ft([24,83,128,103]),SegmentInfo:Ft([21,73,169,102]),Tracks:Ft([22,84,174,107]),Track:Ft([174]),TrackNumber:Ft([215]),DefaultDuration:Ft([35,227,131]),TrackEntry:Ft([174]),TrackType:Ft([131]),FlagDefault:Ft([136]),CodecID:Ft([134]),CodecPrivate:Ft([99,162]),VideoTrack:Ft([224]),AudioTrack:Ft([225]),Cluster:Ft([31,67,182,117]),Timestamp:Ft([231]),TimestampScale:Ft([42,215,177]),BlockGroup:Ft([160]),BlockDuration:Ft([155]),Block:Ft([161]),SimpleBlock:Ft([163])},Mf=[128,64,32,16,8,4,2,1],f0=function(e){for(var t=1,r=0;r<Mf.length&&!(e&Mf[r]);r++)t++;return t},nh=function(e,t,r,o){r===void 0&&(r=!0),o===void 0&&(o=!1);var f=f0(e[t]),p=e.subarray(t,t+f);return r&&(p=Array.prototype.slice.call(e,t,t+f),p[0]^=Mf[f-1]),{length:f,value:df(p,{signed:o}),bytes:p}},$p=function i(e){return typeof e=="string"?e.match(/.{1,2}/g).map(function(t){return i(t)}):typeof e=="number"?hf(e):e},p0=function(e){return Array.isArray(e)?e.map(function(t){return $p(t)}):[$p(e)]},g0=function i(e,t,r){if(r>=t.length)return t.length;var o=nh(t,r,!1);if(Fi(e.bytes,o.bytes))return r;var f=nh(t,r+o.length);return i(e,t,r+f.length+f.value+o.length)},Wp=function i(e,t){t=p0(t),e=Ft(e);var r=[];if(!t.length)return r;for(var o=0;o<e.length;){var f=nh(e,o,!1),p=nh(e,o+f.length),E=o+f.length+p.length;p.value===127&&(p.value=g0(f,e,E),p.value!==e.length&&(p.value-=E));var N=E+p.value>e.length?e.length:E+p.value,$=e.subarray(E,N);Fi(t[0],f.bytes)&&(t.length===1?r.push($):r=r.concat(i($,t.slice(1))));var he=f.length+p.length+$.length;o+=he}return r},m0=Ft([0,0,0,1]),v0=Ft([0,0,1]),y0=Ft([0,0,3]),T0=function(e){for(var t=[],r=1;r<e.length-2;)Fi(e.subarray(r,r+3),y0)&&(t.push(r+2),r++),r++;if(t.length===0)return e;var o=e.length-t.length,f=new Uint8Array(o),p=0;for(r=0;r<o;p++,r++)p===t[0]&&(p++,t.shift()),f[r]=e[p];return f},zp=function(e,t,r,o){o===void 0&&(o=1/0),e=Ft(e),r=[].concat(r);for(var f=0,p,E=0;f<e.length&&(E<o||p);){var N=void 0;if(Fi(e.subarray(f),m0)?N=4:Fi(e.subarray(f),v0)&&(N=3),!N){f++;continue}if(E++,p)return T0(e.subarray(p,f));var $=void 0;t==="h264"?$=e[f+N]&31:t==="h265"&&($=e[f+N]>>1&63),r.indexOf($)!==-1&&(p=f+N),f+=N+(t==="h264"?1:2)}return e.subarray(0,0)},E0=function(e,t,r){return zp(e,"h264",t,r)},_0=function(e,t,r){return zp(e,"h265",t,r)},Sn={webm:Ft([119,101,98,109]),matroska:Ft([109,97,116,114,111,115,107,97]),flac:Ft([102,76,97,67]),ogg:Ft([79,103,103,83]),ac3:Ft([11,119]),riff:Ft([82,73,70,70]),avi:Ft([65,86,73]),wav:Ft([87,65,86,69]),"3gp":Ft([102,116,121,112,51,103]),mp4:Ft([102,116,121,112]),fmp4:Ft([115,116,121,112]),mov:Ft([102,116,121,112,113,116]),moov:Ft([109,111,111,118]),moof:Ft([109,111,111,102])},hu={aac:function(e){var t=Sc(e);return Fi(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Sc(e);return Fi(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=Wp(e,[rh.EBML,rh.DocType])[0];return Fi(t,Sn.webm)},mkv:function(e){var t=Wp(e,[rh.EBML,rh.DocType])[0];return Fi(t,Sn.matroska)},mp4:function(e){if(hu["3gp"](e)||hu.mov(e))return!1;if(Fi(e,Sn.mp4,{offset:4})||Fi(e,Sn.fmp4,{offset:4})||Fi(e,Sn.moof,{offset:4})||Fi(e,Sn.moov,{offset:4}))return!0},mov:function(e){return Fi(e,Sn.mov,{offset:4})},"3gp":function(e){return Fi(e,Sn["3gp"],{offset:4})},ac3:function(e){var t=Sc(e);return Fi(e,Sn.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return e[0]===71;for(var t=0;t+188<e.length&&t<188;){if(e[t]===71&&e[t+188]===71)return!0;t+=1}return!1},flac:function(e){var t=Sc(e);return Fi(e,Sn.flac,{offset:t})},ogg:function(e){return Fi(e,Sn.ogg)},avi:function(e){return Fi(e,Sn.riff)&&Fi(e,Sn.avi,{offset:8})},wav:function(e){return Fi(e,Sn.riff)&&Fi(e,Sn.wav,{offset:8})},h264:function(e){return E0(e,7,3).length},h265:function(e){return _0(e,[32,33],3).length}},Nf=Object.keys(hu).filter(function(i){return i!=="ts"&&i!=="h264"&&i!=="h265"}).concat(["ts","h264","h265"]);Nf.forEach(function(i){var e=hu[i];hu[i]=function(t){return e(Ft(t))}});var b0=hu,Ff=function(e){e=Ft(e);for(var t=0;t<Nf.length;t++){var r=Nf[t];if(b0[r](e))return r}return""},A0=function(e){return h0(e,["moof"]).length>0},Bf=9e4,Uf,Gf,sh,Vf,Yp,Xp,Qp;Uf=function(i){return i*Bf},Gf=function(i,e){return i*e},sh=function(i){return i/Bf},Vf=function(i,e){return i/e},Yp=function(i,e){return Uf(Vf(i,e))},Xp=function(i,e){return Gf(sh(i),e)},Qp=function(i,e,t){return sh(t?i:i-e)};var S0={ONE_SECOND_IN_TS:Bf,secondsToVideoTs:Uf,secondsToAudioTs:Gf,videoTsToSeconds:sh,audioTsToSeconds:Vf,audioTsToVideoTs:Yp,videoTsToAudioTs:Xp,metadataTsToSeconds:Qp},sl=S0.ONE_SECOND_IN_TS;/*! @name @videojs/http-streaming @version 3.14.2 @license Apache-2.0 */const Nn=Ql,ah=(i,e)=>e&&e.responseURL&&i!==e.responseURL?e.responseURL:i,ds=i=>it.log.debug?it.log.debug.bind(it,"VHS:",`${i} >`):function(){};function yi(...i){const e=it.obj||it;return(e.merge||e.mergeOptions).apply(e,i)}function Zr(...i){const e=it.time||it;return(e.createTimeRanges||e.createTimeRanges).apply(e,i)}function x0(i){if(i.length===0)return"Buffered Ranges are empty";let e=`Buffered Ranges: 
`;for(let t=0;t<i.length;t++){const r=i.start(t),o=i.end(t);e+=`${r} --> ${o}. Duration (${o-r})
`}return e}const ga=1/30,ma=ga*3,Jp=function(i,e){const t=[];let r;if(i&&i.length)for(r=0;r<i.length;r++)e(i.start(r),i.end(r))&&t.push([i.start(r),i.end(r)]);return Zr(t)},fu=function(i,e){return Jp(i,function(t,r){return t-ma<=e&&r+ma>=e})},oh=function(i,e){return Jp(i,function(t){return t-ga>=e})},C0=function(i){if(i.length<2)return Zr();const e=[];for(let t=1;t<i.length;t++){const r=i.end(t-1),o=i.start(t);e.push([r,o])}return Zr(e)},k0=function(i,e){let t=null,r=null,o=0;const f=[],p=[];if(!i||!i.length||!e||!e.length)return Zr();let E=i.length;for(;E--;)f.push({time:i.start(E),type:"start"}),f.push({time:i.end(E),type:"end"});for(E=e.length;E--;)f.push({time:e.start(E),type:"start"}),f.push({time:e.end(E),type:"end"});for(f.sort(function(N,$){return N.time-$.time}),E=0;E<f.length;E++)f[E].type==="start"?(o++,o===2&&(t=f[E].time)):f[E].type==="end"&&(o--,o===1&&(r=f[E].time)),t!==null&&r!==null&&(p.push([t,r]),t=null,r=null);return Zr(p)},Zp=i=>{const e=[];if(!i||!i.length)return"";for(let t=0;t<i.length;t++)e.push(i.start(t)+" => "+i.end(t));return e.join(", ")},D0=function(i,e,t=1){return((i.length?i.end(i.length-1):0)-e)/t},al=i=>{const e=[];for(let t=0;t<i.length;t++)e.push({start:i.start(t),end:i.end(t)});return e},w0=function(i,e){if(i===e)return!1;if(!i&&e||!e&&i||i.length!==e.length)return!0;for(let t=0;t<i.length;t++)if(i.start(t)!==e.start(t)||i.end(t)!==e.end(t))return!0;return!1},Hf=function(i){if(!(!i||!i.length||!i.end))return i.end(i.length-1)},jf=function(i,e){let t=0;if(!i||!i.length)return t;for(let r=0;r<i.length;r++){const o=i.start(r),f=i.end(r);if(!(e>f)){if(e>o&&e<=f){t+=f-e;continue}t+=f-o}}return t},Kf=(i,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(r){t+=r.duration}),(e.preloadHints||[]).forEach(function(r){r.type==="PART"&&(t+=i.partTargetDuration)}),t},qf=i=>(i.segments||[]).reduce((e,t,r)=>(t.parts?t.parts.forEach(function(o,f){e.push({duration:o.duration,segmentIndex:r,partIndex:f,part:o,segment:t})}):e.push({duration:t.duration,segmentIndex:r,partIndex:null,segment:t,part:null}),e),[]),eg=i=>{const e=i.segments&&i.segments.length&&i.segments[i.segments.length-1];return e&&e.parts||[]},tg=({preloadSegment:i})=>{if(!i)return;const{parts:e,preloadHints:t}=i;let r=(t||[]).reduce((o,f)=>o+(f.type==="PART"?1:0),0);return r+=e&&e.length?e.length:0,r},ig=(i,e)=>{if(e.endList)return 0;if(i&&i.suggestedPresentationDelay)return i.suggestedPresentationDelay;const t=eg(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},L0=function(i,e){let t=0,r=e-i.mediaSequence,o=i.segments[r];if(o){if(typeof o.start<"u")return{result:o.start,precise:!0};if(typeof o.end<"u")return{result:o.end-o.duration,precise:!0}}for(;r--;){if(o=i.segments[r],typeof o.end<"u")return{result:t+o.end,precise:!0};if(t+=Kf(i,o),typeof o.start<"u")return{result:t+o.start,precise:!0}}return{result:t,precise:!1}},I0=function(i,e){let t=0,r,o=e-i.mediaSequence;for(;o<i.segments.length;o++){if(r=i.segments[o],typeof r.start<"u")return{result:r.start-t,precise:!0};if(t+=Kf(i,r),typeof r.end<"u")return{result:r.end-t,precise:!0}}return{result:-1,precise:!1}},rg=function(i,e,t){if(typeof e>"u"&&(e=i.mediaSequence+i.segments.length),e<i.mediaSequence)return 0;const r=L0(i,e);if(r.precise)return r.result;const o=I0(i,e);return o.precise?o.result:r.result+t},ng=function(i,e,t){if(!i)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(i.totalDuration)return i.totalDuration;if(!i.endList)return window.Infinity}return rg(i,e,t)},xc=function({defaultDuration:i,durationList:e,startIndex:t,endIndex:r}){let o=0;if(t>r&&([t,r]=[r,t]),t<0){for(let f=t;f<Math.min(0,r);f++)o+=i;t=0}for(let f=t;f<r;f++)o+=e[f].duration;return o},sg=function(i,e,t,r){if(!i||!i.segments)return null;if(i.endList)return ng(i);if(e===null)return null;e=e||0;let o=rg(i,i.mediaSequence+i.segments.length,e);return t&&(r=typeof r=="number"?r:ig(null,i),o-=r),Math.max(0,o)},R0=function(i,e,t){const o=e||0;let f=sg(i,e,!0,t);return f===null?Zr():(f<o&&(f=o),Zr(o,f))},P0=function({playlist:i,currentTime:e,startingSegmentIndex:t,startingPartIndex:r,startTime:o,exactManifestTimings:f}){let p=e-o;const E=qf(i);let N=0;for(let $=0;$<E.length;$++){const he=E[$];if(t===he.segmentIndex&&!(typeof r=="number"&&typeof he.partIndex=="number"&&r!==he.partIndex)){N=$;break}}if(p<0){if(N>0)for(let $=N-1;$>=0;$--){const he=E[$];if(p+=he.duration,f){if(p<0)continue}else if(p+ga<=0)continue;return{partIndex:he.partIndex,segmentIndex:he.segmentIndex,startTime:o-xc({defaultDuration:i.targetDuration,durationList:E,startIndex:N,endIndex:$})}}return{partIndex:E[0]&&E[0].partIndex||null,segmentIndex:E[0]&&E[0].segmentIndex||0,startTime:e}}if(N<0){for(let $=N;$<0;$++)if(p-=i.targetDuration,p<0)return{partIndex:E[0]&&E[0].partIndex||null,segmentIndex:E[0]&&E[0].segmentIndex||0,startTime:e};N=0}for(let $=N;$<E.length;$++){const he=E[$];p-=he.duration;const Te=he.duration>ga,we=p===0,Me=Te&&p+ga>=0;if(!((we||Me)&&$!==E.length-1)){if(f){if(p>0)continue}else if(p-ga>=0)continue;return{partIndex:he.partIndex,segmentIndex:he.segmentIndex,startTime:o+xc({defaultDuration:i.targetDuration,durationList:E,startIndex:N,endIndex:$})}}}return{segmentIndex:E[E.length-1].segmentIndex,partIndex:E[E.length-1].partIndex,startTime:e}},ag=function(i){return i.excludeUntil&&i.excludeUntil>Date.now()},$f=function(i){return i.excludeUntil&&i.excludeUntil===1/0},lh=function(i){const e=ag(i);return!i.disabled&&!e},O0=function(i){return i.disabled},M0=function(i){for(let e=0;e<i.segments.length;e++)if(i.segments[e].key)return!0;return!1},og=function(i,e){return e.attributes&&e.attributes[i]},N0=function(i,e,t,r=0){return og("BANDWIDTH",t)?(i*t.attributes.BANDWIDTH-r*8)/e:NaN},Wf=(i,e)=>{if(i.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return i.playlists.filter(r=>lh(r)?(r.attributes.BANDWIDTH||0)<t:!1).length===0},zf=(i,e)=>!i&&!e||!i&&e||i&&!e?!1:!!(i===e||i.id&&e.id&&i.id===e.id||i.resolvedUri&&e.resolvedUri&&i.resolvedUri===e.resolvedUri||i.uri&&e.uri&&i.uri===e.uri),lg=function(i,e){const t=i&&i.mediaGroups&&i.mediaGroups.AUDIO||{};let r=!1;for(const o in t){for(const f in t[o])if(r=e(t[o][f]),r)break;if(r)break}return!!r},Cc=i=>{if(!i||!i.playlists||!i.playlists.length)return lg(i,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<i.playlists.length;e++){const t=i.playlists[e],r=t.attributes&&t.attributes.CODECS;if(!(r&&r.split(",").every(f=>nc(f))||lg(i,f=>zf(t,f))))return!1}return!0};var Fn={liveEdgeDelay:ig,duration:ng,seekable:R0,getMediaInfoForTime:P0,isEnabled:lh,isDisabled:O0,isExcluded:ag,isIncompatible:$f,playlistEnd:sg,isAes:M0,hasAttribute:og,estimateSegmentRequestTime:N0,isLowestEnabledRendition:Wf,isAudioOnly:Cc,playlistMatch:zf,segmentDurationWithParts:Kf};const{log:ug}=it,pu=(i,e)=>`${i}-${e}`,cg=(i,e,t)=>`placeholder-uri-${i}-${e}-${t}`,F0=({onwarn:i,oninfo:e,manifestString:t,customTagParsers:r=[],customTagMappers:o=[],llhls:f})=>{const p=new ic;i&&p.on("warn",i),e&&p.on("info",e),r.forEach($=>p.addParser($)),o.forEach($=>p.addTagMapper($)),p.push(t),p.end();const E=p.manifest;if(f||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function($){E.hasOwnProperty($)&&delete E[$]}),E.segments&&E.segments.forEach(function($){["parts","preloadHints"].forEach(function(he){$.hasOwnProperty(he)&&delete $[he]})})),!E.targetDuration){let $=10;E.segments&&E.segments.length&&($=E.segments.reduce((he,Te)=>Math.max(he,Te.duration),0)),i&&i({message:`manifest has no targetDuration defaulting to ${$}`}),E.targetDuration=$}const N=eg(E);if(N.length&&!E.partTargetDuration){const $=N.reduce((he,Te)=>Math.max(he,Te.duration),0);i&&(i({message:`manifest has no partTargetDuration defaulting to ${$}`}),ug.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),E.partTargetDuration=$}return E},gu=(i,e)=>{i.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(i.mediaGroups[t])for(const r in i.mediaGroups[t])for(const o in i.mediaGroups[t][r]){const f=i.mediaGroups[t][r][o];e(f,t,r,o)}})},dg=({playlist:i,uri:e,id:t})=>{i.id=t,i.playlistErrors_=0,e&&(i.uri=e),i.attributes=i.attributes||{}},B0=i=>{let e=i.playlists.length;for(;e--;){const t=i.playlists[e];dg({playlist:t,id:pu(e,t.uri)}),t.resolvedUri=Nn(i.uri,t.uri),i.playlists[t.id]=t,i.playlists[t.uri]=t,t.attributes.BANDWIDTH||ug.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},U0=i=>{gu(i,e=>{e.uri&&(e.resolvedUri=Nn(i.uri,e.uri))})},G0=(i,e)=>{const t=pu(0,e),r={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:window.location.href,resolvedUri:window.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return r.playlists[t]=r.playlists[0],r.playlists[e]=r.playlists[0],r},hg=(i,e,t=cg)=>{i.uri=e;for(let o=0;o<i.playlists.length;o++)if(!i.playlists[o].uri){const f=`placeholder-uri-${o}`;i.playlists[o].uri=f}const r=Cc(i);gu(i,(o,f,p,E)=>{if(!o.playlists||!o.playlists.length){if(r&&f==="AUDIO"&&!o.uri)for(let N=0;N<i.playlists.length;N++){const $=i.playlists[N];if($.attributes&&$.attributes.AUDIO&&$.attributes.AUDIO===p)return}o.playlists=[Hi({},o)]}o.playlists.forEach(function(N,$){const he=t(f,p,E,N),Te=pu($,he);N.uri?N.resolvedUri=N.resolvedUri||Nn(i.uri,N.uri):(N.uri=$===0?he:Te,N.resolvedUri=N.uri),N.id=N.id||Te,N.attributes=N.attributes||{},i.playlists[N.id]=N,i.playlists[N.uri]=N})}),B0(i),U0(i)};class fg{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(this.offset_!==null||!e.length)return;const[t]=e;t.programDateTime!==void 0&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,r=t.startDate.getTime();this.trimProcessedDateRanges_(r),this.pendingDateRanges_=e.reduce((o,f)=>(o.set(f.id,f),o),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(this.offset_===null)return[];const e={},t=[];this.pendingDateRanges_.forEach((r,o)=>{if(!this.processedDateRanges_.has(o)&&(r.startTime=r.startDate.getTime()/1e3-this.offset_,r.processDateRange=()=>this.processDateRange(r),t.push(r),!!r.class))if(e[r.class]){const f=e[r.class].push(r);r.classListIndex=f-1}else e[r.class]=[r],r.classListIndex=0});for(const r of t){const o=e[r.class]||[];r.endDate?r.endTime=r.endDate.getTime()/1e3-this.offset_:r.endOnNext&&o[r.classListIndex+1]?r.endTime=o[r.classListIndex+1].startTime:r.duration?r.endTime=r.startTime+r.duration:r.plannedDuration?r.endTime=r.startTime+r.plannedDuration:r.endTime=r.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((r,o)=>{r.startDate.getTime()<e&&this.processedDateRanges_.delete(o)})}}const pg=22,ol=({requestType:i,request:e,error:t,parseFailure:r})=>{const o=e.status<200||e.status>299,f=e.status>=400&&e.status<=499,p={uri:e.uri,requestType:i},E=o&&!f||r;if(t&&f)p.error=Hi({},t),p.errorType=it.Error.NetworkRequestFailed;else if(e.aborted)p.errorType=it.Error.NetworkRequestAborted;else if(e.timedout)p.erroType=it.Error.NetworkRequestTimeout;else if(E){const N=r?it.Error.NetworkBodyParserFailed:it.Error.NetworkBadStatus;p.errorType=N,p.status=e.status,p.headers=e.headers}return p},{EventTarget:V0}=it,H0=(i,e)=>{if(e.endList||!e.serverControl)return i;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:r}=e;let o=e.mediaSequence+e.segments.length;if(r){const f=r.parts||[],p=tg(e)-1;p>-1&&p!==f.length-1&&(t._HLS_part=p),(p>-1||f.length)&&o--}t._HLS_msn=o}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const r=new window.URL(i);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(o){t.hasOwnProperty(o)&&r.searchParams.set(o,t[o])}),i=r.toString()}return i},j0=(i,e)=>{if(!i)return e;const t=yi(i,e);if(i.preloadHints&&!e.preloadHints&&delete t.preloadHints,i.parts&&!e.parts)delete t.parts;else if(i.parts&&e.parts)for(let r=0;r<e.parts.length;r++)i.parts&&i.parts[r]&&(t.parts[r]=yi(i.parts[r],e.parts[r]));return!i.skipped&&e.skipped&&(t.skipped=!1),i.preload&&!e.preload&&(t.preload=!1),t},K0=(i,e,t)=>{const r=i.slice(),o=e.slice();t=t||0;const f=[];let p;for(let E=0;E<o.length;E++){const N=r[E+t],$=o[E];N?(p=N.map||p,f.push(j0(N,$))):(p&&!$.map&&($.map=p),f.push($))}return f},gg=(i,e)=>{!i.resolvedUri&&i.uri&&(i.resolvedUri=Nn(e,i.uri)),i.key&&!i.key.resolvedUri&&(i.key.resolvedUri=Nn(e,i.key.uri)),i.map&&!i.map.resolvedUri&&(i.map.resolvedUri=Nn(e,i.map.uri)),i.map&&i.map.key&&!i.map.key.resolvedUri&&(i.map.key.resolvedUri=Nn(e,i.map.key.uri)),i.parts&&i.parts.length&&i.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=Nn(e,t.uri))}),i.preloadHints&&i.preloadHints.length&&i.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=Nn(e,t.uri))})},mg=function(i){const e=i.segments||[],t=i.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let r=0;r<t.preloadHints.length;r++)if(t.preloadHints[r].type==="MAP")return e}t.duration=i.targetDuration,t.preload=!0,e.push(t)}return e},vg=(i,e)=>i===e||i.segments&&e.segments&&i.segments.length===e.segments.length&&i.endList===e.endList&&i.mediaSequence===e.mediaSequence&&i.preloadSegment===e.preloadSegment,Yf=(i,e,t=vg)=>{const r=yi(i,{}),o=r.playlists[e.id];if(!o||t(o,e))return null;e.segments=mg(e);const f=yi(o,e);if(f.preloadSegment&&!e.preloadSegment&&delete f.preloadSegment,o.segments){if(e.skip){e.segments=e.segments||[];for(let p=0;p<e.skip.skippedSegments;p++)e.segments.unshift({skipped:!0})}f.segments=K0(o.segments,e.segments,e.mediaSequence-o.mediaSequence)}f.segments.forEach(p=>{gg(p,f.resolvedUri)});for(let p=0;p<r.playlists.length;p++)r.playlists[p].id===e.id&&(r.playlists[p]=f);return r.playlists[e.id]=f,r.playlists[e.uri]=f,gu(i,(p,E,N,$)=>{if(p.playlists)for(let he=0;he<p.playlists.length;he++)e.id===p.playlists[he].id&&(p.playlists[he]=f)}),r},Xf=(i,e)=>{const t=i.segments||[],r=t[t.length-1],o=r&&r.parts&&r.parts[r.parts.length-1],f=o&&o.duration||r&&r.duration;return e&&f?f*1e3:(i.partTargetDuration||i.targetDuration||10)*500},yg=(i,e,t)=>{if(!i)return;const r=[];return i.forEach(o=>{if(!o.attributes)return;const{BANDWIDTH:f,RESOLUTION:p,CODECS:E}=o.attributes;r.push({id:o.id,bandwidth:f,resolution:p,codecs:E})}),{type:e,isLive:t,renditions:r}};class mu extends V0{constructor(e,t,r={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=ds("PlaylistLoader");const{withCredentials:o=!1}=r;this.src=e,this.vhs_=t,this.withCredentials=o,this.addDateRangesToTextTrack_=r.addDateRangesToTextTrack;const f=t.options_;this.customTagParsers=f&&f.customTagParsers||[],this.customTagMappers=f&&f.customTagMappers||[],this.llhls=f&&f.llhls,this.dateRangesStorage_=new fg,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();!t.length||!this.addDateRangesToTextTrack_||this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=Nn(this.main.uri,e.uri);this.llhls&&(t=H0(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(r,o)=>{if(this.request){if(r)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,r){const{uri:o,id:f}=t;this.request=null,r&&(this.state=r),this.error={playlist:this.main.playlists[f],status:e.status,message:`HLS playlist request error at URL: ${o}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:ol({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{return F0({onwarn:({message:r})=>this.logger_(`m3u8-parser warn for ${e}: ${r}`),oninfo:({message:r})=>this.logger_(`m3u8-parser info for ${e}: ${r}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls})}catch(r){this.error=r,this.error.metadata={errorType:it.Error.StreamingHlsPlaylistParserError,error:r}}}haveMetadata({playlistString:e,playlistObject:t,url:r,id:o}){this.request=null,this.state="HAVE_METADATA";const f={playlistInfo:{type:"media",uri:r}};this.trigger({type:"playlistparsestart",metadata:f});const p=t||this.parseManifest_({url:r,manifestString:e});p.lastRequest=Date.now(),dg({playlist:p,uri:r,id:o});const E=Yf(this.main,p);this.targetDuration=p.partTargetDuration||p.targetDuration,this.pendingMedia_=null,E?(this.main=E,this.media_=this.main.playlists[o]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(Xf(this.media(),!!E)),f.parsedPlaylist=yg(this.main.playlists,f.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:f}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),window.clearTimeout(this.mediaUpdateTimeout),window.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new fg,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(window.clearTimeout(this.finalRenditionTimeout),t){const E=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=window.setTimeout(this.media.bind(this,e,!1),E);return}const r=this.state,o=!this.media_||e.id!==this.media_.id,f=this.main.playlists[e.id];if(f&&f.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,o&&(this.trigger("mediachanging"),r==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(Xf(e,!0)),!o)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const p={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:p}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(E,N)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=ah(e.resolvedUri,N),E)return this.playlistRequestError(this.request,e,r);this.trigger({type:"playlistrequestcomplete",metadata:p}),this.haveMetadata({playlistString:N.responseText,url:e.uri,id:e.id}),r==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const r=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=window.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},r);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=window.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=window.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,r)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:r.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:r.responseText,code:2,metadata:ol({requestType:r.requestType,request:r,error:t})},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=ah(this.src,r),this.trigger({type:"playlistparsestart",metadata:e});const o=this.parseManifest_({manifestString:r.responseText,url:this.src});e.parsedPlaylist=yg(o.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(o)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,hg(this.main,this.srcUri()),e.playlists.forEach(r=>{r.segments=mg(r),r.segments.forEach(o=>{gg(o,r.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||window.location.href;this.main=G0(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const r=this.main,o=e.ID;let f=r.playlists.length;for(;f--;){const p=r.playlists[f];if(p.attributes["PATHWAY-ID"]===o){const E=p.resolvedUri,N=p.id;if(t){const $=this.createCloneURI_(p.resolvedUri,e),he=pu(o,$),Te=this.createCloneAttributes_(o,p.attributes),we=this.createClonePlaylist_(p,he,e,Te);r.playlists[f]=we,r.playlists[he]=we,r.playlists[$]=we}else r.playlists.splice(f,1);delete r.playlists[N],delete r.playlists[E]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const r=this.main,o=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(f=>{if(!(!r.mediaGroups[f]||!r.mediaGroups[f][o])){for(const p in r.mediaGroups[f])if(p===o){for(const E in r.mediaGroups[f][p])r.mediaGroups[f][p][E].playlists.forEach(($,he)=>{const Te=r.playlists[$.id],we=Te.id,Me=Te.resolvedUri;delete r.playlists[we],delete r.playlists[Me]});delete r.mediaGroups[f][p]}}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const r=this.main,o=r.playlists.length,f=this.createCloneURI_(t.resolvedUri,e),p=pu(e.ID,f),E=this.createCloneAttributes_(e.ID,t.attributes),N=this.createClonePlaylist_(t,p,e,E);r.playlists[o]=N,r.playlists[p]=N,r.playlists[f]=N,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,r=e["BASE-ID"],o=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(f=>{if(!(!o.mediaGroups[f]||o.mediaGroups[f][t]))for(const p in o.mediaGroups[f]){if(p===r)o.mediaGroups[f][t]={};else continue;for(const E in o.mediaGroups[f][p]){const N=o.mediaGroups[f][p][E];o.mediaGroups[f][t][E]=Hi({},N);const $=o.mediaGroups[f][t][E],he=this.createCloneURI_(N.resolvedUri,e);$.resolvedUri=he,$.uri=he,$.playlists=[],N.playlists.forEach((Te,we)=>{const Me=o.playlists[Te.id],Ge=cg(f,t,E),ke=pu(t,Ge);if(Me&&!o.playlists[ke]){const qe=this.createClonePlaylist_(Me,ke,e),$e=qe.resolvedUri;o.playlists[ke]=qe,o.playlists[$e]=qe}$.playlists[we]=this.createClonePlaylist_(Te,ke,e)})}}})}createClonePlaylist_(e,t,r,o){const f=this.createCloneURI_(e.resolvedUri,r),p={resolvedUri:f,uri:f,id:t};return e.segments&&(p.segments=[]),o&&(p.attributes=o),yi(e,p)}createCloneURI_(e,t){const r=new URL(e);r.hostname=t["URI-REPLACEMENT"].HOST;const o=t["URI-REPLACEMENT"].PARAMS;for(const f of Object.keys(o))r.searchParams.set(f,o[f]);return r.href}createCloneAttributes_(e,t){const r={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(o=>{t[o]&&(r[o]=e)}),r}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const r in e.contentProtection){const o=e.contentProtection[r].attributes.keyId;o&&t.add(o.toLowerCase())}return t}}}const Qf=function(i,e,t,r){const o=i.responseType==="arraybuffer"?i.response:i.responseText;!e&&o&&(i.responseTime=Date.now(),i.roundTripTime=i.responseTime-i.requestTime,i.bytesReceived=o.byteLength||o.length,i.bandwidth||(i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3))),t.headers&&(i.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(i.timedout=!0),!e&&!i.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(i&&(o||i.responseText)))),r(e,i)},q0=(i,e)=>{if(!i||!i.size)return;let t=e;return i.forEach(r=>{t=r(t)}),t},$0=(i,e,t,r)=>{!i||!i.size||i.forEach(o=>{o(e,t,r)})},Tg=function(){const i=function e(t,r){t=yi({timeout:45e3},t);const o=e.beforeRequest||it.Vhs.xhr.beforeRequest,f=e._requestCallbackSet||it.Vhs.xhr._requestCallbackSet||new Set,p=e._responseCallbackSet||it.Vhs.xhr._responseCallbackSet;o&&typeof o=="function"&&(it.log.warn("beforeRequest is deprecated, use onRequest instead."),f.add(o));const E=it.Vhs.xhr.original===!0?it.xhr:it.Vhs.xhr,N=q0(f,t);f.delete(o);const $=E(N||t,function(Te,we){return $0(p,$,Te,we),Qf($,Te,we,r)}),he=$.abort;return $.abort=function(){return $.aborted=!0,he.apply($,arguments)},$.uri=t.uri,$.requestType=t.requestType,$.requestTime=Date.now(),$};return i.original=!0,i},W0=function(i){let e;const t=i.offset;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=window.BigInt(i.offset)+window.BigInt(i.length)-window.BigInt(1):e=i.offset+i.length-1,"bytes="+t+"-"+e},Jf=function(i){const e={};return i.byterange&&(e.Range=W0(i.byterange)),e},z0=function(i,e){return i.start(e)+"-"+i.end(e)},Y0=function(i,e){const t=i.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},X0=function(i){return i>=32&&i<126?String.fromCharCode(i):"."},Eg=function(i){const e={};return Object.keys(i).forEach(t=>{const r=i[t];oc(r)?e[t]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:e[t]=r}),e},uh=function(i){const e=i.byterange||{length:1/0,offset:0};return[e.length,e.offset,i.resolvedUri].join(",")},_g=function(i){return i.resolvedUri},bg=i=>{const e=Array.prototype.slice.call(i),t=16;let r="",o,f;for(let p=0;p<e.length/t;p++)o=e.slice(p*t,p*t+t).map(Y0).join(""),f=e.slice(p*t,p*t+t).map(X0).join(""),r+=o+" "+f+`
`;return r};var Q0=Object.freeze({__proto__:null,createTransferableMessage:Eg,initSegmentId:uh,segmentKeyId:_g,hexDump:bg,tagDump:({bytes:i})=>bg(i),textRanges:i=>{let e="",t;for(t=0;t<i.length;t++)e+=z0(i,t)+" ";return e}});const Ag=.25,J0=(i,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,o=e.videoTimingInfo.transmuxedPresentationStart+t,f=i-o;return new Date(e.dateTimeObject.getTime()+f*1e3)},Z0=i=>i.transmuxedPresentationEnd-i.transmuxedPresentationStart-i.transmuxerPrependedSeconds,ey=(i,e)=>{let t;try{t=new Date(i)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let r=e.segments[0];if(t<new Date(r.dateTimeObject))return null;for(let N=0;N<e.segments.length-1;N++){r=e.segments[N];const $=new Date(e.segments[N+1].dateTimeObject);if(t<$)break}const o=e.segments[e.segments.length-1],f=o.dateTimeObject,p=o.videoTimingInfo?Z0(o.videoTimingInfo):o.duration+o.duration*Ag,E=new Date(f.getTime()+p*1e3);return t>E?null:(t>new Date(f)&&(r=o),{segment:r,estimatedStart:r.videoTimingInfo?r.videoTimingInfo.transmuxedPresentationStart:Fn.duration(e,e.mediaSequence+e.segments.indexOf(r)),type:r.videoTimingInfo?"accurate":"estimate"})},ty=(i,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,r;for(let f=0;f<e.segments.length&&(r=e.segments[f],t=r.videoTimingInfo?r.videoTimingInfo.transmuxedPresentationEnd:t+r.duration,!(i<=t));f++);const o=e.segments[e.segments.length-1];if(o.videoTimingInfo&&o.videoTimingInfo.transmuxedPresentationEnd<i)return null;if(i>t){if(i>t+o.duration*Ag)return null;r=o}return{segment:r,estimatedStart:r.videoTimingInfo?r.videoTimingInfo.transmuxedPresentationStart:t-r.duration,type:r.videoTimingInfo?"accurate":"estimate"}},iy=(i,e)=>{let t,r;try{t=new Date(i),r=new Date(e)}catch{}const o=t.getTime();return(r.getTime()-o)/1e3},ry=i=>{if(!i.segments||i.segments.length===0)return!1;for(let e=0;e<i.segments.length;e++)if(!i.segments[e].dateTimeObject)return!1;return!0},ny=({playlist:i,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!i||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const r=ty(e,i);if(!r)return t({message:"valid programTime was not found"});if(r.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:r.estimatedStart});const o={mediaSeconds:e},f=J0(e,r.segment);return f&&(o.programDateTime=f.toISOString()),t(null,o)},Sg=({programTime:i,playlist:e,retryCount:t=2,seekTo:r,pauseAfterSeek:o=!0,tech:f,callback:p})=>{if(!p)throw new Error("seekToProgramTime: callback must be provided");if(typeof i>"u"||!e||!r)return p({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!f.hasStarted_)return p({message:"player must be playing a live stream to start buffering"});if(!ry(e))return p({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const E=ey(i,e);if(!E)return p({message:`${i} was not found in the stream`});const N=E.segment,$=iy(N.dateTimeObject,i);if(E.type==="estimate"){if(t===0)return p({message:`${i} is not buffered yet. Try again`});r(E.estimatedStart+$),f.one("seeked",()=>{Sg({programTime:i,playlist:e,retryCount:t-1,seekTo:r,pauseAfterSeek:o,tech:f,callback:p})});return}const he=N.start+$,Te=()=>p(null,f.currentTime());f.one("seeked",Te),o&&f.pause(),r(he)},Zf=(i,e)=>{if(i.readyState===4)return e()},sy=(i,e,t,r)=>{let o=[],f,p=!1;const E=function(Te,we,Me,Ge){return we.abort(),p=!0,t(Te,we,Me,Ge)},N=function(Te,we){if(p)return;if(Te)return Te.metadata=ol({requestType:r,request:we,error:Te}),E(Te,we,"",o);const Me=we.responseText.substring(o&&o.byteLength||0,we.responseText.length);if(o=ff(o,wd(Me,!0)),f=f||Sc(o),o.length<10||f&&o.length<f+2)return Zf(we,()=>E(Te,we,"",o));const Ge=Ff(o);return Ge==="ts"&&o.length<188?Zf(we,()=>E(Te,we,"",o)):!Ge&&o.length<376?Zf(we,()=>E(Te,we,"",o)):E(null,we,Ge,o)},he=e({uri:i,beforeSend(Te){Te.overrideMimeType("text/plain; charset=x-user-defined"),Te.addEventListener("progress",function({total:we,loaded:Me}){return Qf(Te,null,{statusCode:Te.status},N)})}},function(Te,we){return Qf(he,Te,we,N)});return he},{EventTarget:ay}=it,xg=function(i,e){if(!vg(i,e)||i.sidx&&e.sidx&&(i.sidx.offset!==e.sidx.offset||i.sidx.length!==e.sidx.length))return!1;if(!i.sidx&&e.sidx||i.sidx&&!e.sidx||i.segments&&!e.segments||!i.segments&&e.segments)return!1;if(!i.segments&&!e.segments)return!0;for(let t=0;t<i.segments.length;t++){const r=i.segments[t],o=e.segments[t];if(r.uri!==o.uri)return!1;if(!r.byterange&&!o.byterange)continue;const f=r.byterange,p=o.byterange;if(f&&!p||!f&&p||f.offset!==p.offset||f.length!==p.length)return!1}return!0},oy=(i,e,t,r)=>{const o=r.attributes.NAME||t;return`placeholder-uri-${i}-${e}-${o}`},ly=({mainXml:i,srcUrl:e,clientOffset:t,sidxMapping:r,previousManifest:o})=>{const f=r0(i,{manifestUri:e,clientOffset:t,sidxMapping:r,previousManifest:o});return hg(f,e,oy),f},uy=(i,e)=>{gu(i,(t,r,o,f)=>{(!e.mediaGroups[r][o]||!(f in e.mediaGroups[r][o]))&&delete i.mediaGroups[r][o][f]})},cy=(i,e,t)=>{let r=!0,o=yi(i,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let f=0;f<e.playlists.length;f++){const p=e.playlists[f];if(p.sidx){const N=th(p.sidx);t&&t[N]&&t[N].sidx&&If(p,t[N].sidx,p.sidx.resolvedUri)}const E=Yf(o,p,xg);E&&(o=E,r=!1)}return gu(e,(f,p,E,N)=>{if(f.playlists&&f.playlists.length){const $=f.playlists[0].id,he=Yf(o,f.playlists[0],xg);he&&(o=he,N in o.mediaGroups[p][E]||(o.mediaGroups[p][E][N]=f),o.mediaGroups[p][E][N].playlists[0]=o.playlists[$],r=!1)}}),uy(o,e),e.minimumUpdatePeriod!==i.minimumUpdatePeriod&&(r=!1),r?null:o},dy=(i,e)=>(!i.map&&!e.map||!!(i.map&&e.map&&i.map.byterange.offset===e.map.byterange.offset&&i.map.byterange.length===e.map.byterange.length))&&i.uri===e.uri&&i.byterange.offset===e.byterange.offset&&i.byterange.length===e.byterange.length,Cg=(i,e)=>{const t={};for(const r in i){const f=i[r].sidx;if(f){const p=th(f);if(!e[p])break;const E=e[p].sidxInfo;dy(E,f)&&(t[p]=e[p])}}return t},hy=(i,e)=>{let r=Cg(i.playlists,e);return gu(i,(o,f,p,E)=>{if(o.playlists&&o.playlists.length){const N=o.playlists;r=yi(r,Cg(N,e))}}),r};class ep extends ay{constructor(e,t,r={},o){super(),this.mainPlaylistLoader_=o||this,o||(this.isMain_=!0);const{withCredentials:f=!1}=r;if(this.vhs_=t,this.withCredentials=f,this.addMetadataToTextTrack=r.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=ds("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}requestErrored_(e,t,r){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata},r&&(this.state=r),this.trigger("error"),!0}addSidxSegments_(e,t,r){const o=e.sidx&&th(e.sidx);if(!e.sidx||!o||this.mainPlaylistLoader_.sidxMapping_[o]){this.mediaRequest_=window.setTimeout(()=>r(!1),0);return}const f=ah(e.sidx.resolvedUri),p=(N,$)=>{if(this.requestErrored_(N,$,t))return;const he=this.mainPlaylistLoader_.sidxMapping_,{requestType:Te}=$;let we;try{we=l0(Ft($.response).subarray(8))}catch(Me){Me.metadata=ol({requestType:Te,request:$,parseFailure:!0}),this.requestErrored_(Me,$,t);return}return he[o]={sidxInfo:e.sidx,sidx:we},If(e,we,e.sidx.resolvedUri),r(!0)},E="dash-sidx";this.request=sy(f,this.vhs_.xhr,(N,$,he,Te)=>{if(N)return p(N,$);if(!he||he!=="mp4"){const Ge=he||"unknown";return p({status:$.status,message:`Unsupported ${Ge} container type for sidx segment at URL: ${f}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},$)}const{offset:we,length:Me}=e.sidx.byterange;if(Te.length>=Me+we)return p(N,{response:Te.subarray(we,we+Me),status:$.status,uri:$.uri});this.request=this.vhs_.xhr({uri:f,responseType:"arraybuffer",requestType:"dash-sidx",headers:Jf({byterange:e.sidx.byterange})},p)},E)}dispose(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},window.clearTimeout(this.minimumUpdatePeriodTimeout_),window.clearTimeout(this.mediaRequest_),window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const r=!this.media_||e.id!==this.media_.id;if(r&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,r&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}r&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,o=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(window.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const r=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=window.setTimeout(()=>this.load(),r);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){this.mediaRequest_=window.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(r,o)=>{if(r){const{requestType:p}=o;r.metadata=ol({requestType:p,request:o,error:r})}if(this.requestErrored_(r,o)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}this.trigger({type:"manifestrequestcomplete",metadata:t});const f=o.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=o.responseText,o.responseHeaders&&o.responseHeaders.date?this.mainLoaded_=Date.parse(o.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=ah(this.mainPlaylistLoader_.srcUrl,o),f){this.handleMain_(),this.syncClientServerClock_(()=>e(o,f));return}return e(o,f)})}syncClientServerClock_(e){const t=n0(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:Nn(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(r,o)=>{if(!this.request)return;if(r){const{requestType:p}=o;return this.error.metadata=ol({requestType:p,request:o,error:r}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let f;t.method==="HEAD"?!o.responseHeaders||!o.responseHeaders.date?f=this.mainLoaded_:f=Date.parse(o.responseHeaders.date):f=Date.parse(o.responseText),this.mainPlaylistLoader_.clientOffset_=f-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestparsestart",metadata:t});let r;try{r=ly({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(f){this.error=f,this.error.metadata={errorType:it.Error.StreamingDashManifestParserError,error:f},this.trigger("error")}e&&(r=cy(e,r,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=r||e;const o=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(o&&o!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=o),(!e||r&&r.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(r),r){const{duration:f,endList:p}=r,E=[];r.playlists.forEach($=>{E.push({id:$.id,bandwidth:$.attributes.BANDWIDTH,resolution:$.attributes.RESOLUTION,codecs:$.attributes.CODECS})});const N={duration:f,isLive:!p,renditions:E};t.parsedManifest=N,this.trigger({type:"manifestparsecomplete",metadata:t})}return!!r}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(window.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=window.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=hy(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,r=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,r=!this.media_||this.media_!==t[e];if(r?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const o=()=>{this.media().endList||(this.mediaUpdateTimeout=window.setTimeout(()=>{this.trigger("mediaupdatetimeout"),o()},Xf(this.media(),!!r)))};o()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const t=this.mainPlaylistLoader_.main.eventStream.map(r=>({cueTime:r.start,frames:[{data:r.messageData}]}));this.addMetadataToTextTrack("EventStream",t,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const r in e.contentProtection){const o=e.contentProtection[r].attributes["cenc:default_KID"];o&&t.add(o.replace(/-/g,"").toLowerCase())}return t}}}var Vr={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const fy=i=>{const e=new Uint8Array(new ArrayBuffer(i.length));for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer},kg=function(i){return i.on=i.addEventListener,i.off=i.removeEventListener,i},py=function(i){try{return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(i),URL.createObjectURL(t.getBlob())}},Dg=function(i){return function(){const e=py(i),t=kg(new Worker(e));t.objURL=e;const r=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),r.call(this)},t}},wg=function(i){return`var browserWorkerPolyFill = ${kg.toString()};
browserWorkerPolyFill(self);
`+i},Lg=function(i){return i.toString().replace(/^function.+?{/,"").slice(0,-1)},gy=wg(Lg(function(){var i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=function(){this.init=function(){var T={};this.on=function(B,q){T[B]||(T[B]=[]),T[B]=T[B].concat(q)},this.off=function(B,q){var H;return T[B]?(H=T[B].indexOf(q),T[B]=T[B].slice(),T[B].splice(H,1),H>-1):!1},this.trigger=function(B){var q,H,oe,pe;if(q=T[B],!!q)if(arguments.length===2)for(oe=q.length,H=0;H<oe;++H)q[H].call(this,arguments[1]);else{for(pe=[],H=arguments.length,H=1;H<arguments.length;++H)pe.push(arguments[H]);for(oe=q.length,H=0;H<oe;++H)q[H].apply(this,pe)}},this.dispose=function(){T={}}}};e.prototype.pipe=function(T){return this.on("data",function(B){T.push(B)}),this.on("done",function(B){T.flush(B)}),this.on("partialdone",function(B){T.partialFlush(B)}),this.on("endedtimeline",function(B){T.endTimeline(B)}),this.on("reset",function(B){T.reset(B)}),T},e.prototype.push=function(T){this.trigger("data",T)},e.prototype.flush=function(T){this.trigger("done",T)},e.prototype.partialFlush=function(T){this.trigger("partialdone",T)},e.prototype.endTimeline=function(T){this.trigger("endedtimeline",T)},e.prototype.reset=function(T){this.trigger("reset",T)};var t=e,r=Math.pow(2,32),o=function(T){var B=new DataView(T.buffer,T.byteOffset,T.byteLength),q;return B.getBigUint64?(q=B.getBigUint64(0),q<Number.MAX_SAFE_INTEGER?Number(q):q):B.getUint32(0)*r+B.getUint32(4)},f={getUint64:o,MAX_UINT32:r},p=f.MAX_UINT32,E,N,$,he,Te,we,Me,Ge,ke,qe,$e,tt,Je,st,We,dt,Dt,kt,Xt,Ui,si,Mi,Ot,ui,xn,hi,dr,Ya,ul,cl,dl,hl,mh,Em,_m,bm;(function(){var T;if(Ot={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(T in Ot)Ot.hasOwnProperty(T)&&(Ot[T]=[T.charCodeAt(0),T.charCodeAt(1),T.charCodeAt(2),T.charCodeAt(3)]);ui=new Uint8Array([105,115,111,109]),hi=new Uint8Array([97,118,99,49]),xn=new Uint8Array([0,0,0,1]),dr=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Ya=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),ul={video:dr,audio:Ya},hl=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),dl=new Uint8Array([0,0,0,0,0,0,0,0]),mh=new Uint8Array([0,0,0,0,0,0,0,0]),Em=mh,_m=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),bm=mh,cl=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),E=function(T){var B=[],q=0,H,oe,pe;for(H=1;H<arguments.length;H++)B.push(arguments[H]);for(H=B.length;H--;)q+=B[H].byteLength;for(oe=new Uint8Array(q+8),pe=new DataView(oe.buffer,oe.byteOffset,oe.byteLength),pe.setUint32(0,oe.byteLength),oe.set(T,4),H=0,q=8;H<B.length;H++)oe.set(B[H],q),q+=B[H].byteLength;return oe},N=function(){return E(Ot.dinf,E(Ot.dref,hl))},$=function(T){return E(Ot.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,T.audioobjecttype<<3|T.samplingfrequencyindex>>>1,T.samplingfrequencyindex<<7|T.channelcount<<3,6,1,2]))},he=function(){return E(Ot.ftyp,ui,xn,ui,hi)},dt=function(T){return E(Ot.hdlr,ul[T])},Te=function(T){return E(Ot.mdat,T)},We=function(T){var B=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,T.duration>>>24&255,T.duration>>>16&255,T.duration>>>8&255,T.duration&255,85,196,0,0]);return T.samplerate&&(B[12]=T.samplerate>>>24&255,B[13]=T.samplerate>>>16&255,B[14]=T.samplerate>>>8&255,B[15]=T.samplerate&255),E(Ot.mdhd,B)},st=function(T){return E(Ot.mdia,We(T),dt(T.type),Me(T))},we=function(T){return E(Ot.mfhd,new Uint8Array([0,0,0,0,(T&4278190080)>>24,(T&16711680)>>16,(T&65280)>>8,T&255]))},Me=function(T){return E(Ot.minf,T.type==="video"?E(Ot.vmhd,cl):E(Ot.smhd,dl),N(),kt(T))},Ge=function(T,B){for(var q=[],H=B.length;H--;)q[H]=Ui(B[H]);return E.apply(null,[Ot.moof,we(T)].concat(q))},ke=function(T){for(var B=T.length,q=[];B--;)q[B]=tt(T[B]);return E.apply(null,[Ot.moov,$e(4294967295)].concat(q).concat(qe(T)))},qe=function(T){for(var B=T.length,q=[];B--;)q[B]=si(T[B]);return E.apply(null,[Ot.mvex].concat(q))},$e=function(T){var B=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(T&4278190080)>>24,(T&16711680)>>16,(T&65280)>>8,T&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return E(Ot.mvhd,B)},Dt=function(T){var B=T.samples||[],q=new Uint8Array(4+B.length),H,oe;for(oe=0;oe<B.length;oe++)H=B[oe].flags,q[oe+4]=H.dependsOn<<4|H.isDependedOn<<2|H.hasRedundancy;return E(Ot.sdtp,q)},kt=function(T){return E(Ot.stbl,Xt(T),E(Ot.stts,bm),E(Ot.stsc,Em),E(Ot.stsz,_m),E(Ot.stco,mh))},function(){var T,B;Xt=function(q){return E(Ot.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),q.type==="video"?T(q):B(q))},T=function(q){var H=q.sps||[],oe=q.pps||[],pe=[],Le=[],Ie,Pe;for(Ie=0;Ie<H.length;Ie++)pe.push((H[Ie].byteLength&65280)>>>8),pe.push(H[Ie].byteLength&255),pe=pe.concat(Array.prototype.slice.call(H[Ie]));for(Ie=0;Ie<oe.length;Ie++)Le.push((oe[Ie].byteLength&65280)>>>8),Le.push(oe[Ie].byteLength&255),Le=Le.concat(Array.prototype.slice.call(oe[Ie]));if(Pe=[Ot.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(q.width&65280)>>8,q.width&255,(q.height&65280)>>8,q.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),E(Ot.avcC,new Uint8Array([1,q.profileIdc,q.profileCompatibility,q.levelIdc,255].concat([H.length],pe,[oe.length],Le))),E(Ot.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],q.sarRatio){var Be=q.sarRatio[0],Ye=q.sarRatio[1];Pe.push(E(Ot.pasp,new Uint8Array([(Be&4278190080)>>24,(Be&16711680)>>16,(Be&65280)>>8,Be&255,(Ye&4278190080)>>24,(Ye&16711680)>>16,(Ye&65280)>>8,Ye&255])))}return E.apply(null,Pe)},B=function(q){return E(Ot.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(q.channelcount&65280)>>8,q.channelcount&255,(q.samplesize&65280)>>8,q.samplesize&255,0,0,0,0,(q.samplerate&65280)>>8,q.samplerate&255,0,0]),$(q))}}(),Je=function(T){var B=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(T.id&4278190080)>>24,(T.id&16711680)>>16,(T.id&65280)>>8,T.id&255,0,0,0,0,(T.duration&4278190080)>>24,(T.duration&16711680)>>16,(T.duration&65280)>>8,T.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(T.width&65280)>>8,T.width&255,0,0,(T.height&65280)>>8,T.height&255,0,0]);return E(Ot.tkhd,B)},Ui=function(T){var B,q,H,oe,pe,Le,Ie;return B=E(Ot.tfhd,new Uint8Array([0,0,0,58,(T.id&4278190080)>>24,(T.id&16711680)>>16,(T.id&65280)>>8,T.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),Le=Math.floor(T.baseMediaDecodeTime/p),Ie=Math.floor(T.baseMediaDecodeTime%p),q=E(Ot.tfdt,new Uint8Array([1,0,0,0,Le>>>24&255,Le>>>16&255,Le>>>8&255,Le&255,Ie>>>24&255,Ie>>>16&255,Ie>>>8&255,Ie&255])),pe=92,T.type==="audio"?(H=Mi(T,pe),E(Ot.traf,B,q,H)):(oe=Dt(T),H=Mi(T,oe.length+pe),E(Ot.traf,B,q,H,oe))},tt=function(T){return T.duration=T.duration||4294967295,E(Ot.trak,Je(T),st(T))},si=function(T){var B=new Uint8Array([0,0,0,0,(T.id&4278190080)>>24,(T.id&16711680)>>16,(T.id&65280)>>8,T.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return T.type!=="video"&&(B[B.length-1]=0),E(Ot.trex,B)},function(){var T,B,q;q=function(H,oe){var pe=0,Le=0,Ie=0,Pe=0;return H.length&&(H[0].duration!==void 0&&(pe=1),H[0].size!==void 0&&(Le=2),H[0].flags!==void 0&&(Ie=4),H[0].compositionTimeOffset!==void 0&&(Pe=8)),[0,0,pe|Le|Ie|Pe,1,(H.length&4278190080)>>>24,(H.length&16711680)>>>16,(H.length&65280)>>>8,H.length&255,(oe&4278190080)>>>24,(oe&16711680)>>>16,(oe&65280)>>>8,oe&255]},B=function(H,oe){var pe,Le,Ie,Pe,Be,Ye;for(Pe=H.samples||[],oe+=20+16*Pe.length,Ie=q(Pe,oe),Le=new Uint8Array(Ie.length+Pe.length*16),Le.set(Ie),pe=Ie.length,Ye=0;Ye<Pe.length;Ye++)Be=Pe[Ye],Le[pe++]=(Be.duration&4278190080)>>>24,Le[pe++]=(Be.duration&16711680)>>>16,Le[pe++]=(Be.duration&65280)>>>8,Le[pe++]=Be.duration&255,Le[pe++]=(Be.size&4278190080)>>>24,Le[pe++]=(Be.size&16711680)>>>16,Le[pe++]=(Be.size&65280)>>>8,Le[pe++]=Be.size&255,Le[pe++]=Be.flags.isLeading<<2|Be.flags.dependsOn,Le[pe++]=Be.flags.isDependedOn<<6|Be.flags.hasRedundancy<<4|Be.flags.paddingValue<<1|Be.flags.isNonSyncSample,Le[pe++]=Be.flags.degradationPriority&61440,Le[pe++]=Be.flags.degradationPriority&15,Le[pe++]=(Be.compositionTimeOffset&4278190080)>>>24,Le[pe++]=(Be.compositionTimeOffset&16711680)>>>16,Le[pe++]=(Be.compositionTimeOffset&65280)>>>8,Le[pe++]=Be.compositionTimeOffset&255;return E(Ot.trun,Le)},T=function(H,oe){var pe,Le,Ie,Pe,Be,Ye;for(Pe=H.samples||[],oe+=20+8*Pe.length,Ie=q(Pe,oe),pe=new Uint8Array(Ie.length+Pe.length*8),pe.set(Ie),Le=Ie.length,Ye=0;Ye<Pe.length;Ye++)Be=Pe[Ye],pe[Le++]=(Be.duration&4278190080)>>>24,pe[Le++]=(Be.duration&16711680)>>>16,pe[Le++]=(Be.duration&65280)>>>8,pe[Le++]=Be.duration&255,pe[Le++]=(Be.size&4278190080)>>>24,pe[Le++]=(Be.size&16711680)>>>16,pe[Le++]=(Be.size&65280)>>>8,pe[Le++]=Be.size&255;return E(Ot.trun,pe)},Mi=function(H,oe){return H.type==="audio"?T(H,oe):B(H,oe)}}();var tE={ftyp:he,mdat:Te,moof:Ge,moov:ke,initSegment:function(T){var B=he(),q=ke(T),H;return H=new Uint8Array(B.byteLength+q.byteLength),H.set(B),H.set(q,B.byteLength),H}},iE=function(T){var B,q,H=[],oe=[];for(oe.byteLength=0,oe.nalCount=0,oe.duration=0,H.byteLength=0,B=0;B<T.length;B++)q=T[B],q.nalUnitType==="access_unit_delimiter_rbsp"?(H.length&&(H.duration=q.dts-H.dts,oe.byteLength+=H.byteLength,oe.nalCount+=H.length,oe.duration+=H.duration,oe.push(H)),H=[q],H.byteLength=q.data.byteLength,H.pts=q.pts,H.dts=q.dts):(q.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(H.keyFrame=!0),H.duration=q.dts-H.dts,H.byteLength+=q.data.byteLength,H.push(q));return oe.length&&(!H.duration||H.duration<=0)&&(H.duration=oe[oe.length-1].duration),oe.byteLength+=H.byteLength,oe.nalCount+=H.length,oe.duration+=H.duration,oe.push(H),oe},rE=function(T){var B,q,H=[],oe=[];for(H.byteLength=0,H.nalCount=0,H.duration=0,H.pts=T[0].pts,H.dts=T[0].dts,oe.byteLength=0,oe.nalCount=0,oe.duration=0,oe.pts=T[0].pts,oe.dts=T[0].dts,B=0;B<T.length;B++)q=T[B],q.keyFrame?(H.length&&(oe.push(H),oe.byteLength+=H.byteLength,oe.nalCount+=H.nalCount,oe.duration+=H.duration),H=[q],H.nalCount=q.length,H.byteLength=q.byteLength,H.pts=q.pts,H.dts=q.dts,H.duration=q.duration):(H.duration+=q.duration,H.nalCount+=q.length,H.byteLength+=q.byteLength,H.push(q));return oe.length&&H.duration<=0&&(H.duration=oe[oe.length-1].duration),oe.byteLength+=H.byteLength,oe.nalCount+=H.nalCount,oe.duration+=H.duration,oe.push(H),oe},nE=function(T){var B;return!T[0][0].keyFrame&&T.length>1&&(B=T.shift(),T.byteLength-=B.byteLength,T.nalCount-=B.nalCount,T[0][0].dts=B.dts,T[0][0].pts=B.pts,T[0][0].duration+=B.duration),T},sE=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},Am=function(T,B){var q=sE();return q.dataOffset=B,q.compositionTimeOffset=T.pts-T.dts,q.duration=T.duration,q.size=4*T.length,q.size+=T.byteLength,T.keyFrame&&(q.flags.dependsOn=2,q.flags.isNonSyncSample=0),q},aE=function(T,B){var q,H,oe,pe,Le,Ie=B||0,Pe=[];for(q=0;q<T.length;q++)for(pe=T[q],H=0;H<pe.length;H++)Le=pe[H],oe=Am(Le,Ie),Ie+=oe.size,Pe.push(oe);return Pe},oE=function(T){var B,q,H,oe,pe,Le,Ie=0,Pe=T.byteLength,Be=T.nalCount,Ye=Pe+4*Be,at=new Uint8Array(Ye),bt=new DataView(at.buffer);for(B=0;B<T.length;B++)for(oe=T[B],q=0;q<oe.length;q++)for(pe=oe[q],H=0;H<pe.length;H++)Le=pe[H],bt.setUint32(Ie,Le.data.byteLength),Ie+=4,at.set(Le.data,Ie),Ie+=Le.data.byteLength;return at},lE=function(T,B){var q,H=B||0,oe=[];return q=Am(T,H),oe.push(q),oe},uE=function(T){var B,q,H=0,oe=T.byteLength,pe=T.length,Le=oe+4*pe,Ie=new Uint8Array(Le),Pe=new DataView(Ie.buffer);for(B=0;B<T.length;B++)q=T[B],Pe.setUint32(H,q.data.byteLength),H+=4,Ie.set(q.data,H),H+=q.data.byteLength;return Ie},cE={groupNalsIntoFrames:iE,groupFramesIntoGops:rE,extendFirstKeyFrame:nE,generateSampleTable:aE,concatenateNalData:oE,generateSampleTableForFrame:lE,concatenateNalDataForFrame:uE},So=[33,16,5,32,164,27],cp=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],xi=function(T){for(var B=[];T--;)B.push(0);return B},dE=function(T){return Object.keys(T).reduce(function(B,q){return B[q]=new Uint8Array(T[q].reduce(function(H,oe){return H.concat(oe)},[])),B},{})},dp,hE=function(){if(!dp){var T={96e3:[So,[227,64],xi(154),[56]],88200:[So,[231],xi(170),[56]],64e3:[So,[248,192],xi(240),[56]],48e3:[So,[255,192],xi(268),[55,148,128],xi(54),[112]],44100:[So,[255,192],xi(268),[55,163,128],xi(84),[112]],32e3:[So,[255,192],xi(268),[55,234],xi(226),[112]],24e3:[So,[255,192],xi(268),[55,255,128],xi(268),[111,112],xi(126),[224]],16e3:[So,[255,192],xi(268),[55,255,128],xi(268),[111,255],xi(269),[223,108],xi(195),[1,192]],12e3:[cp,xi(268),[3,127,248],xi(268),[6,255,240],xi(268),[13,255,224],xi(268),[27,253,128],xi(259),[56]],11025:[cp,xi(268),[3,127,248],xi(268),[6,255,240],xi(268),[13,255,224],xi(268),[27,255,192],xi(268),[55,175,128],xi(108),[112]],8e3:[cp,xi(268),[3,121,16],xi(47),[7]]};dp=dE(T)}return dp},hp=9e4,fp,pp,vh,gp,Sm,xm,Cm;fp=function(T){return T*hp},pp=function(T,B){return T*B},vh=function(T){return T/hp},gp=function(T,B){return T/B},Sm=function(T,B){return fp(gp(T,B))},xm=function(T,B){return pp(vh(T),B)},Cm=function(T,B,q){return vh(q?T:T-B)};var qi={ONE_SECOND_IN_TS:hp,secondsToVideoTs:fp,secondsToAudioTs:pp,videoTsToSeconds:vh,audioTsToSeconds:gp,audioTsToVideoTs:Sm,videoTsToAudioTs:xm,metadataTsToSeconds:Cm},fE=hE,yh=qi,pE=function(T){var B,q,H=0;for(B=0;B<T.length;B++)q=T[B],H+=q.data.byteLength;return H},gE=function(T,B,q,H){var oe,pe=0,Le=0,Ie=0,Pe=0,Be,Ye,at;if(B.length&&(oe=yh.audioTsToVideoTs(T.baseMediaDecodeTime,T.samplerate),pe=Math.ceil(yh.ONE_SECOND_IN_TS/(T.samplerate/1024)),q&&H&&(Le=oe-Math.max(q,H),Ie=Math.floor(Le/pe),Pe=Ie*pe),!(Ie<1||Pe>yh.ONE_SECOND_IN_TS/2))){for(Be=fE()[T.samplerate],Be||(Be=B[0].data),Ye=0;Ye<Ie;Ye++)at=B[0],B.splice(0,0,{data:Be,dts:at.dts-pe,pts:at.pts-pe});return T.baseMediaDecodeTime-=Math.floor(yh.videoTsToAudioTs(Pe,T.samplerate)),Pe}},mE=function(T,B,q){return B.minSegmentDts>=q?T:(B.minSegmentDts=1/0,T.filter(function(H){return H.dts>=q?(B.minSegmentDts=Math.min(B.minSegmentDts,H.dts),B.minSegmentPts=B.minSegmentDts,!0):!1}))},vE=function(T){var B,q,H=[];for(B=0;B<T.length;B++)q=T[B],H.push({size:q.data.byteLength,duration:1024});return H},yE=function(T){var B,q,H=0,oe=new Uint8Array(pE(T));for(B=0;B<T.length;B++)q=T[B],oe.set(q.data,H),H+=q.data.byteLength;return oe},TE={prefixWithSilence:gE,trimAdtsFramesByEarliestDts:mE,generateSampleTable:vE,concatenateFrameData:yE},EE=qi.ONE_SECOND_IN_TS,_E=function(T,B){typeof B.pts=="number"&&(T.timelineStartInfo.pts===void 0&&(T.timelineStartInfo.pts=B.pts),T.minSegmentPts===void 0?T.minSegmentPts=B.pts:T.minSegmentPts=Math.min(T.minSegmentPts,B.pts),T.maxSegmentPts===void 0?T.maxSegmentPts=B.pts:T.maxSegmentPts=Math.max(T.maxSegmentPts,B.pts)),typeof B.dts=="number"&&(T.timelineStartInfo.dts===void 0&&(T.timelineStartInfo.dts=B.dts),T.minSegmentDts===void 0?T.minSegmentDts=B.dts:T.minSegmentDts=Math.min(T.minSegmentDts,B.dts),T.maxSegmentDts===void 0?T.maxSegmentDts=B.dts:T.maxSegmentDts=Math.max(T.maxSegmentDts,B.dts))},bE=function(T){delete T.minSegmentDts,delete T.maxSegmentDts,delete T.minSegmentPts,delete T.maxSegmentPts},AE=function(T,B){var q,H,oe=T.minSegmentDts;return B||(oe-=T.timelineStartInfo.dts),q=T.timelineStartInfo.baseMediaDecodeTime,q+=oe,q=Math.max(0,q),T.type==="audio"&&(H=T.samplerate/EE,q*=H,q=Math.floor(q)),q},SE={clearDtsInfo:bE,calculateTrackBaseMediaDecodeTime:AE,collectDtsInfo:_E},km=4,xE=128,CE=function(T){for(var B=0,q={payloadType:-1,payloadSize:0},H=0,oe=0;B<T.byteLength&&T[B]!==xE;){for(;T[B]===255;)H+=255,B++;for(H+=T[B++];T[B]===255;)oe+=255,B++;if(oe+=T[B++],!q.payload&&H===km){var pe=String.fromCharCode(T[B+3],T[B+4],T[B+5],T[B+6]);if(pe==="GA94"){q.payloadType=H,q.payloadSize=oe,q.payload=T.subarray(B,B+oe);break}else q.payload=void 0}B+=oe,H=0,oe=0}return q},kE=function(T){return T.payload[0]!==181||(T.payload[1]<<8|T.payload[2])!==49||String.fromCharCode(T.payload[3],T.payload[4],T.payload[5],T.payload[6])!=="GA94"||T.payload[7]!==3?null:T.payload.subarray(8,T.payload.length-1)},DE=function(T,B){var q=[],H,oe,pe,Le;if(!(B[0]&64))return q;for(oe=B[0]&31,H=0;H<oe;H++)pe=H*3,Le={type:B[pe+2]&3,pts:T},B[pe+2]&4&&(Le.ccData=B[pe+3]<<8|B[pe+4],q.push(Le));return q},wE=function(T){for(var B=T.byteLength,q=[],H=1,oe,pe;H<B-2;)T[H]===0&&T[H+1]===0&&T[H+2]===3?(q.push(H+2),H+=2):H++;if(q.length===0)return T;oe=B-q.length,pe=new Uint8Array(oe);var Le=0;for(H=0;H<oe;Le++,H++)Le===q[0]&&(Le++,q.shift()),pe[H]=T[Le];return pe},Dm={parseSei:CE,parseUserData:kE,parseCaptionPackets:DE,discardEmulationPreventionBytes:wE,USER_DATA_REGISTERED_ITU_T_T35:km},mp=t,Th=Dm,Bn=function(T){T=T||{},Bn.prototype.init.call(this),this.parse708captions_=typeof T.parse708captions=="boolean"?T.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Qi(0,0),new Qi(0,1),new Qi(1,0),new Qi(1,1)],this.parse708captions_&&(this.cc708Stream_=new Ni({captionServices:T.captionServices})),this.reset(),this.ccStreams_.forEach(function(B){B.on("data",this.trigger.bind(this,"data")),B.on("partialdone",this.trigger.bind(this,"partialdone")),B.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Bn.prototype=new mp,Bn.prototype.push=function(T){var B,q,H;if(T.nalUnitType==="sei_rbsp"&&(B=Th.parseSei(T.escapedRBSP),!!B.payload&&B.payloadType===Th.USER_DATA_REGISTERED_ITU_T_T35&&(q=Th.parseUserData(B),!!q))){if(T.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(T.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}H=Th.parseCaptionPackets(T.pts,q),this.captionPackets_=this.captionPackets_.concat(H),this.latestDts_!==T.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=T.dts}},Bn.prototype.flushCCStreams=function(T){this.ccStreams_.forEach(function(B){return T==="flush"?B.flush():B.partialFlush()},this)},Bn.prototype.flushStream=function(T){if(!this.captionPackets_.length){this.flushCCStreams(T);return}this.captionPackets_.forEach(function(B,q){B.presortIndex=q}),this.captionPackets_.sort(function(B,q){return B.pts===q.pts?B.presortIndex-q.presortIndex:B.pts-q.pts}),this.captionPackets_.forEach(function(B){B.type<2?this.dispatchCea608Packet(B):this.dispatchCea708Packet(B)},this),this.captionPackets_.length=0,this.flushCCStreams(T)},Bn.prototype.flush=function(){return this.flushStream("flush")},Bn.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Bn.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(T){T.reset()})},Bn.prototype.dispatchCea608Packet=function(T){this.setsTextOrXDSActive(T)?this.activeCea608Channel_[T.type]=null:this.setsChannel1Active(T)?this.activeCea608Channel_[T.type]=0:this.setsChannel2Active(T)&&(this.activeCea608Channel_[T.type]=1),this.activeCea608Channel_[T.type]!==null&&this.ccStreams_[(T.type<<1)+this.activeCea608Channel_[T.type]].push(T)},Bn.prototype.setsChannel1Active=function(T){return(T.ccData&30720)===4096},Bn.prototype.setsChannel2Active=function(T){return(T.ccData&30720)===6144},Bn.prototype.setsTextOrXDSActive=function(T){return(T.ccData&28928)===256||(T.ccData&30974)===4138||(T.ccData&30974)===6186},Bn.prototype.dispatchCea708Packet=function(T){this.parse708captions_&&this.cc708Stream_.push(T)};var LE={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},IE=function(T){var B=LE[T]||T;return T&4096&&T===B?"":String.fromCharCode(B)},Eh=function(T){return 32<=T&&T<=127||160<=T&&T<=255},Xa=function(T){this.windowNum=T,this.reset()};Xa.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Xa.prototype.getText=function(){return this.rows.join(`
`)},Xa.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Xa.prototype.newLine=function(T){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(T),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Xa.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Xa.prototype.addText=function(T){this.rows[this.rowIdx]+=T},Xa.prototype.backspace=function(){if(!this.isEmpty()){var T=this.rows[this.rowIdx];this.rows[this.rowIdx]=T.substr(0,T.length-1)}};var _h=function(T,B,q){this.serviceNum=T,this.text="",this.currentWindow=new Xa(-1),this.windows=[],this.stream=q,typeof B=="string"&&this.createTextDecoder(B)};_h.prototype.init=function(T,B){this.startPts=T;for(var q=0;q<8;q++)this.windows[q]=new Xa(q),typeof B=="function"&&(this.windows[q].beforeRowOverflow=B)},_h.prototype.setCurrentWindow=function(T){this.currentWindow=this.windows[T]},_h.prototype.createTextDecoder=function(T){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(T)}catch(B){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+T+" encoding. "+B})}};var Ni=function(T){T=T||{},Ni.prototype.init.call(this);var B=this,q=T.captionServices||{},H={},oe;Object.keys(q).forEach(pe=>{oe=q[pe],/^SERVICE/.test(pe)&&(H[pe]=oe.encoding)}),this.serviceEncodings=H,this.current708Packet=null,this.services={},this.push=function(pe){pe.type===3?(B.new708Packet(),B.add708Bytes(pe)):(B.current708Packet===null&&B.new708Packet(),B.add708Bytes(pe))}};Ni.prototype=new mp,Ni.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Ni.prototype.add708Bytes=function(T){var B=T.ccData,q=B>>>8,H=B&255;this.current708Packet.ptsVals.push(T.pts),this.current708Packet.data.push(q),this.current708Packet.data.push(H)},Ni.prototype.push708Packet=function(){var T=this.current708Packet,B=T.data,q=null,H=null,oe=0,pe=B[oe++];for(T.seq=pe>>6,T.sizeCode=pe&63;oe<B.length;oe++)pe=B[oe++],q=pe>>5,H=pe&31,q===7&&H>0&&(pe=B[oe++],q=pe),this.pushServiceBlock(q,oe,H),H>0&&(oe+=H-1)},Ni.prototype.pushServiceBlock=function(T,B,q){var H,oe=B,pe=this.current708Packet.data,Le=this.services[T];for(Le||(Le=this.initService(T,oe));oe<B+q&&oe<pe.length;oe++)H=pe[oe],Eh(H)?oe=this.handleText(oe,Le):H===24?oe=this.multiByteCharacter(oe,Le):H===16?oe=this.extendedCommands(oe,Le):128<=H&&H<=135?oe=this.setCurrentWindow(oe,Le):152<=H&&H<=159?oe=this.defineWindow(oe,Le):H===136?oe=this.clearWindows(oe,Le):H===140?oe=this.deleteWindows(oe,Le):H===137?oe=this.displayWindows(oe,Le):H===138?oe=this.hideWindows(oe,Le):H===139?oe=this.toggleWindows(oe,Le):H===151?oe=this.setWindowAttributes(oe,Le):H===144?oe=this.setPenAttributes(oe,Le):H===145?oe=this.setPenColor(oe,Le):H===146?oe=this.setPenLocation(oe,Le):H===143?Le=this.reset(oe,Le):H===8?Le.currentWindow.backspace():H===12?Le.currentWindow.clearText():H===13?Le.currentWindow.pendingNewLine=!0:H===14?Le.currentWindow.clearText():H===141&&oe++},Ni.prototype.extendedCommands=function(T,B){var q=this.current708Packet.data,H=q[++T];return Eh(H)&&(T=this.handleText(T,B,{isExtended:!0})),T},Ni.prototype.getPts=function(T){return this.current708Packet.ptsVals[Math.floor(T/2)]},Ni.prototype.initService=function(T,B){var H="SERVICE"+T,q=this,H,oe;return H in this.serviceEncodings&&(oe=this.serviceEncodings[H]),this.services[T]=new _h(T,oe,q),this.services[T].init(this.getPts(B),function(pe){q.flushDisplayed(pe,q.services[T])}),this.services[T]},Ni.prototype.handleText=function(T,B,q){var H=q&&q.isExtended,oe=q&&q.isMultiByte,pe=this.current708Packet.data,Le=H?4096:0,Ie=pe[T],Pe=pe[T+1],Be=B.currentWindow,Ye,at;function bt(pt){return pt.map(Ut=>("0"+(Ut&255).toString(16)).slice(-2)).join("")}if(oe?(at=[Ie,Pe],T++):at=[Ie],B.textDecoder_&&!H)Ye=B.textDecoder_.decode(new Uint8Array(at));else if(oe){const pt=bt(at);Ye=String.fromCharCode(parseInt(pt,16))}else Ye=IE(Le|Ie);return Be.pendingNewLine&&!Be.isEmpty()&&Be.newLine(this.getPts(T)),Be.pendingNewLine=!1,Be.addText(Ye),T},Ni.prototype.multiByteCharacter=function(T,B){var q=this.current708Packet.data,H=q[T+1],oe=q[T+2];return Eh(H)&&Eh(oe)&&(T=this.handleText(++T,B,{isMultiByte:!0})),T},Ni.prototype.setCurrentWindow=function(T,B){var q=this.current708Packet.data,H=q[T],oe=H&7;return B.setCurrentWindow(oe),T},Ni.prototype.defineWindow=function(T,B){var q=this.current708Packet.data,H=q[T],oe=H&7;B.setCurrentWindow(oe);var pe=B.currentWindow;return H=q[++T],pe.visible=(H&32)>>5,pe.rowLock=(H&16)>>4,pe.columnLock=(H&8)>>3,pe.priority=H&7,H=q[++T],pe.relativePositioning=(H&128)>>7,pe.anchorVertical=H&127,H=q[++T],pe.anchorHorizontal=H,H=q[++T],pe.anchorPoint=(H&240)>>4,pe.rowCount=H&15,H=q[++T],pe.columnCount=H&63,H=q[++T],pe.windowStyle=(H&56)>>3,pe.penStyle=H&7,pe.virtualRowCount=pe.rowCount+1,T},Ni.prototype.setWindowAttributes=function(T,B){var q=this.current708Packet.data,H=q[T],oe=B.currentWindow.winAttr;return H=q[++T],oe.fillOpacity=(H&192)>>6,oe.fillRed=(H&48)>>4,oe.fillGreen=(H&12)>>2,oe.fillBlue=H&3,H=q[++T],oe.borderType=(H&192)>>6,oe.borderRed=(H&48)>>4,oe.borderGreen=(H&12)>>2,oe.borderBlue=H&3,H=q[++T],oe.borderType+=(H&128)>>5,oe.wordWrap=(H&64)>>6,oe.printDirection=(H&48)>>4,oe.scrollDirection=(H&12)>>2,oe.justify=H&3,H=q[++T],oe.effectSpeed=(H&240)>>4,oe.effectDirection=(H&12)>>2,oe.displayEffect=H&3,T},Ni.prototype.flushDisplayed=function(T,B){for(var q=[],H=0;H<8;H++)B.windows[H].visible&&!B.windows[H].isEmpty()&&q.push(B.windows[H].getText());B.endPts=T,B.text=q.join(`

`),this.pushCaption(B),B.startPts=T},Ni.prototype.pushCaption=function(T){T.text!==""&&(this.trigger("data",{startPts:T.startPts,endPts:T.endPts,text:T.text,stream:"cc708_"+T.serviceNum}),T.text="",T.startPts=T.endPts)},Ni.prototype.displayWindows=function(T,B){var q=this.current708Packet.data,H=q[++T],oe=this.getPts(T);this.flushDisplayed(oe,B);for(var pe=0;pe<8;pe++)H&1<<pe&&(B.windows[pe].visible=1);return T},Ni.prototype.hideWindows=function(T,B){var q=this.current708Packet.data,H=q[++T],oe=this.getPts(T);this.flushDisplayed(oe,B);for(var pe=0;pe<8;pe++)H&1<<pe&&(B.windows[pe].visible=0);return T},Ni.prototype.toggleWindows=function(T,B){var q=this.current708Packet.data,H=q[++T],oe=this.getPts(T);this.flushDisplayed(oe,B);for(var pe=0;pe<8;pe++)H&1<<pe&&(B.windows[pe].visible^=1);return T},Ni.prototype.clearWindows=function(T,B){var q=this.current708Packet.data,H=q[++T],oe=this.getPts(T);this.flushDisplayed(oe,B);for(var pe=0;pe<8;pe++)H&1<<pe&&B.windows[pe].clearText();return T},Ni.prototype.deleteWindows=function(T,B){var q=this.current708Packet.data,H=q[++T],oe=this.getPts(T);this.flushDisplayed(oe,B);for(var pe=0;pe<8;pe++)H&1<<pe&&B.windows[pe].reset();return T},Ni.prototype.setPenAttributes=function(T,B){var q=this.current708Packet.data,H=q[T],oe=B.currentWindow.penAttr;return H=q[++T],oe.textTag=(H&240)>>4,oe.offset=(H&12)>>2,oe.penSize=H&3,H=q[++T],oe.italics=(H&128)>>7,oe.underline=(H&64)>>6,oe.edgeType=(H&56)>>3,oe.fontStyle=H&7,T},Ni.prototype.setPenColor=function(T,B){var q=this.current708Packet.data,H=q[T],oe=B.currentWindow.penColor;return H=q[++T],oe.fgOpacity=(H&192)>>6,oe.fgRed=(H&48)>>4,oe.fgGreen=(H&12)>>2,oe.fgBlue=H&3,H=q[++T],oe.bgOpacity=(H&192)>>6,oe.bgRed=(H&48)>>4,oe.bgGreen=(H&12)>>2,oe.bgBlue=H&3,H=q[++T],oe.edgeRed=(H&48)>>4,oe.edgeGreen=(H&12)>>2,oe.edgeBlue=H&3,T},Ni.prototype.setPenLocation=function(T,B){var q=this.current708Packet.data,H=q[T],oe=B.currentWindow.penLoc;return B.currentWindow.pendingNewLine=!0,H=q[++T],oe.row=H&15,H=q[++T],oe.column=H&63,T},Ni.prototype.reset=function(T,B){var q=this.getPts(T);return this.flushDisplayed(q,B),this.initService(B.serviceNum,T)};var RE={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},bh=function(T){return T===null?"":(T=RE[T]||T,String.fromCharCode(T))},Ah=14,PE=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],fl=function(){for(var T=[],B=Ah+1;B--;)T.push({text:"",indent:0,offset:0});return T},Qi=function(T,B){Qi.prototype.init.call(this),this.field_=T||0,this.dataChannel_=B||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(q){var H,oe,pe,Le,Ie;if(H=q.ccData&32639,H===this.lastControlCode_){this.lastControlCode_=null;return}if((H&61440)===4096?this.lastControlCode_=H:H!==this.PADDING_&&(this.lastControlCode_=null),pe=H>>>8,Le=H&255,H!==this.PADDING_)if(H===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(H===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(q.pts),this.flushDisplayed(q.pts),oe=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=oe,this.startPts_=q.pts;else if(H===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(q.pts);else if(H===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(q.pts);else if(H===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(q.pts);else if(H===this.CARRIAGE_RETURN_)this.clearFormatting(q.pts),this.flushDisplayed(q.pts),this.shiftRowsUp_(),this.startPts_=q.pts;else if(H===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(H===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(q.pts),this.displayed_=fl();else if(H===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=fl();else if(H===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(q.pts),this.displayed_=fl()),this.mode_="paintOn",this.startPts_=q.pts;else if(this.isSpecialCharacter(pe,Le))pe=(pe&3)<<8,Ie=bh(pe|Le),this[this.mode_](q.pts,Ie),this.column_++;else if(this.isExtCharacter(pe,Le))this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),pe=(pe&3)<<8,Ie=bh(pe|Le),this[this.mode_](q.pts,Ie),this.column_++;else if(this.isMidRowCode(pe,Le))this.clearFormatting(q.pts),this[this.mode_](q.pts," "),this.column_++,(Le&14)===14&&this.addFormatting(q.pts,["i"]),(Le&1)===1&&this.addFormatting(q.pts,["u"]);else if(this.isOffsetControlCode(pe,Le)){const Be=Le&3;this.nonDisplayed_[this.row_].offset=Be,this.column_+=Be}else if(this.isPAC(pe,Le)){var Pe=PE.indexOf(H&7968);if(this.mode_==="rollUp"&&(Pe-this.rollUpRows_+1<0&&(Pe=this.rollUpRows_-1),this.setRollUp(q.pts,Pe)),Pe!==this.row_&&Pe>=0&&Pe<=14&&(this.clearFormatting(q.pts),this.row_=Pe),Le&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(q.pts,["u"]),(H&16)===16){const Be=(H&14)>>1;this.column_=Be*4,this.nonDisplayed_[this.row_].indent+=Be}this.isColorPAC(Le)&&(Le&14)===14&&this.addFormatting(q.pts,["i"])}else this.isNormalChar(pe)&&(Le===0&&(Le=null),Ie=bh(pe),Ie+=bh(Le),this[this.mode_](q.pts,Ie),this.column_+=Ie.length)}};Qi.prototype=new mp,Qi.prototype.flushDisplayed=function(T){const B=H=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+H+"."})},q=[];this.displayed_.forEach((H,oe)=>{if(H&&H.text&&H.text.length){try{H.text=H.text.trim()}catch{B(oe)}H.text.length&&q.push({text:H.text,line:oe+1,position:10+Math.min(70,H.indent*10)+H.offset*2.5})}else H==null&&B(oe)}),q.length&&this.trigger("data",{startPts:this.startPts_,endPts:T,content:q,stream:this.name_})},Qi.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=fl(),this.nonDisplayed_=fl(),this.lastControlCode_=null,this.column_=0,this.row_=Ah,this.rollUpRows_=2,this.formatting_=[]},Qi.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Qi.prototype.isSpecialCharacter=function(T,B){return T===this.EXT_&&B>=48&&B<=63},Qi.prototype.isExtCharacter=function(T,B){return(T===this.EXT_+1||T===this.EXT_+2)&&B>=32&&B<=63},Qi.prototype.isMidRowCode=function(T,B){return T===this.EXT_&&B>=32&&B<=47},Qi.prototype.isOffsetControlCode=function(T,B){return T===this.OFFSET_&&B>=33&&B<=35},Qi.prototype.isPAC=function(T,B){return T>=this.BASE_&&T<this.BASE_+8&&B>=64&&B<=127},Qi.prototype.isColorPAC=function(T){return T>=64&&T<=79||T>=96&&T<=127},Qi.prototype.isNormalChar=function(T){return T>=32&&T<=127},Qi.prototype.setRollUp=function(T,B){if(this.mode_!=="rollUp"&&(this.row_=Ah,this.mode_="rollUp",this.flushDisplayed(T),this.nonDisplayed_=fl(),this.displayed_=fl()),B!==void 0&&B!==this.row_)for(var q=0;q<this.rollUpRows_;q++)this.displayed_[B-q]=this.displayed_[this.row_-q],this.displayed_[this.row_-q]={text:"",indent:0,offset:0};B===void 0&&(B=this.row_),this.topRow_=B-this.rollUpRows_+1},Qi.prototype.addFormatting=function(T,B){this.formatting_=this.formatting_.concat(B);var q=B.reduce(function(H,oe){return H+"<"+oe+">"},"");this[this.mode_](T,q)},Qi.prototype.clearFormatting=function(T){if(this.formatting_.length){var B=this.formatting_.reverse().reduce(function(q,H){return q+"</"+H+">"},"");this.formatting_=[],this[this.mode_](T,B)}},Qi.prototype.popOn=function(T,B){var q=this.nonDisplayed_[this.row_].text;q+=B,this.nonDisplayed_[this.row_].text=q},Qi.prototype.rollUp=function(T,B){var q=this.displayed_[this.row_].text;q+=B,this.displayed_[this.row_].text=q},Qi.prototype.shiftRowsUp_=function(){var T;for(T=0;T<this.topRow_;T++)this.displayed_[T]={text:"",indent:0,offset:0};for(T=this.row_+1;T<Ah+1;T++)this.displayed_[T]={text:"",indent:0,offset:0};for(T=this.topRow_;T<this.row_;T++)this.displayed_[T]=this.displayed_[T+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Qi.prototype.paintOn=function(T,B){var q=this.displayed_[this.row_].text;q+=B,this.displayed_[this.row_].text=q};var wm={CaptionStream:Bn,Cea608Stream:Qi,Cea708Stream:Ni},Sh={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},OE=t,ME=8589934592,NE=4294967296,Lm="shared",vp=function(T,B){var q=1;for(T>B&&(q=-1);Math.abs(B-T)>NE;)T+=q*ME;return T},yp=function(T){var B,q;yp.prototype.init.call(this),this.type_=T||Lm,this.push=function(H){if(H.type==="metadata"){this.trigger("data",H);return}this.type_!==Lm&&H.type!==this.type_||(q===void 0&&(q=H.dts),H.dts=vp(H.dts,q),H.pts=vp(H.pts,q),B=H.dts,this.trigger("data",H))},this.flush=function(){q=B,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){q=void 0,B=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};yp.prototype=new OE;var Im={TimestampRolloverStream:yp,handleRollover:vp},FE=(T,B,q)=>{if(!T)return-1;for(var H=q;H<T.length;H++)if(T[H]===B)return H;return-1},BE={typedArrayIndexOf:FE},xh=BE.typedArrayIndexOf,Ch={Iso88591:0,Utf16:1,Utf16be:2,Utf8:3},Rm=function(T,B,q){var H,oe="";for(H=B;H<q;H++)oe+="%"+("00"+T[H].toString(16)).slice(-2);return oe},Ic=function(T,B,q){return decodeURIComponent(Rm(T,B,q))},Rc=function(T,B,q){return unescape(Rm(T,B,q))},Pc=function(T){return T[0]<<21|T[1]<<14|T[2]<<7|T[3]},Oc={APIC:function(T){var B=1,q,H,oe="-->";T.data[0]===Ch.Utf8&&(q=xh(T.data,0,B),!(q<0)&&(T.mimeType=Rc(T.data,B,q),B=q+1,T.pictureType=T.data[B],B++,H=xh(T.data,0,B),!(H<0)&&(T.description=Ic(T.data,B,H),B=H+1,T.mimeType===oe?T.url=Rc(T.data,B,T.data.length):T.pictureData=T.data.subarray(B,T.data.length))))},"T*":function(T){T.data[0]===Ch.Utf8&&(T.value=Ic(T.data,1,T.data.length).replace(/\0*$/,""),T.values=T.value.split("\0"))},TXXX:function(T){var B;T.data[0]===Ch.Utf8&&(B=xh(T.data,0,1),B!==-1&&(T.description=Ic(T.data,1,B),T.value=Ic(T.data,B+1,T.data.length).replace(/\0*$/,""),T.data=T.value))},"W*":function(T){T.url=Rc(T.data,0,T.data.length).replace(/\0.*$/,"")},WXXX:function(T){var B;T.data[0]===Ch.Utf8&&(B=xh(T.data,0,1),B!==-1&&(T.description=Ic(T.data,1,B),T.url=Rc(T.data,B+1,T.data.length).replace(/\0.*$/,"")))},PRIV:function(T){var B;for(B=0;B<T.data.length;B++)if(T.data[B]===0){T.owner=Rc(T.data,0,B);break}T.privateData=T.data.subarray(B+1),T.data=T.privateData}},UE=function(T){var B,q,H=10,oe=0,pe=[];if(!(T.length<10||T[0]!==73||T[1]!==68||T[2]!==51)){oe=Pc(T.subarray(6,10)),oe+=10;var Le=T[5]&64;Le&&(H+=4,H+=Pc(T.subarray(10,14)),oe-=Pc(T.subarray(16,20)));do{if(B=Pc(T.subarray(H+4,H+8)),B<1)break;q=String.fromCharCode(T[H],T[H+1],T[H+2],T[H+3]);var Ie={id:q,data:T.subarray(H+10,H+B+10)};Ie.key=Ie.id,Oc[Ie.id]?Oc[Ie.id](Ie):Ie.id[0]==="T"?Oc["T*"](Ie):Ie.id[0]==="W"&&Oc["W*"](Ie),pe.push(Ie),H+=10,H+=B}while(H<oe);return pe}},Pm={parseId3Frames:UE,parseSyncSafeInteger:Pc,frameParsers:Oc},GE=t,VE=Sh,xo=Pm,kh;kh=function(T){var B={descriptor:T&&T.descriptor},q=0,H=[],oe=0,pe;if(kh.prototype.init.call(this),this.dispatchType=VE.METADATA_STREAM_TYPE.toString(16),B.descriptor)for(pe=0;pe<B.descriptor.length;pe++)this.dispatchType+=("00"+B.descriptor[pe].toString(16)).slice(-2);this.push=function(Le){var Ie,Pe,Be,Ye,at,bt;if(Le.type==="timed-metadata"){if(Le.dataAlignmentIndicator&&(oe=0,H.length=0),H.length===0&&(Le.data.length<10||Le.data[0]!==73||Le.data[1]!==68||Le.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(H.push(Le),oe+=Le.data.byteLength,H.length===1&&(q=xo.parseSyncSafeInteger(Le.data.subarray(6,10)),q+=10),!(oe<q)){for(Ie={data:new Uint8Array(q),frames:[],pts:H[0].pts,dts:H[0].dts},at=0;at<q;)Ie.data.set(H[0].data.subarray(0,q-at),at),at+=H[0].data.byteLength,oe-=H[0].data.byteLength,H.shift();Pe=10,Ie.data[5]&64&&(Pe+=4,Pe+=xo.parseSyncSafeInteger(Ie.data.subarray(10,14)),q-=xo.parseSyncSafeInteger(Ie.data.subarray(16,20)));do{if(Be=xo.parseSyncSafeInteger(Ie.data.subarray(Pe+4,Pe+8)),Be<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(bt=String.fromCharCode(Ie.data[Pe],Ie.data[Pe+1],Ie.data[Pe+2],Ie.data[Pe+3]),Ye={id:bt,data:Ie.data.subarray(Pe+10,Pe+Be+10)},Ye.key=Ye.id,xo.frameParsers[Ye.id]?xo.frameParsers[Ye.id](Ye):Ye.id[0]==="T"?xo.frameParsers["T*"](Ye):Ye.id[0]==="W"&&xo.frameParsers["W*"](Ye),Ye.owner==="com.apple.streaming.transportStreamTimestamp"){var pt=Ye.data,Ut=(pt[3]&1)<<30|pt[4]<<22|pt[5]<<14|pt[6]<<6|pt[7]>>>2;Ut*=4,Ut+=pt[7]&3,Ye.timeStamp=Ut,Ie.pts===void 0&&Ie.dts===void 0&&(Ie.pts=Ye.timeStamp,Ie.dts=Ye.timeStamp),this.trigger("timestamp",Ye)}Ie.frames.push(Ye),Pe+=10,Pe+=Be}while(Pe<q);this.trigger("data",Ie)}}}},kh.prototype=new GE;var HE=kh,Tp=t,Ep=wm,Vs=Sh,jE=Im.TimestampRolloverStream,Dh,Mc,wh,Eu=188,_p=71;Dh=function(){var T=new Uint8Array(Eu),B=0;Dh.prototype.init.call(this),this.push=function(q){var H=0,oe=Eu,pe;for(B?(pe=new Uint8Array(q.byteLength+B),pe.set(T.subarray(0,B)),pe.set(q,B),B=0):pe=q;oe<pe.byteLength;){if(pe[H]===_p&&pe[oe]===_p){this.trigger("data",pe.subarray(H,oe)),H+=Eu,oe+=Eu;continue}H++,oe++}H<pe.byteLength&&(T.set(pe.subarray(H),0),B=pe.byteLength-H)},this.flush=function(){B===Eu&&T[0]===_p&&(this.trigger("data",T),B=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){B=0,this.trigger("reset")}},Dh.prototype=new Tp,Mc=function(){var T,B,q,H;Mc.prototype.init.call(this),H=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,T=function(oe,pe){var Le=0;pe.payloadUnitStartIndicator&&(Le+=oe[Le]+1),pe.type==="pat"?B(oe.subarray(Le),pe):q(oe.subarray(Le),pe)},B=function(oe,pe){pe.section_number=oe[7],pe.last_section_number=oe[8],H.pmtPid=(oe[10]&31)<<8|oe[11],pe.pmtPid=H.pmtPid},q=function(oe,pe){var Le,Ie,Pe,Be;if(oe[5]&1){for(H.programMapTable={video:null,audio:null,"timed-metadata":{}},Le=(oe[1]&15)<<8|oe[2],Ie=3+Le-4,Pe=(oe[10]&15)<<8|oe[11],Be=12+Pe;Be<Ie;){var Ye=oe[Be],at=(oe[Be+1]&31)<<8|oe[Be+2];Ye===Vs.H264_STREAM_TYPE&&H.programMapTable.video===null?H.programMapTable.video=at:Ye===Vs.ADTS_STREAM_TYPE&&H.programMapTable.audio===null?H.programMapTable.audio=at:Ye===Vs.METADATA_STREAM_TYPE&&(H.programMapTable["timed-metadata"][at]=Ye),Be+=((oe[Be+3]&15)<<8|oe[Be+4])+5}pe.programMapTable=H.programMapTable}},this.push=function(oe){var pe={},Le=4;if(pe.payloadUnitStartIndicator=!!(oe[1]&64),pe.pid=oe[1]&31,pe.pid<<=8,pe.pid|=oe[2],(oe[3]&48)>>>4>1&&(Le+=oe[Le]+1),pe.pid===0)pe.type="pat",T(oe.subarray(Le),pe),this.trigger("data",pe);else if(pe.pid===this.pmtPid)for(pe.type="pmt",T(oe.subarray(Le),pe),this.trigger("data",pe);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([oe,Le,pe]):this.processPes_(oe,Le,pe)},this.processPes_=function(oe,pe,Le){Le.pid===this.programMapTable.video?Le.streamType=Vs.H264_STREAM_TYPE:Le.pid===this.programMapTable.audio?Le.streamType=Vs.ADTS_STREAM_TYPE:Le.streamType=this.programMapTable["timed-metadata"][Le.pid],Le.type="pes",Le.data=oe.subarray(pe),this.trigger("data",Le)}},Mc.prototype=new Tp,Mc.STREAM_TYPES={h264:27,adts:15},wh=function(){var T=this,B=!1,q={data:[],size:0},H={data:[],size:0},oe={data:[],size:0},pe,Le=function(Pe,Be){var Ye;const at=Pe[0]<<16|Pe[1]<<8|Pe[2];Be.data=new Uint8Array,at===1&&(Be.packetLength=6+(Pe[4]<<8|Pe[5]),Be.dataAlignmentIndicator=(Pe[6]&4)!==0,Ye=Pe[7],Ye&192&&(Be.pts=(Pe[9]&14)<<27|(Pe[10]&255)<<20|(Pe[11]&254)<<12|(Pe[12]&255)<<5|(Pe[13]&254)>>>3,Be.pts*=4,Be.pts+=(Pe[13]&6)>>>1,Be.dts=Be.pts,Ye&64&&(Be.dts=(Pe[14]&14)<<27|(Pe[15]&255)<<20|(Pe[16]&254)<<12|(Pe[17]&255)<<5|(Pe[18]&254)>>>3,Be.dts*=4,Be.dts+=(Pe[18]&6)>>>1)),Be.data=Pe.subarray(9+Pe[8]))},Ie=function(Pe,Be,Ye){var at=new Uint8Array(Pe.size),bt={type:Be},pt=0,Ut=0,$t=!1,Ir;if(!(!Pe.data.length||Pe.size<9)){for(bt.trackId=Pe.data[0].pid,pt=0;pt<Pe.data.length;pt++)Ir=Pe.data[pt],at.set(Ir.data,Ut),Ut+=Ir.data.byteLength;Le(at,bt),$t=Be==="video"||bt.packetLength<=Pe.size,(Ye||$t)&&(Pe.size=0,Pe.data.length=0),$t&&T.trigger("data",bt)}};wh.prototype.init.call(this),this.push=function(Pe){({pat:function(){},pes:function(){var Be,Ye;switch(Pe.streamType){case Vs.H264_STREAM_TYPE:Be=q,Ye="video";break;case Vs.ADTS_STREAM_TYPE:Be=H,Ye="audio";break;case Vs.METADATA_STREAM_TYPE:Be=oe,Ye="timed-metadata";break;default:return}Pe.payloadUnitStartIndicator&&Ie(Be,Ye,!0),Be.data.push(Pe),Be.size+=Pe.data.byteLength},pmt:function(){var Be={type:"metadata",tracks:[]};pe=Pe.programMapTable,pe.video!==null&&Be.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+pe.video,codec:"avc",type:"video"}),pe.audio!==null&&Be.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+pe.audio,codec:"adts",type:"audio"}),B=!0,T.trigger("data",Be)}})[Pe.type]()},this.reset=function(){q.size=0,q.data.length=0,H.size=0,H.data.length=0,this.trigger("reset")},this.flushStreams_=function(){Ie(q,"video"),Ie(H,"audio"),Ie(oe,"timed-metadata")},this.flush=function(){if(!B&&pe){var Pe={type:"metadata",tracks:[]};pe.video!==null&&Pe.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+pe.video,codec:"avc",type:"video"}),pe.audio!==null&&Pe.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+pe.audio,codec:"adts",type:"audio"}),T.trigger("data",Pe)}B=!1,this.flushStreams_(),this.trigger("done")}},wh.prototype=new Tp;var Om={PAT_PID:0,MP2T_PACKET_LENGTH:Eu,TransportPacketStream:Dh,TransportParseStream:Mc,ElementaryStream:wh,TimestampRolloverStream:jE,CaptionStream:Ep.CaptionStream,Cea608Stream:Ep.Cea608Stream,Cea708Stream:Ep.Cea708Stream,MetadataStream:HE};for(var bp in Vs)Vs.hasOwnProperty(bp)&&(Om[bp]=Vs[bp]);var KE=Om,qE=t,$E=qi.ONE_SECOND_IN_TS,Lh,Mm=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Lh=function(T){var B,q=0;Lh.prototype.init.call(this),this.skipWarn_=function(H,oe){this.trigger("log",{level:"warn",message:`adts skiping bytes ${H} to ${oe} in frame ${q} outside syncword`})},this.push=function(H){var oe=0,pe,Le,Ie,Pe,Be;if(T||(q=0),H.type==="audio"){B&&B.length?(Ie=B,B=new Uint8Array(Ie.byteLength+H.data.byteLength),B.set(Ie),B.set(H.data,Ie.byteLength)):B=H.data;for(var Ye;oe+7<B.length;){if(B[oe]!==255||(B[oe+1]&246)!==240){typeof Ye!="number"&&(Ye=oe),oe++;continue}if(typeof Ye=="number"&&(this.skipWarn_(Ye,oe),Ye=null),Le=(~B[oe+1]&1)*2,pe=(B[oe+3]&3)<<11|B[oe+4]<<3|(B[oe+5]&224)>>5,Pe=((B[oe+6]&3)+1)*1024,Be=Pe*$E/Mm[(B[oe+2]&60)>>>2],B.byteLength-oe<pe)break;this.trigger("data",{pts:H.pts+q*Be,dts:H.dts+q*Be,sampleCount:Pe,audioobjecttype:(B[oe+2]>>>6&3)+1,channelcount:(B[oe+2]&1)<<2|(B[oe+3]&192)>>>6,samplerate:Mm[(B[oe+2]&60)>>>2],samplingfrequencyindex:(B[oe+2]&60)>>>2,samplesize:16,data:B.subarray(oe+7+Le,oe+pe)}),q++,oe+=pe}typeof Ye=="number"&&(this.skipWarn_(Ye,oe),Ye=null),B=B.subarray(oe)}},this.flush=function(){q=0,this.trigger("done")},this.reset=function(){B=void 0,this.trigger("reset")},this.endTimeline=function(){B=void 0,this.trigger("endedtimeline")}},Lh.prototype=new qE;var WE=Lh,Nm;Nm=function(T){var B=T.byteLength,q=0,H=0;this.length=function(){return 8*B},this.bitsAvailable=function(){return 8*B+H},this.loadWord=function(){var oe=T.byteLength-B,pe=new Uint8Array(4),Le=Math.min(4,B);if(Le===0)throw new Error("no bytes available");pe.set(T.subarray(oe,oe+Le)),q=new DataView(pe.buffer).getUint32(0),H=Le*8,B-=Le},this.skipBits=function(oe){var pe;H>oe?(q<<=oe,H-=oe):(oe-=H,pe=Math.floor(oe/8),oe-=pe*8,B-=pe,this.loadWord(),q<<=oe,H-=oe)},this.readBits=function(oe){var pe=Math.min(H,oe),Le=q>>>32-pe;return H-=pe,H>0?q<<=pe:B>0&&this.loadWord(),pe=oe-pe,pe>0?Le<<pe|this.readBits(pe):Le},this.skipLeadingZeros=function(){var oe;for(oe=0;oe<H;++oe)if(q&2147483648>>>oe)return q<<=oe,H-=oe,oe;return this.loadWord(),oe+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var oe=this.skipLeadingZeros();return this.readBits(oe+1)-1},this.readExpGolomb=function(){var oe=this.readUnsignedExpGolomb();return 1&oe?1+oe>>>1:-1*(oe>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var zE=Nm,Fm=t,YE=zE,Ih,Nc,Bm;Nc=function(){var T=0,B,q;Nc.prototype.init.call(this),this.push=function(H){var oe;q?(oe=new Uint8Array(q.byteLength+H.data.byteLength),oe.set(q),oe.set(H.data,q.byteLength),q=oe):q=H.data;for(var pe=q.byteLength;T<pe-3;T++)if(q[T+2]===1){B=T+5;break}for(;B<pe;)switch(q[B]){case 0:if(q[B-1]!==0){B+=2;break}else if(q[B-2]!==0){B++;break}T+3!==B-2&&this.trigger("data",q.subarray(T+3,B-2));do B++;while(q[B]!==1&&B<pe);T=B-2,B+=3;break;case 1:if(q[B-1]!==0||q[B-2]!==0){B+=3;break}this.trigger("data",q.subarray(T+3,B-2)),T=B-2,B+=3;break;default:B+=3;break}q=q.subarray(T),B-=T,T=0},this.reset=function(){q=null,T=0,this.trigger("reset")},this.flush=function(){q&&q.byteLength>3&&this.trigger("data",q.subarray(T+3)),q=null,T=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Nc.prototype=new Fm,Bm={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Ih=function(){var T=new Nc,B,q,H,oe,pe,Le,Ie;Ih.prototype.init.call(this),B=this,this.push=function(Pe){Pe.type==="video"&&(q=Pe.trackId,H=Pe.pts,oe=Pe.dts,T.push(Pe))},T.on("data",function(Pe){var Be={trackId:q,pts:H,dts:oe,data:Pe,nalUnitTypeCode:Pe[0]&31};switch(Be.nalUnitTypeCode){case 5:Be.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:Be.nalUnitType="sei_rbsp",Be.escapedRBSP=pe(Pe.subarray(1));break;case 7:Be.nalUnitType="seq_parameter_set_rbsp",Be.escapedRBSP=pe(Pe.subarray(1)),Be.config=Le(Be.escapedRBSP);break;case 8:Be.nalUnitType="pic_parameter_set_rbsp";break;case 9:Be.nalUnitType="access_unit_delimiter_rbsp";break}B.trigger("data",Be)}),T.on("done",function(){B.trigger("done")}),T.on("partialdone",function(){B.trigger("partialdone")}),T.on("reset",function(){B.trigger("reset")}),T.on("endedtimeline",function(){B.trigger("endedtimeline")}),this.flush=function(){T.flush()},this.partialFlush=function(){T.partialFlush()},this.reset=function(){T.reset()},this.endTimeline=function(){T.endTimeline()},Ie=function(Pe,Be){var Ye=8,at=8,bt,pt;for(bt=0;bt<Pe;bt++)at!==0&&(pt=Be.readExpGolomb(),at=(Ye+pt+256)%256),Ye=at===0?Ye:at},pe=function(Pe){for(var Be=Pe.byteLength,Ye=[],at=1,bt,pt;at<Be-2;)Pe[at]===0&&Pe[at+1]===0&&Pe[at+2]===3?(Ye.push(at+2),at+=2):at++;if(Ye.length===0)return Pe;bt=Be-Ye.length,pt=new Uint8Array(bt);var Ut=0;for(at=0;at<bt;Ut++,at++)Ut===Ye[0]&&(Ut++,Ye.shift()),pt[at]=Pe[Ut];return pt},Le=function(Pe){var Be=0,Ye=0,at=0,bt=0,pt,Ut,$t,Ir,hs,ml,hv,fv,pv,Pp,gv,fr=[1,1],mv,vl;if(pt=new YE(Pe),Ut=pt.readUnsignedByte(),Ir=pt.readUnsignedByte(),$t=pt.readUnsignedByte(),pt.skipUnsignedExpGolomb(),Bm[Ut]&&(hs=pt.readUnsignedExpGolomb(),hs===3&&pt.skipBits(1),pt.skipUnsignedExpGolomb(),pt.skipUnsignedExpGolomb(),pt.skipBits(1),pt.readBoolean()))for(gv=hs!==3?8:12,vl=0;vl<gv;vl++)pt.readBoolean()&&(vl<6?Ie(16,pt):Ie(64,pt));if(pt.skipUnsignedExpGolomb(),ml=pt.readUnsignedExpGolomb(),ml===0)pt.readUnsignedExpGolomb();else if(ml===1)for(pt.skipBits(1),pt.skipExpGolomb(),pt.skipExpGolomb(),hv=pt.readUnsignedExpGolomb(),vl=0;vl<hv;vl++)pt.skipExpGolomb();if(pt.skipUnsignedExpGolomb(),pt.skipBits(1),fv=pt.readUnsignedExpGolomb(),pv=pt.readUnsignedExpGolomb(),Pp=pt.readBits(1),Pp===0&&pt.skipBits(1),pt.skipBits(1),pt.readBoolean()&&(Be=pt.readUnsignedExpGolomb(),Ye=pt.readUnsignedExpGolomb(),at=pt.readUnsignedExpGolomb(),bt=pt.readUnsignedExpGolomb()),pt.readBoolean()&&pt.readBoolean()){switch(mv=pt.readUnsignedByte(),mv){case 1:fr=[1,1];break;case 2:fr=[12,11];break;case 3:fr=[10,11];break;case 4:fr=[16,11];break;case 5:fr=[40,33];break;case 6:fr=[24,11];break;case 7:fr=[20,11];break;case 8:fr=[32,11];break;case 9:fr=[80,33];break;case 10:fr=[18,11];break;case 11:fr=[15,11];break;case 12:fr=[64,33];break;case 13:fr=[160,99];break;case 14:fr=[4,3];break;case 15:fr=[3,2];break;case 16:fr=[2,1];break;case 255:{fr=[pt.readUnsignedByte()<<8|pt.readUnsignedByte(),pt.readUnsignedByte()<<8|pt.readUnsignedByte()];break}}fr&&fr[0]/fr[1]}return{profileIdc:Ut,levelIdc:$t,profileCompatibility:Ir,width:(fv+1)*16-Be*2-Ye*2,height:(2-Pp)*(pv+1)*16-at*2-bt*2,sarRatio:fr}}},Ih.prototype=new Fm;var XE={H264Stream:Ih,NalByteStream:Nc},QE=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Um=function(T,B){var q=T[B+6]<<21|T[B+7]<<14|T[B+8]<<7|T[B+9],H=T[B+5],oe=(H&16)>>4;return q=q>=0?q:0,oe?q+20:q+10},Gm=function(T,B){return T.length-B<10||T[B]!==73||T[B+1]!==68||T[B+2]!==51?B:(B+=Um(T,B),Gm(T,B))},JE=function(T){var B=Gm(T,0);return T.length>=B+2&&(T[B]&255)===255&&(T[B+1]&240)===240&&(T[B+1]&22)===16},Vm=function(T){return T[0]<<21|T[1]<<14|T[2]<<7|T[3]},ZE=function(T,B,q){var H,oe="";for(H=B;H<q;H++)oe+="%"+("00"+T[H].toString(16)).slice(-2);return oe},e_=function(T,B,q){return unescape(ZE(T,B,q))},t_=function(T,B){var q=(T[B+5]&224)>>5,H=T[B+4]<<3,oe=T[B+3]&6144;return oe|H|q},i_=function(T,B){return T[B]===73&&T[B+1]===68&&T[B+2]===51?"timed-metadata":T[B]&!0&&(T[B+1]&240)===240?"audio":null},r_=function(T){for(var B=0;B+5<T.length;){if(T[B]!==255||(T[B+1]&246)!==240){B++;continue}return QE[(T[B+2]&60)>>>2]}return null},n_=function(T){var B,q,H,oe;B=10,T[5]&64&&(B+=4,B+=Vm(T.subarray(10,14)));do{if(q=Vm(T.subarray(B+4,B+8)),q<1)return null;if(oe=String.fromCharCode(T[B],T[B+1],T[B+2],T[B+3]),oe==="PRIV"){H=T.subarray(B+10,B+q+10);for(var pe=0;pe<H.byteLength;pe++)if(H[pe]===0){var Le=e_(H,0,pe);if(Le==="com.apple.streaming.transportStreamTimestamp"){var Ie=H.subarray(pe+1),Pe=(Ie[3]&1)<<30|Ie[4]<<22|Ie[5]<<14|Ie[6]<<6|Ie[7]>>>2;return Pe*=4,Pe+=Ie[7]&3,Pe}break}}B+=10,B+=q}while(B<T.byteLength);return null},Ap={isLikelyAacData:JE,parseId3TagSize:Um,parseAdtsSize:t_,parseType:i_,parseSampleRate:r_,parseAacTimestamp:n_},s_=t,Hm=Ap,Rh;Rh=function(){var T=new Uint8Array,B=0;Rh.prototype.init.call(this),this.setTimestamp=function(q){B=q},this.push=function(q){var H=0,oe=0,pe,Le,Ie,Pe;for(T.length?(Pe=T.length,T=new Uint8Array(q.byteLength+Pe),T.set(T.subarray(0,Pe)),T.set(q,Pe)):T=q;T.length-oe>=3;){if(T[oe]===73&&T[oe+1]===68&&T[oe+2]===51){if(T.length-oe<10||(H=Hm.parseId3TagSize(T,oe),oe+H>T.length))break;Le={type:"timed-metadata",data:T.subarray(oe,oe+H)},this.trigger("data",Le),oe+=H;continue}else if((T[oe]&255)===255&&(T[oe+1]&240)===240){if(T.length-oe<7||(H=Hm.parseAdtsSize(T,oe),oe+H>T.length))break;Ie={type:"audio",data:T.subarray(oe,oe+H),pts:B,dts:B},this.trigger("data",Ie),oe+=H;continue}oe++}pe=T.length-oe,pe>0?T=T.subarray(oe):T=new Uint8Array},this.reset=function(){T=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){T=new Uint8Array,this.trigger("endedtimeline")}},Rh.prototype=new s_;var a_=Rh,o_=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],l_=o_,u_=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],c_=u_,Ph=t,Fc=tE,Bc=cE,Oh=TE,Hs=SE,Qa=KE,Mh=qi,jm=WE,d_=XE.H264Stream,h_=a_,f_=Ap.isLikelyAacData,p_=qi.ONE_SECOND_IN_TS,Sp=l_,xp=c_,Uc,_u,Nh,pl,g_=function(T,B){B.stream=T,this.trigger("log",B)},Km=function(T,B){for(var q=Object.keys(B),H=0;H<q.length;H++){var oe=q[H];oe==="headOfPipeline"||!B[oe].on||B[oe].on("log",g_.bind(T,oe))}},qm=function(T,B){var q;if(T.length!==B.length)return!1;for(q=0;q<T.length;q++)if(T[q]!==B[q])return!1;return!0},Cp=function(T,B,q,H,oe,pe){var Le=q-B,Ie=H-B,Pe=oe-q;return{start:{dts:T,pts:T+Le},end:{dts:T+Ie,pts:T+Pe},prependedContentDuration:pe,baseMediaDecodeTime:T}};_u=function(T,B){var q=[],H,oe=0,pe=0,Le=1/0;B=B||{},H=B.firstSequenceNumber||0,_u.prototype.init.call(this),this.push=function(Ie){Hs.collectDtsInfo(T,Ie),T&&Sp.forEach(function(Pe){T[Pe]=Ie[Pe]}),q.push(Ie)},this.setEarliestDts=function(Ie){oe=Ie},this.setVideoBaseMediaDecodeTime=function(Ie){Le=Ie},this.setAudioAppendStart=function(Ie){pe=Ie},this.flush=function(){var Ie,Pe,Be,Ye,at,bt,pt;if(q.length===0){this.trigger("done","AudioSegmentStream");return}Ie=Oh.trimAdtsFramesByEarliestDts(q,T,oe),T.baseMediaDecodeTime=Hs.calculateTrackBaseMediaDecodeTime(T,B.keepOriginalTimestamps),pt=Oh.prefixWithSilence(T,Ie,pe,Le),T.samples=Oh.generateSampleTable(Ie),Be=Fc.mdat(Oh.concatenateFrameData(Ie)),q=[],Pe=Fc.moof(H,[T]),Ye=new Uint8Array(Pe.byteLength+Be.byteLength),H++,Ye.set(Pe),Ye.set(Be,Pe.byteLength),Hs.clearDtsInfo(T),at=Math.ceil(p_*1024/T.samplerate),Ie.length&&(bt=Ie.length*at,this.trigger("segmentTimingInfo",Cp(Mh.audioTsToVideoTs(T.baseMediaDecodeTime,T.samplerate),Ie[0].dts,Ie[0].pts,Ie[0].dts+bt,Ie[0].pts+bt,pt||0)),this.trigger("timingInfo",{start:Ie[0].pts,end:Ie[0].pts+bt})),this.trigger("data",{track:T,boxes:Ye}),this.trigger("done","AudioSegmentStream")},this.reset=function(){Hs.clearDtsInfo(T),q=[],this.trigger("reset")}},_u.prototype=new Ph,Uc=function(T,B){var q,H=[],oe=[],pe,Le;B=B||{},q=B.firstSequenceNumber||0,Uc.prototype.init.call(this),delete T.minPTS,this.gopCache_=[],this.push=function(Ie){Hs.collectDtsInfo(T,Ie),Ie.nalUnitType==="seq_parameter_set_rbsp"&&!pe&&(pe=Ie.config,T.sps=[Ie.data],xp.forEach(function(Pe){T[Pe]=pe[Pe]},this)),Ie.nalUnitType==="pic_parameter_set_rbsp"&&!Le&&(Le=Ie.data,T.pps=[Ie.data]),H.push(Ie)},this.flush=function(){for(var Ie,Pe,Be,Ye,at,bt,pt=0,Ut,$t;H.length&&H[0].nalUnitType!=="access_unit_delimiter_rbsp";)H.shift();if(H.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(Ie=Bc.groupNalsIntoFrames(H),Be=Bc.groupFramesIntoGops(Ie),Be[0][0].keyFrame||(Pe=this.getGopForFusion_(H[0],T),Pe?(pt=Pe.duration,Be.unshift(Pe),Be.byteLength+=Pe.byteLength,Be.nalCount+=Pe.nalCount,Be.pts=Pe.pts,Be.dts=Pe.dts,Be.duration+=Pe.duration):Be=Bc.extendFirstKeyFrame(Be)),oe.length){var Ir;if(B.alignGopsAtEnd?Ir=this.alignGopsAtEnd_(Be):Ir=this.alignGopsAtStart_(Be),!Ir){this.gopCache_.unshift({gop:Be.pop(),pps:T.pps,sps:T.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),H=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}Hs.clearDtsInfo(T),Be=Ir}Hs.collectDtsInfo(T,Be),T.samples=Bc.generateSampleTable(Be),at=Fc.mdat(Bc.concatenateNalData(Be)),T.baseMediaDecodeTime=Hs.calculateTrackBaseMediaDecodeTime(T,B.keepOriginalTimestamps),this.trigger("processedGopsInfo",Be.map(function(hs){return{pts:hs.pts,dts:hs.dts,byteLength:hs.byteLength}})),Ut=Be[0],$t=Be[Be.length-1],this.trigger("segmentTimingInfo",Cp(T.baseMediaDecodeTime,Ut.dts,Ut.pts,$t.dts+$t.duration,$t.pts+$t.duration,pt)),this.trigger("timingInfo",{start:Be[0].pts,end:Be[Be.length-1].pts+Be[Be.length-1].duration}),this.gopCache_.unshift({gop:Be.pop(),pps:T.pps,sps:T.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),H=[],this.trigger("baseMediaDecodeTime",T.baseMediaDecodeTime),this.trigger("timelineStartInfo",T.timelineStartInfo),Ye=Fc.moof(q,[T]),bt=new Uint8Array(Ye.byteLength+at.byteLength),q++,bt.set(Ye),bt.set(at,Ye.byteLength),this.trigger("data",{track:T,boxes:bt}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),H=[],this.gopCache_.length=0,oe.length=0,this.trigger("reset")},this.resetStream_=function(){Hs.clearDtsInfo(T),pe=void 0,Le=void 0},this.getGopForFusion_=function(Ie){var Pe=45e3,Be=1e4,Ye=1/0,at,bt,pt,Ut,$t;for($t=0;$t<this.gopCache_.length;$t++)Ut=this.gopCache_[$t],pt=Ut.gop,!(!(T.pps&&qm(T.pps[0],Ut.pps[0]))||!(T.sps&&qm(T.sps[0],Ut.sps[0])))&&(pt.dts<T.timelineStartInfo.dts||(at=Ie.dts-pt.dts-pt.duration,at>=-Be&&at<=Pe&&(!bt||Ye>at)&&(bt=Ut,Ye=at)));return bt?bt.gop:null},this.alignGopsAtStart_=function(Ie){var Pe,Be,Ye,at,bt,pt,Ut,$t;for(bt=Ie.byteLength,pt=Ie.nalCount,Ut=Ie.duration,Pe=Be=0;Pe<oe.length&&Be<Ie.length&&(Ye=oe[Pe],at=Ie[Be],Ye.pts!==at.pts);){if(at.pts>Ye.pts){Pe++;continue}Be++,bt-=at.byteLength,pt-=at.nalCount,Ut-=at.duration}return Be===0?Ie:Be===Ie.length?null:($t=Ie.slice(Be),$t.byteLength=bt,$t.duration=Ut,$t.nalCount=pt,$t.pts=$t[0].pts,$t.dts=$t[0].dts,$t)},this.alignGopsAtEnd_=function(Ie){var Pe,Be,Ye,at,bt,pt;for(Pe=oe.length-1,Be=Ie.length-1,bt=null,pt=!1;Pe>=0&&Be>=0;){if(Ye=oe[Pe],at=Ie[Be],Ye.pts===at.pts){pt=!0;break}if(Ye.pts>at.pts){Pe--;continue}Pe===oe.length-1&&(bt=Be),Be--}if(!pt&&bt===null)return null;var Ut;if(pt?Ut=Be:Ut=bt,Ut===0)return Ie;var $t=Ie.slice(Ut),Ir=$t.reduce(function(hs,ml){return hs.byteLength+=ml.byteLength,hs.duration+=ml.duration,hs.nalCount+=ml.nalCount,hs},{byteLength:0,duration:0,nalCount:0});return $t.byteLength=Ir.byteLength,$t.duration=Ir.duration,$t.nalCount=Ir.nalCount,$t.pts=$t[0].pts,$t.dts=$t[0].dts,$t},this.alignGopsWith=function(Ie){oe=Ie}},Uc.prototype=new Ph,pl=function(T,B){this.numberOfTracks=0,this.metadataStream=B,T=T||{},typeof T.remux<"u"?this.remuxTracks=!!T.remux:this.remuxTracks=!0,typeof T.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=T.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,pl.prototype.init.call(this),this.push=function(q){if(q.content||q.text)return this.pendingCaptions.push(q);if(q.frames)return this.pendingMetadata.push(q);this.pendingTracks.push(q.track),this.pendingBytes+=q.boxes.byteLength,q.track.type==="video"&&(this.videoTrack=q.track,this.pendingBoxes.push(q.boxes)),q.track.type==="audio"&&(this.audioTrack=q.track,this.pendingBoxes.unshift(q.boxes))}},pl.prototype=new Ph,pl.prototype.flush=function(T){var B=0,q={captions:[],captionStreams:{},metadata:[],info:{}},H,oe,pe,Le=0,Ie;if(this.pendingTracks.length<this.numberOfTracks){if(T!=="VideoSegmentStream"&&T!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(Le=this.videoTrack.timelineStartInfo.pts,xp.forEach(function(Pe){q.info[Pe]=this.videoTrack[Pe]},this)):this.audioTrack&&(Le=this.audioTrack.timelineStartInfo.pts,Sp.forEach(function(Pe){q.info[Pe]=this.audioTrack[Pe]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?q.type=this.pendingTracks[0].type:q.type="combined",this.emittedTracks+=this.pendingTracks.length,pe=Fc.initSegment(this.pendingTracks),q.initSegment=new Uint8Array(pe.byteLength),q.initSegment.set(pe),q.data=new Uint8Array(this.pendingBytes),Ie=0;Ie<this.pendingBoxes.length;Ie++)q.data.set(this.pendingBoxes[Ie],B),B+=this.pendingBoxes[Ie].byteLength;for(Ie=0;Ie<this.pendingCaptions.length;Ie++)H=this.pendingCaptions[Ie],H.startTime=Mh.metadataTsToSeconds(H.startPts,Le,this.keepOriginalTimestamps),H.endTime=Mh.metadataTsToSeconds(H.endPts,Le,this.keepOriginalTimestamps),q.captionStreams[H.stream]=!0,q.captions.push(H);for(Ie=0;Ie<this.pendingMetadata.length;Ie++)oe=this.pendingMetadata[Ie],oe.cueTime=Mh.metadataTsToSeconds(oe.pts,Le,this.keepOriginalTimestamps),q.metadata.push(oe);for(q.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",q),Ie=0;Ie<q.captions.length;Ie++)H=q.captions[Ie],this.trigger("caption",H);for(Ie=0;Ie<q.metadata.length;Ie++)oe=q.metadata[Ie],this.trigger("id3Frame",oe)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},pl.prototype.setRemux=function(T){this.remuxTracks=T},Nh=function(T){var B=this,q=!0,H,oe;Nh.prototype.init.call(this),T=T||{},this.baseMediaDecodeTime=T.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var pe={};this.transmuxPipeline_=pe,pe.type="aac",pe.metadataStream=new Qa.MetadataStream,pe.aacStream=new h_,pe.audioTimestampRolloverStream=new Qa.TimestampRolloverStream("audio"),pe.timedMetadataTimestampRolloverStream=new Qa.TimestampRolloverStream("timed-metadata"),pe.adtsStream=new jm,pe.coalesceStream=new pl(T,pe.metadataStream),pe.headOfPipeline=pe.aacStream,pe.aacStream.pipe(pe.audioTimestampRolloverStream).pipe(pe.adtsStream),pe.aacStream.pipe(pe.timedMetadataTimestampRolloverStream).pipe(pe.metadataStream).pipe(pe.coalesceStream),pe.metadataStream.on("timestamp",function(Le){pe.aacStream.setTimestamp(Le.timeStamp)}),pe.aacStream.on("data",function(Le){Le.type!=="timed-metadata"&&Le.type!=="audio"||pe.audioSegmentStream||(oe=oe||{timelineStartInfo:{baseMediaDecodeTime:B.baseMediaDecodeTime},codec:"adts",type:"audio"},pe.coalesceStream.numberOfTracks++,pe.audioSegmentStream=new _u(oe,T),pe.audioSegmentStream.on("log",B.getLogTrigger_("audioSegmentStream")),pe.audioSegmentStream.on("timingInfo",B.trigger.bind(B,"audioTimingInfo")),pe.adtsStream.pipe(pe.audioSegmentStream).pipe(pe.coalesceStream),B.trigger("trackinfo",{hasAudio:!!oe,hasVideo:!!H}))}),pe.coalesceStream.on("data",this.trigger.bind(this,"data")),pe.coalesceStream.on("done",this.trigger.bind(this,"done")),Km(this,pe)},this.setupTsPipeline=function(){var pe={};this.transmuxPipeline_=pe,pe.type="ts",pe.metadataStream=new Qa.MetadataStream,pe.packetStream=new Qa.TransportPacketStream,pe.parseStream=new Qa.TransportParseStream,pe.elementaryStream=new Qa.ElementaryStream,pe.timestampRolloverStream=new Qa.TimestampRolloverStream,pe.adtsStream=new jm,pe.h264Stream=new d_,pe.captionStream=new Qa.CaptionStream(T),pe.coalesceStream=new pl(T,pe.metadataStream),pe.headOfPipeline=pe.packetStream,pe.packetStream.pipe(pe.parseStream).pipe(pe.elementaryStream).pipe(pe.timestampRolloverStream),pe.timestampRolloverStream.pipe(pe.h264Stream),pe.timestampRolloverStream.pipe(pe.adtsStream),pe.timestampRolloverStream.pipe(pe.metadataStream).pipe(pe.coalesceStream),pe.h264Stream.pipe(pe.captionStream).pipe(pe.coalesceStream),pe.elementaryStream.on("data",function(Le){var Ie;if(Le.type==="metadata"){for(Ie=Le.tracks.length;Ie--;)!H&&Le.tracks[Ie].type==="video"?(H=Le.tracks[Ie],H.timelineStartInfo.baseMediaDecodeTime=B.baseMediaDecodeTime):!oe&&Le.tracks[Ie].type==="audio"&&(oe=Le.tracks[Ie],oe.timelineStartInfo.baseMediaDecodeTime=B.baseMediaDecodeTime);H&&!pe.videoSegmentStream&&(pe.coalesceStream.numberOfTracks++,pe.videoSegmentStream=new Uc(H,T),pe.videoSegmentStream.on("log",B.getLogTrigger_("videoSegmentStream")),pe.videoSegmentStream.on("timelineStartInfo",function(Pe){oe&&!T.keepOriginalTimestamps&&(oe.timelineStartInfo=Pe,pe.audioSegmentStream.setEarliestDts(Pe.dts-B.baseMediaDecodeTime))}),pe.videoSegmentStream.on("processedGopsInfo",B.trigger.bind(B,"gopInfo")),pe.videoSegmentStream.on("segmentTimingInfo",B.trigger.bind(B,"videoSegmentTimingInfo")),pe.videoSegmentStream.on("baseMediaDecodeTime",function(Pe){oe&&pe.audioSegmentStream.setVideoBaseMediaDecodeTime(Pe)}),pe.videoSegmentStream.on("timingInfo",B.trigger.bind(B,"videoTimingInfo")),pe.h264Stream.pipe(pe.videoSegmentStream).pipe(pe.coalesceStream)),oe&&!pe.audioSegmentStream&&(pe.coalesceStream.numberOfTracks++,pe.audioSegmentStream=new _u(oe,T),pe.audioSegmentStream.on("log",B.getLogTrigger_("audioSegmentStream")),pe.audioSegmentStream.on("timingInfo",B.trigger.bind(B,"audioTimingInfo")),pe.audioSegmentStream.on("segmentTimingInfo",B.trigger.bind(B,"audioSegmentTimingInfo")),pe.adtsStream.pipe(pe.audioSegmentStream).pipe(pe.coalesceStream)),B.trigger("trackinfo",{hasAudio:!!oe,hasVideo:!!H})}}),pe.coalesceStream.on("data",this.trigger.bind(this,"data")),pe.coalesceStream.on("id3Frame",function(Le){Le.dispatchType=pe.metadataStream.dispatchType,B.trigger("id3Frame",Le)}),pe.coalesceStream.on("caption",this.trigger.bind(this,"caption")),pe.coalesceStream.on("done",this.trigger.bind(this,"done")),Km(this,pe)},this.setBaseMediaDecodeTime=function(pe){var Le=this.transmuxPipeline_;T.keepOriginalTimestamps||(this.baseMediaDecodeTime=pe),oe&&(oe.timelineStartInfo.dts=void 0,oe.timelineStartInfo.pts=void 0,Hs.clearDtsInfo(oe),Le.audioTimestampRolloverStream&&Le.audioTimestampRolloverStream.discontinuity()),H&&(Le.videoSegmentStream&&(Le.videoSegmentStream.gopCache_=[]),H.timelineStartInfo.dts=void 0,H.timelineStartInfo.pts=void 0,Hs.clearDtsInfo(H),Le.captionStream.reset()),Le.timestampRolloverStream&&Le.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(pe){oe&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(pe)},this.setRemux=function(pe){var Le=this.transmuxPipeline_;T.remux=pe,Le&&Le.coalesceStream&&Le.coalesceStream.setRemux(pe)},this.alignGopsWith=function(pe){H&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(pe)},this.getLogTrigger_=function(pe){var Le=this;return function(Ie){Ie.stream=pe,Le.trigger("log",Ie)}},this.push=function(pe){if(q){var Le=f_(pe);Le&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!Le&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),q=!1}this.transmuxPipeline_.headOfPipeline.push(pe)},this.flush=function(){q=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Nh.prototype=new Ph;var m_={Transmuxer:Nh,VideoSegmentStream:Uc,AudioSegmentStream:_u,AUDIO_PROPERTIES:Sp,VIDEO_PROPERTIES:xp,generateSegmentTimingInfo:Cp},v_=function(T){return T>>>0},y_=function(T){return("00"+T.toString(16)).slice(-2)},Fh={toUnsigned:v_,toHexString:y_},T_=function(T){var B="";return B+=String.fromCharCode(T[0]),B+=String.fromCharCode(T[1]),B+=String.fromCharCode(T[2]),B+=String.fromCharCode(T[3]),B},$m=T_,E_=Fh.toUnsigned,__=$m,Wm=function(T,B){var q=[],H,oe,pe,Le,Ie;if(!B.length)return null;for(H=0;H<T.byteLength;)oe=E_(T[H]<<24|T[H+1]<<16|T[H+2]<<8|T[H+3]),pe=__(T.subarray(H+4,H+8)),Le=oe>1?H+oe:T.byteLength,pe===B[0]&&(B.length===1?q.push(T.subarray(H+8,Le)):(Ie=Wm(T.subarray(H+8,Le),B.slice(1)),Ie.length&&(q=q.concat(Ie)))),H=Le;return q},zm=Wm,b_=Fh.toUnsigned,A_=f.getUint64,S_=function(T){var B={version:T[0],flags:new Uint8Array(T.subarray(1,4))};return B.version===1?B.baseMediaDecodeTime=A_(T.subarray(4)):B.baseMediaDecodeTime=b_(T[4]<<24|T[5]<<16|T[6]<<8|T[7]),B},Ym=S_,x_=function(T){return{isLeading:(T[0]&12)>>>2,dependsOn:T[0]&3,isDependedOn:(T[1]&192)>>>6,hasRedundancy:(T[1]&48)>>>4,paddingValue:(T[1]&14)>>>1,isNonSyncSample:T[1]&1,degradationPriority:T[2]<<8|T[3]}},C_=x_,Xm=C_,k_=function(T){var B={version:T[0],flags:new Uint8Array(T.subarray(1,4)),samples:[]},q=new DataView(T.buffer,T.byteOffset,T.byteLength),H=B.flags[2]&1,oe=B.flags[2]&4,pe=B.flags[1]&1,Le=B.flags[1]&2,Ie=B.flags[1]&4,Pe=B.flags[1]&8,Be=q.getUint32(4),Ye=8,at;for(H&&(B.dataOffset=q.getInt32(Ye),Ye+=4),oe&&Be&&(at={flags:Xm(T.subarray(Ye,Ye+4))},Ye+=4,pe&&(at.duration=q.getUint32(Ye),Ye+=4),Le&&(at.size=q.getUint32(Ye),Ye+=4),Pe&&(B.version===1?at.compositionTimeOffset=q.getInt32(Ye):at.compositionTimeOffset=q.getUint32(Ye),Ye+=4),B.samples.push(at),Be--);Be--;)at={},pe&&(at.duration=q.getUint32(Ye),Ye+=4),Le&&(at.size=q.getUint32(Ye),Ye+=4),Ie&&(at.flags=Xm(T.subarray(Ye,Ye+4)),Ye+=4),Pe&&(B.version===1?at.compositionTimeOffset=q.getInt32(Ye):at.compositionTimeOffset=q.getUint32(Ye),Ye+=4),B.samples.push(at);return B},Qm=k_,D_=function(T){var B=new DataView(T.buffer,T.byteOffset,T.byteLength),q={version:T[0],flags:new Uint8Array(T.subarray(1,4)),trackId:B.getUint32(4)},H=q.flags[2]&1,oe=q.flags[2]&2,pe=q.flags[2]&8,Le=q.flags[2]&16,Ie=q.flags[2]&32,Pe=q.flags[0]&65536,Be=q.flags[0]&131072,Ye;return Ye=8,H&&(Ye+=4,q.baseDataOffset=B.getUint32(12),Ye+=4),oe&&(q.sampleDescriptionIndex=B.getUint32(Ye),Ye+=4),pe&&(q.defaultSampleDuration=B.getUint32(Ye),Ye+=4),Le&&(q.defaultSampleSize=B.getUint32(Ye),Ye+=4),Ie&&(q.defaultSampleFlags=B.getUint32(Ye)),Pe&&(q.durationIsEmpty=!0),!H&&Be&&(q.baseDataOffsetIsMoof=!0),q},Jm=D_,Gc;typeof window<"u"?Gc=window:typeof i<"u"?Gc=i:typeof self<"u"?Gc=self:Gc={};var Zm=Gc,w_=Dm.discardEmulationPreventionBytes,L_=wm.CaptionStream,Vc=zm,I_=Ym,R_=Qm,P_=Jm,ev=Zm,O_=function(T,B){for(var q=T,H=0;H<B.length;H++){var oe=B[H];if(q<oe.size)return oe;q-=oe.size}return null},M_=function(T,B,q){var H=new DataView(T.buffer,T.byteOffset,T.byteLength),oe={logs:[],seiNals:[]},pe,Le,Ie,Pe;for(Le=0;Le+4<T.length;Le+=Ie)if(Ie=H.getUint32(Le),Le+=4,!(Ie<=0))switch(T[Le]&31){case 6:var Be=T.subarray(Le+1,Le+1+Ie),Ye=O_(Le,B);if(pe={nalUnitType:"sei_rbsp",size:Ie,data:Be,escapedRBSP:w_(Be),trackId:q},Ye)pe.pts=Ye.pts,pe.dts=Ye.dts,Pe=Ye;else if(Pe)pe.pts=Pe.pts,pe.dts=Pe.dts;else{oe.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+Le+" for trackId "+q+". See mux.js#223."});break}oe.seiNals.push(pe);break}return oe},N_=function(T,B,q){var H=B,oe=q.defaultSampleDuration||0,pe=q.defaultSampleSize||0,Le=q.trackId,Ie=[];return T.forEach(function(Pe){var Be=R_(Pe),Ye=Be.samples;Ye.forEach(function(at){at.duration===void 0&&(at.duration=oe),at.size===void 0&&(at.size=pe),at.trackId=Le,at.dts=H,at.compositionTimeOffset===void 0&&(at.compositionTimeOffset=0),typeof H=="bigint"?(at.pts=H+ev.BigInt(at.compositionTimeOffset),H+=ev.BigInt(at.duration)):(at.pts=H+at.compositionTimeOffset,H+=at.duration)}),Ie=Ie.concat(Ye)}),Ie},F_=function(T,B){var q=Vc(T,["moof","traf"]),H=Vc(T,["mdat"]),oe={},pe=[];return H.forEach(function(Le,Ie){var Pe=q[Ie];pe.push({mdat:Le,traf:Pe})}),pe.forEach(function(Le){var Ie=Le.mdat,Pe=Le.traf,Be=Vc(Pe,["tfhd"]),Ye=P_(Be[0]),at=Ye.trackId,bt=Vc(Pe,["tfdt"]),pt=bt.length>0?I_(bt[0]).baseMediaDecodeTime:0,Ut=Vc(Pe,["trun"]),$t,Ir;B===at&&Ut.length>0&&($t=N_(Ut,pt,Ye),Ir=M_(Ie,$t,at),oe[at]||(oe[at]={seiNals:[],logs:[]}),oe[at].seiNals=oe[at].seiNals.concat(Ir.seiNals),oe[at].logs=oe[at].logs.concat(Ir.logs))}),oe},B_=function(T,B,q){var H;if(B===null)return null;H=F_(T,B);var oe=H[B]||{};return{seiNals:oe.seiNals,logs:oe.logs,timescale:q}},U_=function(){var T=!1,B,q,H,oe,pe,Le;this.isInitialized=function(){return T},this.init=function(Ie){B=new L_,T=!0,Le=Ie?Ie.isPartial:!1,B.on("data",function(Pe){Pe.startTime=Pe.startPts/oe,Pe.endTime=Pe.endPts/oe,pe.captions.push(Pe),pe.captionStreams[Pe.stream]=!0}),B.on("log",function(Pe){pe.logs.push(Pe)})},this.isNewInit=function(Ie,Pe){return Ie&&Ie.length===0||Pe&&typeof Pe=="object"&&Object.keys(Pe).length===0?!1:H!==Ie[0]||oe!==Pe[H]},this.parse=function(Ie,Pe,Be){var Ye;if(this.isInitialized()){if(!Pe||!Be)return null;if(this.isNewInit(Pe,Be))H=Pe[0],oe=Be[H];else if(H===null||!oe)return q.push(Ie),null}else return null;for(;q.length>0;){var at=q.shift();this.parse(at,Pe,Be)}return Ye=B_(Ie,H,oe),Ye&&Ye.logs&&(pe.logs=pe.logs.concat(Ye.logs)),Ye===null||!Ye.seiNals?pe.logs.length?{logs:pe.logs,captions:[],captionStreams:[]}:null:(this.pushNals(Ye.seiNals),this.flushStream(),pe)},this.pushNals=function(Ie){if(!this.isInitialized()||!Ie||Ie.length===0)return null;Ie.forEach(function(Pe){B.push(Pe)})},this.flushStream=function(){if(!this.isInitialized())return null;Le?B.partialFlush():B.flush()},this.clearParsedCaptions=function(){pe.captions=[],pe.captionStreams={},pe.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;B.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){q=[],H=null,oe=null,pe?this.clearParsedCaptions():pe={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},G_=U_,V_=function(T){for(var B=0,q=String.fromCharCode(T[B]),H="";q!=="\0";)H+=q,B++,q=String.fromCharCode(T[B]);return H+=q,H},H_={uint8ToCString:V_},Bh=H_.uint8ToCString,j_=f.getUint64,K_=function(T){var B=4,q=T[0],H,oe,pe,Le,Ie,Pe,Be,Ye;if(q===0){H=Bh(T.subarray(B)),B+=H.length,oe=Bh(T.subarray(B)),B+=oe.length;var at=new DataView(T.buffer);pe=at.getUint32(B),B+=4,Ie=at.getUint32(B),B+=4,Pe=at.getUint32(B),B+=4,Be=at.getUint32(B),B+=4}else if(q===1){var at=new DataView(T.buffer);pe=at.getUint32(B),B+=4,Le=j_(T.subarray(B)),B+=8,Pe=at.getUint32(B),B+=4,Be=at.getUint32(B),B+=4,H=Bh(T.subarray(B)),B+=H.length,oe=Bh(T.subarray(B)),B+=oe.length}Ye=new Uint8Array(T.subarray(B,T.byteLength));var bt={scheme_id_uri:H,value:oe,timescale:pe||1,presentation_time:Le,presentation_time_delta:Ie,event_duration:Pe,id:Be,message_data:Ye};return $_(q,bt)?bt:void 0},q_=function(T,B,q,H){return T||T===0?T/B:H+q/B},$_=function(T,B){var q=B.scheme_id_uri!=="\0",H=T===0&&tv(B.presentation_time_delta)&&q,oe=T===1&&tv(B.presentation_time)&&q;return!(T>1)&&H||oe},tv=function(T){return T!==void 0||T!==null},W_={parseEmsgBox:K_,scaleTime:q_},Uh=Fh.toUnsigned,Hc=Fh.toHexString,hr=zm,bu=$m,kp=W_,z_=Jm,Y_=Qm,X_=Ym,Q_=f.getUint64,iv,rv,nv,sv,av,Dp,ov,wp=Zm,J_=Pm.parseId3Frames;iv=function(T){var B={},q=hr(T,["moov","trak"]);return q.reduce(function(H,oe){var pe,Le,Ie,Pe,Be;return pe=hr(oe,["tkhd"])[0],!pe||(Le=pe[0],Ie=Le===0?12:20,Pe=Uh(pe[Ie]<<24|pe[Ie+1]<<16|pe[Ie+2]<<8|pe[Ie+3]),Be=hr(oe,["mdia","mdhd"])[0],!Be)?null:(Le=Be[0],Ie=Le===0?12:20,H[Pe]=Uh(Be[Ie]<<24|Be[Ie+1]<<16|Be[Ie+2]<<8|Be[Ie+3]),H)},B)},rv=function(T,B){var q;q=hr(B,["moof","traf"]);var H=q.reduce(function(oe,pe){var Le=hr(pe,["tfhd"])[0],Ie=Uh(Le[4]<<24|Le[5]<<16|Le[6]<<8|Le[7]),Pe=T[Ie]||9e4,Be=hr(pe,["tfdt"])[0],Ye=new DataView(Be.buffer,Be.byteOffset,Be.byteLength),at;Be[0]===1?at=Q_(Be.subarray(4,12)):at=Ye.getUint32(4);let bt;return typeof at=="bigint"?bt=at/wp.BigInt(Pe):typeof at=="number"&&!isNaN(at)&&(bt=at/Pe),bt<Number.MAX_SAFE_INTEGER&&(bt=Number(bt)),bt<oe&&(oe=bt),oe},1/0);return typeof H=="bigint"||isFinite(H)?H:0},nv=function(T,B){var q=hr(B,["moof","traf"]),H=0,oe=0,pe;if(q&&q.length){var Le=hr(q[0],["tfhd"])[0],Ie=hr(q[0],["trun"])[0],Pe=hr(q[0],["tfdt"])[0];if(Le){var Be=z_(Le);pe=Be.trackId}if(Pe){var Ye=X_(Pe);H=Ye.baseMediaDecodeTime}if(Ie){var at=Y_(Ie);at.samples&&at.samples.length&&(oe=at.samples[0].compositionTimeOffset||0)}}var bt=T[pe]||9e4;typeof H=="bigint"&&(oe=wp.BigInt(oe),bt=wp.BigInt(bt));var pt=(H+oe)/bt;return typeof pt=="bigint"&&pt<Number.MAX_SAFE_INTEGER&&(pt=Number(pt)),pt},sv=function(T){var B=hr(T,["moov","trak"]),q=[];return B.forEach(function(H){var oe=hr(H,["mdia","hdlr"]),pe=hr(H,["tkhd"]);oe.forEach(function(Le,Ie){var Pe=bu(Le.subarray(8,12)),Be=pe[Ie],Ye,at,bt;Pe==="vide"&&(Ye=new DataView(Be.buffer,Be.byteOffset,Be.byteLength),at=Ye.getUint8(0),bt=at===0?Ye.getUint32(12):Ye.getUint32(20),q.push(bt))})}),q},Dp=function(T){var B=T[0],q=B===0?12:20;return Uh(T[q]<<24|T[q+1]<<16|T[q+2]<<8|T[q+3])},av=function(T){var B=hr(T,["moov","trak"]),q=[];return B.forEach(function(H){var oe={},pe=hr(H,["tkhd"])[0],Le,Ie;pe&&(Le=new DataView(pe.buffer,pe.byteOffset,pe.byteLength),Ie=Le.getUint8(0),oe.id=Ie===0?Le.getUint32(12):Le.getUint32(20));var Pe=hr(H,["mdia","hdlr"])[0];if(Pe){var Be=bu(Pe.subarray(8,12));Be==="vide"?oe.type="video":Be==="soun"?oe.type="audio":oe.type=Be}var Ye=hr(H,["mdia","minf","stbl","stsd"])[0];if(Ye){var at=Ye.subarray(8);oe.codec=bu(at.subarray(4,8));var bt=hr(at,[oe.codec])[0],pt,Ut;bt&&(/^[asm]vc[1-9]$/i.test(oe.codec)?(pt=bt.subarray(78),Ut=bu(pt.subarray(4,8)),Ut==="avcC"&&pt.length>11?(oe.codec+=".",oe.codec+=Hc(pt[9]),oe.codec+=Hc(pt[10]),oe.codec+=Hc(pt[11])):oe.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(oe.codec)?(pt=bt.subarray(28),Ut=bu(pt.subarray(4,8)),Ut==="esds"&&pt.length>20&&pt[19]!==0?(oe.codec+="."+Hc(pt[19]),oe.codec+="."+Hc(pt[20]>>>2&63).replace(/^0/,"")):oe.codec="mp4a.40.2"):oe.codec=oe.codec.toLowerCase())}var $t=hr(H,["mdia","mdhd"])[0];$t&&(oe.timescale=Dp($t)),q.push(oe)}),q},ov=function(T,B=0){var q=hr(T,["emsg"]);return q.map(H=>{var oe=kp.parseEmsgBox(new Uint8Array(H)),pe=J_(oe.message_data);return{cueTime:kp.scaleTime(oe.presentation_time,oe.timescale,oe.presentation_time_delta,B),duration:kp.scaleTime(oe.event_duration,oe.timescale),frames:pe}})};var Lp={findBox:hr,parseType:bu,timescale:iv,startTime:rv,compositionStartTime:nv,videoTrackIds:sv,tracks:av,getTimescaleFromMediaHeader:Dp,getEmsgID3:ov},Ip=Sh,lv=function(T){var B=T[1]&31;return B<<=8,B|=T[2],B},Gh=function(T){return!!(T[1]&64)},Vh=function(T){var B=0;return(T[3]&48)>>>4>1&&(B+=T[4]+1),B},Z_=function(T,B){var q=lv(T);return q===0?"pat":q===B?"pmt":B?"pes":null},eb=function(T){var B=Gh(T),q=4+Vh(T);return B&&(q+=T[q]+1),(T[q+10]&31)<<8|T[q+11]},tb=function(T){var B={},q=Gh(T),H=4+Vh(T);if(q&&(H+=T[H]+1),!!(T[H+5]&1)){var oe,pe,Le;oe=(T[H+1]&15)<<8|T[H+2],pe=3+oe-4,Le=(T[H+10]&15)<<8|T[H+11];for(var Ie=12+Le;Ie<pe;){var Pe=H+Ie;B[(T[Pe+1]&31)<<8|T[Pe+2]]=T[Pe],Ie+=((T[Pe+3]&15)<<8|T[Pe+4])+5}return B}},ib=function(T,B){var q=lv(T),H=B[q];switch(H){case Ip.H264_STREAM_TYPE:return"video";case Ip.ADTS_STREAM_TYPE:return"audio";case Ip.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},rb=function(T){var B=Gh(T);if(!B)return null;var q=4+Vh(T);if(q>=T.byteLength)return null;var H=null,oe;return oe=T[q+7],oe&192&&(H={},H.pts=(T[q+9]&14)<<27|(T[q+10]&255)<<20|(T[q+11]&254)<<12|(T[q+12]&255)<<5|(T[q+13]&254)>>>3,H.pts*=4,H.pts+=(T[q+13]&6)>>>1,H.dts=H.pts,oe&64&&(H.dts=(T[q+14]&14)<<27|(T[q+15]&255)<<20|(T[q+16]&254)<<12|(T[q+17]&255)<<5|(T[q+18]&254)>>>3,H.dts*=4,H.dts+=(T[q+18]&6)>>>1)),H},Rp=function(T){switch(T){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},nb=function(T){for(var B=4+Vh(T),q=T.subarray(B),H=0,oe=0,pe=!1,Le;oe<q.byteLength-3;oe++)if(q[oe+2]===1){H=oe+5;break}for(;H<q.byteLength;)switch(q[H]){case 0:if(q[H-1]!==0){H+=2;break}else if(q[H-2]!==0){H++;break}oe+3!==H-2&&(Le=Rp(q[oe+3]&31),Le==="slice_layer_without_partitioning_rbsp_idr"&&(pe=!0));do H++;while(q[H]!==1&&H<q.length);oe=H-2,H+=3;break;case 1:if(q[H-1]!==0||q[H-2]!==0){H+=3;break}Le=Rp(q[oe+3]&31),Le==="slice_layer_without_partitioning_rbsp_idr"&&(pe=!0),oe=H-2,H+=3;break;default:H+=3;break}return q=q.subarray(oe),H-=oe,oe=0,q&&q.byteLength>3&&(Le=Rp(q[oe+3]&31),Le==="slice_layer_without_partitioning_rbsp_idr"&&(pe=!0)),pe},sb={parseType:Z_,parsePat:eb,parsePmt:tb,parsePayloadUnitStartIndicator:Gh,parsePesType:ib,parsePesTime:rb,videoPacketContainsKeyFrame:nb},uv=Sh,Au=Im.handleRollover,Ci={};Ci.ts=sb,Ci.aac=Ap;var gl=qi.ONE_SECOND_IN_TS,Cn=188,Ta=71,ab=function(T,B){for(var q=0,H=Cn,oe,pe;H<T.byteLength;){if(T[q]===Ta&&T[H]===Ta){switch(oe=T.subarray(q,H),pe=Ci.ts.parseType(oe,B.pid),pe){case"pat":B.pid=Ci.ts.parsePat(oe);break;case"pmt":var Le=Ci.ts.parsePmt(oe);B.table=B.table||{},Object.keys(Le).forEach(function(Ie){B.table[Ie]=Le[Ie]});break}q+=Cn,H+=Cn;continue}q++,H++}},cv=function(T,B,q){for(var H=0,oe=Cn,pe,Le,Ie,Pe,Be,Ye=!1;oe<=T.byteLength;){if(T[H]===Ta&&(T[oe]===Ta||oe===T.byteLength)){switch(pe=T.subarray(H,oe),Le=Ci.ts.parseType(pe,B.pid),Le){case"pes":Ie=Ci.ts.parsePesType(pe,B.table),Pe=Ci.ts.parsePayloadUnitStartIndicator(pe),Ie==="audio"&&Pe&&(Be=Ci.ts.parsePesTime(pe),Be&&(Be.type="audio",q.audio.push(Be),Ye=!0));break}if(Ye)break;H+=Cn,oe+=Cn;continue}H++,oe++}for(oe=T.byteLength,H=oe-Cn,Ye=!1;H>=0;){if(T[H]===Ta&&(T[oe]===Ta||oe===T.byteLength)){switch(pe=T.subarray(H,oe),Le=Ci.ts.parseType(pe,B.pid),Le){case"pes":Ie=Ci.ts.parsePesType(pe,B.table),Pe=Ci.ts.parsePayloadUnitStartIndicator(pe),Ie==="audio"&&Pe&&(Be=Ci.ts.parsePesTime(pe),Be&&(Be.type="audio",q.audio.push(Be),Ye=!0));break}if(Ye)break;H-=Cn,oe-=Cn;continue}H--,oe--}},ob=function(T,B,q){for(var H=0,oe=Cn,pe,Le,Ie,Pe,Be,Ye,at,bt,pt=!1,Ut={data:[],size:0};oe<T.byteLength;){if(T[H]===Ta&&T[oe]===Ta){switch(pe=T.subarray(H,oe),Le=Ci.ts.parseType(pe,B.pid),Le){case"pes":if(Ie=Ci.ts.parsePesType(pe,B.table),Pe=Ci.ts.parsePayloadUnitStartIndicator(pe),Ie==="video"&&(Pe&&!pt&&(Be=Ci.ts.parsePesTime(pe),Be&&(Be.type="video",q.video.push(Be),pt=!0)),!q.firstKeyFrame)){if(Pe&&Ut.size!==0){for(Ye=new Uint8Array(Ut.size),at=0;Ut.data.length;)bt=Ut.data.shift(),Ye.set(bt,at),at+=bt.byteLength;if(Ci.ts.videoPacketContainsKeyFrame(Ye)){var $t=Ci.ts.parsePesTime(Ye);$t?(q.firstKeyFrame=$t,q.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}Ut.size=0}Ut.data.push(pe),Ut.size+=pe.byteLength}break}if(pt&&q.firstKeyFrame)break;H+=Cn,oe+=Cn;continue}H++,oe++}for(oe=T.byteLength,H=oe-Cn,pt=!1;H>=0;){if(T[H]===Ta&&T[oe]===Ta){switch(pe=T.subarray(H,oe),Le=Ci.ts.parseType(pe,B.pid),Le){case"pes":Ie=Ci.ts.parsePesType(pe,B.table),Pe=Ci.ts.parsePayloadUnitStartIndicator(pe),Ie==="video"&&Pe&&(Be=Ci.ts.parsePesTime(pe),Be&&(Be.type="video",q.video.push(Be),pt=!0));break}if(pt)break;H-=Cn,oe-=Cn;continue}H--,oe--}},lb=function(T,B){if(T.audio&&T.audio.length){var q=B;(typeof q>"u"||isNaN(q))&&(q=T.audio[0].dts),T.audio.forEach(function(pe){pe.dts=Au(pe.dts,q),pe.pts=Au(pe.pts,q),pe.dtsTime=pe.dts/gl,pe.ptsTime=pe.pts/gl})}if(T.video&&T.video.length){var H=B;if((typeof H>"u"||isNaN(H))&&(H=T.video[0].dts),T.video.forEach(function(pe){pe.dts=Au(pe.dts,H),pe.pts=Au(pe.pts,H),pe.dtsTime=pe.dts/gl,pe.ptsTime=pe.pts/gl}),T.firstKeyFrame){var oe=T.firstKeyFrame;oe.dts=Au(oe.dts,H),oe.pts=Au(oe.pts,H),oe.dtsTime=oe.dts/gl,oe.ptsTime=oe.pts/gl}}},ub=function(T){for(var B=!1,q=0,H=null,oe=null,pe=0,Le=0,Ie;T.length-Le>=3;){var Pe=Ci.aac.parseType(T,Le);switch(Pe){case"timed-metadata":if(T.length-Le<10){B=!0;break}if(pe=Ci.aac.parseId3TagSize(T,Le),pe>T.length){B=!0;break}oe===null&&(Ie=T.subarray(Le,Le+pe),oe=Ci.aac.parseAacTimestamp(Ie)),Le+=pe;break;case"audio":if(T.length-Le<7){B=!0;break}if(pe=Ci.aac.parseAdtsSize(T,Le),pe>T.length){B=!0;break}H===null&&(Ie=T.subarray(Le,Le+pe),H=Ci.aac.parseSampleRate(Ie)),q++,Le+=pe;break;default:Le++;break}if(B)return null}if(H===null||oe===null)return null;var Be=gl/H,Ye={audio:[{type:"audio",dts:oe,pts:oe},{type:"audio",dts:oe+q*1024*Be,pts:oe+q*1024*Be}]};return Ye},cb=function(T){var B={pid:null,table:null},q={};ab(T,B);for(var H in B.table)if(B.table.hasOwnProperty(H)){var oe=B.table[H];switch(oe){case uv.H264_STREAM_TYPE:q.video=[],ob(T,B,q),q.video.length===0&&delete q.video;break;case uv.ADTS_STREAM_TYPE:q.audio=[],cv(T,B,q),q.audio.length===0&&delete q.audio;break}}return q},db=function(T,B){var q=Ci.aac.isLikelyAacData(T),H;return q?H=ub(T):H=cb(T),!H||!H.audio&&!H.video?null:(lb(H,B),H)},hb={inspect:db,parseAudioPes_:cv};const fb=function(T,B){B.on("data",function(q){const H=q.initSegment;q.initSegment={data:H.buffer,byteOffset:H.byteOffset,byteLength:H.byteLength};const oe=q.data;q.data=oe.buffer,T.postMessage({action:"data",segment:q,byteOffset:oe.byteOffset,byteLength:oe.byteLength},[q.data])}),B.on("done",function(q){T.postMessage({action:"done"})}),B.on("gopInfo",function(q){T.postMessage({action:"gopInfo",gopInfo:q})}),B.on("videoSegmentTimingInfo",function(q){const H={start:{decode:qi.videoTsToSeconds(q.start.dts),presentation:qi.videoTsToSeconds(q.start.pts)},end:{decode:qi.videoTsToSeconds(q.end.dts),presentation:qi.videoTsToSeconds(q.end.pts)},baseMediaDecodeTime:qi.videoTsToSeconds(q.baseMediaDecodeTime)};q.prependedContentDuration&&(H.prependedContentDuration=qi.videoTsToSeconds(q.prependedContentDuration)),T.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:H})}),B.on("audioSegmentTimingInfo",function(q){const H={start:{decode:qi.videoTsToSeconds(q.start.dts),presentation:qi.videoTsToSeconds(q.start.pts)},end:{decode:qi.videoTsToSeconds(q.end.dts),presentation:qi.videoTsToSeconds(q.end.pts)},baseMediaDecodeTime:qi.videoTsToSeconds(q.baseMediaDecodeTime)};q.prependedContentDuration&&(H.prependedContentDuration=qi.videoTsToSeconds(q.prependedContentDuration)),T.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:H})}),B.on("id3Frame",function(q){T.postMessage({action:"id3Frame",id3Frame:q})}),B.on("caption",function(q){T.postMessage({action:"caption",caption:q})}),B.on("trackinfo",function(q){T.postMessage({action:"trackinfo",trackInfo:q})}),B.on("audioTimingInfo",function(q){T.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:qi.videoTsToSeconds(q.start),end:qi.videoTsToSeconds(q.end)}})}),B.on("videoTimingInfo",function(q){T.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:qi.videoTsToSeconds(q.start),end:qi.videoTsToSeconds(q.end)}})}),B.on("log",function(q){T.postMessage({action:"log",log:q})})};class dv{constructor(B,q){this.options=q||{},this.self=B,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new m_.Transmuxer(this.options),fb(this.self,this.transmuxer)}pushMp4Captions(B){this.captionParser||(this.captionParser=new G_,this.captionParser.init());const q=new Uint8Array(B.data,B.byteOffset,B.byteLength),H=this.captionParser.parse(q,B.trackIds,B.timescales);this.self.postMessage({action:"mp4Captions",captions:H&&H.captions||[],logs:H&&H.logs||[],data:q.buffer},[q.buffer])}probeMp4StartTime({timescales:B,data:q}){const H=Lp.startTime(B,q);this.self.postMessage({action:"probeMp4StartTime",startTime:H,data:q},[q.buffer])}probeMp4Tracks({data:B}){const q=Lp.tracks(B);this.self.postMessage({action:"probeMp4Tracks",tracks:q,data:B},[B.buffer])}probeEmsgID3({data:B,offset:q}){const H=Lp.getEmsgID3(B,q);this.self.postMessage({action:"probeEmsgID3",id3Frames:H,emsgData:B},[B.buffer])}probeTs({data:B,baseStartTime:q}){const H=typeof q=="number"&&!isNaN(q)?q*qi.ONE_SECOND_IN_TS:void 0,oe=hb.inspect(B,H);let pe=null;oe&&(pe={hasVideo:oe.video&&oe.video.length===2||!1,hasAudio:oe.audio&&oe.audio.length===2||!1},pe.hasVideo&&(pe.videoStart=oe.video[0].ptsTime),pe.hasAudio&&(pe.audioStart=oe.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:pe,data:B},[B.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(B){const q=new Uint8Array(B.data,B.byteOffset,B.byteLength);this.transmuxer.push(q)}reset(){this.transmuxer.reset()}setTimestampOffset(B){const q=B.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(qi.secondsToVideoTs(q)))}setAudioAppendStart(B){this.transmuxer.setAudioAppendStart(Math.ceil(qi.secondsToVideoTs(B.appendStart)))}setRemux(B){this.transmuxer.setRemux(B.remux)}flush(B){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(B){this.transmuxer.alignGopsWith(B.gopsToAlignWith.slice())}}self.onmessage=function(T){if(T.data.action==="init"&&T.data.options){this.messageHandlers=new dv(self,T.data.options);return}this.messageHandlers||(this.messageHandlers=new dv(self)),T.data&&T.data.action&&T.data.action!=="init"&&this.messageHandlers[T.data.action]&&this.messageHandlers[T.data.action](T.data)}}));var my=Dg(gy);const vy=(i,e,t)=>{const{type:r,initSegment:o,captions:f,captionStreams:p,metadata:E,videoFrameDtsTime:N,videoFramePtsTime:$}=i.data.segment;e.buffer.push({captions:f,captionStreams:p,metadata:E});const he=i.data.segment.boxes||{data:i.data.segment.data},Te={type:r,data:new Uint8Array(he.data,he.data.byteOffset,he.data.byteLength),initSegment:new Uint8Array(o.data,o.byteOffset,o.byteLength)};typeof N<"u"&&(Te.videoFrameDtsTime=N),typeof $<"u"&&(Te.videoFramePtsTime=$),t(Te)},yy=({transmuxedData:i,callback:e})=>{i.buffer=[],e(i)},Ty=(i,e)=>{e.gopInfo=i.data.gopInfo},Ig=i=>{const{transmuxer:e,bytes:t,audioAppendStart:r,gopsToAlignWith:o,remux:f,onData:p,onTrackInfo:E,onAudioTimingInfo:N,onVideoTimingInfo:$,onVideoSegmentTimingInfo:he,onAudioSegmentTimingInfo:Te,onId3:we,onCaptions:Me,onDone:Ge,onEndedTimeline:ke,onTransmuxerLog:qe,isEndOfTimeline:$e,segment:tt,triggerSegmentEventFn:Je}=i,st={buffer:[]};let We=$e;const dt=kt=>{e.currentTransmux===i&&(kt.data.action==="data"&&vy(kt,st,p),kt.data.action==="trackinfo"&&E(kt.data.trackInfo),kt.data.action==="gopInfo"&&Ty(kt,st),kt.data.action==="audioTimingInfo"&&N(kt.data.audioTimingInfo),kt.data.action==="videoTimingInfo"&&$(kt.data.videoTimingInfo),kt.data.action==="videoSegmentTimingInfo"&&he(kt.data.videoSegmentTimingInfo),kt.data.action==="audioSegmentTimingInfo"&&Te(kt.data.audioSegmentTimingInfo),kt.data.action==="id3Frame"&&we([kt.data.id3Frame],kt.data.id3Frame.dispatchType),kt.data.action==="caption"&&Me(kt.data.caption),kt.data.action==="endedtimeline"&&(We=!1,ke()),kt.data.action==="log"&&qe(kt.data.log),kt.data.type==="transmuxed"&&(We||(e.onmessage=null,yy({transmuxedData:st,callback:Ge}),Rg(e))))},Dt=()=>{const kt={message:"Received an error message from the transmuxer worker",metadata:{errorType:it.Error.StreamingFailedToTransmuxSegment,segmentInfo:ll({segment:tt})}};Ge(null,kt)};if(e.onmessage=dt,e.onerror=Dt,r&&e.postMessage({action:"setAudioAppendStart",appendStart:r}),Array.isArray(o)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:o}),typeof f<"u"&&e.postMessage({action:"setRemux",remux:f}),t.byteLength){const kt=t instanceof ArrayBuffer?t:t.buffer,Xt=t instanceof ArrayBuffer?0:t.byteOffset;Je({type:"segmenttransmuxingstart",segment:tt}),e.postMessage({action:"push",data:kt,byteOffset:Xt,byteLength:t.byteLength},[kt])}$e&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},Rg=i=>{i.currentTransmux=null,i.transmuxQueue.length&&(i.currentTransmux=i.transmuxQueue.shift(),typeof i.currentTransmux=="function"?i.currentTransmux():Ig(i.currentTransmux))},Pg=(i,e)=>{i.postMessage({action:e}),Rg(i)},Og=(i,e)=>{if(!e.currentTransmux){e.currentTransmux=i,Pg(e,i);return}e.transmuxQueue.push(Pg.bind(null,e,i))},Ey=i=>{Og("reset",i)},_y=i=>{Og("endTimeline",i)},Mg=i=>{if(!i.transmuxer.currentTransmux){i.transmuxer.currentTransmux=i,Ig(i);return}i.transmuxer.transmuxQueue.push(i)};var tp={reset:Ey,endTimeline:_y,transmux:Mg,createTransmuxer:i=>{const e=new my;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:i}),e}};const kc=function(i){const e=i.transmuxer,t=i.endAction||i.action,r=i.callback,o=Hi({},i,{endAction:null,transmuxer:null,callback:null}),f=p=>{p.data.action===t&&(e.removeEventListener("message",f),p.data.data&&(p.data.data=new Uint8Array(p.data.data,i.byteOffset||0,i.byteLength||p.data.data.byteLength),i.data&&(i.data=p.data.data)),r(p.data))};if(e.addEventListener("message",f),i.data){const p=i.data instanceof ArrayBuffer;o.byteOffset=p?0:i.data.byteOffset,o.byteLength=i.data.byteLength;const E=[p?i.data:i.data.buffer];e.postMessage(o,E)}else e.postMessage(o)},va={FAILURE:2,TIMEOUT:-101,ABORTED:-102},ip=i=>{i.forEach(e=>{e.abort()})},by=i=>({bandwidth:i.bandwidth,bytesReceived:i.bytesReceived||0,roundTripTime:i.roundTripTime||0}),Ay=i=>{const e=i.target,r={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return r.bytesReceived=i.loaded,r.bandwidth=Math.floor(r.bytesReceived/r.roundTripTime*8*1e3),r},rp=(i,e)=>{const{requestType:t}=e,r=ol({requestType:t,request:e,error:i});return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:va.TIMEOUT,xhr:e,metadata:r}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:va.ABORTED,xhr:e,metadata:r}:i?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:va.FAILURE,xhr:e,metadata:r}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:va.FAILURE,xhr:e,metadata:r}:null},Ng=(i,e,t,r)=>(o,f)=>{const p=f.response,E=rp(o,f);if(E)return t(E,i);if(p.byteLength!==16)return t({status:f.status,message:"Invalid HLS key at URL: "+f.uri,code:va.FAILURE,xhr:f},i);const N=new DataView(p),$=new Uint32Array([N.getUint32(0),N.getUint32(4),N.getUint32(8),N.getUint32(12)]);for(let Te=0;Te<e.length;Te++)e[Te].bytes=$;const he={uri:f.uri};return r({type:"segmentkeyloadcomplete",segment:i,keyInfo:he}),t(null,i)},Fg=(i,e)=>{const t=Ff(i.map.bytes);if(t!=="mp4"){const r=i.map.resolvedUri||i.map.uri,o=t||"unknown";return e({internal:!0,message:`Found unsupported ${o} container for initialization segment at URL: ${r}`,code:va.FAILURE,metadata:{mediaType:o}})}kc({action:"probeMp4Tracks",data:i.map.bytes,transmuxer:i.transmuxer,callback:({tracks:r,data:o})=>(i.map.bytes=o,r.forEach(function(f){i.map.tracks=i.map.tracks||{},!i.map.tracks[f.type]&&(i.map.tracks[f.type]=f,typeof f.id=="number"&&f.timescale&&(i.map.timescales=i.map.timescales||{},i.map.timescales[f.id]=f.timescale))}),e(null))})},Sy=({segment:i,finishProcessingFn:e,triggerSegmentEventFn:t})=>(r,o)=>{const f=rp(r,o);if(f)return e(f,i);const p=new Uint8Array(o.response);if(t({type:"segmentloaded",segment:i}),i.map.key)return i.map.encryptedBytes=p,e(null,i);i.map.bytes=p,Fg(i,function(E){if(E)return E.xhr=o,E.status=o.status,e(E,i);e(null,i)})},xy=({segment:i,finishProcessingFn:e,responseType:t,triggerSegmentEventFn:r})=>(o,f)=>{const p=rp(o,f);if(p)return e(p,i);r({type:"segmentloaded",segment:i});const E=t==="arraybuffer"||!f.responseText?f.response:fy(f.responseText.substring(i.lastReachedChar||0));return i.stats=by(f),i.key?i.encryptedBytes=new Uint8Array(E):i.bytes=new Uint8Array(E),e(null,i)},Cy=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me})=>{const Ge=i.map&&i.map.tracks||{},ke=!!(Ge.audio&&Ge.video);let qe=r.bind(null,i,"audio","start");const $e=r.bind(null,i,"audio","end");let tt=r.bind(null,i,"video","start");const Je=r.bind(null,i,"video","end"),st=()=>Mg({bytes:e,transmuxer:i.transmuxer,audioAppendStart:i.audioAppendStart,gopsToAlignWith:i.gopsToAlignWith,remux:ke,onData:We=>{We.type=We.type==="combined"?"video":We.type,he(i,We)},onTrackInfo:We=>{t&&(ke&&(We.isMuxed=!0),t(i,We))},onAudioTimingInfo:We=>{qe&&typeof We.start<"u"&&(qe(We.start),qe=null),$e&&typeof We.end<"u"&&$e(We.end)},onVideoTimingInfo:We=>{tt&&typeof We.start<"u"&&(tt(We.start),tt=null),Je&&typeof We.end<"u"&&Je(We.end)},onVideoSegmentTimingInfo:We=>{const dt={pts:{start:We.start.presentation,end:We.end.presentation},dts:{start:We.start.decode,end:We.end.decode}};Me({type:"segmenttransmuxingtiminginfoavailable",segment:i,timingInfo:dt}),o(We)},onAudioSegmentTimingInfo:We=>{const dt={pts:{start:We.start.pts,end:We.end.pts},dts:{start:We.start.dts,end:We.end.dts}};Me({type:"segmenttransmuxingtiminginfoavailable",segment:i,timingInfo:dt}),f(We)},onId3:(We,dt)=>{p(i,We,dt)},onCaptions:We=>{E(i,[We])},isEndOfTimeline:N,onEndedTimeline:()=>{$()},onTransmuxerLog:we,onDone:(We,dt)=>{Te&&(We.type=We.type==="combined"?"video":We.type,Me({type:"segmenttransmuxingcomplete",segment:i}),Te(dt,i,We))},segment:i,triggerSegmentEventFn:Me});kc({action:"probeTs",transmuxer:i.transmuxer,data:e,baseStartTime:i.baseStartTime,callback:We=>{i.bytes=e=We.data;const dt=We.result;dt&&(t(i,{hasAudio:dt.hasAudio,hasVideo:dt.hasVideo,isMuxed:ke}),t=null),st()}})},Bg=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me})=>{let Ge=new Uint8Array(e);if(A0(Ge)){i.isFmp4=!0;const{tracks:ke}=i.map,qe={isFmp4:!0,hasVideo:!!ke.video,hasAudio:!!ke.audio};ke.audio&&ke.audio.codec&&ke.audio.codec!=="enca"&&(qe.audioCodec=ke.audio.codec),ke.video&&ke.video.codec&&ke.video.codec!=="encv"&&(qe.videoCodec=ke.video.codec),ke.video&&ke.audio&&(qe.isMuxed=!0),t(i,qe);const $e=(tt,Je)=>{he(i,{data:Ge,type:qe.hasAudio&&!qe.isMuxed?"audio":"video"}),Je&&Je.length&&p(i,Je),tt&&tt.length&&E(i,tt),Te(null,i,{})};kc({action:"probeMp4StartTime",timescales:i.map.timescales,data:Ge,transmuxer:i.transmuxer,callback:({data:tt,startTime:Je})=>{e=tt.buffer,i.bytes=Ge=tt,qe.hasAudio&&!qe.isMuxed&&r(i,"audio","start",Je),qe.hasVideo&&r(i,"video","start",Je),kc({action:"probeEmsgID3",data:Ge,transmuxer:i.transmuxer,offset:Je,callback:({emsgData:st,id3Frames:We})=>{if(e=st.buffer,i.bytes=Ge=st,!ke.video||!st.byteLength||!i.transmuxer){$e(void 0,We);return}kc({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:i.transmuxer,data:Ge,timescales:i.map.timescales,trackIds:[ke.video.id],callback:dt=>{e=dt.data.buffer,i.bytes=Ge=dt.data,dt.logs.forEach(function(Dt){we(yi(Dt,{stream:"mp4CaptionParser"}))}),$e(dt.captions,We)}})}})}});return}if(!i.transmuxer){Te(null,i,{});return}if(typeof i.container>"u"&&(i.container=Ff(Ge)),i.container!=="ts"&&i.container!=="aac"){t(i,{hasAudio:!1,hasVideo:!1}),Te(null,i,{});return}Cy({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me})},Ug=function({id:i,key:e,encryptedBytes:t,decryptionWorker:r,segment:o,doneFn:f},p){const E=$=>{if($.data.source===i){r.removeEventListener("message",E);const he=$.data.decrypted;p(new Uint8Array(he.bytes,he.byteOffset,he.byteLength))}};r.onerror=()=>{const $="An error occurred in the decryption worker",he=ll({segment:o}),Te={message:$,metadata:{error:new Error($),errorType:it.Error.StreamingFailedToDecryptSegment,segmentInfo:he,keyInfo:{uri:o.key.resolvedUri||o.map.key.resolvedUri}}};f(Te,o)},r.addEventListener("message",E);let N;e.bytes.slice?N=e.bytes.slice():N=new Uint32Array(Array.prototype.slice.call(e.bytes)),r.postMessage(Eg({source:i,encrypted:t,key:N,iv:e.iv}),[t.buffer,N.buffer])},ky=({decryptionWorker:i,segment:e,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me})=>{Me({type:"segmentdecryptionstart"}),Ug({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:i,segment:e,doneFn:Te},Ge=>{e.bytes=Ge,Me({type:"segmentdecryptioncomplete",segment:e}),Bg({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me})})},Dy=({activeXhrs:i,decryptionWorker:e,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me})=>{let Ge=0,ke=!1;return(qe,$e)=>{if(!ke){if(qe)return ke=!0,ip(i),Te(qe,$e);if(Ge+=1,Ge===i.length){const tt=function(){if($e.encryptedBytes)return ky({decryptionWorker:e,segment:$e,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me});Bg({segment:$e,bytes:$e.bytes,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he,doneFn:Te,onTransmuxerLog:we,triggerSegmentEventFn:Me})};if($e.endOfAllRequests=Date.now(),$e.map&&$e.map.encryptedBytes&&!$e.map.bytes)return Me({type:"segmentdecryptionstart",segment:$e}),Ug({decryptionWorker:e,id:$e.requestId+"-init",encryptedBytes:$e.map.encryptedBytes,key:$e.map.key,segment:$e,doneFn:Te},Je=>{$e.map.bytes=Je,Me({type:"segmentdecryptioncomplete",segment:$e}),Fg($e,st=>{if(st)return ip(i),Te(st,$e);tt()})});tt()}}}},wy=({loadendState:i,abortFn:e})=>t=>{t.target.aborted&&e&&!i.calledAbortFn&&(e(),i.calledAbortFn=!0)},Ly=({segment:i,progressFn:e,trackInfoFn:t,timingInfoFn:r,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:f,id3Fn:p,captionsFn:E,isEndOfTimeline:N,endedTimelineFn:$,dataFn:he})=>Te=>{if(!Te.target.aborted)return i.stats=yi(i.stats,Ay(Te)),!i.stats.firstBytesReceivedAt&&i.stats.bytesReceived&&(i.stats.firstBytesReceivedAt=Date.now()),e(Te,i)},Iy=({xhr:i,xhrOptions:e,decryptionWorker:t,segment:r,abortFn:o,progressFn:f,trackInfoFn:p,timingInfoFn:E,videoSegmentTimingInfoFn:N,audioSegmentTimingInfoFn:$,id3Fn:he,captionsFn:Te,isEndOfTimeline:we,endedTimelineFn:Me,dataFn:Ge,doneFn:ke,onTransmuxerLog:qe,triggerSegmentEventFn:$e})=>{const tt=[],Je=Dy({activeXhrs:tt,decryptionWorker:t,trackInfoFn:p,timingInfoFn:E,videoSegmentTimingInfoFn:N,audioSegmentTimingInfoFn:$,id3Fn:he,captionsFn:Te,isEndOfTimeline:we,endedTimelineFn:Me,dataFn:Ge,doneFn:ke,onTransmuxerLog:qe,triggerSegmentEventFn:$e});if(r.key&&!r.key.bytes){const kt=[r.key];r.map&&!r.map.bytes&&r.map.key&&r.map.key.resolvedUri===r.key.resolvedUri&&kt.push(r.map.key);const Xt=yi(e,{uri:r.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),Ui=Ng(r,kt,Je,$e),si={uri:r.key.resolvedUri};$e({type:"segmentkeyloadstart",segment:r,keyInfo:si});const Mi=i(Xt,Ui);tt.push(Mi)}if(r.map&&!r.map.bytes){if(r.map.key&&(!r.key||r.key.resolvedUri!==r.map.key.resolvedUri)){const Mi=yi(e,{uri:r.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),Ot=Ng(r,[r.map.key],Je,$e),ui={uri:r.map.key.resolvedUri};$e({type:"segmentkeyloadstart",segment:r,keyInfo:ui});const xn=i(Mi,Ot);tt.push(xn)}const Xt=yi(e,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:Jf(r.map),requestType:"segment-media-initialization"}),Ui=Sy({segment:r,finishProcessingFn:Je,triggerSegmentEventFn:$e});$e({type:"segmentloadstart",segment:r});const si=i(Xt,Ui);tt.push(si)}const st=yi(e,{uri:r.part&&r.part.resolvedUri||r.resolvedUri,responseType:"arraybuffer",headers:Jf(r),requestType:"segment"}),We=xy({segment:r,finishProcessingFn:Je,responseType:st.responseType,triggerSegmentEventFn:$e});$e({type:"segmentloadstart",segment:r});const dt=i(st,We);dt.addEventListener("progress",Ly({segment:r,progressFn:f,trackInfoFn:p,timingInfoFn:E,videoSegmentTimingInfoFn:N,audioSegmentTimingInfoFn:$,id3Fn:he,captionsFn:Te,isEndOfTimeline:we,endedTimelineFn:Me,dataFn:Ge})),tt.push(dt);const Dt={};return tt.forEach(kt=>{kt.addEventListener("loadend",wy({loadendState:Dt,abortFn:o}))}),()=>ip(tt)},Ry=ds("CodecUtils"),Py=function(i){const e=i.attributes||{};if(e.CODECS)return Yn(e.CODECS)},Gg=(i,e)=>{const t=e.attributes||{};return i&&i.mediaGroups&&i.mediaGroups.AUDIO&&t.AUDIO&&i.mediaGroups.AUDIO[t.AUDIO]},Oy=(i,e)=>{if(!Gg(i,e))return!0;const t=e.attributes||{},r=i.mediaGroups.AUDIO[t.AUDIO];for(const o in r)if(!r[o].uri&&!r[o].playlists)return!0;return!1},ch=function(i){const e={};return i.forEach(({mediaType:t,type:r,details:o})=>{e[t]=e[t]||[],e[t].push(rc(`${r}${o}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){Ry(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},Vg=function(i){let e=0;return i.audio&&e++,i.video&&e++,e},Dc=function(i,e){const t=e.attributes||{},r=ch(Py(e)||[]);if(Gg(i,e)&&!r.audio&&!Oy(i,e)){const o=ch(of(i,t.AUDIO)||[]);o.audio&&(r.audio=o.audio)}return r},dh=ds("PlaylistSelector"),Hg=function(i){if(!i||!i.playlist)return;const e=i.playlist;return JSON.stringify({id:e.id,bandwidth:i.bandwidth,width:i.width,height:i.height,codecs:e.attributes&&e.attributes.CODECS||""})},hh=function(i,e){if(!i)return"";const t=window.getComputedStyle(i);return t?t[e]:""},vu=function(i,e){const t=i.slice();i.sort(function(r,o){const f=e(r,o);return f===0?t.indexOf(r)-t.indexOf(o):f})},np=function(i,e){let t,r;return i.attributes.BANDWIDTH&&(t=i.attributes.BANDWIDTH),t=t||window.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(r=e.attributes.BANDWIDTH),r=r||window.Number.MAX_VALUE,t-r},My=function(i,e){let t,r;return i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width&&(t=i.attributes.RESOLUTION.width),t=t||window.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(r=e.attributes.RESOLUTION.width),r=r||window.Number.MAX_VALUE,t===r&&i.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?i.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-r};let jg=function(i,e,t,r,o,f){if(!i)return;const p={bandwidth:e,width:t,height:r,limitRenditionByPlayerDimensions:o};let E=i.playlists;Fn.isAudioOnly(i)&&(E=f.getAudioTrackPlaylists_(),p.audioOnly=!0);let N=E.map(We=>{let dt;const Dt=We.attributes&&We.attributes.RESOLUTION&&We.attributes.RESOLUTION.width,kt=We.attributes&&We.attributes.RESOLUTION&&We.attributes.RESOLUTION.height;return dt=We.attributes&&We.attributes.BANDWIDTH,dt=dt||window.Number.MAX_VALUE,{bandwidth:dt,width:Dt,height:kt,playlist:We}});vu(N,(We,dt)=>We.bandwidth-dt.bandwidth),N=N.filter(We=>!Fn.isIncompatible(We.playlist));let $=N.filter(We=>Fn.isEnabled(We.playlist));$.length||($=N.filter(We=>!Fn.isDisabled(We.playlist)));const he=$.filter(We=>We.bandwidth*Vr.BANDWIDTH_VARIANCE<e);let Te=he[he.length-1];const we=he.filter(We=>We.bandwidth===Te.bandwidth)[0];if(o===!1){const We=we||$[0]||N[0];if(We&&We.playlist){let dt="sortedPlaylistReps";return we&&(dt="bandwidthBestRep"),$[0]&&(dt="enabledPlaylistReps"),dh(`choosing ${Hg(We)} using ${dt} with options`,p),We.playlist}return dh("could not choose a playlist with options",p),null}const Me=he.filter(We=>We.width&&We.height);vu(Me,(We,dt)=>We.width-dt.width);const Ge=Me.filter(We=>We.width===t&&We.height===r);Te=Ge[Ge.length-1];const ke=Ge.filter(We=>We.bandwidth===Te.bandwidth)[0];let qe,$e,tt;ke||(qe=Me.filter(We=>We.width>t||We.height>r),$e=qe.filter(We=>We.width===qe[0].width&&We.height===qe[0].height),Te=$e[$e.length-1],tt=$e.filter(We=>We.bandwidth===Te.bandwidth)[0]);let Je;if(f.leastPixelDiffSelector){const We=Me.map(dt=>(dt.pixelDiff=Math.abs(dt.width-t)+Math.abs(dt.height-r),dt));vu(We,(dt,Dt)=>dt.pixelDiff===Dt.pixelDiff?Dt.bandwidth-dt.bandwidth:dt.pixelDiff-Dt.pixelDiff),Je=We[0]}const st=Je||tt||ke||we||$[0]||N[0];if(st&&st.playlist){let We="sortedPlaylistReps";return Je?We="leastPixelDiffRep":tt?We="resolutionPlusOneRep":ke?We="resolutionBestRep":we?We="bandwidthBestRep":$[0]&&(We="enabledPlaylistReps"),dh(`choosing ${Hg(st)} using ${We} with options`,p),st.playlist}return dh("could not choose a playlist with options",p),null};const Kg=function(){let i=this.useDevicePixelRatio&&window.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),jg(this.playlists.main,this.systemBandwidth,parseInt(hh(this.tech_.el(),"width"),10)*i,parseInt(hh(this.tech_.el(),"height"),10)*i,this.limitRenditionByPlayerDimensions,this.playlistController_)},Ny=function(i){let e=-1,t=-1;if(i<0||i>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let r=this.useDevicePixelRatio&&window.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(r=this.customPixelRatio),e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=i*this.systemBandwidth+(1-i)*e,t=this.systemBandwidth),jg(this.playlists.main,e,parseInt(hh(this.tech_.el(),"width"),10)*r,parseInt(hh(this.tech_.el(),"height"),10)*r,this.limitRenditionByPlayerDimensions,this.playlistController_)}},Fy=function(i){const{main:e,currentTime:t,bandwidth:r,duration:o,segmentDuration:f,timeUntilRebuffer:p,currentTimeline:E,syncController:N}=i,$=e.playlists.filter(Ge=>!Fn.isIncompatible(Ge));let he=$.filter(Fn.isEnabled);he.length||(he=$.filter(Ge=>!Fn.isDisabled(Ge)));const we=he.filter(Fn.hasAttribute.bind(null,"BANDWIDTH")).map(Ge=>{const qe=N.getSyncPoint(Ge,o,E,t)?1:2,tt=Fn.estimateSegmentRequestTime(f,r,Ge)*qe-p;return{playlist:Ge,rebufferingImpact:tt}}),Me=we.filter(Ge=>Ge.rebufferingImpact<=0);return vu(Me,(Ge,ke)=>np(ke.playlist,Ge.playlist)),Me.length?Me[0]:(vu(we,(Ge,ke)=>Ge.rebufferingImpact-ke.rebufferingImpact),we[0]||null)},By=function(){const i=this.playlists.main.playlists.filter(Fn.isEnabled);return vu(i,(t,r)=>np(t,r)),i.filter(t=>!!Dc(this.playlists.main,t).video)[0]||null},Uy=i=>{let e=0,t;return i.bytes&&(t=new Uint8Array(i.bytes),i.segments.forEach(r=>{t.set(r,e),e+=r.byteLength})),t};function qg(i){try{return new URL(i).pathname.split("/").slice(-2).join("/")}catch{return""}}const Gy=function(i,e,t){if(!i[t]){e.trigger({type:"usage",name:"vhs-608"});let r=t;/^cc708_/.test(t)&&(r="SERVICE"+t.split("_")[1]);const o=e.textTracks().getTrackById(r);if(o)i[t]=o;else{const f=e.options_.vhs&&e.options_.vhs.captionServices||{};let p=t,E=t,N=!1;const $=f[r];$&&(p=$.label,E=$.language,N=$.default),i[t]=e.addRemoteTextTrack({kind:"captions",id:r,default:N,label:p,language:E},!1).track}}},Vy=function({inbandTextTracks:i,captionArray:e,timestampOffset:t}){if(!e)return;const r=window.WebKitDataCue||window.VTTCue;e.forEach(o=>{const f=o.stream;o.content?o.content.forEach(p=>{const E=new r(o.startTime+t,o.endTime+t,p.text);E.line=p.line,E.align="left",E.position=p.position,E.positionAlign="line-left",i[f].addCue(E)}):i[f].addCue(new r(o.startTime+t,o.endTime+t,o.text))})},Hy=function(i){Object.defineProperties(i.frame,{id:{get(){return it.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),i.value.key}},value:{get(){return it.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),i.value.data}},privateData:{get(){return it.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),i.value.data}}})},jy=({inbandTextTracks:i,metadataArray:e,timestampOffset:t,videoDuration:r})=>{if(!e)return;const o=window.WebKitDataCue||window.VTTCue,f=i.metadataTrack_;if(!f||(e.forEach(he=>{const Te=he.cueTime+t;typeof Te!="number"||window.isNaN(Te)||Te<0||!(Te<1/0)||!he.frames||!he.frames.length||he.frames.forEach(we=>{const Me=new o(Te,Te,we.value||we.url||we.data||"");Me.frame=we,Me.value=we,Hy(Me),f.addCue(Me)})}),!f.cues||!f.cues.length))return;const p=f.cues,E=[];for(let he=0;he<p.length;he++)p[he]&&E.push(p[he]);const N=E.reduce((he,Te)=>{const we=he[Te.startTime]||[];return we.push(Te),he[Te.startTime]=we,he},{}),$=Object.keys(N).sort((he,Te)=>Number(he)-Number(Te));$.forEach((he,Te)=>{const we=N[he],Me=isFinite(r)?r:he,Ge=Number($[Te+1])||Me;we.forEach(ke=>{ke.endTime=Ge})})},Ky={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},qy=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),$y=({inbandTextTracks:i,dateRanges:e})=>{const t=i.metadataTrack_;if(!t)return;const r=window.WebKitDataCue||window.VTTCue;e.forEach(o=>{for(const f of Object.keys(o)){if(qy.has(f))continue;const p=new r(o.startTime,o.endTime,"");p.id=o.id,p.type="com.apple.quicktime.HLS",p.value={key:Ky[f],data:o[f]},(f==="scte35Out"||f==="scte35In")&&(p.value.data=new Uint8Array(p.value.data.match(/[\da-f]{2}/gi)).buffer),t.addCue(p)}o.processDateRange()})},$g=(i,e,t)=>{i.metadataTrack_||(i.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,it.browser.IS_ANY_SAFARI||(i.metadataTrack_.inBandMetadataTrackDispatchType=e))},wc=function(i,e,t){let r,o;if(t&&t.cues)for(r=t.cues.length;r--;)o=t.cues[r],o.startTime>=i&&o.endTime<=e&&t.removeCue(o)},Wy=function(i){const e=i.cues;if(!e)return;const t={};for(let r=e.length-1;r>=0;r--){const o=e[r],f=`${o.startTime}-${o.endTime}-${o.text}`;t[f]?i.removeCue(o):t[f]=o}},zy=(i,e,t)=>{if(typeof e>"u"||e===null||!i.length)return[];const r=Math.ceil((e-t+3)*sl);let o;for(o=0;o<i.length&&!(i[o].pts>r);o++);return i.slice(o)},Yy=(i,e,t)=>{if(!e.length)return i;if(t)return e.slice();const r=e[0].pts;let o=0;for(o;o<i.length&&!(i[o].pts>=r);o++);return i.slice(0,o).concat(e)},Xy=(i,e,t,r)=>{const o=Math.ceil((e-r)*sl),f=Math.ceil((t-r)*sl),p=i.slice();let E=i.length;for(;E--&&!(i[E].pts<=f););if(E===-1)return p;let N=E+1;for(;N--&&!(i[N].pts<=o););return N=Math.max(N,0),p.splice(N,E-N+1),p},Qy=function(i,e){if(!i&&!e||!i&&e||i&&!e)return!1;if(i===e)return!0;const t=Object.keys(i).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let o=0;o<t.length;o++){const f=t[o];if(f!==r[o]||i[f]!==e[f])return!1}return!0},Jy=function(i,e,t){e=e||[];const r=[];let o=0;for(let f=0;f<e.length;f++){const p=e[f];if(i===p.timeline&&(r.push(f),o+=p.duration,o>t))return f}return r.length===0?0:r[r.length-1]},Lc=1,Zy=500,Wg=i=>typeof i=="number"&&isFinite(i),fh=1/60,eT=(i,e,t)=>i!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,tT=(i,e,t)=>{let r=e-Vr.BACK_BUFFER_LENGTH;i.length&&(r=Math.max(r,i.start(0)));const o=e-t;return Math.min(o,r)},yu=i=>{const{startOfSegment:e,duration:t,segment:r,part:o,playlist:{mediaSequence:f,id:p,segments:E=[]},mediaIndex:N,partIndex:$,timeline:he}=i,Te=E.length-1;let we="mediaIndex/partIndex increment";i.getMediaInfoForTime?we=`getMediaInfoForTime (${i.getMediaInfoForTime})`:i.isSyncRequest&&(we="getSyncSegmentCandidate (isSyncRequest)"),i.independent&&(we+=` with independent ${i.independent}`);const Me=typeof $=="number",Ge=i.segment.uri?"segment":"pre-segment",ke=Me?tg({preloadSegment:r})-1:0;return`${Ge} [${f+N}/${f+Te}]`+(Me?` part [${$}/${ke}]`:"")+` segment start/end [${r.start} => ${r.end}]`+(Me?` part start/end [${o.start} => ${o.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${he}] selected by [${we}] playlist [${p}]`},zg=i=>`${i}TimingInfo`,iT=({segmentTimeline:i,currentTimeline:e,startOfSegment:t,buffered:r,overrideCheck:o})=>!o&&i===e?null:i<e?t:r.length?r.end(r.length-1):t,sp=({timelineChangeController:i,currentTimeline:e,segmentTimeline:t,loaderType:r,audioDisabled:o})=>{if(e===t)return!1;if(r==="audio"){const f=i.lastTimelineChange({type:"main"});return!f||f.to!==t}if(r==="main"&&o){const f=i.pendingTimelineChange({type:"audio"});return!(f&&f.to===t)}return!1},rT=i=>{if(!i)return!1;const e=i.pendingTimelineChange({type:"audio"}),t=i.pendingTimelineChange({type:"main"}),r=e&&t,o=r&&e.to!==t.to;return!!(r&&e.from!==-1&&t.from!==-1&&o)},nT=i=>{i&&(i.pause(),i.resetEverything(),i.load())},sT=i=>{const e=i.timelineChangeController_.pendingTimelineChange({type:"audio"}),t=i.timelineChangeController_.pendingTimelineChange({type:"main"});return e&&t&&e.to<t.to},Ao=i=>{const e=i.pendingSegment_;if(!e)return;if(sp({timelineChangeController:i.timelineChangeController_,currentTimeline:i.currentTimeline_,segmentTimeline:e.timeline,loaderType:i.loaderType_,audioDisabled:i.audioDisabled_})&&rT(i.timelineChangeController_)){if(sT(i)){i.timelineChangeController_.trigger("audioTimelineBehind");return}nT(i)}},aT=i=>{let e=0;return["video","audio"].forEach(function(t){const r=i[`${t}TimingInfo`];if(!r)return;const{start:o,end:f}=r;let p;typeof o=="bigint"||typeof f=="bigint"?p=window.BigInt(f)-window.BigInt(o):typeof o=="number"&&typeof f=="number"&&(p=f-o),typeof p<"u"&&p>e&&(e=p)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},Yg=({segmentDuration:i,maxDuration:e})=>i?Math.round(i)>e+ga:!1,oT=(i,e)=>{if(e!=="hls")return null;const t=aT({audioTimingInfo:i.audioTimingInfo,videoTimingInfo:i.videoTimingInfo});if(!t)return null;const r=i.playlist.targetDuration,o=Yg({segmentDuration:t,maxDuration:r*2}),f=Yg({segmentDuration:t,maxDuration:r}),p=`Segment with index ${i.mediaIndex} from playlist ${i.playlist.id} has a duration of ${t} when the reported duration is ${i.duration} and the target duration is ${r}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return o||f?{severity:o?"warn":"info",message:p}:null},ll=({type:i,segment:e})=>{if(!e)return;const t=!!(e.key||e.map&&e.map.ke),r=!!(e.map&&!e.map.bytes),o=e.startOfSegment===void 0?e.start:e.startOfSegment;return{type:i||e.type,uri:e.resolvedUri||e.uri,start:o,duration:e.duration,isEncrypted:t,isMediaInitialization:r}};class ap extends it.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=ds(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(r){r!==this.state_&&(this.logger_(`${this.state_} -> ${r}`),this.state_=r,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ao(this)}),this.sourceUpdater_.on("codecschange",r=>{this.trigger(Hi({type:"codecschange"},r))}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ao(this)}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",r=>{this.trigger(Hi({type:"timelinechange"},r)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():Ao(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ao(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return tp.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,window.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&tp.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return Zr();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:r,isMuxed:o}=e;if(r&&t&&!this.audioDisabled_&&!o)return this.sourceUpdater_.buffered();if(r)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const r=uh(e);let o=this.initSegments_[r];return t&&!o&&e.bytes&&(this.initSegments_[r]=o={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),o||e}segmentKey(e,t=!1){if(!e)return null;const r=_g(e);let o=this.keyCache_[r];this.cacheEncryptionKeys_&&t&&!o&&e.bytes&&(this.keyCache_[r]=o={resolvedUri:e.resolvedUri,bytes:e.bytes});const f={resolvedUri:(o||e).resolvedUri};return o&&(f.bytes=o.bytes),f}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;const r=this.playlist_,o=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let f=null;if(r&&(r.id?f=r.id:r.uri&&(f=r.uri)),this.logger_(`playlist update [${f} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:
currentTime: ${this.currentTime_()}
bufferedEnd: ${Hf(this.buffered_())}
`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!r||r.uri!==e.uri){this.mediaIndex!==null&&(!e.endList&&typeof e.partTargetDuration=="number"?this.resetLoader():this.resyncLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const p=e.mediaSequence-r.mediaSequence;if(this.logger_(`live window shift [${p}]`),this.mediaIndex!==null)if(this.mediaIndex-=p,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const E=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!E.parts||!E.parts.length||!E.parts[this.partIndex])){const N=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=N}}o&&(o.mediaIndex-=p,o.mediaIndex<0?(o.mediaIndex=null,o.partIndex=null):(o.mediaIndex>=0&&(o.segment=e.segments[o.mediaIndex]),o.partIndex>=0&&o.segment.parts&&(o.part=o.segment.parts[o.partIndex]))),this.syncController_.saveExpiredSegmentInfo(r,e)}pause(){this.checkBufferTimeout_&&(window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&tp.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;this.sourceType_==="hls"&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,r=()=>{},o=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let f=1;const p=()=>{f--,f===0&&r()};(o||!this.audioDisabled_)&&(f++,this.sourceUpdater_.removeAudio(e,t,p)),(o||this.loaderType_==="main")&&(this.gopBuffer_=Xy(this.gopBuffer_,e,t,this.timeMapping_),f++,this.sourceUpdater_.removeVideo(e,t,p));for(const E in this.inbandTextTracks_)wc(e,t,this.inbandTextTracks_[E]);wc(e,t,this.segmentMetadataTrack_),p()}monitorBuffer_(){this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window.setTimeout(this.monitorBufferTick_.bind(this),Zy)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:ll({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,r=this.partIndex){if(!t||!this.mediaSource_)return!1;const o=typeof e=="number"&&t.segments[e],f=e+1===t.segments.length,p=!o||!o.parts||r+1===o.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&f&&p}chooseNextRequest_(){const e=this.buffered_(),t=Hf(e)||0,r=jf(e,this.currentTime_()),o=!this.hasPlayed_()&&r>=1,f=r>=this.goalBufferLength_(),p=this.playlist_.segments;if(!p.length||o||f)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const E={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(E.isSyncRequest)E.mediaIndex=Jy(this.currentTimeline_,p,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${E.mediaIndex}`);else if(this.mediaIndex!==null){const we=p[this.mediaIndex],Me=typeof this.partIndex=="number"?this.partIndex:-1;E.startOfSegment=we.end?we.end:t,we.parts&&we.parts[Me+1]?(E.mediaIndex=this.mediaIndex,E.partIndex=Me+1):E.mediaIndex=this.mediaIndex+1}else{let we,Me,Ge;const ke=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:
For TargetTime: ${ke}.
CurrentTime: ${this.currentTime_()}
BufferedEnd: ${t}
Fetch At Buffer: ${this.fetchAtBuffer_}
`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const qe=this.getSyncInfoFromMediaSequenceSync_(ke);if(!qe){const $e="No sync info found while using media sequence sync";return this.error({message:$e,metadata:{errorType:it.Error.StreamingFailedToSelectNextSegment,error:new Error($e)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${qe.start} --> ${qe.end})`),we=qe.segmentIndex,Me=qe.partIndex,Ge=qe.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const qe=Fn.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:ke,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});we=qe.segmentIndex,Me=qe.partIndex,Ge=qe.startTime}E.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${ke}`:`currentTime ${ke}`,E.mediaIndex=we,E.startOfSegment=Ge,E.partIndex=Me,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${E.mediaIndex} `)}const N=p[E.mediaIndex];let $=N&&typeof E.partIndex=="number"&&N.parts&&N.parts[E.partIndex];if(!N||typeof E.partIndex=="number"&&!$)return null;typeof E.partIndex!="number"&&N.parts&&(E.partIndex=0,$=N.parts[0]);const he=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!r&&$&&!he&&!$.independent)if(E.partIndex===0){const we=p[E.mediaIndex-1],Me=we.parts&&we.parts.length&&we.parts[we.parts.length-1];Me&&Me.independent&&(E.mediaIndex-=1,E.partIndex=we.parts.length-1,E.independent="previous segment")}else N.parts[E.partIndex-1].independent&&(E.partIndex-=1,E.independent="previous part");const Te=this.mediaSource_&&this.mediaSource_.readyState==="ended";return E.mediaIndex>=p.length-1&&Te&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,E.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(E))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const r=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!r)return null;if(!r.isAppended)return r;const o=this.mediaSequenceSync_.getSyncInfoForTime(r.end);return o?(o.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),o):null}generateSegmentInfo_(e){const{independent:t,playlist:r,mediaIndex:o,startOfSegment:f,isSyncRequest:p,partIndex:E,forceTimestampOffset:N,getMediaInfoForTime:$}=e,he=r.segments[o],Te=typeof E=="number"&&he.parts[E],we={requestId:"segment-loader-"+Math.random(),uri:Te&&Te.resolvedUri||he.resolvedUri,mediaIndex:o,partIndex:Te?E:null,isSyncRequest:p,startOfSegment:f,playlist:r,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:he.timeline,duration:Te&&Te.duration||he.duration,segment:he,part:Te,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:$,independent:t},Me=typeof N<"u"?N:this.isPendingTimestampOffset_;we.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:he.timeline,currentTimeline:this.currentTimeline_,startOfSegment:f,buffered:this.buffered_(),overrideCheck:Me});const Ge=Hf(this.sourceUpdater_.audioBuffered());return typeof Ge=="number"&&(we.audioAppendStart=Ge-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(we.gopsToAlignWith=zy(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),we}timestampOffsetForSegment_(e){return iT(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),r=e.bandwidth,o=this.pendingSegment_.duration,f=Fn.estimateSegmentRequestTime(o,r,this.playlist_,e.bytesReceived),p=D0(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(f<=p)return;const E=Fy({main:this.vhs_.playlists.main,currentTime:t,bandwidth:r,duration:this.duration_(),segmentDuration:o,timeUntilRebuffer:p,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!E)return;const $=f-p-E.rebufferingImpact;let he=.5;p<=ga&&(he=1),!(!E.playlist||E.playlist.uri===this.playlist_.uri||$<he)&&(this.bandwidth=E.playlist.attributes.BANDWIDTH*Vr.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${yu(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:r,hasVideo:o}=t,f={segmentInfo:ll({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:r,hasVideo:o}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:f}),this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},Qy(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ao(this))))}handleTimingInfo_(e,t,r,o){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const f=this.pendingSegment_,p=zg(t);f[p]=f[p]||{},f[p][r]=o,this.logger_(`timinginfo: ${t} - ${r} - ${o}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ao(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const o=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),f={};t.forEach(p=>{f[p.stream]=f[p.stream]||{startTime:1/0,captions:[],endTime:0};const E=f[p.stream];E.startTime=Math.min(E.startTime,p.startTime+o),E.endTime=Math.max(E.endTime,p.endTime+o),E.captions.push(p)}),Object.keys(f).forEach(p=>{const{startTime:E,endTime:N,captions:$}=f[p],he=this.inbandTextTracks_;this.logger_(`adding cues from ${E} -> ${N} for ${p}`),Gy(he,this.vhs_.tech_,p),wc(E,N,he[p]),Vy({captionArray:$,inbandTextTracks:he,timestampOffset:o})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,r));return}this.addMetadataToTextTrack(r,t,this.duration_())}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!sp({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:r,hasVideo:o,isMuxed:f}=t;return!(o&&!e.videoTimingInfo||r&&!this.audioDisabled_&&!f&&!e.audioTimingInfo||sp({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){Ao(this),this.callQueue_.push(this.handleData_.bind(this,e,t));return}const r=this.pendingSegment_;if(this.setTimeMapping_(r.timeline),this.updateMediaSecondsLoaded_(r.part||r.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),r.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),r.isFmp4=e.isFmp4,r.timingInfo=r.timingInfo||{},r.isFmp4)this.trigger("fmp4"),r.timingInfo.start=r[zg(t.type)].start;else{const o=this.getCurrentMediaInfo_(),f=this.loaderType_==="main"&&o&&o.hasVideo;let p;f&&(p=r.videoTimingInfo.start),r.timingInfo.start=this.trueSegmentStart_({currentStart:r.timingInfo.start,playlist:r.playlist,mediaIndex:r.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:f,firstVideoFrameTimeForData:p,videoTimingInfo:r.videoTimingInfo,audioTimingInfo:r.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(r,t.type),this.updateSourceBufferTimestampOffset_(r),r.isSyncRequest){this.updateTimingInfoEnd_(r),this.syncController_.saveSegmentTimingInfo({segmentInfo:r,shouldSaveTimelineMapping:this.loaderType_==="main"});const o=this.chooseNextRequest_();if(o.mediaIndex!==r.mediaIndex||o.partIndex!==r.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}r.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(r,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:r,playlist:o}){if(r){const f=uh(r);if(this.activeInitSegmentId_===f)return null;t=this.initSegmentForMap(r,!0).bytes,this.activeInitSegmentId_=f}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=o,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:r},o){const f=this.sourceUpdater_.audioBuffered(),p=this.sourceUpdater_.videoBuffered();f.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+al(f).join(", ")),p.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+al(p).join(", "));const E=f.length?f.start(0):0,N=f.length?f.end(f.length-1):0,$=p.length?p.start(0):0,he=p.length?p.end(p.length-1):0;if(N-E<=Lc&&he-$<=Lc){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${r.byteLength}, audio buffer: ${al(f).join(", ")}, video buffer: ${al(p).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:r}));const we=this.currentTime_()-Lc;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${we}`),this.remove(0,we,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${Lc}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=window.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},Lc*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:r},o){if(o){if(o.code===pg){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:r});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",o),this.error({message:`${t} append of ${r.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:it.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:r,data:o,bytes:f}){if(!f){const E=[o];let N=o.byteLength;r&&(E.unshift(r),N+=r.byteLength),f=Uy({bytes:N,segments:E})}const p={segmentInfo:ll({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:p}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:f},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:f}))}handleSegmentTimingInfo_(e,t,r){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const o=this.pendingSegment_.segment,f=`${e}TimingInfo`;o[f]||(o[f]={}),o[f].transmuxerPrependedSeconds=r.prependedContentDuration||0,o[f].transmuxedPresentationStart=r.start.presentation,o[f].transmuxedDecodeStart=r.start.decode,o[f].transmuxedPresentationEnd=r.end.presentation,o[f].transmuxedDecodeEnd=r.end.decode,o[f].baseMediaDecodeTime=r.baseMediaDecodeTime}appendData_(e,t){const{type:r,data:o}=t;if(!o||!o.byteLength||r==="audio"&&this.audioDisabled_)return;const f=this.getInitSegmentAndUpdateState_({type:r,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:r,initSegment:f,data:o})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){Ao(this),this.loadQueue_.push(()=>{const t=Hi({},e,{forceTimestampOffset:!0});Hi(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),r=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),o=this.mediaIndex!==null,f=e.timeline!==this.currentTimeline_&&e.timeline>0,p=r||o&&f;this.logger_(`Requesting
${qg(e.uri)}
${yu(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=Iy({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:p,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:E,level:N,stream:$})=>{this.logger_(`${yu(e)} logged from transmuxer stream ${$} as a ${N}: ${E}`)},triggerSegmentEventFn:({type:E,segment:N,keyInfo:$,trackInfo:he,timingInfo:Te})=>{const Me={segmentInfo:ll({segment:N})};$&&(Me.keyInfo=$),he&&(Me.trackInfo=he),Te&&(Me.timingInfo=Te),this.trigger({type:E,metadata:Me})}})}trimBackBuffer_(e){const t=tT(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,r=e.part,o=e.segment.key||e.segment.map&&e.segment.map.key,f=e.segment.map&&!e.segment.map.bytes,p={resolvedUri:r?r.resolvedUri:t.resolvedUri,byterange:r?r.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:o,isMediaInitialization:f},E=e.playlist.segments[e.mediaIndex-1];if(E&&E.timeline===t.timeline&&(E.videoTimingInfo?p.baseStartTime=E.videoTimingInfo.transmuxedDecodeEnd:E.audioTimingInfo&&(p.baseStartTime=E.audioTimingInfo.transmuxedDecodeEnd)),t.key){const N=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);p.key=this.segmentKey(t.key),p.key.iv=N}return t.map&&(p.map=this.initSegmentForMap(t.map)),p}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<fh){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${fh}`);return}const r={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:r}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,r){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,r));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===va.ABORTED)return;if(this.pause(),e.code===va.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const o=this.pendingSegment_;this.saveBandwidthRelatedStats_(o.duration,t.stats),o.endOfAllRequests=t.endOfAllRequests,r.gopInfo&&(this.gopBuffer_=Yy(this.gopBuffer_,r.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(o)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:r,firstVideoFrameTimeForData:o,currentVideoTimestampOffset:f,useVideoTimingInfo:p,videoTimingInfo:E,audioTimingInfo:N}){if(typeof e<"u")return e;if(!p)return N.start;const $=t.segments[r-1];return r===0||!$||typeof $.start>"u"||$.end!==o+f?o:E.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:r,hasVideo:o,isMuxed:f}=t,p=this.loaderType_==="main"&&o,E=!this.audioDisabled_&&r&&!f;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}p&&e.waitingOnAppends++,E&&e.waitingOnAppends++,p&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),E&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=eT(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:r}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:r.start:r.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),o=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;o&&(e.timingInfo.end=typeof o.end=="number"?o.end:o.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const N={segmentInfo:ll({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:N})}if(!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=oT(e,this.sourceType_);if(t&&(t.severity==="warn"?it.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${yu(e)}`);return}this.logger_(`Appended ${yu(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const r=e.segment,o=e.part,f=r.end&&this.currentTime_()-r.end>e.playlist.targetDuration*3,p=o&&o.end&&this.currentTime_()-o.end>e.playlist.partTargetDuration*3;if(f||p){this.logger_(`bad ${f?"segment":"part"} ${yu(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<fh){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${fh}`);return}const t=this.throughput.rate,r=Date.now()-e.endOfAllRequests+1,o=Math.floor(e.byteLength/r*8*1e3);this.throughput.rate+=(o-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,r=t.start,o=t.end;if(!Wg(r)||!Wg(o))return;wc(r,o,this.segmentMetadataTrack_);const f=window.WebKitDataCue||window.VTTCue,p={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:r,end:o},E=JSON.stringify(p),N=new f(r,o,E);N.value=p,this.segmentMetadataTrack_.addCue(N)}}function Wa(){}const Xg=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},lT=["video","audio"],op=(i,e)=>{const t=e[`${i}Buffer`];return t&&t.updating||e.queuePending[i]},uT=(i,e)=>{for(let t=0;t<e.length;t++){const r=e[t];if(r.type==="mediaSource")return null;if(r.type===i)return t}return null},Tu=(i,e)=>{if(e.queue.length===0)return;let t=0,r=e.queue[t];if(r.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),r.action(e),r.doneFn&&r.doneFn(),Tu("audio",e),Tu("video",e));return}if(i!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||op(i,e))){if(r.type!==i){if(t=uT(i,e.queue),t===null)return;r=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[i]=r,r.action(i,e),!r.doneFn){e.queuePending[i]=null,Tu(i,e);return}}},Qg=(i,e)=>{const t=e[`${i}Buffer`],r=Xg(i);t&&(t.removeEventListener("updateend",e[`on${r}UpdateEnd_`]),t.removeEventListener("error",e[`on${r}Error_`]),e.codecs[i]=null,e[`${i}Buffer`]=null)},ya=(i,e)=>i&&e&&Array.prototype.indexOf.call(i.sourceBuffers,e)!==-1,Jn={appendBuffer:(i,e,t)=>(r,o)=>{const f=o[`${r}Buffer`];if(ya(o.mediaSource,f)){o.logger_(`Appending segment ${e.mediaIndex}'s ${i.length} bytes to ${r}Buffer`);try{f.appendBuffer(i)}catch(p){o.logger_(`Error with code ${p.code} `+(p.code===pg?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${r}Buffer`),o.queuePending[r]=null,t(p)}}},remove:(i,e)=>(t,r)=>{const o=r[`${t}Buffer`];if(ya(r.mediaSource,o)){r.logger_(`Removing ${i} to ${e} from ${t}Buffer`);try{o.remove(i,e)}catch{r.logger_(`Remove ${i} to ${e} from ${t}Buffer failed`)}}},timestampOffset:i=>(e,t)=>{const r=t[`${e}Buffer`];ya(t.mediaSource,r)&&(t.logger_(`Setting ${e}timestampOffset to ${i}`),r.timestampOffset=i)},callback:i=>(e,t)=>{i()},endOfStream:i=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${i||""})`);try{e.mediaSource.endOfStream(i)}catch(t){it.log.warn("Failed to call media source endOfStream",t)}}},duration:i=>e=>{e.logger_(`Setting mediaSource duration to ${i}`);try{e.mediaSource.duration=i}catch(t){it.log.warn("Failed to set media source duration",t)}},abort:()=>(i,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${i}Buffer`];if(ya(e.mediaSource,t)){e.logger_(`calling abort on ${i}Buffer`);try{t.abort()}catch(r){it.log.warn(`Failed to abort on ${i}Buffer`,r)}}},addSourceBuffer:(i,e)=>t=>{const r=Xg(i),o=To(e);t.logger_(`Adding ${i}Buffer with codec ${e} to mediaSource`);const f=t.mediaSource.addSourceBuffer(o);f.addEventListener("updateend",t[`on${r}UpdateEnd_`]),f.addEventListener("error",t[`on${r}Error_`]),t.codecs[i]=e,t[`${i}Buffer`]=f},removeSourceBuffer:i=>e=>{const t=e[`${i}Buffer`];if(Qg(i,e),!!ya(e.mediaSource,t)){e.logger_(`Removing ${i}Buffer with codec ${e.codecs[i]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(r){it.log.warn(`Failed to removeSourceBuffer ${i}Buffer`,r)}}},changeType:i=>(e,t)=>{const r=t[`${e}Buffer`],o=To(i);if(!ya(t.mediaSource,r))return;const f=i.substring(0,i.indexOf(".")),p=t.codecs[e];if(p.substring(0,p.indexOf("."))===f)return;const N={codecsChangeInfo:{from:p,to:i}};t.trigger({type:"codecschange",metadata:N}),t.logger_(`changing ${e}Buffer codec from ${p} to ${i}`);try{r.changeType(o),t.codecs[e]=i}catch($){N.errorType=it.Error.StreamingCodecsChangeError,N.error=$,$.metadata=N,t.error_=$,t.trigger("error"),it.log.warn(`Failed to changeType on ${e}Buffer`,$)}}},Zn=({type:i,sourceUpdater:e,action:t,doneFn:r,name:o})=>{e.queue.push({type:i,action:t,doneFn:r,name:o}),Tu(i,e)},Jg=(i,e)=>t=>{const r=e[`${i}Buffered`](),o=x0(r);if(e.logger_(`received "updateend" event for ${i} Source Buffer: `,o),e.queuePending[i]){const f=e.queuePending[i].doneFn;e.queuePending[i]=null,f&&f(e[`${i}Error_`])}Tu(i,e)};class Zg extends it.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>Tu("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=ds("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=Jg("video",this),this.onAudioUpdateEnd_=Jg("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){Zn({type:"mediaSource",sourceUpdater:this,action:Jn.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){Zn({type:e,sourceUpdater:this,action:Jn.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){it.log.error("removeSourceBuffer is not supported!");return}Zn({type:"mediaSource",sourceUpdater:this,action:Jn.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!it.browser.IS_FIREFOX&&window.MediaSource&&window.MediaSource.prototype&&typeof window.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return window.SourceBuffer&&window.SourceBuffer.prototype&&typeof window.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){it.log.error("changeType is not supported!");return}Zn({type:e,sourceUpdater:this,action:Jn.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const r=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,r);this.canChangeType()&&this.changeType(t,r)})}appendBuffer(e,t){const{segmentInfo:r,type:o,bytes:f}=e;if(this.processedAppend_=!0,o==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${f.length} until video append`);return}const p=t;if(Zn({type:o,sourceUpdater:this,action:Jn.appendBuffer(f,r||{mediaIndex:-1},p),doneFn:t,name:"appendBuffer"}),o==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const E=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${E.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,E.forEach(N=>{this.appendBuffer.apply(this,N)})}}audioBuffered(){return ya(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:Zr()}videoBuffered(){return ya(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:Zr()}buffered(){const e=ya(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=ya(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():k0(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=Wa){Zn({type:"mediaSource",sourceUpdater:this,action:Jn.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=Wa){typeof e!="string"&&(e=void 0),Zn({type:"mediaSource",sourceUpdater:this,action:Jn.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,r=Wa){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){r();return}Zn({type:"audio",sourceUpdater:this,action:Jn.remove(e,t),doneFn:r,name:"remove"})}removeVideo(e,t,r=Wa){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){r();return}Zn({type:"video",sourceUpdater:this,action:Jn.remove(e,t),doneFn:r,name:"remove"})}updating(){return!!(op("audio",this)||op("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Zn({type:"audio",sourceUpdater:this,action:Jn.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(Zn({type:"video",sourceUpdater:this,action:Jn.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Zn({type:"audio",sourceUpdater:this,action:Jn.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Zn({type:"video",sourceUpdater:this,action:Jn.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),lT.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>Qg(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const em=i=>decodeURIComponent(escape(String.fromCharCode.apply(null,i))),cT=i=>{const e=new Uint8Array(i);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")},tm=new Uint8Array(`

`.split("").map(i=>i.charCodeAt(0)));class dT extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class hT extends ap{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}createTransmuxer_(){return null}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return Zr();const e=this.subtitlesTrack_.cues,t=e[0].startTime,r=e[e.length-1].startTime;return Zr([[t,r]])}initSegmentForMap(e,t=!1){if(!e)return null;const r=uh(e);let o=this.initSegments_[r];if(t&&!o&&e.bytes){const f=tm.byteLength+e.bytes.byteLength,p=new Uint8Array(f);p.set(e.bytes),p.set(tm,e.bytes.byteLength),this.initSegments_[r]=o={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:p}}return o||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){wc(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,r){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===va.TIMEOUT&&this.handleTimeout_(),e.code===va.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const o=this.pendingSegment_;this.saveBandwidthRelatedStats_(o.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const f=o.segment;if(f.map&&(f.map.bytes=t.map.bytes),o.bytes=t.bytes,typeof window.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,r),()=>this.stopForError({message:"Error loading vtt.js"}));return}f.requested=!0;try{this.parseVTTCues_(o)}catch(p){this.stopForError({message:p.message,metadata:{errorType:it.Error.StreamingVttParserError,error:p}});return}if(this.updateTimeMapping_(o,this.syncController_.timelines[o.timeline],this.playlist_),o.cues.length?o.timingInfo={start:o.cues[0].startTime,end:o.cues[o.cues.length-1].endTime}:o.timingInfo={start:o.startOfSegment,end:o.startOfSegment+o.duration},o.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}o.byteLength=o.bytes.byteLength,this.mediaSecondsLoaded+=f.duration,o.cues.forEach(p=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new window.VTTCue(p.startTime,p.endTime,p.text):p)}),Wy(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(){}updateTimingInfoEnd_(){}parseVTTCues_(e){let t,r=!1;if(typeof window.WebVTT!="function")throw new dT;typeof window.TextDecoder=="function"?t=new window.TextDecoder("utf8"):(t=window.WebVTT.StringDecoder(),r=!0);const o=new window.WebVTT.Parser(window,window.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},o.oncue=e.cues.push.bind(e.cues),o.ontimestampmap=p=>{e.timestampmap=p},o.onparsingerror=p=>{it.log.warn("Error encountered when parsing cues: "+p.message)},e.segment.map){let p=e.segment.map.bytes;r&&(p=em(p)),o.parse(p)}let f=e.bytes;r&&(f=em(f)),o.parse(f),o.flush()}updateTimeMapping_(e,t,r){const o=e.segment;if(!t)return;if(!e.cues.length){o.empty=!0;return}const{MPEGTS:f,LOCAL:p}=e.timestampmap,N=f/sl-p+t.mapping;if(e.cues.forEach($=>{const he=$.endTime-$.startTime,Te=this.handleRollover_($.startTime+N,t.time);$.startTime=Math.max(Te,0),$.endTime=Math.max(Te+he,0)}),!r.syncInfo){const $=e.cues[0].startTime,he=e.cues[e.cues.length-1].startTime;r.syncInfo={mediaSequence:r.mediaSequence+e.mediaIndex,time:Math.min($,he-o.duration)}}}handleRollover_(e,t){if(t===null)return e;let r=e*sl;const o=t*sl;let f;for(o<r?f=-8589934592:f=8589934592;Math.abs(r-o)>4294967296;)r+=f;return r/sl}}const fT=function(i,e){const t=i.cues;for(let r=0;r<t.length;r++){const o=t[r];if(e>=o.adStartTime&&e<=o.adEndTime)return o}return null},pT=function(i,e,t=0){if(!i.segments)return;let r=t,o;for(let f=0;f<i.segments.length;f++){const p=i.segments[f];if(o||(o=fT(e,r+p.duration/2)),o){if("cueIn"in p){o.endTime=r,o.adEndTime=r,r+=p.duration,o=null;continue}if(r<o.endTime){r+=p.duration;continue}o.endTime+=p.duration}else if("cueOut"in p&&(o=new window.VTTCue(r,r+p.duration,p.cueOut),o.adStartTime=r,o.adEndTime=r+parseFloat(p.cueOut),e.addCue(o)),"cueOutCont"in p){const[E,N]=p.cueOutCont.split("/").map(parseFloat);o=new window.VTTCue(r,r+p.duration,""),o.adStartTime=r-E,o.adEndTime=o.adStartTime+N,e.addCue(o)}r+=p.duration}};class im{constructor({start:e,end:t,segmentIndex:r,partIndex:o=null,appended:f=!1}){this.start_=e,this.end_=t,this.segmentIndex_=r,this.partIndex_=o,this.appended_=f}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class gT{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class rm{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:r,segments:o}=e;if(this.isReliable_=this.isReliablePlaylist_(r,o),!!this.isReliable_)return this.updateStorage_(o,r,this.calculateBaseTime_(r,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:r}of this.storage_.values())if(r.length){for(const o of r)if(o.isInRange(e))return o}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,r){const o=new Map;let f=`
`,p=r,E=t;this.start_=p,e.forEach((N,$)=>{const he=this.storage_.get(E),Te=p,we=Te+N.duration,Me=!!(he&&he.segmentSyncInfo&&he.segmentSyncInfo.isAppended),Ge=new im({start:Te,end:we,appended:Me,segmentIndex:$});N.syncInfo=Ge;let ke=p;const qe=(N.parts||[]).map(($e,tt)=>{const Je=ke,st=ke+$e.duration,We=!!(he&&he.partsSyncInfo&&he.partsSyncInfo[tt]&&he.partsSyncInfo[tt].isAppended),dt=new im({start:Je,end:st,appended:We,segmentIndex:$,partIndex:tt});return ke=st,f+=`Media Sequence: ${E}.${tt} | Range: ${Je} --> ${st} | Appended: ${We}
`,$e.syncInfo=dt,dt});o.set(E,new gT(Ge,qe)),f+=`${qg(N.resolvedUri)} | Media Sequence: ${E} | Range: ${Te} --> ${we} | Appended: ${Me}
`,E++,p=we}),this.end_=p,this.storage_=o,this.diagnostics_=f}calculateBaseTime_(e,t){return this.storage_.size?this.storage_.has(e)?this.storage_.get(e).segmentSyncInfo.start:t:0}isReliablePlaylist_(e,t){return e!=null&&Array.isArray(t)&&t.length}}class nm extends rm{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t){if(!this.storage_.size){const r=this.parent_.getSyncInfoForMediaSequence(e);return r?r.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t)}}const mT=86400,lp=[{name:"VOD",run:(i,e,t,r,o)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"MediaSequence",run:(i,e,t,r,o,f)=>{const p=i.getMediaSequenceSync(f);if(!p||!p.isReliable)return null;const E=p.getSyncInfoForTime(o);return E?{time:E.start,partIndex:E.partIndex,segmentIndex:E.segmentIndex}:null}},{name:"ProgramDateTime",run:(i,e,t,r,o)=>{if(!Object.keys(i.timelineToDatetimeMappings).length)return null;let f=null,p=null;const E=qf(e);o=o||0;for(let N=0;N<E.length;N++){const $=e.endList||o===0?N:E.length-(N+1),he=E[$],Te=he.segment,we=i.timelineToDatetimeMappings[Te.timeline];if(!we||!Te.dateTimeObject)continue;let Ge=Te.dateTimeObject.getTime()/1e3+we;if(Te.parts&&typeof he.partIndex=="number")for(let qe=0;qe<he.partIndex;qe++)Ge+=Te.parts[qe].duration;const ke=Math.abs(o-Ge);if(p!==null&&(ke===0||p<ke))break;p=ke,f={time:Ge,segmentIndex:he.segmentIndex,partIndex:he.partIndex}}return f}},{name:"Segment",run:(i,e,t,r,o)=>{let f=null,p=null;o=o||0;const E=qf(e);for(let N=0;N<E.length;N++){const $=e.endList||o===0?N:E.length-(N+1),he=E[$],Te=he.segment,we=he.part&&he.part.start||Te&&Te.start;if(Te.timeline===r&&typeof we<"u"){const Me=Math.abs(o-we);if(p!==null&&p<Me)break;(!f||p===null||p>=Me)&&(p=Me,f={time:we,segmentIndex:he.segmentIndex,partIndex:he.partIndex})}}return f}},{name:"Discontinuity",run:(i,e,t,r,o)=>{let f=null;if(o=o||0,e.discontinuityStarts&&e.discontinuityStarts.length){let p=null;for(let E=0;E<e.discontinuityStarts.length;E++){const N=e.discontinuityStarts[E],$=e.discontinuitySequence+E+1,he=i.discontinuities[$];if(he){const Te=Math.abs(o-he.time);if(p!==null&&p<Te)break;(!f||p===null||p>=Te)&&(p=Te,f={time:he.time,segmentIndex:N,partIndex:null})}}}return f}},{name:"Playlist",run:(i,e,t,r,o)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class vT extends it.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new rm,r=new nm(t),o=new nm(t);this.mediaSequenceStorage_={main:t,audio:r,vtt:o},this.logger_=ds("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,r,o,f){if(t!==1/0)return lp.find(({name:N})=>N==="VOD").run(this,e,t);const p=this.runStrategies_(e,t,r,o,f);if(!p.length)return null;for(const E of p){const{syncPoint:N,strategy:$}=E,{segmentIndex:he,time:Te}=N;if(he<0)continue;const we=e.segments[he],Me=Te,Ge=Me+we.duration;if(this.logger_(`Strategy: ${$}. Current time: ${o}. selected segment: ${he}. Time: [${Me} -> ${Ge}]}`),o>=Me&&o<Ge)return this.logger_("Found sync point with exact match: ",N),N}return this.selectSyncPoint_(p,{key:"time",value:o})}getExpiredTime(e,t){if(!e||!e.segments)return null;const r=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!r.length)return null;const o=this.selectSyncPoint_(r,{key:"segmentIndex",value:0});return o.segmentIndex>0&&(o.time*=-1),Math.abs(o.time+xc({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:o.segmentIndex,endIndex:0}))}runStrategies_(e,t,r,o,f){const p=[];for(let E=0;E<lp.length;E++){const N=lp[E],$=N.run(this,e,t,r,o,f);$&&($.strategy=N.name,p.push({strategy:N.name,syncPoint:$}))}return p}selectSyncPoint_(e,t){let r=e[0].syncPoint,o=Math.abs(e[0].syncPoint[t.key]-t.value),f=e[0].strategy;for(let p=1;p<e.length;p++){const E=Math.abs(e[p].syncPoint[t.key]-t.value);E<o&&(o=E,r=e[p].syncPoint,f=e[p].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${f}]: [time:${r.time}, segmentIndex:${r.segmentIndex}`+(typeof r.partIndex=="number"?`,partIndex:${r.partIndex}`:"")+"]"),r}saveExpiredSegmentInfo(e,t){const r=t.mediaSequence-e.mediaSequence;if(r>mT){it.log.warn(`Not saving expired segment info. Media sequence gap ${r} is too large.`);return}for(let o=r-1;o>=0;o--){const f=e.segments[o];if(f&&typeof f.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+o,time:f.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],r=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-r}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const r=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),o=e.segment;r&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:o.start}));const f=o.dateTimeObject;o.discontinuity&&t&&f&&(this.timelineToDatetimeMappings[o.timeline]=-(f.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,r){const o=e.segment,f=e.part;let p=this.timelines[e.timeline],E,N;if(typeof e.timestampOffset=="number")p={time:e.startOfSegment,mapping:e.startOfSegment-t.start},r&&(this.timelines[e.timeline]=p,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${p.time}] [mapping: ${p.mapping}]`)),E=e.startOfSegment,N=t.end+p.mapping;else if(p)E=t.start+p.mapping,N=t.end+p.mapping;else return!1;return f&&(f.start=E,f.end=N),(!o.start||E<o.start)&&(o.start=E),o.end=N,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,r=e.segment;if(r.discontinuity)this.discontinuities[r.timeline]={time:r.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let o=0;o<t.discontinuityStarts.length;o++){const f=t.discontinuityStarts[o],p=t.discontinuitySequence+o+1,E=f-e.mediaIndex,N=Math.abs(E);if(!this.discontinuities[p]||this.discontinuities[p].accuracy>N){let $;E<0?$=r.start-xc({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:f}):$=r.end+xc({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:f}),this.discontinuities[p]={time:$,accuracy:N}}}}dispose(){this.trigger("dispose"),this.off()}}class yT extends it.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:r}){return typeof t=="number"&&typeof r=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:r},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:r}){if(typeof t=="number"&&typeof r=="number"){this.lastTimelineChanges_[e]={type:e,from:t,to:r},delete this.pendingTimelineChanges_[e];const o={timelineChangeInfo:{from:t,to:r}};this.trigger({type:"timelinechange",metadata:o})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const TT=wg(Lg(function(){var i=function(){function ke(){this.listeners={}}var qe=ke.prototype;return qe.on=function(tt,Je){this.listeners[tt]||(this.listeners[tt]=[]),this.listeners[tt].push(Je)},qe.off=function(tt,Je){if(!this.listeners[tt])return!1;var st=this.listeners[tt].indexOf(Je);return this.listeners[tt]=this.listeners[tt].slice(0),this.listeners[tt].splice(st,1),st>-1},qe.trigger=function(tt){var Je=this.listeners[tt];if(Je)if(arguments.length===2)for(var st=Je.length,We=0;We<st;++We)Je[We].call(this,arguments[1]);else for(var dt=Array.prototype.slice.call(arguments,1),Dt=Je.length,kt=0;kt<Dt;++kt)Je[kt].apply(this,dt)},qe.dispose=function(){this.listeners={}},qe.pipe=function(tt){this.on("data",function(Je){tt.push(Je)})},ke}();/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function e(ke){return ke.subarray(0,ke.byteLength-ke[ke.byteLength-1])}/*! @name aes-decrypter @version 4.0.2 @license Apache-2.0 */const t=function(){const ke=[[[],[],[],[],[]],[[],[],[],[],[]]],qe=ke[0],$e=ke[1],tt=qe[4],Je=$e[4];let st,We,dt;const Dt=[],kt=[];let Xt,Ui,si,Mi,Ot,ui;for(st=0;st<256;st++)kt[(Dt[st]=st<<1^(st>>7)*283)^st]=st;for(We=dt=0;!tt[We];We^=Xt||1,dt=kt[dt]||1)for(Mi=dt^dt<<1^dt<<2^dt<<3^dt<<4,Mi=Mi>>8^Mi&255^99,tt[We]=Mi,Je[Mi]=We,si=Dt[Ui=Dt[Xt=Dt[We]]],ui=si*16843009^Ui*65537^Xt*257^We*16843008,Ot=Dt[Mi]*257^Mi*16843008,st=0;st<4;st++)qe[st][We]=Ot=Ot<<24^Ot>>>8,$e[st][Mi]=ui=ui<<24^ui>>>8;for(st=0;st<5;st++)qe[st]=qe[st].slice(0),$e[st]=$e[st].slice(0);return ke};let r=null;class o{constructor(qe){r||(r=t()),this._tables=[[r[0][0].slice(),r[0][1].slice(),r[0][2].slice(),r[0][3].slice(),r[0][4].slice()],[r[1][0].slice(),r[1][1].slice(),r[1][2].slice(),r[1][3].slice(),r[1][4].slice()]];let $e,tt,Je;const st=this._tables[0][4],We=this._tables[1],dt=qe.length;let Dt=1;if(dt!==4&&dt!==6&&dt!==8)throw new Error("Invalid aes key size");const kt=qe.slice(0),Xt=[];for(this._key=[kt,Xt],$e=dt;$e<4*dt+28;$e++)Je=kt[$e-1],($e%dt===0||dt===8&&$e%dt===4)&&(Je=st[Je>>>24]<<24^st[Je>>16&255]<<16^st[Je>>8&255]<<8^st[Je&255],$e%dt===0&&(Je=Je<<8^Je>>>24^Dt<<24,Dt=Dt<<1^(Dt>>7)*283)),kt[$e]=kt[$e-dt]^Je;for(tt=0;$e;tt++,$e--)Je=kt[tt&3?$e:$e-4],$e<=4||tt<4?Xt[tt]=Je:Xt[tt]=We[0][st[Je>>>24]]^We[1][st[Je>>16&255]]^We[2][st[Je>>8&255]]^We[3][st[Je&255]]}decrypt(qe,$e,tt,Je,st,We){const dt=this._key[1];let Dt=qe^dt[0],kt=Je^dt[1],Xt=tt^dt[2],Ui=$e^dt[3],si,Mi,Ot;const ui=dt.length/4-2;let xn,hi=4;const dr=this._tables[1],Ya=dr[0],ul=dr[1],cl=dr[2],dl=dr[3],hl=dr[4];for(xn=0;xn<ui;xn++)si=Ya[Dt>>>24]^ul[kt>>16&255]^cl[Xt>>8&255]^dl[Ui&255]^dt[hi],Mi=Ya[kt>>>24]^ul[Xt>>16&255]^cl[Ui>>8&255]^dl[Dt&255]^dt[hi+1],Ot=Ya[Xt>>>24]^ul[Ui>>16&255]^cl[Dt>>8&255]^dl[kt&255]^dt[hi+2],Ui=Ya[Ui>>>24]^ul[Dt>>16&255]^cl[kt>>8&255]^dl[Xt&255]^dt[hi+3],hi+=4,Dt=si,kt=Mi,Xt=Ot;for(xn=0;xn<4;xn++)st[(3&-xn)+We]=hl[Dt>>>24]<<24^hl[kt>>16&255]<<16^hl[Xt>>8&255]<<8^hl[Ui&255]^dt[hi++],si=Dt,Dt=kt,kt=Xt,Xt=Ui,Ui=si}}class f extends i{constructor(){super(i),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(qe){this.jobs.push(qe),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const p=function(ke){return ke<<24|(ke&65280)<<8|(ke&16711680)>>8|ke>>>24},E=function(ke,qe,$e){const tt=new Int32Array(ke.buffer,ke.byteOffset,ke.byteLength>>2),Je=new o(Array.prototype.slice.call(qe)),st=new Uint8Array(ke.byteLength),We=new Int32Array(st.buffer);let dt,Dt,kt,Xt,Ui,si,Mi,Ot,ui;for(dt=$e[0],Dt=$e[1],kt=$e[2],Xt=$e[3],ui=0;ui<tt.length;ui+=4)Ui=p(tt[ui]),si=p(tt[ui+1]),Mi=p(tt[ui+2]),Ot=p(tt[ui+3]),Je.decrypt(Ui,si,Mi,Ot,We,ui),We[ui]=p(We[ui]^dt),We[ui+1]=p(We[ui+1]^Dt),We[ui+2]=p(We[ui+2]^kt),We[ui+3]=p(We[ui+3]^Xt),dt=Ui,Dt=si,kt=Mi,Xt=Ot;return st};class N{constructor(qe,$e,tt,Je){const st=N.STEP,We=new Int32Array(qe.buffer),dt=new Uint8Array(qe.byteLength);let Dt=0;for(this.asyncStream_=new f,this.asyncStream_.push(this.decryptChunk_(We.subarray(Dt,Dt+st),$e,tt,dt)),Dt=st;Dt<We.length;Dt+=st)tt=new Uint32Array([p(We[Dt-4]),p(We[Dt-3]),p(We[Dt-2]),p(We[Dt-1])]),this.asyncStream_.push(this.decryptChunk_(We.subarray(Dt,Dt+st),$e,tt,dt));this.asyncStream_.push(function(){Je(null,e(dt))})}static get STEP(){return 32e3}decryptChunk_(qe,$e,tt,Je){return function(){const st=E(qe,$e,tt);Je.set(st,qe.byteOffset)}}}var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},he;typeof window<"u"?he=window:typeof $<"u"?he=$:typeof self<"u"?he=self:he={};var Te=he,we=function(qe){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(qe):qe&&qe.buffer instanceof ArrayBuffer},Me=Te.BigInt||Number;Me("0x1"),Me("0x100"),Me("0x10000"),Me("0x1000000"),Me("0x100000000"),Me("0x10000000000"),Me("0x1000000000000"),Me("0x100000000000000"),Me("0x10000000000000000"),function(){var ke=new Uint16Array([65484]),qe=new Uint8Array(ke.buffer,ke.byteOffset,ke.byteLength);return qe[0]===255?"big":qe[0]===204?"little":"unknown"}();const Ge=function(ke){const qe={};return Object.keys(ke).forEach($e=>{const tt=ke[$e];we(tt)?qe[$e]={bytes:tt.buffer,byteOffset:tt.byteOffset,byteLength:tt.byteLength}:qe[$e]=tt}),qe};self.onmessage=function(ke){const qe=ke.data,$e=new Uint8Array(qe.encrypted.bytes,qe.encrypted.byteOffset,qe.encrypted.byteLength),tt=new Uint32Array(qe.key.bytes,qe.key.byteOffset,qe.key.byteLength/4),Je=new Uint32Array(qe.iv.bytes,qe.iv.byteOffset,qe.iv.byteLength/4);new N($e,tt,Je,function(st,We){self.postMessage(Ge({source:qe.source,decrypted:We}),[We.buffer])})}}));var ET=Dg(TT);const _T=i=>{let e=i.default?"main":"alternative";return i.characteristics&&i.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},sm=(i,e)=>{i.abort(),i.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},up=(i,e)=>{e.activePlaylistLoader=i,i.load()},bT=(i,e)=>()=>{const{segmentLoaders:{[i]:t,main:r},mediaTypes:{[i]:o}}=e,f=o.activeTrack(),p=o.getActiveGroup(),E=o.activePlaylistLoader,N=o.lastGroup_;if(!(p&&N&&p.id===N.id)&&(o.lastGroup_=p,o.lastTrack_=f,sm(t,o),!(!p||p.isMainPlaylist))){if(!p.playlistLoader){E&&r.resetEverything();return}t.resyncLoader(),up(p.playlistLoader,o)}},AT=(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:r}}=e;r.lastGroup_=null,t.abort(),t.pause()},ST=(i,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[i]:r,main:o},mediaTypes:{[i]:f}}=e,p=f.activeTrack(),E=f.getActiveGroup(),N=f.activePlaylistLoader,$=f.lastTrack_;if(!($&&p&&$.id===p.id)&&(f.lastGroup_=E,f.lastTrack_=p,sm(r,f),!!E)){if(E.isMainPlaylist){if(!p||!$||p.id===$.id)return;const he=e.vhs.playlistController_,Te=he.selectPlaylist();if(he.media()===Te)return;f.logger_(`track change. Switching main audio from ${$.id} to ${p.id}`),t.pause(),o.resetEverything(),he.fastQualityChange_(Te);return}if(i==="AUDIO"){if(!E.playlistLoader){o.setAudio(!0),o.resetEverything();return}r.setAudio(!0),o.setAudio(!1)}if(N===E.playlistLoader){up(E.playlistLoader,f);return}r.track&&r.track(p),r.resetEverything(),up(E.playlistLoader,f)}},ph={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:t},excludePlaylist:r}=e,o=t.activeTrack(),f=t.activeGroup(),p=(f.filter(N=>N.default)[0]||f[0]).id,E=t.tracks[p];if(o===E){r({error:{message:"Problem encountered loading the default audio track."}});return}it.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const N in t.tracks)t.tracks[N].enabled=t.tracks[N]===E;t.onTrackChanged()},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:t}}=e;it.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const r=t.activeTrack();r&&(r.mode="disabled"),t.onTrackChanged()}},am={AUDIO:(i,e,t)=>{if(!e)return;const{tech:r,requestOptions:o,segmentLoaders:{[i]:f}}=t;e.on("loadedmetadata",()=>{const p=e.media();f.playlist(p,o),(!r.paused()||p.endList&&r.preload()!=="none")&&f.load()}),e.on("loadedplaylist",()=>{f.playlist(e.media(),o),r.paused()||f.load()}),e.on("error",ph[i](i,t))},SUBTITLES:(i,e,t)=>{const{tech:r,requestOptions:o,segmentLoaders:{[i]:f},mediaTypes:{[i]:p}}=t;e.on("loadedmetadata",()=>{const E=e.media();f.playlist(E,o),f.track(p.activeTrack()),(!r.paused()||E.endList&&r.preload()!=="none")&&f.load()}),e.on("loadedplaylist",()=>{f.playlist(e.media(),o),r.paused()||f.load()}),e.on("error",ph[i](i,t))}},xT={AUDIO:(i,e)=>{const{vhs:t,sourceType:r,segmentLoaders:{[i]:o},requestOptions:f,main:{mediaGroups:p},mediaTypes:{[i]:{groups:E,tracks:N,logger_:$}},mainPlaylistLoader:he}=e,Te=Cc(he.main);(!p[i]||Object.keys(p[i]).length===0)&&(p[i]={main:{default:{default:!0}}},Te&&(p[i].main.default.playlists=he.main.playlists));for(const we in p[i]){E[we]||(E[we]=[]);for(const Me in p[i][we]){let Ge=p[i][we][Me],ke;if(Te?($(`AUDIO group '${we}' label '${Me}' is a main playlist`),Ge.isMainPlaylist=!0,ke=null):r==="vhs-json"&&Ge.playlists?ke=new mu(Ge.playlists[0],t,f):Ge.resolvedUri?ke=new mu(Ge.resolvedUri,t,f):Ge.playlists&&r==="dash"?ke=new ep(Ge.playlists[0],t,f,he):ke=null,Ge=yi({id:Me,playlistLoader:ke},Ge),am[i](i,Ge.playlistLoader,e),E[we].push(Ge),typeof N[Me]>"u"){const qe=new it.AudioTrack({id:Me,kind:_T(Ge),enabled:!1,language:Ge.language,default:Ge.default,label:Me});N[Me]=qe}}}o.on("error",ph[i](i,e))},SUBTITLES:(i,e)=>{const{tech:t,vhs:r,sourceType:o,segmentLoaders:{[i]:f},requestOptions:p,main:{mediaGroups:E},mediaTypes:{[i]:{groups:N,tracks:$}},mainPlaylistLoader:he}=e;for(const Te in E[i]){N[Te]||(N[Te]=[]);for(const we in E[i][Te]){if(!r.options_.useForcedSubtitles&&E[i][Te][we].forced)continue;let Me=E[i][Te][we],Ge;if(o==="hls")Ge=new mu(Me.resolvedUri,r,p);else if(o==="dash"){if(!Me.playlists.filter(qe=>qe.excludeUntil!==1/0).length)return;Ge=new ep(Me.playlists[0],r,p,he)}else o==="vhs-json"&&(Ge=new mu(Me.playlists?Me.playlists[0]:Me.resolvedUri,r,p));if(Me=yi({id:we,playlistLoader:Ge},Me),am[i](i,Me.playlistLoader,e),N[Te].push(Me),typeof $[we]>"u"){const ke=t.addRemoteTextTrack({id:we,kind:"subtitles",default:Me.default&&Me.autoselect,language:Me.language,label:we},!1).track;$[we]=ke}}}f.on("error",ph[i](i,e))},"CLOSED-CAPTIONS":(i,e)=>{const{tech:t,main:{mediaGroups:r},mediaTypes:{[i]:{groups:o,tracks:f}}}=e;for(const p in r[i]){o[p]||(o[p]=[]);for(const E in r[i][p]){const N=r[i][p][E];if(!/^(?:CC|SERVICE)/.test(N.instreamId))continue;const $=t.options_.vhs&&t.options_.vhs.captionServices||{};let he={label:E,language:N.language,instreamId:N.instreamId,default:N.default&&N.autoselect};if($[he.instreamId]&&(he=yi(he,$[he.instreamId])),he.default===void 0&&delete he.default,o[p].push(yi({id:E},N)),typeof f[E]>"u"){const Te=t.addRemoteTextTrack({id:he.instreamId,kind:"captions",default:he.default,language:he.language,label:he.label},!1).track;f[E]=Te}}}}},om=(i,e)=>{for(let t=0;t<i.length;t++)if(zf(e,i[t])||i[t].playlists&&om(i[t].playlists,e))return!0;return!1},CT=(i,e)=>t=>{const{mainPlaylistLoader:r,mediaTypes:{[i]:{groups:o}}}=e,f=r.media();if(!f)return null;let p=null;f.attributes[i]&&(p=o[f.attributes[i]]);const E=Object.keys(o);if(!p)if(i==="AUDIO"&&E.length>1&&Cc(e.main))for(let N=0;N<E.length;N++){const $=o[E[N]];if(om($,f)){p=$;break}}else o.main?p=o.main:E.length===1&&(p=o[E[0]]);return typeof t>"u"?p:t===null||!p?null:p.filter(N=>N.id===t.id)[0]||null},kT={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const r in t)if(t[r].enabled)return t[r];return null},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const r in t)if(t[r].mode==="showing"||t[r].mode==="hidden")return t[r];return null}},DT=(i,{mediaTypes:e})=>()=>{const t=e[i].activeTrack();return t?e[i].activeGroup(t):null},wT=i=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach($=>{xT[$]($,i)});const{mediaTypes:e,mainPlaylistLoader:t,tech:r,vhs:o,segmentLoaders:{["AUDIO"]:f,main:p}}=i;["AUDIO","SUBTITLES"].forEach($=>{e[$].activeGroup=CT($,i),e[$].activeTrack=kT[$]($,i),e[$].onGroupChanged=bT($,i),e[$].onGroupChanging=AT($,i),e[$].onTrackChanged=ST($,i),e[$].getActiveGroup=DT($,i)});const E=e.AUDIO.activeGroup();if(E){const $=(E.filter(Te=>Te.default)[0]||E[0]).id;e.AUDIO.tracks[$].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(p.setAudio(!1),f.setAudio(!0)):p.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach($=>e[$].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach($=>e[$].onGroupChanging())});const N=()=>{e.AUDIO.onTrackChanged(),r.trigger({type:"usage",name:"vhs-audio-change"})};r.audioTracks().addEventListener("change",N),r.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),o.on("dispose",()=>{r.audioTracks().removeEventListener("change",N),r.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),r.clearTracks("audio");for(const $ in e.AUDIO.tracks)r.audioTracks().addTrack(e.AUDIO.tracks[$])},LT=()=>{const i={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{i[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Wa,activeTrack:Wa,getActiveGroup:Wa,onGroupChanged:Wa,onTrackChanged:Wa,lastTrack_:null,logger_:ds(`MediaGroups[${e}]`)}}),i};class lm{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){e===1&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=Nn(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(t=>[t.ID,t])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class IT extends it.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new lm,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=ds("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const r=t.serverUri||t.serverURL;if(!r){this.logger_(`steering manifest URL is ${r}, cannot request steering manifest.`),this.trigger("error");return}if(r.startsWith("data:")){this.decodeDataUriManifest_(r.substring(r.indexOf(",")+1));return}this.steeringManifest.reloadUri=Nn(e,r),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering")}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const r=e?t:this.getRequestURI(t);if(!r){this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),this.dispose();return}const o={contentSteeringInfo:{uri:r}};this.trigger({type:"contentsteeringloadstart",metadata:o}),this.request_=this.xhr_({uri:r,requestType:"content-steering-manifest"},(f,p)=>{if(f){if(p.status===410){this.logger_(`manifest request 410 ${f}.`),this.logger_(`There will be no more content steering requests to ${r} this session.`),this.excludedSteeringManifestURLs.add(r);return}if(p.status===429){const $=p.responseHeaders["retry-after"];this.logger_(`manifest request 429 ${f}.`),this.logger_(`content steering will retry in ${$} seconds.`),this.startTTLTimeout_(parseInt($,10));return}this.logger_(`manifest failed to load ${f}.`),this.startTTLTimeout_();return}this.trigger({type:"contentsteeringloadcomplete",metadata:o});let E;try{E=JSON.parse(this.request_.responseText)}catch($){const he={errorType:it.Error.StreamingContentSteeringParserError,error:$};this.trigger({type:"error",metadata:he})}this.assignSteeringProperties_(E);const N={contentSteeringInfo:o.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:N}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new window.URL(e),r=new window.URL(this.proxyServerUrl_);return r.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(r.toString())}decodeDataUriManifest_(e){const t=JSON.parse(window.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new window.URL(e),r=this.getPathway(),o=this.getBandwidth_();if(r){const f=`_${this.manifestType_}_pathway`;t.searchParams.set(f,r)}if(o){const f=`_${this.manifestType_}_throughput`;t.searchParams.set(f,o)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version){this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),this.trigger("error");return}this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const r=(o=>{for(const f of o)if(this.availablePathways_.has(f))return f;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==r&&(this.currentPathway=r,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=o=>this.excludedSteeringManifestURLs.has(o);if(this.proxyServerUrl_){const o=this.setProxyServerUrl_(e);if(!t(o))return o}const r=this.setSteeringParams_(e);return t(r)?null:r}startTTLTimeout_(e=this.steeringManifest.ttl){const t=e*1e3;this.ttlTimeout_=window.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){window.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new lm}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(Nn(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const RT=10;let za;const PT=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],OT=function(i){return this.audioSegmentLoader_[i]+this.mainSegmentLoader_[i]},MT=function({currentPlaylist:i,buffered:e,currentTime:t,nextPlaylist:r,bufferLowWaterLine:o,bufferHighWaterLine:f,duration:p,bufferBasedABR:E,log:N}){if(!r)return it.log.warn("We received no playlist to switch to. Please check your stream."),!1;const $=`allowing switch ${i&&i.id||"null"} -> ${r.id}`;if(!i)return N(`${$} as current playlist is not set`),!0;if(r.id===i.id)return!1;const he=!!fu(e,t).length;if(!i.endList)return!he&&typeof i.partTargetDuration=="number"?(N(`not ${$} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(N(`${$} as current playlist is live`),!0);const Te=jf(e,t),we=E?Vr.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:Vr.MAX_BUFFER_LOW_WATER_LINE;if(p<we)return N(`${$} as duration < max low water line (${p} < ${we})`),!0;const Me=r.attributes.BANDWIDTH,Ge=i.attributes.BANDWIDTH;if(Me<Ge&&(!E||Te<f)){let ke=`${$} as next bandwidth < current bandwidth (${Me} < ${Ge})`;return E&&(ke+=` and forwardBuffer < bufferHighWaterLine (${Te} < ${f})`),N(ke),!0}if((!E||Me>Ge)&&Te>=o){let ke=`${$} as forwardBuffer >= bufferLowWaterLine (${Te} >= ${o})`;return E&&(ke+=` and next bandwidth > current bandwidth (${Me} > ${Ge})`),N(ke),!0}return N(`not ${$} as no switching criteria met`),!1};class NT extends it.EventTarget{constructor(e){super();const{src:t,withCredentials:r,tech:o,bandwidth:f,externVhs:p,useCueTags:E,playlistExclusionDuration:N,enableLowInitialPlaylist:$,sourceType:he,cacheEncryptionKeys:Te,bufferBasedABR:we,leastPixelDiffSelector:Me,captionServices:Ge,experimentalUseMMS:ke}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:qe}=e;(qe===null||typeof qe>"u")&&(qe=1/0),za=p,this.bufferBasedABR=!!we,this.leastPixelDiffSelector=!!Me,this.withCredentials=r,this.tech_=o,this.vhs_=o.vhs,this.player_=e.player_,this.sourceType_=he,this.useCueTags_=E,this.playlistExclusionDuration=N,this.maxPlaylistRetries=qe,this.enableLowInitialPlaylist=$,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:r,maxPlaylistRetries:qe,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=LT(),ke&&window.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new window.ManagedMediaSource,it.log("Using ManagedMediaSource")):window.MediaSource&&(this.mediaSource=new window.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.seekable_=Zr(),this.hasPlayed_=!1,this.syncController_=new vT(e),this.segmentMetadataTrack_=o.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.decrypter_=new ET,this.sourceUpdater_=new Zg(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new yT,this.keyStatusMap_=new Map;const $e={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:Ge,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:f,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:Te,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_=this.sourceType_==="dash"?new ep(t,this.vhs_,yi(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new mu(t,this.vhs_,yi(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new ap(yi($e,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new ap(yi($e,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new hT(yi($e,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((st,We)=>{function dt(){o.off("vttjserror",Dt),st()}function Dt(){o.off("vttjsloaded",dt),We()}o.one("vttjsloaded",dt),o.one("vttjserror",Dt),o.addWebVttScript_()})}),e);const tt=()=>this.mainSegmentLoader_.bandwidth;this.contentSteeringController_=new IT(this.vhs_.xhr,tt),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),PT.forEach(st=>{this[st+"_"]=OT.bind(this,st)}),this.logger_=ds("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const Je=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(Je,()=>{const st=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-st,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,r){const o=this.media(),f=o&&(o.id||o.uri),p=e&&(e.id||e.uri);if(f&&f!==p){this.logger_(`switch media ${f} -> ${p} from ${t}`);const E={renditionInfo:{id:p,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:E}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,r)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],r=t?t.activeGroup():null,o=this.contentSteeringController_.getPathway();if(r&&o){const p=(r.length?r[0].playlists:r.playlists).filter(E=>E.attributes.serviceLocation===o);p.length&&this.mediaTypes_[e].activePlaylistLoader.media(p[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=window.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(window.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const r=e.mediaGroups.AUDIO,o=Object.keys(r);let f;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)f=this.mediaTypes_.AUDIO.activeTrack();else{const E=r.main||o.length&&r[o[0]];for(const N in E)if(E[N].default){f={label:N};break}}if(!f)return t;const p=[];for(const E in r)if(r[E][f.label]){const N=r[E][f.label];if(N.playlists&&N.playlists.length)p.push.apply(p,N.playlists);else if(N.uri)p.push(N);else if(e.playlists.length)for(let $=0;$<e.playlists.length;$++){const he=e.playlists[$];he.attributes&&he.attributes.AUDIO&&he.attributes.AUDIO===E&&p.push(he)}}return p.length?p:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const t=this.mainPlaylistLoader_.media(),r=t.targetDuration*1.5*1e3;Wf(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=r,t.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.mainSegmentLoader_.load()),wT({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),t),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let t=this.mainPlaylistLoader_.media();if(!t){this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_();let r;if(this.enableLowInitialPlaylist&&(r=this.selectInitialPlaylist()),r||(r=this.selectPlaylist()),!r||!this.shouldSwitchToMedia_(r)||(this.initialMedia_=r,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;t=this.initialMedia_}this.handleUpdatedMediaPlaylist(t)}),this.mainPlaylistLoader_.on("error",()=>{const t=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const t=this.mainPlaylistLoader_.media(),r=t.targetDuration*1.5*1e3;Wf(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=r,this.sourceType_==="dash"&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const t=this.mainPlaylistLoader_.media();if(t.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(t)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}),["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(t=>{this.mainPlaylistLoader_.on(t,r=>{this.player_.trigger(Hi({},r))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const r=e.mediaGroups||{};let o=!0;const f=Object.keys(r.AUDIO);for(const p in r.AUDIO)for(const E in r.AUDIO[p])r.AUDIO[p][E].uri||(o=!1);o&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(r.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),za.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),f.length&&Object.keys(r.AUDIO[f[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,r=this.tech_.currentTime(),o=this.bufferLowWaterLine(),f=this.bufferHighWaterLine(),p=this.tech_.buffered();return MT({buffered:p,currentTime:r,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:o,bufferHighWaterLine:f,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const r=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:r.playlist,error:r})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const r=this.audioSegmentLoader_.pendingSegment_;if(!r||!r.segment||!r.segment.syncInfo)return;const o=r.segment.syncInfo.end+.01;this.tech_.setCurrentTime(o)}),this.mainSegmentLoader_.on("earlyabort",r=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:RT}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const r=this.getCodecsOrExclude_();r&&this.sourceUpdater_.addOrChangeSourceBuffers(r)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}),["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(r=>{this.mainSegmentLoader_.on(r,o=>{this.player_.trigger(Hi({},o))}),this.audioSegmentLoader_.on(r,o=>{this.player_.trigger(Hi({},o))}),this.subtitleSegmentLoader_.on(r,o=>{this.player_.trigger(Hi({},o))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}fastQualityChange_(e=this.selectPlaylist()){if(e&&e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(()=>{this.mainSegmentLoader_.load()})}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const r=t.end(0);let o=r;if(e.start){const f=e.start.timeOffset;f<0?o=Math.max(r+f,t.start(0)):o=Math.min(r,f)}this.trigger("firstplay"),this.tech_.setCurrentTime(o)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const r=this.syncController_.getExpiredTime(e,this.duration());if(r===null)return!1;const o=za.Playlist.playlistEnd(e,r),f=this.tech_.currentTime(),p=this.tech_.buffered();if(!p.length)return o-f<=ma;const E=p.end(p.length-1);return E-f<=ma&&o-E<=ma}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:r}){if(e=e||this.mainPlaylistLoader_.media(),r=r||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const o=this.mainPlaylistLoader_.main.playlists,f=o.filter(lh),p=f.length===1&&f[0]===e;if(o.length===1&&r!==1/0)return it.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(p);if(p){if(this.main().contentSteering){const Ge=this.pathwayAttribute_(e),ke=this.contentSteeringController_.steeringManifest.ttl*1e3;this.contentSteeringController_.excludePathway(Ge),this.excludeThenChangePathway_(),setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(Ge)},ke);return}let Me=!1;o.forEach(Ge=>{if(Ge===e)return;const ke=Ge.excludeUntil;typeof ke<"u"&&ke!==1/0&&(Me=!0,delete Ge.excludeUntil)}),Me&&(it.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let E;e.playlistErrors_>this.maxPlaylistRetries?E=1/0:E=Date.now()+r*1e3,e.excludeUntil=E,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const N=this.selectPlaylist();if(!N){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const $=t.internal?this.logger_:it.log.warn,he=t.message?" "+t.message:"";$(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${he} Switching to playlist ${N.id}.`),N.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),N.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const Te=N.targetDuration/2*1e3||5*1e3,we=typeof N.lastRequest=="number"&&Date.now()-N.lastRequest<=Te;return this.switchMedia_(N,"exclude",p||we)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const r=[],o=e==="all";(o||e==="main")&&r.push(this.mainPlaylistLoader_);const f=[];(o||e==="audio")&&f.push("AUDIO"),(o||e==="subtitle")&&(f.push("CLOSED-CAPTIONS"),f.push("SUBTITLES")),f.forEach(p=>{const E=this.mediaTypes_[p]&&this.mediaTypes_[p].activePlaylistLoader;E&&r.push(E)}),["main","audio","subtitle"].forEach(p=>{const E=this[`${p}SegmentLoader_`];E&&(e===p||e==="all")&&r.push(E)}),r.forEach(p=>t.forEach(E=>{typeof p[E]=="function"&&p[E]()}))}setCurrentTime(e){const t=fu(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:za.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}onSyncInfoUpdate_(){let e;if(!this.mainPlaylistLoader_)return;let t=this.mainPlaylistLoader_.media();if(!t)return;let r=this.syncController_.getExpiredTime(t,this.duration());if(r===null)return;const o=this.mainPlaylistLoader_.main,f=za.Playlist.seekable(t,r,za.Playlist.liveEdgeDelay(o,t));if(f.length===0||this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),r=this.syncController_.getExpiredTime(t,this.duration()),r===null||(e=za.Playlist.seekable(t,r,za.Playlist.liveEdgeDelay(o,t)),e.length===0)))return;let p,E;if(this.seekable_&&this.seekable_.length&&(p=this.seekable_.end(0),E=this.seekable_.start(0)),e?e.start(0)>f.end(0)||f.start(0)>e.end(0)?this.seekable_=f:this.seekable_=Zr([[e.start(0)>f.start(0)?e.start(0):f.start(0),e.end(0)<f.end(0)?e.end(0):f.end(0)]]):this.seekable_=f,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===p&&this.seekable_.start(0)===E)return;this.logger_(`seekable updated [${Zp(this.seekable_)}]`);const N={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:N}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const o=this.seekable();if(!o.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<o.end(o.length-1))&&this.sourceUpdater_.setDuration(o.end(o.length-1));return}const t=this.tech_.buffered();let r=za.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(r=Math.max(r,t.end(t.length-1))),this.mediaSource.duration!==r&&this.sourceUpdater_.setDuration(r)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const r in t)t[r].forEach(o=>{o.playlistLoader&&o.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),r=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!r)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const r=Dc(this.main(),t),o={},f=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(o.video=r.video||e.main.videoCodec||Br),e.main.isMuxed&&(o.video+=`,${r.audio||e.main.audioCodec||En}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||f)&&(o.audio=r.audio||e.main.audioCodec||e.audio.audioCodec||En,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!o.audio&&!o.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const p=($,he)=>$?da(he):eu(he),E={};let N;if(["video","audio"].forEach(function($){if(o.hasOwnProperty($)&&!p(e[$].isFmp4,o[$])){const he=e[$].isFmp4?"browser":"muxer";E[he]=E[he]||[],E[he].push(o[$]),$==="audio"&&(N=he)}}),f&&N&&t.attributes.AUDIO){const $=t.attributes.AUDIO;this.main().playlists.forEach(he=>{(he.attributes&&he.attributes.AUDIO)===$&&he!==t&&(he.excludeUntil=1/0)}),this.logger_(`excluding audio group ${$} as ${N} does not support codec(s): "${o.audio}"`)}if(Object.keys(E).length){const $=Object.keys(E).reduce((he,Te)=>(he&&(he+=", "),he+=`${Te} does not support codec(s): "${E[Te].join(",")}"`,he),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:$},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const $=[];if(["video","audio"].forEach(he=>{const Te=(Yn(this.sourceUpdater_.codecs[he]||"")[0]||{}).type,we=(Yn(o[he]||"")[0]||{}).type;Te&&we&&Te.toLowerCase()!==we.toLowerCase()&&$.push(`"${this.sourceUpdater_.codecs[he]}" -> "${o[he]}"`)}),$.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${$.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return o}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(r=>{const o=e[r];if(t.indexOf(o.id)!==-1)return;t.push(o.id);const f=Dc(this.main,o),p=[];f.audio&&!eu(f.audio)&&!da(f.audio)&&p.push(`audio codec ${f.audio}`),f.video&&!eu(f.video)&&!da(f.video)&&p.push(`video codec ${f.video}`),f.text&&f.text==="stpp.ttml.im1t"&&p.push(`text codec ${f.text}`),p.length&&(o.excludeUntil=1/0,this.logger_(`excluding ${o.id} for unsupported: ${p.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],r=this.main().playlists,o=ch(Yn(e)),f=Vg(o),p=o.video&&Yn(o.video)[0]||null,E=o.audio&&Yn(o.audio)[0]||null;Object.keys(r).forEach(N=>{const $=r[N];if(t.indexOf($.id)!==-1||$.excludeUntil===1/0)return;t.push($.id);const he=[],Te=Dc(this.mainPlaylistLoader_.main,$),we=Vg(Te);if(!(!Te.audio&&!Te.video)){if(we!==f&&he.push(`codec count "${we}" !== "${f}"`),!this.sourceUpdater_.canChangeType()){const Me=Te.video&&Yn(Te.video)[0]||null,Ge=Te.audio&&Yn(Te.audio)[0]||null;Me&&p&&Me.type.toLowerCase()!==p.type.toLowerCase()&&he.push(`video codec "${Me.type}" !== "${p.type}"`),Ge&&E&&Ge.type.toLowerCase()!==E.type.toLowerCase()&&he.push(`audio codec "${Ge.type}" !== "${E.type}"`)}he.length&&($.excludeUntil=1/0,this.logger_(`excluding ${$.id}: ${he.join(" && ")}`))}})}updateAdCues_(e){let t=0;const r=this.seekable();r.length&&(t=r.start(0)),pT(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=Vr.GOAL_BUFFER_LENGTH,r=Vr.GOAL_BUFFER_LENGTH_RATE,o=Math.max(t,Vr.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*r,o)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=Vr.BUFFER_LOW_WATER_LINE,r=Vr.BUFFER_LOW_WATER_LINE_RATE,o=Math.max(t,Vr.MAX_BUFFER_LOW_WATER_LINE),f=Math.max(t,Vr.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*r,this.bufferBasedABR?f:o)}bufferHighWaterLine(){return Vr.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){$g(this.inbandTextTracks_,"com.apple.streaming",this.tech_),$y({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,r){const o=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();$g(this.inbandTextTracks_,e,this.tech_),jy({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:o,videoDuration:r})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));if(this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart){this.contentSteeringController_.requestSteeringManifest(!0);return}this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(t=>{this.contentSteeringController_.on(t,r=>{this.trigger(Hi({},r))})}),this.sourceType_==="dash"&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const t=this.main();(this.contentSteeringController_.didDASHTagChange(t.uri,t.contentSteering)||(()=>{const f=this.contentSteeringController_.getAvailablePathways(),p=[];for(const E of t.playlists){const N=E.attributes.serviceLocation;if(N&&(p.push(N),!f.has(N)))return!0}return!!(!p.length&&f.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const r=this.main().playlists,o=new Set;let f=!1;Object.keys(r).forEach(p=>{const E=r[p],N=this.pathwayAttribute_(E),$=N&&e!==N;E.excludeUntil===1/0&&E.lastExcludeReason_==="content-steering"&&!$&&(delete E.excludeUntil,delete E.lastExcludeReason_,f=!0);const Te=!E.excludeUntil&&E.excludeUntil!==1/0;!o.has(E.id)&&$&&Te&&(o.add(E.id),E.excludeUntil=1/0,E.lastExcludeReason_="content-steering",this.logger_(`excluding ${E.id} for ${E.lastExcludeReason_}`))}),this.contentSteeringController_.manifestType_==="DASH"&&Object.keys(this.mediaTypes_).forEach(p=>{const E=this.mediaTypes_[p];if(E.activePlaylistLoader){const N=E.activePlaylistLoader.media_;N&&N.attributes.serviceLocation!==e&&(f=!0)}}),f&&this.changeSegmentPathway_()}handlePathwayClones_(){const t=this.main().playlists,r=this.contentSteeringController_.currentPathwayClones,o=this.contentSteeringController_.nextPathwayClones;if(r&&r.size||o&&o.size){for(const[p,E]of r.entries())o.get(p)||(this.mainPlaylistLoader_.updateOrDeleteClone(E),this.contentSteeringController_.excludePathway(p));for(const[p,E]of o.entries()){const N=r.get(p);if(!N){t.filter(he=>he.attributes["PATHWAY-ID"]===E["BASE-ID"]).forEach(he=>{this.mainPlaylistLoader_.addClonePathway(E,he)}),this.contentSteeringController_.addAvailablePathway(p);continue}this.equalPathwayClones_(N,E)||(this.mainPlaylistLoader_.updateOrDeleteClone(E,!0),this.contentSteeringController_.addAvailablePathway(p))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...o])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const r=e["URI-REPLACEMENT"].PARAMS,o=t["URI-REPLACEMENT"].PARAMS;for(const f in r)if(r[f]!==o[f])return!1;for(const f in o)if(r[f]!==o[f])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),this.contentSteeringController_.manifestType_==="DASH"&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(r=>{const o=this.mainPlaylistLoader_.getKeyIdSet(r);!o||!o.size||o.forEach(f=>{const p="usable",E=this.keyStatusMap_.has(f)&&this.keyStatusMap_.get(f)===p,N=r.lastExcludeReason_===t&&r.excludeUntil===1/0;E?E&&N&&(delete r.excludeUntil,delete r.lastExcludeReason_,this.logger_(`enabling playlist ${r.id} because key ID ${f} is ${p}`)):(r.excludeUntil!==1/0&&r.lastExcludeReason_!==t&&(r.excludeUntil=1/0,r.lastExcludeReason_=t,this.logger_(`excluding playlist ${r.id} because the key ID ${f} doesn't exist in the keyStatusMap or is not ${p}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(r=>{const o=r&&r.attributes&&r.attributes.RESOLUTION&&r.attributes.RESOLUTION.height<720,f=r.excludeUntil===1/0&&r.lastExcludeReason_===t;o&&f&&(delete r.excludeUntil,it.log.warn(`enabling non-HD playlist ${r.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const f=(typeof e=="string"?e:cT(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${f} added to the keyStatusMap`),this.keyStatusMap_.set(f,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const FT=(i,e,t)=>r=>{const o=i.main.playlists[e],f=$f(o),p=lh(o);if(typeof r>"u")return p;r?delete o.disabled:o.disabled=!0;const E={renditionInfo:{id:e,bandwidth:o.attributes.BANDWIDTH,resolution:o.attributes.RESOLUTION,codecs:o.attributes.CODECS},cause:"fast-quality"};return r!==p&&!f&&(t(o),r?i.trigger({type:"renditionenabled",metadata:E}):i.trigger({type:"renditiondisabled",metadata:E})),r};class BT{constructor(e,t,r){const{playlistController_:o}=e,f=o.fastQualityChange_.bind(o);if(t.attributes){const p=t.attributes.RESOLUTION;this.width=p&&p.width,this.height=p&&p.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=Dc(o.main(),t),this.playlist=t,this.id=r,this.enabled=FT(e.playlists,t.id,f)}}const UT=function(i){i.representations=()=>{const e=i.playlistController_.main(),t=Cc(e)?i.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(r=>!$f(r)).map((r,o)=>new BT(i,r,r.id)):[]}},um=["seeking","seeked","pause","playing","error"];class GT extends it.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=ds("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),r=()=>this.monitorCurrentTime_(),o=()=>this.techWaiting_(),f=()=>this.resetTimeUpdate_(),p=this.playlistController_,E=["main","subtitle","audio"],N={};E.forEach(he=>{N[he]={reset:()=>this.resetSegmentDownloads_(he),updateend:()=>this.checkSegmentDownloads_(he)},p[`${he}SegmentLoader_`].on("appendsdone",N[he].updateend),p[`${he}SegmentLoader_`].on("playlistupdate",N[he].reset),this.tech_.on(["seeked","seeking"],N[he].reset)});const $=he=>{["main","audio"].forEach(Te=>{p[`${Te}SegmentLoader_`][he]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),$("off"))},this.clearSeekingAppendCheck_=()=>$("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),$("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",o),this.tech_.on(um,f),this.tech_.on("canplay",r),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",o),this.tech_.off(um,f),this.tech_.off("canplay",r),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),E.forEach(he=>{p[`${he}SegmentLoader_`].off("appendsdone",N[he].updateend),p[`${he}SegmentLoader_`].off("playlistupdate",N[he].reset),this.tech_.off(["seeked","seeking"],N[he].reset)}),this.checkCurrentTimeTimeout_&&window.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&window.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=window.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,r=t[`${e}SegmentLoader_`],o=r.buffered_(),f=w0(this[`${e}Buffered_`],o);if(this[`${e}Buffered_`]=o,f){const p={bufferedRanges:o};t.trigger({type:"bufferedrangeschanged",metadata:p}),this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:r.playlist_&&r.playlist_.id,buffered:al(o)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+ma>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(Zr([this.lastRecordedTime,e]));const r={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:r}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),r=this.tech_.currentTime(),o=this.afterSeekableWindow_(t,r,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let f;if(o&&(f=t.end(t.length-1)),this.beforeSeekableWindow_(t,r)){const Ge=t.start(0);f=Ge+(Ge===t.end(0)?0:ma)}if(typeof f<"u")return this.logger_(`Trying to seek outside of seekable at time ${r} with seekable range ${Zp(t)}. Seeking to ${f}.`),this.tech_.setCurrentTime(f),!0;const p=this.playlistController_.sourceUpdater_,E=this.tech_.buffered(),N=p.audioBuffer?p.audioBuffered():null,$=p.videoBuffer?p.videoBuffered():null,he=this.media(),Te=he.partTargetDuration?he.partTargetDuration:(he.targetDuration-ga)*2,we=[N,$];for(let Ge=0;Ge<we.length;Ge++){if(!we[Ge])continue;if(jf(we[Ge],r)<Te)return!1}const Me=oh(E,r);return Me.length===0?!1:(f=Me.start(0)+ma,this.logger_(`Buffered region starts (${Me.start(0)})  just beyond seek point (${r}). Seeking to ${f}.`),this.tech_.setCurrentTime(f),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),r=fu(t,e);if(r.length&&e+3<=r.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${r.start(0)} -> ${r.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const E=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${E}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(E),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const r=this.tech_.vhs.playlistController_.sourceUpdater_,o=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:r.audioBuffered(),videoBuffered:r.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const p=oh(o,t);return p.length>0?(this.logger_(`Stopped at ${t} and seeking to ${p.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,r,o=!1){if(!e.length)return!1;let f=e.end(e.length-1)+ma;const p=!r.endList,E=typeof r.partTargetDuration=="number";return p&&(E||o)&&(f=e.end(e.length-1)+r.targetDuration*3),t>f}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:r}){if(!e)return;let o;if(e.length&&t.length){const f=fu(e,r-3),p=fu(e,r),E=fu(t,r);E.length&&!p.length&&f.length&&(o={start:f.end(0),end:E.end(0)})}else oh(e,r).length||(o=this.gapFromVideoUnderflow_(e,r));return o?(this.logger_(`Encountered a gap in video from ${o.start} to ${o.end}. Seeking to current time ${r}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),r=this.tech_.currentTime(),o=oh(t,r);if(this.resetTimeUpdate_(),o.length===0||r!==e)return;this.logger_("skipTheGap_:","currentTime:",r,"scheduled currentTime:",e,"nextRange start:",o.start(0)),this.tech_.setCurrentTime(o.start(0)+ga);const f={gapInfo:{from:r,to:o.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:f}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const r=C0(e);for(let o=0;o<r.length;o++){const f=r.start(o),p=r.end(o);if(t-f<4&&t-f>2)return{start:f,end:p}}return null}}const VT={errorInterval:30,getSource(i){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return i(t)}},cm=function(i,e){let t=0,r=0;const o=yi(VT,e);i.ready(()=>{i.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const f=function(){r&&i.currentTime(r)},p=function(he){he!=null&&(r=i.duration()!==1/0&&i.currentTime()||0,i.one("loadedmetadata",f),i.src(he),i.trigger({type:"usage",name:"vhs-error-reload"}),i.play())},E=function(){if(Date.now()-t<o.errorInterval*1e3){i.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!o.getSource||typeof o.getSource!="function"){it.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),o.getSource.call(i,p)},N=function(){i.off("loadedmetadata",f),i.off("error",E),i.off("dispose",N)},$=function(he){N(),cm(i,he)};i.on("error",E),i.on("dispose",N),i.reloadSourceOnError=$},HT=function(i){cm(this,i)};var dm="3.14.2",jT="7.0.3",KT="1.3.0",qT="7.2.0",$T="4.0.2";const nr={PlaylistLoader:mu,Playlist:Fn,utils:Q0,STANDARD_PLAYLIST_SELECTOR:Kg,INITIAL_PLAYLIST_SELECTOR:By,lastBandwidthSelector:Kg,movingAverageBandwidthSelector:Ny,comparePlaylistBandwidth:np,comparePlaylistResolution:My,xhr:Tg()};Object.keys(Vr).forEach(i=>{Object.defineProperty(nr,i,{get(){return it.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),Vr[i]},set(e){if(it.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){it.log.warn(`value of Vhs.${i} must be greater than or equal to 0`);return}Vr[i]=e}})});const hm="videojs-vhs",fm=function(i,e){const t=e.media();let r=-1;for(let o=0;o<i.length;o++)if(i[o].id===t.id){r=o;break}i.selectedIndex_=r,i.trigger({selectedIndex:r,type:"change"})},WT=function(i,e){e.representations().forEach(t=>{i.addQualityLevel(t)}),fm(i,e.playlists)};nr.canPlaySource=function(){return it.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const zT=(i,e,t)=>{if(!i)return i;let r={};e&&e.attributes&&e.attributes.CODECS&&(r=ch(Yn(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(r.audio=t.attributes.CODECS);const o=To(r.video),f=To(r.audio),p={};for(const E in i)p[E]={},f&&(p[E].audioContentType=f),o&&(p[E].videoContentType=o),e.contentProtection&&e.contentProtection[E]&&e.contentProtection[E].pssh&&(p[E].pssh=e.contentProtection[E].pssh),typeof i[E]=="string"&&(p[E].url=i[E]);return yi(i,p)},YT=(i,e)=>i.reduce((t,r)=>{if(!r.contentProtection)return t;const o=e.reduce((f,p)=>{const E=r.contentProtection[p];return E&&E.pssh&&(f[p]={pssh:E.pssh}),f},{});return Object.keys(o).length&&t.push(o),t},[]),XT=({player:i,sourceKeySystems:e,audioMedia:t,mainPlaylists:r})=>{if(!i.eme.initializeMediaKeys)return Promise.resolve();const o=t?r.concat([t]):r,f=YT(o,Object.keys(e)),p=[],E=[];return f.forEach(N=>{E.push(new Promise(($,he)=>{i.tech_.one("keysessioncreated",$)})),p.push(new Promise(($,he)=>{i.eme.initializeMediaKeys({keySystems:N},Te=>{if(Te){he(Te);return}$()})}))}),Promise.race([Promise.all(p),Promise.race(E)])},QT=({player:i,sourceKeySystems:e,media:t,audioMedia:r})=>{const o=zT(e,t,r);return o?(i.currentSource().keySystems=o,o&&!i.eme?(it.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},pm=()=>{if(!window.localStorage)return null;const i=window.localStorage.getItem(hm);if(!i)return null;try{return JSON.parse(i)}catch{return null}},JT=i=>{if(!window.localStorage)return!1;let e=pm();e=e?yi(e,i):i;try{window.localStorage.setItem(hm,JSON.stringify(e))}catch{return!1}return e},ZT=i=>i.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(i.substring(i.indexOf(",")+1)):i,gm=(i,e)=>{i._requestCallbackSet||(i._requestCallbackSet=new Set),i._requestCallbackSet.add(e)},mm=(i,e)=>{i._responseCallbackSet||(i._responseCallbackSet=new Set),i._responseCallbackSet.add(e)},vm=(i,e)=>{i._requestCallbackSet&&(i._requestCallbackSet.delete(e),i._requestCallbackSet.size||delete i._requestCallbackSet)},ym=(i,e)=>{i._responseCallbackSet&&(i._responseCallbackSet.delete(e),i._responseCallbackSet.size||delete i._responseCallbackSet)};nr.supportsNativeHls=function(){if(!document||!document.createElement)return!1;const i=document.createElement("video");return it.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(i.canPlayType(t))}):!1}(),nr.supportsNativeDash=function(){return!document||!document.createElement||!it.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(document.createElement("video").canPlayType("application/dash+xml"))}(),nr.supportsTypeNatively=i=>i==="hls"?nr.supportsNativeHls:i==="dash"?nr.supportsNativeDash:!1,nr.isSupported=function(){return it.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")},nr.xhr.onRequest=function(i){gm(nr.xhr,i)},nr.xhr.onResponse=function(i){mm(nr.xhr,i)},nr.xhr.offRequest=function(i){vm(nr.xhr,i)},nr.xhr.offResponse=function(i){ym(nr.xhr,i)};const eE=it.getComponent("Component");class Tm extends eE{constructor(e,t,r){if(super(t,r.vhs),typeof r.initialBandwidth=="number"&&(this.options_.bandwidth=r.initialBandwidth),this.logger_=ds("VhsHandler"),t.options_&&t.options_.playerId){const o=it.getPlayer(t.options_.playerId);this.player_=o}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],o=>{const f=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;f&&f.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=yi(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const r=pm();r&&r.bandwidth&&(this.options_.bandwidth=r.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),r&&r.throughput&&(this.options_.throughput=r.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=Vr.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Vr.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(r=>{typeof this.source_[r]<"u"&&(this.options_[r]=this.source_[r])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio;const t=this.options_.customPixelRatio;typeof t=="number"&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=ZT(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=nr,this.options_.sourceType=Ka(t),this.options_.seekTo=f=>{this.tech_.setCurrentTime(f)},this.options_.player_=this.player_,this.playlistController_=new NT(this.options_);const r=yi({liveRangeSafeTimeDelta:ma},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new GT(r),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const f=it.players[this.tech_.options_.playerId];let p=this.playlistController_.error;typeof p=="object"&&!p.code?p.code=3:typeof p=="string"&&(p={message:p,code:3}),f.error(p)});const o=this.options_.bufferBasedABR?nr.movingAverageBandwidthSelector(.55):nr.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):o.bind(this),this.playlistController_.selectInitialPlaylist=nr.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(f){this.playlistController_.selectPlaylist=f.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(f){this.playlistController_.mainSegmentLoader_.throughput.rate=f,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let f=this.playlistController_.mainSegmentLoader_.bandwidth;const p=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection,E=1e7;if(this.options_.useNetworkInformationApi&&p){const N=p.downlink*1e3*1e3;N>=E&&f>=E?f=Math.max(f,N):f=N}return f},set(f){this.playlistController_.mainSegmentLoader_.bandwidth=f,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const f=1/(this.bandwidth||1);let p;return this.throughput>0?p=1/this.throughput:p=0,Math.floor(1/(f+p))},set(){it.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>al(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>al(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&JT({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{UT(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=window.URL.createObjectURL(this.playlistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),XT({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=QT({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",r=>{this.playlistController_.updatePlaylistByKeyStatus(r.keyId,r.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=it.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{WT(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{fm(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":dm,"mux.js":jT,"mpd-parser":KT,"m3u8-parser":qT,"aes-decrypter":$T}}version(){return this.constructor.version()}canChangeType(){return Zg.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&window.URL.revokeObjectURL&&(window.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return ny({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,r=!0,o=2){return Sg({programTime:e,playlist:this.playlistController_.media(),retryCount:o,pauseAfterSeek:r,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{gm(this.xhr,e)},this.xhr.onResponse=e=>{mm(this.xhr,e)},this.xhr.offRequest=e=>{vm(this.xhr,e)},this.xhr.offResponse=e=>{ym(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){const e=["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"],t=["gapjumped","playedrangeschanged"];e.forEach(r=>{this.playlistController_.on(r,o=>{this.player_.trigger(Hi({},o))})}),t.forEach(r=>{this.playbackWatcher_.on(r,o=>{this.player_.trigger(Hi({},o))})})}}const gh={name:"videojs-http-streaming",VERSION:dm,canHandleSource(i,e={}){const t=yi(it.options,e);return!t.vhs.experimentalUseMMS&&!da("avc1.4d400d,mp4a.40.2",!1)?!1:gh.canPlayType(i.type,t)},handleSource(i,e,t={}){const r=yi(it.options,t);return e.vhs=new Tm(i,e,r),e.vhs.xhr=Tg(),e.vhs.setupXhrHooks_(),e.vhs.src(i.src,i.type),e.vhs},canPlayType(i,e){const t=Ka(i);if(!t)return"";const r=gh.getOverrideNative(e);return!nr.supportsTypeNatively(t)||r?"maybe":""},getOverrideNative(i={}){const{vhs:e={}}=i,t=!(it.browser.IS_ANY_SAFARI||it.browser.IS_IOS),{overrideNative:r=t}=e;return r}};return da("avc1.4d400d,mp4a.40.2",!0)&&it.getTech("Html5").registerSourceHandler(gh,0),it.VhsHandler=Tm,it.VhsSourceHandler=gh,it.Vhs=nr,it.use||it.registerComponent("Vhs",nr),it.options.vhs=it.options.vhs||{},(!it.getPlugin||!it.getPlugin("reloadSourceOnError"))&&it.registerPlugin("reloadSourceOnError",HT),it}),function Un(or){(function(Hr,Ii){typeof exports=="object"&&typeof module<"u"?module.exports=Ii():typeof define=="function"&&define.amd?define(Ii):(Hr=typeof globalThis<"u"?globalThis:Hr||self,Hr.Hls=Ii())})(this,function(){"use strict";function Hr(d,u){var l=Object.keys(d);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(d);u&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(d,s).enumerable})),l.push.apply(l,n)}return l}function Ii(d){for(var u=1;u<arguments.length;u++){var l=arguments[u]!=null?arguments[u]:{};u%2?Hr(Object(l),!0).forEach(function(n){ai(d,n,l[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(l)):Hr(Object(l)).forEach(function(n){Object.defineProperty(d,n,Object.getOwnPropertyDescriptor(l,n))})}return d}function Ea(d,u){if(typeof d!="object"||!d)return d;var l=d[Symbol.toPrimitive];if(l!==void 0){var n=l.call(d,u||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(d)}function fs(d){var u=Ea(d,"string");return typeof u=="symbol"?u:String(u)}function ri(d,u){for(var l=0;l<u.length;l++){var n=u[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(d,fs(n.key),n)}}function ki(d,u,l){return u&&ri(d.prototype,u),l&&ri(d,l),Object.defineProperty(d,"prototype",{writable:!1}),d}function ai(d,u,l){return u=fs(u),u in d?Object.defineProperty(d,u,{value:l,enumerable:!0,configurable:!0,writable:!0}):d[u]=l,d}function Di(){return Di=Object.assign?Object.assign.bind():function(d){for(var u=1;u<arguments.length;u++){var l=arguments[u];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(d[n]=l[n])}return d},Di.apply(this,arguments)}function Bt(d,u){d.prototype=Object.create(u.prototype),d.prototype.constructor=d,Gn(d,u)}function hn(d){return hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},hn(d)}function Gn(d,u){return Gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Gn(d,u)}function zt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _a(d,u,l){return zt()?_a=Reflect.construct.bind():_a=function(s,a,c){var h=[null];h.push.apply(h,a);var g=Function.bind.apply(s,h),m=new g;return c&&Gn(m,c.prototype),m},_a.apply(null,arguments)}function $i(d){try{return Function.toString.call(d).indexOf("[native code]")!==-1}catch{return typeof d=="function"}}function js(d){var u=typeof Map=="function"?new Map:void 0;return js=function(n){if(n===null||!$i(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u<"u"){if(u.has(n))return u.get(n);u.set(n,s)}function s(){return _a(n,arguments,hn(this).constructor)}return s.prototype=Object.create(n.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Gn(s,n)},js(d)}function fn(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function Ja(d,u){if(d){if(typeof d=="string")return pr(d,u);var l=Object.prototype.toString.call(d).slice(8,-1);if(l==="Object"&&d.constructor&&(l=d.constructor.name),l==="Map"||l==="Set")return Array.from(d);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return pr(d,u)}}function pr(d,u){(u==null||u>d.length)&&(u=d.length);for(var l=0,n=new Array(u);l<u;l++)n[l]=d[l];return n}function es(d,u){var l=typeof Symbol<"u"&&d[Symbol.iterator]||d["@@iterator"];if(l)return(l=l.call(d)).next.bind(l);if(Array.isArray(d)||(l=Ja(d))||u&&d&&typeof d.length=="number"){l&&(d=l);var n=0;return function(){return n>=d.length?{done:!0}:{done:!1,value:d[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oi(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Za={exports:{}};(function(d,u){(function(l){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,c=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,h={buildAbsoluteURL:function(g,m,S){if(S=S||{},g=g.trim(),m=m.trim(),!m){if(!S.alwaysNormalize)return g;var x=h.parseURL(g);if(!x)throw new Error("Error trying to parse base URL.");return x.path=h.normalizePath(x.path),h.buildURLFromParts(x)}var U=h.parseURL(m);if(!U)throw new Error("Error trying to parse relative URL.");if(U.scheme)return S.alwaysNormalize?(U.path=h.normalizePath(U.path),h.buildURLFromParts(U)):m;var ne=h.parseURL(g);if(!ne)throw new Error("Error trying to parse base URL.");if(!ne.netLoc&&ne.path&&ne.path[0]!=="/"){var ue=s.exec(ne.path);ne.netLoc=ue[1],ne.path=ue[2]}ne.netLoc&&!ne.path&&(ne.path="/");var ge={scheme:ne.scheme,netLoc:U.netLoc,path:null,params:U.params,query:U.query,fragment:U.fragment};if(!U.netLoc&&(ge.netLoc=ne.netLoc,U.path[0]!=="/"))if(!U.path)ge.path=ne.path,U.params||(ge.params=ne.params,U.query||(ge.query=ne.query));else{var ye=ne.path,Se=ye.substring(0,ye.lastIndexOf("/")+1)+U.path;ge.path=h.normalizePath(Se)}return ge.path===null&&(ge.path=S.alwaysNormalize?h.normalizePath(U.path):U.path),h.buildURLFromParts(ge)},parseURL:function(g){var m=n.exec(g);return m?{scheme:m[1]||"",netLoc:m[2]||"",path:m[3]||"",params:m[4]||"",query:m[5]||"",fragment:m[6]||""}:null},normalizePath:function(g){for(g=g.split("").reverse().join("").replace(a,"");g.length!==(g=g.replace(c,"")).length;);return g.split("").reverse().join("")},buildURLFromParts:function(g){return g.scheme+g.netLoc+g.path+g.params+g.query+g.fragment}};d.exports=h})()})(Za);var pn=Za.exports,Ct=Number.isFinite||function(d){return typeof d=="number"&&isFinite(d)},kn=Number.isSafeInteger||function(d){return typeof d=="number"&&Math.abs(d)<=eo},eo=Number.MAX_SAFE_INTEGER||9007199254740991,_e=function(d){return d.MEDIA_ATTACHING="hlsMediaAttaching",d.MEDIA_ATTACHED="hlsMediaAttached",d.MEDIA_DETACHING="hlsMediaDetaching",d.MEDIA_DETACHED="hlsMediaDetached",d.BUFFER_RESET="hlsBufferReset",d.BUFFER_CODECS="hlsBufferCodecs",d.BUFFER_CREATED="hlsBufferCreated",d.BUFFER_APPENDING="hlsBufferAppending",d.BUFFER_APPENDED="hlsBufferAppended",d.BUFFER_EOS="hlsBufferEos",d.BUFFER_FLUSHING="hlsBufferFlushing",d.BUFFER_FLUSHED="hlsBufferFlushed",d.MANIFEST_LOADING="hlsManifestLoading",d.MANIFEST_LOADED="hlsManifestLoaded",d.MANIFEST_PARSED="hlsManifestParsed",d.LEVEL_SWITCHING="hlsLevelSwitching",d.LEVEL_SWITCHED="hlsLevelSwitched",d.LEVEL_LOADING="hlsLevelLoading",d.LEVEL_LOADED="hlsLevelLoaded",d.LEVEL_UPDATED="hlsLevelUpdated",d.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",d.LEVELS_UPDATED="hlsLevelsUpdated",d.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",d.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",d.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",d.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",d.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",d.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",d.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",d.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",d.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",d.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",d.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",d.CUES_PARSED="hlsCuesParsed",d.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",d.INIT_PTS_FOUND="hlsInitPtsFound",d.FRAG_LOADING="hlsFragLoading",d.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",d.FRAG_LOADED="hlsFragLoaded",d.FRAG_DECRYPTED="hlsFragDecrypted",d.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",d.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",d.FRAG_PARSING_METADATA="hlsFragParsingMetadata",d.FRAG_PARSED="hlsFragParsed",d.FRAG_BUFFERED="hlsFragBuffered",d.FRAG_CHANGED="hlsFragChanged",d.FPS_DROP="hlsFpsDrop",d.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",d.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",d.ERROR="hlsError",d.DESTROYING="hlsDestroying",d.KEY_LOADING="hlsKeyLoading",d.KEY_LOADED="hlsKeyLoaded",d.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",d.BACK_BUFFER_REACHED="hlsBackBufferReached",d.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",d}({}),Pt=function(d){return d.NETWORK_ERROR="networkError",d.MEDIA_ERROR="mediaError",d.KEY_SYSTEM_ERROR="keySystemError",d.MUX_ERROR="muxError",d.OTHER_ERROR="otherError",d}({}),je=function(d){return d.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",d.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",d.KEY_SYSTEM_NO_SESSION="keySystemNoSession",d.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",d.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",d.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",d.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",d.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",d.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",d.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",d.MANIFEST_LOAD_ERROR="manifestLoadError",d.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",d.MANIFEST_PARSING_ERROR="manifestParsingError",d.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",d.LEVEL_EMPTY_ERROR="levelEmptyError",d.LEVEL_LOAD_ERROR="levelLoadError",d.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",d.LEVEL_PARSING_ERROR="levelParsingError",d.LEVEL_SWITCH_ERROR="levelSwitchError",d.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",d.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",d.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",d.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",d.FRAG_LOAD_ERROR="fragLoadError",d.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",d.FRAG_DECRYPT_ERROR="fragDecryptError",d.FRAG_PARSING_ERROR="fragParsingError",d.FRAG_GAP="fragGap",d.REMUX_ALLOC_ERROR="remuxAllocError",d.KEY_LOAD_ERROR="keyLoadError",d.KEY_LOAD_TIMEOUT="keyLoadTimeOut",d.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",d.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",d.BUFFER_APPEND_ERROR="bufferAppendError",d.BUFFER_APPENDING_ERROR="bufferAppendingError",d.BUFFER_STALLED_ERROR="bufferStalledError",d.BUFFER_FULL_ERROR="bufferFullError",d.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",d.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",d.INTERNAL_EXCEPTION="internalException",d.INTERNAL_ABORTED="aborted",d.UNKNOWN="unknown",d}({}),en=function(){},ts={trace:en,debug:en,log:en,warn:en,info:en,error:en},_t=ts;function to(d){var u=self.console[d];return u?u.bind(self.console,"["+d+"] >"):en}function Ks(d){for(var u=arguments.length,l=new Array(u>1?u-1:0),n=1;n<u;n++)l[n-1]=arguments[n];l.forEach(function(s){_t[s]=d[s]?d[s].bind(d):to(s)})}function Co(d,u){if(typeof console=="object"&&d===!0||typeof d=="object"){Ks(d,"debug","log","info","warn","error");try{_t.log('Debug logs enabled for "'+u+'" in hls.js version 1.5.17')}catch{_t=ts}}else _t=ts}var Qe=_t,qs=/^(\d+)x(\d+)$/,$s=/(.+?)=(".*?"|.*?)(?:,|$)/g,Ti=function(){function d(l){typeof l=="string"&&(l=d.parseAttrList(l)),Di(this,l)}var u=d.prototype;return u.decimalInteger=function(n){var s=parseInt(this[n],10);return s>Number.MAX_SAFE_INTEGER?1/0:s},u.hexadecimalInteger=function(n){if(this[n]){var s=(this[n]||"0x").slice(2);s=(s.length&1?"0":"")+s;for(var a=new Uint8Array(s.length/2),c=0;c<s.length/2;c++)a[c]=parseInt(s.slice(c*2,c*2+2),16);return a}else return null},u.hexadecimalIntegerAsNumber=function(n){var s=parseInt(this[n],16);return s>Number.MAX_SAFE_INTEGER?1/0:s},u.decimalFloatingPoint=function(n){return parseFloat(this[n])},u.optionalFloat=function(n,s){var a=this[n];return a?parseFloat(a):s},u.enumeratedString=function(n){return this[n]},u.bool=function(n){return this[n]==="YES"},u.decimalResolution=function(n){var s=qs.exec(this[n]);if(s!==null)return{width:parseInt(s[1],10),height:parseInt(s[2],10)}},d.parseAttrList=function(n){var s,a={},c='"';for($s.lastIndex=0;(s=$s.exec(n))!==null;){var h=s[2];h.indexOf(c)===0&&h.lastIndexOf(c)===h.length-1&&(h=h.slice(1,-1));var g=s[1].trim();a[g]=h}return a},ki(d,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(n){return n.substring(0,2)==="X-"})}}]),d}();function ba(d){return d!=="ID"&&d!=="CLASS"&&d!=="START-DATE"&&d!=="DURATION"&&d!=="END-DATE"&&d!=="END-ON-NEXT"}function Vn(d){return d==="SCTE35-OUT"||d==="SCTE35-IN"}var Hn=function(){function d(u,l){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,l){var n=l.attr;for(var s in n)if(Object.prototype.hasOwnProperty.call(u,s)&&u[s]!==n[s]){Qe.warn('DATERANGE tag attribute: "'+s+'" does not match for tags with ID: "'+u.ID+'"'),this._badValueForSameId=s;break}u=Di(new Ti({}),n,u)}if(this.attr=u,this._startDate=new Date(u["START-DATE"]),"END-DATE"in this.attr){var a=new Date(this.attr["END-DATE"]);Ct(a.getTime())&&(this._endDate=a)}}return ki(d,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var l=this.duration;return l!==null?new Date(this._startDate.getTime()+l*1e3):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var l=this.attr.decimalFloatingPoint("DURATION");if(Ct(l))return l}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Ct(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),d}(),ps=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},ti={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},Dn=function(){function d(l){var n;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(n={},n[ti.AUDIO]=null,n[ti.VIDEO]=null,n[ti.AUDIOVIDEO]=null,n),this.baseurl=l}var u=d.prototype;return u.setByteRange=function(n,s){var a=n.split("@",2),c;a.length===1?c=s?.byteRangeEndOffset||0:c=parseInt(a[1]),this._byteRange=[c,parseInt(a[0])+c]},ki(d,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=pn.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(n){this._url=n}}]),d}(),Gi=function(d){Bt(u,d);function u(n,s){var a;return a=d.call(this,s)||this,a._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkeys=void 0,a.type=void 0,a.loader=null,a.keyLoader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new ps,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.endList=void 0,a.gap=void 0,a.urlId=0,a.type=n,a}var l=u.prototype;return l.setKeyFormat=function(s){if(this.levelkeys){var a=this.levelkeys[s];a&&!this._decryptdata&&(this._decryptdata=a.getDecryptData(this.sn))}},l.abortRequests=function(){var s,a;(s=this.loader)==null||s.abort(),(a=this.keyLoader)==null||a.abort()},l.setElementaryStreamInfo=function(s,a,c,h,g,m){m===void 0&&(m=!1);var S=this.elementaryStreams,x=S[s];if(!x){S[s]={startPTS:a,endPTS:c,startDTS:h,endDTS:g,partial:m};return}x.startPTS=Math.min(x.startPTS,a),x.endPTS=Math.max(x.endPTS,c),x.startDTS=Math.min(x.startDTS,h),x.endDTS=Math.max(x.endDTS,g)},l.clearElementaryStreamInfo=function(){var s=this.elementaryStreams;s[ti.AUDIO]=null,s[ti.VIDEO]=null,s[ti.AUDIOVIDEO]=null},ki(u,[{key:"decryptdata",get:function(){var s=this.levelkeys;if(!s&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var a=this.levelkeys.identity;if(a)this._decryptdata=a.getDecryptData(this.sn);else{var c=Object.keys(this.levelkeys);if(c.length===1)return this._decryptdata=this.levelkeys[c[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Ct(this.programDateTime))return null;var s=Ct(this.duration)?this.duration:0;return this.programDateTime+s*1e3}},{key:"encrypted",get:function(){var s;if((s=this._decryptdata)!=null&&s.encrypted)return!0;if(this.levelkeys){var a=Object.keys(this.levelkeys),c=a.length;if(c>1||c===1&&this.levelkeys[a[0]].encrypted)return!0}return!1}}]),u}(Dn),gs=function(d){Bt(u,d);function u(l,n,s,a,c){var h;h=d.call(this,s)||this,h.fragOffset=0,h.duration=0,h.gap=!1,h.independent=!1,h.relurl=void 0,h.fragment=void 0,h.index=void 0,h.stats=new ps,h.duration=l.decimalFloatingPoint("DURATION"),h.gap=l.bool("GAP"),h.independent=l.bool("INDEPENDENT"),h.relurl=l.enumeratedString("URI"),h.fragment=n,h.index=a;var g=l.enumeratedString("BYTERANGE");return g&&h.setByteRange(g,c),c&&(h.fragOffset=c.fragOffset+c.duration),h}return ki(u,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var n=this.elementaryStreams;return!!(n.audio||n.video||n.audiovideo)}}]),u}(Dn),ko=10,Do=function(){function d(l){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=l}var u=d.prototype;return u.reloaded=function(n){if(!n){this.advanced=!0,this.updated=!0;return}var s=this.lastPartSn-n.lastPartSn,a=this.lastPartIndex-n.lastPartIndex;this.updated=this.endSN!==n.endSN||!!a||!!s||!this.live,this.advanced=this.endSN>n.endSN||s>0||s===0&&a>0,this.updated||this.advanced?this.misses=Math.floor(n.misses*.6):this.misses=n.misses+1,this.availabilityDelay=n.availabilityDelay},ki(d,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Ct(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||ko}},{key:"drift",get:function(){var n=this.driftEndTime-this.driftStartTime;if(n>0){var s=this.driftEnd-this.driftStart;return s*1e3/n}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var n;return(n=this.fragments)!=null&&n.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),d}();function io(d){return Uint8Array.from(atob(d),function(u){return u.charCodeAt(0)})}function gn(d){var u=vs(d).subarray(0,16),l=new Uint8Array(16);return l.set(u,16-u.length),l}function ms(d){var u=function(n,s,a){var c=n[s];n[s]=n[a],n[a]=c};u(d,0,3),u(d,1,2),u(d,4,5),u(d,6,7)}function mn(d){var u=d.split(":"),l=null;if(u[0]==="data"&&u.length===2){var n=u[1].split(";"),s=n[n.length-1].split(",");if(s.length===2){var a=s[0]==="base64",c=s[1];a?(n.splice(-1,1),l=io(c)):l=gn(c)}}return l}function vs(d){return Uint8Array.from(unescape(encodeURIComponent(d)),function(u){return u.charCodeAt(0)})}var Rt=typeof self<"u"?self:void 0,ii={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},gr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ys(d){switch(d){case gr.FAIRPLAY:return ii.FAIRPLAY;case gr.PLAYREADY:return ii.PLAYREADY;case gr.WIDEVINE:return ii.WIDEVINE;case gr.CLEARKEY:return ii.CLEARKEY}}var Gt={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",FAIRPLAY:"94ce86fb07ff4f43adb893d2fa968ca2",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Aa(d){if(d===Gt.WIDEVINE)return ii.WIDEVINE;if(d===Gt.PLAYREADY)return ii.PLAYREADY;if(d===Gt.CENC||d===Gt.CLEARKEY)return ii.CLEARKEY}function ro(d){switch(d){case ii.FAIRPLAY:return gr.FAIRPLAY;case ii.PLAYREADY:return gr.PLAYREADY;case ii.WIDEVINE:return gr.WIDEVINE;case ii.CLEARKEY:return gr.CLEARKEY}}function Ts(d){var u=d.drmSystems,l=d.widevineLicenseUrl,n=u?[ii.FAIRPLAY,ii.WIDEVINE,ii.PLAYREADY,ii.CLEARKEY].filter(function(s){return!!u[s]}):[];return!n[ii.WIDEVINE]&&l&&n.push(ii.WIDEVINE),n}var wn=function(d){return Rt!=null&&(d=Rt.navigator)!=null&&d.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Ae(d,u,l,n){var s;switch(d){case ii.FAIRPLAY:s=["cenc","sinf"];break;case ii.WIDEVINE:case ii.PLAYREADY:s=["cenc"];break;case ii.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+d)}return Es(s,u,l,n)}function Es(d,u,l,n){var s={initDataTypes:d,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:u.map(function(a){return{contentType:'audio/mp4; codecs="'+a+'"',robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null}}),videoCapabilities:l.map(function(a){return{contentType:'video/mp4; codecs="'+a+'"',robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}})};return[s]}function lr(d,u,l){return Uint8Array.prototype.slice?d.slice(u,l):new Uint8Array(Array.prototype.slice.call(d,u,l))}var Ln=function(u,l){return l+10<=u.length&&u[l]===73&&u[l+1]===68&&u[l+2]===51&&u[l+3]<255&&u[l+4]<255&&u[l+6]<128&&u[l+7]<128&&u[l+8]<128&&u[l+9]<128},Sa=function(u,l){return l+10<=u.length&&u[l]===51&&u[l+1]===68&&u[l+2]===73&&u[l+3]<255&&u[l+4]<255&&u[l+6]<128&&u[l+7]<128&&u[l+8]<128&&u[l+9]<128},In=function(u,l){for(var n=l,s=0;Ln(u,l);){s+=10;var a=is(u,l+6);s+=a,Sa(u,l+10)&&(s+=10),l+=s}if(s>0)return u.subarray(n,n+s)},is=function(u,l){var n=0;return n=(u[l]&127)<<21,n|=(u[l+1]&127)<<14,n|=(u[l+2]&127)<<7,n|=u[l+3]&127,n},no=function(u,l){return Ln(u,l)&&is(u,l+6)+10<=u.length-l},so=function(u){for(var l=mr(u),n=0;n<l.length;n++){var s=l[n];if(Ws(s))return qr(s)}},Ws=function(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"},yl=function(u){var l=String.fromCharCode(u[0],u[1],u[2],u[3]),n=is(u,4),s=10;return{type:l,size:n,data:u.subarray(s,s+n)}},mr=function(u){for(var l=0,n=[];Ln(u,l);){var s=is(u,l+6);l+=10;for(var a=l+s;l+8<a;){var c=yl(u.subarray(l)),h=vr(c);h&&n.push(h),l+=c.size+10}Sa(u,l)&&(l+=10)}return n},vr=function(u){return u.type==="PRIV"?xa(u):u.type[0]==="W"?Kr(u):jr(u)},xa=function(u){if(!(u.size<2)){var l=Vi(u.data,!0),n=new Uint8Array(u.data.subarray(l.length+1));return{key:u.type,info:l,data:n.buffer}}},jr=function(u){if(!(u.size<2)){if(u.type==="TXXX"){var l=1,n=Vi(u.data.subarray(l),!0);l+=n.length+1;var s=Vi(u.data.subarray(l));return{key:u.type,info:n,data:s}}var a=Vi(u.data.subarray(1));return{key:u.type,data:a}}},Kr=function(u){if(u.type==="WXXX"){if(u.size<2)return;var l=1,n=Vi(u.data.subarray(l),!0);l+=n.length+1;var s=Vi(u.data.subarray(l));return{key:u.type,info:n,data:s}}var a=Vi(u.data);return{key:u.type,data:a}},qr=function(u){if(u.data.byteLength===8){var l=new Uint8Array(u.data),n=l[3]&1,s=(l[4]<<23)+(l[5]<<15)+(l[6]<<7)+l[7];return s/=45,n&&(s+=4772185884e-2),Math.round(s)}},Vi=function(u,l){l===void 0&&(l=!1);var n=qt();if(n){var s=n.decode(u);if(l){var a=s.indexOf("\0");return a!==-1?s.substring(0,a):s}return s.replace(/\0/g,"")}for(var c=u.length,h,g,m,S="",x=0;x<c;){if(h=u[x++],h===0&&l)return S;if(h===0||h===3)continue;switch(h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(h);break;case 12:case 13:g=u[x++],S+=String.fromCharCode((h&31)<<6|g&63);break;case 14:g=u[x++],m=u[x++],S+=String.fromCharCode((h&15)<<12|(g&63)<<6|(m&63)<<0);break}}return S},zs;function qt(){if(!navigator.userAgent.includes("PlayStation 4"))return!zs&&typeof self.TextDecoder<"u"&&(zs=new self.TextDecoder("utf-8")),zs}var tn={hexDump:function(u){for(var l="",n=0;n<u.length;n++){var s=u[n].toString(16);s.length<2&&(s="0"+s),l+=s}return l}},Ys=Math.pow(2,32)-1,Rr=[].push,Xs={video:1,audio:2,id3:3,text:4};function Wi(d){return String.fromCharCode.apply(null,d)}function wo(d,u){var l=d[u]<<8|d[u+1];return l<0?65536+l:l}function At(d,u){var l=Rn(d,u);return l<0?4294967296+l:l}function Tl(d,u){var l=At(d,u);return l*=Math.pow(2,32),l+=At(d,u+4),l}function Rn(d,u){return d[u]<<24|d[u+1]<<16|d[u+2]<<8|d[u+3]}function Pr(d,u,l){d[u]=l>>24,d[u+1]=l>>16&255,d[u+2]=l>>8&255,d[u+3]=l&255}function Lo(d){for(var u=d.byteLength,l=0;l<u;){var n=At(d,l);if(n>8&&d[l+4]===109&&d[l+5]===111&&d[l+6]===111&&d[l+7]===102)return!0;l=n>1?l+n:u}return!1}function Mt(d,u){var l=[];if(!u.length)return l;for(var n=d.byteLength,s=0;s<n;){var a=At(d,s),c=Wi(d.subarray(s+4,s+8)),h=a>1?s+a:n;if(c===u[0])if(u.length===1)l.push(d.subarray(s+8,h));else{var g=Mt(d.subarray(s+8,h),u.slice(1));g.length&&Rr.apply(l,g)}s=h}return l}function rn(d){var u=[],l=d[0],n=8,s=At(d,n);n+=4;var a=0,c=0;l===0?(a=At(d,n),c=At(d,n+4),n+=8):(a=Tl(d,n),c=Tl(d,n+8),n+=16),n+=2;var h=d.length+c,g=wo(d,n);n+=2;for(var m=0;m<g;m++){var S=n,x=At(d,S);S+=4;var U=x&2147483647,ne=(x&2147483648)>>>31;if(ne===1)return Qe.warn("SIDX has hierarchical references (not supported)"),null;var ue=At(d,S);S+=4,u.push({referenceSize:U,subsegmentDuration:ue,info:{duration:ue/s,start:h,end:h+U-1}}),h+=U,S+=4,n=S}return{earliestPresentationTime:a,timescale:s,version:l,referencesCount:g,references:u}}function nn(d){for(var u=[],l=Mt(d,["moov","trak"]),n=0;n<l.length;n++){var s=l[n],a=Mt(s,["tkhd"])[0];if(a){var c=a[0],h=At(a,c===0?12:20),g=Mt(s,["mdia","mdhd"])[0];if(g){c=g[0];var m=At(g,c===0?12:20),S=Mt(s,["mdia","hdlr"])[0];if(S){var x=Wi(S.subarray(8,12)),U={soun:ti.AUDIO,vide:ti.VIDEO}[x];if(U){var ne=Mt(s,["mdia","minf","stbl","stsd"])[0],ue=Qs(ne);u[h]={timescale:m,type:U},u[U]=Ii({timescale:m,id:h},ue)}}}}}var ge=Mt(d,["moov","mvex","trex"]);return ge.forEach(function(ye){var Se=At(ye,4),xe=u[Se];xe&&(xe.default={duration:At(ye,12),flags:At(ye,20)})}),u}function Qs(d){var u=d.subarray(8),l=u.subarray(86),n=Wi(u.subarray(4,8)),s=n,a=n==="enca"||n==="encv";if(a){var c=Mt(u,[n])[0],h=c.subarray(n==="enca"?28:78),g=Mt(h,["sinf"]);g.forEach(function(br){var Jr=Mt(br,["schm"])[0];if(Jr){var Ki=Wi(Jr.subarray(4,8));if(Ki==="cbcs"||Ki==="cenc"){var Us=Mt(br,["frma"])[0];Us&&(s=Wi(Us))}}})}switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{var m=Mt(l,["avcC"])[0];s+="."+yr(m[1])+yr(m[2])+yr(m[3]);break}case"mp4a":{var S=Mt(u,[n])[0],x=Mt(S.subarray(28),["esds"])[0];if(x&&x.length>12){var U=4;if(x[U++]!==3)break;U=_s(x,U),U+=2;var ne=x[U++];if(ne&128&&(U+=2),ne&64&&(U+=x[U++]),x[U++]!==4)break;U=_s(x,U);var ue=x[U++];if(ue===64)s+="."+yr(ue);else break;if(U+=12,x[U++]!==5)break;U=_s(x,U);var ge=x[U++],ye=(ge&248)>>3;ye===31&&(ye+=1+((ge&7)<<3)+((x[U]&224)>>5)),s+="."+ye}break}case"hvc1":case"hev1":{var Se=Mt(l,["hvcC"])[0],xe=Se[1],De=["","A","B","C"][xe>>6],Fe=xe&31,He=At(Se,2),rt=(xe&32)>>5?"H":"L",ze=Se[12],Ve=Se.subarray(6,12);s+="."+De+Fe,s+="."+He.toString(16).toUpperCase(),s+="."+rt+ze;for(var Ze="",et=Ve.length;et--;){var ot=Ve[et];if(ot||Ze){var ct=ot.toString(16).toUpperCase();Ze="."+ct+Ze}}s+=Ze;break}case"dvh1":case"dvhe":{var yt=Mt(l,["dvcC"])[0],wt=yt[2]>>1&127,It=yt[2]<<5&32|yt[3]>>3&31;s+="."+fi(wt)+"."+fi(It);break}case"vp09":{var Ht=Mt(l,["vpcC"])[0],jt=Ht[4],Zt=Ht[5],ei=Ht[6]>>4&15;s+="."+fi(jt)+"."+fi(Zt)+"."+fi(ei);break}case"av01":{var Kt=Mt(l,["av1C"])[0],Ai=Kt[1]>>>5,li=Kt[1]&31,rr=Kt[2]>>>7?"H":"M",Yi=(Kt[2]&64)>>6,Lr=(Kt[2]&32)>>5,Si=Ai===2&&Yi?Lr?12:10:Yi?10:8,Bi=(Kt[2]&16)>>4,_n=(Kt[2]&8)>>3,bn=(Kt[2]&4)>>2,ci=Kt[2]&3,Gr=1,dn=1,Oi=1,ar=0;s+="."+Ai+"."+fi(li)+rr+"."+fi(Si)+"."+Bi+"."+_n+bn+ci+"."+fi(Gr)+"."+fi(dn)+"."+fi(Oi)+"."+ar;break}}return{codec:s,encrypted:a}}function _s(d,u){for(var l=u+5;d[u++]&128&&u<l;);return u}function yr(d){return("0"+d.toString(16).toUpperCase()).slice(-2)}function fi(d){return(d<10?"0":"")+d}function Tr(d,u){if(!d||!u)return d;var l=u.keyId;if(l&&u.isCommonEncryption){var n=Mt(d,["moov","trak"]);n.forEach(function(s){var a=Mt(s,["mdia","minf","stbl","stsd"])[0],c=a.subarray(8),h=Mt(c,["enca"]),g=h.length>0;g||(h=Mt(c,["encv"])),h.forEach(function(m){var S=g?m.subarray(28):m.subarray(78),x=Mt(S,["sinf"]);x.forEach(function(U){var ne=bs(U);if(ne){var ue=ne.subarray(8,24);ue.some(function(ge){return ge!==0})||(Qe.log("[eme] Patching keyId in 'enc"+(g?"a":"v")+">sinf>>tenc' box: "+tn.hexDump(ue)+" -> "+tn.hexDump(l)),ne.set(l,8))}})})})}return d}function bs(d){var u=Mt(d,["schm"])[0];if(u){var l=Wi(u.subarray(4,8));if(l==="cbcs"||l==="cenc")return Mt(d,["schi","tenc"])[0]}return null}function Ca(d,u){return Mt(u,["moof","traf"]).reduce(function(l,n){var s=Mt(n,["tfdt"])[0],a=s[0],c=Mt(n,["tfhd"]).reduce(function(h,g){var m=At(g,4),S=d[m];if(S){var x=At(s,4);if(a===1){if(x===Ys)return Qe.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),h;x*=Ys+1,x+=At(s,8)}var U=S.timescale||9e4,ne=x/U;if(Ct(ne)&&(h===null||ne<h))return ne}return h},null);return c!==null&&Ct(c)&&(l===null||c<l)?c:l},null)}function El(d,u){for(var l=0,n=0,s=0,a=Mt(d,["moof","traf"]),c=0;c<a.length;c++){var h=a[c],g=Mt(h,["tfhd"])[0],m=At(g,4),S=u[m];if(S){var x=S.default,U=At(g,0)|x?.flags,ne=x?.duration;U&8&&(U&2?ne=At(g,12):ne=At(g,8));for(var ue=S.timescale||9e4,ge=Mt(h,["trun"]),ye=0;ye<ge.length;ye++){if(l=sn(ge[ye]),!l&&ne){var Se=At(ge[ye],4);l=ne*Se}S.type===ti.VIDEO?n+=l/ue:S.type===ti.AUDIO&&(s+=l/ue)}}}if(n===0&&s===0){for(var xe=1/0,De=0,Fe=0,He=Mt(d,["sidx"]),rt=0;rt<He.length;rt++){var ze=rn(He[rt]);if(ze!=null&&ze.references){xe=Math.min(xe,ze.earliestPresentationTime/ze.timescale);var Ve=ze.references.reduce(function(Ze,et){return Ze+et.info.duration||0},0);De=Math.max(De,Ve+ze.earliestPresentationTime/ze.timescale),Fe=De-xe}}if(Fe&&Ct(Fe))return Fe}return n||s}function sn(d){var u=At(d,0),l=8;u&1&&(l+=4),u&4&&(l+=4);for(var n=0,s=At(d,4),a=0;a<s;a++){if(u&256){var c=At(d,l);n+=c,l+=4}u&512&&(l+=4),u&1024&&(l+=4),u&2048&&(l+=4)}return n}function pi(d,u,l){Mt(u,["moof","traf"]).forEach(function(n){Mt(n,["tfhd"]).forEach(function(s){var a=At(s,4),c=d[a];if(c){var h=c.timescale||9e4;Mt(n,["tfdt"]).forEach(function(g){var m=g[0],S=l*h;if(S){var x=At(g,4);if(m===0)x-=S,x=Math.max(x,0),Pr(g,4,x);else{x*=Math.pow(2,32),x+=At(g,8),x-=S,x=Math.max(x,0);var U=Math.floor(x/(Ys+1)),ne=Math.floor(x%(Ys+1));Pr(g,4,U),Pr(g,8,ne)}}})}})})}function Pn(d){var u={valid:null,remainder:null},l=Mt(d,["moof"]);if(l.length<2)return u.remainder=d,u;var n=l[l.length-1];return u.valid=lr(d,0,n.byteOffset-8),u.remainder=lr(d,n.byteOffset-8),u}function Ei(d,u){var l=new Uint8Array(d.length+u.length);return l.set(d),l.set(u,d.length),l}function Io(d,u){var l=[],n=u.samples,s=u.timescale,a=u.id,c=!1,h=Mt(n,["moof"]);return h.map(function(g){var m=g.byteOffset-8,S=Mt(g,["traf"]);S.map(function(x){var U=Mt(x,["tfdt"]).map(function(ne){var ue=ne[0],ge=At(ne,4);return ue===1&&(ge*=Math.pow(2,32),ge+=At(ne,8)),ge/s})[0];return U!==void 0&&(d=U),Mt(x,["tfhd"]).map(function(ne){var ue=At(ne,4),ge=At(ne,0)&16777215,ye=(ge&1)!==0,Se=(ge&2)!==0,xe=(ge&8)!==0,De=0,Fe=(ge&16)!==0,He=0,rt=(ge&32)!==0,ze=8;ue===a&&(ye&&(ze+=8),Se&&(ze+=4),xe&&(De=At(ne,ze),ze+=4),Fe&&(He=At(ne,ze),ze+=4),rt&&(ze+=4),u.type==="video"&&(c=ur(u.codec)),Mt(x,["trun"]).map(function(Ve){var Ze=Ve[0],et=At(Ve,0)&16777215,ot=(et&1)!==0,ct=0,yt=(et&4)!==0,wt=(et&256)!==0,It=0,Ht=(et&512)!==0,jt=0,Zt=(et&1024)!==0,ei=(et&2048)!==0,Kt=0,Ai=At(Ve,4),li=8;ot&&(ct=At(Ve,li),li+=4),yt&&(li+=4);for(var rr=ct+m,Yi=0;Yi<Ai;Yi++){if(wt?(It=At(Ve,li),li+=4):It=De,Ht?(jt=At(Ve,li),li+=4):jt=He,Zt&&(li+=4),ei&&(Ze===0?Kt=At(Ve,li):Kt=Rn(Ve,li),li+=4),u.type===ti.VIDEO)for(var Lr=0;Lr<jt;){var Si=At(n,rr);if(rr+=4,_i(c,n[rr])){var Bi=n.subarray(rr,rr+Si);an(Bi,c?2:1,d+Kt/s,l)}rr+=Si,Lr+=Si+4}d+=It/s}}))})})}),l}function ur(d){if(!d)return!1;var u=d.indexOf("."),l=u<0?d:d.substring(0,u);return l==="hvc1"||l==="hev1"||l==="dvh1"||l==="dvhe"}function _i(d,u){if(d){var l=u>>1&63;return l===39||l===40}else{var n=u&31;return n===6}}function an(d,u,l,n){var s=on(d),a=0;a+=u;for(var c=0,h=0,g=0;a<s.length;){c=0;do{if(a>=s.length)break;g=s[a++],c+=g}while(g===255);h=0;do{if(a>=s.length)break;g=s[a++],h+=g}while(g===255);var m=s.length-a,S=a;if(h<m)a+=h;else if(h>m){Qe.error("Malformed SEI payload. "+h+" is too small, only "+m+" bytes left to parse.");break}if(c===4){var x=s[S++];if(x===181){var U=wo(s,S);if(S+=2,U===49){var ne=At(s,S);if(S+=4,ne===1195456820){var ue=s[S++];if(ue===3){var ge=s[S++],ye=31&ge,Se=64&ge,xe=Se?2+ye*3:0,De=new Uint8Array(xe);if(Se){De[0]=ge;for(var Fe=1;Fe<xe;Fe++)De[Fe]=s[S++]}n.push({type:ue,payloadType:c,pts:l,bytes:De})}}}}}else if(c===5&&h>16){for(var He=[],rt=0;rt<16;rt++){var ze=s[S++].toString(16);He.push(ze.length==1?"0"+ze:ze),(rt===3||rt===5||rt===7||rt===9)&&He.push("-")}for(var Ve=h-16,Ze=new Uint8Array(Ve),et=0;et<Ve;et++)Ze[et]=s[S++];n.push({payloadType:c,pts:l,uuid:He.join(""),userData:Vi(Ze),userDataBytes:Ze})}}}function on(d){for(var u=d.byteLength,l=[],n=1;n<u-2;)d[n]===0&&d[n+1]===0&&d[n+2]===3?(l.push(n+2),n+=2):n++;if(l.length===0)return d;var s=u-l.length,a=new Uint8Array(s),c=0;for(n=0;n<s;c++,n++)c===l[0]&&(c++,l.shift()),a[n]=d[c];return a}function _l(d){var u=d[0],l="",n="",s=0,a=0,c=0,h=0,g=0,m=0;if(u===0){for(;Wi(d.subarray(m,m+1))!=="\0";)l+=Wi(d.subarray(m,m+1)),m+=1;for(l+=Wi(d.subarray(m,m+1)),m+=1;Wi(d.subarray(m,m+1))!=="\0";)n+=Wi(d.subarray(m,m+1)),m+=1;n+=Wi(d.subarray(m,m+1)),m+=1,s=At(d,12),a=At(d,16),h=At(d,20),g=At(d,24),m=28}else if(u===1){m+=4,s=At(d,m),m+=4;var S=At(d,m);m+=4;var x=At(d,m);for(m+=4,c=Math.pow(2,32)*S+x,kn(c)||(c=Number.MAX_SAFE_INTEGER,Qe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),h=At(d,m),m+=4,g=At(d,m),m+=4;Wi(d.subarray(m,m+1))!=="\0";)l+=Wi(d.subarray(m,m+1)),m+=1;for(l+=Wi(d.subarray(m,m+1)),m+=1;Wi(d.subarray(m,m+1))!=="\0";)n+=Wi(d.subarray(m,m+1)),m+=1;n+=Wi(d.subarray(m,m+1)),m+=1}var U=d.subarray(m,d.byteLength);return{schemeIdUri:l,value:n,timeScale:s,presentationTime:c,presentationTimeDelta:a,eventDuration:h,id:g,payload:U}}function Sr(d){for(var u=arguments.length,l=new Array(u>1?u-1:0),n=1;n<u;n++)l[n-1]=arguments[n];for(var s=l.length,a=8,c=s;c--;)a+=l[c].byteLength;var h=new Uint8Array(a);for(h[0]=a>>24&255,h[1]=a>>16&255,h[2]=a>>8&255,h[3]=a&255,h.set(d,4),c=0,a=8;c<s;c++)h.set(l[c],a),a+=l[c].byteLength;return h}function ao(d,u,l){if(d.byteLength!==16)throw new RangeError("Invalid system id");var n,s;if(u){n=1,s=new Uint8Array(u.length*16);for(var a=0;a<u.length;a++){var c=u[a];if(c.byteLength!==16)throw new RangeError("Invalid key");s.set(c,a*16)}}else n=0,s=new Uint8Array;var h;n>0?(h=new Uint8Array(4),u.length>0&&new DataView(h.buffer).setUint32(0,u.length,!1)):h=new Uint8Array;var g=new Uint8Array(4);return l&&l.byteLength>0&&new DataView(g.buffer).setUint32(0,l.byteLength,!1),Sr([112,115,115,104],new Uint8Array([n,0,0,0]),d,h,s,g,l||new Uint8Array)}function Js(d){var u=[];if(d instanceof ArrayBuffer)for(var l=d.byteLength,n=0;n+32<l;){var s=new DataView(d,n),a=bl(s);u.push(a),n+=a.size}return u}function bl(d){var u=d.getUint32(0),l=d.byteOffset,n=d.byteLength;if(n<u)return{offset:l,size:n};var s=d.getUint32(4);if(s!==1886614376)return{offset:l,size:u};var a=d.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:l,size:u};var c=d.buffer,h=tn.hexDump(new Uint8Array(c,l+12,16)),g=d.getUint32(28),m=null,S=null;if(a===0){if(u-32<g||g<22)return{offset:l,size:u};S=new Uint8Array(c,l+32,g)}else if(a===1){if(!g||n<l+32+g*16+16)return{offset:l,size:u};m=[];for(var x=0;x<g;x++)m.push(new Uint8Array(c,l+32+x*16,16))}return{version:a,systemId:h,kids:m,data:S,offset:l,size:u}}var Zs={},jn=function(){d.clearKeyUriToKeyIdMap=function(){Zs={}};function d(l,n,s,a,c){a===void 0&&(a=[1]),c===void 0&&(c=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=l,this.uri=n,this.keyFormat=s,this.keyFormatVersions=a,this.iv=c,this.encrypted=l?l!=="NONE":!1,this.isCommonEncryption=this.encrypted&&l!=="AES-128"}var u=d.prototype;return u.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case gr.FAIRPLAY:case gr.WIDEVINE:case gr.PLAYREADY:case gr.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},u.getDecryptData=function(n){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof n!="number"&&(this.method==="AES-128"&&!this.iv&&Qe.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),n=0);var s=Su(n),a=new d(this.method,this.uri,"identity",this.keyFormatVersions,s);return a}var c=mn(this.uri);if(c)switch(this.keyFormat){case gr.WIDEVINE:this.pssh=c,c.length>=22&&(this.keyId=c.subarray(c.length-22,c.length-6));break;case gr.PLAYREADY:{var h=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ao(h,null,c);var g=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/2),m=String.fromCharCode.apply(null,Array.from(g)),S=m.substring(m.indexOf("<"),m.length),x=new DOMParser,U=x.parseFromString(S,"text/xml"),ne=U.getElementsByTagName("KID")[0];if(ne){var ue=ne.childNodes[0]?ne.childNodes[0].nodeValue:ne.getAttribute("VALUE");if(ue){var ge=io(ue).subarray(0,16);ms(ge),this.keyId=ge}}break}default:{var ye=c.subarray(0,16);if(ye.length!==16){var Se=new Uint8Array(16);Se.set(ye,16-ye.length),ye=Se}this.keyId=ye;break}}if(!this.keyId||this.keyId.byteLength!==16){var xe=Zs[this.uri];if(!xe){var De=Object.keys(Zs).length%Number.MAX_SAFE_INTEGER;xe=new Uint8Array(16);var Fe=new DataView(xe.buffer,12,4);Fe.setUint32(0,De),Zs[this.uri]=xe}this.keyId=xe}return this},d}();function Su(d){for(var u=new Uint8Array(16),l=12;l<16;l++)u[l]=d>>8*(15-l)&255;return u}var oo=/\{\$([a-zA-Z0-9-_]+)\}/g;function rs(d){return oo.test(d)}function cr(d,u,l){if(d.variableList!==null||d.hasVariableRefs)for(var n=l.length;n--;){var s=l[n],a=u[s];a&&(u[s]=As(d,a))}}function As(d,u){if(d.variableList!==null||d.hasVariableRefs){var l=d.variableList;return u.replace(oo,function(n){var s=n.substring(2,n.length-1),a=l?.[s];return a===void 0?(d.playlistParsingError||(d.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+s+'"')),n):a})}return u}function Ri(d,u,l){var n=d.variableList;n||(d.variableList=n={});var s,a;if("QUERYPARAM"in u){s=u.QUERYPARAM;try{var c=new self.URL(l).searchParams;if(c.has(s))a=c.get(s);else throw new Error('"'+s+'" does not match any query parameter in URI: "'+l+'"')}catch(h){d.playlistParsingError||(d.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+h.message))}}else s=u.NAME,a=u.VALUE;s in n?d.playlistParsingError||(d.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+s+'"')):n[s]=a||""}function Al(d,u,l){var n=u.IMPORT;if(l&&n in l){var s=d.variableList;s||(d.variableList=s={}),s[n]=l[n]}else d.playlistParsingError||(d.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+n+'"'))}function Tt(d){if(d===void 0&&(d=!0),!(typeof self>"u")){var u=(d||!self.MediaSource)&&self.ManagedMediaSource;return u||self.MediaSource||self.WebKitMediaSource}}function lt(d){return typeof self<"u"&&d===self.ManagedMediaSource}var ka={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Ro(d,u){var l=ka[u];return!!l&&!!l[d.slice(0,4)]}function ea(d,u,l){return l===void 0&&(l=!0),!d.split(",").some(function(n){return!$r(n,u,l)})}function $r(d,u,l){var n;l===void 0&&(l=!0);var s=Tt(l);return(n=s?.isTypeSupported(Ss(d,u)))!=null?n:!1}function Ss(d,u){return u+'/mp4;codecs="'+d+'"'}function Da(d){if(d){var u=d.substring(0,4);return ka.video[u]}return 2}function wa(d){return d.split(",").reduce(function(u,l){var n=ka.video[l];return n?(n*2+u)/(u?3:2):(ka.audio[l]+u)/(u?2:1)},0)}var ta={};function Kn(d,u){if(u===void 0&&(u=!0),ta[d])return ta[d];for(var l={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[d],n=0;n<l.length;n++)if($r(l[n],"audio",u))return ta[d]=l[n],l[n];return d}var xu=/flac|opus/i;function ia(d,u){return u===void 0&&(u=!0),d.replace(xu,function(l){return Kn(l.toLowerCase(),u)})}function wi(d,u){return d&&d!=="mp4a"?d:u&&u.split(",")[0]}function Ji(d){for(var u=d.split(","),l=0;l<u.length;l++){var n=u[l].split(".");if(n.length>2){var s=n.shift()+".";s+=parseInt(n.shift()).toString(16),s+=("000"+parseInt(n.shift()).toString(16)).slice(-4),u[l]=s}}return u.join(",")}var Wr=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,La=/#EXT-X-MEDIA:(.*)/g,jc=/^#EXT(?:INF|-X-TARGETDURATION):/m,Cu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Sl=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),xs=function(){function d(){}return d.findGroup=function(l,n){for(var s=0;s<l.length;s++){var a=l[s];if(a.id===n)return a}},d.resolve=function(l,n){return pn.buildAbsoluteURL(n,l,{alwaysNormalize:!0})},d.isMediaPlaylist=function(l){return jc.test(l)},d.parseMasterPlaylist=function(l,n){var s=rs(l),a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},c=[];Wr.lastIndex=0;for(var h;(h=Wr.exec(l))!=null;)if(h[1]){var g,m=new Ti(h[1]);cr(a,m,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var S=As(a,h[2]),x={attrs:m,bitrate:m.decimalInteger("BANDWIDTH")||m.decimalInteger("AVERAGE-BANDWIDTH"),name:m.NAME,url:d.resolve(S,n)},U=m.decimalResolution("RESOLUTION");U&&(x.width=U.width,x.height=U.height),Po(m.CODECS,x),(g=x.unknownCodecs)!=null&&g.length||c.push(x),a.levels.push(x)}else if(h[3]){var ne=h[3],ue=h[4];switch(ne){case"SESSION-DATA":{var ge=new Ti(ue);cr(a,ge,["DATA-ID","LANGUAGE","VALUE","URI"]);var ye=ge["DATA-ID"];ye&&(a.sessionData===null&&(a.sessionData={}),a.sessionData[ye]=ge);break}case"SESSION-KEY":{var Se=Cs(ue,n,a);Se.encrypted&&Se.isSupported()?(a.sessionKeys===null&&(a.sessionKeys=[]),a.sessionKeys.push(Se)):Qe.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+ue+'"');break}case"DEFINE":{{var xe=new Ti(ue);cr(a,xe,["NAME","VALUE","QUERYPARAM"]),Ri(a,xe,n)}break}case"CONTENT-STEERING":{var De=new Ti(ue);cr(a,De,["SERVER-URI","PATHWAY-ID"]),a.contentSteering={uri:d.resolve(De["SERVER-URI"],n),pathwayId:De["PATHWAY-ID"]||"."};break}case"START":{a.startTimeOffset=ks(ue);break}}}var Fe=c.length>0&&c.length<a.levels.length;return a.levels=Fe?c:a.levels,a.levels.length===0&&(a.playlistParsingError=new Error("no levels found in manifest")),a},d.parseMasterPlaylistMedia=function(l,n,s){var a,c={},h=s.levels,g={AUDIO:h.map(function(He){return{id:He.attrs.AUDIO,audioCodec:He.audioCodec}}),SUBTITLES:h.map(function(He){return{id:He.attrs.SUBTITLES,textCodec:He.textCodec}}),"CLOSED-CAPTIONS":[]},m=0;for(La.lastIndex=0;(a=La.exec(l))!==null;){var S=new Ti(a[1]),x=S.TYPE;if(x){var U=g[x],ne=c[x]||[];c[x]=ne,cr(s,S,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var ue=S.LANGUAGE,ge=S["ASSOC-LANGUAGE"],ye=S.CHANNELS,Se=S.CHARACTERISTICS,xe=S["INSTREAM-ID"],De={attrs:S,bitrate:0,id:m++,groupId:S["GROUP-ID"]||"",name:S.NAME||ue||"",type:x,default:S.bool("DEFAULT"),autoselect:S.bool("AUTOSELECT"),forced:S.bool("FORCED"),lang:ue,url:S.URI?d.resolve(S.URI,n):""};if(ge&&(De.assocLang=ge),ye&&(De.channels=ye),Se&&(De.characteristics=Se),xe&&(De.instreamId=xe),U!=null&&U.length){var Fe=d.findGroup(U,De.groupId)||U[0];xl(De,Fe,"audioCodec"),xl(De,Fe,"textCodec")}ne.push(De)}}return c},d.parseLevelPlaylist=function(l,n,s,a,c,h){var g=new Do(n),m=g.fragments,S=null,x=0,U=0,ne=0,ue=0,ge=null,ye=new Gi(a,n),Se,xe,De,Fe=-1,He=!1,rt=null;for(Cu.lastIndex=0,g.m3u8=l,g.hasVariableRefs=rs(l);(Se=Cu.exec(l))!==null;){He&&(He=!1,ye=new Gi(a,n),ye.start=ne,ye.sn=x,ye.cc=ue,ye.level=s,S&&(ye.initSegment=S,ye.rawProgramDateTime=S.rawProgramDateTime,S.rawProgramDateTime=null,rt&&(ye.setByteRange(rt),rt=null)));var ze=Se[1];if(ze){ye.duration=parseFloat(ze);var Ve=(" "+Se[2]).slice(1);ye.title=Ve||null,ye.tagList.push(Ve?["INF",ze,Ve]:["INF",ze])}else if(Se[3]){if(Ct(ye.duration)){ye.start=ne,De&&kl(ye,De,g),ye.sn=x,ye.level=s,ye.cc=ue,m.push(ye);var Ze=(" "+Se[3]).slice(1);ye.relurl=As(g,Ze),Cl(ye,ge),ge=ye,ne+=ye.duration,x++,U=0,He=!0}}else if(Se[4]){var et=(" "+Se[4]).slice(1);ge?ye.setByteRange(et,ge):ye.setByteRange(et)}else if(Se[5])ye.rawProgramDateTime=(" "+Se[5]).slice(1),ye.tagList.push(["PROGRAM-DATE-TIME",ye.rawProgramDateTime]),Fe===-1&&(Fe=m.length);else{if(Se=Se[0].match(Sl),!Se){Qe.warn("No matches on slow regex match for level playlist!");continue}for(xe=1;xe<Se.length&&!(typeof Se[xe]<"u");xe++);var ot=(" "+Se[xe]).slice(1),ct=(" "+Se[xe+1]).slice(1),yt=Se[xe+2]?(" "+Se[xe+2]).slice(1):"";switch(ot){case"PLAYLIST-TYPE":g.type=ct.toUpperCase();break;case"MEDIA-SEQUENCE":x=g.startSN=parseInt(ct);break;case"SKIP":{var wt=new Ti(ct);cr(g,wt,["RECENTLY-REMOVED-DATERANGES"]);var It=wt.decimalInteger("SKIPPED-SEGMENTS");if(Ct(It)){g.skippedSegments=It;for(var Ht=It;Ht--;)m.unshift(null);x+=It}var jt=wt.enumeratedString("RECENTLY-REMOVED-DATERANGES");jt&&(g.recentlyRemovedDateranges=jt.split("	"));break}case"TARGETDURATION":g.targetduration=Math.max(parseInt(ct),1);break;case"VERSION":g.version=parseInt(ct);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":g.live=!1;break;case"#":(ct||yt)&&ye.tagList.push(yt?[ct,yt]:[ct]);break;case"DISCONTINUITY":ue++,ye.tagList.push(["DIS"]);break;case"GAP":ye.gap=!0,ye.tagList.push([ot]);break;case"BITRATE":ye.tagList.push([ot,ct]);break;case"DATERANGE":{var Zt=new Ti(ct);cr(g,Zt,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),cr(g,Zt,Zt.clientAttrs);var ei=new Hn(Zt,g.dateRanges[Zt.ID]);ei.isValid||g.skippedSegments?g.dateRanges[ei.id]=ei:Qe.warn('Ignoring invalid DATERANGE tag: "'+ct+'"'),ye.tagList.push(["EXT-X-DATERANGE",ct]);break}case"DEFINE":{{var Kt=new Ti(ct);cr(g,Kt,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in Kt?Al(g,Kt,h):Ri(g,Kt,n)}break}case"DISCONTINUITY-SEQUENCE":ue=parseInt(ct);break;case"KEY":{var Ai=Cs(ct,n,g);if(Ai.isSupported()){if(Ai.method==="NONE"){De=void 0;break}De||(De={}),De[Ai.keyFormat]&&(De=Di({},De)),De[Ai.keyFormat]=Ai}else Qe.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+ct+'"');break}case"START":g.startTimeOffset=ks(ct);break;case"MAP":{var li=new Ti(ct);if(cr(g,li,["BYTERANGE","URI"]),ye.duration){var rr=new Gi(a,n);Mo(rr,li,s,De),S=rr,ye.initSegment=S,S.rawProgramDateTime&&!ye.rawProgramDateTime&&(ye.rawProgramDateTime=S.rawProgramDateTime)}else{var Yi=ye.byteRangeEndOffset;if(Yi){var Lr=ye.byteRangeStartOffset;rt=Yi-Lr+"@"+Lr}else rt=null;Mo(ye,li,s,De),S=ye,He=!0}break}case"SERVER-CONTROL":{var Si=new Ti(ct);g.canBlockReload=Si.bool("CAN-BLOCK-RELOAD"),g.canSkipUntil=Si.optionalFloat("CAN-SKIP-UNTIL",0),g.canSkipDateRanges=g.canSkipUntil>0&&Si.bool("CAN-SKIP-DATERANGES"),g.partHoldBack=Si.optionalFloat("PART-HOLD-BACK",0),g.holdBack=Si.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Bi=new Ti(ct);g.partTarget=Bi.decimalFloatingPoint("PART-TARGET");break}case"PART":{var _n=g.partList;_n||(_n=g.partList=[]);var bn=U>0?_n[_n.length-1]:void 0,ci=U++,Gr=new Ti(ct);cr(g,Gr,["BYTERANGE","URI"]);var dn=new gs(Gr,ye,n,ci,bn);_n.push(dn),ye.duration+=dn.duration;break}case"PRELOAD-HINT":{var Oi=new Ti(ct);cr(g,Oi,["URI"]),g.preloadHint=Oi;break}case"RENDITION-REPORT":{var ar=new Ti(ct);cr(g,ar,["URI"]),g.renditionReports=g.renditionReports||[],g.renditionReports.push(ar);break}default:Qe.warn("line parsed but not handled: "+Se);break}}}ge&&!ge.relurl?(m.pop(),ne-=ge.duration,g.partList&&(g.fragmentHint=ge)):g.partList&&(Cl(ye,ge),ye.cc=ue,g.fragmentHint=ye,De&&kl(ye,De,g));var br=m.length,Jr=m[0],Ki=m[br-1];if(ne+=g.skippedSegments*g.targetduration,ne>0&&br&&Ki){g.averagetargetduration=ne/br;var Us=Ki.sn;g.endSN=Us!=="initSegment"?Us:0,g.live||(Ki.endList=!0),Jr&&(g.startCC=Jr.cc)}else g.endSN=0,g.startCC=0;return g.fragmentHint&&(ne+=g.fragmentHint.duration),g.totalduration=ne,g.endCC=ue,Fe>0&&Oo(m,Fe),g},d}();function Cs(d,u,l){var n,s,a=new Ti(d);cr(l,a,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var c=(n=a.METHOD)!=null?n:"",h=a.URI,g=a.hexadecimalInteger("IV"),m=a.KEYFORMATVERSIONS,S=(s=a.KEYFORMAT)!=null?s:"identity";h&&a.IV&&!g&&Qe.error("Invalid IV: "+a.IV);var x=h?xs.resolve(h,u):"",U=(m||"1").split("/").map(Number).filter(Number.isFinite);return new jn(c,x,S,U,g)}function ks(d){var u=new Ti(d),l=u.decimalFloatingPoint("TIME-OFFSET");return Ct(l)?l:null}function Po(d,u){var l=(d||"").split(/[ ,]+/).filter(function(n){return n});["video","audio","text"].forEach(function(n){var s=l.filter(function(a){return Ro(a,n)});s.length&&(u[n+"Codec"]=s.join(","),l=l.filter(function(a){return s.indexOf(a)===-1}))}),u.unknownCodecs=l}function xl(d,u,l){var n=u[l];n&&(d[l]=n)}function Oo(d,u){for(var l=d[u],n=u;n--;){var s=d[n];if(!s)return;s.programDateTime=l.programDateTime-s.duration*1e3,l=s}}function Cl(d,u){d.rawProgramDateTime?d.programDateTime=Date.parse(d.rawProgramDateTime):u!=null&&u.programDateTime&&(d.programDateTime=u.endProgramDateTime),Ct(d.programDateTime)||(d.programDateTime=null,d.rawProgramDateTime=null)}function Mo(d,u,l,n){d.relurl=u.URI,u.BYTERANGE&&d.setByteRange(u.BYTERANGE),d.level=l,d.sn="initSegment",n&&(d.levelkeys=n),d.initSegment=null}function kl(d,u,l){d.levelkeys=u;var n=l.encryptedFragments;(!n.length||n[n.length-1].levelkeys!==u)&&Object.keys(u).some(function(s){return u[s].isCommonEncryption})&&n.push(d)}var Jt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Nt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function No(d){var u=d.type;switch(u){case Jt.AUDIO_TRACK:return Nt.AUDIO;case Jt.SUBTITLE_TRACK:return Nt.SUBTITLE;default:return Nt.MAIN}}function lo(d,u){var l=d.url;return(l===void 0||l.indexOf("data:")===0)&&(l=u.url),l}var Ia=function(){function d(l){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=l,this.registerListeners()}var u=d.prototype;return u.startLoad=function(n){},u.stopLoad=function(){this.destroyInternalLoaders()},u.registerListeners=function(){var n=this.hls;n.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_e.LEVEL_LOADING,this.onLevelLoading,this),n.on(_e.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),n.on(_e.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},u.unregisterListeners=function(){var n=this.hls;n.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_e.LEVEL_LOADING,this.onLevelLoading,this),n.off(_e.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),n.off(_e.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},u.createInternalLoader=function(n){var s=this.hls.config,a=s.pLoader,c=s.loader,h=a||c,g=new h(s);return this.loaders[n.type]=g,g},u.getInternalLoader=function(n){return this.loaders[n.type]},u.resetInternalLoader=function(n){this.loaders[n]&&delete this.loaders[n]},u.destroyInternalLoaders=function(){for(var n in this.loaders){var s=this.loaders[n];s&&s.destroy(),this.resetInternalLoader(n)}},u.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},u.onManifestLoading=function(n,s){var a=s.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Jt.MANIFEST,url:a,deliveryDirectives:null})},u.onLevelLoading=function(n,s){var a=s.id,c=s.level,h=s.pathwayId,g=s.url,m=s.deliveryDirectives;this.load({id:a,level:c,pathwayId:h,responseType:"text",type:Jt.LEVEL,url:g,deliveryDirectives:m})},u.onAudioTrackLoading=function(n,s){var a=s.id,c=s.groupId,h=s.url,g=s.deliveryDirectives;this.load({id:a,groupId:c,level:null,responseType:"text",type:Jt.AUDIO_TRACK,url:h,deliveryDirectives:g})},u.onSubtitleTrackLoading=function(n,s){var a=s.id,c=s.groupId,h=s.url,g=s.deliveryDirectives;this.load({id:a,groupId:c,level:null,responseType:"text",type:Jt.SUBTITLE_TRACK,url:h,deliveryDirectives:g})},u.load=function(n){var s,a=this,c=this.hls.config,h=this.getInternalLoader(n);if(h){var g=h.context;if(g&&g.url===n.url&&g.level===n.level){Qe.trace("[playlist-loader]: playlist request ongoing");return}Qe.log("[playlist-loader]: aborting previous loader for type: "+n.type),h.abort()}var m;if(n.type===Jt.MANIFEST?m=c.manifestLoadPolicy.default:m=Di({},c.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),h=this.createInternalLoader(n),Ct((s=n.deliveryDirectives)==null?void 0:s.part)){var S;if(n.type===Jt.LEVEL&&n.level!==null?S=this.hls.levels[n.level].details:n.type===Jt.AUDIO_TRACK&&n.id!==null?S=this.hls.audioTracks[n.id].details:n.type===Jt.SUBTITLE_TRACK&&n.id!==null&&(S=this.hls.subtitleTracks[n.id].details),S){var x=S.partTarget,U=S.targetduration;if(x&&U){var ne=Math.max(x*3,U*.8)*1e3;m=Di({},m,{maxTimeToFirstByteMs:Math.min(ne,m.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(ne,m.maxTimeToFirstByteMs)})}}}var ue=m.errorRetry||m.timeoutRetry||{},ge={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:ue.maxNumRetry||0,retryDelay:ue.retryDelayMs||0,maxRetryDelay:ue.maxRetryDelayMs||0},ye={onSuccess:function(xe,De,Fe,He){var rt=a.getInternalLoader(Fe);a.resetInternalLoader(Fe.type);var ze=xe.data;if(ze.indexOf("#EXTM3U")!==0){a.handleManifestParsingError(xe,Fe,new Error("no EXTM3U delimiter"),He||null,De);return}De.parsing.start=performance.now(),xs.isMediaPlaylist(ze)?a.handleTrackOrLevelPlaylist(xe,De,Fe,He||null,rt):a.handleMasterPlaylist(xe,De,Fe,He)},onError:function(xe,De,Fe,He){a.handleNetworkError(De,Fe,!1,xe,He)},onTimeout:function(xe,De,Fe){a.handleNetworkError(De,Fe,!0,void 0,xe)}};h.load(n,ge,ye)},u.handleMasterPlaylist=function(n,s,a,c){var h=this.hls,g=n.data,m=lo(n,a),S=xs.parseMasterPlaylist(g,m);if(S.playlistParsingError){this.handleManifestParsingError(n,a,S.playlistParsingError,c,s);return}var x=S.contentSteering,U=S.levels,ne=S.sessionData,ue=S.sessionKeys,ge=S.startTimeOffset,ye=S.variableList;this.variableList=ye;var Se=xs.parseMasterPlaylistMedia(g,m,S),xe=Se.AUDIO,De=xe===void 0?[]:xe,Fe=Se.SUBTITLES,He=Se["CLOSED-CAPTIONS"];if(De.length){var rt=De.some(function(ze){return!ze.url});!rt&&U[0].audioCodec&&!U[0].attrs.AUDIO&&(Qe.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),De.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ti({}),bitrate:0,url:""}))}h.trigger(_e.MANIFEST_LOADED,{levels:U,audioTracks:De,subtitles:Fe,captions:He,contentSteering:x,url:m,stats:s,networkDetails:c,sessionData:ne,sessionKeys:ue,startTimeOffset:ge,variableList:ye})},u.handleTrackOrLevelPlaylist=function(n,s,a,c,h){var g=this.hls,m=a.id,S=a.level,x=a.type,U=lo(n,a),ne=0,ue=Ct(S)?S:Ct(m)?m:0,ge=No(a),ye=xs.parseLevelPlaylist(n.data,U,ue,ge,ne,this.variableList);if(x===Jt.MANIFEST){var Se={attrs:new Ti({}),bitrate:0,details:ye,name:"",url:U};g.trigger(_e.MANIFEST_LOADED,{levels:[Se],audioTracks:[],url:U,stats:s,networkDetails:c,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}s.parsing.end=performance.now(),a.levelDetails=ye,this.handlePlaylistLoaded(ye,n,s,a,c,h)},u.handleManifestParsingError=function(n,s,a,c,h){this.hls.trigger(_e.ERROR,{type:Pt.NETWORK_ERROR,details:je.MANIFEST_PARSING_ERROR,fatal:s.type===Jt.MANIFEST,url:n.url,err:a,error:a,reason:a.message,response:n,context:s,networkDetails:c,stats:h})},u.handleNetworkError=function(n,s,a,c,h){a===void 0&&(a=!1);var g="A network "+(a?"timeout":"error"+(c?" (status "+c.code+")":""))+" occurred while loading "+n.type;n.type===Jt.LEVEL?g+=": "+n.level+" id: "+n.id:(n.type===Jt.AUDIO_TRACK||n.type===Jt.SUBTITLE_TRACK)&&(g+=" id: "+n.id+' group-id: "'+n.groupId+'"');var m=new Error(g);Qe.warn("[playlist-loader]: "+g);var S=je.UNKNOWN,x=!1,U=this.getInternalLoader(n);switch(n.type){case Jt.MANIFEST:S=a?je.MANIFEST_LOAD_TIMEOUT:je.MANIFEST_LOAD_ERROR,x=!0;break;case Jt.LEVEL:S=a?je.LEVEL_LOAD_TIMEOUT:je.LEVEL_LOAD_ERROR,x=!1;break;case Jt.AUDIO_TRACK:S=a?je.AUDIO_TRACK_LOAD_TIMEOUT:je.AUDIO_TRACK_LOAD_ERROR,x=!1;break;case Jt.SUBTITLE_TRACK:S=a?je.SUBTITLE_TRACK_LOAD_TIMEOUT:je.SUBTITLE_LOAD_ERROR,x=!1;break}U&&this.resetInternalLoader(n.type);var ne={type:Pt.NETWORK_ERROR,details:S,fatal:x,url:n.url,loader:U,context:n,error:m,networkDetails:s,stats:h};if(c){var ue=s?.url||n.url;ne.response=Ii({url:ue,data:void 0},c)}this.hls.trigger(_e.ERROR,ne)},u.handlePlaylistLoaded=function(n,s,a,c,h,g){var m=this.hls,S=c.type,x=c.level,U=c.id,ne=c.groupId,ue=c.deliveryDirectives,ge=lo(s,c),ye=No(c),Se=typeof c.level=="number"&&ye===Nt.MAIN?x:void 0;if(!n.fragments.length){var xe=new Error("No Segments found in Playlist");m.trigger(_e.ERROR,{type:Pt.NETWORK_ERROR,details:je.LEVEL_EMPTY_ERROR,fatal:!1,url:ge,error:xe,reason:xe.message,response:s,context:c,level:Se,parent:ye,networkDetails:h,stats:a});return}n.targetduration||(n.playlistParsingError=new Error("Missing Target Duration"));var De=n.playlistParsingError;if(De){m.trigger(_e.ERROR,{type:Pt.NETWORK_ERROR,details:je.LEVEL_PARSING_ERROR,fatal:!1,url:ge,error:De,reason:De.message,response:s,context:c,level:Se,parent:ye,networkDetails:h,stats:a});return}switch(n.live&&g&&(g.getCacheAge&&(n.ageHeader=g.getCacheAge()||0),(!g.getCacheAge||isNaN(n.ageHeader))&&(n.ageHeader=0)),S){case Jt.MANIFEST:case Jt.LEVEL:m.trigger(_e.LEVEL_LOADED,{details:n,level:Se||0,id:U||0,stats:a,networkDetails:h,deliveryDirectives:ue});break;case Jt.AUDIO_TRACK:m.trigger(_e.AUDIO_TRACK_LOADED,{details:n,id:U||0,groupId:ne||"",stats:a,networkDetails:h,deliveryDirectives:ue});break;case Jt.SUBTITLE_TRACK:m.trigger(_e.SUBTITLE_TRACK_LOADED,{details:n,id:U||0,groupId:ne||"",stats:a,networkDetails:h,deliveryDirectives:ue});break}},d}();function uo(d,u){var l;try{l=new Event("addtrack")}catch{l=document.createEvent("Event"),l.initEvent("addtrack",!1,!1)}l.track=d,u.dispatchEvent(l)}function Ra(d,u){var l=d.mode;if(l==="disabled"&&(d.mode="hidden"),d.cues&&!d.cues.getCueById(u.id))try{if(d.addCue(u),!d.cues.getCueById(u.id))throw new Error("addCue is failed for: "+u)}catch(s){Qe.debug("[texttrack-utils]: "+s);try{var n=new self.TextTrackCue(u.startTime,u.endTime,u.text);n.id=u.id,d.addCue(n)}catch(a){Qe.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+a)}}l==="disabled"&&(d.mode=l)}function Ds(d){var u=d.mode;if(u==="disabled"&&(d.mode="hidden"),d.cues)for(var l=d.cues.length;l--;)d.removeCue(d.cues[l]);u==="disabled"&&(d.mode=u)}function Or(d,u,l,n){var s=d.mode;if(s==="disabled"&&(d.mode="hidden"),d.cues&&d.cues.length>0)for(var a=ku(d.cues,u,l),c=0;c<a.length;c++)(!n||n(a[c]))&&d.removeCue(a[c]);s==="disabled"&&(d.mode=s)}function ra(d,u){if(u<d[0].startTime)return 0;var l=d.length-1;if(u>d[l].endTime)return-1;for(var n=0,s=l;n<=s;){var a=Math.floor((s+n)/2);if(u<d[a].startTime)s=a-1;else if(u>d[a].startTime&&n<l)n=a+1;else return a}return d[n].startTime-u<u-d[s].startTime?n:s}function ku(d,u,l){var n=[],s=ra(d,u);if(s>-1)for(var a=s,c=d.length;a<c;a++){var h=d[a];if(h.startTime>=u&&h.endTime<=l)n.push(h);else if(h.startTime>l)return n}return n}function ns(d){for(var u=[],l=0;l<d.length;l++){var n=d[l];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&u.push(d[l])}return u}var vn={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},On=.25;function ws(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function xr(d,u,l,n,s){var a=new d(u,l,"");try{a.value=n,s&&(a.type=s)}catch{a=new d(u,l,JSON.stringify(s?Ii({type:s},n):n))}return a}var na=function(){var d=ws();try{d&&new d(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Hi(d,u){return d.getTime()/1e3-u}function Dl(d){return Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var wl=function(){function d(l){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=l,this._registerListeners()}var u=d.prototype;return u.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},u._registerListeners=function(){var n=this.hls;n.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_e.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.on(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(_e.LEVEL_UPDATED,this.onLevelUpdated,this)},u._unregisterListeners=function(){var n=this.hls;n.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_e.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.off(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(_e.LEVEL_UPDATED,this.onLevelUpdated,this)},u.onMediaAttached=function(n,s){this.media=s.media},u.onMediaDetaching=function(){this.id3Track&&(Ds(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},u.onManifestLoading=function(){this.dateRangeCuesAppended={}},u.createTrack=function(n){var s=this.getID3Track(n.textTracks);return s.mode="hidden",s},u.getID3Track=function(n){if(this.media){for(var s=0;s<n.length;s++){var a=n[s];if(a.kind==="metadata"&&a.label==="id3")return uo(a,this.media),a}return this.media.addTextTrack("metadata","id3")}},u.onFragParsingMetadata=function(n,s){if(this.media){var a=this.hls.config,c=a.enableEmsgMetadataCues,h=a.enableID3MetadataCues;if(!(!c&&!h)){var g=s.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var m=ws();if(m)for(var S=0;S<g.length;S++){var x=g[S].type;if(!(x===vn.emsg&&!c||!h)){var U=mr(g[S].data);if(U){var ne=g[S].pts,ue=ne+g[S].duration;ue>na&&(ue=na);var ge=ue-ne;ge<=0&&(ue=ne+On);for(var ye=0;ye<U.length;ye++){var Se=U[ye];if(!Ws(Se)){this.updateId3CueEnds(ne,x);var xe=xr(m,ne,ue,Se,x);xe&&this.id3Track.addCue(xe)}}}}}}}},u.updateId3CueEnds=function(n,s){var a,c=(a=this.id3Track)==null?void 0:a.cues;if(c)for(var h=c.length;h--;){var g=c[h];g.type===s&&g.startTime<n&&g.endTime===na&&(g.endTime=n)}},u.onBufferFlushing=function(n,s){var a=s.startOffset,c=s.endOffset,h=s.type,g=this.id3Track,m=this.hls;if(m){var S=m.config,x=S.enableEmsgMetadataCues,U=S.enableID3MetadataCues;if(g&&(x||U)){var ne;h==="audio"?ne=function(ge){return ge.type===vn.audioId3&&U}:h==="video"?ne=function(ge){return ge.type===vn.emsg&&x}:ne=function(ge){return ge.type===vn.audioId3&&U||ge.type===vn.emsg&&x},Or(g,a,c,ne)}}},u.onLevelUpdated=function(n,s){var a=this,c=s.details;if(!(!this.media||!c.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var h=this.dateRangeCuesAppended,g=this.id3Track,m=c.dateRanges,S=Object.keys(m);if(g)for(var x=Object.keys(h).filter(function(De){return!S.includes(De)}),U=function(){var Fe=x[ne];Object.keys(h[Fe].cues).forEach(function(He){g.removeCue(h[Fe].cues[He])}),delete h[Fe]},ne=x.length;ne--;)U();var ue=c.fragments[c.fragments.length-1];if(!(S.length===0||!Ct(ue?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var ge=ue.programDateTime/1e3-ue.start,ye=ws(),Se=function(){var Fe=S[xe],He=m[Fe],rt=Hi(He.startDate,ge),ze=h[Fe],Ve=ze?.cues||{},Ze=ze?.durationKnown||!1,et=na,ot=He.endDate;if(ot)et=Hi(ot,ge),Ze=!0;else if(He.endOnNext&&!Ze){var ct=S.reduce(function(ei,Kt){if(Kt!==He.id){var Ai=m[Kt];if(Ai.class===He.class&&Ai.startDate>He.startDate&&(!ei||He.startDate<ei.startDate))return Ai}return ei},null);ct&&(et=Hi(ct.startDate,ge),Ze=!0)}for(var yt=Object.keys(He.attr),wt=0;wt<yt.length;wt++){var It=yt[wt];if(ba(It)){var Ht=Ve[It];if(Ht)Ze&&!ze.durationKnown&&(Ht.endTime=et);else if(ye){var jt=He.attr[It];Vn(It)&&(jt=Dl(jt));var Zt=xr(ye,rt,et,{key:It,data:jt},vn.dateRange);Zt&&(Zt.id=Fe,a.id3Track.addCue(Zt),Ve[It]=Zt)}}}h[Fe]={cues:Ve,dateRange:He,durationKnown:Ze}},xe=0;xe<S.length;xe++)Se()}}},d}(),Ll=function(){function d(l){var n=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return n.timeupdate()},this.hls=l,this.config=l.config,this.registerListeners()}var u=d.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},u.registerListeners=function(){this.hls.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_e.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(_e.ERROR,this.onError,this)},u.unregisterListeners=function(){this.hls.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(_e.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(_e.ERROR,this.onError,this)},u.onMediaAttached=function(n,s){this.media=s.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},u.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},u.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},u.onLevelUpdated=function(n,s){var a=s.details;this.levelDetails=a,a.advanced&&this.timeupdate(),!a.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},u.onError=function(n,s){var a;s.details===je.BUFFER_STALLED_ERROR&&(this.stallCount++,(a=this.levelDetails)!=null&&a.live&&Qe.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},u.timeupdate=function(){var n=this.media,s=this.levelDetails;if(!(!n||!s)){this.currentTime=n.currentTime;var a=this.computeLatency();if(a!==null){this._latency=a;var c=this.config,h=c.lowLatencyMode,g=c.maxLiveSyncPlaybackRate;if(!(!h||g===1||!s.live)){var m=this.targetLatency;if(m!==null){var S=a-m,x=Math.min(this.maxLatency,m+s.targetduration),U=S<x;if(U&&S>.05&&this.forwardBufferLength>1){var ne=Math.min(2,Math.max(1,g)),ue=Math.round(2/(1+Math.exp(-.75*S-this.edgeStalled))*20)/20;n.playbackRate=Math.min(ne,Math.max(1,ue))}else n.playbackRate!==1&&n.playbackRate!==0&&(n.playbackRate=1)}}}}},u.estimateLiveEdge=function(){var n=this.levelDetails;return n===null?null:n.edge+n.age},u.computeLatency=function(){var n=this.estimateLiveEdge();return n===null?null:n-this.currentTime},ki(d,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var n=this.config,s=this.levelDetails;return n.liveMaxLatencyDuration!==void 0?n.liveMaxLatencyDuration:s?n.liveMaxLatencyDurationCount*s.targetduration:0}},{key:"targetLatency",get:function(){var n=this.levelDetails;if(n===null)return null;var s=n.holdBack,a=n.partHoldBack,c=n.targetduration,h=this.config,g=h.liveSyncDuration,m=h.liveSyncDurationCount,S=h.lowLatencyMode,x=this.hls.userConfig,U=S&&a||s;(x.liveSyncDuration||x.liveSyncDurationCount||U===0)&&(U=g!==void 0?g:m*c);var ne=c,ue=1;return U+Math.min(this.stallCount*ue,ne)}},{key:"liveSyncPosition",get:function(){var n=this.estimateLiveEdge(),s=this.targetLatency,a=this.levelDetails;if(n===null||s===null||a===null)return null;var c=a.edge,h=n-s-this.edgeStalled,g=c-a.totalduration,m=c-(this.config.lowLatencyMode&&a.partTarget||a.targetduration);return Math.min(Math.max(g,h),m)}},{key:"drift",get:function(){var n=this.levelDetails;return n===null?1:n.drift}},{key:"edgeStalled",get:function(){var n=this.levelDetails;if(n===null)return 0;var s=(this.config.lowLatencyMode&&n.partTarget||n.targetduration)*3;return Math.max(n.age-s,0)}},{key:"forwardBufferLength",get:function(){var n=this.media,s=this.levelDetails;if(!n||!s)return 0;var a=n.buffered.length;return(a?n.buffered.end(a-1):s.edge)-this.currentTime}}]),d}(),gi=["NONE","TYPE-0","TYPE-1",null];function Du(d){return gi.indexOf(d)>-1}var Pa=["SDR","PQ","HLG"];function wu(d){return!!d&&Pa.indexOf(d)>-1}var Ls={No:"",Yes:"YES",v2:"v2"};function J(d){var u=d.canSkipUntil,l=d.canSkipDateRanges,n=d.age,s=n<u/2;return u&&s?l?Ls.v2:Ls.Yes:Ls.No}var ee=function(){function d(l,n,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=l,this.part=n,this.skip=s}var u=d.prototype;return u.addDirectives=function(n){var s=new self.URL(n);return this.msn!==void 0&&s.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&s.searchParams.set("_HLS_part",this.part.toString()),this.skip&&s.searchParams.set("_HLS_skip",this.skip),s.href},d}(),j=function(){function d(l){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[l.url],this._attrs=[l.attrs],this.bitrate=l.bitrate,l.details&&(this.details=l.details),this.id=l.id||0,this.name=l.name,this.width=l.width||0,this.height=l.height||0,this.frameRate=l.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=l.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=l.audioCodec,this.videoCodec=l.videoCodec,this.codecSet=[l.videoCodec,l.audioCodec].filter(function(n){return!!n}).map(function(n){return n.substring(0,4)}).join(","),this.addGroupId("audio",l.attrs.AUDIO),this.addGroupId("text",l.attrs.SUBTITLES)}var u=d.prototype;return u.hasAudioGroup=function(n){return y(this._audioGroups,n)},u.hasSubtitleGroup=function(n){return y(this._subtitleGroups,n)},u.addGroupId=function(n,s){if(s){if(n==="audio"){var a=this._audioGroups;a||(a=this._audioGroups=[]),a.indexOf(s)===-1&&a.push(s)}else if(n==="text"){var c=this._subtitleGroups;c||(c=this._subtitleGroups=[]),c.indexOf(s)===-1&&c.push(s)}}},u.addFallback=function(){},ki(d,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(n){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var n;return(n=this.audioGroups)==null?void 0:n[0]}},{key:"textGroupId",get:function(){var n;return(n=this.subtitleGroups)==null?void 0:n[0]}}]),d}();function y(d,u){return!u||!d?!1:d.indexOf(u)!==-1}function F(d,u){var l=u.startPTS;if(Ct(l)){var n=0,s;u.sn>d.sn?(n=l-d.start,s=d):(n=d.start-l,s=u),s.duration!==n&&(s.duration=n)}else if(u.sn>d.sn){var a=d.cc===u.cc;a&&d.minEndPTS?u.start=d.start+(d.minEndPTS-d.start):u.start=d.start+d.duration}else u.start=Math.max(d.start-u.duration,0)}function re(d,u,l,n,s,a){var c=n-l;c<=0&&(Qe.warn("Fragment should have a positive duration",u),n=l+u.duration,a=s+u.duration);var h=l,g=n,m=u.startPTS,S=u.endPTS;if(Ct(m)){var x=Math.abs(m-l);Ct(u.deltaPTS)?u.deltaPTS=Math.max(x,u.deltaPTS):u.deltaPTS=x,h=Math.max(l,m),l=Math.min(l,m),s=Math.min(s,u.startDTS),g=Math.min(n,S),n=Math.max(n,S),a=Math.max(a,u.endDTS)}var U=l-u.start;u.start!==0&&(u.start=l),u.duration=n-u.start,u.startPTS=l,u.maxStartPTS=h,u.startDTS=s,u.endPTS=n,u.minEndPTS=g,u.endDTS=a;var ne=u.sn;if(!d||ne<d.startSN||ne>d.endSN)return 0;var ue,ge=ne-d.startSN,ye=d.fragments;for(ye[ge]=u,ue=ge;ue>0;ue--)F(ye[ue],ye[ue-1]);for(ue=ge;ue<ye.length-1;ue++)F(ye[ue],ye[ue+1]);return d.fragmentHint&&F(ye[ye.length-1],d.fragmentHint),d.PTSKnown=d.alignedSliding=!0,U}function C(d,u){for(var l=null,n=d.fragments,s=n.length-1;s>=0;s--){var a=n[s].initSegment;if(a){l=a;break}}d.fragmentHint&&delete d.fragmentHint.endPTS;var c=0,h;if(de(d,u,function(ue,ge){ue.relurl&&(c=ue.cc-ge.cc),Ct(ue.startPTS)&&Ct(ue.endPTS)&&(ge.start=ge.startPTS=ue.startPTS,ge.startDTS=ue.startDTS,ge.maxStartPTS=ue.maxStartPTS,ge.endPTS=ue.endPTS,ge.endDTS=ue.endDTS,ge.minEndPTS=ue.minEndPTS,ge.duration=ue.endPTS-ue.startPTS,ge.duration&&(h=ge),u.PTSKnown=u.alignedSliding=!0),ge.elementaryStreams=ue.elementaryStreams,ge.loader=ue.loader,ge.stats=ue.stats,ue.initSegment&&(ge.initSegment=ue.initSegment,l=ue.initSegment)}),l){var g=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments;g.forEach(function(ue){var ge;ue&&(!ue.initSegment||ue.initSegment.relurl===((ge=l)==null?void 0:ge.relurl))&&(ue.initSegment=l)})}if(u.skippedSegments)if(u.deltaUpdateFailed=u.fragments.some(function(ue){return!ue}),u.deltaUpdateFailed){Qe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var m=u.skippedSegments;m--;)u.fragments.shift();u.startSN=u.fragments[0].sn,u.startCC=u.fragments[0].cc}else u.canSkipDateRanges&&(u.dateRanges=z(d.dateRanges,u.dateRanges,u.recentlyRemovedDateranges));var S=u.fragments;if(c){Qe.warn("discontinuity sliding from playlist, take drift into account");for(var x=0;x<S.length;x++)S[x].cc+=c}u.skippedSegments&&(u.startCC=u.fragments[0].cc),G(d.partList,u.partList,function(ue,ge){ge.elementaryStreams=ue.elementaryStreams,ge.stats=ue.stats}),h?re(u,h,h.startPTS,h.endPTS,h.startDTS,h.endDTS):te(d,u),S.length&&(u.totalduration=u.edge-S[0].start),u.driftStartTime=d.driftStartTime,u.driftStart=d.driftStart;var U=u.advancedDateTime;if(u.advanced&&U){var ne=u.edge;u.driftStart||(u.driftStartTime=U,u.driftStart=ne),u.driftEndTime=U,u.driftEnd=ne}else u.driftEndTime=d.driftEndTime,u.driftEnd=d.driftEnd,u.advancedDateTime=d.advancedDateTime}function z(d,u,l){var n=Di({},d);return l&&l.forEach(function(s){delete n[s]}),Object.keys(u).forEach(function(s){var a=new Hn(u[s].attr,n[s]);a.isValid?n[s]=a:Qe.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(u[s].attr)+'"')}),n}function G(d,u,l){if(d&&u)for(var n=0,s=0,a=d.length;s<=a;s++){var c=d[s],h=u[s+n];c&&h&&c.index===h.index&&c.fragment.sn===h.fragment.sn?l(c,h):n--}}function de(d,u,l){for(var n=u.skippedSegments,s=Math.max(d.startSN,u.startSN)-u.startSN,a=(d.fragmentHint?1:0)+(n?u.endSN:Math.min(d.endSN,u.endSN))-u.startSN,c=u.startSN-d.startSN,h=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments,g=d.fragmentHint?d.fragments.concat(d.fragmentHint):d.fragments,m=s;m<=a;m++){var S=g[c+m],x=h[m];n&&!x&&m<n&&(x=u.fragments[m]=S),S&&x&&l(S,x)}}function te(d,u){var l=u.startSN+u.skippedSegments-d.startSN,n=d.fragments;l<0||l>=n.length||le(u,n[l].start)}function le(d,u){if(u){for(var l=d.fragments,n=d.skippedSegments;n<l.length;n++)l[n].start+=u;d.fragmentHint&&(d.fragmentHint.start+=u)}}function Q(d,u){u===void 0&&(u=1/0);var l=1e3*d.targetduration;if(d.updated){var n=d.fragments,s=4;if(n.length&&l*s>u){var a=n[n.length-1].duration*1e3;a<l&&(l=a)}}else l/=2;return Math.round(l)}function X(d,u,l){if(!(d!=null&&d.details))return null;var n=d.details,s=n.fragments[u-n.startSN];return s||(s=n.fragmentHint,s&&s.sn===u)?s:u<n.startSN&&l&&l.sn===u?l:null}function ie(d,u,l){var n;return d!=null&&d.details?W((n=d.details)==null?void 0:n.partList,u,l):null}function W(d,u,l){if(d)for(var n=d.length;n--;){var s=d[n];if(s.index===l&&s.fragment.sn===u)return s}return null}function se(d){d.forEach(function(u,l){var n=u.details;n!=null&&n.fragments&&n.fragments.forEach(function(s){s.level=l})})}function Y(d){switch(d.details){case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_TIMEOUT:case je.LEVEL_LOAD_TIMEOUT:case je.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function V(d,u){var l=Y(u);return d.default[(l?"timeout":"error")+"Retry"]}function M(d,u){var l=d.backoff==="linear"?1:Math.pow(2,u);return Math.min(l*d.retryDelayMs,d.maxRetryDelayMs)}function b(d){return Ii(Ii({},d),{errorRetry:null,timeoutRetry:null})}function I(d,u,l,n){if(!d)return!1;var s=n?.code,a=u<d.maxNumRetry&&(w(s)||!!l);return d.shouldRetry?d.shouldRetry(d,u,l,n,a):a}function w(d){return d===0&&navigator.onLine===!1||!!d&&(d<400||d>499)}var P={search:function(u,l){for(var n=0,s=u.length-1,a=null,c=null;n<=s;){a=(n+s)/2|0,c=u[a];var h=l(c);if(h>0)n=a+1;else if(h<0)s=a-1;else return c}return null}};function _(d,u,l){if(u===null||!Array.isArray(d)||!d.length||!Ct(u))return null;var n=d[0].programDateTime;if(u<(n||0))return null;var s=d[d.length-1].endProgramDateTime;if(u>=(s||0))return null;l=l||0;for(var a=0;a<d.length;++a){var c=d[a];if(O(u,l,c))return c}return null}function v(d,u,l,n,s){l===void 0&&(l=0),n===void 0&&(n=0),s===void 0&&(s=.005);var a=null;if(d){a=u[d.sn-u[0].sn+1]||null;var c=d.endDTS-l;c>0&&c<15e-7&&(l+=15e-7)}else l===0&&u[0].start===0&&(a=u[0]);if(a&&((!d||d.level===a.level)&&D(l,n,a)===0||A(a,d,Math.min(s,n))))return a;var h=P.search(u,D.bind(null,l,n));return h&&(h!==d||!a)?h:a}function A(d,u,l){if(u&&u.start===0&&u.level<d.level&&(u.endPTS||0)>0){var n=u.tagList.reduce(function(s,a){return a[0]==="INF"&&(s+=parseFloat(a[1])),s},l);return d.start<=n}return!1}function D(d,u,l){if(d===void 0&&(d=0),u===void 0&&(u=0),l.start<=d&&l.start+l.duration>d)return 0;var n=Math.min(u,l.duration+(l.deltaPTS?l.deltaPTS:0));return l.start+l.duration-n<=d?1:l.start-n>d&&l.start?-1:0}function O(d,u,l){var n=Math.min(u,l.duration+(l.deltaPTS?l.deltaPTS:0))*1e3,s=l.endProgramDateTime||0;return s-n>d}function K(d,u){return P.search(d,function(l){return l.cc<u?1:l.cc>u?-1:0})}var k={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},L={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},R=function(){function d(l){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=l,this.log=Qe.log.bind(Qe,"[info]:"),this.warn=Qe.warn.bind(Qe,"[warning]:"),this.error=Qe.error.bind(Qe,"[error]:"),this.registerListeners()}var u=d.prototype;return u.registerListeners=function(){var n=this.hls;n.on(_e.ERROR,this.onError,this),n.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_e.LEVEL_UPDATED,this.onLevelUpdated,this)},u.unregisterListeners=function(){var n=this.hls;n&&(n.off(_e.ERROR,this.onError,this),n.off(_e.ERROR,this.onErrorOut,this),n.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_e.LEVEL_UPDATED,this.onLevelUpdated,this))},u.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},u.startLoad=function(n){},u.stopLoad=function(){this.playlistError=0},u.getVariantLevelIndex=function(n){return n?.type===Nt.MAIN?n.level:this.hls.loadLevel},u.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},u.onLevelUpdated=function(){this.playlistError=0},u.onError=function(n,s){var a,c;if(!s.fatal){var h=this.hls,g=s.context;switch(s.details){case je.FRAG_LOAD_ERROR:case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_ERROR:case je.KEY_LOAD_TIMEOUT:s.errorAction=this.getFragRetryOrSwitchAction(s);return;case je.FRAG_PARSING_ERROR:if((a=s.frag)!=null&&a.gap){s.errorAction={action:k.DoNothing,flags:L.None};return}case je.FRAG_GAP:case je.FRAG_DECRYPT_ERROR:{s.errorAction=this.getFragRetryOrSwitchAction(s),s.errorAction.action=k.SendAlternateToPenaltyBox;return}case je.LEVEL_EMPTY_ERROR:case je.LEVEL_PARSING_ERROR:{var m,S,x=s.parent===Nt.MAIN?s.level:h.loadLevel;s.details===je.LEVEL_EMPTY_ERROR&&((m=s.context)!=null&&(S=m.levelDetails)!=null&&S.live)?s.errorAction=this.getPlaylistRetryOrSwitchAction(s,x):(s.levelRetry=!1,s.errorAction=this.getLevelSwitchAction(s,x))}return;case je.LEVEL_LOAD_ERROR:case je.LEVEL_LOAD_TIMEOUT:typeof g?.level=="number"&&(s.errorAction=this.getPlaylistRetryOrSwitchAction(s,g.level));return;case je.AUDIO_TRACK_LOAD_ERROR:case je.AUDIO_TRACK_LOAD_TIMEOUT:case je.SUBTITLE_LOAD_ERROR:case je.SUBTITLE_TRACK_LOAD_TIMEOUT:if(g){var U=h.levels[h.loadLevel];if(U&&(g.type===Jt.AUDIO_TRACK&&U.hasAudioGroup(g.groupId)||g.type===Jt.SUBTITLE_TRACK&&U.hasSubtitleGroup(g.groupId))){s.errorAction=this.getPlaylistRetryOrSwitchAction(s,h.loadLevel),s.errorAction.action=k.SendAlternateToPenaltyBox,s.errorAction.flags=L.MoveAllAlternatesMatchingHost;return}}return;case je.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var ne=h.levels[h.loadLevel],ue=ne?.attrs["HDCP-LEVEL"];ue?s.errorAction={action:k.SendAlternateToPenaltyBox,flags:L.MoveAllAlternatesMatchingHDCP,hdcpLevel:ue}:this.keySystemError(s)}return;case je.BUFFER_ADD_CODEC_ERROR:case je.REMUX_ALLOC_ERROR:case je.BUFFER_APPEND_ERROR:s.errorAction=this.getLevelSwitchAction(s,(c=s.level)!=null?c:h.loadLevel);return;case je.INTERNAL_EXCEPTION:case je.BUFFER_APPENDING_ERROR:case je.BUFFER_FULL_ERROR:case je.LEVEL_SWITCH_ERROR:case je.BUFFER_STALLED_ERROR:case je.BUFFER_SEEK_OVER_HOLE:case je.BUFFER_NUDGE_ON_STALL:s.errorAction={action:k.DoNothing,flags:L.None};return}s.type===Pt.KEY_SYSTEM_ERROR&&this.keySystemError(s)}},u.keySystemError=function(n){var s=this.getVariantLevelIndex(n.frag);n.levelRetry=!1,n.errorAction=this.getLevelSwitchAction(n,s)},u.getPlaylistRetryOrSwitchAction=function(n,s){var a=this.hls,c=V(a.config.playlistLoadPolicy,n),h=this.playlistError++,g=I(c,h,Y(n),n.response);if(g)return{action:k.RetryRequest,flags:L.None,retryConfig:c,retryCount:h};var m=this.getLevelSwitchAction(n,s);return c&&(m.retryConfig=c,m.retryCount=h),m},u.getFragRetryOrSwitchAction=function(n){var s=this.hls,a=this.getVariantLevelIndex(n.frag),c=s.levels[a],h=s.config,g=h.fragLoadPolicy,m=h.keyLoadPolicy,S=V(n.details.startsWith("key")?m:g,n),x=s.levels.reduce(function(ue,ge){return ue+ge.fragmentError},0);if(c){n.details!==je.FRAG_GAP&&c.fragmentError++;var U=I(S,x,Y(n),n.response);if(U)return{action:k.RetryRequest,flags:L.None,retryConfig:S,retryCount:x}}var ne=this.getLevelSwitchAction(n,a);return S&&(ne.retryConfig=S,ne.retryCount=x),ne},u.getLevelSwitchAction=function(n,s){var a=this.hls;s==null&&(s=a.loadLevel);var c=this.hls.levels[s];if(c){var h,g,m=n.details;c.loadError++,m===je.BUFFER_APPEND_ERROR&&c.fragmentError++;var S=-1,x=a.levels,U=a.loadLevel,ne=a.minAutoLevel,ue=a.maxAutoLevel;a.autoLevelEnabled||(a.loadLevel=-1);for(var ge=(h=n.frag)==null?void 0:h.type,ye=ge===Nt.AUDIO&&m===je.FRAG_PARSING_ERROR||n.sourceBufferName==="audio"&&(m===je.BUFFER_ADD_CODEC_ERROR||m===je.BUFFER_APPEND_ERROR),Se=ye&&x.some(function(et){var ot=et.audioCodec;return c.audioCodec!==ot}),xe=n.sourceBufferName==="video"&&(m===je.BUFFER_ADD_CODEC_ERROR||m===je.BUFFER_APPEND_ERROR),De=xe&&x.some(function(et){var ot=et.codecSet,ct=et.audioCodec;return c.codecSet!==ot&&c.audioCodec===ct}),Fe=(g=n.context)!=null?g:{},He=Fe.type,rt=Fe.groupId,ze=function(){var ot=(Ze+U)%x.length;if(ot!==U&&ot>=ne&&ot<=ue&&x[ot].loadError===0){var ct,yt,wt=x[ot];if(m===je.FRAG_GAP&&ge===Nt.MAIN&&n.frag){var It=x[ot].details;if(It){var Ht=v(n.frag,It.fragments,n.frag.start);if(Ht!=null&&Ht.gap)return 0}}else{if(He===Jt.AUDIO_TRACK&&wt.hasAudioGroup(rt)||He===Jt.SUBTITLE_TRACK&&wt.hasSubtitleGroup(rt))return 0;if(ge===Nt.AUDIO&&(ct=c.audioGroups)!=null&&ct.some(function(jt){return wt.hasAudioGroup(jt)})||ge===Nt.SUBTITLE&&(yt=c.subtitleGroups)!=null&&yt.some(function(jt){return wt.hasSubtitleGroup(jt)})||Se&&c.audioCodec===wt.audioCodec||!Se&&c.audioCodec!==wt.audioCodec||De&&c.codecSet===wt.codecSet)return 0}return S=ot,1}},Ve,Ze=x.length;Ze--&&(Ve=ze(),!(Ve!==0&&Ve===1)););if(S>-1&&a.loadLevel!==S)return n.levelRetry=!0,this.playlistError=0,{action:k.SendAlternateToPenaltyBox,flags:L.None,nextAutoLevel:S}}return{action:k.SendAlternateToPenaltyBox,flags:L.MoveAllAlternatesMatchingHost}},u.onErrorOut=function(n,s){var a;switch((a=s.errorAction)==null?void 0:a.action){case k.DoNothing:break;case k.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(s),!s.errorAction.resolved&&s.details!==je.FRAG_GAP?s.fatal=!0:/MediaSource readyState: ended/.test(s.error.message)&&(this.warn('MediaSource ended after "'+s.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError());break}if(s.fatal){this.hls.stopLoad();return}},u.sendAlternateToPenaltyBox=function(n){var s=this.hls,a=n.errorAction;if(a){var c=a.flags,h=a.hdcpLevel,g=a.nextAutoLevel;switch(c){case L.None:this.switchLevel(n,g);break;case L.MoveAllAlternatesMatchingHDCP:h&&(s.maxHdcpLevel=gi[gi.indexOf(h)-1],a.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+s.maxHdcpLevel+'" or lower');break}a.resolved||this.switchLevel(n,g)}},u.switchLevel=function(n,s){s!==void 0&&n.errorAction&&(this.warn("switching to level "+s+" after "+n.details),this.hls.nextAutoLevel=s,n.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},d}(),Z=function(){function d(l,n){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=Qe.log.bind(Qe,n+":"),this.warn=Qe.warn.bind(Qe,n+":"),this.hls=l}var u=d.prototype;return u.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},u.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},u.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},u.stopLoad=function(){this.canLoad=!1,this.clearTimer()},u.switchParams=function(n,s,a){var c=s?.renditionReports;if(c){for(var h=-1,g=0;g<c.length;g++){var m=c[g],S=void 0;try{S=new self.URL(m.URI,s.url).href}catch(ye){Qe.warn("Could not construct new URL for Rendition Report: "+ye),S=m.URI||""}if(S===n){h=g;break}else S===n.substring(0,S.length)&&(h=g)}if(h!==-1){var x=c[h],U=parseInt(x["LAST-MSN"])||s?.lastPartSn,ne=parseInt(x["LAST-PART"])||s?.lastPartIndex;if(this.hls.config.lowLatencyMode){var ue=Math.min(s.age-s.partTarget,s.targetduration);ne>=0&&ue>s.partTarget&&(ne+=1)}var ge=a&&J(a);return new ee(U,ne>=0?ne:void 0,ge)}}},u.loadPlaylist=function(n){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},u.shouldLoadPlaylist=function(n){return this.canLoad&&!!n&&!!n.url&&(!n.details||n.details.live)},u.shouldReloadPlaylist=function(n){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(n)},u.playlistLoaded=function(n,s,a){var c=this,h=s.details,g=s.stats,m=self.performance.now(),S=g.loading.first?Math.max(0,m-g.loading.first):0;if(h.advancedDateTime=Date.now()-S,h.live||a!=null&&a.live){if(h.reloaded(a),a&&this.log("live playlist "+n+" "+(h.advanced?"REFRESHED "+h.lastPartSn+"-"+h.lastPartIndex:h.updated?"UPDATED":"MISSED")),a&&h.fragments.length>0&&C(a,h),!this.canLoad||!h.live)return;var x,U=void 0,ne=void 0;if(h.canBlockReload&&h.endSN&&h.advanced){var ue=this.hls.config.lowLatencyMode,ge=h.lastPartSn,ye=h.endSN,Se=h.lastPartIndex,xe=Se!==-1,De=ge===ye,Fe=ue?0:Se;xe?(U=De?ye+1:ge,ne=De?Fe:Se+1):U=ye+1;var He=h.age,rt=He+h.ageHeader,ze=Math.min(rt-h.partTarget,h.targetduration*1.5);if(ze>0){if(a&&ze>a.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+a.tuneInGoal+" to: "+ze+" with playlist age: "+h.age),ze=0;else{var Ve=Math.floor(ze/h.targetduration);if(U+=Ve,ne!==void 0){var Ze=Math.round(ze%h.targetduration/h.partTarget);ne+=Ze}this.log("CDN Tune-in age: "+h.ageHeader+"s last advanced "+He.toFixed(2)+"s goal: "+ze+" skip sn "+Ve+" to part "+ne)}h.tuneInGoal=ze}if(x=this.getDeliveryDirectives(h,s.deliveryDirectives,U,ne),ue||!De){this.loadPlaylist(x);return}}else(h.canBlockReload||h.canSkipUntil)&&(x=this.getDeliveryDirectives(h,s.deliveryDirectives,U,ne));var et=this.hls.mainForwardBufferInfo,ot=et?et.end-et.len:0,ct=(h.edge-ot)*1e3,yt=Q(h,ct);h.updated&&m>this.requestScheduled+yt&&(this.requestScheduled=g.loading.start),U!==void 0&&h.canBlockReload?this.requestScheduled=g.loading.first+yt-(h.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+yt<m?this.requestScheduled=m:this.requestScheduled-m<=0&&(this.requestScheduled+=yt);var wt=this.requestScheduled-m;wt=Math.max(0,wt),this.log("reload live playlist "+n+" in "+Math.round(wt)+" ms"),this.timer=self.setTimeout(function(){return c.loadPlaylist(x)},wt)}else this.clearTimer()},u.getDeliveryDirectives=function(n,s,a,c){var h=J(n);return s!=null&&s.skip&&n.deltaUpdateFailed&&(a=s.msn,c=s.part,h=Ls.No),new ee(a,c,h)},u.checkRetry=function(n){var s=this,a=n.details,c=Y(n),h=n.errorAction,g=h||{},m=g.action,S=g.retryCount,x=S===void 0?0:S,U=g.retryConfig,ne=!!h&&!!U&&(m===k.RetryRequest||!h.resolved&&m===k.SendAlternateToPenaltyBox);if(ne){var ue;if(this.requestScheduled=-1,x>=U.maxNumRetry)return!1;if(c&&(ue=n.context)!=null&&ue.deliveryDirectives)this.warn("Retrying playlist loading "+(x+1)+"/"+U.maxNumRetry+' after "'+a+'" without delivery-directives'),this.loadPlaylist();else{var ge=M(U,x);this.timer=self.setTimeout(function(){return s.loadPlaylist()},ge),this.warn("Retrying playlist loading "+(x+1)+"/"+U.maxNumRetry+' after "'+a+'" in '+ge+"ms")}n.levelRetry=!0,h.resolved=!0}return ne},d}(),ae=function(){function d(l,n,s){n===void 0&&(n=0),s===void 0&&(s=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=l,this.alpha_=l?Math.exp(Math.log(.5)/l):0,this.estimate_=n,this.totalWeight_=s}var u=d.prototype;return u.sample=function(n,s){var a=Math.pow(this.alpha_,n);this.estimate_=s*(1-a)+a*this.estimate_,this.totalWeight_+=n},u.getTotalWeight=function(){return this.totalWeight_},u.getEstimate=function(){if(this.alpha_){var n=1-Math.pow(this.alpha_,this.totalWeight_);if(n)return this.estimate_/n}return this.estimate_},d}(),fe=function(){function d(l,n,s,a){a===void 0&&(a=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ae(l),this.fast_=new ae(n),this.defaultTTFB_=a,this.ttfb_=new ae(l)}var u=d.prototype;return u.update=function(n,s){var a=this.slow_,c=this.fast_,h=this.ttfb_;a.halfLife!==n&&(this.slow_=new ae(n,a.getEstimate(),a.getTotalWeight())),c.halfLife!==s&&(this.fast_=new ae(s,c.getEstimate(),c.getTotalWeight())),h.halfLife!==n&&(this.ttfb_=new ae(n,h.getEstimate(),h.getTotalWeight()))},u.sample=function(n,s){n=Math.max(n,this.minDelayMs_);var a=8*s,c=n/1e3,h=a/c;this.fast_.sample(c,h),this.slow_.sample(c,h)},u.sampleTTFB=function(n){var s=n/1e3,a=Math.sqrt(2)*Math.exp(-Math.pow(s,2)/2);this.ttfb_.sample(a,Math.max(n,5))},u.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},u.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},u.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},u.destroy=function(){},d}(),ce={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},me={};function Ee(d,u,l,n,s,a){var c=d.audioCodec?d.audioGroups:null,h=a?.audioCodec,g=a?.channels,m=g?parseInt(g):h?1/0:2,S=null;if(c!=null&&c.length)try{c.length===1&&c[0]?S=u.groups[c[0]].channels:S=c.reduce(function(x,U){if(U){var ne=u.groups[U];if(!ne)throw new Error("Audio track group "+U+" not found");Object.keys(ne.channels).forEach(function(ue){x[ue]=(x[ue]||0)+ne.channels[ue]})}return x},{2:0})}catch{return!0}return d.videoCodec!==void 0&&(d.width>1920&&d.height>1088||d.height>1920&&d.width>1088||d.frameRate>Math.max(n,30)||d.videoRange!=="SDR"&&d.videoRange!==l||d.bitrate>Math.max(s,8e6))||!!S&&Ct(m)&&Object.keys(S).some(function(x){return parseInt(x)>m})}function be(d,u,l){var n=d.videoCodec,s=d.audioCodec;if(!n||!s||!l)return Promise.resolve(ce);var a={width:d.width,height:d.height,bitrate:Math.ceil(Math.max(d.bitrate*.9,d.averageBitrate)),framerate:d.frameRate||30},c=d.videoRange;c!=="SDR"&&(a.transferFunction=c.toLowerCase());var h=n.split(",").map(function(g){return{type:"media-source",video:Ii(Ii({},a),{},{contentType:Ss(g,"video")})}});return s&&d.audioGroups&&d.audioGroups.forEach(function(g){var m;g&&((m=u.groups[g])==null||m.tracks.forEach(function(S){if(S.groupId===g){var x=S.channels||"",U=parseFloat(x);Ct(U)&&U>2&&h.push.apply(h,s.split(",").map(function(ne){return{type:"media-source",audio:{contentType:Ss(ne,"audio"),channels:""+U}}}))}}))}),Promise.all(h.map(function(g){var m=Re(g);return me[m]||(me[m]=l.decodingInfo(g))})).then(function(g){return{supported:!g.some(function(m){return!m.supported}),configurations:h,decodingInfoResults:g}}).catch(function(g){return{supported:!1,configurations:h,decodingInfoResults:[],error:g}})}function Re(d){var u=d.audio,l=d.video,n=l||u;if(n){var s=n.contentType.split('"')[1];if(l)return"r"+l.height+"x"+l.width+"f"+Math.ceil(l.framerate)+(l.transferFunction||"sd")+"_"+s+"_"+Math.ceil(l.bitrate/1e5);if(u)return"c"+u.channels+(u.spatialRendering?"s":"n")+"_"+s}return""}function Ce(){if(typeof matchMedia=="function"){var d=matchMedia("(dynamic-range: high)"),u=matchMedia("bad query");if(d.media!==u.media)return d.matches===!0}return!1}function Ne(d,u){var l=!1,n=[];return d&&(l=d!=="SDR",n=[d]),u&&(n=u.allowedVideoRanges||Pa.slice(0),l=u.preferHDR!==void 0?u.preferHDR:Ce(),l?n=n.filter(function(s){return s!=="SDR"}):n=["SDR"]),{preferHDR:l,allowedVideoRanges:n}}function Ue(d,u,l,n,s){for(var a=Object.keys(d),c=n?.channels,h=n?.audioCodec,g=c&&parseInt(c)===2,m=!0,S=!1,x=1/0,U=1/0,ne=1/0,ue=0,ge=[],ye=Ne(u,s),Se=ye.preferHDR,xe=ye.allowedVideoRanges,De=function(){var Ze=d[a[Fe]];m=Ze.channels[2]>0,x=Math.min(x,Ze.minHeight),U=Math.min(U,Ze.minFramerate),ne=Math.min(ne,Ze.minBitrate);var et=xe.filter(function(ot){return Ze.videoRanges[ot]>0});et.length>0&&(S=!0,ge=et)},Fe=a.length;Fe--;)De();x=Ct(x)?x:0,U=Ct(U)?U:0;var He=Math.max(1080,x),rt=Math.max(30,U);ne=Ct(ne)?ne:l,l=Math.max(ne,l),S||(u=void 0,ge=[]);var ze=a.reduce(function(Ve,Ze){var et=d[Ze];if(Ze===Ve)return Ve;if(et.minBitrate>l)return Xe(Ze,"min bitrate of "+et.minBitrate+" > current estimate of "+l),Ve;if(!et.hasDefaultAudio)return Xe(Ze,"no renditions with default or auto-select sound found"),Ve;if(h&&Ze.indexOf(h.substring(0,4))%5!==0)return Xe(Ze,'audio codec preference "'+h+'" not found'),Ve;if(c&&!g){if(!et.channels[c])return Xe(Ze,"no renditions with "+c+" channel sound found (channels options: "+Object.keys(et.channels)+")"),Ve}else if((!h||g)&&m&&et.channels[2]===0)return Xe(Ze,"no renditions with stereo sound found"),Ve;return et.minHeight>He?(Xe(Ze,"min resolution of "+et.minHeight+" > maximum of "+He),Ve):et.minFramerate>rt?(Xe(Ze,"min framerate of "+et.minFramerate+" > maximum of "+rt),Ve):ge.some(function(ot){return et.videoRanges[ot]>0})?et.maxScore<ue?(Xe(Ze,"max score of "+et.maxScore+" < selected max of "+ue),Ve):Ve&&(wa(Ze)>=wa(Ve)||et.fragmentError>d[Ve].fragmentError)?Ve:(ue=et.maxScore,Ze):(Xe(Ze,"no variants with VIDEO-RANGE of "+JSON.stringify(ge)+" found"),Ve)},void 0);return{codecSet:ze,videoRanges:ge,preferHDR:Se,minFramerate:U,minBitrate:ne}}function Xe(d,u){Qe.log('[abr] start candidates with "'+d+'" ignored because '+u)}function ut(d){return d.reduce(function(u,l){var n=u.groups[l.groupId];n||(n=u.groups[l.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(l);var s=l.channels||"2";return n.channels[s]=(n.channels[s]||0)+1,n.hasDefault=n.hasDefault||l.default,n.hasAutoSelect=n.hasAutoSelect||l.autoselect,n.hasDefault&&(u.hasDefaultAudio=!0),n.hasAutoSelect&&(u.hasAutoSelectAudio=!0),u},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function gt(d,u,l,n){return d.slice(l,n+1).reduce(function(s,a){if(!a.codecSet)return s;var c=a.audioGroups,h=s[a.codecSet];h||(s[a.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,a.bitrate);var g=Math.min(a.height,a.width);return h.minHeight=Math.min(h.minHeight,g),h.minFramerate=Math.min(h.minFramerate,a.frameRate),h.maxScore=Math.max(h.maxScore,a.score),h.fragmentError+=a.fragmentError,h.videoRanges[a.videoRange]=(h.videoRanges[a.videoRange]||0)+1,c&&c.forEach(function(m){if(m){var S=u.groups[m];S&&(h.hasDefaultAudio=h.hasDefaultAudio||u.hasDefaultAudio?S.hasDefault:S.hasAutoSelect||!u.hasDefaultAudio&&!u.hasAutoSelectAudio,Object.keys(S.channels).forEach(function(x){h.channels[x]=(h.channels[x]||0)+S.channels[x]}))}}),s},{})}function ft(d,u,l){if("attrs"in d){var n=u.indexOf(d);if(n!==-1)return n}for(var s=0;s<u.length;s++){var a=u[s];if(St(d,a,l))return s}return-1}function St(d,u,l){var n=d.groupId,s=d.name,a=d.lang,c=d.assocLang,h=d.characteristics,g=d.default,m=d.forced;return(n===void 0||u.groupId===n)&&(s===void 0||u.name===s)&&(a===void 0||u.lang===a)&&(a===void 0||u.assocLang===c)&&(g===void 0||u.default===g)&&(m===void 0||u.forced===m)&&(h===void 0||Et(h,u.characteristics))&&(l===void 0||l(d,u))}function Et(d,u){u===void 0&&(u="");var l=d.split(","),n=u.split(",");return l.length===n.length&&!l.some(function(s){return n.indexOf(s)===-1})}function ve(d,u){var l=d.audioCodec,n=d.channels;return(l===void 0||(u.audioCodec||"").substring(0,4)===l.substring(0,4))&&(n===void 0||n===(u.channels||"2"))}function Oe(d,u,l,n,s){var a=u[n],c=u.reduce(function(U,ne,ue){var ge=ne.uri,ye=U[ge]||(U[ge]=[]);return ye.push(ue),U},{}),h=c[a.uri];h.length>1&&(n=Math.max.apply(Math,h));var g=a.videoRange,m=a.frameRate,S=a.codecSet.substring(0,4),x=Ke(u,n,function(U){if(U.videoRange!==g||U.frameRate!==m||U.codecSet.substring(0,4)!==S)return!1;var ne=U.audioGroups,ue=l.filter(function(ge){return!ne||ne.indexOf(ge.groupId)!==-1});return ft(d,ue,s)>-1});return x>-1?x:Ke(u,n,function(U){var ne=U.audioGroups,ue=l.filter(function(ge){return!ne||ne.indexOf(ge.groupId)!==-1});return ft(d,ue,s)>-1})}function Ke(d,u,l){for(var n=u;n>-1;n--)if(l(d[n]))return n;for(var s=u+1;s<d.length;s++)if(l(d[s]))return s;return-1}var nt=function(){function d(l){var n=this;this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=function(){var s=n.fragCurrent,a=n.partCurrent,c=n.hls,h=c.autoLevelEnabled,g=c.media;if(!(!s||!g)){var m=performance.now(),S=a?a.stats:s.stats,x=a?a.duration:s.duration,U=m-S.loading.start,ne=c.minAutoLevel;if(S.aborted||S.loaded&&S.loaded===S.total||s.level<=ne){n.clearTimer(),n._nextAutoLevel=-1;return}if(!(!h||g.paused||!g.playbackRate||!g.readyState)){var ue=c.mainForwardBufferInfo;if(ue!==null){var ge=n.bwEstimator.getEstimateTTFB(),ye=Math.abs(g.playbackRate);if(!(U<=Math.max(ge,1e3*(x/(ye*2))))){var Se=ue.len/ye,xe=S.loading.first?S.loading.first-S.loading.start:-1,De=S.loaded&&xe>-1,Fe=n.getBwEstimate(),He=c.levels,rt=He[s.level],ze=S.total||Math.max(S.loaded,Math.round(x*rt.averageBitrate/8)),Ve=De?U-xe:U;Ve<1&&De&&(Ve=Math.min(U,S.loaded*8/Fe));var Ze=De?S.loaded*1e3/Ve:0,et=Ze?(ze-S.loaded)/Ze:ze*8/Fe+ge/1e3;if(!(et<=Se)){var ot=Ze?Ze*8:Fe,ct=Number.POSITIVE_INFINITY,yt;for(yt=s.level-1;yt>ne;yt--){var wt=He[yt].maxBitrate;if(ct=n.getTimeToLoadFrag(ge/1e3,ot,x*wt,!He[yt].details),ct<Se)break}if(!(ct>=et)&&!(ct>x*10)){c.nextLoadLevel=c.nextAutoLevel=yt,De?n.bwEstimator.sample(U-Math.min(ge,xe),S.loaded):n.bwEstimator.sampleTTFB(U);var It=He[yt].maxBitrate;n.getBwEstimate()*n.hls.config.abrBandWidthUpFactor>It&&n.resetEstimator(It),n.clearTimer(),Qe.warn("[abr] Fragment "+s.sn+(a?" part "+a.index:"")+" of level "+s.level+` is loading too slowly;
      Time to underbuffer: `+Se.toFixed(3)+` s
      Estimated load time for current fragment: `+et.toFixed(3)+` s
      Estimated load time for down switch fragment: `+ct.toFixed(3)+` s
      TTFB estimate: `+(xe|0)+` ms
      Current BW estimate: `+(Ct(Fe)?Fe|0:"Unknown")+` bps
      New BW estimate: `+(n.getBwEstimate()|0)+` bps
      Switching to level `+yt+" @ "+(It|0)+" bps"),c.trigger(_e.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:a,stats:S})}}}}}}},this.hls=l,this.bwEstimator=this.initEstimator(),this.registerListeners()}var u=d.prototype;return u.resetEstimator=function(n){n&&(Qe.log("setting initial bwe to "+n),this.hls.config.abrEwmaDefaultEstimate=n),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},u.initEstimator=function(){var n=this.hls.config;return new fe(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate)},u.registerListeners=function(){var n=this.hls;n.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_e.FRAG_LOADING,this.onFragLoading,this),n.on(_e.FRAG_LOADED,this.onFragLoaded,this),n.on(_e.FRAG_BUFFERED,this.onFragBuffered,this),n.on(_e.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(_e.LEVEL_LOADED,this.onLevelLoaded,this),n.on(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),n.on(_e.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),n.on(_e.ERROR,this.onError,this)},u.unregisterListeners=function(){var n=this.hls;n&&(n.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_e.FRAG_LOADING,this.onFragLoading,this),n.off(_e.FRAG_LOADED,this.onFragLoaded,this),n.off(_e.FRAG_BUFFERED,this.onFragBuffered,this),n.off(_e.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(_e.LEVEL_LOADED,this.onLevelLoaded,this),n.off(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),n.off(_e.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),n.off(_e.ERROR,this.onError,this))},u.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},u.onManifestLoading=function(n,s){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},u.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},u.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},u.onFragLoading=function(n,s){var a=s.frag;if(!this.ignoreFragment(a)){if(!a.bitrateTest){var c;this.fragCurrent=a,this.partCurrent=(c=s.part)!=null?c:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}},u.onLevelSwitching=function(n,s){this.clearTimer()},u.onError=function(n,s){if(!s.fatal)switch(s.details){case je.BUFFER_ADD_CODEC_ERROR:case je.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case je.FRAG_LOAD_TIMEOUT:{var a=s.frag,c=this.fragCurrent,h=this.partCurrent;if(a&&c&&a.sn===c.sn&&a.level===c.level){var g=performance.now(),m=h?h.stats:a.stats,S=g-m.loading.start,x=m.loading.first?m.loading.first-m.loading.start:-1,U=m.loaded&&x>-1;if(U){var ne=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(S-Math.min(ne,x),m.loaded)}else this.bwEstimator.sampleTTFB(S)}break}}},u.getTimeToLoadFrag=function(n,s,a,c){var h=n+a/s,g=c?this.lastLevelLoadSec:0;return h+g},u.onLevelLoaded=function(n,s){var a=this.hls.config,c=s.stats.loading,h=c.end-c.start;Ct(h)&&(this.lastLevelLoadSec=h/1e3),s.details.live?this.bwEstimator.update(a.abrEwmaSlowLive,a.abrEwmaFastLive):this.bwEstimator.update(a.abrEwmaSlowVoD,a.abrEwmaFastVoD)},u.onFragLoaded=function(n,s){var a=s.frag,c=s.part,h=c?c.stats:a.stats;if(a.type===Nt.MAIN&&this.bwEstimator.sampleTTFB(h.loading.first-h.loading.start),!this.ignoreFragment(a)){if(this.clearTimer(),a.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var g=c?c.duration:a.duration,m=this.hls.levels[a.level],S=(m.loaded?m.loaded.bytes:0)+h.loaded,x=(m.loaded?m.loaded.duration:0)+g;m.loaded={bytes:S,duration:x},m.realBitrate=Math.round(8*S/x)}if(a.bitrateTest){var U={stats:h,frag:a,part:c,id:a.type};this.onFragBuffered(_e.FRAG_BUFFERED,U),a.bitrateTest=!1}else this.lastLoadedFragLevel=a.level}},u.onFragBuffered=function(n,s){var a=s.frag,c=s.part,h=c!=null&&c.stats.loaded?c.stats:a.stats;if(!h.aborted&&!this.ignoreFragment(a)){var g=h.parsing.end-h.loading.start-Math.min(h.loading.first-h.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(g,h.loaded),h.bwEstimate=this.getBwEstimate(),a.bitrateTest?this.bitrateTestDelay=g/1e3:this.bitrateTestDelay=0}},u.ignoreFragment=function(n){return n.type!==Nt.MAIN||n.sn==="initSegment"},u.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},u.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},u.getNextABRAutoLevel=function(){var n=this.fragCurrent,s=this.partCurrent,a=this.hls,c=a.maxAutoLevel,h=a.config,g=a.minAutoLevel,m=s?s.duration:n?n.duration:0,S=this.getBwEstimate(),x=this.getStarvationDelay(),U=h.abrBandWidthFactor,ne=h.abrBandWidthUpFactor;if(x){var ue=this.findBestLevel(S,g,c,x,0,U,ne);if(ue>=0)return ue}var ge=m?Math.min(m,h.maxStarvationDelay):h.maxStarvationDelay;if(!x){var ye=this.bitrateTestDelay;if(ye){var Se=m?Math.min(m,h.maxLoadingDelay):h.maxLoadingDelay;ge=Se-ye,Qe.info("[abr] bitrate test took "+Math.round(1e3*ye)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*ge)+" ms"),U=ne=1}}var xe=this.findBestLevel(S,g,c,x,ge,U,ne);if(Qe.info("[abr] "+(x?"rebuffering expected":"buffer is empty")+", optimal quality level "+xe),xe>-1)return xe;var De=a.levels[g],Fe=a.levels[a.loadLevel];return De?.bitrate<Fe?.bitrate?g:a.loadLevel},u.getStarvationDelay=function(){var n=this.hls,s=n.media;if(!s)return 1/0;var a=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,c=n.mainForwardBufferInfo;return(c?c.len:0)/a},u.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},u.findBestLevel=function(n,s,a,c,h,g,m){var S,x=this,U=c+h,ne=this.lastLoadedFragLevel,ue=ne===-1?this.hls.firstLevel:ne,ge=this.fragCurrent,ye=this.partCurrent,Se=this.hls,xe=Se.levels,De=Se.allAudioTracks,Fe=Se.loadLevel,He=Se.config;if(xe.length===1)return 0;var rt=xe[ue],ze=!!(rt!=null&&(S=rt.details)!=null&&S.live),Ve=Fe===-1||ne===-1,Ze,et="SDR",ot=rt?.frameRate||0,ct=He.audioPreference,yt=He.videoPreference,wt=this.audioTracksByGroup||(this.audioTracksByGroup=ut(De));if(Ve){if(this.firstSelection!==-1)return this.firstSelection;var It=this.codecTiers||(this.codecTiers=gt(xe,wt,s,a)),Ht=Ue(It,et,n,ct,yt),jt=Ht.codecSet,Zt=Ht.videoRanges,ei=Ht.minFramerate,Kt=Ht.minBitrate,Ai=Ht.preferHDR;Ze=jt,et=Ai?Zt[Zt.length-1]:Zt[0],ot=ei,n=Math.max(n,Kt),Qe.log("[abr] picked start tier "+JSON.stringify(Ht))}else Ze=rt?.codecSet,et=rt?.videoRange;for(var li=ye?ye.duration:ge?ge.duration:0,rr=this.bwEstimator.getEstimateTTFB()/1e3,Yi=[],Lr=function(){var bn,ci=xe[Bi],Gr=Bi>ue;if(!ci)return 0;if(He.useMediaCapabilities&&!ci.supportedResult&&!ci.supportedPromise){var dn=navigator.mediaCapabilities;typeof dn?.decodingInfo=="function"&&Ee(ci,wt,et,ot,n,ct)?(ci.supportedPromise=be(ci,wt,dn),ci.supportedPromise.then(function(An){if(x.hls){ci.supportedResult=An;var fa=x.hls.levels,Qn=fa.indexOf(ci);An.error?Qe.warn('[abr] MediaCapabilities decodingInfo error: "'+An.error+'" for level '+Qn+" "+JSON.stringify(An)):An.supported||(Qe.warn("[abr] Unsupported MediaCapabilities decodingInfo result for level "+Qn+" "+JSON.stringify(An)),Qn>-1&&fa.length>1&&(Qe.log("[abr] Removing unsupported level "+Qn),x.hls.removeLevel(Qn)))}})):ci.supportedResult=ce}if(Ze&&ci.codecSet!==Ze||et&&ci.videoRange!==et||Gr&&ot>ci.frameRate||!Gr&&ot>0&&ot<ci.frameRate||ci.supportedResult&&!((bn=ci.supportedResult.decodingInfoResults)!=null&&bn[0].smooth))return Yi.push(Bi),0;var Oi=ci.details,ar=(ye?Oi?.partTarget:Oi?.averagetargetduration)||li,br;Gr?br=m*n:br=g*n;var Jr=li&&c>=li*2&&h===0?xe[Bi].averageBitrate:xe[Bi].maxBitrate,Ki=x.getTimeToLoadFrag(rr,br,Jr*ar,Oi===void 0),Us=br>=Jr&&(Bi===ne||ci.loadError===0&&ci.fragmentError===0)&&(Ki<=rr||!Ct(Ki)||ze&&!x.bitrateTestDelay||Ki<U);if(Us){var Gs=x.forcedAutoLevel;return Bi!==Fe&&(Gs===-1||Gs!==Fe)&&(Yi.length&&Qe.trace("[abr] Skipped level(s) "+Yi.join(",")+" of "+a+' max with CODECS and VIDEO-RANGE:"'+xe[Yi[0]].codecs+'" '+xe[Yi[0]].videoRange+'; not compatible with "'+rt.codecs+'" '+et),Qe.info("[abr] switch candidate:"+ue+"->"+Bi+" adjustedbw("+Math.round(br)+")-bitrate="+Math.round(br-Jr)+" ttfb:"+rr.toFixed(1)+" avgDuration:"+ar.toFixed(1)+" maxFetchDuration:"+U.toFixed(1)+" fetchDuration:"+Ki.toFixed(1)+" firstSelection:"+Ve+" codecSet:"+Ze+" videoRange:"+et+" hls.loadLevel:"+Fe)),Ve&&(x.firstSelection=Bi),{v:Bi}}},Si,Bi=a;Bi>=s;Bi--)if(Si=Lr(),Si!==0&&Si)return Si.v;return-1},ki(d,[{key:"firstAutoLevel",get:function(){var n=this.hls,s=n.maxAutoLevel,a=n.minAutoLevel,c=this.getBwEstimate(),h=this.hls.config.maxStarvationDelay,g=this.findBestLevel(c,a,s,0,h,1,1);if(g>-1)return g;var m=this.hls.firstLevel,S=Math.min(Math.max(m,a),s);return Qe.warn("[abr] Could not find best starting auto level. Defaulting to first in playlist "+m+" clamped to "+S),S}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var n=this.forcedAutoLevel,s=this.bwEstimator,a=s.canEstimate(),c=this.lastLoadedFragLevel>-1;if(n!==-1&&(!a||!c||this.nextAutoLevelKey===this.getAutoLevelKey()))return n;var h=a&&c?this.getNextABRAutoLevel():this.firstAutoLevel;if(n!==-1){var g=this.hls.levels;if(g.length>Math.max(n,h)&&g[n].loadError<=g[h].loadError)return n}return this._nextAutoLevel=h,this.nextAutoLevelKey=this.getAutoLevelKey(),h},set:function(n){var s=this.hls,a=s.maxAutoLevel,c=s.minAutoLevel,h=Math.min(Math.max(n,c),a);this._nextAutoLevel!==h&&(this.nextAutoLevelKey="",this._nextAutoLevel=h)}}]),d}(),vt=function(){function d(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var u=d.prototype;return u.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},u.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},u.onHandlerDestroyed=function(){},u.hasInterval=function(){return!!this._tickInterval},u.hasNextTick=function(){return!!this._tickTimer},u.setInterval=function(n){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,n),!0)},u.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},u.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},u.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},u.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},u.doTick=function(){},d}(),mt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Qt=function(){function d(l){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=l,this._registerListeners()}var u=d.prototype;return u._registerListeners=function(){var n=this.hls;n.on(_e.BUFFER_APPENDED,this.onBufferAppended,this),n.on(_e.FRAG_BUFFERED,this.onFragBuffered,this),n.on(_e.FRAG_LOADED,this.onFragLoaded,this)},u._unregisterListeners=function(){var n=this.hls;n.off(_e.BUFFER_APPENDED,this.onBufferAppended,this),n.off(_e.FRAG_BUFFERED,this.onFragBuffered,this),n.off(_e.FRAG_LOADED,this.onFragLoaded,this)},u.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},u.getAppendedFrag=function(n,s){var a=this.activePartLists[s];if(a)for(var c=a.length;c--;){var h=a[c];if(!h)break;var g=h.end;if(h.start<=n&&g!==null&&n<=g)return h}return this.getBufferedFrag(n,s)},u.getBufferedFrag=function(n,s){for(var a=this.fragments,c=Object.keys(a),h=c.length;h--;){var g=a[c[h]];if(g?.body.type===s&&g.buffered){var m=g.body;if(m.start<=n&&n<=m.end)return m}}return null},u.detectEvictedFragments=function(n,s,a,c){var h=this;this.timeRanges&&(this.timeRanges[n]=s);var g=c?.fragment.sn||-1;Object.keys(this.fragments).forEach(function(m){var S=h.fragments[m];if(S&&!(g>=S.body.sn)){if(!S.buffered&&!S.loaded){S.body.type===a&&h.removeFragment(S.body);return}var x=S.range[n];x&&x.time.some(function(U){var ne=!h.isTimeBuffered(U.startPTS,U.endPTS,s);return ne&&h.removeFragment(S.body),ne})}})},u.detectPartialFragments=function(n){var s=this,a=this.timeRanges,c=n.frag,h=n.part;if(!(!a||c.sn==="initSegment")){var g=Wt(c),m=this.fragments[g];if(!(!m||m.buffered&&c.gap)){var S=!c.relurl;if(Object.keys(a).forEach(function(U){var ne=c.elementaryStreams[U];if(ne){var ue=a[U],ge=S||ne.partial===!0;m.range[U]=s.getBufferedTimes(c,h,ge,ue)}}),m.loaded=null,Object.keys(m.range).length){m.buffered=!0;var x=m.body.endList=c.endList||m.body.endList;x&&(this.endListFragments[m.body.type]=m),Yt(m)||this.removeParts(c.sn-1,c.type)}else this.removeFragment(m.body)}}},u.removeParts=function(n,s){var a=this.activePartLists[s];a&&(this.activePartLists[s]=a.filter(function(c){return c.fragment.sn>=n}))},u.fragBuffered=function(n,s){var a=Wt(n),c=this.fragments[a];!c&&s&&(c=this.fragments[a]={body:n,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},n.gap&&(this.hasGaps=!0)),c&&(c.loaded=null,c.buffered=!0)},u.getBufferedTimes=function(n,s,a,c){for(var h={time:[],partial:a},g=n.start,m=n.end,S=n.minEndPTS||m,x=n.maxStartPTS||g,U=0;U<c.length;U++){var ne=c.start(U)-this.bufferPadding,ue=c.end(U)+this.bufferPadding;if(x>=ne&&S<=ue){h.time.push({startPTS:Math.max(g,c.start(U)),endPTS:Math.min(m,c.end(U))});break}else if(g<ue&&m>ne){var ge=Math.max(g,c.start(U)),ye=Math.min(m,c.end(U));ye>ge&&(h.partial=!0,h.time.push({startPTS:ge,endPTS:ye}))}else if(m<=ne)break}return h},u.getPartialFragment=function(n){var s=null,a,c,h,g=0,m=this.bufferPadding,S=this.fragments;return Object.keys(S).forEach(function(x){var U=S[x];U&&Yt(U)&&(c=U.body.start-m,h=U.body.end+m,n>=c&&n<=h&&(a=Math.min(n-c,h-n),g<=a&&(s=U.body,g=a)))}),s},u.isEndListAppended=function(n){var s=this.endListFragments[n];return s!==void 0&&(s.buffered||Yt(s))},u.getState=function(n){var s=Wt(n),a=this.fragments[s];return a?a.buffered?Yt(a)?mt.PARTIAL:mt.OK:mt.APPENDING:mt.NOT_LOADED},u.isTimeBuffered=function(n,s,a){for(var c,h,g=0;g<a.length;g++){if(c=a.start(g)-this.bufferPadding,h=a.end(g)+this.bufferPadding,n>=c&&s<=h)return!0;if(s<=c)return!1}return!1},u.onFragLoaded=function(n,s){var a=s.frag,c=s.part;if(!(a.sn==="initSegment"||a.bitrateTest)){var h=c?null:s,g=Wt(a);this.fragments[g]={body:a,appendedPTS:null,loaded:h,buffered:!1,range:Object.create(null)}}},u.onBufferAppended=function(n,s){var a=this,c=s.frag,h=s.part,g=s.timeRanges;if(c.sn!=="initSegment"){var m=c.type;if(h){var S=this.activePartLists[m];S||(this.activePartLists[m]=S=[]),S.push(h)}this.timeRanges=g,Object.keys(g).forEach(function(x){var U=g[x];a.detectEvictedFragments(x,U,m,h)})}},u.onFragBuffered=function(n,s){this.detectPartialFragments(s)},u.hasFragment=function(n){var s=Wt(n);return!!this.fragments[s]},u.hasParts=function(n){var s;return!!((s=this.activePartLists[n])!=null&&s.length)},u.removeFragmentsInRange=function(n,s,a,c,h){var g=this;c&&!this.hasGaps||Object.keys(this.fragments).forEach(function(m){var S=g.fragments[m];if(S){var x=S.body;x.type!==a||c&&!x.gap||x.start<s&&x.end>n&&(S.buffered||h)&&g.removeFragment(x)}})},u.removeFragment=function(n){var s=Wt(n);n.stats.loaded=0,n.clearElementaryStreamInfo();var a=this.activePartLists[n.type];if(a){var c=n.sn;this.activePartLists[n.type]=a.filter(function(h){return h.fragment.sn!==c})}delete this.fragments[s],n.endList&&delete this.endListFragments[n.type]},u.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},d}();function Yt(d){var u,l,n;return d.buffered&&(d.body.gap||((u=d.range.video)==null?void 0:u.partial)||((l=d.range.audio)==null?void 0:l.partial)||((n=d.range.audiovideo)==null?void 0:n.partial))}function Wt(d){return d.type+"_"+d.level+"_"+d.sn}var ni={length:0,start:function(){return 0},end:function(){return 0}},Vt=function(){function d(){}return d.isBuffered=function(l,n){try{if(l){for(var s=d.getBuffered(l),a=0;a<s.length;a++)if(n>=s.start(a)&&n<=s.end(a))return!0}}catch{}return!1},d.bufferInfo=function(l,n,s){try{if(l){var a=d.getBuffered(l),c=[],h;for(h=0;h<a.length;h++)c.push({start:a.start(h),end:a.end(h)});return this.bufferedInfo(c,n,s)}}catch{}return{len:0,start:n,end:n,nextStart:void 0}},d.bufferedInfo=function(l,n,s){n=Math.max(0,n),l.sort(function(ye,Se){var xe=ye.start-Se.start;return xe||Se.end-ye.end});var a=[];if(s)for(var c=0;c<l.length;c++){var h=a.length;if(h){var g=a[h-1].end;l[c].start-g<s?l[c].end>g&&(a[h-1].end=l[c].end):a.push(l[c])}else a.push(l[c])}else a=l;for(var m=0,S,x=n,U=n,ne=0;ne<a.length;ne++){var ue=a[ne].start,ge=a[ne].end;if(n+s>=ue&&n<ge)x=ue,U=ge,m=U-n;else if(n+s<ue){S=ue;break}}return{len:m,start:x||0,end:U||0,nextStart:S}},d.getBuffered=function(l){try{return l.buffered}catch(n){return Qe.log("failed to get media.buffered",n),ni}},d}(),bi=function(u,l,n,s,a,c){s===void 0&&(s=0),a===void 0&&(a=-1),c===void 0&&(c=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=sr(),this.buffering={audio:sr(),video:sr(),audiovideo:sr()},this.level=u,this.sn=l,this.id=n,this.size=s,this.part=a,this.partial=c};function sr(){return{start:0,executeStart:0,executeEnd:0,end:0}}function mi(d,u){for(var l=0,n=d.length;l<n;l++){var s;if(((s=d[l])==null?void 0:s.cc)===u)return d[l]}return null}function Mr(d,u,l){return!!(u&&(l.endCC>l.startCC||d&&d.cc<l.startCC))}function Li(d,u){var l=d.fragments,n=u.fragments;if(!n.length||!l.length){Qe.log("No fragments to align");return}var s=mi(l,n[0].cc);if(!s||s&&!s.startPTS){Qe.log("No frag in previous level to align on");return}return s}function Zi(d,u){if(d){var l=d.start+u;d.start=d.startPTS=l,d.endPTS=l+d.duration}}function er(d,u){for(var l=u.fragments,n=0,s=l.length;n<s;n++)Zi(l[n],d);u.fragmentHint&&Zi(u.fragmentHint,d),u.alignedSliding=!0}function Lt(d,u,l){u&&(ji(d,l,u),!l.alignedSliding&&u&&ln(l,u),!l.alignedSliding&&u&&!l.skippedSegments&&te(u,l))}function ji(d,u,l){if(Mr(d,l,u)){var n=Li(l,u);n&&Ct(n.start)&&(Qe.log("Adjusting PTS using last level due to CC increase within current level "+u.url),er(n.start,u))}}function ln(d,u){if(!(!d.hasProgramDateTime||!u.hasProgramDateTime)){var l=d.fragments,n=u.fragments;if(!(!l.length||!n.length)){var s,a,c=Math.min(u.endCC,d.endCC);u.startCC<c&&d.startCC<c&&(s=mi(n,c),a=mi(l,c)),(!s||!a)&&(s=n[Math.floor(n.length/2)],a=mi(l,s.cc)||l[Math.floor(l.length/2)]);var h=s.programDateTime,g=a.programDateTime;if(!(!h||!g)){var m=(g-h)/1e3-(a.start-s.start);er(m,d)}}}}var tr=Math.pow(2,17),Fo=function(){function d(l){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=l}var u=d.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(n,s){var a=this,c=n.url;if(!c)return Promise.reject(new zr({type:Pt.NETWORK_ERROR,details:je.FRAG_LOAD_ERROR,fatal:!1,frag:n,error:new Error("Fragment does not have a "+(c?"part list":"url")),networkDetails:null}));this.abort();var h=this.config,g=h.fLoader,m=h.loader;return new Promise(function(S,x){if(a.loader&&a.loader.destroy(),n.gap)if(n.tagList.some(function(ye){return ye[0]==="GAP"})){x(Ma(n));return}else n.gap=!1;var U=a.loader=n.loader=g?new g(h):new m(h),ne=Oa(n),ue=b(h.fragLoadPolicy.default),ge={loadPolicy:ue,timeout:ue.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:n.sn==="initSegment"?1/0:tr};n.stats=U.stats,U.load(ne,ge,{onSuccess:function(Se,xe,De,Fe){a.resetLoader(n,U);var He=Se.data;De.resetIV&&n.decryptdata&&(n.decryptdata.iv=new Uint8Array(He.slice(0,16)),He=He.slice(16)),S({frag:n,part:null,payload:He,networkDetails:Fe})},onError:function(Se,xe,De,Fe){a.resetLoader(n,U),x(new zr({type:Pt.NETWORK_ERROR,details:je.FRAG_LOAD_ERROR,fatal:!1,frag:n,response:Ii({url:c,data:void 0},Se),error:new Error("HTTP Error "+Se.code+" "+Se.text),networkDetails:De,stats:Fe}))},onAbort:function(Se,xe,De){a.resetLoader(n,U),x(new zr({type:Pt.NETWORK_ERROR,details:je.INTERNAL_ABORTED,fatal:!1,frag:n,error:new Error("Aborted"),networkDetails:De,stats:Se}))},onTimeout:function(Se,xe,De){a.resetLoader(n,U),x(new zr({type:Pt.NETWORK_ERROR,details:je.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,error:new Error("Timeout after "+ge.timeout+"ms"),networkDetails:De,stats:Se}))},onProgress:function(Se,xe,De,Fe){s&&s({frag:n,part:null,payload:De,networkDetails:Fe})}})})},u.loadPart=function(n,s,a){var c=this;this.abort();var h=this.config,g=h.fLoader,m=h.loader;return new Promise(function(S,x){if(c.loader&&c.loader.destroy(),n.gap||s.gap){x(Ma(n,s));return}var U=c.loader=n.loader=g?new g(h):new m(h),ne=Oa(n,s),ue=b(h.fragLoadPolicy.default),ge={loadPolicy:ue,timeout:ue.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:tr};s.stats=U.stats,U.load(ne,ge,{onSuccess:function(Se,xe,De,Fe){c.resetLoader(n,U),c.updateStatsFromPart(n,s);var He={frag:n,part:s,payload:Se.data,networkDetails:Fe};a(He),S(He)},onError:function(Se,xe,De,Fe){c.resetLoader(n,U),x(new zr({type:Pt.NETWORK_ERROR,details:je.FRAG_LOAD_ERROR,fatal:!1,frag:n,part:s,response:Ii({url:ne.url,data:void 0},Se),error:new Error("HTTP Error "+Se.code+" "+Se.text),networkDetails:De,stats:Fe}))},onAbort:function(Se,xe,De){n.stats.aborted=s.stats.aborted,c.resetLoader(n,U),x(new zr({type:Pt.NETWORK_ERROR,details:je.INTERNAL_ABORTED,fatal:!1,frag:n,part:s,error:new Error("Aborted"),networkDetails:De,stats:Se}))},onTimeout:function(Se,xe,De){c.resetLoader(n,U),x(new zr({type:Pt.NETWORK_ERROR,details:je.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,part:s,error:new Error("Timeout after "+ge.timeout+"ms"),networkDetails:De,stats:Se}))}})})},u.updateStatsFromPart=function(n,s){var a=n.stats,c=s.stats,h=c.total;if(a.loaded+=c.loaded,h){var g=Math.round(n.duration/s.duration),m=Math.min(Math.round(a.loaded/h),g),S=g-m,x=S*Math.round(a.loaded/m);a.total=a.loaded+x}else a.total=Math.max(a.loaded,a.total);var U=a.loading,ne=c.loading;U.start?U.first+=ne.first-ne.start:(U.start=ne.start,U.first=ne.first),U.end=ne.end},u.resetLoader=function(n,s){n.loader=null,this.loader===s&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),s.destroy()},d}();function Oa(d,u){u===void 0&&(u=null);var l=u||d,n={frag:d,part:u,responseType:"arraybuffer",url:l.url,headers:{},rangeStart:0,rangeEnd:0},s=l.byteRangeStartOffset,a=l.byteRangeEndOffset;if(Ct(s)&&Ct(a)){var c,h=s,g=a;if(d.sn==="initSegment"&&((c=d.decryptdata)==null?void 0:c.method)==="AES-128"){var m=a-s;m%16&&(g=a+(16-m%16)),s!==0&&(n.resetIV=!0,h=s-16)}n.rangeStart=h,n.rangeEnd=g}return n}function Ma(d,u){var l=new Error("GAP "+(d.gap?"tag":"attribute")+" found"),n={type:Pt.MEDIA_ERROR,details:je.FRAG_GAP,fatal:!1,frag:d,error:l,networkDetails:null};return u&&(n.part=u),(u||d).stats.aborted=!0,new zr(n)}var zr=function(d){Bt(u,d);function u(l){var n;return n=d.call(this,l.error.message)||this,n.data=void 0,n.data=l,n}return u}(js(Error)),sa=function(){function d(l,n){this.subtle=void 0,this.aesIV=void 0,this.subtle=l,this.aesIV=n}var u=d.prototype;return u.decrypt=function(n,s){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},s,n)},d}(),Is=function(){function d(l,n){this.subtle=void 0,this.key=void 0,this.subtle=l,this.key=n}var u=d.prototype;return u.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},d}();function qn(d){var u=d.byteLength,l=u&&new DataView(d.buffer).getUint8(u-1);return l?lr(d,0,u-l):d}var Na=function(){function d(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var u=d.prototype;return u.uint8ArrayToUint32Array_=function(n){for(var s=new DataView(n),a=new Uint32Array(4),c=0;c<4;c++)a[c]=s.getUint32(c*4);return a},u.initTable=function(){var n=this.sBox,s=this.invSBox,a=this.subMix,c=a[0],h=a[1],g=a[2],m=a[3],S=this.invSubMix,x=S[0],U=S[1],ne=S[2],ue=S[3],ge=new Uint32Array(256),ye=0,Se=0,xe=0;for(xe=0;xe<256;xe++)xe<128?ge[xe]=xe<<1:ge[xe]=xe<<1^283;for(xe=0;xe<256;xe++){var De=Se^Se<<1^Se<<2^Se<<3^Se<<4;De=De>>>8^De&255^99,n[ye]=De,s[De]=ye;var Fe=ge[ye],He=ge[Fe],rt=ge[He],ze=ge[De]*257^De*16843008;c[ye]=ze<<24|ze>>>8,h[ye]=ze<<16|ze>>>16,g[ye]=ze<<8|ze>>>24,m[ye]=ze,ze=rt*16843009^He*65537^Fe*257^ye*16843008,x[De]=ze<<24|ze>>>8,U[De]=ze<<16|ze>>>16,ne[De]=ze<<8|ze>>>24,ue[De]=ze,ye?(ye=Fe^ge[ge[ge[rt^Fe]]],Se^=ge[ge[Se]]):ye=Se=1}},u.expandKey=function(n){for(var s=this.uint8ArrayToUint32Array_(n),a=!0,c=0;c<s.length&&a;)a=s[c]===this.key[c],c++;if(!a){this.key=s;var h=this.keySize=s.length;if(h!==4&&h!==6&&h!==8)throw new Error("Invalid aes key size="+h);var g=this.ksRows=(h+6+1)*4,m,S,x=this.keySchedule=new Uint32Array(g),U=this.invKeySchedule=new Uint32Array(g),ne=this.sBox,ue=this.rcon,ge=this.invSubMix,ye=ge[0],Se=ge[1],xe=ge[2],De=ge[3],Fe,He;for(m=0;m<g;m++){if(m<h){Fe=x[m]=s[m];continue}He=Fe,m%h===0?(He=He<<8|He>>>24,He=ne[He>>>24]<<24|ne[He>>>16&255]<<16|ne[He>>>8&255]<<8|ne[He&255],He^=ue[m/h|0]<<24):h>6&&m%h===4&&(He=ne[He>>>24]<<24|ne[He>>>16&255]<<16|ne[He>>>8&255]<<8|ne[He&255]),x[m]=Fe=(x[m-h]^He)>>>0}for(S=0;S<g;S++)m=g-S,S&3?He=x[m]:He=x[m-4],S<4||m<=4?U[S]=He:U[S]=ye[ne[He>>>24]]^Se[ne[He>>>16&255]]^xe[ne[He>>>8&255]]^De[ne[He&255]],U[S]=U[S]>>>0}},u.networkToHostOrderSwap=function(n){return n<<24|(n&65280)<<8|(n&16711680)>>8|n>>>24},u.decrypt=function(n,s,a){for(var c=this.keySize+6,h=this.invKeySchedule,g=this.invSBox,m=this.invSubMix,S=m[0],x=m[1],U=m[2],ne=m[3],ue=this.uint8ArrayToUint32Array_(a),ge=ue[0],ye=ue[1],Se=ue[2],xe=ue[3],De=new Int32Array(n),Fe=new Int32Array(De.length),He,rt,ze,Ve,Ze,et,ot,ct,yt,wt,It,Ht,jt,Zt,ei=this.networkToHostOrderSwap;s<De.length;){for(yt=ei(De[s]),wt=ei(De[s+1]),It=ei(De[s+2]),Ht=ei(De[s+3]),Ze=yt^h[0],et=Ht^h[1],ot=It^h[2],ct=wt^h[3],jt=4,Zt=1;Zt<c;Zt++)He=S[Ze>>>24]^x[et>>16&255]^U[ot>>8&255]^ne[ct&255]^h[jt],rt=S[et>>>24]^x[ot>>16&255]^U[ct>>8&255]^ne[Ze&255]^h[jt+1],ze=S[ot>>>24]^x[ct>>16&255]^U[Ze>>8&255]^ne[et&255]^h[jt+2],Ve=S[ct>>>24]^x[Ze>>16&255]^U[et>>8&255]^ne[ot&255]^h[jt+3],Ze=He,et=rt,ot=ze,ct=Ve,jt=jt+4;He=g[Ze>>>24]<<24^g[et>>16&255]<<16^g[ot>>8&255]<<8^g[ct&255]^h[jt],rt=g[et>>>24]<<24^g[ot>>16&255]<<16^g[ct>>8&255]<<8^g[Ze&255]^h[jt+1],ze=g[ot>>>24]<<24^g[ct>>16&255]<<16^g[Ze>>8&255]<<8^g[et&255]^h[jt+2],Ve=g[ct>>>24]<<24^g[Ze>>16&255]<<16^g[et>>8&255]<<8^g[ot&255]^h[jt+3],Fe[s]=ei(He^ge),Fe[s+1]=ei(Ve^ye),Fe[s+2]=ei(ze^Se),Fe[s+3]=ei(rt^xe),ge=yt,ye=wt,Se=It,xe=Ht,s=s+4}return Fe.buffer},d}(),Rs=16,yn=function(){function d(l,n){var s=n===void 0?{}:n,a=s.removePKCS7Padding,c=a===void 0?!0:a;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=l.enableSoftwareAES,this.removePKCS7Padding=c,c)try{var h=self.crypto;h&&(this.subtle=h.subtle||h.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var u=d.prototype;return u.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},u.isSync=function(){return this.useSoftware},u.flush=function(){var n=this.currentResult,s=this.remainderData;if(!n||s)return this.reset(),null;var a=new Uint8Array(n);return this.reset(),this.removePKCS7Padding?qn(a):a},u.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},u.decrypt=function(n,s,a){var c=this;return this.useSoftware?new Promise(function(h,g){c.softwareDecrypt(new Uint8Array(n),s,a);var m=c.flush();m?h(m.buffer):g(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(n),s,a)},u.softwareDecrypt=function(n,s,a){var c=this.currentIV,h=this.currentResult,g=this.remainderData;this.logOnce("JS AES decrypt"),g&&(n=Ei(g,n),this.remainderData=null);var m=this.getValidChunk(n);if(!m.length)return null;c&&(a=c);var S=this.softwareDecrypter;S||(S=this.softwareDecrypter=new Na),S.expandKey(s);var x=h;return this.currentResult=S.decrypt(m.buffer,0,a),this.currentIV=lr(m,-16).buffer,x||null},u.webCryptoDecrypt=function(n,s,a){var c=this;if(this.key!==s||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(n,s,a));this.key=s,this.fastAesKey=new Is(this.subtle,s)}return this.fastAesKey.expandKey().then(function(h){if(!c.subtle)return Promise.reject(new Error("web crypto not initialized"));c.logOnce("WebCrypto AES decrypt");var g=new sa(c.subtle,new Uint8Array(a));return g.decrypt(n.buffer,h)}).catch(function(h){return Qe.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+h.name+": "+h.message),c.onWebCryptoError(n,s,a)})},u.onWebCryptoError=function(n,s,a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(n,s,a);var c=this.flush();if(c)return c.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},u.getValidChunk=function(n){var s=n,a=n.length-n.length%Rs;return a!==n.length&&(s=lr(n,0,a),this.remainderData=lr(n,a)),s},u.logOnce=function(n){this.logEnabled&&(Qe.log("[decrypter]: "+n),this.logEnabled=!1)},d}(),ss={toString:function(u){for(var l="",n=u.length,s=0;s<n;s++)l+="["+u.start(s).toFixed(3)+"-"+u.end(s).toFixed(3)+"]";return l}},ht={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},zi=function(d){Bt(u,d);function u(n,s,a,c,h){var g;return g=d.call(this)||this,g.hls=void 0,g.fragPrevious=null,g.fragCurrent=null,g.fragmentTracker=void 0,g.transmuxer=null,g._state=ht.STOPPED,g.playlistType=void 0,g.media=null,g.mediaBuffer=null,g.config=void 0,g.bitrateTest=!1,g.lastCurrentTime=0,g.nextLoadPosition=0,g.startPosition=0,g.startTimeOffset=null,g.loadedmetadata=!1,g.retryDate=0,g.levels=null,g.fragmentLoader=void 0,g.keyLoader=void 0,g.levelLastLoaded=null,g.startFragRequested=!1,g.decrypter=void 0,g.initPTS=[],g.onvseeking=null,g.onvended=null,g.logPrefix="",g.log=void 0,g.warn=void 0,g.playlistType=h,g.logPrefix=c,g.log=Qe.log.bind(Qe,c+":"),g.warn=Qe.warn.bind(Qe,c+":"),g.hls=n,g.fragmentLoader=new Fo(n.config),g.keyLoader=a,g.fragmentTracker=s,g.config=n.config,g.decrypter=new yn(n.config),n.on(_e.MANIFEST_LOADED,g.onManifestLoaded,fn(g)),g}var l=u.prototype;return l.doTick=function(){this.onTickEnd()},l.onTickEnd=function(){},l.startLoad=function(s){},l.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var s=this.fragCurrent;s!=null&&s.loader&&(s.abortRequests(),this.fragmentTracker.removeFragment(s)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ht.STOPPED},l._streamEnded=function(s,a){if(a.live||s.nextStart||!s.end||!this.media)return!1;var c=a.partList;if(c!=null&&c.length){var h=c[c.length-1],g=Vt.isBuffered(this.media,h.start+h.duration/2);return g}var m=a.fragments[a.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(m)},l.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var s;return(s=this.levelLastLoaded)==null?void 0:s.details}},l.onMediaAttached=function(s,a){var c=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),c.addEventListener("seeking",this.onvseeking),c.addEventListener("ended",this.onvended);var h=this.config;this.levels&&h.autoStartLoad&&this.state===ht.STOPPED&&this.startLoad(h.startPosition)},l.onMediaDetaching=function(){var s=this.media;s!=null&&s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s&&this.onvseeking&&this.onvended&&(s.removeEventListener("seeking",this.onvseeking),s.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},l.onMediaSeeking=function(){var s=this.config,a=this.fragCurrent,c=this.media,h=this.mediaBuffer,g=this.state,m=c?c.currentTime:0,S=Vt.bufferInfo(h||c,m,s.maxBufferHole);if(this.log("media seeking to "+(Ct(m)?m.toFixed(3):m)+", state: "+g),this.state===ht.ENDED)this.resetLoadingState();else if(a){var x=s.maxFragLookUpTolerance,U=a.start-x,ne=a.start+a.duration+x;if(!S.len||ne<S.start||U>S.end){var ue=m>ne;(m<U||ue)&&(ue&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}c&&(this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0),this.lastCurrentTime=m),!this.loadedmetadata&&!S.len&&(this.nextLoadPosition=this.startPosition=m),this.tickImmediate()},l.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},l.onManifestLoaded=function(s,a){this.startTimeOffset=a.startTimeOffset,this.initPTS=[]},l.onHandlerDestroying=function(){this.hls.off(_e.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),d.prototype.onHandlerDestroying.call(this),this.hls=null},l.onHandlerDestroyed=function(){this.state=ht.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,d.prototype.onHandlerDestroyed.call(this)},l.loadFragment=function(s,a,c){this._loadFragForPlayback(s,a,c)},l._loadFragForPlayback=function(s,a,c){var h=this,g=function(S){if(h.fragContextChanged(s)){h.warn("Fragment "+s.sn+(S.part?" p: "+S.part.index:"")+" of level "+s.level+" was dropped during download."),h.fragmentTracker.removeFragment(s);return}s.stats.chunkCount++,h._handleFragmentLoadProgress(S)};this._doFragLoad(s,a,c,g).then(function(m){if(m){var S=h.state;if(h.fragContextChanged(s)){(S===ht.FRAG_LOADING||!h.fragCurrent&&S===ht.PARSING)&&(h.fragmentTracker.removeFragment(s),h.state=ht.IDLE);return}"payload"in m&&(h.log("Loaded fragment "+s.sn+" of level "+s.level),h.hls.trigger(_e.FRAG_LOADED,m)),h._handleFragmentLoadComplete(m)}}).catch(function(m){h.state===ht.STOPPED||h.state===ht.ERROR||(h.warn("Frag error: "+(m?.message||m)),h.resetFragmentLoading(s))})},l.clearTrackerIfNeeded=function(s){var a,c=this.fragmentTracker,h=c.getState(s);if(h===mt.APPENDING){var g=s.type,m=this.getFwdBufferInfo(this.mediaBuffer,g),S=Math.max(s.duration,m?m.len:this.config.maxBufferLength),x=this.backtrackFragment,U=x?s.sn-x.sn:0;(U===1||this.reduceMaxBufferLength(S,s.duration))&&c.removeFragment(s)}else((a=this.mediaBuffer)==null?void 0:a.buffered.length)===0?c.removeAllFragments():c.hasParts(s.type)&&(c.detectPartialFragments({frag:s,part:null,stats:s.stats,id:s.type}),c.getState(s)===mt.PARTIAL&&c.removeFragment(s))},l.checkLiveUpdate=function(s){if(s.updated&&!s.live){var a=s.fragments[s.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:a,part:null,stats:a.stats,id:a.type})}s.fragments[0]||(s.deltaUpdateFailed=!0)},l.flushMainBuffer=function(s,a,c){if(c===void 0&&(c=null),!!(s-a)){var h={startOffset:s,endOffset:a,type:c};this.hls.trigger(_e.BUFFER_FLUSHING,h)}},l._loadInitSegment=function(s,a){var c=this;this._doFragLoad(s,a).then(function(h){if(!h||c.fragContextChanged(s)||!c.levels)throw new Error("init load aborted");return h}).then(function(h){var g=c.hls,m=h.payload,S=s.decryptdata;if(m&&m.byteLength>0&&S!=null&&S.key&&S.iv&&S.method==="AES-128"){var x=self.performance.now();return c.decrypter.decrypt(new Uint8Array(m),S.key.buffer,S.iv.buffer).catch(function(U){throw g.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_DECRYPT_ERROR,fatal:!1,error:U,reason:U.message,frag:s}),U}).then(function(U){var ne=self.performance.now();return g.trigger(_e.FRAG_DECRYPTED,{frag:s,payload:U,stats:{tstart:x,tdecrypt:ne}}),h.payload=U,c.completeInitSegmentLoad(h)})}return c.completeInitSegmentLoad(h)}).catch(function(h){c.state===ht.STOPPED||c.state===ht.ERROR||(c.warn(h),c.resetFragmentLoading(s))})},l.completeInitSegmentLoad=function(s){var a=this.levels;if(!a)throw new Error("init load aborted, missing levels");var c=s.frag.stats;this.state=ht.IDLE,s.frag.data=new Uint8Array(s.payload),c.parsing.start=c.buffering.start=self.performance.now(),c.parsing.end=c.buffering.end=self.performance.now(),this.tick()},l.fragContextChanged=function(s){var a=this.fragCurrent;return!s||!a||s.sn!==a.sn||s.level!==a.level},l.fragBufferedComplete=function(s,a){var c,h,g,m,S=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+s.type+" sn: "+s.sn+(a?" part: "+a.index:"")+" of "+(this.playlistType===Nt.MAIN?"level":"track")+" "+s.level+" (frag:["+((c=s.startPTS)!=null?c:NaN).toFixed(3)+"-"+((h=s.endPTS)!=null?h:NaN).toFixed(3)+"] > buffer:"+(S?ss.toString(Vt.getBuffered(S)):"(detached)")+")"),s.sn!=="initSegment"){var x;if(s.type!==Nt.SUBTITLE){var U=s.elementaryStreams;if(!Object.keys(U).some(function(ue){return!!U[ue]})){this.state=ht.IDLE;return}}var ne=(x=this.levels)==null?void 0:x[s.level];ne!=null&&ne.fragmentError&&(this.log("Resetting level fragment error count of "+ne.fragmentError+" on frag buffered"),ne.fragmentError=0)}this.state=ht.IDLE,S&&(!this.loadedmetadata&&s.type==Nt.MAIN&&S.buffered.length&&((g=this.fragCurrent)==null?void 0:g.sn)===((m=this.fragPrevious)==null?void 0:m.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},l.seekToStartPos=function(){},l._handleFragmentLoadComplete=function(s){var a=this.transmuxer;if(a){var c=s.frag,h=s.part,g=s.partsLoaded,m=!g||g.length===0||g.some(function(x){return!x}),S=new bi(c.level,c.sn,c.stats.chunkCount+1,0,h?h.index:-1,!m);a.flush(S)}},l._handleFragmentLoadProgress=function(s){},l._doFragLoad=function(s,a,c,h){var g,m=this;c===void 0&&(c=null);var S=a?.details;if(!this.levels||!S)throw new Error("frag load aborted, missing level"+(S?"":" detail")+"s");var x=null;if(s.encrypted&&!((g=s.decryptdata)!=null&&g.key)?(this.log("Loading key for "+s.sn+" of ["+S.startSN+"-"+S.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+s.level),this.state=ht.KEY_LOADING,this.fragCurrent=s,x=this.keyLoader.load(s).then(function(xe){if(!m.fragContextChanged(xe.frag))return m.hls.trigger(_e.KEY_LOADED,xe),m.state===ht.KEY_LOADING&&(m.state=ht.IDLE),xe}),this.hls.trigger(_e.KEY_LOADING,{frag:s}),this.fragCurrent===null&&(x=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!s.encrypted&&S.encryptedFragments.length&&this.keyLoader.loadClear(s,S.encryptedFragments),c=Math.max(s.start,c||0),this.config.lowLatencyMode&&s.sn!=="initSegment"){var U=S.partList;if(U&&h){c>s.end&&S.fragmentHint&&(s=S.fragmentHint);var ne=this.getNextPart(U,s,c);if(ne>-1){var ue=U[ne];this.log("Loading part sn: "+s.sn+" p: "+ue.index+" cc: "+s.cc+" of playlist ["+S.startSN+"-"+S.endSN+"] parts [0-"+ne+"-"+(U.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+s.level+", target: "+parseFloat(c.toFixed(3))),this.nextLoadPosition=ue.start+ue.duration,this.state=ht.FRAG_LOADING;var ge;return x?ge=x.then(function(xe){return!xe||m.fragContextChanged(xe.frag)?null:m.doFragPartsLoad(s,ue,a,h)}).catch(function(xe){return m.handleFragLoadError(xe)}):ge=this.doFragPartsLoad(s,ue,a,h).catch(function(xe){return m.handleFragLoadError(xe)}),this.hls.trigger(_e.FRAG_LOADING,{frag:s,part:ue,targetBufferTime:c}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):ge}else if(!s.url||this.loadedEndOfParts(U,c))return Promise.resolve(null)}}this.log("Loading fragment "+s.sn+" cc: "+s.cc+" "+(S?"of ["+S.startSN+"-"+S.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+s.level+", target: "+parseFloat(c.toFixed(3))),Ct(s.sn)&&!this.bitrateTest&&(this.nextLoadPosition=s.start+s.duration),this.state=ht.FRAG_LOADING;var ye=this.config.progressive,Se;return ye&&x?Se=x.then(function(xe){return!xe||m.fragContextChanged(xe?.frag)?null:m.fragmentLoader.load(s,h)}).catch(function(xe){return m.handleFragLoadError(xe)}):Se=Promise.all([this.fragmentLoader.load(s,ye?h:void 0),x]).then(function(xe){var De=xe[0];return!ye&&De&&h&&h(De),De}).catch(function(xe){return m.handleFragLoadError(xe)}),this.hls.trigger(_e.FRAG_LOADING,{frag:s,targetBufferTime:c}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):Se},l.doFragPartsLoad=function(s,a,c,h){var g=this;return new Promise(function(m,S){var x,U=[],ne=(x=c.details)==null?void 0:x.partList,ue=function ge(ye){g.fragmentLoader.loadPart(s,ye,h).then(function(Se){U[ye.index]=Se;var xe=Se.part;g.hls.trigger(_e.FRAG_LOADED,Se);var De=ie(c,s.sn,ye.index+1)||W(ne,s.sn,ye.index+1);if(De)ge(De);else return m({frag:s,part:xe,partsLoaded:U})}).catch(S)};ue(a)})},l.handleFragLoadError=function(s){if("data"in s){var a=s.data;s.data&&a.details===je.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(_e.ERROR,a)}else this.hls.trigger(_e.ERROR,{type:Pt.OTHER_ERROR,details:je.INTERNAL_EXCEPTION,err:s,error:s,fatal:!0});return null},l._handleTransmuxerFlush=function(s){var a=this.getCurrentContext(s);if(!a||this.state!==ht.PARSING){!this.fragCurrent&&this.state!==ht.STOPPED&&this.state!==ht.ERROR&&(this.state=ht.IDLE);return}var c=a.frag,h=a.part,g=a.level,m=self.performance.now();c.stats.parsing.end=m,h&&(h.stats.parsing.end=m),this.updateLevelTiming(c,h,g,s.partial)},l.getCurrentContext=function(s){var a=this.levels,c=this.fragCurrent,h=s.level,g=s.sn,m=s.part;if(!(a!=null&&a[h]))return this.warn("Levels object was unset while buffering fragment "+g+" of level "+h+". The current chunk will not be buffered."),null;var S=a[h],x=m>-1?ie(S,g,m):null,U=x?x.fragment:X(S,g,c);return U?(c&&c!==U&&(U.stats=c.stats),{frag:U,part:x,level:S}):null},l.bufferFragmentData=function(s,a,c,h,g){var m;if(!(!s||this.state!==ht.PARSING)){var S=s.data1,x=s.data2,U=S;if(S&&x&&(U=Ei(S,x)),!!((m=U)!=null&&m.length)){var ne={type:s.type,frag:a,part:c,chunkMeta:h,parent:a.type,data:U};if(this.hls.trigger(_e.BUFFER_APPENDING,ne),s.dropped&&s.independent&&!c){if(g)return;this.flushBufferGap(a)}}}},l.flushBufferGap=function(s){var a=this.media;if(a){if(!Vt.isBuffered(a,a.currentTime)){this.flushMainBuffer(0,s.start);return}var c=a.currentTime,h=Vt.bufferInfo(a,c,0),g=s.duration,m=Math.min(this.config.maxFragLookUpTolerance*2,g*.25),S=Math.max(Math.min(s.start-m,h.end-m),c+m);s.start-S>m&&this.flushMainBuffer(S,s.start)}},l.getFwdBufferInfo=function(s,a){var c=this.getLoadPosition();return Ct(c)?this.getFwdBufferInfoAtPos(s,c,a):null},l.getFwdBufferInfoAtPos=function(s,a,c){var h=this.config.maxBufferHole,g=Vt.bufferInfo(s,a,h);if(g.len===0&&g.nextStart!==void 0){var m=this.fragmentTracker.getBufferedFrag(a,c);if(m&&g.nextStart<m.end)return Vt.bufferInfo(s,a,Math.max(g.nextStart,h))}return g},l.getMaxBufferLength=function(s){var a=this.config,c;return s?c=Math.max(8*a.maxBufferSize/s,a.maxBufferLength):c=a.maxBufferLength,Math.min(c,a.maxMaxBufferLength)},l.reduceMaxBufferLength=function(s,a){var c=this.config,h=Math.max(Math.min(s-a,c.maxBufferLength),a),g=Math.max(s-a*3,c.maxMaxBufferLength/2,h);return g>=h?(c.maxMaxBufferLength=g,this.warn("Reduce max buffer length to "+g+"s"),!0):!1},l.getAppendedFrag=function(s,a){var c=this.fragmentTracker.getAppendedFrag(s,Nt.MAIN);return c&&"fragment"in c?c.fragment:c},l.getNextFragment=function(s,a){var c=a.fragments,h=c.length;if(!h)return null;var g=this.config,m=c[0].start,S;if(a.live){var x=g.initialLiveManifestSize;if(h<x)return this.warn("Not enough fragments to start playback (have: "+h+", need: "+x+")"),null;(!a.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||s<m)&&(S=this.getInitialLiveFragment(a,c),this.startPosition=this.nextLoadPosition=S?this.hls.liveSyncPosition||S.start:s)}else s<=m&&(S=c[0]);if(!S){var U=g.lowLatencyMode?a.partEnd:a.fragmentEnd;S=this.getFragmentAtPosition(s,U,a)}return this.mapToInitFragWhenRequired(S)},l.isLoopLoading=function(s,a){var c=this.fragmentTracker.getState(s);return(c===mt.OK||c===mt.PARTIAL&&!!s.gap)&&this.nextLoadPosition>a},l.getNextFragmentLoopLoading=function(s,a,c,h,g){var m=s.gap,S=this.getNextFragment(this.nextLoadPosition,a);if(S===null)return S;if(s=S,m&&s&&!s.gap&&c.nextStart){var x=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,c.nextStart,h);if(x!==null&&c.len+x.len>=g)return this.log('buffer full after gaps in "'+h+'" playlist starting at sn: '+s.sn),null}return s},l.mapToInitFragWhenRequired=function(s){return s!=null&&s.initSegment&&!(s!=null&&s.initSegment.data)&&!this.bitrateTest?s.initSegment:s},l.getNextPart=function(s,a,c){for(var h=-1,g=!1,m=!0,S=0,x=s.length;S<x;S++){var U=s[S];if(m=m&&!U.independent,h>-1&&c<U.start)break;var ne=U.loaded;ne?h=-1:(g||U.independent||m)&&U.fragment===a&&(h=S),g=ne}return h},l.loadedEndOfParts=function(s,a){var c=s[s.length-1];return c&&a>c.start&&c.loaded},l.getInitialLiveFragment=function(s,a){var c=this.fragPrevious,h=null;if(c){if(s.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+c.programDateTime),h=_(a,c.endProgramDateTime,this.config.maxFragLookUpTolerance)),!h){var g=c.sn+1;if(g>=s.startSN&&g<=s.endSN){var m=a[g-s.startSN];c.cc===m.cc&&(h=m,this.log("Live playlist, switching playlist, load frag with next SN: "+h.sn))}h||(h=K(a,c.cc),h&&this.log("Live playlist, switching playlist, load frag with same CC: "+h.sn))}}else{var S=this.hls.liveSyncPosition;S!==null&&(h=this.getFragmentAtPosition(S,this.bitrateTest?s.fragmentEnd:s.edge,s))}return h},l.getFragmentAtPosition=function(s,a,c){var h=this.config,g=this.fragPrevious,m=c.fragments,S=c.endSN,x=c.fragmentHint,U=h.maxFragLookUpTolerance,ne=c.partList,ue=!!(h.lowLatencyMode&&ne!=null&&ne.length&&x);ue&&x&&!this.bitrateTest&&(m=m.concat(x),S=x.sn);var ge;if(s<a){var ye=s>a-U?0:U;ge=v(g,m,s,ye)}else ge=m[m.length-1];if(ge){var Se=ge.sn-c.startSN,xe=this.fragmentTracker.getState(ge);if((xe===mt.OK||xe===mt.PARTIAL&&ge.gap)&&(g=ge),g&&ge.sn===g.sn&&(!ue||ne[0].fragment.sn>ge.sn)){var De=g&&ge.level===g.level;if(De){var Fe=m[Se+1];ge.sn<S&&this.fragmentTracker.getState(Fe)!==mt.OK?ge=Fe:ge=null}}}return ge},l.synchronizeToLiveEdge=function(s){var a=this.config,c=this.media;if(c){var h=this.hls.liveSyncPosition,g=c.currentTime,m=s.fragments[0].start,S=s.edge,x=g>=m-a.maxFragLookUpTolerance&&g<=S;if(h!==null&&c.duration>h&&(g<h||!x)){var U=a.liveMaxLatencyDuration!==void 0?a.liveMaxLatencyDuration:a.liveMaxLatencyDurationCount*s.targetduration;(!x&&c.readyState<4||g<S-U)&&(this.loadedmetadata||(this.nextLoadPosition=h),c.readyState&&(this.warn("Playback: "+g.toFixed(3)+" is located too far from the end of live sliding playlist: "+S+", reset currentTime to : "+h.toFixed(3)),c.currentTime=h))}}},l.alignPlaylists=function(s,a,c){var h=s.fragments.length;if(!h)return this.warn("No fragments in live playlist"),0;var g=s.fragments[0].start,m=!a,S=s.alignedSliding&&Ct(g);if(m||!S&&!g){var x=this.fragPrevious;Lt(x,c,s);var U=s.fragments[0].start;return this.log("Live playlist sliding: "+U.toFixed(2)+" start-sn: "+(a?a.startSN:"na")+"->"+s.startSN+" prev-sn: "+(x?x.sn:"na")+" fragments: "+h),U}return g},l.waitForCdnTuneIn=function(s){var a=3;return s.live&&s.canBlockReload&&s.partTarget&&s.tuneInGoal>Math.max(s.partHoldBack,s.partTarget*a)},l.setStartPosition=function(s,a){var c=this.startPosition;if(c<a&&(c=-1),c===-1||this.lastCurrentTime===-1){var h=this.startTimeOffset!==null,g=h?this.startTimeOffset:s.startTimeOffset;g!==null&&Ct(g)?(c=a+g,g<0&&(c+=s.totalduration),c=Math.min(Math.max(a,c),a+s.totalduration),this.log("Start time offset "+g+" found in "+(h?"multivariant":"media")+" playlist, adjust startPosition to "+c),this.startPosition=c):s.live?c=this.hls.liveSyncPosition||a:this.startPosition=c=0,this.lastCurrentTime=c}this.nextLoadPosition=c},l.getLoadPosition=function(){var s=this.media,a=0;return this.loadedmetadata&&s?a=s.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},l.handleFragLoadAborted=function(s,a){this.transmuxer&&s.sn!=="initSegment"&&s.stats.aborted&&(this.warn("Fragment "+s.sn+(a?" part "+a.index:"")+" of level "+s.level+" was aborted"),this.resetFragmentLoading(s))},l.resetFragmentLoading=function(s){(!this.fragCurrent||!this.fragContextChanged(s)&&this.state!==ht.FRAG_LOADING_WAITING_RETRY)&&(this.state=ht.IDLE)},l.onFragmentOrKeyLoadError=function(s,a){if(a.chunkMeta&&!a.frag){var c=this.getCurrentContext(a.chunkMeta);c&&(a.frag=c.frag)}var h=a.frag;if(!(!h||h.type!==s||!this.levels)){if(this.fragContextChanged(h)){var g;this.warn("Frag load error must match current frag to retry "+h.url+" > "+((g=this.fragCurrent)==null?void 0:g.url));return}var m=a.details===je.FRAG_GAP;m&&this.fragmentTracker.fragBuffered(h,!0);var S=a.errorAction,x=S||{},U=x.action,ne=x.retryCount,ue=ne===void 0?0:ne,ge=x.retryConfig;if(S&&U===k.RetryRequest&&ge){this.resetStartWhenNotLoaded(this.levelLastLoaded);var ye=M(ge,ue);this.warn("Fragment "+h.sn+" of "+s+" "+h.level+" errored with "+a.details+", retrying loading "+(ue+1)+"/"+ge.maxNumRetry+" in "+ye+"ms"),S.resolved=!0,this.retryDate=self.performance.now()+ye,this.state=ht.FRAG_LOADING_WAITING_RETRY}else if(ge&&S)if(this.resetFragmentErrors(s),ue<ge.maxNumRetry)!m&&U!==k.RemoveAlternatePermanently&&(S.resolved=!0);else{Qe.warn(a.details+" reached or exceeded max retry ("+ue+")");return}else S?.action===k.SendAlternateToPenaltyBox?this.state=ht.WAITING_LEVEL:this.state=ht.ERROR;this.tickImmediate()}},l.reduceLengthAndFlushBuffer=function(s){if(this.state===ht.PARSING||this.state===ht.PARSED){var a=s.frag,c=s.parent,h=this.getFwdBufferInfo(this.mediaBuffer,c),g=h&&h.len>.5;g&&this.reduceMaxBufferLength(h.len,a?.duration||10);var m=!g;return m&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+c+" buffer"),a&&(this.fragmentTracker.removeFragment(a),this.nextLoadPosition=a.start),this.resetLoadingState(),m}return!1},l.resetFragmentErrors=function(s){s===Nt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==ht.STOPPED&&(this.state=ht.IDLE)},l.afterBufferFlushed=function(s,a,c){if(s){var h=Vt.getBuffered(s);this.fragmentTracker.detectEvictedFragments(a,h,c),this.state===ht.ENDED&&this.resetLoadingState()}},l.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=ht.IDLE},l.resetStartWhenNotLoaded=function(s){if(!this.loadedmetadata){this.startFragRequested=!1;var a=s?s.details:null;a!=null&&a.live?(this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},l.resetWhenMissingContext=function(s){this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},l.removeUnbufferedFrags=function(s){s===void 0&&(s=0),this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!1,!0)},l.updateLevelTiming=function(s,a,c,h){var g=this,m,S=c.details;if(!S){this.warn("level.details undefined");return}var x=Object.keys(s.elementaryStreams).reduce(function(ne,ue){var ge=s.elementaryStreams[ue];if(ge){var ye=ge.endPTS-ge.startPTS;if(ye<=0)return g.warn("Could not parse fragment "+s.sn+" "+ue+" duration reliably ("+ye+")"),ne||!1;var Se=h?0:re(S,s,ge.startPTS,ge.endPTS,ge.startDTS,ge.endDTS);return g.hls.trigger(_e.LEVEL_PTS_UPDATED,{details:S,level:c,drift:Se,type:ue,frag:s,start:ge.startPTS,end:ge.endPTS}),!0}return ne},!1);if(!x&&((m=this.transmuxer)==null?void 0:m.error)===null){var U=new Error("Found no media in fragment "+s.sn+" of level "+s.level+" resetting transmuxer to fallback to playlist timing");if(c.fragmentError===0&&(c.fragmentError++,s.gap=!0,this.fragmentTracker.removeFragment(s),this.fragmentTracker.fragBuffered(s,!0)),this.warn(U.message),this.hls.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!1,error:U,frag:s,reason:"Found no media in msn "+s.sn+' of level "'+c.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=ht.PARSED,this.hls.trigger(_e.FRAG_PARSED,{frag:s,part:a})},l.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},l.recoverWorkerError=function(s){s.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},ki(u,[{key:"state",get:function(){return this._state},set:function(s){var a=this._state;a!==s&&(this._state=s,this.log(a+"->"+s))}}]),u}(vt),Nr=function(){function d(){this.chunks=[],this.dataLength=0}var u=d.prototype;return u.push=function(n){this.chunks.push(n),this.dataLength+=n.length},u.flush=function(){var n=this.chunks,s=this.dataLength,a;if(n.length)n.length===1?a=n[0]:a=Il(n,s);else return new Uint8Array(0);return this.reset(),a},u.reset=function(){this.chunks.length=0,this.dataLength=0},d}();function Il(d,u){for(var l=new Uint8Array(u),n=0,s=0;s<d.length;s++){var a=d[s];l.set(a,n),n+=a.length}return l}function Yr(d,u){return d===void 0&&(d=""),u===void 0&&(u=9e4),{type:d,id:-1,pid:-1,inputTimeScale:u,sequenceNumber:-1,samples:[],dropped:0}}var Bo=function(){function d(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var u=d.prototype;return u.resetInitSegment=function(n,s,a,c){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},u.resetTimeStamp=function(n){this.initPTS=n,this.resetContiguity()},u.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},u.canParse=function(n,s){return!1},u.appendFrame=function(n,s,a){},u.demux=function(n,s){this.cachedData&&(n=Ei(this.cachedData,n),this.cachedData=null);var a=In(n,0),c=a?a.length:0,h,g=this._audioTrack,m=this._id3Track,S=a?so(a):void 0,x=n.length;for((this.basePTS===null||this.frameIndex===0&&Ct(S))&&(this.basePTS=Rl(S,s,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),a&&a.length>0&&m.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:vn.audioId3,duration:Number.POSITIVE_INFINITY});c<x;){if(this.canParse(n,c)){var U=this.appendFrame(g,n,c);U?(this.frameIndex++,this.lastPTS=U.sample.pts,c+=U.length,h=c):c=x}else no(n,c)?(a=In(n,c),m.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:a,type:vn.audioId3,duration:Number.POSITIVE_INFINITY}),c+=a.length,h=c):c++;if(c===x&&h!==x){var ne=lr(n,h);this.cachedData?this.cachedData=Ei(this.cachedData,ne):this.cachedData=ne}}return{audioTrack:g,videoTrack:Yr(),id3Track:m,textTrack:Yr()}},u.demuxSampleAes=function(n,s,a){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},u.flush=function(n){var s=this.cachedData;return s&&(this.cachedData=null,this.demux(s,0)),{audioTrack:this._audioTrack,videoTrack:Yr(),id3Track:this._id3Track,textTrack:Yr()}},u.destroy=function(){},d}(),Rl=function(u,l,n){if(Ct(u))return u*90;var s=n?n.baseTime*9e4/n.timescale:0;return l*9e4+s};function co(d,u,l,n){var s,a,c,h,g=navigator.userAgent.toLowerCase(),m=n,S=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((u[l+2]&192)>>>6)+1;var x=(u[l+2]&60)>>>2;if(x>S.length-1){var U=new Error("invalid ADTS sampling index:"+x);d.emit(_e.ERROR,_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!0,error:U,reason:U.message});return}return c=(u[l+2]&1)<<2,c|=(u[l+3]&192)>>>6,Qe.log("manifest codec:"+n+", ADTS type:"+s+", samplingIndex:"+x),/firefox/i.test(g)?x>=6?(s=5,h=new Array(4),a=x-3):(s=2,h=new Array(2),a=x):g.indexOf("android")!==-1?(s=2,h=new Array(2),a=x):(s=5,h=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&x>=6?a=x-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(x>=6&&c===1||/vivaldi/i.test(g))||!n&&c===1)&&(s=2,h=new Array(2)),a=x)),h[0]=s<<3,h[0]|=(x&14)>>1,h[1]|=(x&1)<<7,h[1]|=c<<3,s===5&&(h[1]|=(a&14)>>1,h[2]=(a&1)<<7,h[2]|=8,h[3]=0),{config:h,samplerate:S[x],channelCount:c,codec:"mp4a.40."+s,manifestCodec:m}}function Uo(d,u){return d[u]===255&&(d[u+1]&246)===240}function Go(d,u){return d[u+1]&1?7:9}function as(d,u){return(d[u+3]&3)<<11|d[u+4]<<3|(d[u+5]&224)>>>5}function Kc(d,u){return u+5<d.length}function Pl(d,u){return u+1<d.length&&Uo(d,u)}function Hh(d,u){return Kc(d,u)&&Uo(d,u)&&as(d,u)<=d.length-u}function Ol(d,u){if(Pl(d,u)){var l=Go(d,u);if(u+l>=d.length)return!1;var n=as(d,u);if(n<=l)return!1;var s=u+n;return s===d.length||Pl(d,s)}return!1}function Ml(d,u,l,n,s){if(!d.samplerate){var a=co(u,l,n,s);if(!a)return;d.config=a.config,d.samplerate=a.samplerate,d.channelCount=a.channelCount,d.codec=a.codec,d.manifestCodec=a.manifestCodec,Qe.log("parsed codec:"+d.codec+", rate:"+a.samplerate+", channels:"+a.channelCount)}}function Tn(d){return 1024*9e4/d}function qc(d,u){var l=Go(d,u);if(u+l<=d.length){var n=as(d,u)-l;if(n>0)return{headerLength:l,frameLength:n}}}function $c(d,u,l,n,s){var a=Tn(d.samplerate),c=n+s*a,h=qc(u,l),g;if(h){var m=h.frameLength,S=h.headerLength,x=S+m,U=Math.max(0,l+x-u.length);U?(g=new Uint8Array(x-S),g.set(u.subarray(l+S,u.length),0)):g=u.subarray(l+S,l+x);var ne={unit:g,pts:c};return U||d.samples.push(ne),{sample:ne,length:x,missing:U}}var ue=u.length-l;g=new Uint8Array(ue),g.set(u.subarray(l,u.length),0);var ge={unit:g,pts:c};return{sample:ge,length:ue,missing:-1}}var ho=null,os=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Wc=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],jh=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Kh=[0,1,1,4];function Cr(d,u,l,n,s){if(!(l+24>u.length)){var a=Lu(u,l);if(a&&l+a.frameLength<=u.length){var c=a.samplesPerFrame*9e4/a.sampleRate,h=n+s*c,g={unit:u.subarray(l,l+a.frameLength),pts:h,dts:h};return d.config=[],d.channelCount=a.channelCount,d.samplerate=a.sampleRate,d.samples.push(g),{sample:g,length:a.frameLength,missing:0}}}}function Lu(d,u){var l=d[u+1]>>3&3,n=d[u+1]>>1&3,s=d[u+2]>>4&15,a=d[u+2]>>2&3;if(l!==1&&s!==0&&s!==15&&a!==3){var c=d[u+2]>>1&1,h=d[u+3]>>6,g=l===3?3-n:n===3?3:4,m=os[g*14+s-1]*1e3,S=l===3?0:l===2?1:2,x=Wc[S*3+a],U=h===3?1:2,ne=jh[l][n],ue=Kh[n],ge=ne*8*ue,ye=Math.floor(ne*m/x+c)*ue;if(ho===null){var Se=navigator.userAgent||"",xe=Se.match(/Chrome\/(\d+)/i);ho=xe?parseInt(xe[1]):0}var De=!!ho&&ho<=87;return De&&n===2&&m>=224e3&&h===0&&(d[u+3]=d[u+3]|128),{sampleRate:x,channelCount:U,frameLength:ye,samplesPerFrame:ge}}}function Iu(d,u){return d[u]===255&&(d[u+1]&224)===224&&(d[u+1]&6)!==0}function Ru(d,u){return u+1<d.length&&Iu(d,u)}function fo(d,u){var l=4;return Iu(d,u)&&l<=d.length-u}function Nl(d,u){if(u+1<d.length&&Iu(d,u)){var l=4,n=Lu(d,u),s=l;n!=null&&n.frameLength&&(s=n.frameLength);var a=u+s;return a===d.length||Ru(d,a)}return!1}var Pu=function(d){Bt(u,d);function u(n,s){var a;return a=d.call(this)||this,a.observer=void 0,a.config=void 0,a.observer=n,a.config=s,a}var l=u.prototype;return l.resetInitSegment=function(s,a,c,h){d.prototype.resetInitSegment.call(this,s,a,c,h),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:a,duration:h,inputTimeScale:9e4,dropped:0}},u.probe=function(s){if(!s)return!1;var a=In(s,0),c=a?.length||0;if(Nl(s,c))return!1;for(var h=s.length;c<h;c++)if(Ol(s,c))return Qe.log("ADTS sync word found !"),!0;return!1},l.canParse=function(s,a){return Hh(s,a)},l.appendFrame=function(s,a,c){Ml(s,this.observer,a,c,s.manifestCodec);var h=$c(s,a,c,this.basePTS,this.frameIndex);if(h&&h.missing===0)return h},u}(Bo),qh=/\/emsg[-/]ID3/i,Ou=function(){function d(l,n){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=n}var u=d.prototype;return u.resetTimeStamp=function(){},u.resetInitSegment=function(n,s,a,c){var h=this.videoTrack=Yr("video",1),g=this.audioTrack=Yr("audio",1),m=this.txtTrack=Yr("text",1);if(this.id3Track=Yr("id3",1),this.timeOffset=0,!!(n!=null&&n.byteLength)){var S=nn(n);if(S.video){var x=S.video,U=x.id,ne=x.timescale,ue=x.codec;h.id=U,h.timescale=m.timescale=ne,h.codec=ue}if(S.audio){var ge=S.audio,ye=ge.id,Se=ge.timescale,xe=ge.codec;g.id=ye,g.timescale=Se,g.codec=xe}m.id=Xs.text,h.sampleDuration=0,h.duration=g.duration=c}},u.resetContiguity=function(){this.remainderData=null},d.probe=function(n){return Lo(n)},u.demux=function(n,s){this.timeOffset=s;var a=n,c=this.videoTrack,h=this.txtTrack;if(this.config.progressive){this.remainderData&&(a=Ei(this.remainderData,n));var g=Pn(a);this.remainderData=g.remainder,c.samples=g.valid||new Uint8Array}else c.samples=a;var m=this.extractID3Track(c,s);return h.samples=Io(s,c),{videoTrack:c,audioTrack:this.audioTrack,id3Track:m,textTrack:this.txtTrack}},u.flush=function(){var n=this.timeOffset,s=this.videoTrack,a=this.txtTrack;s.samples=this.remainderData||new Uint8Array,this.remainderData=null;var c=this.extractID3Track(s,this.timeOffset);return a.samples=Io(n,s),{videoTrack:s,audioTrack:Yr(),id3Track:c,textTrack:Yr()}},u.extractID3Track=function(n,s){var a=this.id3Track;if(n.samples.length){var c=Mt(n.samples,["emsg"]);c&&c.forEach(function(h){var g=_l(h);if(qh.test(g.schemeIdUri)){var m=Ct(g.presentationTime)?g.presentationTime/g.timeScale:s+g.presentationTimeDelta/g.timeScale,S=g.eventDuration===4294967295?Number.POSITIVE_INFINITY:g.eventDuration/g.timeScale;S<=.001&&(S=Number.POSITIVE_INFINITY);var x=g.payload;a.samples.push({data:x,len:x.byteLength,dts:m,pts:m,type:vn.emsg,duration:S})}})}return a},u.demuxSampleAes=function(n,s,a){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},u.destroy=function(){},d}(),zc=function(u,l){var n=0,s=5;l+=s;for(var a=new Uint32Array(1),c=new Uint32Array(1),h=new Uint8Array(1);s>0;){h[0]=u[l];var g=Math.min(s,8),m=8-g;c[0]=4278190080>>>24+m<<m,a[0]=(h[0]&c[0])>>m,n=n?n<<g|a[0]:a[0],l+=1,s-=g}return n},Yc=function(d){Bt(u,d);function u(n){var s;return s=d.call(this)||this,s.observer=void 0,s.observer=n,s}var l=u.prototype;return l.resetInitSegment=function(s,a,c,h){d.prototype.resetInitSegment.call(this,s,a,c,h),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:a,duration:h,inputTimeScale:9e4,dropped:0}},l.canParse=function(s,a){return a+64<s.length},l.appendFrame=function(s,a,c){var h=po(s,a,c,this.basePTS,this.frameIndex);if(h!==-1){var g=s.samples[s.samples.length-1];return{sample:g,length:h,missing:0}}},u.probe=function(s){if(!s)return!1;var a=In(s,0);if(!a)return!1;var c=a.length;return s[c]===11&&s[c+1]===119&&so(a)!==void 0&&zc(s,c)<16},u}(Bo);function po(d,u,l,n,s){if(l+8>u.length||u[l]!==11||u[l+1]!==119)return-1;var a=u[l+4]>>6;if(a>=3)return-1;var c=[48e3,44100,32e3],h=c[a],g=u[l+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920],S=m[g*3+a]*2;if(l+S>u.length)return-1;var x=u[l+6]>>5,U=0;x===2?U+=2:(x&1&&x!==1&&(U+=2),x&4&&(U+=2));var ne=(u[l+6]<<8|u[l+7])>>12-U&1,ue=[2,1,2,3,3,4,4,5],ge=ue[x]+ne,ye=u[l+5]>>3,Se=u[l+5]&7,xe=new Uint8Array([a<<6|ye<<1|Se>>2,(Se&3)<<6|x<<3|ne<<2|g>>4,g<<4&224]),De=1536/h*9e4,Fe=n+s*De,He=u.subarray(l,l+S);return d.config=xe,d.channelCount=ge,d.samplerate=h,d.samples.push({unit:He,pts:Fe}),S}var $h=function(){function d(){this.VideoSample=null}var u=d.prototype;return u.createVideoSample=function(n,s,a,c){return{key:n,frame:!1,pts:s,dts:a,units:[],debug:c,length:0}},u.getLastNalUnit=function(n){var s,a=this.VideoSample,c;if((!a||a.units.length===0)&&(a=n[n.length-1]),(s=a)!=null&&s.units){var h=a.units;c=h[h.length-1]}return c},u.pushAccessUnit=function(n,s){if(n.units.length&&n.frame){if(n.pts===void 0){var a=s.samples,c=a.length;if(c){var h=a[c-1];n.pts=h.pts,n.dts=h.dts}else{s.dropped++;return}}s.samples.push(n)}n.debug.length&&Qe.log(n.pts+"/"+n.dts+":"+n.debug)},d}(),Fl=function(){function d(l){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=l,this.bytesAvailable=l.byteLength,this.word=0,this.bitsAvailable=0}var u=d.prototype;return u.loadWord=function(){var n=this.data,s=this.bytesAvailable,a=n.byteLength-s,c=new Uint8Array(4),h=Math.min(4,s);if(h===0)throw new Error("no bytes available");c.set(n.subarray(a,a+h)),this.word=new DataView(c.buffer).getUint32(0),this.bitsAvailable=h*8,this.bytesAvailable-=h},u.skipBits=function(n){var s;n=Math.min(n,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>n?(this.word<<=n,this.bitsAvailable-=n):(n-=this.bitsAvailable,s=n>>3,n-=s<<3,this.bytesAvailable-=s,this.loadWord(),this.word<<=n,this.bitsAvailable-=n)},u.readBits=function(n){var s=Math.min(this.bitsAvailable,n),a=this.word>>>32-s;if(n>32&&Qe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=s,this.bitsAvailable>0)this.word<<=s;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return s=n-s,s>0&&this.bitsAvailable?a<<s|this.readBits(s):a},u.skipLZ=function(){var n;for(n=0;n<this.bitsAvailable;++n)if(this.word&2147483648>>>n)return this.word<<=n,this.bitsAvailable-=n,n;return this.loadWord(),n+this.skipLZ()},u.skipUEG=function(){this.skipBits(1+this.skipLZ())},u.skipEG=function(){this.skipBits(1+this.skipLZ())},u.readUEG=function(){var n=this.skipLZ();return this.readBits(n+1)-1},u.readEG=function(){var n=this.readUEG();return 1&n?1+n>>>1:-1*(n>>>1)},u.readBoolean=function(){return this.readBits(1)===1},u.readUByte=function(){return this.readBits(8)},u.readUShort=function(){return this.readBits(16)},u.readUInt=function(){return this.readBits(32)},u.skipScalingList=function(n){for(var s=8,a=8,c,h=0;h<n;h++)a!==0&&(c=this.readEG(),a=(s+c+256)%256),s=a===0?s:a},u.readSPS=function(){var n=0,s=0,a=0,c=0,h,g,m,S=this.readUByte.bind(this),x=this.readBits.bind(this),U=this.readUEG.bind(this),ne=this.readBoolean.bind(this),ue=this.skipBits.bind(this),ge=this.skipEG.bind(this),ye=this.skipUEG.bind(this),Se=this.skipScalingList.bind(this);S();var xe=S();if(x(5),ue(3),S(),ye(),xe===100||xe===110||xe===122||xe===244||xe===44||xe===83||xe===86||xe===118||xe===128){var De=U();if(De===3&&ue(1),ye(),ye(),ue(1),ne())for(g=De!==3?8:12,m=0;m<g;m++)ne()&&(m<6?Se(16):Se(64))}ye();var Fe=U();if(Fe===0)U();else if(Fe===1)for(ue(1),ge(),ge(),h=U(),m=0;m<h;m++)ge();ye(),ue(1);var He=U(),rt=U(),ze=x(1);ze===0&&ue(1),ue(1),ne()&&(n=U(),s=U(),a=U(),c=U());var Ve=[1,1];if(ne()&&ne()){var Ze=S();switch(Ze){case 1:Ve=[1,1];break;case 2:Ve=[12,11];break;case 3:Ve=[10,11];break;case 4:Ve=[16,11];break;case 5:Ve=[40,33];break;case 6:Ve=[24,11];break;case 7:Ve=[20,11];break;case 8:Ve=[32,11];break;case 9:Ve=[80,33];break;case 10:Ve=[18,11];break;case 11:Ve=[15,11];break;case 12:Ve=[64,33];break;case 13:Ve=[160,99];break;case 14:Ve=[4,3];break;case 15:Ve=[3,2];break;case 16:Ve=[2,1];break;case 255:{Ve=[S()<<8|S(),S()<<8|S()];break}}}return{width:Math.ceil((He+1)*16-n*2-s*2),height:(2-ze)*(rt+1)*16-(ze?2:4)*(a+c),pixelRatio:Ve}},u.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},d}(),Mu=function(d){Bt(u,d);function u(){return d.apply(this,arguments)||this}var l=u.prototype;return l.parseAVCPES=function(s,a,c,h,g){var m=this,S=this.parseAVCNALu(s,c.data),x=this.VideoSample,U,ne=!1;c.data=null,x&&S.length&&!s.audFound&&(this.pushAccessUnit(x,s),x=this.VideoSample=this.createVideoSample(!1,c.pts,c.dts,"")),S.forEach(function(ue){var ge;switch(ue.type){case 1:{var ye=!1;U=!0;var Se=ue.data;if(ne&&Se.length>4){var xe=new Fl(Se).readSliceType();(xe===2||xe===4||xe===7||xe===9)&&(ye=!0)}if(ye){var De;(De=x)!=null&&De.frame&&!x.key&&(m.pushAccessUnit(x,s),x=m.VideoSample=null)}x||(x=m.VideoSample=m.createVideoSample(!0,c.pts,c.dts,"")),x.frame=!0,x.key=ye;break}case 5:U=!0,(ge=x)!=null&&ge.frame&&!x.key&&(m.pushAccessUnit(x,s),x=m.VideoSample=null),x||(x=m.VideoSample=m.createVideoSample(!0,c.pts,c.dts,"")),x.key=!0,x.frame=!0;break;case 6:{U=!0,an(ue.data,1,c.pts,a.samples);break}case 7:{var Fe,He;U=!0,ne=!0;var rt=ue.data,ze=new Fl(rt),Ve=ze.readSPS();if(!s.sps||s.width!==Ve.width||s.height!==Ve.height||((Fe=s.pixelRatio)==null?void 0:Fe[0])!==Ve.pixelRatio[0]||((He=s.pixelRatio)==null?void 0:He[1])!==Ve.pixelRatio[1]){s.width=Ve.width,s.height=Ve.height,s.pixelRatio=Ve.pixelRatio,s.sps=[rt],s.duration=g;for(var Ze=rt.subarray(1,4),et="avc1.",ot=0;ot<3;ot++){var ct=Ze[ot].toString(16);ct.length<2&&(ct="0"+ct),et+=ct}s.codec=et}break}case 8:U=!0,s.pps=[ue.data];break;case 9:U=!0,s.audFound=!0,x&&m.pushAccessUnit(x,s),x=m.VideoSample=m.createVideoSample(!1,c.pts,c.dts,"");break;case 12:U=!0;break;default:U=!1,x&&(x.debug+="unknown NAL "+ue.type+" ");break}if(x&&U){var yt=x.units;yt.push(ue)}}),h&&x&&(this.pushAccessUnit(x,s),this.VideoSample=null)},l.parseAVCNALu=function(s,a){var c=a.byteLength,h=s.naluState||0,g=h,m=[],S=0,x,U,ne,ue=-1,ge=0;for(h===-1&&(ue=0,ge=a[0]&31,h=0,S=1);S<c;){if(x=a[S++],!h){h=x?0:1;continue}if(h===1){h=x?0:2;continue}if(!x)h=3;else if(x===1){if(U=S-h-1,ue>=0){var ye={data:a.subarray(ue,U),type:ge};m.push(ye)}else{var Se=this.getLastNalUnit(s.samples);Se&&(g&&S<=4-g&&Se.state&&(Se.data=Se.data.subarray(0,Se.data.byteLength-g)),U>0&&(Se.data=Ei(Se.data,a.subarray(0,U)),Se.state=0))}S<c?(ne=a[S]&31,ue=S,ge=ne,h=0):h=-1}else h=0}if(ue>=0&&h>=0){var xe={data:a.subarray(ue,c),type:ge,state:h};m.push(xe)}if(m.length===0){var De=this.getLastNalUnit(s.samples);De&&(De.data=Ei(De.data,a))}return s.naluState=h,m},u}($h),Wh=function(){function d(l,n,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new yn(n,{removePKCS7Padding:!1})}var u=d.prototype;return u.decryptBuffer=function(n){return this.decrypter.decrypt(n,this.keyData.key.buffer,this.keyData.iv.buffer)},u.decryptAacSample=function(n,s,a){var c=this,h=n[s].unit;if(!(h.length<=16)){var g=h.subarray(16,h.length-h.length%16),m=g.buffer.slice(g.byteOffset,g.byteOffset+g.length);this.decryptBuffer(m).then(function(S){var x=new Uint8Array(S);h.set(x,16),c.decrypter.isSync()||c.decryptAacSamples(n,s+1,a)})}},u.decryptAacSamples=function(n,s,a){for(;;s++){if(s>=n.length){a();return}if(!(n[s].unit.length<32)&&(this.decryptAacSample(n,s,a),!this.decrypter.isSync()))return}},u.getAvcEncryptedData=function(n){for(var s=Math.floor((n.length-48)/160)*16+16,a=new Int8Array(s),c=0,h=32;h<n.length-16;h+=160,c+=16)a.set(n.subarray(h,h+16),c);return a},u.getAvcDecryptedUnit=function(n,s){for(var a=new Uint8Array(s),c=0,h=32;h<n.length-16;h+=160,c+=16)n.set(a.subarray(c,c+16),h);return n},u.decryptAvcSample=function(n,s,a,c,h){var g=this,m=on(h.data),S=this.getAvcEncryptedData(m);this.decryptBuffer(S.buffer).then(function(x){h.data=g.getAvcDecryptedUnit(m,x),g.decrypter.isSync()||g.decryptAvcSamples(n,s,a+1,c)})},u.decryptAvcSamples=function(n,s,a,c){if(n instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;s++,a=0){if(s>=n.length){c();return}for(var h=n[s].units;!(a>=h.length);a++){var g=h[a];if(!(g.data.length<=48||g.type!==1&&g.type!==5)&&(this.decryptAvcSample(n,s,a,c,g),!this.decrypter.isSync()))return}}},d}(),Er=188,Nu=function(){function d(l,n,s){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=l,this.config=n,this.typeSupported=s,this.videoParser=new Mu}d.probe=function(n){var s=d.syncOffset(n);return s>0&&Qe.warn("MPEG2-TS detected but first sync word found @ offset "+s),s!==-1},d.syncOffset=function(n){for(var s=n.length,a=Math.min(Er*5,s-Er)+1,c=0;c<a;){for(var h=!1,g=-1,m=0,S=c;S<s;S+=Er)if(n[S]===71&&(s-S===Er||n[S+Er]===71)){if(m++,g===-1&&(g=S,g!==0&&(a=Math.min(g+Er*99,n.length-Er)+1)),h||(h=Bl(n,S)===0),h&&m>1&&(g===0&&m>2||S+Er>a))return g}else{if(m)return-1;break}c++}return-1},d.createTrack=function(n,s){return{container:n==="video"||n==="audio"?"video/mp2t":void 0,type:n,id:Xs[n],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:n==="audio"?s:void 0}};var u=d.prototype;return u.resetInitSegment=function(n,s,a,c){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=d.createTrack("video"),this._audioTrack=d.createTrack("audio",c),this._id3Track=d.createTrack("id3"),this._txtTrack=d.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=s,this.videoCodec=a,this._duration=c},u.resetTimeStamp=function(){},u.resetContiguity=function(){var n=this._audioTrack,s=this._videoTrack,a=this._id3Track;n&&(n.pesData=null),s&&(s.pesData=null),a&&(a.pesData=null),this.aacOverFlow=null,this.remainderData=null},u.demux=function(n,s,a,c){a===void 0&&(a=!1),c===void 0&&(c=!1),a||(this.sampleAes=null);var h,g=this._videoTrack,m=this._audioTrack,S=this._id3Track,x=this._txtTrack,U=g.pid,ne=g.pesData,ue=m.pid,ge=S.pid,ye=m.pesData,Se=S.pesData,xe=null,De=this.pmtParsed,Fe=this._pmtId,He=n.length;if(this.remainderData&&(n=Ei(this.remainderData,n),He=n.length,this.remainderData=null),He<Er&&!c)return this.remainderData=n,{audioTrack:m,videoTrack:g,id3Track:S,textTrack:x};var rt=Math.max(0,d.syncOffset(n));He-=(He-rt)%Er,He<n.byteLength&&!c&&(this.remainderData=new Uint8Array(n.buffer,He,n.buffer.byteLength-He));for(var ze=0,Ve=rt;Ve<He;Ve+=Er)if(n[Ve]===71){var Ze=!!(n[Ve+1]&64),et=Bl(n,Ve),ot=(n[Ve+3]&48)>>4,ct=void 0;if(ot>1){if(ct=Ve+5+n[Ve+4],ct===Ve+Er)continue}else ct=Ve+4;switch(et){case U:Ze&&(ne&&(h=Fa(ne))&&this.videoParser.parseAVCPES(g,x,h,!1,this._duration),ne={data:[],size:0}),ne&&(ne.data.push(n.subarray(ct,Ve+Er)),ne.size+=Ve+Er-ct);break;case ue:if(Ze){if(ye&&(h=Fa(ye)))switch(m.segmentCodec){case"aac":this.parseAACPES(m,h);break;case"mp3":this.parseMPEGPES(m,h);break;case"ac3":this.parseAC3PES(m,h);break}ye={data:[],size:0}}ye&&(ye.data.push(n.subarray(ct,Ve+Er)),ye.size+=Ve+Er-ct);break;case ge:Ze&&(Se&&(h=Fa(Se))&&this.parseID3PES(S,h),Se={data:[],size:0}),Se&&(Se.data.push(n.subarray(ct,Ve+Er)),Se.size+=Ve+Er-ct);break;case 0:Ze&&(ct+=n[ct]+1),Fe=this._pmtId=Ul(n,ct);break;case Fe:{Ze&&(ct+=n[ct]+1);var yt=Xc(n,ct,this.typeSupported,a,this.observer);U=yt.videoPid,U>0&&(g.pid=U,g.segmentCodec=yt.segmentVideoCodec),ue=yt.audioPid,ue>0&&(m.pid=ue,m.segmentCodec=yt.segmentAudioCodec),ge=yt.id3Pid,ge>0&&(S.pid=ge),xe!==null&&!De&&(Qe.warn("MPEG-TS PMT found at "+Ve+" after unknown PID '"+xe+"'. Backtracking to sync byte @"+rt+" to parse all TS packets."),xe=null,Ve=rt-188),De=this.pmtParsed=!0;break}case 17:case 8191:break;default:xe=et;break}}else ze++;ze>0&&go(this.observer,new Error("Found "+ze+" TS packet/s that do not start with 0x47")),g.pesData=ne,m.pesData=ye,S.pesData=Se;var wt={audioTrack:m,videoTrack:g,id3Track:S,textTrack:x};return c&&this.extractRemainingSamples(wt),wt},u.flush=function(){var n=this.remainderData;this.remainderData=null;var s;return n?s=this.demux(n,-1,!1,!0):s={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(s),this.sampleAes?this.decrypt(s,this.sampleAes):s},u.extractRemainingSamples=function(n){var s=n.audioTrack,a=n.videoTrack,c=n.id3Track,h=n.textTrack,g=a.pesData,m=s.pesData,S=c.pesData,x;if(g&&(x=Fa(g))?(this.videoParser.parseAVCPES(a,h,x,!0,this._duration),a.pesData=null):a.pesData=g,m&&(x=Fa(m))){switch(s.segmentCodec){case"aac":this.parseAACPES(s,x);break;case"mp3":this.parseMPEGPES(s,x);break;case"ac3":this.parseAC3PES(s,x);break}s.pesData=null}else m!=null&&m.size&&Qe.log("last AAC PES packet truncated,might overlap between fragments"),s.pesData=m;S&&(x=Fa(S))?(this.parseID3PES(c,x),c.pesData=null):c.pesData=S},u.demuxSampleAes=function(n,s,a){var c=this.demux(n,a,!0,!this.config.progressive),h=this.sampleAes=new Wh(this.observer,this.config,s);return this.decrypt(c,h)},u.decrypt=function(n,s){return new Promise(function(a){var c=n.audioTrack,h=n.videoTrack;c.samples&&c.segmentCodec==="aac"?s.decryptAacSamples(c.samples,0,function(){h.samples?s.decryptAvcSamples(h.samples,0,0,function(){a(n)}):a(n)}):h.samples&&s.decryptAvcSamples(h.samples,0,0,function(){a(n)})})},u.destroy=function(){this._duration=0},u.parseAACPES=function(n,s){var a=0,c=this.aacOverFlow,h=s.data;if(c){this.aacOverFlow=null;var g=c.missing,m=c.sample.unit.byteLength;if(g===-1)h=Ei(c.sample.unit,h);else{var S=m-g;c.sample.unit.set(h.subarray(0,g),S),n.samples.push(c.sample),a=c.missing}}var x,U;for(x=a,U=h.length;x<U-1&&!Pl(h,x);x++);if(x!==a){var ne,ue=x<U-1;if(ue?ne="AAC PES did not start with ADTS header,offset:"+x:ne="No ADTS header found in AAC PES",go(this.observer,new Error(ne),ue),!ue)return}Ml(n,this.observer,h,x,this.audioCodec);var ge;if(s.pts!==void 0)ge=s.pts;else if(c){var ye=Tn(n.samplerate);ge=c.sample.pts+ye}else{Qe.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var Se=0,xe;x<U;)if(xe=$c(n,h,x,ge,Se),x+=xe.length,xe.missing){this.aacOverFlow=xe;break}else for(Se++;x<U-1&&!Pl(h,x);x++);},u.parseMPEGPES=function(n,s){var a=s.data,c=a.length,h=0,g=0,m=s.pts;if(m===void 0){Qe.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;g<c;)if(Ru(a,g)){var S=Cr(n,a,g,m,h);if(S)g+=S.length,h++;else break}else g++},u.parseAC3PES=function(n,s){{var a=s.data,c=s.pts;if(c===void 0){Qe.warn("[tsdemuxer]: AC3 PES unknown PTS");return}for(var h=a.length,g=0,m=0,S;m<h&&(S=po(n,a,m,c,g++))>0;)m+=S}},u.parseID3PES=function(n,s){if(s.pts===void 0){Qe.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var a=Di({},s,{type:this._videoTrack?vn.emsg:vn.audioId3,duration:Number.POSITIVE_INFINITY});n.samples.push(a)},d}();function Bl(d,u){return((d[u+1]&31)<<8)+d[u+2]}function Ul(d,u){return(d[u+10]&31)<<8|d[u+11]}function Xc(d,u,l,n,s){var a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(d[u+1]&15)<<8|d[u+2],h=u+3+c-4,g=(d[u+10]&15)<<8|d[u+11];for(u+=12+g;u<h;){var m=Bl(d,u),S=(d[u+3]&15)<<8|d[u+4];switch(d[u]){case 207:if(!n){Gl("ADTS AAC");break}case 15:a.audioPid===-1&&(a.audioPid=m);break;case 21:a.id3Pid===-1&&(a.id3Pid=m);break;case 219:if(!n){Gl("H.264");break}case 27:a.videoPid===-1&&(a.videoPid=m,a.segmentVideoCodec="avc");break;case 3:case 4:!l.mpeg&&!l.mp3?Qe.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=m,a.segmentAudioCodec="mp3");break;case 193:if(!n){Gl("AC-3");break}case 129:l.ac3?a.audioPid===-1&&(a.audioPid=m,a.segmentAudioCodec="ac3"):Qe.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&S>0)for(var x=u+5,U=S;U>2;){var ne=d[x];switch(ne){case 106:l.ac3!==!0?Qe.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=m,a.segmentAudioCodec="ac3");break}var ue=d[x+1]+2;x+=ue,U-=ue}break;case 194:case 135:return go(s,new Error("Unsupported EC-3 in M2TS found")),a;case 36:return go(s,new Error("Unsupported HEVC in M2TS found")),a}u+=S+5}return a}function go(d,u,l){Qe.warn("parsing error: "+u.message),d.emit(_e.ERROR,_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!1,levelRetry:l,error:u,reason:u.message})}function Gl(d){Qe.log(d+" with AES-128-CBC encryption found in unencrypted stream")}function Fa(d){var u=0,l,n,s,a,c,h=d.data;if(!d||d.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=Ei(h[0],h[1]),h.splice(1,1);l=h[0];var g=(l[0]<<16)+(l[1]<<8)+l[2];if(g===1){if(n=(l[4]<<8)+l[5],n&&n>d.size-6)return null;var m=l[7];m&192&&(a=(l[9]&14)*536870912+(l[10]&255)*4194304+(l[11]&254)*16384+(l[12]&255)*128+(l[13]&254)/2,m&64?(c=(l[14]&14)*536870912+(l[15]&255)*4194304+(l[16]&254)*16384+(l[17]&255)*128+(l[18]&254)/2,a-c>60*9e4&&(Qe.warn(Math.round((a-c)/9e4)+"s delta between PTS and DTS, align them"),a=c)):c=a),s=l[8];var S=s+9;if(d.size<=S)return null;d.size-=S;for(var x=new Uint8Array(d.size),U=0,ne=h.length;U<ne;U++){l=h[U];var ue=l.byteLength;if(S)if(S>ue){S-=ue;continue}else l=l.subarray(S),ue-=S,S=0;x.set(l,u),u+=ue}return n&&(n-=s+3),{data:x,pts:a,dts:c,len:n}}return null}var Qc=function(d){Bt(u,d);function u(){return d.apply(this,arguments)||this}var l=u.prototype;return l.resetInitSegment=function(s,a,c,h){d.prototype.resetInitSegment.call(this,s,a,c,h),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:a,duration:h,inputTimeScale:9e4,dropped:0}},u.probe=function(s){if(!s)return!1;var a=In(s,0),c=a?.length||0;if(a&&s[c]===11&&s[c+1]===119&&so(a)!==void 0&&zc(s,c)<=16)return!1;for(var h=s.length;c<h;c++)if(Nl(s,c))return Qe.log("MPEG Audio sync word found !"),!0;return!1},l.canParse=function(s,a){return fo(s,a)},l.appendFrame=function(s,a,c){if(this.basePTS!==null)return Cr(s,a,c,this.basePTS,this.frameIndex)},u}(Bo),Jc=function(){function d(){}return d.getSilentFrame=function(l,n){switch(l){case"mp4a.40.2":if(n===1)return new Uint8Array([0,200,0,128,35,128]);if(n===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(n===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(n===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(n===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(n===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(n===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},d}(),aa=Math.pow(2,32)-1,kr=function(){function d(){}return d.init=function(){d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var l;for(l in d.types)d.types.hasOwnProperty(l)&&(d.types[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);d.HDLR_TYPES={video:n,audio:s};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),c=new Uint8Array([0,0,0,0,0,0,0,0]);d.STTS=d.STSC=d.STCO=c,d.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),d.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),d.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),d.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var h=new Uint8Array([105,115,111,109]),g=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);d.FTYP=d.box(d.types.ftyp,h,m,h,g),d.DINF=d.box(d.types.dinf,d.box(d.types.dref,a))},d.box=function(l){for(var n=8,s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];for(var h=a.length,g=h;h--;)n+=a[h].byteLength;var m=new Uint8Array(n);for(m[0]=n>>24&255,m[1]=n>>16&255,m[2]=n>>8&255,m[3]=n&255,m.set(l,4),h=0,n=8;h<g;h++)m.set(a[h],n),n+=a[h].byteLength;return m},d.hdlr=function(l){return d.box(d.types.hdlr,d.HDLR_TYPES[l])},d.mdat=function(l){return d.box(d.types.mdat,l)},d.mdhd=function(l,n){n*=l;var s=Math.floor(n/(aa+1)),a=Math.floor(n%(aa+1));return d.box(d.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,l>>24&255,l>>16&255,l>>8&255,l&255,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255,85,196,0,0]))},d.mdia=function(l){return d.box(d.types.mdia,d.mdhd(l.timescale,l.duration),d.hdlr(l.type),d.minf(l))},d.mfhd=function(l){return d.box(d.types.mfhd,new Uint8Array([0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255]))},d.minf=function(l){return l.type==="audio"?d.box(d.types.minf,d.box(d.types.smhd,d.SMHD),d.DINF,d.stbl(l)):d.box(d.types.minf,d.box(d.types.vmhd,d.VMHD),d.DINF,d.stbl(l))},d.moof=function(l,n,s){return d.box(d.types.moof,d.mfhd(l),d.traf(s,n))},d.moov=function(l){for(var n=l.length,s=[];n--;)s[n]=d.trak(l[n]);return d.box.apply(null,[d.types.moov,d.mvhd(l[0].timescale,l[0].duration)].concat(s).concat(d.mvex(l)))},d.mvex=function(l){for(var n=l.length,s=[];n--;)s[n]=d.trex(l[n]);return d.box.apply(null,[d.types.mvex].concat(s))},d.mvhd=function(l,n){n*=l;var s=Math.floor(n/(aa+1)),a=Math.floor(n%(aa+1)),c=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,l>>24&255,l>>16&255,l>>8&255,l&255,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d.box(d.types.mvhd,c)},d.sdtp=function(l){var n=l.samples||[],s=new Uint8Array(4+n.length),a,c;for(a=0;a<n.length;a++)c=n[a].flags,s[a+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return d.box(d.types.sdtp,s)},d.stbl=function(l){return d.box(d.types.stbl,d.stsd(l),d.box(d.types.stts,d.STTS),d.box(d.types.stsc,d.STSC),d.box(d.types.stsz,d.STSZ),d.box(d.types.stco,d.STCO))},d.avc1=function(l){var n=[],s=[],a,c,h;for(a=0;a<l.sps.length;a++)c=l.sps[a],h=c.byteLength,n.push(h>>>8&255),n.push(h&255),n=n.concat(Array.prototype.slice.call(c));for(a=0;a<l.pps.length;a++)c=l.pps[a],h=c.byteLength,s.push(h>>>8&255),s.push(h&255),s=s.concat(Array.prototype.slice.call(c));var g=d.box(d.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|l.sps.length].concat(n).concat([l.pps.length]).concat(s))),m=l.width,S=l.height,x=l.pixelRatio[0],U=l.pixelRatio[1];return d.box(d.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,S>>8&255,S&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),g,d.box(d.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),d.box(d.types.pasp,new Uint8Array([x>>24,x>>16&255,x>>8&255,x&255,U>>24,U>>16&255,U>>8&255,U&255])))},d.esds=function(l){var n=l.config.length;return new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(l.config).concat([6,1,2]))},d.audioStsd=function(l){var n=l.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,l.channelCount,0,16,0,0,0,0,n>>8&255,n&255,0,0])},d.mp4a=function(l){return d.box(d.types.mp4a,d.audioStsd(l),d.box(d.types.esds,d.esds(l)))},d.mp3=function(l){return d.box(d.types[".mp3"],d.audioStsd(l))},d.ac3=function(l){return d.box(d.types["ac-3"],d.audioStsd(l),d.box(d.types.dac3,l.config))},d.stsd=function(l){return l.type==="audio"?l.segmentCodec==="mp3"&&l.codec==="mp3"?d.box(d.types.stsd,d.STSD,d.mp3(l)):l.segmentCodec==="ac3"?d.box(d.types.stsd,d.STSD,d.ac3(l)):d.box(d.types.stsd,d.STSD,d.mp4a(l)):d.box(d.types.stsd,d.STSD,d.avc1(l))},d.tkhd=function(l){var n=l.id,s=l.duration*l.timescale,a=l.width,c=l.height,h=Math.floor(s/(aa+1)),g=Math.floor(s%(aa+1));return d.box(d.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,0,0,0,0,h>>24,h>>16&255,h>>8&255,h&255,g>>24,g>>16&255,g>>8&255,g&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,a&255,0,0,c>>8&255,c&255,0,0]))},d.traf=function(l,n){var s=d.sdtp(l),a=l.id,c=Math.floor(n/(aa+1)),h=Math.floor(n%(aa+1));return d.box(d.types.traf,d.box(d.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255])),d.box(d.types.tfdt,new Uint8Array([1,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,h>>24,h>>16&255,h>>8&255,h&255])),d.trun(l,s.length+16+20+8+16+8+8),s)},d.trak=function(l){return l.duration=l.duration||4294967295,d.box(d.types.trak,d.tkhd(l),d.mdia(l))},d.trex=function(l){var n=l.id;return d.box(d.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},d.trun=function(l,n){var s=l.samples||[],a=s.length,c=12+16*a,h=new Uint8Array(c),g,m,S,x,U,ne;for(n+=8+c,h.set([l.type==="video"?1:0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,a&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255],0),g=0;g<a;g++)m=s[g],S=m.duration,x=m.size,U=m.flags,ne=m.cts,h.set([S>>>24&255,S>>>16&255,S>>>8&255,S&255,x>>>24&255,x>>>16&255,x>>>8&255,x&255,U.isLeading<<2|U.dependsOn,U.isDependedOn<<6|U.hasRedundancy<<4|U.paddingValue<<1|U.isNonSync,U.degradPrio&61440,U.degradPrio&15,ne>>>24&255,ne>>>16&255,ne>>>8&255,ne&255],12+16*g);return d.box(d.types.trun,h)},d.initSegment=function(l){d.types||d.init();var n=d.moov(l),s=Ei(d.FTYP,n);return s},d}();kr.types=void 0,kr.HDLR_TYPES=void 0,kr.STTS=void 0,kr.STSC=void 0,kr.STCO=void 0,kr.STSZ=void 0,kr.VMHD=void 0,kr.SMHD=void 0,kr.STSD=void 0,kr.FTYP=void 0,kr.DINF=void 0;var Fu=9e4;function mo(d,u,l,n){l===void 0&&(l=1),n===void 0&&(n=!1);var s=d*u*l;return n?Math.round(s):s}function Zc(d,u,l,n){return l===void 0&&(l=1),n===void 0&&(n=!1),mo(d,u,1/l,n)}function Vo(d,u){return u===void 0&&(u=!1),mo(d,1e3,1/Fu,u)}function ed(d,u){return u===void 0&&(u=1),mo(d,Fu,1/u)}var td=10*1e3,Bu=1024,id=1152,rd=1536,oa=null,Ho=null,la=function(){function d(l,n,s,a){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=l,this.config=n,this.typeSupported=s,this.ISGenerated=!1,oa===null){var c=navigator.userAgent||"",h=c.match(/Chrome\/(\d+)/i);oa=h?parseInt(h[1]):0}if(Ho===null){var g=navigator.userAgent.match(/Safari\/(\d+)/i);Ho=g?parseInt(g[1]):0}}var u=d.prototype;return u.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},u.resetTimeStamp=function(n){Qe.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=n},u.resetNextTimestamp=function(){Qe.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){Qe.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},u.getVideoStartPts=function(n){var s=!1,a=n.reduce(function(c,h){var g=h.pts-c;return g<-4294967296?(s=!0,Fr(c,h.pts)):g>0?c:h.pts},n[0].pts);return s&&Qe.debug("PTS rollover detected"),a},u.remux=function(n,s,a,c,h,g,m,S){var x,U,ne,ue,ge,ye,Se=h,xe=h,De=n.pid>-1,Fe=s.pid>-1,He=s.samples.length,rt=n.samples.length>0,ze=m&&He>0||He>1,Ve=(!De||rt)&&(!Fe||ze)||this.ISGenerated||m;if(Ve){if(this.ISGenerated){var Ze,et,ot,ct,yt=this.videoTrackConfig;yt&&(s.width!==yt.width||s.height!==yt.height||((Ze=s.pixelRatio)==null?void 0:Ze[0])!==((et=yt.pixelRatio)==null?void 0:et[0])||((ot=s.pixelRatio)==null?void 0:ot[1])!==((ct=yt.pixelRatio)==null?void 0:ct[1]))&&this.resetInitSegment()}else ne=this.generateIS(n,s,h,g);var wt=this.isVideoContiguous,It=-1,Ht;if(ze&&(It=nd(s.samples),!wt&&this.config.forceKeyFrameOnDiscontinuity))if(ye=!0,It>0){Qe.warn("[mp4-remuxer]: Dropped "+It+" out of "+He+" video samples due to a missing keyframe");var jt=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(It),s.dropped+=It,xe+=(s.samples[0].pts-jt)/s.inputTimeScale,Ht=xe}else It===-1&&(Qe.warn("[mp4-remuxer]: No keyframe found out of "+He+" video samples"),ye=!1);if(this.ISGenerated){if(rt&&ze){var Zt=this.getVideoStartPts(s.samples),ei=Fr(n.samples[0].pts,Zt)-Zt,Kt=ei/s.inputTimeScale;Se+=Math.max(0,Kt),xe+=Math.max(0,-Kt)}if(rt){if(n.samplerate||(Qe.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),ne=this.generateIS(n,s,h,g)),U=this.remuxAudio(n,Se,this.isAudioContiguous,g,Fe||ze||S===Nt.AUDIO?xe:void 0),ze){var Ai=U?U.endPTS-U.startPTS:0;s.inputTimeScale||(Qe.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),ne=this.generateIS(n,s,h,g)),x=this.remuxVideo(s,xe,wt,Ai)}}else ze&&(x=this.remuxVideo(s,xe,wt,0));x&&(x.firstKeyFrame=It,x.independent=It!==-1,x.firstKeyFramePTS=Ht)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(a.samples.length&&(ge=Ba(a,h,this._initPTS,this._initDTS)),c.samples.length&&(ue=Uu(c,h,this._initPTS))),{audio:U,video:x,initSegment:ne,independent:ye,text:ue,id3:ge}},u.generateIS=function(n,s,a,c){var h=n.samples,g=s.samples,m=this.typeSupported,S={},x=this._initPTS,U=!x||c,ne="audio/mp4",ue,ge,ye;if(U&&(ue=ge=1/0),n.config&&h.length){switch(n.timescale=n.samplerate,n.segmentCodec){case"mp3":m.mpeg?(ne="audio/mpeg",n.codec=""):m.mp3&&(n.codec="mp3");break;case"ac3":n.codec="ac-3";break}S.audio={id:"audio",container:ne,codec:n.codec,initSegment:n.segmentCodec==="mp3"&&m.mpeg?new Uint8Array(0):kr.initSegment([n]),metadata:{channelCount:n.channelCount}},U&&(ye=n.inputTimeScale,!x||ye!==x.timescale?ue=ge=h[0].pts-Math.round(ye*a):U=!1)}if(s.sps&&s.pps&&g.length){if(s.timescale=s.inputTimeScale,S.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:kr.initSegment([s]),metadata:{width:s.width,height:s.height}},U)if(ye=s.inputTimeScale,!x||ye!==x.timescale){var Se=this.getVideoStartPts(g),xe=Math.round(ye*a);ge=Math.min(ge,Fr(g[0].dts,Se)-xe),ue=Math.min(ue,Se-xe)}else U=!1;this.videoTrackConfig={width:s.width,height:s.height,pixelRatio:s.pixelRatio}}if(Object.keys(S).length)return this.ISGenerated=!0,U?(this._initPTS={baseTime:ue,timescale:ye},this._initDTS={baseTime:ge,timescale:ye}):ue=ye=void 0,{tracks:S,initPTS:ue,timescale:ye}},u.remuxVideo=function(n,s,a,c){var h=n.inputTimeScale,g=n.samples,m=[],S=g.length,x=this._initPTS,U=this.nextAvcDts,ne=8,ue=this.videoSampleDuration,ge,ye,Se=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY,De=!1;if(!a||U===null){var Fe=s*h,He=g[0].pts-Fr(g[0].dts,g[0].pts);oa&&U!==null&&Math.abs(Fe-He-U)<15e3?a=!0:U=Fe-He}for(var rt=x.baseTime*h/x.timescale,ze=0;ze<S;ze++){var Ve=g[ze];Ve.pts=Fr(Ve.pts-rt,U),Ve.dts=Fr(Ve.dts-rt,U),Ve.dts<g[ze>0?ze-1:ze].dts&&(De=!0)}De&&g.sort(function(pa,Zd){var eh=pa.dts-Zd.dts,wf=pa.pts-Zd.pts;return eh||wf}),ge=g[0].dts,ye=g[g.length-1].dts;var Ze=ye-ge,et=Ze?Math.round(Ze/(S-1)):ue||n.inputTimeScale/30;if(a){var ot=ge-U,ct=ot>et,yt=ot<-1;if((ct||yt)&&(ct?Qe.warn("AVC: "+Vo(ot,!0)+" ms ("+ot+"dts) hole between fragments detected at "+s.toFixed(3)):Qe.warn("AVC: "+Vo(-ot,!0)+" ms ("+ot+"dts) overlapping between fragments detected at "+s.toFixed(3)),!yt||U>=g[0].pts||oa)){ge=U;var wt=g[0].pts-ot;if(ct)g[0].dts=ge,g[0].pts=wt;else for(var It=0;It<g.length&&!(g[It].dts>wt);It++)g[It].dts-=ot,g[It].pts-=ot;Qe.log("Video: Initial PTS/DTS adjusted: "+Vo(wt,!0)+"/"+Vo(ge,!0)+", delta: "+Vo(ot,!0)+" ms")}}ge=Math.max(0,ge);for(var Ht=0,jt=0,Zt=ge,ei=0;ei<S;ei++){for(var Kt=g[ei],Ai=Kt.units,li=Ai.length,rr=0,Yi=0;Yi<li;Yi++)rr+=Ai[Yi].data.length;jt+=rr,Ht+=li,Kt.length=rr,Kt.dts<Zt?(Kt.dts=Zt,Zt+=et/4|0||1):Zt=Kt.dts,Se=Math.min(Kt.pts,Se),xe=Math.max(Kt.pts,xe)}ye=g[S-1].dts;var Lr=jt+4*Ht+8,Si;try{Si=new Uint8Array(Lr)}catch(pa){this.observer.emit(_e.ERROR,_e.ERROR,{type:Pt.MUX_ERROR,details:je.REMUX_ALLOC_ERROR,fatal:!1,error:pa,bytes:Lr,reason:"fail allocating video mdat "+Lr});return}var Bi=new DataView(Si.buffer);Bi.setUint32(0,Lr),Si.set(kr.types.mdat,4);for(var _n=!1,bn=Number.POSITIVE_INFINITY,ci=Number.POSITIVE_INFINITY,Gr=Number.NEGATIVE_INFINITY,dn=Number.NEGATIVE_INFINITY,Oi=0;Oi<S;Oi++){for(var ar=g[Oi],br=ar.units,Jr=0,Ki=0,Us=br.length;Ki<Us;Ki++){var Gs=br[Ki],An=Gs.data,fa=Gs.data.byteLength;Bi.setUint32(ne,fa),ne+=4,Si.set(An,ne),ne+=fa,Jr+=4+fa}var Qn=void 0;if(Oi<S-1)ue=g[Oi+1].dts-ar.dts,Qn=g[Oi+1].pts-ar.pts;else{var nl=this.config,uu=Oi>0?ar.dts-g[Oi-1].dts:et;if(Qn=Oi>0?ar.pts-g[Oi-1].pts:et,nl.stretchShortVideoTrack&&this.nextAudioPts!==null){var xf=Math.floor(nl.maxBufferHole*h),_c=(c?Se+c*h:this.nextAudioPts)-ar.pts;_c>xf?(ue=_c-uu,ue<0?ue=uu:_n=!0,Qe.log("[mp4-remuxer]: It is approximately "+_c/90+" ms to the next segment; using duration "+ue/90+" ms for the last video frame.")):ue=uu}else ue=uu}var Cf=Math.round(ar.pts-ar.dts);bn=Math.min(bn,ue),Gr=Math.max(Gr,ue),ci=Math.min(ci,Qn),dn=Math.max(dn,Qn),m.push(new Vl(ar.key,ue,Jr,Cf))}if(m.length){if(oa){if(oa<70){var Xd=m[0].flags;Xd.dependsOn=2,Xd.isNonSync=0}}else if(Ho&&dn-ci<Gr-bn&&et/Gr<.025&&m[0].cts===0){Qe.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var cu=ge,vi=0,bc=m.length;vi<bc;vi++){var Qd=cu+m[vi].duration,_o=cu+m[vi].cts;if(vi<bc-1){var Jd=Qd+m[vi+1].cts;m[vi].duration=Jd-_o}else m[vi].duration=vi?m[vi-1].duration:et;m[vi].cts=0,cu=Qd}}}ue=_n||!ue?et:ue,this.nextAvcDts=U=ye+ue,this.videoSampleDuration=ue,this.isVideoContiguous=!0;var kf=kr.moof(n.sequenceNumber++,ge,Di({},n,{samples:m})),Df="video",bo={data1:kf,data2:Si,startPTS:Se/h,endPTS:(xe+ue)/h,startDTS:ge/h,endDTS:U/h,type:Df,hasAudio:!1,hasVideo:!0,nb:m.length,dropped:n.dropped};return n.samples=[],n.dropped=0,bo},u.getSamplesPerFrame=function(n){switch(n.segmentCodec){case"mp3":return id;case"ac3":return rd;default:return Bu}},u.remuxAudio=function(n,s,a,c,h){var g=n.inputTimeScale,m=n.samplerate?n.samplerate:g,S=g/m,x=this.getSamplesPerFrame(n),U=x*S,ne=this._initPTS,ue=n.segmentCodec==="mp3"&&this.typeSupported.mpeg,ge=[],ye=h!==void 0,Se=n.samples,xe=ue?0:8,De=this.nextAudioPts||-1,Fe=s*g,He=ne.baseTime*g/ne.timescale;if(this.isAudioContiguous=a=a||Se.length&&De>0&&(c&&Math.abs(Fe-De)<9e3||Math.abs(Fr(Se[0].pts-He,Fe)-De)<20*U),Se.forEach(function(Ki){Ki.pts=Fr(Ki.pts-He,Fe)}),!a||De<0){if(Se=Se.filter(function(Ki){return Ki.pts>=0}),!Se.length)return;h===0?De=0:c&&!ye?De=Math.max(0,Fe):De=Se[0].pts}if(n.segmentCodec==="aac")for(var rt=this.config.maxAudioFramesDrift,ze=0,Ve=De;ze<Se.length;ze++){var Ze=Se[ze],et=Ze.pts,ot=et-Ve,ct=Math.abs(1e3*ot/g);if(ot<=-rt*U&&ye)ze===0&&(Qe.warn("Audio frame @ "+(et/g).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ot/g)+" ms."),this.nextAudioPts=De=Ve=et);else if(ot>=rt*U&&ct<td&&ye){var yt=Math.round(ot/U);Ve=et-yt*U,Ve<0&&(yt--,Ve+=U),ze===0&&(this.nextAudioPts=De=Ve),Qe.warn("[mp4-remuxer]: Injecting "+yt+" audio frame @ "+(Ve/g).toFixed(3)+"s due to "+Math.round(1e3*ot/g)+" ms gap.");for(var wt=0;wt<yt;wt++){var It=Math.max(Ve,0),Ht=Jc.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);Ht||(Qe.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ht=Ze.unit.subarray()),Se.splice(ze,0,{unit:Ht,pts:It}),Ve+=U,ze++}}Ze.pts=Ve,Ve+=U}for(var jt=null,Zt=null,ei,Kt=0,Ai=Se.length;Ai--;)Kt+=Se[Ai].unit.byteLength;for(var li=0,rr=Se.length;li<rr;li++){var Yi=Se[li],Lr=Yi.unit,Si=Yi.pts;if(Zt!==null){var Bi=ge[li-1];Bi.duration=Math.round((Si-Zt)/S)}else if(a&&n.segmentCodec==="aac"&&(Si=De),jt=Si,Kt>0){Kt+=xe;try{ei=new Uint8Array(Kt)}catch(Ki){this.observer.emit(_e.ERROR,_e.ERROR,{type:Pt.MUX_ERROR,details:je.REMUX_ALLOC_ERROR,fatal:!1,error:Ki,bytes:Kt,reason:"fail allocating audio mdat "+Kt});return}if(!ue){var _n=new DataView(ei.buffer);_n.setUint32(0,Kt),ei.set(kr.types.mdat,4)}}else return;ei.set(Lr,xe);var bn=Lr.byteLength;xe+=bn,ge.push(new Vl(!0,x,bn,0)),Zt=Si}var ci=ge.length;if(ci){var Gr=ge[ge.length-1];this.nextAudioPts=De=Zt+S*Gr.duration;var dn=ue?new Uint8Array(0):kr.moof(n.sequenceNumber++,jt/S,Di({},n,{samples:ge}));n.samples=[];var Oi=jt/g,ar=De/g,br="audio",Jr={data1:dn,data2:ei,startPTS:Oi,endPTS:ar,startDTS:Oi,endDTS:ar,type:br,hasAudio:!0,hasVideo:!1,nb:ci};return this.isAudioContiguous=!0,Jr}},u.remuxEmptyAudio=function(n,s,a,c){var h=n.inputTimeScale,g=n.samplerate?n.samplerate:h,m=h/g,S=this.nextAudioPts,x=this._initDTS,U=x.baseTime*9e4/x.timescale,ne=(S!==null?S:c.startDTS*h)+U,ue=c.endDTS*h+U,ge=m*Bu,ye=Math.ceil((ue-ne)/ge),Se=Jc.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);if(Qe.warn("[mp4-remuxer]: remux empty Audio"),!Se){Qe.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var xe=[],De=0;De<ye;De++){var Fe=ne+De*ge;xe.push({unit:Se,pts:Fe,dts:Fe})}return n.samples=xe,this.remuxAudio(n,s,a,!1)},d}();function Fr(d,u){var l;if(u===null)return d;for(u<d?l=-8589934592:l=8589934592;Math.abs(d-u)>4294967296;)d+=l;return d}function nd(d){for(var u=0;u<d.length;u++)if(d[u].key)return u;return-1}function Ba(d,u,l,n){var s=d.samples.length;if(s){for(var a=d.inputTimeScale,c=0;c<s;c++){var h=d.samples[c];h.pts=Fr(h.pts-l.baseTime*a/l.timescale,u*a)/a,h.dts=Fr(h.dts-n.baseTime*a/n.timescale,u*a)/a}var g=d.samples;return d.samples=[],{samples:g}}}function Uu(d,u,l){var n=d.samples.length;if(n){for(var s=d.inputTimeScale,a=0;a<n;a++){var c=d.samples[a];c.pts=Fr(c.pts-l.baseTime*s/l.timescale,u*s)/s}d.samples.sort(function(g,m){return g.pts-m.pts});var h=d.samples;return d.samples=[],{samples:h}}}var Vl=function(u,l,n,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=l,this.size=n,this.cts=s,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:u?2:1,isNonSync:u?0:1}},Gu=function(){function d(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var u=d.prototype;return u.destroy=function(){},u.resetTimeStamp=function(n){this.initPTS=n,this.lastEndTime=null},u.resetNextTimestamp=function(){this.lastEndTime=null},u.resetInitSegment=function(n,s,a,c){this.audioCodec=s,this.videoCodec=a,this.generateInitSegment(Tr(n,c)),this.emitInitSegment=!0},u.generateInitSegment=function(n){var s=this.audioCodec,a=this.videoCodec;if(!(n!=null&&n.byteLength)){this.initTracks=void 0,this.initData=void 0;return}var c=this.initData=nn(n);c.audio&&(s=Hl(c.audio,ti.AUDIO)),c.video&&(a=Hl(c.video,ti.VIDEO));var h={};c.audio&&c.video?h.audiovideo={container:"video/mp4",codec:s+","+a,initSegment:n,id:"main"}:c.audio?h.audio={container:"audio/mp4",codec:s,initSegment:n,id:"audio"}:c.video?h.video={container:"video/mp4",codec:a,initSegment:n,id:"main"}:Qe.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=h},u.remux=function(n,s,a,c,h,g){var m,S,x=this.initPTS,U=this.lastEndTime,ne={audio:void 0,video:void 0,text:c,id3:a,initSegment:void 0};Ct(U)||(U=this.lastEndTime=h||0);var ue=s.samples;if(!(ue!=null&&ue.length))return ne;var ge={initPTS:void 0,timescale:1},ye=this.initData;if((m=ye)!=null&&m.length||(this.generateInitSegment(ue),ye=this.initData),!((S=ye)!=null&&S.length))return Qe.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ne;this.emitInitSegment&&(ge.tracks=this.initTracks,this.emitInitSegment=!1);var Se=El(ue,ye),xe=Ca(ye,ue),De=xe===null?h:xe;(Vu(x,De,h,Se)||ge.timescale!==x.timescale&&g)&&(ge.initPTS=De-h,x&&x.timescale===1&&Qe.warn("Adjusting initPTS by "+(ge.initPTS-x.baseTime)),this.initPTS=x={baseTime:ge.initPTS,timescale:1});var Fe=n?De-x.baseTime/x.timescale:U,He=Fe+Se;pi(ye,ue,x.baseTime/x.timescale),Se>0?this.lastEndTime=He:(Qe.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var rt=!!ye.audio,ze=!!ye.video,Ve="";rt&&(Ve+="audio"),ze&&(Ve+="video");var Ze={data1:ue,startPTS:Fe,startDTS:Fe,endPTS:He,endDTS:He,type:Ve,hasAudio:rt,hasVideo:ze,nb:1,dropped:0};return ne.audio=Ze.type==="audio"?Ze:void 0,ne.video=Ze.type!=="audio"?Ze:void 0,ne.initSegment=ge,ne.id3=Ba(a,h,x,x),c.samples.length&&(ne.text=Uu(c,h,x)),ne},d}();function Vu(d,u,l,n){if(d===null)return!0;var s=Math.max(n,1),a=u-d.baseTime/d.timescale;return Math.abs(a-l)>s}function Hl(d,u){var l=d?.codec;if(l&&l.length>4)return l;if(u===ti.AUDIO){if(l==="ec-3"||l==="ac-3"||l==="alac")return l;if(l==="fLaC"||l==="Opus"){var n=!1;return ia(l,n)}var s="mp4a.40.5";return Qe.info('Parsed audio codec "'+l+'" or audio object type not handled. Using "'+s+'"'),s}return Qe.warn('Unhandled video codec "'+l+'"'),l==="hvc1"||l==="hev1"?"hvc1.1.6.L120.90":l==="av01"?"av01.0.04M.08":"avc1.42e01e"}var $n;try{$n=self.performance.now.bind(self.performance)}catch{Qe.debug("Unable to use Performance API on this environment"),$n=Rt?.Date.now}var jo=[{demux:Ou,remux:Gu},{demux:Nu,remux:la},{demux:Pu,remux:la},{demux:Qc,remux:la}];jo.splice(2,0,{demux:Yc,remux:la});var Ko=function(){function d(l,n,s,a,c){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=l,this.typeSupported=n,this.config=s,this.vendor=a,this.id=c}var u=d.prototype;return u.configure=function(n){this.transmuxConfig=n,this.decrypter&&this.decrypter.reset()},u.push=function(n,s,a,c){var h=this,g=a.transmuxing;g.executeStart=$n();var m=new Uint8Array(n),S=this.currentTransmuxState,x=this.transmuxConfig;c&&(this.currentTransmuxState=c);var U=c||S,ne=U.contiguous,ue=U.discontinuity,ge=U.trackSwitch,ye=U.accurateTimeOffset,Se=U.timeOffset,xe=U.initSegmentChange,De=x.audioCodec,Fe=x.videoCodec,He=x.defaultInitPts,rt=x.duration,ze=x.initSegmentData,Ve=sd(m,s);if(Ve&&Ve.method==="AES-128"){var Ze=this.getDecrypter();if(Ze.isSync()){var et=Ze.softwareDecrypt(m,Ve.key.buffer,Ve.iv.buffer),ot=a.part>-1;if(ot&&(et=Ze.flush()),!et)return g.executeEnd=$n(),jl(a);m=new Uint8Array(et)}else return this.decryptionPromise=Ze.webCryptoDecrypt(m,Ve.key.buffer,Ve.iv.buffer).then(function(Ht){var jt=h.push(Ht,null,a);return h.decryptionPromise=null,jt}),this.decryptionPromise}var ct=this.needsProbing(ue,ge);if(ct){var yt=this.configureTransmuxer(m);if(yt)return Qe.warn("[transmuxer] "+yt.message),this.observer.emit(_e.ERROR,_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,fatal:!1,error:yt,reason:yt.message}),g.executeEnd=$n(),jl(a)}(ue||ge||xe||ct)&&this.resetInitSegment(ze,De,Fe,rt,s),(ue||xe||ct)&&this.resetInitialTimestamp(He),ne||this.resetContiguity();var wt=this.transmux(m,Ve,Se,ye,a),It=this.currentTransmuxState;return It.contiguous=!0,It.discontinuity=!1,It.trackSwitch=!1,g.executeEnd=$n(),wt},u.flush=function(n){var s=this,a=n.transmuxing;a.executeStart=$n();var c=this.decrypter,h=this.currentTransmuxState,g=this.decryptionPromise;if(g)return g.then(function(){return s.flush(n)});var m=[],S=h.timeOffset;if(c){var x=c.flush();x&&m.push(this.push(x,null,n))}var U=this.demuxer,ne=this.remuxer;if(!U||!ne)return a.executeEnd=$n(),[jl(n)];var ue=U.flush(S);return Ps(ue)?ue.then(function(ge){return s.flushRemux(m,ge,n),m}):(this.flushRemux(m,ue,n),m)},u.flushRemux=function(n,s,a){var c=s.audioTrack,h=s.videoTrack,g=s.id3Track,m=s.textTrack,S=this.currentTransmuxState,x=S.accurateTimeOffset,U=S.timeOffset;Qe.log("[transmuxer.ts]: Flushed fragment "+a.sn+(a.part>-1?" p: "+a.part:"")+" of level "+a.level);var ne=this.remuxer.remux(c,h,g,m,U,x,!0,this.id);n.push({remuxResult:ne,chunkMeta:a}),a.transmuxing.executeEnd=$n()},u.resetInitialTimestamp=function(n){var s=this.demuxer,a=this.remuxer;!s||!a||(s.resetTimeStamp(n),a.resetTimeStamp(n))},u.resetContiguity=function(){var n=this.demuxer,s=this.remuxer;!n||!s||(n.resetContiguity(),s.resetNextTimestamp())},u.resetInitSegment=function(n,s,a,c,h){var g=this.demuxer,m=this.remuxer;!g||!m||(g.resetInitSegment(n,s,a,c),m.resetInitSegment(n,s,a,h))},u.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},u.transmux=function(n,s,a,c,h){var g;return s&&s.method==="SAMPLE-AES"?g=this.transmuxSampleAes(n,s,a,c,h):g=this.transmuxUnencrypted(n,a,c,h),g},u.transmuxUnencrypted=function(n,s,a,c){var h=this.demuxer.demux(n,s,!1,!this.config.progressive),g=h.audioTrack,m=h.videoTrack,S=h.id3Track,x=h.textTrack,U=this.remuxer.remux(g,m,S,x,s,a,!1,this.id);return{remuxResult:U,chunkMeta:c}},u.transmuxSampleAes=function(n,s,a,c,h){var g=this;return this.demuxer.demuxSampleAes(n,s,a).then(function(m){var S=g.remuxer.remux(m.audioTrack,m.videoTrack,m.id3Track,m.textTrack,a,c,!1,g.id);return{remuxResult:S,chunkMeta:h}})},u.configureTransmuxer=function(n){for(var s=this.config,a=this.observer,c=this.typeSupported,h=this.vendor,g,m=0,S=jo.length;m<S;m++){var x;if((x=jo[m].demux)!=null&&x.probe(n)){g=jo[m];break}}if(!g)return new Error("Failed to find demuxer by probing fragment data");var U=this.demuxer,ne=this.remuxer,ue=g.remux,ge=g.demux;(!ne||!(ne instanceof ue))&&(this.remuxer=new ue(a,s,c,h)),(!U||!(U instanceof ge))&&(this.demuxer=new ge(a,s,c),this.probe=ge.probe)},u.needsProbing=function(n,s){return!this.demuxer||!this.remuxer||n||s},u.getDecrypter=function(){var n=this.decrypter;return n||(n=this.decrypter=new yn(this.config)),n},d}();function sd(d,u){var l=null;return d.byteLength>0&&u?.key!=null&&u.iv!==null&&u.method!=null&&(l=u),l}var jl=function(u){return{remuxResult:{},chunkMeta:u}};function Ps(d){return"then"in d&&d.then instanceof Function}var ad=function(u,l,n,s,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=u,this.videoCodec=l,this.initSegmentData=n,this.duration=s,this.defaultInitPts=a||null},od=function(u,l,n,s,a,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=u,this.contiguous=l,this.accurateTimeOffset=n,this.trackSwitch=s,this.timeOffset=a,this.initSegmentChange=c},ld={exports:{}};(function(d){var u=Object.prototype.hasOwnProperty,l="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(l=!1));function s(g,m,S){this.fn=g,this.context=m,this.once=S||!1}function a(g,m,S,x,U){if(typeof S!="function")throw new TypeError("The listener must be a function");var ne=new s(S,x||g,U),ue=l?l+m:m;return g._events[ue]?g._events[ue].fn?g._events[ue]=[g._events[ue],ne]:g._events[ue].push(ne):(g._events[ue]=ne,g._eventsCount++),g}function c(g,m){--g._eventsCount===0?g._events=new n:delete g._events[m]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var m=[],S,x;if(this._eventsCount===0)return m;for(x in S=this._events)u.call(S,x)&&m.push(l?x.slice(1):x);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(S)):m},h.prototype.listeners=function(m){var S=l?l+m:m,x=this._events[S];if(!x)return[];if(x.fn)return[x.fn];for(var U=0,ne=x.length,ue=new Array(ne);U<ne;U++)ue[U]=x[U].fn;return ue},h.prototype.listenerCount=function(m){var S=l?l+m:m,x=this._events[S];return x?x.fn?1:x.length:0},h.prototype.emit=function(m,S,x,U,ne,ue){var ge=l?l+m:m;if(!this._events[ge])return!1;var ye=this._events[ge],Se=arguments.length,xe,De;if(ye.fn){switch(ye.once&&this.removeListener(m,ye.fn,void 0,!0),Se){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,S),!0;case 3:return ye.fn.call(ye.context,S,x),!0;case 4:return ye.fn.call(ye.context,S,x,U),!0;case 5:return ye.fn.call(ye.context,S,x,U,ne),!0;case 6:return ye.fn.call(ye.context,S,x,U,ne,ue),!0}for(De=1,xe=new Array(Se-1);De<Se;De++)xe[De-1]=arguments[De];ye.fn.apply(ye.context,xe)}else{var Fe=ye.length,He;for(De=0;De<Fe;De++)switch(ye[De].once&&this.removeListener(m,ye[De].fn,void 0,!0),Se){case 1:ye[De].fn.call(ye[De].context);break;case 2:ye[De].fn.call(ye[De].context,S);break;case 3:ye[De].fn.call(ye[De].context,S,x);break;case 4:ye[De].fn.call(ye[De].context,S,x,U);break;default:if(!xe)for(He=1,xe=new Array(Se-1);He<Se;He++)xe[He-1]=arguments[He];ye[De].fn.apply(ye[De].context,xe)}}return!0},h.prototype.on=function(m,S,x){return a(this,m,S,x,!1)},h.prototype.once=function(m,S,x){return a(this,m,S,x,!0)},h.prototype.removeListener=function(m,S,x,U){var ne=l?l+m:m;if(!this._events[ne])return this;if(!S)return c(this,ne),this;var ue=this._events[ne];if(ue.fn)ue.fn===S&&(!U||ue.once)&&(!x||ue.context===x)&&c(this,ne);else{for(var ge=0,ye=[],Se=ue.length;ge<Se;ge++)(ue[ge].fn!==S||U&&!ue[ge].once||x&&ue[ge].context!==x)&&ye.push(ue[ge]);ye.length?this._events[ne]=ye.length===1?ye[0]:ye:c(this,ne)}return this},h.prototype.removeAllListeners=function(m){var S;return m?(S=l?l+m:m,this._events[S]&&c(this,S)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=l,h.EventEmitter=h,d.exports=h})(ld);var ud=ld.exports,qo=oi(ud);typeof or<"u"&&or&&cd(self);function cd(d){var u=new qo,l=function(a,c){d.postMessage({event:a,data:c})};u.on(_e.FRAG_DECRYPTED,l),u.on(_e.ERROR,l);var n=function(){var a=function(g){var m=function(x){l("workerLog",{logType:g,message:x})};Qe[g]=m};for(var c in Qe)a(c)};d.addEventListener("message",function(s){var a=s.data;switch(a.cmd){case"init":{var c=JSON.parse(a.config);d.transmuxer=new Ko(u,a.typeSupported,c,"",a.id),Co(c.debug,a.id),n(),l("init",null);break}case"configure":{d.transmuxer.configure(a.config);break}case"demux":{var h=d.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);Ps(h)?(d.transmuxer.async=!0,h.then(function(x){Os(d,x)}).catch(function(x){l(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:x,err:x,reason:"transmuxer-worker push error"})})):(d.transmuxer.async=!1,Os(d,h));break}case"flush":{var g=a.chunkMeta,m=d.transmuxer.flush(g),S=Ps(m);S||d.transmuxer.async?(Ps(m)||(m=Promise.resolve(m)),m.then(function(x){ju(d,x,g)}).catch(function(x){l(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:x,err:x,reason:"transmuxer-worker flush error"})})):ju(d,m,g);break}}})}function Os(d,u){if(dd(u.remuxResult))return!1;var l=[],n=u.remuxResult,s=n.audio,a=n.video;return s&&Hu(l,s),a&&Hu(l,a),d.postMessage({event:"transmuxComplete",data:u},l),!0}function Hu(d,u){u.data1&&d.push(u.data1.buffer),u.data2&&d.push(u.data2.buffer)}function ju(d,u,l){var n=u.reduce(function(s,a){return Os(d,a)||s},!1);n||d.postMessage({event:"transmuxComplete",data:u[0]}),d.postMessage({event:"flush",data:l})}function dd(d){return!d.audio&&!d.video&&!d.text&&!d.id3&&!d.initSegment}function Ku(){return typeof Un=="function"}function hd(){var d=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+Un.toString()+")(true);"],{type:"text/javascript"}),u=self.URL.createObjectURL(d),l=new self.Worker(u);return{worker:l,objectURL:u}}function fd(d){var u=new self.URL(d,self.location.href).href,l=new self.Worker(u);return{worker:l,scriptURL:u}}var qu=function(){function d(l,n,s,a){var c=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var h=l.config;this.hls=l,this.id=n,this.useWorker=!!h.enableWorker,this.onTransmuxComplete=s,this.onFlush=a;var g=function(ue,ge){ge=ge||{},ge.frag=c.frag,ge.id=c.id,ue===_e.ERROR&&(c.error=ge.error),c.hls.trigger(ue,ge)};this.observer=new qo,this.observer.on(_e.FRAG_DECRYPTED,g),this.observer.on(_e.ERROR,g);var m=Tt(h.preferManagedMediaSource)||{isTypeSupported:function(){return!1}},S={mpeg:m.isTypeSupported("audio/mpeg"),mp3:m.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:m.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"){var x=h.workerPath||Ku();if(x){try{h.workerPath?(Qe.log("loading Web Worker "+h.workerPath+' for "'+n+'"'),this.workerContext=fd(h.workerPath)):(Qe.log('injecting Web Worker for "'+n+'"'),this.workerContext=hd()),this.onwmsg=function(ne){return c.onWorkerMessage(ne)};var U=this.workerContext.worker;U.addEventListener("message",this.onwmsg),U.onerror=function(ne){var ue=new Error(ne.message+"  ("+ne.filename+":"+ne.lineno+")");h.enableWorker=!1,Qe.warn('Error in "'+n+'" Web Worker, fallback to inline'),c.hls.trigger(_e.ERROR,{type:Pt.OTHER_ERROR,details:je.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:ue})},U.postMessage({cmd:"init",typeSupported:S,vendor:"",id:n,config:JSON.stringify(h)})}catch(ne){Qe.warn('Error setting up "'+n+'" Web Worker, fallback to inline',ne),this.resetWorker(),this.error=null,this.transmuxer=new Ko(this.observer,S,h,"",n)}return}}this.transmuxer=new Ko(this.observer,S,h,"",n)}var u=d.prototype;return u.resetWorker=function(){if(this.workerContext){var n=this.workerContext,s=n.worker,a=n.objectURL;a&&self.URL.revokeObjectURL(a),s.removeEventListener("message",this.onwmsg),s.onerror=null,s.terminate(),this.workerContext=null}},u.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}var s=this.observer;s&&s.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},u.push=function(n,s,a,c,h,g,m,S,x,U){var ne,ue,ge=this;x.transmuxing.start=self.performance.now();var ye=this.transmuxer,Se=g?g.start:h.start,xe=h.decryptdata,De=this.frag,Fe=!(De&&h.cc===De.cc),He=!(De&&x.level===De.level),rt=De?x.sn-De.sn:-1,ze=this.part?x.part-this.part.index:-1,Ve=rt===0&&x.id>1&&x.id===De?.stats.chunkCount,Ze=!He&&(rt===1||rt===0&&(ze===1||Ve&&ze<=0)),et=self.performance.now();(He||rt||h.stats.parsing.start===0)&&(h.stats.parsing.start=et),g&&(ze||!Ze)&&(g.stats.parsing.start=et);var ot=!(De&&((ne=h.initSegment)==null?void 0:ne.url)===((ue=De.initSegment)==null?void 0:ue.url)),ct=new od(Fe,Ze,S,He,Se,ot);if(!Ze||Fe||ot){Qe.log("[transmuxer-interface, "+h.type+"]: Starting new transmux session for sn: "+x.sn+" p: "+x.part+" level: "+x.level+" id: "+x.id+`
        discontinuity: `+Fe+`
        trackSwitch: `+He+`
        contiguous: `+Ze+`
        accurateTimeOffset: `+S+`
        timeOffset: `+Se+`
        initSegmentChange: `+ot);var yt=new ad(a,c,s,m,U);this.configureTransmuxer(yt)}if(this.frag=h,this.part=g,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:n,decryptdata:xe,chunkMeta:x,state:ct},n instanceof ArrayBuffer?[n]:[]);else if(ye){var wt=ye.push(n,xe,x,ct);Ps(wt)?(ye.async=!0,wt.then(function(It){ge.handleTransmuxComplete(It)}).catch(function(It){ge.transmuxerError(It,x,"transmuxer-interface push error")})):(ye.async=!1,this.handleTransmuxComplete(wt))}},u.flush=function(n){var s=this;n.transmuxing.start=self.performance.now();var a=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:n});else if(a){var c=a.flush(n),h=Ps(c);h||a.async?(Ps(c)||(c=Promise.resolve(c)),c.then(function(g){s.handleFlushResult(g,n)}).catch(function(g){s.transmuxerError(g,n,"transmuxer-interface flush error")})):this.handleFlushResult(c,n)}},u.transmuxerError=function(n,s,a){this.hls&&(this.error=n,this.hls.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_PARSING_ERROR,chunkMeta:s,frag:this.frag||void 0,fatal:!1,error:n,err:n,reason:a}))},u.handleFlushResult=function(n,s){var a=this;n.forEach(function(c){a.handleTransmuxComplete(c)}),this.onFlush(s)},u.onWorkerMessage=function(n){var s=n.data;if(!(s!=null&&s.event)){Qe.warn("worker message received with no "+(s?"event name":"data"));return}var a=this.hls;if(this.hls)switch(s.event){case"init":{var c,h=(c=this.workerContext)==null?void 0:c.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(s.data);break}case"flush":{this.onFlush(s.data);break}case"workerLog":Qe[s.data.logType]&&Qe[s.data.logType](s.data.message);break;default:{s.data=s.data||{},s.data.frag=this.frag,s.data.id=this.id,a.trigger(s.event,s.data);break}}},u.configureTransmuxer=function(n){var s=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:n}):s&&s.configure(n)},u.handleTransmuxComplete=function(n){n.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(n)},d}();function $u(d,u){if(d.length!==u.length)return!1;for(var l=0;l<d.length;l++)if(!Ua(d[l].attrs,u[l].attrs))return!1;return!0}function Ua(d,u,l){var n=d["STABLE-RENDITION-ID"];return n&&!l?n===u["STABLE-RENDITION-ID"]:!(l||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(s){return d[s]!==u[s]})}function Kl(d,u){return u.label.toLowerCase()===d.name.toLowerCase()&&(!u.language||u.language.toLowerCase()===(d.lang||"").toLowerCase())}var Wu=100,pd=function(d){Bt(u,d);function u(n,s,a){var c;return c=d.call(this,n,s,a,"[audio-stream-controller]",Nt.AUDIO)||this,c.videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.bufferedTrack=null,c.switchingTrack=null,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.flushing=!1,c.bufferFlushed=!1,c.cachedTrackLoadedData=null,c._registerListeners(),c}var l=u.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),d.prototype.onHandlerDestroying.call(this),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},l._registerListeners=function(){var s=this.hls;s.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.on(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.on(_e.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(_e.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(_e.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(_e.ERROR,this.onError,this),s.on(_e.BUFFER_RESET,this.onBufferReset,this),s.on(_e.BUFFER_CREATED,this.onBufferCreated,this),s.on(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(_e.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(_e.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(_e.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var s=this.hls;s.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.off(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.off(_e.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(_e.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(_e.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(_e.ERROR,this.onError,this),s.off(_e.BUFFER_RESET,this.onBufferReset,this),s.off(_e.BUFFER_CREATED,this.onBufferCreated,this),s.off(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(_e.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(_e.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(_e.FRAG_BUFFERED,this.onFragBuffered,this)},l.onInitPtsFound=function(s,a){var c=a.frag,h=a.id,g=a.initPTS,m=a.timescale;if(h==="main"){var S=c.cc;this.initPTS[c.cc]={baseTime:g,timescale:m},this.log("InitPTS for cc: "+S+" found from main: "+g),this.videoTrackCC=S,this.state===ht.WAITING_INIT_PTS&&this.tick()}},l.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=ht.STOPPED;return}var a=this.lastCurrentTime;this.stopLoad(),this.setInterval(Wu),a>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),s=a,this.state=ht.IDLE):(this.loadedmetadata=!1,this.state=ht.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},l.doTick=function(){switch(this.state){case ht.IDLE:this.doTickIdle();break;case ht.WAITING_TRACK:{var s,a=this.levels,c=this.trackId,h=a==null||(s=a[c])==null?void 0:s.details;if(h){if(this.waitForCdnTuneIn(h))break;this.state=ht.WAITING_INIT_PTS}break}case ht.FRAG_LOADING_WAITING_RETRY:{var g,m=performance.now(),S=this.retryDate;if(!S||m>=S||(g=this.media)!=null&&g.seeking){var x=this.levels,U=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(x?.[U]||null),this.state=ht.IDLE}break}case ht.WAITING_INIT_PTS:{var ne=this.waitingData;if(ne){var ue=ne.frag,ge=ne.part,ye=ne.cache,Se=ne.complete;if(this.initPTS[ue.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=ht.FRAG_LOADING;var xe=ye.flush(),De={frag:ue,part:ge,payload:xe,networkDetails:null};this._handleFragmentLoadProgress(De),Se&&d.prototype._handleFragmentLoadComplete.call(this,De)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+ue.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Fe=this.getLoadPosition(),He=Vt.bufferInfo(this.mediaBuffer,Fe,this.config.maxBufferHole),rt=D(He.end,this.config.maxFragLookUpTolerance,ue);rt<0&&(this.log("Waiting fragment cc ("+ue.cc+") @ "+ue.start+" cancelled because another fragment at "+He.end+" is needed"),this.clearWaitingFragment())}}else this.state=ht.IDLE}}this.onTickEnd()},l.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=ht.IDLE)},l.resetLoadingState=function(){this.clearWaitingFragment(),d.prototype.resetLoadingState.call(this)},l.onTickEnd=function(){var s=this.media;s!=null&&s.readyState&&(this.lastCurrentTime=s.currentTime)},l.doTickIdle=function(){var s=this.hls,a=this.levels,c=this.media,h=this.trackId,g=s.config;if(!(!c&&(this.startFragRequested||!g.startFragPrefetch)||!(a!=null&&a[h]))){var m=a[h],S=m.details;if(!S||S.live&&this.levelLastLoaded!==m||this.waitForCdnTuneIn(S)){this.state=ht.WAITING_TRACK;return}var x=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&x&&(this.bufferFlushed=!1,this.afterBufferFlushed(x,ti.AUDIO,Nt.AUDIO));var U=this.getFwdBufferInfo(x,Nt.AUDIO);if(U!==null){var ne=this.bufferedTrack,ue=this.switchingTrack;if(!ue&&this._streamEnded(U,S)){s.trigger(_e.BUFFER_EOS,{type:"audio"}),this.state=ht.ENDED;return}var ge=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Nt.MAIN),ye=U.len,Se=this.getMaxBufferLength(ge?.len),xe=S.fragments,De=xe[0].start,Fe=this.flushing?this.getLoadPosition():U.end;if(ue&&c){var He=this.getLoadPosition();ne&&!Ua(ue.attrs,ne.attrs)&&(Fe=He),S.PTSKnown&&He<De&&(U.end>De||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),c.currentTime=De+.05)}if(!(ye>=Se&&!ue&&Fe<xe[xe.length-1].start)){var rt=this.getNextFragment(Fe,S),ze=!1;if(rt&&this.isLoopLoading(rt,Fe)&&(ze=!!rt.gap,rt=this.getNextFragmentLoopLoading(rt,S,U,Nt.MAIN,Se)),!rt){this.bufferFlushed=!0;return}var Ve=ge&&rt.start>ge.end+S.targetduration;if(Ve||!(ge!=null&&ge.len)&&U.len){var Ze=this.getAppendedFrag(rt.start,Nt.MAIN);if(Ze===null||(ze||(ze=!!Ze.gap||!!Ve&&ge.len===0),Ve&&!ze||ze&&U.nextStart&&U.nextStart<Ze.end))return}this.loadFragment(rt,m,Fe)}}}},l.getMaxBufferLength=function(s){var a=d.prototype.getMaxBufferLength.call(this);return s?Math.min(Math.max(a,s),this.config.maxMaxBufferLength):a},l.onMediaDetaching=function(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,d.prototype.onMediaDetaching.call(this)},l.onAudioTracksUpdated=function(s,a){var c=a.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(h){return new j(h)})},l.onAudioTrackSwitching=function(s,a){var c=!!a.url;this.trackId=a.id;var h=this.fragCurrent;h&&(h.abortRequests(),this.removeUnbufferedFrags(h.start)),this.resetLoadingState(),c?this.setInterval(Wu):this.resetTransmuxer(),c?(this.switchingTrack=a,this.state=ht.IDLE,this.flushAudioIfNeeded(a)):(this.switchingTrack=null,this.bufferedTrack=a,this.state=ht.STOPPED),this.tick()},l.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},l.onLevelLoaded=function(s,a){this.mainDetails=a.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(_e.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},l.onAudioTrackLoaded=function(s,a){var c;if(this.mainDetails==null){this.cachedTrackLoadedData=a;return}var h=this.levels,g=a.details,m=a.id;if(!h){this.warn("Audio tracks were reset while loading level "+m);return}this.log("Audio track "+m+" loaded ["+g.startSN+","+g.endSN+"]"+(g.lastPartSn?"[part-"+g.lastPartSn+"-"+g.lastPartIndex+"]":"")+",duration:"+g.totalduration);var S=h[m],x=0;if(g.live||(c=S.details)!=null&&c.live){this.checkLiveUpdate(g);var U=this.mainDetails;if(g.deltaUpdateFailed||!U)return;if(!S.details&&g.hasProgramDateTime&&U.hasProgramDateTime)ln(g,U),x=g.fragments[0].start;else{var ne;x=this.alignPlaylists(g,S.details,(ne=this.levelLastLoaded)==null?void 0:ne.details)}}S.details=g,this.levelLastLoaded=S,!this.startFragRequested&&(this.mainDetails||!g.live)&&this.setStartPosition(this.mainDetails||g,x),this.state===ht.WAITING_TRACK&&!this.waitForCdnTuneIn(g)&&(this.state=ht.IDLE),this.tick()},l._handleFragmentLoadProgress=function(s){var a,c=s.frag,h=s.part,g=s.payload,m=this.config,S=this.trackId,x=this.levels;if(!x){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var U=x[S];if(!U){this.warn("Audio track is undefined on fragment load progress");return}var ne=U.details;if(!ne){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(c.start);return}var ue=m.defaultAudioCodec||U.audioCodec||"mp4a.40.2",ge=this.transmuxer;ge||(ge=this.transmuxer=new qu(this.hls,Nt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var ye=this.initPTS[c.cc],Se=(a=c.initSegment)==null?void 0:a.data;if(ye!==void 0){var xe=!1,De=h?h.index:-1,Fe=De!==-1,He=new bi(c.level,c.sn,c.stats.chunkCount,g.byteLength,De,Fe);ge.push(g,Se,ue,"",c,h,ne.totalduration,xe,He,ye)}else{this.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+ne.startSN+" ,"+ne.endSN+"],track "+S);var rt=this.waitingData=this.waitingData||{frag:c,part:h,cache:new Nr,complete:!1},ze=rt.cache;ze.push(new Uint8Array(g)),this.waitingVideoCC=this.videoTrackCC,this.state=ht.WAITING_INIT_PTS}},l._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}d.prototype._handleFragmentLoadComplete.call(this,s)},l.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},l.onBufferCreated=function(s,a){var c=a.tracks.audio;c&&(this.mediaBuffer=c.buffer||null),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer||null)},l.onFragBuffered=function(s,a){var c=a.frag,h=a.part;if(c.type!==Nt.AUDIO){if(!this.loadedmetadata&&c.type===Nt.MAIN){var g=this.videoBuffer||this.media;if(g){var m=Vt.getBuffered(g);m.length&&(this.loadedmetadata=!0)}}return}if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(h?" p: "+h.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));return}if(c.sn!=="initSegment"){this.fragPrevious=c;var S=this.switchingTrack;S&&(this.bufferedTrack=S,this.switchingTrack=null,this.hls.trigger(_e.AUDIO_TRACK_SWITCHED,Ii({},S)))}this.fragBufferedComplete(c,h)},l.onError=function(s,a){var c;if(a.fatal){this.state=ht.ERROR;return}switch(a.details){case je.FRAG_GAP:case je.FRAG_PARSING_ERROR:case je.FRAG_DECRYPT_ERROR:case je.FRAG_LOAD_ERROR:case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_ERROR:case je.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Nt.AUDIO,a);break;case je.AUDIO_TRACK_LOAD_ERROR:case je.AUDIO_TRACK_LOAD_TIMEOUT:case je.LEVEL_PARSING_ERROR:!a.levelRetry&&this.state===ht.WAITING_TRACK&&((c=a.context)==null?void 0:c.type)===Jt.AUDIO_TRACK&&(this.state=ht.IDLE);break;case je.BUFFER_APPEND_ERROR:case je.BUFFER_FULL_ERROR:if(!a.parent||a.parent!=="audio")return;if(a.details===je.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(a)&&(this.bufferedTrack=null,d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case je.INTERNAL_EXCEPTION:this.recoverWorkerError(a);break}},l.onBufferFlushing=function(s,a){var c=a.type;c!==ti.VIDEO&&(this.flushing=!0)},l.onBufferFlushed=function(s,a){var c=a.type;if(c!==ti.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ht.ENDED&&(this.state=ht.IDLE);var h=this.mediaBuffer||this.media;h&&(this.afterBufferFlushed(h,c,Nt.AUDIO),this.tick())}},l._handleTransmuxComplete=function(s){var a,c="audio",h=this.hls,g=s.remuxResult,m=s.chunkMeta,S=this.getCurrentContext(m);if(!S){this.resetWhenMissingContext(m);return}var x=S.frag,U=S.part,ne=S.level,ue=ne.details,ge=g.audio,ye=g.text,Se=g.id3,xe=g.initSegment;if(this.fragContextChanged(x)||!ue){this.fragmentTracker.removeFragment(x);return}if(this.state=ht.PARSING,this.switchingTrack&&ge&&this.completeAudioSwitch(this.switchingTrack),xe!=null&&xe.tracks){var De=x.initSegment||x;this._bufferInitSegment(ne,xe.tracks,De,m),h.trigger(_e.FRAG_PARSING_INIT_SEGMENT,{frag:De,id:c,tracks:xe.tracks})}if(ge){var Fe=ge.startPTS,He=ge.endPTS,rt=ge.startDTS,ze=ge.endDTS;U&&(U.elementaryStreams[ti.AUDIO]={startPTS:Fe,endPTS:He,startDTS:rt,endDTS:ze}),x.setElementaryStreamInfo(ti.AUDIO,Fe,He,rt,ze),this.bufferFragmentData(ge,x,U,m)}if(Se!=null&&(a=Se.samples)!=null&&a.length){var Ve=Di({id:c,frag:x,details:ue},Se);h.trigger(_e.FRAG_PARSING_METADATA,Ve)}if(ye){var Ze=Di({id:c,frag:x,details:ue},ye);h.trigger(_e.FRAG_PARSING_USERDATA,Ze)}},l._bufferInitSegment=function(s,a,c,h){if(this.state===ht.PARSING){a.video&&delete a.video;var g=a.audio;if(g){g.id="audio";var m=s.audioCodec;this.log("Init audio buffer, container:"+g.container+", codecs[level/parsed]=["+m+"/"+g.codec+"]"),m&&m.split(",").length===1&&(g.levelCodec=m),this.hls.trigger(_e.BUFFER_CODECS,a);var S=g.initSegment;if(S!=null&&S.byteLength){var x={type:"audio",frag:c,part:null,chunkMeta:h,parent:c.type,data:S};this.hls.trigger(_e.BUFFER_APPENDING,x)}this.tickImmediate()}}},l.loadFragment=function(s,a,c){var h=this.fragmentTracker.getState(s);if(this.fragCurrent=s,this.switchingTrack||h===mt.NOT_LOADED||h===mt.PARTIAL){var g;if(s.sn==="initSegment")this._loadInitSegment(s,a);else if((g=a.details)!=null&&g.live&&!this.initPTS[s.cc]){this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=ht.WAITING_INIT_PTS;var m=this.mainDetails;m&&m.fragments[0].start!==a.details.fragments[0].start&&ln(a.details,m)}else this.startFragRequested=!0,d.prototype.loadFragment.call(this,s,a,c)}else this.clearTrackerIfNeeded(s)},l.flushAudioIfNeeded=function(s){var a=this.media,c=this.bufferedTrack,h=c?.attrs,g=s.attrs;a&&h&&(h.CHANNELS!==g.CHANNELS||c.name!==s.name||c.lang!==s.lang)&&(this.log("Switching audio track : flushing all audio"),d.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)},l.completeAudioSwitch=function(s){var a=this.hls;this.flushAudioIfNeeded(s),this.bufferedTrack=s,this.switchingTrack=null,a.trigger(_e.AUDIO_TRACK_SWITCHED,Ii({},s))},u}(zi),zu=function(d){Bt(u,d);function u(n){var s;return s=d.call(this,n,"[audio-track-controller]")||this,s.tracks=[],s.groupIds=null,s.tracksInGroup=[],s.trackId=-1,s.currentTrack=null,s.selectDefaultTrack=!0,s.registerListeners(),s}var l=u.prototype;return l.registerListeners=function(){var s=this.hls;s.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.on(_e.MANIFEST_PARSED,this.onManifestParsed,this),s.on(_e.LEVEL_LOADING,this.onLevelLoading,this),s.on(_e.LEVEL_SWITCHING,this.onLevelSwitching,this),s.on(_e.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(_e.ERROR,this.onError,this)},l.unregisterListeners=function(){var s=this.hls;s.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.off(_e.MANIFEST_PARSED,this.onManifestParsed,this),s.off(_e.LEVEL_LOADING,this.onLevelLoading,this),s.off(_e.LEVEL_SWITCHING,this.onLevelSwitching,this),s.off(_e.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(_e.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,d.prototype.destroy.call(this)},l.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},l.onManifestParsed=function(s,a){this.tracks=a.audioTracks||[]},l.onAudioTrackLoaded=function(s,a){var c=a.id,h=a.groupId,g=a.details,m=this.tracksInGroup[c];if(!m||m.groupId!==h){this.warn("Audio track with id:"+c+" and group:"+h+" not found in active group "+m?.groupId);return}var S=m.details;m.details=a.details,this.log("Audio track "+c+' "'+m.name+'" lang:'+m.lang+" group:"+h+" loaded ["+g.startSN+"-"+g.endSN+"]"),c===this.trackId&&this.playlistLoaded(c,a,S)},l.onLevelLoading=function(s,a){this.switchLevel(a.level)},l.onLevelSwitching=function(s,a){this.switchLevel(a.level)},l.switchLevel=function(s){var a=this.hls.levels[s];if(a){var c=a.audioGroups||null,h=this.groupIds,g=this.currentTrack;if(!c||h?.length!==c?.length||c!=null&&c.some(function(xe){return h?.indexOf(xe)===-1})){this.groupIds=c,this.trackId=-1,this.currentTrack=null;var m=this.tracks.filter(function(xe){return!c||c.indexOf(xe.groupId)!==-1});if(m.length)this.selectDefaultTrack&&!m.some(function(xe){return xe.default})&&(this.selectDefaultTrack=!1),m.forEach(function(xe,De){xe.id=De});else if(!g&&!this.tracksInGroup.length)return;this.tracksInGroup=m;var S=this.hls.config.audioPreference;if(!g&&S){var x=ft(S,m,ve);if(x>-1)g=m[x];else{var U=ft(S,this.tracks);g=this.tracks[U]}}var ne=this.findTrackId(g);ne===-1&&g&&(ne=this.findTrackId(null));var ue={audioTracks:m};this.log("Updating audio tracks, "+m.length+" track(s) found in group(s): "+c?.join(",")),this.hls.trigger(_e.AUDIO_TRACKS_UPDATED,ue);var ge=this.trackId;if(ne!==-1&&ge===-1)this.setAudioTrack(ne);else if(m.length&&ge===-1){var ye,Se=new Error("No audio track selected for current audio group-ID(s): "+((ye=this.groupIds)==null?void 0:ye.join(","))+" track count: "+m.length);this.warn(Se.message),this.hls.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:Se})}}else this.shouldReloadPlaylist(g)&&this.setAudioTrack(this.trackId)}},l.onError=function(s,a){a.fatal||!a.context||a.context.type===Jt.AUDIO_TRACK&&a.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(a.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(a))},l.setAudioOption=function(s){var a=this.hls;if(a.config.audioPreference=s,s){var c=this.allAudioTracks;if(this.selectDefaultTrack=!1,c.length){var h=this.currentTrack;if(h&&St(s,h,ve))return h;var g=ft(s,this.tracksInGroup,ve);if(g>-1){var m=this.tracksInGroup[g];return this.setAudioTrack(g),m}else if(h){var S=a.loadLevel;S===-1&&(S=a.firstAutoLevel);var x=Oe(s,a.levels,c,S,ve);if(x===-1)return null;a.nextLoadLevel=x}if(s.channels||s.audioCodec){var U=ft(s,c);if(U>-1)return c[U]}}}return null},l.setAudioTrack=function(s){var a=this.tracksInGroup;if(s<0||s>=a.length){this.warn("Invalid audio track id: "+s);return}this.clearTimer(),this.selectDefaultTrack=!1;var c=this.currentTrack,h=a[s],g=h.details&&!h.details.live;if(!(s===this.trackId&&h===c&&g)&&(this.log("Switching to audio-track "+s+' "'+h.name+'" lang:'+h.lang+" group:"+h.groupId+" channels:"+h.channels),this.trackId=s,this.currentTrack=h,this.hls.trigger(_e.AUDIO_TRACK_SWITCHING,Ii({},h)),!g)){var m=this.switchParams(h.url,c?.details,h.details);this.loadPlaylist(m)}},l.findTrackId=function(s){for(var a=this.tracksInGroup,c=0;c<a.length;c++){var h=a[c];if(!(this.selectDefaultTrack&&!h.default)&&(!s||St(s,h,ve)))return c}if(s){for(var g=s.name,m=s.lang,S=s.assocLang,x=s.characteristics,U=s.audioCodec,ne=s.channels,ue=0;ue<a.length;ue++){var ge=a[ue];if(St({name:g,lang:m,assocLang:S,characteristics:x,audioCodec:U,channels:ne},ge,ve))return ue}for(var ye=0;ye<a.length;ye++){var Se=a[ye];if(Ua(s.attrs,Se.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return ye}for(var xe=0;xe<a.length;xe++){var De=a[xe];if(Ua(s.attrs,De.attrs,["LANGUAGE"]))return xe}}return-1},l.loadPlaylist=function(s){var a=this.currentTrack;if(this.shouldLoadPlaylist(a)&&a){d.prototype.loadPlaylist.call(this);var c=a.id,h=a.groupId,g=a.url;if(s)try{g=s.addDirectives(g)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("loading audio-track playlist "+c+' "'+a.name+'" lang:'+a.lang+" group:"+h),this.clearTimer(),this.hls.trigger(_e.AUDIO_TRACK_LOADING,{url:g,id:c,groupId:h,deliveryDirectives:s||null})}},ki(u,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(s){this.selectDefaultTrack=!1,this.setAudioTrack(s)}}]),u}(Z),ql=500,gd=function(d){Bt(u,d);function u(n,s,a){var c;return c=d.call(this,n,s,a,"[subtitle-stream-controller]",Nt.SUBTITLE)||this,c.currentTrackId=-1,c.tracksBuffered=[],c.mainDetails=null,c._registerListeners(),c}var l=u.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),d.prototype.onHandlerDestroying.call(this),this.mainDetails=null},l._registerListeners=function(){var s=this.hls;s.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.on(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.on(_e.ERROR,this.onError,this),s.on(_e.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.on(_e.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),s.on(_e.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.on(_e.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),s.on(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(_e.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var s=this.hls;s.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.off(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.off(_e.ERROR,this.onError,this),s.off(_e.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.off(_e.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),s.off(_e.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.off(_e.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),s.off(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(_e.FRAG_BUFFERED,this.onFragBuffered,this)},l.startLoad=function(s){this.stopLoad(),this.state=ht.IDLE,this.setInterval(ql),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onMediaDetaching=function(){this.tracksBuffered=[],d.prototype.onMediaDetaching.call(this)},l.onLevelLoaded=function(s,a){this.mainDetails=a.details},l.onSubtitleFragProcessed=function(s,a){var c=a.frag,h=a.success;if(this.fragPrevious=c,this.state=ht.IDLE,!!h){var g=this.tracksBuffered[this.currentTrackId];if(g){for(var m,S=c.start,x=0;x<g.length;x++)if(S>=g[x].start&&S<=g[x].end){m=g[x];break}var U=c.start+c.duration;m?m.end=U:(m={start:S,end:U},g.push(m)),this.fragmentTracker.fragBuffered(c),this.fragBufferedComplete(c,null)}}},l.onBufferFlushing=function(s,a){var c=a.startOffset,h=a.endOffset;if(c===0&&h!==Number.POSITIVE_INFINITY){var g=h-1;if(g<=0)return;a.endOffsetSubtitles=Math.max(0,g),this.tracksBuffered.forEach(function(m){for(var S=0;S<m.length;){if(m[S].end<=g){m.shift();continue}else if(m[S].start<g)m[S].start=g;else break;S++}}),this.fragmentTracker.removeFragmentsInRange(c,g,Nt.SUBTITLE)}},l.onFragBuffered=function(s,a){if(!this.loadedmetadata&&a.frag.type===Nt.MAIN){var c;(c=this.media)!=null&&c.buffered.length&&(this.loadedmetadata=!0)}},l.onError=function(s,a){var c=a.frag;c?.type===Nt.SUBTITLE&&(a.details===je.FRAG_GAP&&this.fragmentTracker.fragBuffered(c,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ht.STOPPED&&(this.state=ht.IDLE))},l.onSubtitleTracksUpdated=function(s,a){var c=this,h=a.subtitleTracks;if(this.levels&&$u(this.levels,h)){this.levels=h.map(function(g){return new j(g)});return}this.tracksBuffered=[],this.levels=h.map(function(g){var m=new j(g);return c.tracksBuffered[m.id]=[],m}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Nt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(s,a){var c;if(this.currentTrackId=a.id,!((c=this.levels)!=null&&c.length)||this.currentTrackId===-1){this.clearInterval();return}var h=this.levels[this.currentTrackId];h!=null&&h.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,h&&this.setInterval(ql)},l.onSubtitleTrackLoaded=function(s,a){var c,h=this.currentTrackId,g=this.levels,m=a.details,S=a.id;if(!g){this.warn("Subtitle tracks were reset while loading level "+S);return}var x=g[S];if(!(S>=g.length||!x)){this.log("Subtitle track "+S+" loaded ["+m.startSN+","+m.endSN+"]"+(m.lastPartSn?"[part-"+m.lastPartSn+"-"+m.lastPartIndex+"]":"")+",duration:"+m.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var U=0;if(m.live||(c=x.details)!=null&&c.live){var ne=this.mainDetails;if(m.deltaUpdateFailed||!ne)return;var ue=ne.fragments[0];if(!x.details)m.hasProgramDateTime&&ne.hasProgramDateTime?(ln(m,ne),U=m.fragments[0].start):ue&&(U=ue.start,le(m,U));else{var ge;U=this.alignPlaylists(m,x.details,(ge=this.levelLastLoaded)==null?void 0:ge.details),U===0&&ue&&(U=ue.start,le(m,U))}}if(x.details=m,this.levelLastLoaded=x,S===h&&(!this.startFragRequested&&(this.mainDetails||!m.live)&&this.setStartPosition(this.mainDetails||m,U),this.tick(),m.live&&!this.fragCurrent&&this.media&&this.state===ht.IDLE)){var ye=v(null,m.fragments,this.media.currentTime,0);ye||(this.warn("Subtitle playlist not aligned with playback"),x.details=void 0)}}},l._handleFragmentLoadComplete=function(s){var a=this,c=s.frag,h=s.payload,g=c.decryptdata,m=this.hls;if(!this.fragContextChanged(c)&&h&&h.byteLength>0&&g!=null&&g.key&&g.iv&&g.method==="AES-128"){var S=performance.now();this.decrypter.decrypt(new Uint8Array(h),g.key.buffer,g.iv.buffer).catch(function(x){throw m.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.FRAG_DECRYPT_ERROR,fatal:!1,error:x,reason:x.message,frag:c}),x}).then(function(x){var U=performance.now();m.trigger(_e.FRAG_DECRYPTED,{frag:c,payload:x,stats:{tstart:S,tdecrypt:U}})}).catch(function(x){a.warn(x.name+": "+x.message),a.state=ht.IDLE})}},l.doTick=function(){if(!this.media){this.state=ht.IDLE;return}if(this.state===ht.IDLE){var s=this.currentTrackId,a=this.levels,c=a?.[s];if(!c||!a.length||!c.details)return;var h=this.config,g=this.getLoadPosition(),m=Vt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],g,h.maxBufferHole),S=m.end,x=m.len,U=this.getFwdBufferInfo(this.media,Nt.MAIN),ne=c.details,ue=this.getMaxBufferLength(U?.len)+ne.levelTargetDuration;if(x>ue)return;var ge=ne.fragments,ye=ge.length,Se=ne.edge,xe=null,De=this.fragPrevious;if(S<Se){var Fe=h.maxFragLookUpTolerance,He=S>Se-Fe?0:Fe;xe=v(De,ge,Math.max(ge[0].start,S),He),!xe&&De&&De.start<ge[0].start&&(xe=ge[0])}else xe=ge[ye-1];if(!xe)return;if(xe=this.mapToInitFragWhenRequired(xe),xe.sn!=="initSegment"){var rt=xe.sn-ne.startSN,ze=ge[rt-1];ze&&ze.cc===xe.cc&&this.fragmentTracker.getState(ze)===mt.NOT_LOADED&&(xe=ze)}this.fragmentTracker.getState(xe)===mt.NOT_LOADED&&this.loadFragment(xe,c,S)}},l.getMaxBufferLength=function(s){var a=d.prototype.getMaxBufferLength.call(this);return s?Math.max(a,s):a},l.loadFragment=function(s,a,c){this.fragCurrent=s,s.sn==="initSegment"?this._loadInitSegment(s,a):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,s,a,c))},ki(u,[{key:"mediaBufferTimeRanges",get:function(){return new ua(this.tracksBuffered[this.currentTrackId]||[])}}]),u}(zi),ua=function(u){this.buffered=void 0;var l=function(s,a,c){if(a=a>>>0,a>c-1)throw new DOMException("Failed to execute '"+s+"' on 'TimeRanges': The index provided ("+a+") is greater than the maximum bound ("+c+")");return u[a][s]};this.buffered={get length(){return u.length},end:function(s){return l("end",s,u.length)},start:function(s){return l("start",s,u.length)}}},md=function(d){Bt(u,d);function u(n){var s;return s=d.call(this,n,"[subtitle-track-controller]")||this,s.media=null,s.tracks=[],s.groupIds=null,s.tracksInGroup=[],s.trackId=-1,s.currentTrack=null,s.selectDefaultTrack=!0,s.queuedDefaultTrack=-1,s.asyncPollTrackChange=function(){return s.pollTrackChange(0)},s.useTextTrackPolling=!1,s.subtitlePollingInterval=-1,s._subtitleDisplay=!0,s.onTextTracksChanged=function(){if(s.useTextTrackPolling||self.clearInterval(s.subtitlePollingInterval),!(!s.media||!s.hls.config.renderTextTracksNatively)){for(var a=null,c=ns(s.media.textTracks),h=0;h<c.length;h++)if(c[h].mode==="hidden")a=c[h];else if(c[h].mode==="showing"){a=c[h];break}var g=s.findTrackForTextTrack(a);s.subtitleTrack!==g&&s.setSubtitleTrack(g)}},s.registerListeners(),s}var l=u.prototype;return l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,d.prototype.destroy.call(this)},l.registerListeners=function(){var s=this.hls;s.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.on(_e.MANIFEST_PARSED,this.onManifestParsed,this),s.on(_e.LEVEL_LOADING,this.onLevelLoading,this),s.on(_e.LEVEL_SWITCHING,this.onLevelSwitching,this),s.on(_e.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.on(_e.ERROR,this.onError,this)},l.unregisterListeners=function(){var s=this.hls;s.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.off(_e.MANIFEST_PARSED,this.onManifestParsed,this),s.off(_e.LEVEL_LOADING,this.onLevelLoading,this),s.off(_e.LEVEL_SWITCHING,this.onLevelSwitching,this),s.off(_e.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),s.off(_e.ERROR,this.onError,this)},l.onMediaAttached=function(s,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},l.pollTrackChange=function(s){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,s)},l.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var s=ns(this.media.textTracks);s.forEach(function(a){Ds(a)}),this.subtitleTrack=-1,this.media=null}},l.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},l.onManifestParsed=function(s,a){this.tracks=a.subtitleTracks},l.onSubtitleTrackLoaded=function(s,a){var c=a.id,h=a.groupId,g=a.details,m=this.tracksInGroup[c];if(!m||m.groupId!==h){this.warn("Subtitle track with id:"+c+" and group:"+h+" not found in active group "+m?.groupId);return}var S=m.details;m.details=a.details,this.log("Subtitle track "+c+' "'+m.name+'" lang:'+m.lang+" group:"+h+" loaded ["+g.startSN+"-"+g.endSN+"]"),c===this.trackId&&this.playlistLoaded(c,a,S)},l.onLevelLoading=function(s,a){this.switchLevel(a.level)},l.onLevelSwitching=function(s,a){this.switchLevel(a.level)},l.switchLevel=function(s){var a=this.hls.levels[s];if(a){var c=a.subtitleGroups||null,h=this.groupIds,g=this.currentTrack;if(!c||h?.length!==c?.length||c!=null&&c.some(function(ge){return h?.indexOf(ge)===-1})){this.groupIds=c,this.trackId=-1,this.currentTrack=null;var m=this.tracks.filter(function(ge){return!c||c.indexOf(ge.groupId)!==-1});if(m.length)this.selectDefaultTrack&&!m.some(function(ge){return ge.default})&&(this.selectDefaultTrack=!1),m.forEach(function(ge,ye){ge.id=ye});else if(!g&&!this.tracksInGroup.length)return;this.tracksInGroup=m;var S=this.hls.config.subtitlePreference;if(!g&&S){this.selectDefaultTrack=!1;var x=ft(S,m);if(x>-1)g=m[x];else{var U=ft(S,this.tracks);g=this.tracks[U]}}var ne=this.findTrackId(g);ne===-1&&g&&(ne=this.findTrackId(null));var ue={subtitleTracks:m};this.log("Updating subtitle tracks, "+m.length+' track(s) found in "'+c?.join(",")+'" group-id'),this.hls.trigger(_e.SUBTITLE_TRACKS_UPDATED,ue),ne!==-1&&this.trackId===-1&&this.setSubtitleTrack(ne)}else this.shouldReloadPlaylist(g)&&this.setSubtitleTrack(this.trackId)}},l.findTrackId=function(s){for(var a=this.tracksInGroup,c=this.selectDefaultTrack,h=0;h<a.length;h++){var g=a[h];if(!(c&&!g.default||!c&&!s)&&(!s||St(g,s)))return h}if(s){for(var m=0;m<a.length;m++){var S=a[m];if(Ua(s.attrs,S.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return m}for(var x=0;x<a.length;x++){var U=a[x];if(Ua(s.attrs,U.attrs,["LANGUAGE"]))return x}}return-1},l.findTrackForTextTrack=function(s){if(s)for(var a=this.tracksInGroup,c=0;c<a.length;c++){var h=a[c];if(Kl(h,s))return c}return-1},l.onError=function(s,a){a.fatal||!a.context||a.context.type===Jt.SUBTITLE_TRACK&&a.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(a.context.groupId)!==-1)&&this.checkRetry(a)},l.setSubtitleOption=function(s){if(this.hls.config.subtitlePreference=s,s){var a=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,a.length){var c=this.currentTrack;if(c&&St(s,c))return c;var h=ft(s,this.tracksInGroup);if(h>-1){var g=this.tracksInGroup[h];return this.setSubtitleTrack(h),g}else{if(c)return null;var m=ft(s,a);if(m>-1)return a[m]}}}return null},l.loadPlaylist=function(s){d.prototype.loadPlaylist.call(this);var a=this.currentTrack;if(this.shouldLoadPlaylist(a)&&a){var c=a.id,h=a.groupId,g=a.url;if(s)try{g=s.addDirectives(g)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}this.log("Loading subtitle playlist for id "+c),this.hls.trigger(_e.SUBTITLE_TRACK_LOADING,{url:g,id:c,groupId:h,deliveryDirectives:s||null})}},l.toggleTrackModes=function(){var s=this.media;if(s){var a=ns(s.textTracks),c=this.currentTrack,h;if(c&&(h=a.filter(function(m){return Kl(c,m)})[0],h||this.warn('Unable to find subtitle TextTrack with name "'+c.name+'" and language "'+c.lang+'"')),[].slice.call(a).forEach(function(m){m.mode!=="disabled"&&m!==h&&(m.mode="disabled")}),h){var g=this.subtitleDisplay?"showing":"hidden";h.mode!==g&&(h.mode=g)}}},l.setSubtitleTrack=function(s){var a=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=s;return}if(s<-1||s>=a.length||!Ct(s)){this.warn("Invalid subtitle track id: "+s);return}this.clearTimer(),this.selectDefaultTrack=!1;var c=this.currentTrack,h=a[s]||null;if(this.trackId=s,this.currentTrack=h,this.toggleTrackModes(),!h){this.hls.trigger(_e.SUBTITLE_TRACK_SWITCH,{id:s});return}var g=!!h.details&&!h.details.live;if(!(s===this.trackId&&h===c&&g)){this.log("Switching to subtitle-track "+s+(h?' "'+h.name+'" lang:'+h.lang+" group:"+h.groupId:""));var m=h.id,S=h.groupId,x=S===void 0?"":S,U=h.name,ne=h.type,ue=h.url;this.hls.trigger(_e.SUBTITLE_TRACK_SWITCH,{id:m,groupId:x,name:U,type:ne,url:ue});var ge=this.switchParams(h.url,c?.details,h.details);this.loadPlaylist(ge)}},ki(u,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(s){this._subtitleDisplay=s,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(s){this.selectDefaultTrack=!1,this.setSubtitleTrack(s)}}]),u}(Z),zh=function(){function d(l){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=l}var u=d.prototype;return u.append=function(n,s,a){var c=this.queues[s];c.push(n),c.length===1&&!a&&this.executeNext(s)},u.insertAbort=function(n,s){var a=this.queues[s];a.unshift(n),this.executeNext(s)},u.appendBlocker=function(n){var s,a=new Promise(function(h){s=h}),c={execute:s,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(c,n),a},u.executeNext=function(n){var s=this.queues[n];if(s.length){var a=s[0];try{a.execute()}catch(h){Qe.warn('[buffer-operation-queue]: Exception executing "'+n+'" SourceBuffer operation: '+h),a.onError(h);var c=this.buffers[n];c!=null&&c.updating||this.shiftAndExecuteNext(n)}}},u.shiftAndExecuteNext=function(n){this.queues[n].shift(),this.executeNext(n)},u.current=function(n){return this.queues[n][0]},d}(),vd=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Yh=function(){function d(l){var n=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=function(a){n.hls&&n.hls.pauseBuffering()},this._onStartStreaming=function(a){n.hls&&n.hls.resumeBuffering()},this._onMediaSourceOpen=function(){var a=n.media,c=n.mediaSource;n.log("Media source opened"),a&&(a.removeEventListener("emptied",n._onMediaEmptied),n.updateMediaElementDuration(),n.hls.trigger(_e.MEDIA_ATTACHED,{media:a,mediaSource:c})),c&&c.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},this._onMediaSourceClose=function(){n.log("Media source closed")},this._onMediaSourceEnded=function(){n.log("Media source ended")},this._onMediaEmptied=function(){var a=n.mediaSrc,c=n._objectUrl;a!==c&&Qe.error("Media element src was set while attaching MediaSource ("+c+" > "+a+")")},this.hls=l;var s="[buffer-controller]";this.appendSource=lt(Tt(l.config.preferManagedMediaSource)),this.log=Qe.log.bind(Qe,s),this.warn=Qe.warn.bind(Qe,s),this.error=Qe.error.bind(Qe,s),this._initSourceBuffer(),this.registerListeners()}var u=d.prototype;return u.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},u.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null},u.registerListeners=function(){var n=this.hls;n.on(_e.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_e.MANIFEST_PARSED,this.onManifestParsed,this),n.on(_e.BUFFER_RESET,this.onBufferReset,this),n.on(_e.BUFFER_APPENDING,this.onBufferAppending,this),n.on(_e.BUFFER_CODECS,this.onBufferCodecs,this),n.on(_e.BUFFER_EOS,this.onBufferEos,this),n.on(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(_e.LEVEL_UPDATED,this.onLevelUpdated,this),n.on(_e.FRAG_PARSED,this.onFragParsed,this),n.on(_e.FRAG_CHANGED,this.onFragChanged,this)},u.unregisterListeners=function(){var n=this.hls;n.off(_e.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_e.MANIFEST_PARSED,this.onManifestParsed,this),n.off(_e.BUFFER_RESET,this.onBufferReset,this),n.off(_e.BUFFER_APPENDING,this.onBufferAppending,this),n.off(_e.BUFFER_CODECS,this.onBufferCodecs,this),n.off(_e.BUFFER_EOS,this.onBufferEos,this),n.off(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(_e.LEVEL_UPDATED,this.onLevelUpdated,this),n.off(_e.FRAG_PARSED,this.onFragParsed,this),n.off(_e.FRAG_CHANGED,this.onFragChanged,this)},u._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new zh(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null},u.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},u.onManifestParsed=function(n,s){var a=2;(s.audio&&!s.video||!s.altAudio)&&(a=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=a,this.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},u.onMediaAttaching=function(n,s){var a=this.media=s.media,c=Tt(this.appendSource);if(a&&c){var h,g=this.mediaSource=new c;this.log("created media source: "+((h=g.constructor)==null?void 0:h.name)),g.addEventListener("sourceopen",this._onMediaSourceOpen),g.addEventListener("sourceended",this._onMediaSourceEnded),g.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(g.addEventListener("startstreaming",this._onStartStreaming),g.addEventListener("endstreaming",this._onEndStreaming));var m=this._objectUrl=self.URL.createObjectURL(g);if(this.appendSource)try{a.removeAttribute("src");var S=self.ManagedMediaSource;a.disableRemotePlayback=a.disableRemotePlayback||S&&g instanceof S,yd(a),Xh(a,m),a.load()}catch{a.src=m}else a.src=m;a.addEventListener("emptied",this._onMediaEmptied)}},u.onMediaDetaching=function(){var n=this.media,s=this.mediaSource,a=this._objectUrl;if(s){if(this.log("media source detaching"),s.readyState==="open")try{s.endOfStream()}catch(c){this.warn("onMediaDetaching: "+c.message+" while calling endOfStream")}this.onBufferReset(),s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),n&&(n.removeEventListener("emptied",this._onMediaEmptied),a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(n.removeAttribute("src"),this.appendSource&&yd(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(_e.MEDIA_DETACHED,void 0)},u.onBufferReset=function(){var n=this;this.getSourceBufferTypes().forEach(function(s){n.resetBuffer(s)}),this._initSourceBuffer()},u.resetBuffer=function(n){var s=this.sourceBuffer[n];try{if(s){var a;this.removeBufferListeners(n),this.sourceBuffer[n]=void 0,(a=this.mediaSource)!=null&&a.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}}catch(c){this.warn("onBufferReset "+n,c)}},u.onBufferCodecs=function(n,s){var a=this,c=this.getSourceBufferTypes().length,h=Object.keys(s);if(h.forEach(function(m){if(c){var S=a.tracks[m];if(S&&typeof S.buffer.changeType=="function"){var x,U=s[m],ne=U.id,ue=U.codec,ge=U.levelCodec,ye=U.container,Se=U.metadata,xe=wi(S.codec,S.levelCodec),De=xe?.replace(vd,"$1"),Fe=wi(ue,ge),He=(x=Fe)==null?void 0:x.replace(vd,"$1");if(Fe&&De!==He){m.slice(0,5)==="audio"&&(Fe=ia(Fe,a.appendSource));var rt=ye+";codecs="+Fe;a.appendChangeType(m,rt),a.log("switching codec "+xe+" to "+Fe),a.tracks[m]={buffer:S.buffer,codec:ue,container:ye,levelCodec:ge,metadata:Se,id:ne}}}}else a.pendingTracks[m]=s[m]}),!c){var g=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==g&&(this.log(g+" bufferCodec event(s) expected "+h.join(",")),this.bufferCodecEventsExpected=g),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}},u.appendChangeType=function(n,s){var a=this,c=this.operationQueue,h={execute:function(){var m=a.sourceBuffer[n];m&&(a.log("changing "+n+" sourceBuffer type to "+s),m.changeType(s)),c.shiftAndExecuteNext(n)},onStart:function(){},onComplete:function(){},onError:function(m){a.warn("Failed to change "+n+" SourceBuffer type",m)}};c.append(h,n,!!this.pendingTracks[n])},u.onBufferAppending=function(n,s){var a=this,c=this.hls,h=this.operationQueue,g=this.tracks,m=s.data,S=s.type,x=s.frag,U=s.part,ne=s.chunkMeta,ue=ne.buffering[S],ge=self.performance.now();ue.start=ge;var ye=x.stats.buffering,Se=U?U.stats.buffering:null;ye.start===0&&(ye.start=ge),Se&&Se.start===0&&(Se.start=ge);var xe=g.audio,De=!1;S==="audio"&&xe?.container==="audio/mpeg"&&(De=!this.lastMpegAudioChunk||ne.id===1||this.lastMpegAudioChunk.sn!==ne.sn,this.lastMpegAudioChunk=ne);var Fe=x.start,He={execute:function(){if(ue.executeStart=self.performance.now(),De){var ze=a.sourceBuffer[S];if(ze){var Ve=Fe-ze.timestampOffset;Math.abs(Ve)>=.1&&(a.log("Updating audio SourceBuffer timestampOffset to "+Fe+" (delta: "+Ve+") sn: "+x.sn+")"),ze.timestampOffset=Fe)}}a.appendExecutor(m,S)},onStart:function(){},onComplete:function(){var ze=self.performance.now();ue.executeEnd=ue.end=ze,ye.first===0&&(ye.first=ze),Se&&Se.first===0&&(Se.first=ze);var Ve=a.sourceBuffer,Ze={};for(var et in Ve)Ze[et]=Vt.getBuffered(Ve[et]);a.appendErrors[S]=0,S==="audio"||S==="video"?a.appendErrors.audiovideo=0:(a.appendErrors.audio=0,a.appendErrors.video=0),a.hls.trigger(_e.BUFFER_APPENDED,{type:S,frag:x,part:U,chunkMeta:ne,parent:x.type,timeRanges:Ze})},onError:function(ze){var Ve={type:Pt.MEDIA_ERROR,parent:x.type,details:je.BUFFER_APPEND_ERROR,sourceBufferName:S,frag:x,part:U,chunkMeta:ne,error:ze,err:ze,fatal:!1};if(ze.code===DOMException.QUOTA_EXCEEDED_ERR)Ve.details=je.BUFFER_FULL_ERROR;else{var Ze=++a.appendErrors[S];Ve.details=je.BUFFER_APPEND_ERROR,a.warn("Failed "+Ze+"/"+c.config.appendErrorMaxRetry+' times to append segment in "'+S+'" sourceBuffer'),Ze>=c.config.appendErrorMaxRetry&&(Ve.fatal=!0)}c.trigger(_e.ERROR,Ve)}};h.append(He,S,!!this.pendingTracks[S])},u.onBufferFlushing=function(n,s){var a=this,c=this.operationQueue,h=function(m){return{execute:a.removeExecutor.bind(a,m,s.startOffset,s.endOffset),onStart:function(){},onComplete:function(){a.hls.trigger(_e.BUFFER_FLUSHED,{type:m})},onError:function(x){a.warn("Failed to remove from "+m+" SourceBuffer",x)}}};s.type?c.append(h(s.type),s.type):this.getSourceBufferTypes().forEach(function(g){c.append(h(g),g)})},u.onFragParsed=function(n,s){var a=this,c=s.frag,h=s.part,g=[],m=h?h.elementaryStreams:c.elementaryStreams;m[ti.AUDIOVIDEO]?g.push("audiovideo"):(m[ti.AUDIO]&&g.push("audio"),m[ti.VIDEO]&&g.push("video"));var S=function(){var U=self.performance.now();c.stats.buffering.end=U,h&&(h.stats.buffering.end=U);var ne=h?h.stats:c.stats;a.hls.trigger(_e.FRAG_BUFFERED,{frag:c,part:h,stats:ne,id:c.type})};g.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+c.type+" level: "+c.level+" sn: "+c.sn),this.blockBuffers(S,g)},u.onFragChanged=function(n,s){this.trimBuffers()},u.onBufferEos=function(n,s){var a=this,c=this.getSourceBufferTypes().reduce(function(h,g){var m=a.sourceBuffer[g];return m&&(!s.type||s.type===g)&&(m.ending=!0,m.ended||(m.ended=!0,a.log(g+" sourceBuffer now EOS"))),h&&!!(!m||m.ended)},!0);c&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){a.getSourceBufferTypes().forEach(function(g){var m=a.sourceBuffer[g];m&&(m.ending=!1)});var h=a.mediaSource;if(!h||h.readyState!=="open"){h&&a.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+h.readyState);return}a.log("Calling mediaSource.endOfStream()"),h.endOfStream()}))},u.onLevelUpdated=function(n,s){var a=s.details;a.fragments.length&&(this.details=a,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},u.trimBuffers=function(){var n=this.hls,s=this.details,a=this.media;if(!(!a||s===null)){var c=this.getSourceBufferTypes();if(c.length){var h=n.config,g=a.currentTime,m=s.levelTargetDuration,S=s.live&&h.liveBackBufferLength!==null?h.liveBackBufferLength:h.backBufferLength;if(Ct(S)&&S>0){var x=Math.max(S,m),U=Math.floor(g/m)*m-x;this.flushBackBuffer(g,m,U)}if(Ct(h.frontBufferFlushThreshold)&&h.frontBufferFlushThreshold>0){var ne=Math.max(h.maxBufferLength,h.frontBufferFlushThreshold),ue=Math.max(ne,m),ge=Math.floor(g/m)*m+ue;this.flushFrontBuffer(g,m,ge)}}}},u.flushBackBuffer=function(n,s,a){var c=this,h=this.details,g=this.sourceBuffer,m=this.getSourceBufferTypes();m.forEach(function(S){var x=g[S];if(x){var U=Vt.getBuffered(x);if(U.length>0&&a>U.start(0)){if(c.hls.trigger(_e.BACK_BUFFER_REACHED,{bufferEnd:a}),h!=null&&h.live)c.hls.trigger(_e.LIVE_BACK_BUFFER_REACHED,{bufferEnd:a});else if(x.ended&&U.end(U.length-1)-n<s*2){c.log("Cannot flush "+S+" back buffer while SourceBuffer is in ended state");return}c.hls.trigger(_e.BUFFER_FLUSHING,{startOffset:0,endOffset:a,type:S})}}})},u.flushFrontBuffer=function(n,s,a){var c=this,h=this.sourceBuffer,g=this.getSourceBufferTypes();g.forEach(function(m){var S=h[m];if(S){var x=Vt.getBuffered(S),U=x.length;if(U<2)return;var ne=x.start(U-1),ue=x.end(U-1);if(a>ne||n>=ne&&n<=ue)return;if(S.ended&&n-ue<2*s){c.log("Cannot flush "+m+" front buffer while SourceBuffer is in ended state");return}c.hls.trigger(_e.BUFFER_FLUSHING,{startOffset:ne,endOffset:1/0,type:m})}})},u.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var n=this.details,s=this.hls,a=this.media,c=this.mediaSource,h=n.fragments[0].start+n.totalduration,g=a.duration,m=Ct(c.duration)?c.duration:0;n.live&&s.config.liveDurationInfinity?(c.duration=1/0,this.updateSeekableRange(n)):(h>m&&h>g||!Ct(g))&&(this.log("Updating Media Source duration to "+h.toFixed(3)),c.duration=h)}},u.updateSeekableRange=function(n){var s=this.mediaSource,a=n.fragments,c=a.length;if(c&&n.live&&s!=null&&s.setLiveSeekableRange){var h=Math.max(0,a[0].start),g=Math.max(h,h+n.totalduration);this.log("Media Source duration is set to "+s.duration+". Setting seekable range to "+h+"-"+g+"."),s.setLiveSeekableRange(h,g)}},u.checkPendingTracks=function(){var n=this.bufferCodecEventsExpected,s=this.operationQueue,a=this.pendingTracks,c=Object.keys(a).length;if(c&&(!n||c===2||"audiovideo"in a)){this.createSourceBuffers(a),this.pendingTracks={};var h=this.getSourceBufferTypes();if(h.length)this.hls.trigger(_e.BUFFER_CREATED,{tracks:this.tracks}),h.forEach(function(m){s.executeNext(m)});else{var g=new Error("could not create source buffer for media codec(s)");this.hls.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:g,reason:g.message})}}},u.createSourceBuffers=function(n){var s=this,a=this.sourceBuffer,c=this.mediaSource;if(!c)throw Error("createSourceBuffers called when mediaSource was null");var h=function(S){if(!a[S]){var x,U=n[S];if(!U)throw Error("source buffer exists for track "+S+", however track does not");var ne=((x=U.levelCodec)==null?void 0:x.indexOf(","))===-1?U.levelCodec:U.codec;ne&&S.slice(0,5)==="audio"&&(ne=ia(ne,s.appendSource));var ue=U.container+";codecs="+ne;s.log("creating sourceBuffer("+ue+")");try{var ge=a[S]=c.addSourceBuffer(ue),ye=S;s.addBufferListener(ye,"updatestart",s._onSBUpdateStart),s.addBufferListener(ye,"updateend",s._onSBUpdateEnd),s.addBufferListener(ye,"error",s._onSBUpdateError),s.appendSource&&s.addBufferListener(ye,"bufferedchange",function(Se,xe){var De=xe.removedRanges;De!=null&&De.length&&s.hls.trigger(_e.BUFFER_FLUSHED,{type:S})}),s.tracks[S]={buffer:ge,codec:ne,container:U.container,levelCodec:U.levelCodec,metadata:U.metadata,id:U.id}}catch(Se){s.error("error while trying to add sourceBuffer: "+Se.message),s.hls.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:Se,sourceBufferName:S,mimeType:ue})}}};for(var g in n)h(g)},u._onSBUpdateStart=function(n){var s=this.operationQueue,a=s.current(n);a.onStart()},u._onSBUpdateEnd=function(n){var s;if(((s=this.mediaSource)==null?void 0:s.readyState)==="closed"){this.resetBuffer(n);return}var a=this.operationQueue,c=a.current(n);c.onComplete(),a.shiftAndExecuteNext(n)},u._onSBUpdateError=function(n,s){var a,c=new Error(n+" SourceBuffer error. MediaSource readyState: "+((a=this.mediaSource)==null?void 0:a.readyState));this.error(""+c,s),this.hls.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.BUFFER_APPENDING_ERROR,sourceBufferName:n,error:c,fatal:!1});var h=this.operationQueue.current(n);h&&h.onError(c)},u.removeExecutor=function(n,s,a){var c=this.media,h=this.mediaSource,g=this.operationQueue,m=this.sourceBuffer,S=m[n];if(!c||!h||!S){this.warn("Attempting to remove from the "+n+" SourceBuffer, but it does not exist"),g.shiftAndExecuteNext(n);return}var x=Ct(c.duration)?c.duration:1/0,U=Ct(h.duration)?h.duration:1/0,ne=Math.max(0,s),ue=Math.min(a,x,U);ue>ne&&(!S.ending||S.ended)?(S.ended=!1,this.log("Removing ["+ne+","+ue+"] from the "+n+" SourceBuffer"),S.remove(ne,ue)):g.shiftAndExecuteNext(n)},u.appendExecutor=function(n,s){var a=this.sourceBuffer[s];if(!a){if(!this.pendingTracks[s])throw new Error("Attempting to append to the "+s+" SourceBuffer, but it does not exist");return}a.ended=!1,a.appendBuffer(n)},u.blockBuffers=function(n,s){var a=this;if(s===void 0&&(s=this.getSourceBufferTypes()),!s.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(n);return}var c=this.operationQueue,h=s.map(function(g){return c.appendBlocker(g)});Promise.all(h).then(function(){n(),s.forEach(function(g){var m=a.sourceBuffer[g];m!=null&&m.updating||c.shiftAndExecuteNext(g)})})},u.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},u.addBufferListener=function(n,s,a){var c=this.sourceBuffer[n];if(c){var h=a.bind(this,n);this.listeners[n].push({event:s,listener:h}),c.addEventListener(s,h)}},u.removeBufferListeners=function(n){var s=this.sourceBuffer[n];s&&this.listeners[n].forEach(function(a){s.removeEventListener(a.event,a.listener)})},ki(d,[{key:"mediaSrc",get:function(){var n,s,a=((n=this.media)==null||(s=n.querySelector)==null?void 0:s.call(n,"source"))||this.media;return a?.src}}]),d}();function yd(d){var u=d.querySelectorAll("source");[].slice.call(u).forEach(function(l){d.removeChild(l)})}function Xh(d,u){var l=self.document.createElement("source");l.type="video/mp4",l.src=u,d.appendChild(l)}var Qh={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Td=function(u){return String.fromCharCode(Qh[u]||u)},Wn=15,Ms=100,Yu={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Jh={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ed={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Zh={25:2,26:4,29:6,30:8,31:10,27:13,28:15},_d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],ef=function(){function d(){this.time=null,this.verboseLevel=0}var u=d.prototype;return u.log=function(n,s){if(this.verboseLevel>=n){var a=typeof s=="function"?s():s;Qe.log(this.time+" ["+n+"] "+a)}},d}(),Ga=function(u){for(var l=[],n=0;n<u.length;n++)l.push(u[n].toString(16));return l},bd=function(){function d(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var u=d.prototype;return u.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},u.setStyles=function(n){for(var s=["foreground","underline","italics","background","flash"],a=0;a<s.length;a++){var c=s[a];n.hasOwnProperty(c)&&(this[c]=n[c])}},u.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},u.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},u.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},u.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},d}(),xt=function(){function d(){this.uchar=" ",this.penState=new bd}var u=d.prototype;return u.reset=function(){this.uchar=" ",this.penState.reset()},u.setChar=function(n,s){this.uchar=n,this.penState.copy(s)},u.setPenState=function(n){this.penState.copy(n)},u.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},u.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},u.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},d}(),Ad=function(){function d(l){this.chars=[],this.pos=0,this.currPenState=new bd,this.cueStartTime=null,this.logger=void 0;for(var n=0;n<Ms;n++)this.chars.push(new xt);this.logger=l}var u=d.prototype;return u.equals=function(n){for(var s=0;s<Ms;s++)if(!this.chars[s].equals(n.chars[s]))return!1;return!0},u.copy=function(n){for(var s=0;s<Ms;s++)this.chars[s].copy(n.chars[s])},u.isEmpty=function(){for(var n=!0,s=0;s<Ms;s++)if(!this.chars[s].isEmpty()){n=!1;break}return n},u.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ms&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ms)},u.moveCursor=function(n){var s=this.pos+n;if(n>1)for(var a=this.pos+1;a<s+1;a++)this.chars[a].setPenState(this.currPenState);this.setCursor(s)},u.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},u.insertChar=function(n){var s=this;n>=144&&this.backSpace();var a=Td(n);if(this.pos>=Ms){this.logger.log(0,function(){return"Cannot insert "+n.toString(16)+" ("+a+") at position "+s.pos+". Skipping it!"});return}this.chars[this.pos].setChar(a,this.currPenState),this.moveCursor(1)},u.clearFromPos=function(n){var s;for(s=n;s<Ms;s++)this.chars[s].reset()},u.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},u.clearToEndOfRow=function(){this.clearFromPos(this.pos)},u.getTextString=function(){for(var n=[],s=!0,a=0;a<Ms;a++){var c=this.chars[a].uchar;c!==" "&&(s=!1),n.push(c)}return s?"":n.join("")},u.setPenStyles=function(n){this.currPenState.setStyles(n);var s=this.chars[this.pos];s.setPenState(this.currPenState)},d}(),$o=function(){function d(l){this.rows=[],this.currRow=Wn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var n=0;n<Wn;n++)this.rows.push(new Ad(l));this.logger=l}var u=d.prototype;return u.reset=function(){for(var n=0;n<Wn;n++)this.rows[n].clear();this.currRow=Wn-1},u.equals=function(n){for(var s=!0,a=0;a<Wn;a++)if(!this.rows[a].equals(n.rows[a])){s=!1;break}return s},u.copy=function(n){for(var s=0;s<Wn;s++)this.rows[s].copy(n.rows[s])},u.isEmpty=function(){for(var n=!0,s=0;s<Wn;s++)if(!this.rows[s].isEmpty()){n=!1;break}return n},u.backSpace=function(){var n=this.rows[this.currRow];n.backSpace()},u.clearToEndOfRow=function(){var n=this.rows[this.currRow];n.clearToEndOfRow()},u.insertChar=function(n){var s=this.rows[this.currRow];s.insertChar(n)},u.setPen=function(n){var s=this.rows[this.currRow];s.setPenStyles(n)},u.moveCursor=function(n){var s=this.rows[this.currRow];s.moveCursor(n)},u.setCursor=function(n){this.logger.log(2,"setCursor: "+n);var s=this.rows[this.currRow];s.setCursor(n)},u.setPAC=function(n){this.logger.log(2,function(){return"pacData = "+JSON.stringify(n)});var s=n.row-1;if(this.nrRollUpRows&&s<this.nrRollUpRows-1&&(s=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==s){for(var a=0;a<Wn;a++)this.rows[a].clear();var c=this.currRow+1-this.nrRollUpRows,h=this.lastOutputScreen;if(h){var g=h.rows[c].cueStartTime,m=this.logger.time;if(g!==null&&m!==null&&g<m)for(var S=0;S<this.nrRollUpRows;S++)this.rows[s-this.nrRollUpRows+S+1].copy(h.rows[c+S])}}this.currRow=s;var x=this.rows[this.currRow];if(n.indent!==null){var U=n.indent,ne=Math.max(U-1,0);x.setCursor(n.indent),n.color=x.chars[ne].penState.foreground}var ue={foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1};this.setPen(ue)},u.setBkgData=function(n){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(n)}),this.backSpace(),this.setPen(n),this.insertChar(32)},u.setRollUpRows=function(n){this.nrRollUpRows=n},u.rollUp=function(){var n=this;if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,function(){return n.getDisplayText()});var s=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(s,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(2,"Rolling up")},u.getDisplayText=function(n){n=n||!1;for(var s=[],a="",c=-1,h=0;h<Wn;h++){var g=this.rows[h].getTextString();g&&(c=h+1,n?s.push("Row "+c+": '"+g+"'"):s.push(g.trim()))}return s.length>0&&(n?a="["+s.join(" | ")+"]":a=s.join(`
`)),a},u.getTextAndFormat=function(){return this.rows},d}(),$l=function(){function d(l,n,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=l,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new $o(s),this.nonDisplayedMemory=new $o(s),this.lastOutputScreen=new $o(s),this.currRollUpRow=this.displayedMemory.rows[Wn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}var u=d.prototype;return u.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Wn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},u.getHandler=function(){return this.outputFilter},u.setHandler=function(n){this.outputFilter=n},u.setPAC=function(n){this.writeScreen.setPAC(n)},u.setBkgData=function(n){this.writeScreen.setBkgData(n)},u.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(2,function(){return"MODE="+n}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},u.insertChars=function(n){for(var s=this,a=0;a<n.length;a++)this.writeScreen.insertChar(n[a]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return c+": "+s.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,function(){return"DISPLAYED: "+s.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},u.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},u.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},u.ccAOF=function(){},u.ccAON=function(){},u.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},u.ccRU=function(n){this.logger.log(2,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},u.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},u.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},u.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},u.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},u.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},u.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},u.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},u.ccEOC=function(){var n=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var s=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=s,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+n.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},u.ccTO=function(n){this.logger.log(2,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},u.ccMIDROW=function(n){var s={flash:!1};if(s.underline=n%2===1,s.italics=n>=46,s.italics)s.foreground="white";else{var a=Math.floor(n/2)-16,c=["white","green","blue","cyan","red","yellow","magenta"];s.foreground=c[a]}this.logger.log(2,"MIDROW: "+JSON.stringify(s)),this.writeScreen.setPen(s)},u.outputDataUpdate=function(n){n===void 0&&(n=!1);var s=this.logger.time;s!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=s:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,s,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:s),this.lastOutputScreen.copy(this.displayedMemory))},u.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},d}(),Wo=function(){function d(l,n,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=zo(),this.logger=void 0;var a=this.logger=new ef;this.channels=[null,new $l(l,n,a),new $l(l+1,s,a)]}var u=d.prototype;return u.getHandler=function(n){return this.channels[n].getHandler()},u.setHandler=function(n,s){this.channels[n].setHandler(s)},u.addData=function(n,s){var a=this;this.logger.time=n;for(var c=function(S){var x=s[S]&127,U=s[S+1]&127,ne=!1,ue=null;if(x===0&&U===0)return 0;a.logger.log(3,function(){return"["+Ga([s[S],s[S+1]])+"] -> ("+Ga([x,U])+")"});var ge=a.cmdHistory,ye=x>=16&&x<=31;if(ye){if(Pi(x,U,ge))return Wl(null,null,ge),a.logger.log(3,function(){return"Repeated command ("+Ga([x,U])+") is dropped"}),0;Wl(x,U,a.cmdHistory),ne=a.parseCmd(x,U),ne||(ne=a.parseMidrow(x,U)),ne||(ne=a.parsePAC(x,U)),ne||(ne=a.parseBackgroundAttributes(x,U))}else Wl(null,null,ge);if(!ne&&(ue=a.parseChars(x,U),ue)){var Se=a.currentChannel;if(Se&&Se>0){var xe=a.channels[Se];xe.insertChars(ue)}else a.logger.log(2,"No channel found yet. TEXT-MODE?")}!ne&&!ue&&a.logger.log(2,function(){return"Couldn't parse cleaned data "+Ga([x,U])+" orig: "+Ga([s[S],s[S+1]])})},h,g=0;g<s.length;g+=2)h=c(g)},u.parseCmd=function(n,s){var a=(n===20||n===28||n===21||n===29)&&s>=32&&s<=47,c=(n===23||n===31)&&s>=33&&s<=35;if(!(a||c))return!1;var h=n===20||n===21||n===23?1:2,g=this.channels[h];return n===20||n===21||n===28||n===29?s===32?g.ccRCL():s===33?g.ccBS():s===34?g.ccAOF():s===35?g.ccAON():s===36?g.ccDER():s===37?g.ccRU(2):s===38?g.ccRU(3):s===39?g.ccRU(4):s===40?g.ccFON():s===41?g.ccRDC():s===42?g.ccTR():s===43?g.ccRTD():s===44?g.ccEDM():s===45?g.ccCR():s===46?g.ccENM():s===47&&g.ccEOC():g.ccTO(s-32),this.currentChannel=h,!0},u.parseMidrow=function(n,s){var a=0;if((n===17||n===25)&&s>=32&&s<=47){if(n===17?a=1:a=2,a!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var c=this.channels[a];return c?(c.ccMIDROW(s),this.logger.log(3,function(){return"MIDROW ("+Ga([n,s])+")"}),!0):!1}return!1},u.parsePAC=function(n,s){var a,c=(n>=17&&n<=23||n>=25&&n<=31)&&s>=64&&s<=127,h=(n===16||n===24)&&s>=64&&s<=95;if(!(c||h))return!1;var g=n<=23?1:2;s>=64&&s<=95?a=g===1?Yu[n]:Ed[n]:a=g===1?Jh[n]:Zh[n];var m=this.channels[g];return m?(m.setPAC(this.interpretPAC(a,s)),this.currentChannel=g,!0):!1},u.interpretPAC=function(n,s){var a,c={color:null,italics:!1,indent:null,underline:!1,row:n};return s>95?a=s-96:a=s-64,c.underline=(a&1)===1,a<=13?c.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(a/2)]:a<=15?(c.italics=!0,c.color="white"):c.indent=Math.floor((a-16)/2)*4,c},u.parseChars=function(n,s){var a,c=null,h=null;if(n>=25?(a=2,h=n-8):(a=1,h=n),h>=17&&h<=19){var g;h===17?g=s+80:h===18?g=s+112:g=s+144,this.logger.log(2,function(){return"Special char '"+Td(g)+"' in channel "+a}),c=[g]}else n>=32&&n<=127&&(c=s===0?[n]:[n,s]);return c&&this.logger.log(3,function(){return"Char codes =  "+Ga(c).join(",")}),c},u.parseBackgroundAttributes=function(n,s){var a=(n===16||n===24)&&s>=32&&s<=47,c=(n===23||n===31)&&s>=45&&s<=47;if(!(a||c))return!1;var h,g={};n===16||n===24?(h=Math.floor((s-32)/2),g.background=_d[h],s%2===1&&(g.background=g.background+"_semi")):s===45?g.background="transparent":(g.foreground="black",s===47&&(g.underline=!0));var m=n<=23?1:2,S=this.channels[m];return S.setBkgData(g),!0},u.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var s=this.channels[n];s&&s.reset()}Wl(null,null,this.cmdHistory)},u.cueSplitAtTime=function(n){for(var s=0;s<this.channels.length;s++){var a=this.channels[s];a&&a.cueSplitAtTime(n)}},d}();function Wl(d,u,l){l.a=d,l.b=u}function Pi(d,u,l){return l.a===d&&l.b===u}function zo(){return{a:null,b:null}}var Va=function(){function d(l,n){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=l,this.trackName=n}var u=d.prototype;return u.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},u.newCue=function(n,s,a){(this.startTime===null||this.startTime>n)&&(this.startTime=n),this.endTime=s,this.screen=a,this.timelineController.createCaptionsTrack(this.trackName)},u.reset=function(){this.cueRanges=[],this.startTime=null},d}(),ca=function(){if(Rt!=null&&Rt.VTTCue)return self.VTTCue;var d=["","lr","rl"],u=["start","middle","end","left","right"];function l(h,g){if(typeof g!="string"||!Array.isArray(h))return!1;var m=g.toLowerCase();return~h.indexOf(m)?m:!1}function n(h){return l(d,h)}function s(h){return l(u,h)}function a(h){for(var g=arguments.length,m=new Array(g>1?g-1:0),S=1;S<g;S++)m[S-1]=arguments[S];for(var x=1;x<arguments.length;x++){var U=arguments[x];for(var ne in U)h[ne]=U[ne]}return h}function c(h,g,m){var S=this,x={enumerable:!0};S.hasBeenReset=!1;var U="",ne=!1,ue=h,ge=g,ye=m,Se=null,xe="",De=!0,Fe="auto",He="start",rt=50,ze="middle",Ve=50,Ze="middle";Object.defineProperty(S,"id",a({},x,{get:function(){return U},set:function(ot){U=""+ot}})),Object.defineProperty(S,"pauseOnExit",a({},x,{get:function(){return ne},set:function(ot){ne=!!ot}})),Object.defineProperty(S,"startTime",a({},x,{get:function(){return ue},set:function(ot){if(typeof ot!="number")throw new TypeError("Start time must be set to a number.");ue=ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"endTime",a({},x,{get:function(){return ge},set:function(ot){if(typeof ot!="number")throw new TypeError("End time must be set to a number.");ge=ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"text",a({},x,{get:function(){return ye},set:function(ot){ye=""+ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"region",a({},x,{get:function(){return Se},set:function(ot){Se=ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"vertical",a({},x,{get:function(){return xe},set:function(ot){var ct=n(ot);if(ct===!1)throw new SyntaxError("An invalid or illegal string was specified.");xe=ct,this.hasBeenReset=!0}})),Object.defineProperty(S,"snapToLines",a({},x,{get:function(){return De},set:function(ot){De=!!ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"line",a({},x,{get:function(){return Fe},set:function(ot){if(typeof ot!="number"&&ot!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Fe=ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"lineAlign",a({},x,{get:function(){return He},set:function(ot){var ct=s(ot);if(!ct)throw new SyntaxError("An invalid or illegal string was specified.");He=ct,this.hasBeenReset=!0}})),Object.defineProperty(S,"position",a({},x,{get:function(){return rt},set:function(ot){if(ot<0||ot>100)throw new Error("Position must be between 0 and 100.");rt=ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"positionAlign",a({},x,{get:function(){return ze},set:function(ot){var ct=s(ot);if(!ct)throw new SyntaxError("An invalid or illegal string was specified.");ze=ct,this.hasBeenReset=!0}})),Object.defineProperty(S,"size",a({},x,{get:function(){return Ve},set:function(ot){if(ot<0||ot>100)throw new Error("Size must be between 0 and 100.");Ve=ot,this.hasBeenReset=!0}})),Object.defineProperty(S,"align",a({},x,{get:function(){return Ze},set:function(ot){var ct=s(ot);if(!ct)throw new SyntaxError("An invalid or illegal string was specified.");Ze=ct,this.hasBeenReset=!0}})),S.displayState=void 0}return c.prototype.getCueAsHTML=function(){var h=self.WebVTT;return h.convertCueToDOMTree(self,this.text)},c}(),vo=function(){function d(){}var u=d.prototype;return u.decode=function(n,s){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},d}();function Yo(d){function u(n,s,a,c){return(n|0)*3600+(s|0)*60+(a|0)+parseFloat(c||0)}var l=d.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return l?parseFloat(l[2])>59?u(l[2],l[3],0,l[4]):u(l[1],l[2],l[3],l[4]):null}var zl=function(){function d(){this.values=Object.create(null)}var u=d.prototype;return u.set=function(n,s){!this.get(n)&&s!==""&&(this.values[n]=s)},u.get=function(n,s,a){return a?this.has(n)?this.values[n]:s[a]:this.has(n)?this.values[n]:s},u.has=function(n){return n in this.values},u.alt=function(n,s,a){for(var c=0;c<a.length;++c)if(s===a[c]){this.set(n,s);break}},u.integer=function(n,s){/^-?\d+$/.test(s)&&this.set(n,parseInt(s,10))},u.percent=function(n,s){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(s)){var a=parseFloat(s);if(a>=0&&a<=100)return this.set(n,a),!0}return!1},d}();function Xu(d,u,l,n){var s=n?d.split(n):[d];for(var a in s)if(typeof s[a]=="string"){var c=s[a].split(l);if(c.length===2){var h=c[0],g=c[1];u(h,g)}}}var yo=new ca(0,0,""),Yl=yo.align==="middle"?"middle":"center";function Sd(d,u,l){var n=d;function s(){var h=Yo(d);if(h===null)throw new Error("Malformed timestamp: "+n);return d=d.replace(/^[^\sa-zA-Z-]+/,""),h}function a(h,g){var m=new zl;Xu(h,function(U,ne){var ue;switch(U){case"region":for(var ge=l.length-1;ge>=0;ge--)if(l[ge].id===ne){m.set(U,l[ge].region);break}break;case"vertical":m.alt(U,ne,["rl","lr"]);break;case"line":ue=ne.split(","),m.integer(U,ue[0]),m.percent(U,ue[0])&&m.set("snapToLines",!1),m.alt(U,ue[0],["auto"]),ue.length===2&&m.alt("lineAlign",ue[1],["start",Yl,"end"]);break;case"position":ue=ne.split(","),m.percent(U,ue[0]),ue.length===2&&m.alt("positionAlign",ue[1],["start",Yl,"end","line-left","line-right","auto"]);break;case"size":m.percent(U,ne);break;case"align":m.alt(U,ne,["start",Yl,"end","left","right"]);break}},/:/,/\s/),g.region=m.get("region",null),g.vertical=m.get("vertical","");var S=m.get("line","auto");S==="auto"&&yo.line===-1&&(S=-1),g.line=S,g.lineAlign=m.get("lineAlign","start"),g.snapToLines=m.get("snapToLines",!0),g.size=m.get("size",100),g.align=m.get("align",Yl);var x=m.get("position","auto");x==="auto"&&yo.position===50&&(x=g.align==="start"||g.align==="left"?0:g.align==="end"||g.align==="right"?100:50),g.position=x}function c(){d=d.replace(/^\s+/,"")}if(c(),u.startTime=s(),c(),d.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);d=d.slice(3),c(),u.endTime=s(),c(),a(d,u)}function Xr(d){return d.replace(/<br(?: \/)?>/gi,`
`)}var tf=function(){function d(){this.state="INITIAL",this.buffer="",this.decoder=new vo,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var u=d.prototype;return u.parse=function(n){var s=this;n&&(s.buffer+=s.decoder.decode(n,{stream:!0}));function a(){var x=s.buffer,U=0;for(x=Xr(x);U<x.length&&x[U]!=="\r"&&x[U]!==`
`;)++U;var ne=x.slice(0,U);return x[U]==="\r"&&++U,x[U]===`
`&&++U,s.buffer=x.slice(U),ne}function c(x){Xu(x,function(U,ne){},/:/)}try{var h="";if(s.state==="INITIAL"){if(!/\r\n|\n/.test(s.buffer))return this;h=a();var g=h.match(/^()?WEBVTT([ \t].*)?$/);if(!(g!=null&&g[0]))throw new Error("Malformed WebVTT signature.");s.state="HEADER"}for(var m=!1;s.buffer;){if(!/\r\n|\n/.test(s.buffer))return this;switch(m?m=!1:h=a(),s.state){case"HEADER":/:/.test(h)?c(h):h||(s.state="ID");continue;case"NOTE":h||(s.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(h)){s.state="NOTE";break}if(!h)continue;if(s.cue=new ca(0,0,""),s.state="CUE",h.indexOf("-->")===-1){s.cue.id=h;continue}case"CUE":if(!s.cue){s.state="BADCUE";continue}try{Sd(h,s.cue,s.regionList)}catch{s.cue=null,s.state="BADCUE";continue}s.state="CUETEXT";continue;case"CUETEXT":{var S=h.indexOf("-->")!==-1;if(!h||S&&(m=!0)){s.oncue&&s.cue&&s.oncue(s.cue),s.cue=null,s.state="ID";continue}if(s.cue===null)continue;s.cue.text&&(s.cue.text+=`
`),s.cue.text+=h}continue;case"BADCUE":h||(s.state="ID")}}}catch{s.state==="CUETEXT"&&s.cue&&s.oncue&&s.oncue(s.cue),s.cue=null,s.state=s.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},u.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(s){n.onparsingerror&&n.onparsingerror(s)}return n.onflush&&n.onflush(),this},d}(),zn=/\r\n|\n\r|\n|\r/g,Qu=function(u,l,n){return n===void 0&&(n=0),u.slice(n,n+l.length)===l},xd=function(u){var l=parseInt(u.slice(-3)),n=parseInt(u.slice(-6,-4)),s=parseInt(u.slice(-9,-7)),a=u.length>9?parseInt(u.substring(0,u.indexOf(":"))):0;if(!Ct(l)||!Ct(n)||!Ct(s)||!Ct(a))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+u);return l+=1e3*n,l+=60*1e3*s,l+=60*60*1e3*a,l},it=function(u){for(var l=5381,n=u.length;n;)l=l*33^u.charCodeAt(--n);return(l>>>0).toString()};function Xl(d,u,l){return it(d.toString())+it(u.toString())+it(l)}var Ql=function(u,l,n){var s=u[l],a=u[s.prevCC];if(!a||!a.new&&s.new){u.ccOffset=u.presentationOffset=s.start,s.new=!1;return}for(;(c=a)!=null&&c.new;){var c;u.ccOffset+=s.start-a.start,s.new=!1,s=a,a=u[s.prevCC]}u.presentationOffset=n};function Ju(d,u,l,n,s,a,c){var h=new tf,g=Vi(new Uint8Array(d)).trim().replace(zn,`
`).split(`
`),m=[],S=u?ed(u.baseTime,u.timescale):0,x="00:00.000",U=0,ne=0,ue,ge=!0;h.oncue=function(ye){var Se=l[n],xe=l.ccOffset,De=(U-S)/9e4;if(Se!=null&&Se.new&&(ne!==void 0?xe=l.ccOffset=Se.start:Ql(l,n,De)),De){if(!u){ue=new Error("Missing initPTS for VTT MPEGTS");return}xe=De-l.presentationOffset}var Fe=ye.endTime-ye.startTime,He=Fr((ye.startTime+xe-ne)*9e4,s*9e4)/9e4;ye.startTime=Math.max(He,0),ye.endTime=Math.max(He+Fe,0);var rt=ye.text.trim();ye.text=decodeURIComponent(encodeURIComponent(rt)),ye.id||(ye.id=Xl(ye.startTime,ye.endTime,rt)),ye.endTime>0&&m.push(ye)},h.onparsingerror=function(ye){ue=ye},h.onflush=function(){if(ue){c(ue);return}a(m)},g.forEach(function(ye){if(ge)if(Qu(ye,"X-TIMESTAMP-MAP=")){ge=!1,ye.slice(16).split(",").forEach(function(Se){Qu(Se,"LOCAL:")?x=Se.slice(6):Qu(Se,"MPEGTS:")&&(U=parseInt(Se.slice(7)))});try{ne=xd(x)/1e3}catch(Se){ue=Se}return}else ye===""&&(ge=!1);h.parse(ye+`
`)}),h.flush()}var Zu="stpp.ttml.im1t",ec=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Cd=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,rf={left:"start",center:"center",right:"end",start:"start",end:"end"};function Jl(d,u,l,n){var s=Mt(new Uint8Array(d),["mdat"]);if(s.length===0){n(new Error("Could not parse IMSC1 mdat"));return}var a=s.map(function(h){return Vi(h)}),c=Zc(u.baseTime,1,u.timescale);try{a.forEach(function(h){return l(nf(h,c))})}catch(h){n(h)}}function nf(d,u){var l=new DOMParser,n=l.parseFromString(d,"text/xml"),s=n.getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");var a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},c=Object.keys(a).reduce(function(x,U){return x[U]=s.getAttribute("ttp:"+U)||a[U],x},{}),h=s.getAttribute("xml:space")!=="preserve",g=tc(Dr(s,"styling","style")),m=tc(Dr(s,"layout","region")),S=Dr(s,"body","[begin]");return[].map.call(S,function(x){var U=kd(x,h);if(!U||!x.hasAttribute("begin"))return null;var ne=ic(x.getAttribute("begin"),c),ue=ic(x.getAttribute("dur"),c),ge=ic(x.getAttribute("end"),c);if(ne===null)throw Zl(x);if(ge===null){if(ue===null)throw Zl(x);ge=ne+ue}var ye=new ca(ne-u,ge-u,U);ye.id=Xl(ye.startTime,ye.endTime,ye.text);var Se=m[x.getAttribute("region")],xe=g[x.getAttribute("style")],De=sf(Se,xe,g),Fe=De.textAlign;if(Fe){var He=rf[Fe];He&&(ye.lineAlign=He),ye.align=Fe}return Di(ye,De),ye}).filter(function(x){return x!==null})}function Dr(d,u,l){var n=d.getElementsByTagName(u)[0];return n?[].slice.call(n.querySelectorAll(l)):[]}function tc(d){return d.reduce(function(u,l){var n=l.getAttribute("xml:id");return n&&(u[n]=l),u},{})}function kd(d,u){return[].slice.call(d.childNodes).reduce(function(l,n,s){var a;return n.nodeName==="br"&&s?l+`
`:(a=n.childNodes)!=null&&a.length?kd(n,u):u?l+n.textContent.trim().replace(/\s+/g," "):l+n.textContent},"")}function sf(d,u,l){var n="http://www.w3.org/ns/ttml#styling",s=null,a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],c=d!=null&&d.hasAttribute("style")?d.getAttribute("style"):null;return c&&l.hasOwnProperty(c)&&(s=l[c]),a.reduce(function(h,g){var m=ls(u,n,g)||ls(d,n,g)||ls(s,n,g);return m&&(h[g]=m),h},{})}function ls(d,u,l){return d&&d.hasAttributeNS(u,l)?d.getAttributeNS(u,l):null}function Zl(d){return new Error("Could not parse ttml timestamp "+d)}function ic(d,u){if(!d)return null;var l=Yo(d);return l===null&&(ec.test(d)?l=Ha(d,u):Cd.test(d)&&(l=af(d,u))),l}function Ha(d,u){var l=ec.exec(d),n=(l[4]|0)+(l[5]|0)/u.subFrameRate;return(l[1]|0)*3600+(l[2]|0)*60+(l[3]|0)+n/u.frameRate}function af(d,u){var l=Cd.exec(d),n=Number(l[1]),s=l[2];switch(s){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/u.frameRate;case"t":return n/u.tickRate}return n}var Dd=function(){function d(l){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=nc(),this.captionsProperties=void 0,this.hls=l,this.config=l.config,this.Cues=l.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},l.on(_e.MEDIA_ATTACHING,this.onMediaAttaching,this),l.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),l.on(_e.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(_e.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(_e.FRAG_LOADING,this.onFragLoading,this),l.on(_e.FRAG_LOADED,this.onFragLoaded,this),l.on(_e.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.on(_e.FRAG_DECRYPTED,this.onFragDecrypted,this),l.on(_e.INIT_PTS_FOUND,this.onInitPtsFound,this),l.on(_e.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.on(_e.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=d.prototype;return u.destroy=function(){var n=this.hls;n.off(_e.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_e.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(_e.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),n.off(_e.FRAG_LOADING,this.onFragLoading,this),n.off(_e.FRAG_LOADED,this.onFragLoaded,this),n.off(_e.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),n.off(_e.FRAG_DECRYPTED,this.onFragDecrypted,this),n.off(_e.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(_e.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),n.off(_e.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0},u.initCea608Parsers=function(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){var n=new Va(this,"textTrack1"),s=new Va(this,"textTrack2"),a=new Va(this,"textTrack3"),c=new Va(this,"textTrack4");this.cea608Parser1=new Wo(1,n,s),this.cea608Parser2=new Wo(3,a,c)}},u.addCues=function(n,s,a,c,h){for(var g=!1,m=h.length;m--;){var S=h[m],x=of(S[0],S[1],s,a);if(x>=0&&(S[0]=Math.min(S[0],s),S[1]=Math.max(S[1],a),g=!0,x/(a-s)>.5))return}if(g||h.push([s,a]),this.config.renderTextTracksNatively){var U=this.captionsTracks[n];this.Cues.newCue(U,s,a,c)}else{var ne=this.Cues.newCue(null,s,a,c);this.hls.trigger(_e.CUES_PARSED,{type:"captions",cues:ne,track:n})}},u.onInitPtsFound=function(n,s){var a=this,c=s.frag,h=s.id,g=s.initPTS,m=s.timescale,S=this.unparsedVttFrags;h==="main"&&(this.initPTS[c.cc]={baseTime:g,timescale:m}),S.length&&(this.unparsedVttFrags=[],S.forEach(function(x){a.onFragLoaded(_e.FRAG_LOADED,x)}))},u.getExistingTrack=function(n,s){var a=this.media;if(a)for(var c=0;c<a.textTracks.length;c++){var h=a.textTracks[c];if(Yn(h,{name:n,lang:s,attrs:{}}))return h}return null},u.createCaptionsTrack=function(n){this.config.renderTextTracksNatively?this.createNativeTrack(n):this.createNonNativeTrack(n)},u.createNativeTrack=function(n){if(!this.captionsTracks[n]){var s=this.captionsProperties,a=this.captionsTracks,c=this.media,h=s[n],g=h.label,m=h.languageCode,S=this.getExistingTrack(g,m);if(S)a[n]=S,Ds(a[n]),uo(a[n],c);else{var x=this.createTextTrack("captions",g,m);x&&(x[n]=!0,a[n]=x)}}},u.createNonNativeTrack=function(n){if(!this.nonNativeCaptionsTracks[n]){var s=this.captionsProperties[n];if(s){var a=s.label,c={_id:n,label:a,kind:"captions",default:s.media?!!s.media.default:!1,closedCaptions:s.media};this.nonNativeCaptionsTracks[n]=c,this.hls.trigger(_e.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[c]})}}},u.createTextTrack=function(n,s,a){var c=this.media;if(c)return c.addTextTrack(n,s,a)},u.onMediaAttaching=function(n,s){this.media=s.media,this._cleanTracks()},u.onMediaDetaching=function(){var n=this.captionsTracks;Object.keys(n).forEach(function(s){Ds(n[s]),delete n[s]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=nc(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var n=this.media;if(n){var s=n.textTracks;if(s)for(var a=0;a<s.length;a++)Ds(s[a])}},u.onSubtitleTracksUpdated=function(n,s){var a=this,c=s.subtitleTracks||[],h=c.some(function(ne){return ne.textCodec===Zu});if(this.config.enableWebVTT||h&&this.config.enableIMSC1){var g=$u(this.tracks,c);if(g){this.tracks=c;return}if(this.textTracks=[],this.tracks=c,this.config.renderTextTracksNatively){var m=this.media,S=m?ns(m.textTracks):null;if(this.tracks.forEach(function(ne,ue){var ge;if(S){for(var ye=null,Se=0;Se<S.length;Se++)if(S[Se]&&Yn(S[Se],ne)){ye=S[Se],S[Se]=null;break}ye&&(ge=ye)}if(ge)Ds(ge);else{var xe=rc(ne);ge=a.createTextTrack(xe,ne.name,ne.lang),ge&&(ge.mode="disabled")}ge&&a.textTracks.push(ge)}),S!=null&&S.length){var x=S.filter(function(ne){return ne!==null}).map(function(ne){return ne.label});x.length&&Qe.warn("Media element contains unused subtitle tracks: "+x.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var U=this.tracks.map(function(ne){return{label:ne.name,kind:ne.type.toLowerCase(),default:ne.default,subtitleTrack:ne}});this.hls.trigger(_e.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:U})}}},u.onManifestLoaded=function(n,s){var a=this;this.config.enableCEA708Captions&&s.captions&&s.captions.forEach(function(c){var h=/(?:CC|SERVICE)([1-4])/.exec(c.instreamId);if(h){var g="textTrack"+h[1],m=a.captionsProperties[g];m&&(m.label=c.name,c.lang&&(m.languageCode=c.lang),m.media=c)}})},u.closedCaptionsForLevel=function(n){var s=this.hls.levels[n.level];return s?.attrs["CLOSED-CAPTIONS"]},u.onFragLoading=function(n,s){if(this.enabled&&s.frag.type===Nt.MAIN){var a,c,h=this.cea608Parser1,g=this.cea608Parser2,m=this.lastSn,S=s.frag,x=S.cc,U=S.sn,ne=(a=(c=s.part)==null?void 0:c.index)!=null?a:-1;h&&g&&(U!==m+1||U===m&&ne!==this.lastPartIndex+1||x!==this.lastCc)&&(h.reset(),g.reset()),this.lastCc=x,this.lastSn=U,this.lastPartIndex=ne}},u.onFragLoaded=function(n,s){var a=s.frag,c=s.payload;if(a.type===Nt.SUBTITLE)if(c.byteLength){var h=a.decryptdata,g="stats"in s;if(h==null||!h.encrypted||g){var m=this.tracks[a.level],S=this.vttCCs;S[a.cc]||(S[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),m&&m.textCodec===Zu?this._parseIMSC1(a,c):this._parseVTTs(s)}}else this.hls.trigger(_e.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(n,s){var a=this,c=this.hls;Jl(s,this.initPTS[n.cc],function(h){a._appendCues(h,n.level),c.trigger(_e.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},function(h){Qe.log("Failed to parse IMSC1: "+h),c.trigger(_e.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})},u._parseVTTs=function(n){var s,a=this,c=n.frag,h=n.payload,g=this.initPTS,m=this.unparsedVttFrags,S=g.length-1;if(!g[c.cc]&&S===-1){m.push(n);return}var x=this.hls,U=(s=c.initSegment)!=null&&s.data?Ei(c.initSegment.data,new Uint8Array(h)):h;Ju(U,this.initPTS[c.cc],this.vttCCs,c.cc,c.start,function(ne){a._appendCues(ne,c.level),x.trigger(_e.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:c})},function(ne){var ue=ne.message==="Missing initPTS for VTT MPEGTS";ue?m.push(n):a._fallbackToIMSC1(c,h),Qe.log("Failed to parse VTT cue: "+ne),!(ue&&S>c.cc)&&x.trigger(_e.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c,error:ne})})},u._fallbackToIMSC1=function(n,s){var a=this,c=this.tracks[n.level];c.textCodec||Jl(s,this.initPTS[n.cc],function(){c.textCodec=Zu,a._parseIMSC1(n,s)},function(){c.textCodec="wvtt"})},u._appendCues=function(n,s){var a=this.hls;if(this.config.renderTextTracksNatively){var c=this.textTracks[s];if(!c||c.mode==="disabled")return;n.forEach(function(m){return Ra(c,m)})}else{var h=this.tracks[s];if(!h)return;var g=h.default?"default":"subtitles"+s;a.trigger(_e.CUES_PARSED,{type:"subtitles",cues:n,track:g})}},u.onFragDecrypted=function(n,s){var a=s.frag;a.type===Nt.SUBTITLE&&this.onFragLoaded(_e.FRAG_LOADED,s)},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(n,s){this.initCea608Parsers();var a=this.cea608Parser1,c=this.cea608Parser2;if(!(!this.enabled||!a||!c)){var h=s.frag,g=s.samples;if(!(h.type===Nt.MAIN&&this.closedCaptionsForLevel(h)==="NONE"))for(var m=0;m<g.length;m++){var S=g[m].bytes;if(S){var x=this.extractCea608Data(S);a.addData(g[m].pts,x[0]),c.addData(g[m].pts,x[1])}}}},u.onBufferFlushing=function(n,s){var a=s.startOffset,c=s.endOffset,h=s.endOffsetSubtitles,g=s.type,m=this.media;if(!(!m||m.currentTime<c)){if(!g||g==="video"){var S=this.captionsTracks;Object.keys(S).forEach(function(U){return Or(S[U],a,c)})}if(this.config.renderTextTracksNatively&&a===0&&h!==void 0){var x=this.textTracks;Object.keys(x).forEach(function(U){return Or(x[U],a,h)})}}},u.extractCea608Data=function(n){for(var s=[[],[]],a=n[0]&31,c=2,h=0;h<a;h++){var g=n[c++],m=127&n[c++],S=127&n[c++];if(!(m===0&&S===0)){var x=(4&g)!==0;if(x){var U=3&g;(U===0||U===1)&&(s[U].push(m),s[U].push(S))}}}return s},d}();function rc(d){return d.characteristics&&/transcribes-spoken-dialog/gi.test(d.characteristics)&&/describes-music-and-sound/gi.test(d.characteristics)?"captions":"subtitles"}function Yn(d,u){return!!d&&d.kind===rc(u)&&Kl(u,d)}function of(d,u,l,n){return Math.min(u,n)-Math.max(d,l)}function nc(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var lf=function(){function d(l){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=l,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var u=d.prototype;return u.setStreamController=function(n){this.streamController=n},u.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},u.registerListeners=function(){var n=this.hls;n.on(_e.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),n.on(_e.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(_e.MANIFEST_PARSED,this.onManifestParsed,this),n.on(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),n.on(_e.BUFFER_CODECS,this.onBufferCodecs,this),n.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this)},u.unregisterListener=function(){var n=this.hls;n.off(_e.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),n.off(_e.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(_e.MANIFEST_PARSED,this.onManifestParsed,this),n.off(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),n.off(_e.BUFFER_CODECS,this.onBufferCodecs,this),n.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this)},u.onFpsDropLevelCapping=function(n,s){var a=this.hls.levels[s.droppedLevel];this.isLevelAllowed(a)&&this.restrictedLevels.push({bitrate:a.bitrate,height:a.height,width:a.width})},u.onMediaAttaching=function(n,s){this.media=s.media instanceof HTMLVideoElement?s.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},u.onManifestParsed=function(n,s){var a=this.hls;this.restrictedLevels=[],this.firstLevel=s.firstLevel,a.config.capLevelToPlayerSize&&s.video&&this.startCapping()},u.onLevelsUpdated=function(n,s){this.timer&&Ct(this.autoLevelCapping)&&this.detectPlayerSize()},u.onBufferCodecs=function(n,s){var a=this.hls;a.config.capLevelToPlayerSize&&s.video&&this.startCapping()},u.onMediaDetaching=function(){this.stopCapping()},u.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}var n=this.hls.levels;if(n.length){var s=this.hls,a=this.getMaxLevel(n.length-1);a!==this.autoLevelCapping&&Qe.log("Setting autoLevelCapping to "+a+": "+n[a].height+"p@"+n[a].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),s.autoLevelCapping=a,s.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=s.autoLevelCapping}}},u.getMaxLevel=function(n){var s=this,a=this.hls.levels;if(!a.length)return-1;var c=a.filter(function(h,g){return s.isLevelAllowed(h)&&g<=n});return this.clientRect=null,d.getMaxLevelByMediaSize(c,this.mediaWidth,this.mediaHeight)},u.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},u.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},u.getDimensions=function(){if(this.clientRect)return this.clientRect;var n=this.media,s={width:0,height:0};if(n){var a=n.getBoundingClientRect();s.width=a.width,s.height=a.height,!s.width&&!s.height&&(s.width=a.right-a.left||n.width||0,s.height=a.bottom-a.top||n.height||0)}return this.clientRect=s,s},u.isLevelAllowed=function(n){var s=this.restrictedLevels;return!s.some(function(a){return n.bitrate===a.bitrate&&n.width===a.width&&n.height===a.height})},d.getMaxLevelByMediaSize=function(n,s,a){if(!(n!=null&&n.length))return-1;for(var c=function(U,ne){return ne?U.width!==ne.width||U.height!==ne.height:!0},h=n.length-1,g=Math.max(s,a),m=0;m<n.length;m+=1){var S=n[m];if((S.width>=g||S.height>=g)&&c(S,n[m+1])){h=m;break}}return h},ki(d,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var n=1;if(!this.hls.config.ignoreDevicePixelRatio)try{n=self.devicePixelRatio}catch{}return n}}]),d}(),To=function(){function d(l){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=l,this.registerListeners()}var u=d.prototype;return u.setStreamController=function(n){this.streamController=n},u.registerListeners=function(){this.hls.on(_e.MEDIA_ATTACHING,this.onMediaAttaching,this)},u.unregisterListeners=function(){this.hls.off(_e.MEDIA_ATTACHING,this.onMediaAttaching,this)},u.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},u.onMediaAttaching=function(n,s){var a=this.hls.config;if(a.capLevelOnFPSDrop){var c=s.media instanceof self.HTMLVideoElement?s.media:null;this.media=c,c&&typeof c.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),a.fpsDroppedMonitoringPeriod)}},u.checkFPS=function(n,s,a){var c=performance.now();if(s){if(this.lastTime){var h=c-this.lastTime,g=a-this.lastDroppedFrames,m=s-this.lastDecodedFrames,S=1e3*g/h,x=this.hls;if(x.trigger(_e.FPS_DROP,{currentDropped:g,currentDecoded:m,totalDroppedFrames:a}),S>0&&g>x.config.fpsDroppedMonitoringThreshold*m){var U=x.currentLevel;Qe.warn("drop FPS ratio greater than max allowed value for currentLevel: "+U),U>0&&(x.autoLevelCapping===-1||x.autoLevelCapping>=U)&&(U=U-1,x.trigger(_e.FPS_DROP_LEVEL_CAPPING,{level:U,droppedLevel:x.currentLevel}),x.autoLevelCapping=U,this.streamController.nextLevelSwitch())}}this.lastTime=c,this.lastDroppedFrames=a,this.lastDecodedFrames=s}},u.checkFPSInterval=function(){var n=this.media;if(n)if(this.isVideoPlaybackQualityAvailable){var s=n.getVideoPlaybackQuality();this.checkFPS(n,s.totalVideoFrames,s.droppedVideoFrames)}else this.checkFPS(n,n.webkitDecodedFrameCount,n.webkitDroppedFrameCount)},d}(),da="[eme]",eu=function(){function d(l){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=d.CDMCleanupPromise?[d.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=Qe.debug.bind(Qe,da),this.log=Qe.log.bind(Qe,da),this.warn=Qe.warn.bind(Qe,da),this.error=Qe.error.bind(Qe,da),this.hls=l,this.config=l.config,this.registerListeners()}var u=d.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var n=this.config;n.requestMediaKeySystemAccessFunc=null,n.licenseXhrSetup=n.licenseResponseCallback=void 0,n.drmSystems=n.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null},u.registerListeners=function(){this.hls.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_e.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_e.MANIFEST_LOADED,this.onManifestLoaded,this)},u.unregisterListeners=function(){this.hls.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_e.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(_e.MANIFEST_LOADED,this.onManifestLoaded,this)},u.getLicenseServerUrl=function(n){var s=this.config,a=s.drmSystems,c=s.widevineLicenseUrl,h=a[n];if(h)return h.licenseUrl;if(n===ii.WIDEVINE&&c)return c;throw new Error('no license server URL configured for key-system "'+n+'"')},u.getServerCertificateUrl=function(n){var s=this.config.drmSystems,a=s[n];if(a)return a.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+n+'"]')},u.attemptKeySystemAccess=function(n){var s=this,a=this.hls.levels,c=function(S,x,U){return!!S&&U.indexOf(S)===x},h=a.map(function(m){return m.audioCodec}).filter(c),g=a.map(function(m){return m.videoCodec}).filter(c);return h.length+g.length===0&&g.push("avc1.42e01e"),new Promise(function(m,S){var x=function U(ne){var ue=ne.shift();s.getMediaKeysPromise(ue,h,g).then(function(ge){return m({keySystem:ue,mediaKeys:ge})}).catch(function(ge){ne.length?U(ne):ge instanceof En?S(ge):S(new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_ACCESS,error:ge,fatal:!0},ge.message))})};x(n)})},u.requestMediaKeySystemAccess=function(n,s){var a=this.config.requestMediaKeySystemAccessFunc;if(typeof a!="function"){var c="Configured requestMediaKeySystemAccess is not a function "+a;return wn===null&&self.location.protocol==="http:"&&(c="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(c))}return a(n,s)},u.getMediaKeysPromise=function(n,s,a){var c=this,h=Ae(n,s,a,this.config.drmSystemOptions),g=this.keySystemAccessPromises[n],m=g?.keySystemAccess;if(!m){this.log('Requesting encrypted media "'+n+'" key-system access with config: '+JSON.stringify(h)),m=this.requestMediaKeySystemAccess(n,h);var S=this.keySystemAccessPromises[n]={keySystemAccess:m};return m.catch(function(x){c.log('Failed to obtain access to key-system "'+n+'": '+x)}),m.then(function(x){c.log('Access for key-system "'+x.keySystem+'" obtained');var U=c.fetchServerCertificate(n);return c.log('Create media-keys for "'+n+'"'),S.mediaKeys=x.createMediaKeys().then(function(ne){return c.log('Media-keys created for "'+n+'"'),U.then(function(ue){return ue?c.setMediaKeysServerCertificate(ne,n,ue):ne})}),S.mediaKeys.catch(function(ne){c.error('Failed to create media-keys for "'+n+'"}: '+ne)}),S.mediaKeys})}return m.then(function(){return g.mediaKeys})},u.createMediaKeySessionContext=function(n){var s=n.decryptdata,a=n.keySystem,c=n.mediaKeys;this.log('Creating key-system session "'+a+'" keyId: '+tn.hexDump(s.keyId||[]));var h=c.createSession(),g={decryptdata:s,keySystem:a,mediaKeys:c,mediaKeysSession:h,keyStatus:"status-pending"};return this.mediaKeySessions.push(g),g},u.renewKeySession=function(n){var s=n.decryptdata;if(s.pssh){var a=this.createMediaKeySessionContext(n),c=this.getKeyIdString(s),h="cenc";this.keyIdToKeySessionPromise[c]=this.generateRequestWithPreferredKeySession(a,h,s.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(n)},u.getKeyIdString=function(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return tn.hexDump(n.keyId)},u.updateKeySession=function(n,s){var a,c=n.mediaKeysSession;return this.log('Updating key-session "'+c.sessionId+'" for keyID '+tn.hexDump(((a=n.decryptdata)==null?void 0:a.keyId)||[])+`
      } (data length: `+(s&&s.byteLength)+")"),c.update(s)},u.selectKeySystemFormat=function(n){var s=Object.keys(n.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+n.sn+" "+n.type+": "+n.level+") key formats "+s.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(s)),this.keyFormatPromise},u.getKeyFormatPromise=function(n){var s=this;return new Promise(function(a,c){var h=Ts(s.config),g=n.map(ys).filter(function(m){return!!m&&h.indexOf(m)!==-1});return s.getKeySystemSelectionPromise(g).then(function(m){var S=m.keySystem,x=ro(S);x?a(x):c(new Error('Unable to find format for key-system "'+S+'"'))}).catch(c)})},u.loadKey=function(n){var s=this,a=n.keyInfo.decryptdata,c=this.getKeyIdString(a),h="(keyId: "+c+' format: "'+a.keyFormat+'" method: '+a.method+" uri: "+a.uri+")";this.log("Starting session for key "+h);var g=this.keyIdToKeySessionPromise[c];return g||(g=this.keyIdToKeySessionPromise[c]=this.getKeySystemForKeyPromise(a).then(function(m){var S=m.keySystem,x=m.mediaKeys;return s.throwIfDestroyed(),s.log("Handle encrypted media sn: "+n.frag.sn+" "+n.frag.type+": "+n.frag.level+" using key "+h),s.attemptSetMediaKeys(S,x).then(function(){s.throwIfDestroyed();var U=s.createMediaKeySessionContext({keySystem:S,mediaKeys:x,decryptdata:a}),ne="cenc";return s.generateRequestWithPreferredKeySession(U,ne,a.pssh,"playlist-key")})}),g.catch(function(m){return s.handleError(m)})),g},u.throwIfDestroyed=function(n){if(!this.hls)throw new Error("invalid state")},u.handleError=function(n){this.hls&&(this.error(n.message),n instanceof En?this.hls.trigger(_e.ERROR,n.data):this.hls.trigger(_e.ERROR,{type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_KEYS,error:n,fatal:!0}))},u.getKeySystemForKeyPromise=function(n){var s=this.getKeyIdString(n),a=this.keyIdToKeySessionPromise[s];if(!a){var c=ys(n.keyFormat),h=c?[c]:Ts(this.config);return this.attemptKeySystemAccess(h)}return a},u.getKeySystemSelectionPromise=function(n){if(n.length||(n=Ts(this.config)),n.length===0)throw new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(n)},u._onMediaEncrypted=function(n){var s=this,a=n.initDataType,c=n.initData,h='"'+n.type+'" event: init data type: "'+a+'"';if(this.debug(h),c!==null){var g,m;if(a==="sinf"&&this.config.drmSystems[ii.FAIRPLAY]){var S=Wi(new Uint8Array(c));try{var x=io(JSON.parse(S).sinf),U=bs(new Uint8Array(x));if(!U)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");g=U.subarray(8,24),m=ii.FAIRPLAY}catch(ze){this.warn(h+" Failed to parse sinf: "+ze);return}}else{var ne=Js(c),ue=ne.filter(function(ze){return ze.systemId===Gt.WIDEVINE})[0];if(!ue){ne.length===0||ne.some(function(ze){return!ze.systemId})?this.warn(h+" contains incomplete or invalid pssh data"):this.log("ignoring "+h+" for "+ne.map(function(ze){return Aa(ze.systemId)}).join(",")+" pssh data in favor of playlist keys");return}if(m=Aa(ue.systemId),ue.version===0&&ue.data){var ge=ue.data.length-22;g=ue.data.subarray(ge,ge+16)}}if(!(!m||!g)){for(var ye=tn.hexDump(g),Se=this.keyIdToKeySessionPromise,xe=this.mediaKeySessions,De=Se[ye],Fe=function(){var Ve=xe[rt],Ze=Ve.decryptdata;if(!Ze.keyId)return 0;var et=tn.hexDump(Ze.keyId);if(ye===et||Ze.uri.replace(/-/g,"").indexOf(ye)!==-1)return De=Se[et],Ze.pssh||(delete Se[et],Ze.pssh=new Uint8Array(c),Ze.keyId=g,De=Se[ye]=De.then(function(){return s.generateRequestWithPreferredKeySession(Ve,a,c,"encrypted-event-key-match")})),1},He,rt=0;rt<xe.length&&(He=Fe(),!(He!==0&&He===1));rt++);De||(De=Se[ye]=this.getKeySystemSelectionPromise([m]).then(function(ze){var Ve,Ze=ze.keySystem,et=ze.mediaKeys;s.throwIfDestroyed();var ot=new jn("ISO-23001-7",ye,(Ve=ro(Ze))!=null?Ve:"");return ot.pssh=new Uint8Array(c),ot.keyId=g,s.attemptSetMediaKeys(Ze,et).then(function(){s.throwIfDestroyed();var ct=s.createMediaKeySessionContext({decryptdata:ot,keySystem:Ze,mediaKeys:et});return s.generateRequestWithPreferredKeySession(ct,a,c,"encrypted-event-no-match")})})),De.catch(function(ze){return s.handleError(ze)})}}},u._onWaitingForKey=function(n){this.log('"'+n.type+'" event')},u.attemptSetMediaKeys=function(n,s){var a=this,c=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+n+'"');var h=Promise.all(c).then(function(){if(!a.media)throw new Error("Attempted to set mediaKeys without media element attached");return a.media.setMediaKeys(s)});return this.setMediaKeysQueue.push(h),h.then(function(){a.log('Media-keys set for "'+n+'"'),c.push(h),a.setMediaKeysQueue=a.setMediaKeysQueue.filter(function(g){return c.indexOf(g)===-1})})},u.generateRequestWithPreferredKeySession=function(n,s,a,c){var h,g,m=this,S=(h=this.config.drmSystems)==null||(g=h[n.keySystem])==null?void 0:g.generateRequest;if(S)try{var x=S.call(this.hls,s,a,n);if(!x)throw new Error("Invalid response from configured generateRequest filter");s=x.initDataType,a=n.decryptdata.pssh=x.initData?new Uint8Array(x.initData):null}catch(xe){var U;if(this.warn(xe.message),(U=this.hls)!=null&&U.config.debug)throw xe}if(a===null)return this.log('Skipping key-session request for "'+c+'" (no initData)'),Promise.resolve(n);var ne=this.getKeyIdString(n.decryptdata);this.log('Generating key-session request for "'+c+'": '+ne+" (init data type: "+s+" length: "+(a?a.byteLength:null)+")");var ue=new qo,ge=n._onmessage=function(xe){var De=n.mediaKeysSession;if(!De){ue.emit("error",new Error("invalid state"));return}var Fe=xe.messageType,He=xe.message;m.log('"'+Fe+'" message event for session "'+De.sessionId+'" message size: '+He.byteLength),Fe==="license-request"||Fe==="license-renewal"?m.renewLicense(n,He).catch(function(rt){m.handleError(rt),ue.emit("error",rt)}):Fe==="license-release"?n.keySystem===ii.FAIRPLAY&&(m.updateKeySession(n,vs("acknowledged")),m.removeSession(n)):m.warn('unhandled media key message type "'+Fe+'"')},ye=n._onkeystatuseschange=function(xe){var De=n.mediaKeysSession;if(!De){ue.emit("error",new Error("invalid state"));return}m.onKeyStatusChange(n);var Fe=n.keyStatus;ue.emit("keyStatus",Fe),Fe==="expired"&&(m.warn(n.keySystem+" expired for key "+ne),m.renewKeySession(n))};n.mediaKeysSession.addEventListener("message",ge),n.mediaKeysSession.addEventListener("keystatuseschange",ye);var Se=new Promise(function(xe,De){ue.on("error",De),ue.on("keyStatus",function(Fe){Fe.startsWith("usable")?xe():Fe==="output-restricted"?De(new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):Fe==="internal-error"?De(new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+Fe+'"')):Fe==="expired"?De(new Error("key expired while generating request")):m.warn('unhandled key status change "'+Fe+'"')})});return n.mediaKeysSession.generateRequest(s,a).then(function(){var xe;m.log('Request generated for key-session "'+((xe=n.mediaKeysSession)==null?void 0:xe.sessionId)+'" keyId: '+ne)}).catch(function(xe){throw new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_NO_SESSION,error:xe,fatal:!1},"Error generating key-session request: "+xe)}).then(function(){return Se}).catch(function(xe){throw ue.removeAllListeners(),m.removeSession(n),xe}).then(function(){return ue.removeAllListeners(),n})},u.onKeyStatusChange=function(n){var s=this;n.mediaKeysSession.keyStatuses.forEach(function(a,c){s.log('key status change "'+a+'" for keyStatuses keyId: '+tn.hexDump("buffer"in c?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c))+" session keyId: "+tn.hexDump(new Uint8Array(n.decryptdata.keyId||[]))+" uri: "+n.decryptdata.uri),n.keyStatus=a})},u.fetchServerCertificate=function(n){var s=this.config,a=s.loader,c=new a(s),h=this.getServerCertificateUrl(n);return h?(this.log('Fetching server certificate for "'+n+'"'),new Promise(function(g,m){var S={responseType:"arraybuffer",url:h},x=s.certLoadPolicy.default,U={loadPolicy:x,timeout:x.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},ne={onSuccess:function(ge,ye,Se,xe){g(ge.data)},onError:function(ge,ye,Se,xe){m(new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:Se,response:Ii({url:S.url,data:void 0},ge)},'"'+n+'" certificate request failed ('+h+"). Status: "+ge.code+" ("+ge.text+")"))},onTimeout:function(ge,ye,Se){m(new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:Se,response:{url:S.url,data:void 0}},'"'+n+'" certificate request timed out ('+h+")"))},onAbort:function(ge,ye,Se){m(new Error("aborted"))}};c.load(S,U,ne)})):Promise.resolve()},u.setMediaKeysServerCertificate=function(n,s,a){var c=this;return new Promise(function(h,g){n.setServerCertificate(a).then(function(m){c.log("setServerCertificate "+(m?"success":"not supported by CDM")+" ("+a?.byteLength+') on "'+s+'"'),h(n)}).catch(function(m){g(new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:m,fatal:!0},m.message))})})},u.renewLicense=function(n,s){var a=this;return this.requestLicense(n,new Uint8Array(s)).then(function(c){return a.updateKeySession(n,new Uint8Array(c)).catch(function(h){throw new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:h,fatal:!0},h.message)})})},u.unpackPlayReadyKeyMessage=function(n,s){var a=String.fromCharCode.apply(null,new Uint16Array(s.buffer));if(!a.includes("PlayReadyKeyMessage"))return n.setRequestHeader("Content-Type","text/xml; charset=utf-8"),s;var c=new DOMParser().parseFromString(a,"application/xml"),h=c.querySelectorAll("HttpHeader");if(h.length>0)for(var g,m=0,S=h.length;m<S;m++){var x,U;g=h[m];var ne=(x=g.querySelector("name"))==null?void 0:x.textContent,ue=(U=g.querySelector("value"))==null?void 0:U.textContent;ne&&ue&&n.setRequestHeader(ne,ue)}var ge=c.querySelector("Challenge"),ye=ge?.textContent;if(!ye)throw new Error("Cannot find <Challenge> in key message");return vs(atob(ye))},u.setupLicenseXHR=function(n,s,a,c){var h=this,g=this.config.licenseXhrSetup;return g?Promise.resolve().then(function(){if(!a.decryptdata)throw new Error("Key removed");return g.call(h.hls,n,s,a,c)}).catch(function(m){if(!a.decryptdata)throw m;return n.open("POST",s,!0),g.call(h.hls,n,s,a,c)}).then(function(m){n.readyState||n.open("POST",s,!0);var S=m||c;return{xhr:n,licenseChallenge:S}}):(n.open("POST",s,!0),Promise.resolve({xhr:n,licenseChallenge:c}))},u.requestLicense=function(n,s){var a=this,c=this.config.keyLoadPolicy.default;return new Promise(function(h,g){var m=a.getLicenseServerUrl(n.keySystem);a.log("Sending license request to URL: "+m);var S=new XMLHttpRequest;S.responseType="arraybuffer",S.onreadystatechange=function(){if(!a.hls||!n.mediaKeysSession)return g(new Error("invalid state"));if(S.readyState===4)if(S.status===200){a._requestLicenseFailureCount=0;var x=S.response;a.log("License received "+(x instanceof ArrayBuffer?x.byteLength:x));var U=a.config.licenseResponseCallback;if(U)try{x=U.call(a.hls,S,m,n)}catch(ye){a.error(ye)}h(x)}else{var ne=c.errorRetry,ue=ne?ne.maxNumRetry:0;if(a._requestLicenseFailureCount++,a._requestLicenseFailureCount>ue||S.status>=400&&S.status<500)g(new En({type:Pt.KEY_SYSTEM_ERROR,details:je.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:m,data:void 0,code:S.status,text:S.statusText}},"License Request XHR failed ("+m+"). Status: "+S.status+" ("+S.statusText+")"));else{var ge=ue-a._requestLicenseFailureCount+1;a.warn("Retrying license request, "+ge+" attempts left"),a.requestLicense(n,s).then(h,g)}}},n.licenseXhr&&n.licenseXhr.readyState!==XMLHttpRequest.DONE&&n.licenseXhr.abort(),n.licenseXhr=S,a.setupLicenseXHR(S,m,n,s).then(function(x){var U=x.xhr,ne=x.licenseChallenge;n.keySystem==ii.PLAYREADY&&(ne=a.unpackPlayReadyKeyMessage(U,ne)),U.send(ne)})})},u.onMediaAttached=function(n,s){if(this.config.emeEnabled){var a=s.media;this.media=a,a.addEventListener("encrypted",this.onMediaEncrypted),a.addEventListener("waitingforkey",this.onWaitingForKey)}},u.onMediaDetached=function(){var n=this,s=this.media,a=this.mediaKeySessions;s&&(s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},jn.clearKeyUriToKeyIdMap();var c=a.length;d.CDMCleanupPromise=Promise.all(a.map(function(h){return n.removeSession(h)}).concat(s?.setMediaKeys(null).catch(function(h){n.log("Could not clear media keys: "+h)}))).then(function(){c&&(n.log("finished closing key sessions and clearing media keys"),a.length=0)}).catch(function(h){n.log("Could not close sessions and clear media keys: "+h)})},u.onManifestLoading=function(){this.keyFormatPromise=null},u.onManifestLoaded=function(n,s){var a=s.sessionKeys;if(!(!a||!this.config.emeEnabled)&&!this.keyFormatPromise){var c=a.reduce(function(h,g){return h.indexOf(g.keyFormat)===-1&&h.push(g.keyFormat),h},[]);this.log("Selecting key-system from session-keys "+c.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(c)}},u.removeSession=function(n){var s=this,a=n.mediaKeysSession,c=n.licenseXhr;if(a){this.log("Remove licenses and keys and close session "+a.sessionId),n._onmessage&&(a.removeEventListener("message",n._onmessage),n._onmessage=void 0),n._onkeystatuseschange&&(a.removeEventListener("keystatuseschange",n._onkeystatuseschange),n._onkeystatuseschange=void 0),c&&c.readyState!==XMLHttpRequest.DONE&&c.abort(),n.mediaKeysSession=n.decryptdata=n.licenseXhr=void 0;var h=this.mediaKeySessions.indexOf(n);return h>-1&&this.mediaKeySessions.splice(h,1),a.remove().catch(function(g){s.log("Could not remove session: "+g)}).then(function(){return a.close()}).catch(function(g){s.log("Could not close session: "+g)})}},d}();eu.CDMCleanupPromise=void 0;var En=function(d){Bt(u,d);function u(l,n){var s;return s=d.call(this,n)||this,s.data=void 0,l.error||(l.error=new Error(n)),s.data=l,l.err=l.error,s}return u}(js(Error)),Br;(function(d){d.MANIFEST="m",d.AUDIO="a",d.VIDEO="v",d.MUXED="av",d.INIT="i",d.CAPTION="c",d.TIMED_TEXT="tt",d.KEY="k",d.OTHER="o"})(Br||(Br={}));var sc;(function(d){d.DASH="d",d.HLS="h",d.SMOOTH="s",d.OTHER="o"})(sc||(sc={}));var ja;(function(d){d.OBJECT="CMCD-Object",d.REQUEST="CMCD-Request",d.SESSION="CMCD-Session",d.STATUS="CMCD-Status"})(ja||(ja={}));var Ka,uf=(Ka={},Ka[ja.OBJECT]=["br","d","ot","tb"],Ka[ja.REQUEST]=["bl","dl","mtp","nor","nrr","su"],Ka[ja.SESSION]=["cid","pr","sf","sid","st","v"],Ka[ja.STATUS]=["bs","rtp"],Ka),ac=function d(u,l){this.value=void 0,this.params=void 0,Array.isArray(u)&&(u=u.map(function(n){return n instanceof d?n:new d(n)})),this.value=u,this.params=l},oc=function(u){this.description=void 0,this.description=u},cf="Dict";function Ft(d){return Array.isArray(d)?JSON.stringify(d):d instanceof Map?"Map{}":d instanceof Set?"Set{}":typeof d=="object"?JSON.stringify(d):String(d)}function wr(d,u,l,n){return new Error("failed to "+d+' "'+Ft(u)+'" as '+l,{cause:n})}var tu="Bare Item",df="Boolean",hf="Byte Sequence",wd="Decimal",ff="Integer";function Fi(d){return d<-999999999999999||999999999999999<d}var pf=/[\x00-\x1f\x7f]+/,gf="Token",lc="Key";function us(d,u,l){return wr("serialize",d,u,l)}function Ld(d){if(typeof d!="boolean")throw us(d,df);return d?"?1":"?0"}function Id(d){return btoa(String.fromCharCode.apply(String,d))}function mf(d){if(ArrayBuffer.isView(d)===!1)throw us(d,hf);return":"+Id(d)+":"}function Rd(d){if(Fi(d))throw us(d,ff);return d.toString()}function vf(d){return"@"+Rd(d.getTime()/1e3)}function Pd(d,u){if(d<0)return-Pd(-d,u);var l=Math.pow(10,u),n=Math.abs(d*l%1-.5)<Number.EPSILON;if(n){var s=Math.floor(d*l);return(s%2===0?s:s+1)/l}else return Math.round(d*l)/l}function yf(d){var u=Pd(d,3);if(Math.floor(Math.abs(u)).toString().length>12)throw us(d,wd);var l=u.toString();return l.includes(".")?l:l+".0"}var Xo="String";function cs(d){if(pf.test(d))throw us(d,Xo);return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Qo(d){return d.description||d.toString().slice(7,-1)}function Od(d){var u=Qo(d);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(u)===!1)throw us(u,gf);return u}function uc(d){switch(typeof d){case"number":if(!Ct(d))throw us(d,tu);return Number.isInteger(d)?Rd(d):yf(d);case"string":return cs(d);case"symbol":return Od(d);case"boolean":return Ld(d);case"object":if(d instanceof Date)return vf(d);if(d instanceof Uint8Array)return mf(d);if(d instanceof oc)return Od(d);default:throw us(d,tu)}}function cc(d){if(/^[a-z*][a-z0-9\-_.*]*$/.test(d)===!1)throw us(d,lc);return d}function iu(d){return d==null?"":Object.entries(d).map(function(u){var l=u[0],n=u[1];return n===!0?";"+cc(l):";"+cc(l)+"="+uc(n)}).join("")}function Md(d){return d instanceof ac?""+uc(d.value)+iu(d.params):uc(d)}function Jo(d){return"("+d.value.map(Md).join(" ")+")"+iu(d.params)}function un(d,u){var l;if(u===void 0&&(u={whitespace:!0}),typeof d!="object")throw us(d,cf);var n=d instanceof Map?d.entries():Object.entries(d),s=(l=u)!=null&&l.whitespace?" ":"";return Array.from(n).map(function(a){var c=a[0],h=a[1];h instanceof ac||(h=new ac(h));var g=cc(c);return h.value===!0?g+=iu(h.params):(g+="=",Array.isArray(h.value)?g+=Jo(h):g+=Md(h)),g}).join(","+s)}function cn(d,u){return un(d,u)}var Xn=function(u){return u==="ot"||u==="sf"||u==="st"},Eo=function(u){return typeof u=="number"?Ct(u):u!=null&&u!==""&&u!==!1};function ru(d,u){var l=new URL(d),n=new URL(u);if(l.origin!==n.origin)return d;for(var s=l.pathname.split("/").slice(1),a=n.pathname.split("/").slice(1,-1);s[0]===a[0];)s.shift(),a.shift();for(;a.length;)a.shift(),s.unshift("..");return s.join("/")}function Nd(){try{return crypto.randomUUID()}catch{try{var d=URL.createObjectURL(new Blob),u=d.toString();return URL.revokeObjectURL(d),u.slice(u.lastIndexOf("/")+1)}catch{var l=new Date().getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var h=(l+Math.random()*16)%16|0;return l=Math.floor(l/16),(c=="x"?h:h&3|8).toString(16)});return n}}}var Zo=function(u){return Math.round(u)},Tf=function(u,l){return l!=null&&l.baseUrl&&(u=ru(u,l.baseUrl)),encodeURIComponent(u)},el=function(u){return Zo(u/100)*100},Fd={br:Zo,d:Zo,bl:el,dl:el,mtp:el,nor:Tf,rtp:el,tb:Zo};function Bd(d,u){var l={};if(d==null||typeof d!="object")return l;var n=Object.keys(d).sort(),s=Di({},Fd,u?.formatters),a=u?.filter;return n.forEach(function(c){if(!(a!=null&&a(c))){var h=d[c],g=s[c];g&&(h=g(h,u)),!(c==="v"&&h===1)&&(c=="pr"&&h===1||Eo(h)&&(Xn(c)&&typeof h=="string"&&(h=new oc(h)),l[c]=h))}}),l}function dc(d,u){return u===void 0&&(u={}),d?cn(Bd(d,u),Di({whitespace:!1},u)):""}function Ns(d,u){var l;if(u===void 0&&(u={}),!d)return{};var n=Object.entries(d),s=Object.entries(uf).concat(Object.entries(((l=u)==null?void 0:l.customHeaderMap)||{})),a=n.reduce(function(c,h){var g,m,S=h[0],x=h[1],U=((g=s.find(function(ne){return ne[1].includes(S)}))==null?void 0:g[0])||ja.REQUEST;return(m=c[U])!=null||(c[U]={}),c[U][S]=x,c},{});return Object.entries(a).reduce(function(c,h){var g=h[0],m=h[1];return c[g]=dc(m,u),c},{})}function Ef(d,u,l){return Di(d,Ns(u,l))}var Ur="CMCD";function _r(d,u){if(u===void 0&&(u={}),!d)return"";var l=dc(d,u);return Ur+"="+encodeURIComponent(l)}var Qr=/CMCD=[^&#]+/;function Ud(d,u,l){var n=_r(u,l);if(!n)return d;if(Qr.test(d))return d.replace(Qr,n);var s=d.includes("?")?"&":"?";return""+d+s+n}var Gd=function(){function d(l){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(c){try{n.apply(c,{ot:Br.MANIFEST,su:!n.initialized})}catch(h){Qe.warn("Could not generate manifest CMCD data.",h)}},this.applyFragmentData=function(c){try{var h=c.frag,g=n.hls.levels[h.level],m=n.getObjectType(h),S={d:h.duration*1e3,ot:m};(m===Br.VIDEO||m===Br.AUDIO||m==Br.MUXED)&&(S.br=g.bitrate/1e3,S.tb=n.getTopBandwidth(m)/1e3,S.bl=n.getBufferLength(m)),n.apply(c,S)}catch(x){Qe.warn("Could not generate segment CMCD data.",x)}},this.hls=l;var s=this.config=l.config,a=s.cmcd;a!=null&&(s.pLoader=this.createPlaylistLoader(),s.fLoader=this.createFragmentLoader(),this.sid=a.sessionId||Nd(),this.cid=a.contentId,this.useHeaders=a.useHeaders===!0,this.includeKeys=a.includeKeys,this.registerListeners())}var u=d.prototype;return u.registerListeners=function(){var n=this.hls;n.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(_e.MEDIA_DETACHED,this.onMediaDetached,this),n.on(_e.BUFFER_CREATED,this.onBufferCreated,this)},u.unregisterListeners=function(){var n=this.hls;n.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(_e.MEDIA_DETACHED,this.onMediaDetached,this),n.off(_e.BUFFER_CREATED,this.onBufferCreated,this)},u.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null},u.onMediaAttached=function(n,s){this.media=s.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},u.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},u.onBufferCreated=function(n,s){var a,c;this.audioBuffer=(a=s.tracks.audio)==null?void 0:a.buffer,this.videoBuffer=(c=s.tracks.video)==null?void 0:c.buffer},u.createData=function(){var n;return{v:1,sf:sc.HLS,sid:this.sid,cid:this.cid,pr:(n=this.media)==null?void 0:n.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},u.apply=function(n,s){s===void 0&&(s={}),Di(s,this.createData());var a=s.ot===Br.INIT||s.ot===Br.VIDEO||s.ot===Br.MUXED;this.starved&&a&&(s.bs=!0,s.su=!0,this.starved=!1),s.su==null&&(s.su=this.buffering);var c=this.includeKeys;c&&(s=Object.keys(s).reduce(function(h,g){return c.includes(g)&&(h[g]=s[g]),h},{})),this.useHeaders?(n.headers||(n.headers={}),Ef(n.headers,s)):n.url=Ud(n.url,s)},u.getObjectType=function(n){var s=n.type;if(s==="subtitle")return Br.TIMED_TEXT;if(n.sn==="initSegment")return Br.INIT;if(s==="audio")return Br.AUDIO;if(s==="main")return this.hls.audioTracks.length?Br.VIDEO:Br.MUXED},u.getTopBandwidth=function(n){var s=0,a,c=this.hls;if(n===Br.AUDIO)a=c.audioTracks;else{var h=c.maxAutoLevel,g=h>-1?h+1:c.levels.length;a=c.levels.slice(0,g)}for(var m=es(a),S;!(S=m()).done;){var x=S.value;x.bitrate>s&&(s=x.bitrate)}return s>0?s:NaN},u.getBufferLength=function(n){var s=this.hls.media,a=n===Br.AUDIO?this.audioBuffer:this.videoBuffer;if(!a||!s)return NaN;var c=Vt.bufferInfo(a,s.currentTime,this.config.maxBufferHole);return c.len*1e3},u.createPlaylistLoader=function(){var n=this.config.pLoader,s=this.applyPlaylistData,a=n||this.config.loader;return function(){function c(g){this.loader=void 0,this.loader=new a(g)}var h=c.prototype;return h.destroy=function(){this.loader.destroy()},h.abort=function(){this.loader.abort()},h.load=function(m,S,x){s(m),this.loader.load(m,S,x)},ki(c,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),c}()},u.createFragmentLoader=function(){var n=this.config.fLoader,s=this.applyFragmentData,a=n||this.config.loader;return function(){function c(g){this.loader=void 0,this.loader=new a(g)}var h=c.prototype;return h.destroy=function(){this.loader.destroy()},h.abort=function(){this.loader.abort()},h.load=function(m,S,x){s(m),this.loader.load(m,S,x)},ki(c,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),c}()},d}(),ir=3e5,Fs=function(){function d(l){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=l,this.log=Qe.log.bind(Qe,"[content-steering]:"),this.registerListeners()}var u=d.prototype;return u.registerListeners=function(){var n=this.hls;n.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.on(_e.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(_e.MANIFEST_PARSED,this.onManifestParsed,this),n.on(_e.ERROR,this.onError,this)},u.unregisterListeners=function(){var n=this.hls;n&&(n.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),n.off(_e.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(_e.MANIFEST_PARSED,this.onManifestParsed,this),n.off(_e.ERROR,this.onError,this))},u.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var n=this.timeToLoad*1e3-(performance.now()-this.updated);if(n>0){this.scheduleRefresh(this.uri,n);return}}this.loadSteeringManifest(this.uri)}},u.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},u.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},u.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},u.removeLevel=function(n){var s=this.levels;s&&(this.levels=s.filter(function(a){return a!==n}))},u.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},u.onManifestLoaded=function(n,s){var a=s.contentSteering;a!==null&&(this.pathwayId=a.pathwayId,this.uri=a.uri,this.started&&this.startLoad())},u.onManifestParsed=function(n,s){this.audioTracks=s.audioTracks,this.subtitleTracks=s.subtitleTracks},u.onError=function(n,s){var a=s.errorAction;if(a?.action===k.SendAlternateToPenaltyBox&&a.flags===L.MoveAllAlternatesMatchingHost){var c=this.levels,h=this.pathwayPriority,g=this.pathwayId;if(s.context){var m=s.context,S=m.groupId,x=m.pathwayId,U=m.type;S&&c?g=this.getPathwayForGroupId(S,U,g):x&&(g=x)}g in this.penalizedPathways||(this.penalizedPathways[g]=performance.now()),!h&&c&&(h=c.reduce(function(ne,ue){return ne.indexOf(ue.pathwayId)===-1&&ne.push(ue.pathwayId),ne},[])),h&&h.length>1&&(this.updatePathwayPriority(h),a.resolved=this.pathwayId!==g),a.resolved||Qe.warn("Could not resolve "+s.details+' ("'+s.error.message+'") with content-steering for Pathway: '+g+" levels: "+(c&&c.length)+" priorities: "+JSON.stringify(h)+" penalized: "+JSON.stringify(this.penalizedPathways))}},u.filterParsedLevels=function(n){this.levels=n;var s=this.getLevelsForPathway(this.pathwayId);if(s.length===0){var a=n[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+a+'"'),s=this.getLevelsForPathway(a),this.pathwayId=a}return s.length!==n.length&&this.log("Found "+s.length+"/"+n.length+' levels in Pathway "'+this.pathwayId+'"'),s},u.getLevelsForPathway=function(n){return this.levels===null?[]:this.levels.filter(function(s){return n===s.pathwayId})},u.updatePathwayPriority=function(n){this.pathwayPriority=n;var s,a=this.penalizedPathways,c=performance.now();Object.keys(a).forEach(function(U){c-a[U]>ir&&delete a[U]});for(var h=0;h<n.length;h++){var g=n[h];if(!(g in a)){if(g===this.pathwayId)return;var m=this.hls.nextLoadLevel,S=this.hls.levels[m];if(s=this.getLevelsForPathway(g),s.length>0){this.log('Setting Pathway to "'+g+'"'),this.pathwayId=g,se(s),this.hls.trigger(_e.LEVELS_UPDATED,{levels:s});var x=this.hls.levels[m];S&&x&&this.levels&&(x.attrs["STABLE-VARIANT-ID"]!==S.attrs["STABLE-VARIANT-ID"]&&x.bitrate!==S.bitrate&&this.log("Unstable Pathways change from bitrate "+S.bitrate+" to "+x.bitrate),this.hls.nextLoadLevel=m);break}}}},u.getPathwayForGroupId=function(n,s,a){for(var c=this.getLevelsForPathway(a).concat(this.levels||[]),h=0;h<c.length;h++)if(s===Jt.AUDIO_TRACK&&c[h].hasAudioGroup(n)||s===Jt.SUBTITLE_TRACK&&c[h].hasSubtitleGroup(n))return c[h].pathwayId;return a},u.clonePathways=function(n){var s=this,a=this.levels;if(a){var c={},h={};n.forEach(function(g){var m=g.ID,S=g["BASE-ID"],x=g["URI-REPLACEMENT"];if(!a.some(function(ne){return ne.pathwayId===m})){var U=s.getLevelsForPathway(S).map(function(ne){var ue=new Ti(ne.attrs);ue["PATHWAY-ID"]=m;var ge=ue.AUDIO&&ue.AUDIO+"_clone_"+m,ye=ue.SUBTITLES&&ue.SUBTITLES+"_clone_"+m;ge&&(c[ue.AUDIO]=ge,ue.AUDIO=ge),ye&&(h[ue.SUBTITLES]=ye,ue.SUBTITLES=ye);var Se=nu(ne.uri,ue["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",x),xe=new j({attrs:ue,audioCodec:ne.audioCodec,bitrate:ne.bitrate,height:ne.height,name:ne.name,url:Se,videoCodec:ne.videoCodec,width:ne.width});if(ne.audioGroups)for(var De=1;De<ne.audioGroups.length;De++)xe.addGroupId("audio",ne.audioGroups[De]+"_clone_"+m);if(ne.subtitleGroups)for(var Fe=1;Fe<ne.subtitleGroups.length;Fe++)xe.addGroupId("text",ne.subtitleGroups[Fe]+"_clone_"+m);return xe});a.push.apply(a,U),qa(s.audioTracks,c,x,m),qa(s.subtitleTracks,h,x,m)}})}},u.loadSteeringManifest=function(n){var s=this,a=this.hls.config,c=a.loader;this.loader&&this.loader.destroy(),this.loader=new c(a);var h;try{h=new self.URL(n)}catch{this.enabled=!1,this.log("Failed to parse Steering Manifest URI: "+n);return}if(h.protocol!=="data:"){var g=(this.hls.bandwidthEstimate||a.abrEwmaDefaultEstimate)|0;h.searchParams.set("_HLS_pathway",this.pathwayId),h.searchParams.set("_HLS_throughput",""+g)}var m={responseType:"json",url:h.href},S=a.steeringManifestLoadPolicy.default,x=S.errorRetry||S.timeoutRetry||{},U={loadPolicy:S,timeout:S.maxLoadTimeMs,maxRetry:x.maxNumRetry||0,retryDelay:x.retryDelayMs||0,maxRetryDelay:x.maxRetryDelayMs||0},ne={onSuccess:function(ge,ye,Se,xe){s.log('Loaded steering manifest: "'+h+'"');var De=ge.data;if(De.VERSION!==1){s.log("Steering VERSION "+De.VERSION+" not supported!");return}s.updated=performance.now(),s.timeToLoad=De.TTL;var Fe=De["RELOAD-URI"],He=De["PATHWAY-CLONES"],rt=De["PATHWAY-PRIORITY"];if(Fe)try{s.uri=new self.URL(Fe,h).href}catch{s.enabled=!1,s.log("Failed to parse Steering Manifest RELOAD-URI: "+Fe);return}s.scheduleRefresh(s.uri||Se.url),He&&s.clonePathways(He);var ze={steeringManifest:De,url:h.toString()};s.hls.trigger(_e.STEERING_MANIFEST_LOADED,ze),rt&&s.updatePathwayPriority(rt)},onError:function(ge,ye,Se,xe){if(s.log("Error loading steering manifest: "+ge.code+" "+ge.text+" ("+ye.url+")"),s.stopLoad(),ge.code===410){s.enabled=!1,s.log("Steering manifest "+ye.url+" no longer available");return}var De=s.timeToLoad*1e3;if(ge.code===429){var Fe=s.loader;if(typeof Fe?.getResponseHeader=="function"){var He=Fe.getResponseHeader("Retry-After");He&&(De=parseFloat(He)*1e3)}s.log("Steering manifest "+ye.url+" rate limited");return}s.scheduleRefresh(s.uri||ye.url,De)},onTimeout:function(ge,ye,Se){s.log("Timeout loading steering manifest ("+ye.url+")"),s.scheduleRefresh(s.uri||ye.url)}};this.log("Requesting steering manifest: "+h),this.loader.load(m,U,ne)},u.scheduleRefresh=function(n,s){var a=this;s===void 0&&(s=this.timeToLoad*1e3),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var c,h=(c=a.hls)==null?void 0:c.media;if(h&&!h.ended){a.loadSteeringManifest(n);return}a.scheduleRefresh(n,a.timeToLoad*1e3)},s)},d}();function qa(d,u,l,n){d&&Object.keys(u).forEach(function(s){var a=d.filter(function(c){return c.groupId===s}).map(function(c){var h=Di({},c);return h.details=void 0,h.attrs=new Ti(h.attrs),h.url=h.attrs.URI=nu(c.url,c.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",l),h.groupId=h.attrs["GROUP-ID"]=u[s],h.attrs["PATHWAY-ID"]=n,h});d.push.apply(d,a)})}function nu(d,u,l,n){var s=n.HOST,a=n.PARAMS,c=n[l],h;u&&(h=c?.[u],h&&(d=h));var g=new self.URL(d);return s&&!h&&(g.host=s),a&&Object.keys(a).sort().forEach(function(m){m&&g.searchParams.set(m,a[m])}),g.href}var su=/^age:\s*[\d.]+\s*$/im,hc=function(){function d(l){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=l&&l.xhrSetup||null,this.stats=new ps,this.retryDelay=0}var u=d.prototype;return u.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},u.abortInternal=function(){var n=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),n&&(n.onreadystatechange=null,n.onprogress=null,n.readyState!==4&&(this.stats.aborted=!0,n.abort()))},u.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!=null&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},u.load=function(n,s,a){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=n,this.config=s,this.callbacks=a,this.loadInternal()},u.loadInternal=function(){var n=this,s=this.config,a=this.context;if(!(!s||!a)){var c=this.loader=new self.XMLHttpRequest,h=this.stats;h.loading.first=0,h.loaded=0,h.aborted=!1;var g=this.xhrSetup;g?Promise.resolve().then(function(){if(!(n.loader!==c||n.stats.aborted))return g(c,a.url)}).catch(function(m){if(!(n.loader!==c||n.stats.aborted))return c.open("GET",a.url,!0),g(c,a.url)}).then(function(){n.loader!==c||n.stats.aborted||n.openAndSendXhr(c,a,s)}).catch(function(m){n.callbacks.onError({code:c.status,text:m.message},a,c,h)}):this.openAndSendXhr(c,a,s)}},u.openAndSendXhr=function(n,s,a){n.readyState||n.open("GET",s.url,!0);var c=s.headers,h=a.loadPolicy,g=h.maxTimeToFirstByteMs,m=h.maxLoadTimeMs;if(c)for(var S in c)n.setRequestHeader(S,c[S]);s.rangeEnd&&n.setRequestHeader("Range","bytes="+s.rangeStart+"-"+(s.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=s.responseType,self.clearTimeout(this.requestTimeout),a.timeout=g&&Ct(g)?g:m,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout),n.send()},u.readystatechange=function(){var n=this.context,s=this.loader,a=this.stats;if(!(!n||!s)){var c=s.readyState,h=this.config;if(!a.aborted&&c>=2&&(a.loading.first===0&&(a.loading.first=Math.max(self.performance.now(),a.loading.start),h.timeout!==h.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),h.timeout=h.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),h.loadPolicy.maxLoadTimeMs-(a.loading.first-a.loading.start)))),c===4)){self.clearTimeout(this.requestTimeout),s.onreadystatechange=null,s.onprogress=null;var g=s.status,m=s.responseType!=="text";if(g>=200&&g<300&&(m&&s.response||s.responseText!==null)){a.loading.end=Math.max(self.performance.now(),a.loading.first);var S=m?s.response:s.responseText,x=s.responseType==="arraybuffer"?S.byteLength:S.length;if(a.loaded=a.total=x,a.bwEstimate=a.total*8e3/(a.loading.end-a.loading.first),!this.callbacks)return;var U=this.callbacks.onProgress;if(U&&U(a,n,S,s),!this.callbacks)return;var ne={url:s.responseURL,data:S,code:g};this.callbacks.onSuccess(ne,a,n,s)}else{var ue=h.loadPolicy.errorRetry,ge=a.retry,ye={url:n.url,data:void 0,code:g};I(ue,ge,!1,ye)?this.retry(ue):(Qe.error(g+" while loading "+n.url),this.callbacks.onError({code:g,text:s.statusText},n,s,a))}}}},u.loadtimeout=function(){if(this.config){var n=this.config.loadPolicy.timeoutRetry,s=this.stats.retry;if(I(n,s,!0))this.retry(n);else{var a;Qe.warn("timeout while loading "+((a=this.context)==null?void 0:a.url));var c=this.callbacks;c&&(this.abortInternal(),c.onTimeout(this.stats,this.context,this.loader))}}},u.retry=function(n){var s=this.context,a=this.stats;this.retryDelay=M(n,a.retry),a.retry++,Qe.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+s?.url+", retrying "+a.retry+"/"+n.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},u.loadprogress=function(n){var s=this.stats;s.loaded=n.loaded,n.lengthComputable&&(s.total=n.total)},u.getCacheAge=function(){var n=null;if(this.loader&&su.test(this.loader.getAllResponseHeaders())){var s=this.loader.getResponseHeader("age");n=s?parseFloat(s):null}return n},u.getResponseHeader=function(n){return this.loader&&new RegExp("^"+n+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(n):null},d}();function Vd(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Hd=/(\d+)-(\d+)\/(\d+)/,fc=function(){function d(l){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=l.fetchSetup||il,this.controller=new self.AbortController,this.stats=new ps}var u=d.prototype;return u.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},u.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},u.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!=null&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},u.load=function(n,s,a){var c=this,h=this.stats;if(h.loading.start)throw new Error("Loader can only be used once.");h.loading.start=self.performance.now();var g=di(n,this.controller.signal),m=a.onProgress,S=n.responseType==="arraybuffer",x=S?"byteLength":"length",U=s.loadPolicy,ne=U.maxTimeToFirstByteMs,ue=U.maxLoadTimeMs;this.context=n,this.config=s,this.callbacks=a,this.request=this.fetchSetup(n,g),self.clearTimeout(this.requestTimeout),s.timeout=ne&&Ct(ne)?ne:ue,this.requestTimeout=self.setTimeout(function(){c.abortInternal(),a.onTimeout(h,n,c.response)},s.timeout),self.fetch(this.request).then(function(ge){c.response=c.loader=ge;var ye=Math.max(self.performance.now(),h.loading.start);if(self.clearTimeout(c.requestTimeout),s.timeout=ue,c.requestTimeout=self.setTimeout(function(){c.abortInternal(),a.onTimeout(h,n,c.response)},ue-(ye-h.loading.start)),!ge.ok){var Se=ge.status,xe=ge.statusText;throw new _f(xe||"fetch, bad network response",Se,ge)}return h.loading.first=ye,h.total=tl(ge.headers)||h.total,m&&Ct(s.highWaterMark)?c.loadProgressively(ge,h,n,s.highWaterMark,m):S?ge.arrayBuffer():n.responseType==="json"?ge.json():ge.text()}).then(function(ge){var ye=c.response;if(!ye)throw new Error("loader destroyed");self.clearTimeout(c.requestTimeout),h.loading.end=Math.max(self.performance.now(),h.loading.first);var Se=ge[x];Se&&(h.loaded=h.total=Se);var xe={url:ye.url,data:ge,code:ye.status};m&&!Ct(s.highWaterMark)&&m(h,n,ge,ye),a.onSuccess(xe,h,n,ye)}).catch(function(ge){if(self.clearTimeout(c.requestTimeout),!h.aborted){var ye=ge&&ge.code||0,Se=ge?ge.message:null;a.onError({code:ye,text:Se},n,ge?ge.details:null,h)}})},u.getCacheAge=function(){var n=null;if(this.response){var s=this.response.headers.get("age");n=s?parseFloat(s):null}return n},u.getResponseHeader=function(n){return this.response?this.response.headers.get(n):null},u.loadProgressively=function(n,s,a,c,h){c===void 0&&(c=0);var g=new Nr,m=n.body.getReader(),S=function x(){return m.read().then(function(U){if(U.done)return g.dataLength&&h(s,a,g.flush(),n),Promise.resolve(new ArrayBuffer(0));var ne=U.value,ue=ne.length;return s.loaded+=ue,ue<c||g.dataLength?(g.push(ne),g.dataLength>=c&&h(s,a,g.flush(),n)):h(s,a,ne,n),x()}).catch(function(){return Promise.reject()})};return S()},d}();function di(d,u){var l={method:"GET",mode:"cors",credentials:"same-origin",signal:u,headers:new self.Headers(Di({},d.headers))};return d.rangeEnd&&l.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),l}function jd(d){var u=Hd.exec(d);if(u)return parseInt(u[2])-parseInt(u[1])+1}function tl(d){var u=d.get("Content-Range");if(u){var l=jd(u);if(Ct(l))return l}var n=d.get("Content-Length");if(n)return parseInt(n)}function il(d,u){return new self.Request(d.url,u)}var _f=function(d){Bt(u,d);function u(l,n,s){var a;return a=d.call(this,l)||this,a.code=void 0,a.details=void 0,a.code=n,a.details=s,a}return u}(js(Error)),Kd=/\s/,pc={newCue:function(u,l,n,s){for(var a=[],c,h,g,m,S,x=self.VTTCue||self.TextTrackCue,U=0;U<s.rows.length;U++)if(c=s.rows[U],g=!0,m=0,S="",!c.isEmpty()){for(var ne,ue=0;ue<c.chars.length;ue++)Kd.test(c.chars[ue].uchar)&&g?m++:(S+=c.chars[ue].uchar,g=!1);c.cueStartTime=l,l===n&&(n+=1e-4),m>=16?m--:m++;var ge=Xr(S.trim()),ye=Xl(l,n,ge);u!=null&&(ne=u.cues)!=null&&ne.getCueById(ye)||(h=new x(l,n,ge),h.id=ye,h.line=U+1,h.align="left",h.position=10+Math.min(80,Math.floor(m*8/32)*10),a.push(h))}return u&&a.length&&(a.sort(function(Se,xe){return Se.line==="auto"||xe.line==="auto"?0:Se.line>8&&xe.line>8?xe.line-Se.line:Se.line-xe.line}),a.forEach(function(Se){return Ra(u,Se)})),a}},qd={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},$d=Ii(Ii({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:hc,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:nt,bufferController:Yh,capLevelController:lf,errorController:R,fpsController:To,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:wn,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:qd},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},bf()),{},{subtitleStreamController:gd,subtitleTrackController:md,timelineController:Dd,audioStreamController:pd,audioTrackController:zu,emeController:eu,cmcdController:Gd,contentSteeringController:Fs});function bf(){return{cueHandler:pc,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Bs(d,u){if((u.liveSyncDurationCount||u.liveMaxLatencyDurationCount)&&(u.liveSyncDuration||u.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(u.liveMaxLatencyDurationCount!==void 0&&(u.liveSyncDurationCount===void 0||u.liveMaxLatencyDurationCount<=u.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(u.liveMaxLatencyDuration!==void 0&&(u.liveSyncDuration===void 0||u.liveMaxLatencyDuration<=u.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var l=Mn(d),n=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(function(a){var c=(a==="level"?"playlist":a)+"LoadPolicy",h=u[c]===void 0,g=[];s.forEach(function(m){var S=a+"Loading"+m,x=u[S];if(x!==void 0&&h){g.push(S);var U=l[c].default;switch(u[c]={default:U},m){case"TimeOut":U.maxLoadTimeMs=x,U.maxTimeToFirstByteMs=x;break;case"MaxRetry":U.errorRetry.maxNumRetry=x,U.timeoutRetry.maxNumRetry=x;break;case"RetryDelay":U.errorRetry.retryDelayMs=x,U.timeoutRetry.retryDelayMs=x;break;case"MaxRetryTimeout":U.errorRetry.maxRetryDelayMs=x,U.timeoutRetry.maxRetryDelayMs=x;break}}}),g.length&&Qe.warn('hls.js config: "'+g.join('", "')+'" setting(s) are deprecated, use "'+c+'": '+JSON.stringify(u[c]))}),Ii(Ii({},l),u)}function Mn(d){return d&&typeof d=="object"?Array.isArray(d)?d.map(Mn):Object.keys(d).reduce(function(u,l){return u[l]=Mn(d[l]),u},{}):d}function gc(d){var u=d.loader;if(u!==fc&&u!==hc)Qe.log("[config]: Custom loader detected, cannot enable progressive streaming"),d.progressive=!1;else{var l=Vd();l&&(d.loader=fc,d.progressive=!0,d.enableSoftwareAES=!0,Qe.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var au,Wd=function(d){Bt(u,d);function u(n,s){var a;return a=d.call(this,n,"[level-controller]")||this,a._levels=[],a._firstLevel=-1,a._maxAutoLevel=-1,a._startLevel=void 0,a.currentLevel=null,a.currentLevelIndex=-1,a.manualLevelIndex=-1,a.steering=void 0,a.onParsedComplete=void 0,a.steering=s,a._registerListeners(),a}var l=u.prototype;return l._registerListeners=function(){var s=this.hls;s.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.on(_e.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.on(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(_e.FRAG_BUFFERED,this.onFragBuffered,this),s.on(_e.ERROR,this.onError,this)},l._unregisterListeners=function(){var s=this.hls;s.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.off(_e.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.off(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(_e.FRAG_BUFFERED,this.onFragBuffered,this),s.off(_e.ERROR,this.onError,this)},l.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),d.prototype.destroy.call(this)},l.stopLoad=function(){var s=this._levels;s.forEach(function(a){a.loadError=0,a.fragmentError=0}),d.prototype.stopLoad.call(this)},l.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},l.onManifestLoading=function(s,a){this.resetLevels()},l.onManifestLoaded=function(s,a){var c=this.hls.config.preferManagedMediaSource,h=[],g={},m={},S=!1,x=!1,U=!1;a.levels.forEach(function(ne){var ue,ge,ye=ne.attrs,Se=ne.audioCodec,xe=ne.videoCodec;((ue=Se)==null?void 0:ue.indexOf("mp4a.40.34"))!==-1&&(au||(au=/chrome|firefox/i.test(navigator.userAgent)),au&&(ne.audioCodec=Se=void 0)),Se&&(ne.audioCodec=Se=ia(Se,c)),((ge=xe)==null?void 0:ge.indexOf("avc1"))===0&&(xe=ne.videoCodec=Ji(xe));var De=ne.width,Fe=ne.height,He=ne.unknownCodecs;if(S||(S=!!(De&&Fe)),x||(x=!!xe),U||(U=!!Se),!(He!=null&&He.length||Se&&!ea(Se,"audio",c)||xe&&!ea(xe,"video",c))){var rt=ye.CODECS,ze=ye["FRAME-RATE"],Ve=ye["HDCP-LEVEL"],Ze=ye["PATHWAY-ID"],et=ye.RESOLUTION,ot=ye["VIDEO-RANGE"],ct=(Ze||".")+"-",yt=""+ct+ne.bitrate+"-"+et+"-"+ze+"-"+rt+"-"+ot+"-"+Ve;if(g[yt])if(g[yt].uri!==ne.url&&!ne.attrs["PATHWAY-ID"]){var It=m[yt]+=1;ne.attrs["PATHWAY-ID"]=new Array(It+1).join(".");var Ht=new j(ne);g[yt]=Ht,h.push(Ht)}else g[yt].addGroupId("audio",ye.AUDIO),g[yt].addGroupId("text",ye.SUBTITLES);else{var wt=new j(ne);g[yt]=wt,m[yt]=1,h.push(wt)}}}),this.filterAndSortMediaOptions(h,a,S,x,U)},l.filterAndSortMediaOptions=function(s,a,c,h,g){var m=this,S=[],x=[],U=s;if((c||h)&&g&&(U=U.filter(function(Ve){var Ze=Ve.videoCodec,et=Ve.videoRange,ot=Ve.width,ct=Ve.height;return(!!Ze||!!(ot&&ct))&&wu(et)})),U.length===0){Promise.resolve().then(function(){if(m.hls){a.levels.length&&m.warn("One or more CODECS in variant not supported: "+JSON.stringify(a.levels[0].attrs));var Ve=new Error("no level with compatible codecs found in manifest");m.hls.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,error:Ve,reason:Ve.message})}});return}if(a.audioTracks){var ne=this.hls.config.preferManagedMediaSource;S=a.audioTracks.filter(function(Ve){return!Ve.audioCodec||ea(Ve.audioCodec,"audio",ne)}),zd(S)}a.subtitles&&(x=a.subtitles,zd(x));var ue=U.slice(0);U.sort(function(Ve,Ze){if(Ve.attrs["HDCP-LEVEL"]!==Ze.attrs["HDCP-LEVEL"])return(Ve.attrs["HDCP-LEVEL"]||"")>(Ze.attrs["HDCP-LEVEL"]||"")?1:-1;if(c&&Ve.height!==Ze.height)return Ve.height-Ze.height;if(Ve.frameRate!==Ze.frameRate)return Ve.frameRate-Ze.frameRate;if(Ve.videoRange!==Ze.videoRange)return Pa.indexOf(Ve.videoRange)-Pa.indexOf(Ze.videoRange);if(Ve.videoCodec!==Ze.videoCodec){var et=Da(Ve.videoCodec),ot=Da(Ze.videoCodec);if(et!==ot)return ot-et}if(Ve.uri===Ze.uri&&Ve.codecSet!==Ze.codecSet){var ct=wa(Ve.codecSet),yt=wa(Ze.codecSet);if(ct!==yt)return yt-ct}return Ve.averageBitrate!==Ze.averageBitrate?Ve.averageBitrate-Ze.averageBitrate:0});var ge=ue[0];if(this.steering&&(U=this.steering.filterParsedLevels(U),U.length!==ue.length)){for(var ye=0;ye<ue.length;ye++)if(ue[ye].pathwayId===U[0].pathwayId){ge=ue[ye];break}}this._levels=U;for(var Se=0;Se<U.length;Se++)if(U[Se]===ge){var xe;this._firstLevel=Se;var De=ge.bitrate,Fe=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+U.length+" level(s) found, first bitrate: "+De),((xe=this.hls.userConfig)==null?void 0:xe.abrEwmaDefaultEstimate)===void 0){var He=Math.min(De,this.hls.config.abrEwmaDefaultEstimateMax);He>Fe&&Fe===$d.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=He)}break}var rt=g&&!h,ze={levels:U,audioTracks:S,subtitleTracks:x,sessionData:a.sessionData,sessionKeys:a.sessionKeys,firstLevel:this._firstLevel,stats:a.stats,audio:g,video:h,altAudio:!rt&&S.some(function(Ve){return!!Ve.url})};this.hls.trigger(_e.MANIFEST_PARSED,ze),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)},l.onError=function(s,a){a.fatal||!a.context||a.context.type===Jt.LEVEL&&a.context.level===this.level&&this.checkRetry(a)},l.onFragBuffered=function(s,a){var c=a.frag;if(c!==void 0&&c.type===Nt.MAIN){var h=c.elementaryStreams;if(!Object.keys(h).some(function(m){return!!h[m]}))return;var g=this._levels[c.level];g!=null&&g.loadError&&(this.log("Resetting level error count of "+g.loadError+" on frag buffered"),g.loadError=0)}},l.onLevelLoaded=function(s,a){var c,h=a.level,g=a.details,m=this._levels[h];if(!m){var S;this.warn("Invalid level index "+h),(S=a.deliveryDirectives)!=null&&S.skip&&(g.deltaUpdateFailed=!0);return}h===this.currentLevelIndex?(m.fragmentError===0&&(m.loadError=0),this.playlistLoaded(h,a,m.details)):(c=a.deliveryDirectives)!=null&&c.skip&&(g.deltaUpdateFailed=!0)},l.loadPlaylist=function(s){d.prototype.loadPlaylist.call(this);var a=this.currentLevelIndex,c=this.currentLevel;if(c&&this.shouldLoadPlaylist(c)){var h=c.uri;if(s)try{h=s.addDirectives(h)}catch(m){this.warn("Could not construct new URL with HLS Delivery Directives: "+m)}var g=c.attrs["PATHWAY-ID"];this.log("Loading level index "+a+(s?.msn!==void 0?" at sn "+s.msn+" part "+s.part:"")+" with"+(g?" Pathway "+g:"")+" "+h),this.clearTimer(),this.hls.trigger(_e.LEVEL_LOADING,{url:h,level:a,pathwayId:c.attrs["PATHWAY-ID"],id:0,deliveryDirectives:s||null})}},l.removeLevel=function(s){var a=this,c,h=this._levels.filter(function(g,m){return m!==s?!0:(a.steering&&a.steering.removeLevel(g),g===a.currentLevel&&(a.currentLevel=null,a.currentLevelIndex=-1,g.details&&g.details.fragments.forEach(function(S){return S.level=-1})),!1)});se(h),this._levels=h,this.currentLevelIndex>-1&&(c=this.currentLevel)!=null&&c.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(_e.LEVELS_UPDATED,{levels:h})},l.onLevelsUpdated=function(s,a){var c=a.levels;this._levels=c},l.checkMaxAutoUpdated=function(){var s=this.hls,a=s.autoLevelCapping,c=s.maxAutoLevel,h=s.maxHdcpLevel;this._maxAutoLevel!==c&&(this._maxAutoLevel=c,this.hls.trigger(_e.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:a,levels:this.levels,maxAutoLevel:c,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:h}))},ki(u,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var a=this._levels;if(a.length!==0){if(s<0||s>=a.length){var c=new Error("invalid level idx"),h=s<0;if(this.hls.trigger(_e.ERROR,{type:Pt.OTHER_ERROR,details:je.LEVEL_SWITCH_ERROR,level:s,fatal:h,error:c,reason:c.message}),h)return;s=Math.min(s,a.length-1)}var g=this.currentLevelIndex,m=this.currentLevel,S=m?m.attrs["PATHWAY-ID"]:void 0,x=a[s],U=x.attrs["PATHWAY-ID"];if(this.currentLevelIndex=s,this.currentLevel=x,!(g===s&&x.details&&m&&S===U)){this.log("Switching to level "+s+" ("+(x.height?x.height+"p ":"")+(x.videoRange?x.videoRange+" ":"")+(x.codecSet?x.codecSet+" ":"")+"@"+x.bitrate+")"+(U?" with Pathway "+U:"")+" from level "+g+(S?" with Pathway "+S:""));var ne={level:s,attrs:x.attrs,details:x.details,bitrate:x.bitrate,averageBitrate:x.averageBitrate,maxBitrate:x.maxBitrate,realBitrate:x.realBitrate,width:x.width,height:x.height,codecSet:x.codecSet,audioCodec:x.audioCodec,videoCodec:x.videoCodec,audioGroups:x.audioGroups,subtitleGroups:x.subtitleGroups,loaded:x.loaded,loadError:x.loadError,fragmentError:x.fragmentError,name:x.name,id:x.id,uri:x.uri,url:x.url,urlId:0,audioGroupIds:x.audioGroupIds,textGroupIds:x.textGroupIds};this.hls.trigger(_e.LEVEL_SWITCHING,ne);var ue=x.details;if(!ue||ue.live){var ge=this.switchParams(x.uri,m?.details,ue);this.loadPlaylist(ge)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this.hls.firstAutoLevel}return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}]),u}(Z);function zd(d){var u={};d.forEach(function(l){var n=l.groupId||"";l.id=u[n]=u[n]||0,u[n]++})}var Af=function(){function d(l){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=l}var u=d.prototype;return u.abort=function(n){for(var s in this.keyUriToKeyInfo){var a=this.keyUriToKeyInfo[s].loader;if(a){var c;if(n&&n!==((c=a.context)==null?void 0:c.frag.type))return;a.abort()}}},u.detach=function(){for(var n in this.keyUriToKeyInfo){var s=this.keyUriToKeyInfo[n];(s.mediaKeySessionContext||s.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[n]}},u.destroy=function(){this.detach();for(var n in this.keyUriToKeyInfo){var s=this.keyUriToKeyInfo[n].loader;s&&s.destroy()}this.keyUriToKeyInfo={}},u.createKeyLoadError=function(n,s,a,c,h){return s===void 0&&(s=je.KEY_LOAD_ERROR),new zr({type:Pt.NETWORK_ERROR,details:s,fatal:!1,frag:n,response:h,error:a,networkDetails:c})},u.loadClear=function(n,s){var a=this;if(this.emeController&&this.config.emeEnabled)for(var c=n.sn,h=n.cc,g=function(){var x=s[m];if(h<=x.cc&&(c==="initSegment"||x.sn==="initSegment"||c<x.sn))return a.emeController.selectKeySystemFormat(x).then(function(U){x.setKeyFormat(U)}),1},m=0;m<s.length&&!g();m++);},u.load=function(n){var s=this;return!n.decryptdata&&n.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(n).then(function(a){return s.loadInternal(n,a)}):this.loadInternal(n)},u.loadInternal=function(n,s){var a,c;s&&n.setKeyFormat(s);var h=n.decryptdata;if(!h){var g=new Error(s?"Expected frag.decryptdata to be defined after setting format "+s:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(n,je.KEY_LOAD_ERROR,g))}var m=h.uri;if(!m)return Promise.reject(this.createKeyLoadError(n,je.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+m+'"')));var S=this.keyUriToKeyInfo[m];if((a=S)!=null&&a.decryptdata.key)return h.key=S.decryptdata.key,Promise.resolve({frag:n,keyInfo:S});if((c=S)!=null&&c.keyLoadPromise){var x;switch((x=S.mediaKeySessionContext)==null?void 0:x.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return S.keyLoadPromise.then(function(U){return h.key=U.keyInfo.decryptdata.key,{frag:n,keyInfo:S}})}}switch(S=this.keyUriToKeyInfo[m]={decryptdata:h,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},h.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return h.keyFormat==="identity"?this.loadKeyHTTP(S,n):this.loadKeyEME(S,n);case"AES-128":return this.loadKeyHTTP(S,n);default:return Promise.reject(this.createKeyLoadError(n,je.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+h.method+'"')))}},u.loadKeyEME=function(n,s){var a={frag:s,keyInfo:n};if(this.emeController&&this.config.emeEnabled){var c=this.emeController.loadKey(a);if(c)return(n.keyLoadPromise=c.then(function(h){return n.mediaKeySessionContext=h,a})).catch(function(h){throw n.keyLoadPromise=null,h})}return Promise.resolve(a)},u.loadKeyHTTP=function(n,s){var a=this,c=this.config,h=c.loader,g=new h(c);return s.keyLoader=n.loader=g,n.keyLoadPromise=new Promise(function(m,S){var x={keyInfo:n,frag:s,responseType:"arraybuffer",url:n.decryptdata.uri},U=c.keyLoadPolicy.default,ne={loadPolicy:U,timeout:U.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},ue={onSuccess:function(ye,Se,xe,De){var Fe=xe.frag,He=xe.keyInfo,rt=xe.url;if(!Fe.decryptdata||He!==a.keyUriToKeyInfo[rt])return S(a.createKeyLoadError(Fe,je.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),De));He.decryptdata.key=Fe.decryptdata.key=new Uint8Array(ye.data),Fe.keyLoader=null,He.loader=null,m({frag:Fe,keyInfo:He})},onError:function(ye,Se,xe,De){a.resetLoader(Se),S(a.createKeyLoadError(s,je.KEY_LOAD_ERROR,new Error("HTTP Error "+ye.code+" loading key "+ye.text),xe,Ii({url:x.url,data:void 0},ye)))},onTimeout:function(ye,Se,xe){a.resetLoader(Se),S(a.createKeyLoadError(s,je.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),xe))},onAbort:function(ye,Se,xe){a.resetLoader(Se),S(a.createKeyLoadError(s,je.INTERNAL_ABORTED,new Error("key loading aborted"),xe))}};g.load(x,ne,ue)})},u.resetLoader=function(n){var s=n.frag,a=n.keyInfo,c=n.url,h=a.loader;s.keyLoader===h&&(s.keyLoader=null,a.loader=null),delete this.keyUriToKeyInfo[c],h&&h.destroy()},d}();function mc(){return self.SourceBuffer||self.WebKitSourceBuffer}function rl(){var d=Tt();if(!d)return!1;var u=mc();return!u||u.prototype&&typeof u.prototype.appendBuffer=="function"&&typeof u.prototype.remove=="function"}function Sf(){if(!rl())return!1;var d=Tt();return typeof d?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(u){return d.isTypeSupported(Ss(u,"video"))})||["mp4a.40.2","fLaC"].some(function(u){return d.isTypeSupported(Ss(u,"audio"))}))}function $a(){var d,u=mc();return typeof(u==null||(d=u.prototype)==null?void 0:d.changeType)=="function"}var ou=250,ha=2,vc=.1,yc=.05,Tc=function(){function d(l,n,s,a){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=l,this.media=n,this.fragmentTracker=s,this.hls=a}var u=d.prototype;return u.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},u.poll=function(n,s){var a=this.config,c=this.media,h=this.stalled;if(c!==null){var g=c.currentTime,m=c.seeking,S=this.seeking&&!m,x=!this.seeking&&m;if(this.seeking=m,g!==n){if(this.moved=!0,m||(this.nudgeRetry=0),h!==null){if(this.stallReported){var U=self.performance.now()-h;Qe.warn("playback not stuck anymore @"+g+", after "+Math.round(U)+"ms"),this.stallReported=!1}this.stalled=null}return}if(x||S){this.stalled=null;return}if(c.paused&&!m||c.ended||c.playbackRate===0||!Vt.getBuffered(c).length){this.nudgeRetry=0;return}var ne=Vt.bufferInfo(c,g,0),ue=ne.nextStart||0;if(m){var ge=ne.len>ha,ye=!ue||s&&s.start<=g||ue-g>ha&&!this.fragmentTracker.getPartialFragment(g);if(ge||ye)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var Se,xe=ne.len>0;if(!xe&&!ue)return;var De=Math.max(ue,ne.start||0)-g,Fe=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,He=Fe==null||(Se=Fe.details)==null?void 0:Se.live,rt=He?Fe.details.targetduration*2:ha,ze=this.fragmentTracker.getPartialFragment(g);if(De>0&&(De<=rt||ze)){c.paused||this._trySkipBufferHole(ze);return}}var Ve=self.performance.now();if(h===null){this.stalled=Ve;return}var Ze=Ve-h;if(!(!m&&Ze>=ou&&(this._reportStall(ne),!this.media))){var et=Vt.bufferInfo(c,g,a.maxBufferHole);this._tryFixBufferStall(et,Ze)}}},u._tryFixBufferStall=function(n,s){var a=this.config,c=this.fragmentTracker,h=this.media;if(h!==null){var g=h.currentTime,m=c.getPartialFragment(g);if(m){var S=this._trySkipBufferHole(m);if(S||!this.media)return}(n.len>a.maxBufferHole||n.nextStart&&n.nextStart-g<a.maxBufferHole)&&s>a.highBufferWatchdogPeriod*1e3&&(Qe.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},u._reportStall=function(n){var s=this.hls,a=this.media,c=this.stallReported;if(!c&&a){this.stallReported=!0;var h=new Error("Playback stalling at @"+a.currentTime+" due to low buffer ("+JSON.stringify(n)+")");Qe.warn(h.message),s.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.BUFFER_STALLED_ERROR,fatal:!1,error:h,buffer:n.len})}},u._trySkipBufferHole=function(n){var s=this.config,a=this.hls,c=this.media;if(c===null)return 0;var h=c.currentTime,g=Vt.bufferInfo(c,h,0),m=h<g.start?g.start:g.nextStart;if(m){var S=g.len<=s.maxBufferHole,x=g.len>0&&g.len<1&&c.readyState<3,U=m-h;if(U>0&&(S||x)){if(U>s.maxBufferHole){var ne=this.fragmentTracker,ue=!1;if(h===0){var ge=ne.getAppendedFrag(0,Nt.MAIN);ge&&m<ge.end&&(ue=!0)}if(!ue){var ye=n||ne.getAppendedFrag(h,Nt.MAIN);if(ye){for(var Se=!1,xe=ye.end;xe<m;){var De=ne.getPartialFragment(xe);if(De)xe+=De.duration;else{Se=!0;break}}if(Se)return 0}}}var Fe=Math.max(m+yc,h+vc);if(Qe.warn("skipping hole, adjusting currentTime from "+h+" to "+Fe),this.moved=!0,this.stalled=null,c.currentTime=Fe,n&&!n.gap){var He=new Error("fragment loaded with buffer holes, seeking from "+h+" to "+Fe);a.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:He,reason:He.message,frag:n})}return Fe}}return 0},u._tryNudgeBuffer=function(){var n=this.config,s=this.hls,a=this.media,c=this.nudgeRetry;if(a!==null){var h=a.currentTime;if(this.nudgeRetry++,c<n.nudgeMaxRetry){var g=h+(c+1)*n.nudgeOffset,m=new Error("Nudging 'currentTime' from "+h+" to "+g);Qe.warn(m.message),a.currentTime=g,s.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.BUFFER_NUDGE_ON_STALL,error:m,fatal:!1})}else{var S=new Error("Playhead still not moving while enough data buffered @"+h+" after "+n.nudgeMaxRetry+" nudges");Qe.error(S.message),s.trigger(_e.ERROR,{type:Pt.MEDIA_ERROR,details:je.BUFFER_STALLED_ERROR,error:S,fatal:!0})}}},d}(),lu=100,Yd=function(d){Bt(u,d);function u(n,s,a){var c;return c=d.call(this,n,s,a,"[stream-controller]",Nt.MAIN)||this,c.audioCodecSwap=!1,c.gapController=null,c.level=-1,c._forceStartLoad=!1,c.altAudio=!1,c.audioOnly=!1,c.fragPlaying=null,c.onvplaying=null,c.onvseeked=null,c.fragLastKbps=0,c.couldBacktrack=!1,c.backtrackFragment=null,c.audioCodecSwitch=!1,c.videoBuffer=null,c._registerListeners(),c}var l=u.prototype;return l._registerListeners=function(){var s=this.hls;s.on(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.on(_e.MANIFEST_PARSED,this.onManifestParsed,this),s.on(_e.LEVEL_LOADING,this.onLevelLoading,this),s.on(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.on(_e.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.on(_e.ERROR,this.onError,this),s.on(_e.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(_e.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(_e.BUFFER_CREATED,this.onBufferCreated,this),s.on(_e.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(_e.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var s=this.hls;s.off(_e.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(_e.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(_e.MANIFEST_LOADING,this.onManifestLoading,this),s.off(_e.MANIFEST_PARSED,this.onManifestParsed,this),s.off(_e.LEVEL_LOADED,this.onLevelLoaded,this),s.off(_e.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.off(_e.ERROR,this.onError,this),s.off(_e.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(_e.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(_e.BUFFER_CREATED,this.onBufferCreated,this),s.off(_e.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(_e.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(_e.FRAG_BUFFERED,this.onFragBuffered,this)},l.onHandlerDestroying=function(){this._unregisterListeners(),d.prototype.onHandlerDestroying.call(this)},l.startLoad=function(s){if(this.levels){var a=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(lu),this.level=-1,!this.startFragRequested){var h=c.startLevel;h===-1&&(c.config.testBandwidth&&this.levels.length>1?(h=0,this.bitrateTest=!0):h=c.firstAutoLevel),c.nextLoadLevel=h,this.level=c.loadLevel,this.loadedmetadata=!1}a>0&&s===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),s=a),this.state=ht.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}else this._forceStartLoad=!0,this.state=ht.STOPPED},l.stopLoad=function(){this._forceStartLoad=!1,d.prototype.stopLoad.call(this)},l.doTick=function(){switch(this.state){case ht.WAITING_LEVEL:{var s=this.levels,a=this.level,c=s?.[a],h=c?.details;if(h&&(!h.live||this.levelLastLoaded===c)){if(this.waitForCdnTuneIn(h))break;this.state=ht.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ht.IDLE;break}break}case ht.FRAG_LOADING_WAITING_RETRY:{var g,m=self.performance.now(),S=this.retryDate;if(!S||m>=S||(g=this.media)!=null&&g.seeking){var x=this.levels,U=this.level,ne=x?.[U];this.resetStartWhenNotLoaded(ne||null),this.state=ht.IDLE}}break}this.state===ht.IDLE&&this.doTickIdle(),this.onTickEnd()},l.onTickEnd=function(){d.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},l.doTickIdle=function(){var s=this.hls,a=this.levelLastLoaded,c=this.levels,h=this.media;if(!(a===null||!h&&(this.startFragRequested||!s.config.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)){var g=s.nextLoadLevel;if(c!=null&&c[g]){var m=c[g],S=this.getMainFwdBufferInfo();if(S!==null){var x=this.getLevelDetails();if(x&&this._streamEnded(S,x)){var U={};this.altAudio&&(U.type="video"),this.hls.trigger(_e.BUFFER_EOS,U),this.state=ht.ENDED;return}s.loadLevel!==g&&s.manualLevel===-1&&this.log("Adapting to level "+g+" from level "+this.level),this.level=s.nextLoadLevel=g;var ne=m.details;if(!ne||this.state===ht.WAITING_LEVEL||ne.live&&this.levelLastLoaded!==m){this.level=g,this.state=ht.WAITING_LEVEL;return}var ue=S.len,ge=this.getMaxBufferLength(m.maxBitrate);if(!(ue>=ge)){this.backtrackFragment&&this.backtrackFragment.start>S.end&&(this.backtrackFragment=null);var ye=this.backtrackFragment?this.backtrackFragment.start:S.end,Se=this.getNextFragment(ye,ne);if(this.couldBacktrack&&!this.fragPrevious&&Se&&Se.sn!=="initSegment"&&this.fragmentTracker.getState(Se)!==mt.OK){var xe,De=((xe=this.backtrackFragment)!=null?xe:Se).sn,Fe=De-ne.startSN,He=ne.fragments[Fe-1];He&&Se.cc===He.cc&&(Se=He,this.fragmentTracker.removeFragment(He))}else this.backtrackFragment&&S.len&&(this.backtrackFragment=null);if(Se&&this.isLoopLoading(Se,ye)){var rt=Se.gap;if(!rt){var ze=this.audioOnly&&!this.altAudio?ti.AUDIO:ti.VIDEO,Ve=(ze===ti.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Ve&&this.afterBufferFlushed(Ve,ze,Nt.MAIN)}Se=this.getNextFragmentLoopLoading(Se,ne,S,Nt.MAIN,ge)}Se&&(Se.initSegment&&!Se.initSegment.data&&!this.bitrateTest&&(Se=Se.initSegment),this.loadFragment(Se,m,ye))}}}}},l.loadFragment=function(s,a,c){var h=this.fragmentTracker.getState(s);this.fragCurrent=s,h===mt.NOT_LOADED||h===mt.PARTIAL?s.sn==="initSegment"?this._loadInitSegment(s,a):this.bitrateTest?(this.log("Fragment "+s.sn+" of level "+s.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(s,a)):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,s,a,c)):this.clearTrackerIfNeeded(s)},l.getBufferedFrag=function(s){return this.fragmentTracker.getBufferedFrag(s,Nt.MAIN)},l.followingBufferedFrag=function(s){return s?this.getBufferedFrag(s.end+.5):null},l.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},l.nextLevelSwitch=function(){var s=this.levels,a=this.media;if(a!=null&&a.readyState){var c,h=this.getAppendedFrag(a.currentTime);h&&h.start>1&&this.flushMainBuffer(0,h.start-1);var g=this.getLevelDetails();if(g!=null&&g.live){var m=this.getMainFwdBufferInfo();if(!m||m.len<g.targetduration*2)return}if(!a.paused&&s){var S=this.hls.nextLoadLevel,x=s[S],U=this.fragLastKbps;U&&this.fragCurrent?c=this.fragCurrent.duration*x.maxBitrate/(1e3*U)+1:c=0}else c=0;var ne=this.getBufferedFrag(a.currentTime+c);if(ne){var ue=this.followingBufferedFrag(ne);if(ue){this.abortCurrentFrag();var ge=ue.maxStartPTS?ue.maxStartPTS:ue.start,ye=ue.duration,Se=Math.max(ne.end,ge+Math.min(Math.max(ye-this.config.maxFragLookUpTolerance,ye*(this.couldBacktrack?.5:.125)),ye*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(Se,Number.POSITIVE_INFINITY)}}}},l.abortCurrentFrag=function(){var s=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,s&&(s.abortRequests(),this.fragmentTracker.removeFragment(s)),this.state){case ht.KEY_LOADING:case ht.FRAG_LOADING:case ht.FRAG_LOADING_WAITING_RETRY:case ht.PARSING:case ht.PARSED:this.state=ht.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},l.flushMainBuffer=function(s,a){d.prototype.flushMainBuffer.call(this,s,a,this.altAudio?"video":null)},l.onMediaAttached=function(s,a){d.prototype.onMediaAttached.call(this,s,a);var c=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),c.addEventListener("playing",this.onvplaying),c.addEventListener("seeked",this.onvseeked),this.gapController=new Tc(this.config,c,this.fragmentTracker,this.hls)},l.onMediaDetaching=function(){var s=this.media;s&&this.onvplaying&&this.onvseeked&&(s.removeEventListener("playing",this.onvplaying),s.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),d.prototype.onMediaDetaching.call(this)},l.onMediaPlaying=function(){this.tick()},l.onMediaSeeked=function(){var s=this.media,a=s?s.currentTime:null;Ct(a)&&this.log("Media seeked to "+a.toFixed(3));var c=this.getMainFwdBufferInfo();if(c===null||c.len===0){this.warn('Main forward buffer length on "seeked" event '+(c?c.len:"empty")+")");return}this.tick()},l.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(_e.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1},l.onManifestParsed=function(s,a){var c=!1,h=!1;a.levels.forEach(function(g){var m=g.audioCodec;m&&(c=c||m.indexOf("mp4a.40.2")!==-1,h=h||m.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=c&&h&&!$a(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},l.onLevelLoading=function(s,a){var c=this.levels;if(!(!c||this.state!==ht.IDLE)){var h=c[a.level];(!h.details||h.details.live&&this.levelLastLoaded!==h||this.waitForCdnTuneIn(h.details))&&(this.state=ht.WAITING_LEVEL)}},l.onLevelLoaded=function(s,a){var c,h=this.levels,g=a.level,m=a.details,S=m.totalduration;if(!h){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+m.startSN+","+m.endSN+"]"+(m.lastPartSn?"[part-"+m.lastPartSn+"-"+m.lastPartIndex+"]":"")+", cc ["+m.startCC+", "+m.endCC+"] duration:"+S);var x=h[g],U=this.fragCurrent;U&&(this.state===ht.FRAG_LOADING||this.state===ht.FRAG_LOADING_WAITING_RETRY)&&U.level!==a.level&&U.loader&&this.abortCurrentFrag();var ne=0;if(m.live||(c=x.details)!=null&&c.live){var ue;if(this.checkLiveUpdate(m),m.deltaUpdateFailed)return;ne=this.alignPlaylists(m,x.details,(ue=this.levelLastLoaded)==null?void 0:ue.details)}if(x.details=m,this.levelLastLoaded=x,this.hls.trigger(_e.LEVEL_UPDATED,{details:m,level:g}),this.state===ht.WAITING_LEVEL){if(this.waitForCdnTuneIn(m))return;this.state=ht.IDLE}this.startFragRequested?m.live&&this.synchronizeToLiveEdge(m):this.setStartPosition(m,ne),this.tick()},l._handleFragmentLoadProgress=function(s){var a,c=s.frag,h=s.part,g=s.payload,m=this.levels;if(!m){this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var S=m[c.level],x=S.details;if(!x){this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset"),this.fragmentTracker.removeFragment(c);return}var U=S.videoCodec,ne=x.PTSKnown||!x.live,ue=(a=c.initSegment)==null?void 0:a.data,ge=this._getAudioCodec(S),ye=this.transmuxer=this.transmuxer||new qu(this.hls,Nt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Se=h?h.index:-1,xe=Se!==-1,De=new bi(c.level,c.sn,c.stats.chunkCount,g.byteLength,Se,xe),Fe=this.initPTS[c.cc];ye.push(g,ue,ge,U,c,h,x.totalduration,ne,De,Fe)},l.onAudioTrackSwitching=function(s,a){var c=this.altAudio,h=!!a.url;if(!h){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var g=this.fragCurrent;g&&(this.log("Switching to main audio track, cancel main fragment load"),g.abortRequests(),this.fragmentTracker.removeFragment(g)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var m=this.hls;c&&(m.trigger(_e.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),m.trigger(_e.AUDIO_TRACK_SWITCHED,a)}},l.onAudioTrackSwitched=function(s,a){var c=a.id,h=!!this.hls.audioTracks[c].url;if(h){var g=this.videoBuffer;g&&this.mediaBuffer!==g&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=g)}this.altAudio=h,this.tick()},l.onBufferCreated=function(s,a){var c=a.tracks,h,g,m=!1;for(var S in c){var x=c[S];if(x.id==="main"){if(g=S,h=x,S==="video"){var U=c[S];U&&(this.videoBuffer=U.buffer)}}else m=!0}m&&h?(this.log("Alternate track found, use "+g+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},l.onFragBuffered=function(s,a){var c=a.frag,h=a.part;if(!(c&&c.type!==Nt.MAIN)){if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(h?" p: "+h.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),this.state===ht.PARSED&&(this.state=ht.IDLE);return}var g=h?h.stats:c.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),c.sn!=="initSegment"&&(this.fragPrevious=c),this.fragBufferedComplete(c,h)}},l.onError=function(s,a){var c;if(a.fatal){this.state=ht.ERROR;return}switch(a.details){case je.FRAG_GAP:case je.FRAG_PARSING_ERROR:case je.FRAG_DECRYPT_ERROR:case je.FRAG_LOAD_ERROR:case je.FRAG_LOAD_TIMEOUT:case je.KEY_LOAD_ERROR:case je.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Nt.MAIN,a);break;case je.LEVEL_LOAD_ERROR:case je.LEVEL_LOAD_TIMEOUT:case je.LEVEL_PARSING_ERROR:!a.levelRetry&&this.state===ht.WAITING_LEVEL&&((c=a.context)==null?void 0:c.type)===Jt.LEVEL&&(this.state=ht.IDLE);break;case je.BUFFER_APPEND_ERROR:case je.BUFFER_FULL_ERROR:if(!a.parent||a.parent!=="main")return;if(a.details===je.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(a)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case je.INTERNAL_EXCEPTION:this.recoverWorkerError(a);break}},l.checkBuffer=function(){var s=this.media,a=this.gapController;if(!(!s||!a||!s.readyState)){if(this.loadedmetadata||!Vt.getBuffered(s).length){var c=this.state!==ht.IDLE?this.fragCurrent:null;a.poll(this.lastCurrentTime,c)}this.lastCurrentTime=s.currentTime}},l.onFragLoadEmergencyAborted=function(){this.state=ht.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},l.onBufferFlushed=function(s,a){var c=a.type;if(c!==ti.AUDIO||this.audioOnly&&!this.altAudio){var h=(c===ti.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(h,c,Nt.MAIN),this.tick()}},l.onLevelsUpdated=function(s,a){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=a.levels},l.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},l.seekToStartPos=function(){var s=this.media;if(s){var a=s.currentTime,c=this.startPosition;if(c>=0&&a<c){if(s.seeking){this.log("could not seek to "+c+", already seeking at "+a);return}var h=Vt.getBuffered(s),g=h.length?h.start(0):0,m=g-c;m>0&&(m<this.config.maxBufferHole||m<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+m+" to match buffer start"),c+=m,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+a),s.currentTime=c}}},l._getAudioCodec=function(s){var a=this.config.defaultAudioCodec||s.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a.indexOf("mp4a.40.5")!==-1?a="mp4a.40.2":a="mp4a.40.5"),a},l._loadBitrateTestFrag=function(s,a){var c=this;s.bitrateTest=!0,this._doFragLoad(s,a).then(function(h){var g=c.hls;if(!(!h||c.fragContextChanged(s))){a.fragmentError=0,c.state=ht.IDLE,c.startFragRequested=!1,c.bitrateTest=!1;var m=s.stats;m.parsing.start=m.parsing.end=m.buffering.start=m.buffering.end=self.performance.now(),g.trigger(_e.FRAG_LOADED,h),s.bitrateTest=!1}})},l._handleTransmuxComplete=function(s){var a,c="main",h=this.hls,g=s.remuxResult,m=s.chunkMeta,S=this.getCurrentContext(m);if(!S){this.resetWhenMissingContext(m);return}var x=S.frag,U=S.part,ne=S.level,ue=g.video,ge=g.text,ye=g.id3,Se=g.initSegment,xe=ne.details,De=this.altAudio?void 0:g.audio;if(this.fragContextChanged(x)){this.fragmentTracker.removeFragment(x);return}if(this.state=ht.PARSING,Se){if(Se!=null&&Se.tracks){var Fe=x.initSegment||x;this._bufferInitSegment(ne,Se.tracks,Fe,m),h.trigger(_e.FRAG_PARSING_INIT_SEGMENT,{frag:Fe,id:c,tracks:Se.tracks})}var He=Se.initPTS,rt=Se.timescale;Ct(He)&&(this.initPTS[x.cc]={baseTime:He,timescale:rt},h.trigger(_e.INIT_PTS_FOUND,{frag:x,id:c,initPTS:He,timescale:rt}))}if(ue&&xe&&x.sn!=="initSegment"){var ze=xe.fragments[x.sn-1-xe.startSN],Ve=x.sn===xe.startSN,Ze=!ze||x.cc>ze.cc;if(g.independent!==!1){var et=ue.startPTS,ot=ue.endPTS,ct=ue.startDTS,yt=ue.endDTS;if(U)U.elementaryStreams[ue.type]={startPTS:et,endPTS:ot,startDTS:ct,endDTS:yt};else if(ue.firstKeyFrame&&ue.independent&&m.id===1&&!Ze&&(this.couldBacktrack=!0),ue.dropped&&ue.independent){var wt=this.getMainFwdBufferInfo(),It=(wt?wt.end:this.getLoadPosition())+this.config.maxBufferHole,Ht=ue.firstKeyFramePTS?ue.firstKeyFramePTS:et;if(!Ve&&It<Ht-this.config.maxBufferHole&&!Ze){this.backtrack(x);return}else Ze&&(x.gap=!0);x.setElementaryStreamInfo(ue.type,x.start,ot,x.start,yt,!0)}else Ve&&et>ha&&(x.gap=!0);x.setElementaryStreamInfo(ue.type,et,ot,ct,yt),this.backtrackFragment&&(this.backtrackFragment=x),this.bufferFragmentData(ue,x,U,m,Ve||Ze)}else if(Ve||Ze)x.gap=!0;else{this.backtrack(x);return}}if(De){var jt=De.startPTS,Zt=De.endPTS,ei=De.startDTS,Kt=De.endDTS;U&&(U.elementaryStreams[ti.AUDIO]={startPTS:jt,endPTS:Zt,startDTS:ei,endDTS:Kt}),x.setElementaryStreamInfo(ti.AUDIO,jt,Zt,ei,Kt),this.bufferFragmentData(De,x,U,m)}if(xe&&ye!=null&&(a=ye.samples)!=null&&a.length){var Ai={id:c,frag:x,details:xe,samples:ye.samples};h.trigger(_e.FRAG_PARSING_METADATA,Ai)}if(xe&&ge){var li={id:c,frag:x,details:xe,samples:ge.samples};h.trigger(_e.FRAG_PARSING_USERDATA,li)}},l._bufferInitSegment=function(s,a,c,h){var g=this;if(this.state===ht.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var m=a.audio,S=a.video,x=a.audiovideo;if(m){var U=s.audioCodec,ne=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){U&&(U.indexOf("mp4a.40.5")!==-1?U="mp4a.40.2":U="mp4a.40.5");var ue=m.metadata;ue&&"channelCount"in ue&&(ue.channelCount||1)!==1&&ne.indexOf("firefox")===-1&&(U="mp4a.40.5")}U&&U.indexOf("mp4a.40.5")!==-1&&ne.indexOf("android")!==-1&&m.container!=="audio/mpeg"&&(U="mp4a.40.2",this.log("Android: force audio codec to "+U)),s.audioCodec&&s.audioCodec!==U&&this.log('Swapping manifest audio codec "'+s.audioCodec+'" for "'+U+'"'),m.levelCodec=U,m.id="main",this.log("Init audio buffer, container:"+m.container+", codecs[selected/level/parsed]=["+(U||"")+"/"+(s.audioCodec||"")+"/"+m.codec+"]")}S&&(S.levelCodec=s.videoCodec,S.id="main",this.log("Init video buffer, container:"+S.container+", codecs[level/parsed]=["+(s.videoCodec||"")+"/"+S.codec+"]")),x&&this.log("Init audiovideo buffer, container:"+x.container+", codecs[level/parsed]=["+s.codecs+"/"+x.codec+"]"),this.hls.trigger(_e.BUFFER_CODECS,a),Object.keys(a).forEach(function(ge){var ye=a[ge],Se=ye.initSegment;Se!=null&&Se.byteLength&&g.hls.trigger(_e.BUFFER_APPENDING,{type:ge,data:Se,frag:c,part:null,chunkMeta:h,parent:c.type})}),this.tickImmediate()}},l.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Nt.MAIN)},l.backtrack=function(s){this.couldBacktrack=!0,this.backtrackFragment=s,this.resetTransmuxer(),this.flushBufferGap(s),this.fragmentTracker.removeFragment(s),this.fragPrevious=null,this.nextLoadPosition=s.start,this.state=ht.IDLE},l.checkFragmentChanged=function(){var s=this.media,a=null;if(s&&s.readyState>1&&s.seeking===!1){var c=s.currentTime;if(Vt.isBuffered(s,c)?a=this.getAppendedFrag(c):Vt.isBuffered(s,c+.1)&&(a=this.getAppendedFrag(c+.1)),a){this.backtrackFragment=null;var h=this.fragPlaying,g=a.level;(!h||a.sn!==h.sn||h.level!==g)&&(this.fragPlaying=a,this.hls.trigger(_e.FRAG_CHANGED,{frag:a}),(!h||h.level!==g)&&this.hls.trigger(_e.LEVEL_SWITCHED,{level:g}))}}},ki(u,[{key:"nextLevel",get:function(){var s=this.nextBufferedFrag;return s?s.level:-1}},{key:"currentFrag",get:function(){var s=this.media;return s?this.fragPlaying||this.getAppendedFrag(s.currentTime):null}},{key:"currentProgramDateTime",get:function(){var s=this.media;if(s){var a=s.currentTime,c=this.currentFrag;if(c&&Ct(a)&&Ct(c.programDateTime)){var h=c.programDateTime+(a-c.start)*1e3;return new Date(h)}}return null}},{key:"currentLevel",get:function(){var s=this.currentFrag;return s?s.level:-1}},{key:"nextBufferedFrag",get:function(){var s=this.currentFrag;return s?this.followingBufferedFrag(s):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),u}(zi),Ec=function(){d.isMSESupported=function(){return rl()},d.isSupported=function(){return Sf()},d.getMediaSource=function(){return Tt()};function d(l){l===void 0&&(l={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new qo,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,Co(l.debug||!1,"Hls instance");var n=this.config=Bs(d.DefaultConfig,l);this.userConfig=l,n.progressive&&gc(n);var s=n.abrController,a=n.bufferController,c=n.capLevelController,h=n.errorController,g=n.fpsController,m=new h(this),S=this.abrController=new s(this),x=this.bufferController=new a(this),U=this.capLevelController=new c(this),ne=new g(this),ue=new Ia(this),ge=new wl(this),ye=n.contentSteeringController,Se=ye?new ye(this):null,xe=this.levelController=new Wd(this,Se),De=new Qt(this),Fe=new Af(this.config),He=this.streamController=new Yd(this,De,Fe);U.setStreamController(He),ne.setStreamController(He);var rt=[ue,xe,He];Se&&rt.splice(1,0,Se),this.networkControllers=rt;var ze=[S,x,U,ne,ge,De];this.audioTrackController=this.createController(n.audioTrackController,rt);var Ve=n.audioStreamController;Ve&&rt.push(new Ve(this,De,Fe)),this.subtitleTrackController=this.createController(n.subtitleTrackController,rt);var Ze=n.subtitleStreamController;Ze&&rt.push(new Ze(this,De,Fe)),this.createController(n.timelineController,ze),Fe.emeController=this.emeController=this.createController(n.emeController,ze),this.cmcdController=this.createController(n.cmcdController,ze),this.latencyController=this.createController(Ll,ze),this.coreComponents=ze,rt.push(m);var et=m.onErrorOut;typeof et=="function"&&this.on(_e.ERROR,et,m)}var u=d.prototype;return u.createController=function(n,s){if(n){var a=new n(this);return s&&s.push(a),a}return null},u.on=function(n,s,a){a===void 0&&(a=this),this._emitter.on(n,s,a)},u.once=function(n,s,a){a===void 0&&(a=this),this._emitter.once(n,s,a)},u.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},u.off=function(n,s,a,c){a===void 0&&(a=this),this._emitter.off(n,s,a,c)},u.listeners=function(n){return this._emitter.listeners(n)},u.emit=function(n,s,a){return this._emitter.emit(n,s,a)},u.trigger=function(n,s){if(this.config.debug)return this.emit(n,n,s);try{return this.emit(n,n,s)}catch(c){if(Qe.error("An internal error happened while handling event "+n+'. Error message: "'+c.message+'". Here is a stacktrace:',c),!this.triggeringException){this.triggeringException=!0;var a=n===_e.ERROR;this.trigger(_e.ERROR,{type:Pt.OTHER_ERROR,details:je.INTERNAL_EXCEPTION,fatal:a,event:n,error:c}),this.triggeringException=!1}}return!1},u.listenerCount=function(n){return this._emitter.listenerCount(n)},u.destroy=function(){Qe.log("destroy"),this.trigger(_e.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(s){return s.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(s){return s.destroy()}),this.coreComponents.length=0;var n=this.config;n.xhrSetup=n.fetchSetup=void 0,this.userConfig=null},u.attachMedia=function(n){Qe.log("attachMedia"),this._media=n,this.trigger(_e.MEDIA_ATTACHING,{media:n})},u.detachMedia=function(){Qe.log("detachMedia"),this.trigger(_e.MEDIA_DETACHING,void 0),this._media=null},u.loadSource=function(n){this.stopLoad();var s=this.media,a=this.url,c=this.url=pn.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,Qe.log("loadSource:"+c),s&&a&&(a!==c||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(s)),this.trigger(_e.MANIFEST_LOADING,{url:n})},u.startLoad=function(n){n===void 0&&(n=-1),Qe.log("startLoad("+n+")"),this.started=!0,this.networkControllers.forEach(function(s){s.startLoad(n)})},u.stopLoad=function(){Qe.log("stopLoad"),this.started=!1,this.networkControllers.forEach(function(n){n.stopLoad()})},u.resumeBuffering=function(){this.started&&this.networkControllers.forEach(function(n){"fragmentLoader"in n&&n.startLoad(-1)})},u.pauseBuffering=function(){this.networkControllers.forEach(function(n){"fragmentLoader"in n&&n.stopLoad()})},u.swapAudioCodec=function(){Qe.log("swapAudioCodec"),this.streamController.swapAudioCodec()},u.recoverMediaError=function(){Qe.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},u.removeLevel=function(n){this.levelController.removeLevel(n)},u.setAudioOption=function(n){var s;return(s=this.audioTrackController)==null?void 0:s.setAudioOption(n)},u.setSubtitleOption=function(n){var s;return(s=this.subtitleTrackController)==null||s.setSubtitleOption(n),null},ki(d,[{key:"levels",get:function(){var n=this.levelController.levels;return n||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){Qe.log("set currentLevel:"+n),this.levelController.manualLevel=n,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){Qe.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){Qe.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){Qe.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){var n=this.levelController.startLevel;return n===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:n},set:function(n){Qe.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var s=!!n;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(Qe.log("set autoLevelCapping:"+n),this._autoLevelCapping=n,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN},set:function(n){this.abrController.resetEstimator(n)}},{key:"ttfbEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(n){Du(n)&&this._maxHdcpLevel!==n&&(this._maxHdcpLevel=n,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,s=this.config.minAutoBitrate;if(!n)return 0;for(var a=n.length,c=0;c<a;c++)if(n[c].maxBitrate>=s)return c;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,s=this.autoLevelCapping,a=this.maxHdcpLevel,c;if(s===-1&&n!=null&&n.length?c=n.length-1:c=s,a)for(var h=c;h--;){var g=n[h].attrs["HDCP-LEVEL"];if(g&&g<=a)return h}return c}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(n){this.abrController.nextAutoLevel=n}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"allAudioTracks",get:function(){var n=this.audioTrackController;return n?n.allAudioTracks:[]}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var s=this.audioTrackController;s&&(s.audioTrack=n)}},{key:"allSubtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return n?n.subtitleDisplay:!1},set:function(n){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.5.17"}},{key:"Events",get:function(){return _e}},{key:"ErrorTypes",get:function(){return Pt}},{key:"ErrorDetails",get:function(){return je}},{key:"DefaultConfig",get:function(){return d.defaultConfig?d.defaultConfig:$d},set:function(n){d.defaultConfig=n}}]),d}();return Ec.defaultConfig=void 0,Ec})}(!1);var Clappr=function(){"use strict";function Un(J,ee){var j=Object.keys(J);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(J);ee&&(y=y.filter(function(F){return Object.getOwnPropertyDescriptor(J,F).enumerable})),j.push.apply(j,y)}return j}function or(J){for(var ee=1;ee<arguments.length;ee++){var j=arguments[ee]!=null?arguments[ee]:{};ee%2?Un(Object(j),!0).forEach(function(y){Hr(J,y,j[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(j)):Un(Object(j)).forEach(function(y){Object.defineProperty(J,y,Object.getOwnPropertyDescriptor(j,y))})}return J}function Hr(J,ee,j){return(ee=function(y){var F=function(re,C){if(typeof re!="object"||re===null)return re;var z=re[Symbol.toPrimitive];if(z!==void 0){var G=z.call(re,C||"default");if(typeof G!="object")return G;throw new TypeError("@@toPrimitive must return a primitive value.")}return(C==="string"?String:Number)(re)}(y,"string");return typeof F=="symbol"?F:String(F)}(ee))in J?Object.defineProperty(J,ee,{value:j,enumerable:!0,configurable:!0,writable:!0}):J[ee]=j,J}function Ii(J,ee){var j=Object.keys(J);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(J);ee&&(y=y.filter(function(F){return Object.getOwnPropertyDescriptor(J,F).enumerable})),j.push.apply(j,y)}return j}function Ea(J){for(var ee=1;ee<arguments.length;ee++){var j=arguments[ee]!=null?arguments[ee]:{};ee%2?Ii(Object(j),!0).forEach(function(y){Di(J,y,j[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(j)):Ii(Object(j)).forEach(function(y){Object.defineProperty(J,y,Object.getOwnPropertyDescriptor(j,y))})}return J}function fs(J){return fs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ee){return typeof ee}:function(ee){return ee&&typeof Symbol=="function"&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee},fs(J)}function ri(J,ee){if(!(J instanceof ee))throw new TypeError("Cannot call a class as a function")}function ki(J,ee){for(var j=0;j<ee.length;j++){var y=ee[j];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(J,y.key,y)}}function ai(J,ee,j){return ee&&ki(J.prototype,ee),j&&ki(J,j),Object.defineProperty(J,"prototype",{writable:!1}),J}function Di(J,ee,j){return ee in J?Object.defineProperty(J,ee,{value:j,enumerable:!0,configurable:!0,writable:!0}):J[ee]=j,J}function Bt(J,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function");J.prototype=Object.create(ee&&ee.prototype,{constructor:{value:J,writable:!0,configurable:!0}}),Object.defineProperty(J,"prototype",{writable:!1}),ee&&Gn(J,ee)}function hn(J){return hn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(ee){return ee.__proto__||Object.getPrototypeOf(ee)},hn(J)}function Gn(J,ee){return Gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(j,y){return j.__proto__=y,j},Gn(J,ee)}function zt(J){if(J===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return J}function _a(J,ee){if(ee&&(typeof ee=="object"||typeof ee=="function"))return ee;if(ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zt(J)}function $i(J){var ee=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var j,y=hn(J);if(ee){var F=hn(this).constructor;j=Reflect.construct(y,arguments,F)}else j=y.apply(this,arguments);return _a(this,j)}}function js(J,ee){for(;!Object.prototype.hasOwnProperty.call(J,ee)&&(J=hn(J))!==null;);return J}function fn(){return fn=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(J,ee,j){var y=js(J,ee);if(y){var F=Object.getOwnPropertyDescriptor(y,ee);return F.get?F.get.call(arguments.length<3?J:j):F.value}},fn.apply(this,arguments)}function Ja(J,ee){return function(j){if(Array.isArray(j))return j}(J)||function(j,y){var F=j==null?null:typeof Symbol<"u"&&j[Symbol.iterator]||j["@@iterator"];if(F!=null){var re,C,z=[],G=!0,de=!1;try{for(F=F.call(j);!(G=(re=F.next()).done)&&(z.push(re.value),!y||z.length!==y);G=!0);}catch(te){de=!0,C=te}finally{try{G||F.return==null||F.return()}finally{if(de)throw C}}return z}}(J,ee)||es(J,ee)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function pr(J){return function(ee){if(Array.isArray(ee))return oi(ee)}(J)||function(ee){if(typeof Symbol<"u"&&ee[Symbol.iterator]!=null||ee["@@iterator"]!=null)return Array.from(ee)}(J)||es(J)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function es(J,ee){if(J){if(typeof J=="string")return oi(J,ee);var j=Object.prototype.toString.call(J).slice(8,-1);return j==="Object"&&J.constructor&&(j=J.constructor.name),j==="Map"||j==="Set"?Array.from(J):j==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(j)?oi(J,ee):void 0}}function oi(J,ee){(ee==null||ee>J.length)&&(ee=J.length);for(var j=0,y=new Array(ee);j<ee;j++)y[j]=J[j];return y}function Za(J,ee){var j=typeof Symbol<"u"&&J[Symbol.iterator]||J["@@iterator"];if(!j){if(Array.isArray(J)||(j=es(J))||ee&&J&&typeof J.length=="number"){j&&(J=j);var y=0,F=function(){};return{s:F,n:function(){return y>=J.length?{done:!0}:{done:!1,value:J[y++]}},e:function(G){throw G},f:F}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var re,C=!0,z=!1;return{s:function(){j=j.call(J)},n:function(){var G=j.next();return C=G.done,G},e:function(G){z=!0,re=G},f:function(){try{C||j.return==null||j.return()}finally{if(z)throw re}}}}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(J){if(this==null)throw new TypeError('"this" is null or not defined');var ee=Object(this),j=ee.length>>>0;if(typeof J!="function")throw new TypeError("predicate must be a function");for(var y=arguments[1],F=0;F<j;){var re=ee[F];if(J.call(y,re,F,ee))return re;F++}}}),Object.entries||(Object.entries=function(J){for(var ee=Object.keys(J),j=ee.length,y=new Array(j);j--;)y[j]=[ee[j],J[ee[j]]];return y}),Object.values||(Object.values=function(J){for(var ee=Object.keys(J),j=ee.length,y=new Array(j);j--;)y[j]=J[ee[j]];return y}),typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(J,ee){if(J==null)throw new TypeError("Cannot convert undefined or null to object");for(var j=Object(J),y=1;y<arguments.length;y++){var F=arguments[y];if(F!=null)for(var re in F)Object.prototype.hasOwnProperty.call(F,re)&&(j[re]=F[re])}return j},writable:!0,configurable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(J){if(this==null)throw new TypeError('"this" is null or not defined');var ee=Object(this),j=ee.length>>>0;if(typeof J!="function")throw new TypeError("predicate must be a function");for(var y=arguments[1],F=0;F<j;){var re=ee[F];if(J.call(y,re,F,ee))return F;F++}return-1},configurable:!0,writable:!0});var pn,Ct={mp4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAC721kYXQhEAUgpBv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA3pwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcCEQBSCkG//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADengAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAsJtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAB7HRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAIAAAAAAAAALwAAAAAAAAAAAAAAAQEAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAC8AAAAAAAEAAAAAAWRtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAKxEAAAIAFXEAAAAAAAtaGRscgAAAAAAAAAAc291bgAAAAAAAAAAAAAAAFNvdW5kSGFuZGxlcgAAAAEPbWluZgAAABBzbWhkAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAADTc3RibAAAAGdzdHNkAAAAAAAAAAEAAABXbXA0YQAAAAAAAAABAAAAAAAAAAAAAgAQAAAAAKxEAAAAAAAzZXNkcwAAAAADgICAIgACAASAgIAUQBUAAAAAAfQAAAHz+QWAgIACEhAGgICAAQIAAAAYc3R0cwAAAAAAAAABAAAAAgAABAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAIAAAABAAAAHHN0c3oAAAAAAAAAAAAAAAIAAAFzAAABdAAAABRzdGNvAAAAAAAAAAEAAAAsAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRhdGEAAAABAAAAAExhdmY1Ni40MC4xMDE="},kn=function(){var J,ee,j,y,F,re,C=[],z=C.concat,G=C.filter,de=C.slice,te=window.document,le={},Q={},X={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},ie=/^\s*<(\w+|!)[^>]*>/,W=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,se=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Y=/^(?:body|html)$/i,V=/([A-Z])/g,M=["val","css","html","text","data","width","height","offset"],b=te.createElement("table"),I=te.createElement("tr"),w={tr:te.createElement("tbody"),tbody:b,thead:b,tfoot:b,td:I,th:I,"*":te.createElement("div")},P=/complete|loaded|interactive/,_=/^[\w-]*$/,v={},A=v.toString,D={},O=te.createElement("div"),K={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},k=Array.isArray||function(ve){return ve instanceof Array};function L(ve){return ve==null?String(ve):v[A.call(ve)]||"object"}function R(ve){return L(ve)=="function"}function Z(ve){return ve!=null&&ve==ve.window}function ae(ve){return ve!=null&&ve.nodeType==ve.DOCUMENT_NODE}function fe(ve){return L(ve)=="object"}function ce(ve){return fe(ve)&&!Z(ve)&&Object.getPrototypeOf(ve)==Object.prototype}function me(ve){var Oe=!!ve&&"length"in ve&&ve.length,Ke=j.type(ve);return Ke!="function"&&!Z(ve)&&(Ke=="array"||Oe===0||typeof Oe=="number"&&Oe>0&&Oe-1 in ve)}function Ee(ve){return ve.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function be(ve){return ve in Q?Q[ve]:Q[ve]=new RegExp("(^|\\s)"+ve+"(\\s|$)")}function Re(ve,Oe){return typeof Oe!="number"||X[Ee(ve)]?Oe:Oe+"px"}function Ce(ve){return"children"in ve?de.call(ve.children):j.map(ve.childNodes,function(Oe){if(Oe.nodeType==1)return Oe})}function Ne(ve,Oe){var Ke,nt=ve?ve.length:0;for(Ke=0;Ke<nt;Ke++)this[Ke]=ve[Ke];this.length=nt,this.selector=Oe||""}function Ue(ve,Oe,Ke){for(ee in Oe)Ke&&(ce(Oe[ee])||k(Oe[ee]))?(ce(Oe[ee])&&!ce(ve[ee])&&(ve[ee]={}),k(Oe[ee])&&!k(ve[ee])&&(ve[ee]=[]),Ue(ve[ee],Oe[ee],Ke)):Oe[ee]!==J&&(ve[ee]=Oe[ee])}function Xe(ve,Oe){return Oe==null?j(ve):j(ve).filter(Oe)}function ut(ve,Oe,Ke,nt){return R(Oe)?Oe.call(ve,Ke,nt):Oe}function gt(ve,Oe,Ke){Ke==null?ve.removeAttribute(Oe):ve.setAttribute(Oe,Ke)}function ft(ve,Oe){var Ke=ve.className||"",nt=Ke&&Ke.baseVal!==J;if(Oe===J)return nt?Ke.baseVal:Ke;nt?Ke.baseVal=Oe:ve.className=Oe}function St(ve){try{return ve&&(ve=="true"||ve!="false"&&(ve=="null"?null:+ve+""==ve?+ve:/^[\[\{]/.test(ve)?j.parseJSON(ve):ve))}catch{return ve}}function Et(ve,Oe){Oe(ve);for(var Ke=0,nt=ve.childNodes.length;Ke<nt;Ke++)Et(ve.childNodes[Ke],Oe)}return D.matches=function(ve,Oe){if(!Oe||!ve||ve.nodeType!==1)return!1;var Ke=ve.matches||ve.webkitMatchesSelector||ve.mozMatchesSelector||ve.oMatchesSelector||ve.matchesSelector;if(Ke)return Ke.call(ve,Oe);var nt,vt=ve.parentNode,mt=!vt;return mt&&(vt=O).appendChild(ve),nt=~D.qsa(vt,Oe).indexOf(ve),mt&&O.removeChild(ve),nt},F=function(ve){return ve.replace(/-+(.)?/g,function(Oe,Ke){return Ke?Ke.toUpperCase():""})},re=function(ve){return G.call(ve,function(Oe,Ke){return ve.indexOf(Oe)==Ke})},D.fragment=function(ve,Oe,Ke){var nt,vt,mt;return W.test(ve)&&(nt=j(te.createElement(RegExp.$1))),nt||(ve.replace&&(ve=ve.replace(se,"<$1></$2>")),Oe===J&&(Oe=ie.test(ve)&&RegExp.$1),Oe in w||(Oe="*"),(mt=w[Oe]).innerHTML=""+ve,nt=j.each(de.call(mt.childNodes),function(){mt.removeChild(this)})),ce(Ke)&&(vt=j(nt),j.each(Ke,function(Qt,Yt){M.indexOf(Qt)>-1?vt[Qt](Yt):vt.attr(Qt,Yt)})),nt},D.Z=function(ve,Oe){return new Ne(ve,Oe)},D.isZ=function(ve){return ve instanceof D.Z},D.init=function(ve,Oe){var Ke,nt;if(!ve)return D.Z();if(typeof ve=="string")if((ve=ve.trim())[0]=="<"&&ie.test(ve))Ke=D.fragment(ve,RegExp.$1,Oe),ve=null;else{if(Oe!==J)return j(Oe).find(ve);Ke=D.qsa(te,ve)}else{if(R(ve))return j(te).ready(ve);if(D.isZ(ve))return ve;if(k(ve))nt=ve,Ke=G.call(nt,function(vt){return vt!=null});else if(fe(ve))Ke=[ve],ve=null;else if(ie.test(ve))Ke=D.fragment(ve.trim(),RegExp.$1,Oe),ve=null;else{if(Oe!==J)return j(Oe).find(ve);Ke=D.qsa(te,ve)}}return D.Z(Ke,ve)},(j=function(ve,Oe){return D.init(ve,Oe)}).extend=function(ve){var Oe,Ke=de.call(arguments,1);return typeof ve=="boolean"&&(Oe=ve,ve=Ke.shift()),Ke.forEach(function(nt){Ue(ve,nt,Oe)}),ve},D.qsa=function(ve,Oe){var Ke,nt=Oe[0]=="#",vt=!nt&&Oe[0]==".",mt=nt||vt?Oe.slice(1):Oe,Qt=_.test(mt);return ve.getElementById&&Qt&&nt?(Ke=ve.getElementById(mt))?[Ke]:[]:ve.nodeType!==1&&ve.nodeType!==9&&ve.nodeType!==11?[]:de.call(Qt&&!nt&&ve.getElementsByClassName?vt?ve.getElementsByClassName(mt):ve.getElementsByTagName(Oe):ve.querySelectorAll(Oe))},j.contains=te.documentElement.contains?function(ve,Oe){return ve!==Oe&&ve.contains(Oe)}:function(ve,Oe){for(;Oe&&(Oe=Oe.parentNode);)if(Oe===ve)return!0;return!1},j.type=L,j.isFunction=R,j.isWindow=Z,j.isArray=k,j.isPlainObject=ce,j.isEmptyObject=function(ve){var Oe;for(Oe in ve)return!1;return!0},j.isNumeric=function(ve){var Oe=Number(ve),Ke=typeof ve;return ve!=null&&Ke!="boolean"&&(Ke!="string"||ve.length)&&!isNaN(Oe)&&isFinite(Oe)||!1},j.inArray=function(ve,Oe,Ke){return C.indexOf.call(Oe,ve,Ke)},j.camelCase=F,j.trim=function(ve){return ve==null?"":String.prototype.trim.call(ve)},j.uuid=0,j.support={},j.expr={},j.noop=function(){},j.map=function(ve,Oe){var Ke,nt,vt,mt,Qt=[];if(me(ve))for(nt=0;nt<ve.length;nt++)(Ke=Oe(ve[nt],nt))!=null&&Qt.push(Ke);else for(vt in ve)(Ke=Oe(ve[vt],vt))!=null&&Qt.push(Ke);return(mt=Qt).length>0?j.fn.concat.apply([],mt):mt},j.each=function(ve,Oe){var Ke,nt;if(me(ve)){for(Ke=0;Ke<ve.length;Ke++)if(Oe.call(ve[Ke],Ke,ve[Ke])===!1)return ve}else for(nt in ve)if(Oe.call(ve[nt],nt,ve[nt])===!1)return ve;return ve},j.grep=function(ve,Oe){return G.call(ve,Oe)},window.JSON&&(j.parseJSON=JSON.parse),j.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(ve,Oe){v["[object "+Oe+"]"]=Oe.toLowerCase()}),j.fn={constructor:D.Z,length:0,forEach:C.forEach,reduce:C.reduce,push:C.push,sort:C.sort,splice:C.splice,indexOf:C.indexOf,concat:function(){var ve,Oe,Ke=[];for(ve=0;ve<arguments.length;ve++)Oe=arguments[ve],Ke[ve]=D.isZ(Oe)?Oe.toArray():Oe;return z.apply(D.isZ(this)?this.toArray():this,Ke)},map:function(ve){return j(j.map(this,function(Oe,Ke){return ve.call(Oe,Ke,Oe)}))},slice:function(){return j(de.apply(this,arguments))},ready:function(ve){return P.test(te.readyState)&&te.body?ve(j):te.addEventListener("DOMContentLoaded",function(){ve(j)},!1),this},get:function(ve){return ve===J?de.call(this):this[ve>=0?ve:ve+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(ve){return C.every.call(this,function(Oe,Ke){return ve.call(Oe,Ke,Oe)!==!1}),this},filter:function(ve){return R(ve)?this.not(this.not(ve)):j(G.call(this,function(Oe){return D.matches(Oe,ve)}))},add:function(ve,Oe){return j(re(this.concat(j(ve,Oe))))},is:function(ve){return this.length>0&&D.matches(this[0],ve)},not:function(ve){var Oe=[];if(R(ve)&&ve.call!==J)this.each(function(nt){ve.call(this,nt)||Oe.push(this)});else{var Ke=typeof ve=="string"?this.filter(ve):me(ve)&&R(ve.item)?de.call(ve):j(ve);this.forEach(function(nt){Ke.indexOf(nt)<0&&Oe.push(nt)})}return j(Oe)},has:function(ve){return this.filter(function(){return fe(ve)?j.contains(this,ve):j(this).find(ve).size()})},eq:function(ve){return ve===-1?this.slice(ve):this.slice(ve,+ve+1)},first:function(){var ve=this[0];return ve&&!fe(ve)?ve:j(ve)},last:function(){var ve=this[this.length-1];return ve&&!fe(ve)?ve:j(ve)},find:function(ve){var Oe=this;return ve?typeof ve=="object"?j(ve).filter(function(){var Ke=this;return C.some.call(Oe,function(nt){return j.contains(nt,Ke)})}):this.length==1?j(D.qsa(this[0],ve)):this.map(function(){return D.qsa(this,ve)}):j()},closest:function(ve,Oe){var Ke=[],nt=typeof ve=="object"&&j(ve);return this.each(function(vt,mt){for(;mt&&!(nt?nt.indexOf(mt)>=0:D.matches(mt,ve));)mt=mt!==Oe&&!ae(mt)&&mt.parentNode;mt&&Ke.indexOf(mt)<0&&Ke.push(mt)}),j(Ke)},parents:function(ve){for(var Oe=[],Ke=this;Ke.length>0;)Ke=j.map(Ke,function(nt){if((nt=nt.parentNode)&&!ae(nt)&&Oe.indexOf(nt)<0)return Oe.push(nt),nt});return Xe(Oe,ve)},parent:function(ve){return Xe(re(this.pluck("parentNode")),ve)},children:function(ve){return Xe(this.map(function(){return Ce(this)}),ve)},contents:function(){return this.map(function(){return this.contentDocument||de.call(this.childNodes)})},siblings:function(ve){return Xe(this.map(function(Oe,Ke){return G.call(Ce(Ke.parentNode),function(nt){return nt!==Ke})}),ve)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(ve){return j.map(this,function(Oe){return Oe[ve]})},show:function(){return this.each(function(){var ve,Oe,Ke;this.style.display=="none"&&(this.style.display=""),getComputedStyle(this,"").getPropertyValue("display")=="none"&&(this.style.display=(ve=this.nodeName,le[ve]||(Oe=te.createElement(ve),te.body.appendChild(Oe),Ke=getComputedStyle(Oe,"").getPropertyValue("display"),Oe.parentNode.removeChild(Oe),Ke=="none"&&(Ke="block"),le[ve]=Ke),le[ve]))})},replaceWith:function(ve){return this.before(ve).remove()},wrap:function(ve){var Oe=R(ve);if(this[0]&&!Oe)var Ke=j(ve).get(0),nt=Ke.parentNode||this.length>1;return this.each(function(vt){j(this).wrapAll(Oe?ve.call(this,vt):nt?Ke.cloneNode(!0):Ke)})},wrapAll:function(ve){if(this[0]){var Oe;for(j(this[0]).before(ve=j(ve));(Oe=ve.children()).length;)ve=Oe.first();j(ve).append(this)}return this},wrapInner:function(ve){var Oe=R(ve);return this.each(function(Ke){var nt=j(this),vt=nt.contents(),mt=Oe?ve.call(this,Ke):ve;vt.length?vt.wrapAll(mt):nt.append(mt)})},unwrap:function(){return this.parent().each(function(){j(this).replaceWith(j(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(ve){return this.each(function(){var Oe=j(this);(ve===J?Oe.css("display")=="none":ve)?Oe.show():Oe.hide()})},prev:function(ve){return j(this.pluck("previousElementSibling")).filter(ve||"*")},next:function(ve){return j(this.pluck("nextElementSibling")).filter(ve||"*")},html:function(ve){return 0 in arguments?this.each(function(Oe){var Ke=this.innerHTML;j(this).empty().append(ut(this,ve,Oe,Ke))}):0 in this?this[0].innerHTML:null},text:function(ve){return 0 in arguments?this.each(function(Oe){var Ke=ut(this,ve,Oe,this.textContent);this.textContent=Ke==null?"":""+Ke}):0 in this?this.pluck("textContent").join(""):null},attr:function(ve,Oe){var Ke;return typeof ve!="string"||1 in arguments?this.each(function(nt){if(this.nodeType===1)if(fe(ve))for(ee in ve)gt(this,ee,ve[ee]);else gt(this,ve,ut(this,Oe,nt,this.getAttribute(ve)))}):0 in this&&this[0].nodeType==1&&(Ke=this[0].getAttribute(ve))!=null?Ke:J},removeAttr:function(ve){return this.each(function(){this.nodeType===1&&ve.split(" ").forEach(function(Oe){gt(this,Oe)},this)})},prop:function(ve,Oe){return ve=K[ve]||ve,1 in arguments?this.each(function(Ke){this[ve]=ut(this,Oe,Ke,this[ve])}):this[0]&&this[0][ve]},removeProp:function(ve){return ve=K[ve]||ve,this.each(function(){delete this[ve]})},data:function(ve,Oe){var Ke="data-"+ve.replace(V,"-$1").toLowerCase(),nt=1 in arguments?this.attr(Ke,Oe):this.attr(Ke);return nt!==null?St(nt):J},val:function(ve){return 0 in arguments?(ve==null&&(ve=""),this.each(function(Oe){this.value=ut(this,ve,Oe,this.value)})):this[0]&&(this[0].multiple?j(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(ve){if(ve)return this.each(function(Ke){var nt=j(this),vt=ut(this,ve,Ke,nt.offset()),mt=nt.offsetParent().offset(),Qt={top:vt.top-mt.top,left:vt.left-mt.left};nt.css("position")=="static"&&(Qt.position="relative"),nt.css(Qt)});if(!this.length)return null;if(te.documentElement!==this[0]&&!j.contains(te.documentElement,this[0]))return{top:0,left:0};var Oe=this[0].getBoundingClientRect();return{left:Oe.left+window.pageXOffset,top:Oe.top+window.pageYOffset,width:Math.round(Oe.width),height:Math.round(Oe.height)}},css:function(ve,Oe){if(arguments.length<2){var Ke=this[0];if(typeof ve=="string")return Ke?Ke.style[F(ve)]||getComputedStyle(Ke,"").getPropertyValue(ve):void 0;if(k(ve)){if(!Ke)return;var nt={},vt=getComputedStyle(Ke,"");return j.each(ve,function(Qt,Yt){nt[Yt]=Ke.style[F(Yt)]||vt.getPropertyValue(Yt)}),nt}}var mt="";if(L(ve)=="string")Oe||Oe===0?mt=Ee(ve)+":"+Re(ve,Oe):this.each(function(){this.style.removeProperty(Ee(ve))});else for(ee in ve)ve[ee]||ve[ee]===0?mt+=Ee(ee)+":"+Re(ee,ve[ee])+";":this.each(function(){this.style.removeProperty(Ee(ee))});return this.each(function(){this.style.cssText+=";"+mt})},index:function(ve){return ve?this.indexOf(j(ve)[0]):this.parent().children().indexOf(this[0])},hasClass:function(ve){return!!ve&&C.some.call(this,function(Oe){return this.test(ft(Oe))},be(ve))},addClass:function(ve){return ve?this.each(function(Oe){if("className"in this){y=[];var Ke=ft(this);ut(this,ve,Oe,Ke).split(/\s+/g).forEach(function(nt){j(this).hasClass(nt)||y.push(nt)},this),y.length&&ft(this,Ke+(Ke?" ":"")+y.join(" "))}}):this},removeClass:function(ve){return this.each(function(Oe){if("className"in this){if(ve===J)return ft(this,"");y=ft(this),ut(this,ve,Oe,y).split(/\s+/g).forEach(function(Ke){y=y.replace(be(Ke)," ")}),ft(this,y.trim())}})},toggleClass:function(ve,Oe){return ve?this.each(function(Ke){var nt=j(this);ut(this,ve,Ke,ft(this)).split(/\s+/g).forEach(function(vt){(Oe===J?!nt.hasClass(vt):Oe)?nt.addClass(vt):nt.removeClass(vt)})}):this},scrollTop:function(ve){if(this.length){var Oe="scrollTop"in this[0];return ve===J?Oe?this[0].scrollTop:this[0].pageYOffset:this.each(Oe?function(){this.scrollTop=ve}:function(){this.scrollTo(this.scrollX,ve)})}},scrollLeft:function(ve){if(this.length){var Oe="scrollLeft"in this[0];return ve===J?Oe?this[0].scrollLeft:this[0].pageXOffset:this.each(Oe?function(){this.scrollLeft=ve}:function(){this.scrollTo(ve,this.scrollY)})}},position:function(){if(this.length){var ve=this[0],Oe=this.offsetParent(),Ke=this.offset(),nt=Y.test(Oe[0].nodeName)?{top:0,left:0}:Oe.offset();return Ke.top-=parseFloat(j(ve).css("margin-top"))||0,Ke.left-=parseFloat(j(ve).css("margin-left"))||0,nt.top+=parseFloat(j(Oe[0]).css("border-top-width"))||0,nt.left+=parseFloat(j(Oe[0]).css("border-left-width"))||0,{top:Ke.top-nt.top,left:Ke.left-nt.left}}},offsetParent:function(){return this.map(function(){for(var ve=this.offsetParent||te.body;ve&&!Y.test(ve.nodeName)&&j(ve).css("position")=="static";)ve=ve.offsetParent;return ve})}},j.fn.detach=j.fn.remove,["width","height"].forEach(function(ve){var Oe=ve.replace(/./,function(Ke){return Ke[0].toUpperCase()});j.fn[ve]=function(Ke){var nt,vt=this[0];return Ke===J?Z(vt)?vt["inner"+Oe]:ae(vt)?vt.documentElement["scroll"+Oe]:(nt=this.offset())&&nt[ve]:this.each(function(mt){(vt=j(this)).css(ve,ut(this,Ke,mt,vt[ve]()))})}}),["after","prepend","before","append"].forEach(function(ve,Oe){var Ke=Oe%2;j.fn[ve]=function(){var nt,vt,mt=j.map(arguments,function(Yt){var Wt=[];return(nt=L(Yt))=="array"?(Yt.forEach(function(ni){return ni.nodeType!==J?Wt.push(ni):j.zepto.isZ(ni)?Wt=Wt.concat(ni.get()):void(Wt=Wt.concat(D.fragment(ni)))}),Wt):nt=="object"||Yt==null?Yt:D.fragment(Yt)}),Qt=this.length>1;return mt.length<1?this:this.each(function(Yt,Wt){vt=Ke?Wt:Wt.parentNode,Wt=Oe==0?Wt.nextSibling:Oe==1?Wt.firstChild:Oe==2?Wt:null;var ni=j.contains(te.documentElement,vt);mt.forEach(function(Vt){if(Qt)Vt=Vt.cloneNode(!0);else if(!vt)return j(Vt).remove();vt.insertBefore(Vt,Wt),ni&&Et(Vt,function(bi){if(!(bi.nodeName==null||bi.nodeName.toUpperCase()!=="SCRIPT"||bi.type&&bi.type!=="text/javascript"||bi.src)){var sr=bi.ownerDocument?bi.ownerDocument.defaultView:window;sr.eval.call(sr,bi.innerHTML)}})})})},j.fn[Ke?ve+"To":"insert"+(Oe?"Before":"After")]=function(nt){return j(nt)[ve](this),this}}),D.Z.prototype=Ne.prototype=j.fn,D.uniq=re,D.deserializeValue=St,j.zepto=D,j}();window.Zepto=kn,window.$===void 0&&(window.$=kn),function(J){var ee,j,y=+new Date,F=window.document,re=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,C=/^(?:text|application)\/javascript/i,z=/^(?:text|application)\/xml/i,G="application/json",de="text/html",te=/^\s*$/,le=F.createElement("a");function Q(w,P,_,v){if(w.global)return function(A,D,O){var K=J.Event(D);return J(A).trigger(K,O),!K.isDefaultPrevented()}(P||F,_,v)}function X(w,P){var _=P.context;if(P.beforeSend.call(_,w,P)===!1||Q(P,_,"ajaxBeforeSend",[w,P])===!1)return!1;Q(P,_,"ajaxSend",[w,P])}function ie(w,P,_,v){var A=_.context,D="success";_.success.call(A,w,D,P),v&&v.resolveWith(A,[w,D,P]),Q(_,A,"ajaxSuccess",[P,_,w]),se(D,P,_)}function W(w,P,_,v,A){var D=v.context;v.error.call(D,_,P,w),A&&A.rejectWith(D,[_,P,w]),Q(v,D,"ajaxError",[_,v,w||P]),se(P,_,v)}function se(w,P,_){var v=_.context;_.complete.call(v,P,w),Q(_,v,"ajaxComplete",[P,_]),function(A){A.global&&!--J.active&&Q(A,null,"ajaxStop")}(_)}function Y(){}function V(w,P){return P==""?w:(w+"&"+P).replace(/[&?]{1,2}/,"?")}function M(w,P,_,v){return J.isFunction(P)&&(v=_,_=P,P=void 0),J.isFunction(_)||(v=_,_=void 0),{url:w,data:P,success:_,dataType:v}}le.href=window.location.href,J.active=0,J.ajaxJSONP=function(w,P){if(!("type"in w))return J.ajax(w);var _,v,A=w.jsonpCallback,D=(J.isFunction(A)?A():A)||"Zepto"+y++,O=F.createElement("script"),K=window[D],k=function(R){J(O).triggerHandler("error",R||"abort")},L={abort:k};return P&&P.promise(L),J(O).on("load error",function(R,Z){clearTimeout(v),J(O).off().remove(),R.type!="error"&&_?ie(_[0],L,w,P):W(null,Z||"error",L,w,P),window[D]=K,_&&J.isFunction(K)&&K(_[0]),K=_=void 0}),X(L,w)===!1?(k("abort"),L):(window[D]=function(){_=arguments},O.src=w.url.replace(/\?(.+)=\?/,"?$1="+D),F.head.appendChild(O),w.timeout>0&&(v=setTimeout(function(){k("timeout")},w.timeout)),L)},J.ajaxSettings={type:"GET",beforeSend:Y,success:Y,error:Y,complete:Y,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:G,xml:"application/xml, text/xml",html:de,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:Y},J.ajax=function(w){var P,_,v=J.extend({},w||{}),A=J.Deferred&&J.Deferred();for(ee in J.ajaxSettings)v[ee]===void 0&&(v[ee]=J.ajaxSettings[ee]);(function(me){me.global&&J.active++==0&&Q(me,null,"ajaxStart")})(v),v.crossDomain||((P=F.createElement("a")).href=v.url,P.href=P.href,v.crossDomain=le.protocol+"//"+le.host!=P.protocol+"//"+P.host),v.url||(v.url=window.location.toString()),(_=v.url.indexOf("#"))>-1&&(v.url=v.url.slice(0,_)),function(me){me.processData&&me.data&&J.type(me.data)!="string"&&(me.data=J.param(me.data,me.traditional)),!me.data||me.type&&me.type.toUpperCase()!="GET"&&me.dataType!="jsonp"||(me.url=V(me.url,me.data),me.data=void 0)}(v);var D=v.dataType,O=/\?.+=\?/.test(v.url);if(O&&(D="jsonp"),v.cache!==!1&&(w&&w.cache===!0||D!="script"&&D!="jsonp")||(v.url=V(v.url,"_="+Date.now())),D=="jsonp")return O||(v.url=V(v.url,v.jsonp?v.jsonp+"=?":v.jsonp===!1?"":"callback=?")),J.ajaxJSONP(v,A);var K,k=v.accepts[D],L={},R=function(me,Ee){L[me.toLowerCase()]=[me,Ee]},Z=/^([\w-]+:)\/\//.test(v.url)?RegExp.$1:window.location.protocol,ae=v.xhr(),fe=ae.setRequestHeader;if(A&&A.promise(ae),v.crossDomain||R("X-Requested-With","XMLHttpRequest"),R("Accept",k||"*/*"),(k=v.mimeType||k)&&(k.indexOf(",")>-1&&(k=k.split(",",2)[0]),ae.overrideMimeType&&ae.overrideMimeType(k)),(v.contentType||v.contentType!==!1&&v.data&&v.type.toUpperCase()!="GET")&&R("Content-Type",v.contentType||"application/x-www-form-urlencoded"),v.headers)for(j in v.headers)R(j,v.headers[j]);if(ae.setRequestHeader=R,ae.onreadystatechange=function(){if(ae.readyState==4){ae.onreadystatechange=Y,clearTimeout(K);var me,Ee=!1;if(ae.status>=200&&ae.status<300||ae.status==304||ae.status==0&&Z=="file:"){if(D=D||function(be){return be&&(be=be.split(";",2)[0]),be&&(be==de?"html":be==G?"json":C.test(be)?"script":z.test(be)&&"xml")||"text"}(v.mimeType||ae.getResponseHeader("content-type")),ae.responseType=="arraybuffer"||ae.responseType=="blob")me=ae.response;else{me=ae.responseText;try{me=function(be,Re,Ce){if(Ce.dataFilter==Y)return be;var Ne=Ce.context;return Ce.dataFilter.call(Ne,be,Re)}(me,D,v),D=="script"?(0,eval)(me):D=="xml"?me=ae.responseXML:D=="json"&&(me=te.test(me)?null:J.parseJSON(me))}catch(be){Ee=be}if(Ee)return W(Ee,"parsererror",ae,v,A)}ie(me,ae,v,A)}else W(ae.statusText||null,ae.status?"error":"abort",ae,v,A)}},X(ae,v)===!1)return ae.abort(),W(null,"abort",ae,v,A),ae;var ce=!("async"in v)||v.async;if(ae.open(v.type,v.url,ce,v.username,v.password),v.xhrFields)for(j in v.xhrFields)ae[j]=v.xhrFields[j];for(j in L)fe.apply(ae,L[j]);return v.timeout>0&&(K=setTimeout(function(){ae.onreadystatechange=Y,ae.abort(),W(null,"timeout",ae,v,A)},v.timeout)),ae.send(v.data?v.data:null),ae},J.get=function(){return J.ajax(M.apply(null,arguments))},J.post=function(){var w=M.apply(null,arguments);return w.type="POST",J.ajax(w)},J.getJSON=function(){var w=M.apply(null,arguments);return w.dataType="json",J.ajax(w)},J.fn.load=function(w,P,_){if(!this.length)return this;var v,A=this,D=w.split(/\s/),O=M(w,P,_),K=O.success;return D.length>1&&(O.url=D[0],v=D[1]),O.success=function(k){A.html(v?J("<div>").html(k.replace(re,"")).find(v):k),K&&K.apply(A,arguments)},J.ajax(O),this};var b=encodeURIComponent;function I(w,P,_,v){var A,D=J.isArray(P),O=J.isPlainObject(P);J.each(P,function(K,k){A=J.type(k),v&&(K=_?v:v+"["+(O||A=="object"||A=="array"?K:"")+"]"),!v&&D?w.add(k.name,k.value):A=="array"||!_&&A=="object"?I(w,k,_,K):w.add(K,k)})}J.param=function(w,P){var _=[];return _.add=function(v,A){J.isFunction(A)&&(A=A()),A==null&&(A=""),this.push(b(v)+"="+b(A))},I(_,w,P),_.join("&").replace(/%20/g,"+")}}(kn),(pn=kn).Callbacks=function(J){J=pn.extend({},J);var ee,j,y,F,re,C,z=[],G=!J.once&&[],de=function(le){for(ee=J.memory&&le,j=!0,C=F||0,F=0,re=z.length,y=!0;z&&C<re;++C)if(z[C].apply(le[0],le[1])===!1&&J.stopOnFalse){ee=!1;break}y=!1,z&&(G?G.length&&de(G.shift()):ee?z.length=0:te.disable())},te={add:function(){if(z){var le=z.length,Q=function(X){pn.each(X,function(ie,W){typeof W=="function"?J.unique&&te.has(W)||z.push(W):W&&W.length&&typeof W!="string"&&Q(W)})};Q(arguments),y?re=z.length:ee&&(F=le,de(ee))}return this},remove:function(){return z&&pn.each(arguments,function(le,Q){for(var X;(X=pn.inArray(Q,z,X))>-1;)z.splice(X,1),y&&(X<=re&&--re,X<=C&&--C)}),this},has:function(le){return!(!z||!(le?pn.inArray(le,z)>-1:z.length))},empty:function(){return re=z.length=0,this},disable:function(){return z=G=ee=void 0,this},disabled:function(){return!z},lock:function(){return G=void 0,ee||te.disable(),this},locked:function(){return!G},fireWith:function(le,Q){return!z||j&&!G||(Q=[le,(Q=Q||[]).slice?Q.slice():Q],y?G.push(Q):de(Q)),this},fire:function(){return te.fireWith(this,arguments)},fired:function(){return!!j}};return te},function(J){var ee=Array.prototype.slice;function j(y){var F=[["resolve","done",J.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",J.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",J.Callbacks({memory:1})]],re="pending",C={state:function(){return re},always:function(){return z.done(arguments).fail(arguments),this},then:function(){var G=arguments;return j(function(de){J.each(F,function(te,le){var Q=J.isFunction(G[te])&&G[te];z[le[1]](function(){var X=Q&&Q.apply(this,arguments);if(X&&J.isFunction(X.promise))X.promise().done(de.resolve).fail(de.reject).progress(de.notify);else{var ie=this===C?de.promise():this,W=Q?[X]:arguments;de[le[0]+"With"](ie,W)}})}),G=null}).promise()},promise:function(G){return G!=null?J.extend(G,C):C}},z={};return J.each(F,function(G,de){var te=de[2],le=de[3];C[de[1]]=te.add,le&&te.add(function(){re=le},F[1^G][2].disable,F[2][2].lock),z[de[0]]=function(){return z[de[0]+"With"](this===z?C:this,arguments),this},z[de[0]+"With"]=te.fireWith}),C.promise(z),y&&y.call(z,z),z}J.when=function(y){var F,re,C,z=ee.call(arguments),G=z.length,de=0,te=G!==1||y&&J.isFunction(y.promise)?G:0,le=te===1?y:j(),Q=function(X,ie,W){return function(se){ie[X]=this,W[X]=arguments.length>1?ee.call(arguments):se,W===F?le.notifyWith(ie,W):--te||le.resolveWith(ie,W)}};if(G>1)for(F=new Array(G),re=new Array(G),C=new Array(G);de<G;++de)z[de]&&J.isFunction(z[de].promise)?z[de].promise().done(Q(de,C,z)).fail(le.reject).progress(Q(de,re,F)):--te;return te||le.resolveWith(C,z),le.promise()},J.Deferred=j}(kn),function(J){var ee,j=1,y=Array.prototype.slice,F=J.isFunction,re=function(_){return typeof _=="string"},C={},z={},G="onfocusin"in window,de={focus:"focusin",blur:"focusout"},te={mouseenter:"mouseover",mouseleave:"mouseout"};function le(_){return _._zid||(_._zid=j++)}function Q(_,v,A,D){if((v=X(v)).ns)var O=(K=v.ns,new RegExp("(?:^| )"+K.replace(" "," .* ?")+"(?: |$)"));var K;return(C[le(_)]||[]).filter(function(k){return k&&(!v.e||k.e==v.e)&&(!v.ns||O.test(k.ns))&&(!A||le(k.fn)===le(A))&&(!D||k.sel==D)})}function X(_){var v=(""+_).split(".");return{e:v[0],ns:v.slice(1).sort().join(" ")}}function ie(_,v){return _.del&&!G&&_.e in de||!!v}function W(_){return te[_]||G&&de[_]||_}function se(_,v,A,D,O,K,k){var L=le(_),R=C[L]||(C[L]=[]);v.split(/\s/).forEach(function(Z){if(Z=="ready")return J(document).ready(A);var ae=X(Z);ae.fn=A,ae.sel=O,ae.e in te&&(A=function(ce){var me=ce.relatedTarget;if(!me||me!==this&&!J.contains(this,me))return ae.fn.apply(this,arguments)}),ae.del=K;var fe=K||A;ae.proxy=function(ce){if(!(ce=w(ce)).isImmediatePropagationStopped()){ce.data=D;var me=fe.apply(_,ce._args==ee?[ce]:[ce].concat(ce._args));return me===!1&&(ce.preventDefault(),ce.stopPropagation()),me}},ae.i=R.length,R.push(ae),"addEventListener"in _&&_.addEventListener(W(ae.e),ae.proxy,ie(ae,k))})}function Y(_,v,A,D,O){var K=le(_);(v||"").split(/\s/).forEach(function(k){Q(_,k,A,D).forEach(function(L){delete C[K][L.i],"removeEventListener"in _&&_.removeEventListener(W(L.e),L.proxy,ie(L,O))})})}z.click=z.mousedown=z.mouseup=z.mousemove="MouseEvents",J.event={add:se,remove:Y},J.proxy=function(_,v){var A=2 in arguments&&y.call(arguments,2);if(F(_)){var D=function(){return _.apply(v,A?A.concat(y.call(arguments)):arguments)};return D._zid=le(_),D}if(re(v))return A?(A.unshift(_[v],_),J.proxy.apply(null,A)):J.proxy(_[v],_);throw new TypeError("expected function")},J.fn.bind=function(_,v,A){return this.on(_,v,A)},J.fn.unbind=function(_,v){return this.off(_,v)},J.fn.one=function(_,v,A,D){return this.on(_,v,A,D,1)};var V=function(){return!0},M=function(){return!1},b=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,I={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};function w(_,v){return!v&&_.isDefaultPrevented||(v||(v=_),J.each(I,function(A,D){var O=v[A];_[A]=function(){return this[D]=V,O&&O.apply(v,arguments)},_[D]=M}),_.timeStamp||(_.timeStamp=Date.now()),(v.defaultPrevented!==ee?v.defaultPrevented:"returnValue"in v?v.returnValue===!1:v.getPreventDefault&&v.getPreventDefault())&&(_.isDefaultPrevented=V)),_}function P(_){var v,A={originalEvent:_};for(v in _)b.test(v)||_[v]===ee||(A[v]=_[v]);return w(A,_)}J.fn.delegate=function(_,v,A){return this.on(v,_,A)},J.fn.undelegate=function(_,v,A){return this.off(v,_,A)},J.fn.live=function(_,v){return J(document.body).delegate(this.selector,_,v),this},J.fn.die=function(_,v){return J(document.body).undelegate(this.selector,_,v),this},J.fn.on=function(_,v,A,D,O){var K,k,L=this;return _&&!re(_)?(J.each(_,function(R,Z){L.on(R,v,A,Z,O)}),L):(re(v)||F(D)||D===!1||(D=A,A=v,v=ee),D!==ee&&A!==!1||(D=A,A=ee),D===!1&&(D=M),L.each(function(R,Z){O&&(K=function(ae){return Y(Z,ae.type,D),D.apply(this,arguments)}),v&&(k=function(ae){var fe,ce=J(ae.target).closest(v,Z).get(0);if(ce&&ce!==Z)return fe=J.extend(P(ae),{currentTarget:ce,liveFired:Z}),(K||D).apply(ce,[fe].concat(y.call(arguments,1)))}),se(Z,_,D,A,v,k||K)}))},J.fn.off=function(_,v,A){var D=this;return _&&!re(_)?(J.each(_,function(O,K){D.off(O,v,K)}),D):(re(v)||F(A)||A===!1||(A=v,v=ee),A===!1&&(A=M),D.each(function(){Y(this,_,A,v)}))},J.fn.trigger=function(_,v){return(_=re(_)||J.isPlainObject(_)?J.Event(_):w(_))._args=v,this.each(function(){_.type in de&&typeof this[_.type]=="function"?this[_.type]():"dispatchEvent"in this?this.dispatchEvent(_):J(this).triggerHandler(_,v)})},J.fn.triggerHandler=function(_,v){var A,D;return this.each(function(O,K){(A=P(re(_)?J.Event(_):_))._args=v,A.target=K,J.each(Q(K,_.type||_),function(k,L){if(D=L.proxy(A),A.isImmediatePropagationStopped())return!1})}),D},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(_){J.fn[_]=function(v){return 0 in arguments?this.bind(_,v):this.trigger(_)}}),J.Event=function(_,v){re(_)||(_=(v=_).type);var A=document.createEvent(z[_]||"Events"),D=!0;if(v)for(var O in v)O=="bubbles"?D=!!v[O]:A[O]=v[O];return A.initEvent(_,D,!0),w(A)}}(kn),function(){try{getComputedStyle(void 0)}catch{var J=getComputedStyle;window.getComputedStyle=function(j,y){try{return J(j,y)}catch{return null}}}}(),function(J){var ee=J.zepto,j=ee.qsa,y=ee.matches;function F(te){return!(!(te=J(te)).width()&&!te.height())&&te.css("display")!=="none"}var re=J.expr[":"]={visible:function(){if(F(this))return this},hidden:function(){if(!F(this))return this},selected:function(){if(this.selected)return this},checked:function(){if(this.checked)return this},parent:function(){return this.parentNode},first:function(te){if(te===0)return this},last:function(te,le){if(te===le.length-1)return this},eq:function(te,le,Q){if(te===Q)return this},contains:function(te,le,Q){if(J(this).text().indexOf(Q)>-1)return this},has:function(te,le,Q){if(ee.qsa(this,Q).length)return this}},C=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),z=/^\s*>/,G="Zepto"+ +new Date;function de(te,le){te=te.replace(/=#\]/g,'="#"]');var Q,X,ie=C.exec(te);if(ie&&ie[2]in re&&(Q=re[ie[2]],X=ie[3],te=ie[1],X)){var W=Number(X);X=isNaN(W)?X.replace(/^["']|["']$/g,""):W}return le(te,Q,X)}ee.qsa=function(te,le){return de(le,function(Q,X,ie){try{var W;!Q&&X?Q="*":z.test(Q)&&(W=J(te).addClass(G),Q="."+G+" "+Q);var se=j(te,Q)}catch(Y){throw console.error("error performing selector: %o",le),Y}finally{W&&W.removeClass(G)}return X?ee.uniq(J.map(se,function(Y,V){return X.call(Y,V,se,ie)})):se})},ee.matches=function(te,le){return de(le,function(Q,X,ie){return(!Q||y(te,Q))&&(!X||X.call(te,null,ie)===te)})}}(kn);var eo,_e,Pt,je=kn,en=[{name:"Chromium",group:"Chrome",identifier:"Chromium/([0-9.]*)"},{name:"Chrome Mobile",group:"Chrome",identifier:"Chrome/([0-9.]*) Mobile",versionIdentifier:"Chrome/([0-9.]*)"},{name:"Chrome",group:"Chrome",identifier:"Chrome/([0-9.]*)"},{name:"Chrome for iOS",group:"Chrome",identifier:"CriOS/([0-9.]*)"},{name:"Android Browser",group:"Chrome",identifier:"CrMo/([0-9.]*)"},{name:"Firefox",group:"Firefox",identifier:"Firefox/([0-9.]*)"},{name:"Opera Mini",group:"Opera",identifier:"Opera Mini/([0-9.]*)"},{name:"Opera",group:"Opera",identifier:"Opera ([0-9.]*)"},{name:"Opera",group:"Opera",identifier:"Opera/([0-9.]*)",versionIdentifier:"Version/([0-9.]*)"},{name:"IEMobile",group:"Explorer",identifier:"IEMobile/([0-9.]*)"},{name:"Internet Explorer",group:"Explorer",identifier:"MSIE ([a-zA-Z0-9.]*)"},{name:"Internet Explorer",group:"Explorer",identifier:"Trident/([0-9.]*)",versionIdentifier:"rv:([0-9.]*)"},{name:"Spartan",group:"Spartan",identifier:"Edge/([0-9.]*)",versionIdentifier:"Edge/([0-9.]*)"},{name:"Safari",group:"Safari",identifier:"Safari/([0-9.]*)",versionIdentifier:"Version/([0-9.]*)"}],ts=[{name:"Windows 2000",group:"Windows",identifier:"Windows NT 5.0",version:"5.0"},{name:"Windows XP",group:"Windows",identifier:"Windows NT 5.1",version:"5.1"},{name:"Windows Vista",group:"Windows",identifier:"Windows NT 6.0",version:"6.0"},{name:"Windows 7",group:"Windows",identifier:"Windows NT 6.1",version:"7.0"},{name:"Windows 8",group:"Windows",identifier:"Windows NT 6.2",version:"8.0"},{name:"Windows 8.1",group:"Windows",identifier:"Windows NT 6.3",version:"8.1"},{name:"Windows 10",group:"Windows",identifier:"Windows NT 10.0",version:"10.0"},{name:"Windows Phone",group:"Windows Phone",identifier:"Windows Phone ([0-9.]*)"},{name:"Windows Phone",group:"Windows Phone",identifier:"Windows Phone OS ([0-9.]*)"},{name:"Windows",group:"Windows",identifier:"Windows"},{name:"Chrome OS",group:"Chrome OS",identifier:"CrOS"},{name:"Android",group:"Android",identifier:"Android",versionIdentifier:"Android ([a-zA-Z0-9.-]*)"},{name:"iPad",group:"iOS",identifier:"iPad",versionIdentifier:"OS ([0-9_]*)",versionSeparator:"[_|.]"},{name:"iPod",group:"iOS",identifier:"iPod",versionIdentifier:"OS ([0-9_]*)",versionSeparator:"[_|.]"},{name:"iPhone",group:"iOS",identifier:"iPhone OS",versionIdentifier:"OS ([0-9_]*)",versionSeparator:"[_|.]"},{name:"Mac OS X High Sierra",group:"Mac OS",identifier:"Mac OS X (10([_|.])13([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Sierra",group:"Mac OS",identifier:"Mac OS X (10([_|.])12([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X El Capitan",group:"Mac OS",identifier:"Mac OS X (10([_|.])11([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Yosemite",group:"Mac OS",identifier:"Mac OS X (10([_|.])10([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Mavericks",group:"Mac OS",identifier:"Mac OS X (10([_|.])9([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Mountain Lion",group:"Mac OS",identifier:"Mac OS X (10([_|.])8([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Lion",group:"Mac OS",identifier:"Mac OS X (10([_|.])7([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Snow Leopard",group:"Mac OS",identifier:"Mac OS X (10([_|.])6([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Leopard",group:"Mac OS",identifier:"Mac OS X (10([_|.])5([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Tiger",group:"Mac OS",identifier:"Mac OS X (10([_|.])4([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Panther",group:"Mac OS",identifier:"Mac OS X (10([_|.])3([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Jaguar",group:"Mac OS",identifier:"Mac OS X (10([_|.])2([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Puma",group:"Mac OS",identifier:"Mac OS X (10([_|.])1([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS X Cheetah",group:"Mac OS",identifier:"Mac OS X (10([_|.])0([0-9_.]*))",versionSeparator:"[_|.]"},{name:"Mac OS",group:"Mac OS",identifier:"Mac OS"},{name:"Ubuntu",group:"Linux",identifier:"Ubuntu",versionIdentifier:"Ubuntu/([0-9.]*)"},{name:"Debian",group:"Linux",identifier:"Debian"},{name:"Gentoo",group:"Linux",identifier:"Gentoo"},{name:"Linux",group:"Linux",identifier:"Linux"},{name:"BlackBerry",group:"BlackBerry",identifier:"BlackBerry"}],_t={},to=function(J,ee){var j=J.split(".",2);ee.fullVersion=J,j[0]&&(ee.majorVersion=parseInt(j[0])),j[1]&&(ee.minorVersion=parseInt(j[1]))},Ks=function(J,ee,j){var y=ee.substr(0,1)=="["?new RegExp(ee,"g"):ee,F=J.split(y,2);ee!="."&&(J=J.replace(new RegExp(ee,"g"),".")),j.fullVersion=J,F&&F[0]&&(j.majorVersion=parseInt(F[0])),F&&F[1]&&(j.minorVersion=parseInt(F[1]))},Co=function(J){var ee,j=J.match(/\b(playstation 4|nx|opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(j[1]))return ee=/\brv[ :]+(\d+)/g.exec(J)||[],{name:"IE",version:parseInt(ee[1]||"")};if(j[1]==="Chrome"){if((ee=J.match(/\bOPR\/(\d+)/))!=null)return{name:"Opera",version:parseInt(ee[1])};if((ee=J.match(/\bEdge\/(\d+)/))!=null)return{name:"Edge",version:parseInt(ee[1])}}else/android/i.test(J)&&(ee=J.match(/version\/(\d+)/i))&&(j.splice(1,1,"Android WebView"),j.splice(2,1,ee[1]));return{name:(j=j[2]?[j[1],j[2]]:[navigator.appName,navigator.appVersion,"-?"])[0],version:parseInt(j[1])}}(navigator.userAgent);_t.isEdge=/Edg|EdgiOS|EdgA/i.test(navigator.userAgent),_t.isChrome=/Chrome|CriOS/i.test(navigator.userAgent)&&!_t.isEdge,_t.isSafari=/Safari/i.test(navigator.userAgent)&&!_t.isChrome&&!_t.isEdge,_t.isFirefox=/Firefox/i.test(navigator.userAgent),_t.isLegacyIE=!!window.ActiveXObject,_t.isIE=_t.isLegacyIE||/trident.*rv:1\d/i.test(navigator.userAgent),_t.isIE11=/trident.*rv:11/i.test(navigator.userAgent),_t.isChromecast=_t.isChrome&&/CrKey/i.test(navigator.userAgent),_t.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|IEMobile|Mobile Safari|Opera Mini/i.test(navigator.userAgent),_t.isiOS=/iPad|iPhone|iPod/i.test(navigator.userAgent),_t.isAndroid=/Android/i.test(navigator.userAgent),_t.isWindowsPhone=/Windows Phone/i.test(navigator.userAgent),_t.isWin8App=/MSAppHost/i.test(navigator.userAgent),_t.isWiiU=/WiiU/i.test(navigator.userAgent),_t.isPS4=/PlayStation 4/i.test(navigator.userAgent),_t.hasLocalstorage=function(){try{return localStorage.setItem("clappr","clappr"),localStorage.removeItem("clappr"),!0}catch{return!1}}(),_t.hasFlash=function(){try{return!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch{return!(!navigator.mimeTypes||navigator.mimeTypes["application/x-shockwave-flash"]===void 0||!navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)}}(),_t.name=Co.name,_t.version=Co.version,_t.userAgent=navigator.userAgent,_t.data=function(){var J,ee={},j=_t.userAgent.toLowerCase(),y=Za(en);try{for(y.s();!(J=y.n()).done;){var F=J.value,re=new RegExp(F.identifier.toLowerCase()).exec(j);if(re!=null&&re[1]){if(ee.name=F.name,ee.group=F.group,F.versionIdentifier){var C=new RegExp(F.versionIdentifier.toLowerCase()).exec(j);C!=null&&C[1]&&to(C[1],ee)}else to(re[1],ee);break}}}catch(z){y.e(z)}finally{y.f()}return ee}(),_t.os=function(){var J,ee={},j=_t.userAgent.toLowerCase(),y=Za(ts);try{for(y.s();!(J=y.n()).done;){var F=J.value,re=new RegExp(F.identifier.toLowerCase()).exec(j);if(re!=null){if(ee.name=F.name,ee.group=F.group,F.version)Ks(F.version,F.versionSeparator?F.versionSeparator:".",ee);else if(re[1])Ks(re[1],F.versionSeparator?F.versionSeparator:".",ee);else if(F.versionIdentifier){var C=new RegExp(F.versionIdentifier.toLowerCase()).exec(j);C!=null&&C[1]&&Ks(C[1],F.versionSeparator?F.versionSeparator:".",ee)}break}}}catch(z){y.e(z)}finally{y.f()}return ee}(),_t.isWindows=/^Windows$/i.test(_t.os.group),_t.isMacOS=/^Mac OS$/i.test(_t.os.group),_t.isLinux=/^Linux$/i.test(_t.os.group),_t.viewport=((eo={}).width=je(window).width(),eo.height=je(window).height(),eo),_t.device=(_e=_t.userAgent,(Pt=/\((iP(?:hone|ad|od))?(?:[^;]*; ){0,2}([^)]+(?=\)))/.exec(_e))&&(Pt[1]||Pt[2])||""),window.orientation!==void 0&&function(){switch(window.orientation){case-90:case 90:_t.viewport.orientation="landscape";break;default:_t.viewport.orientation="portrait"}}();var Qe={},qs=[],$s=(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(J){window.setTimeout(J,1e3/60)}).bind(window),Ti=(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout).bind(window);function ba(J,ee){if(ee)for(var j in ee){var y=Object.getOwnPropertyDescriptor(ee,j);y?Object.defineProperty(J,j,y):J[j]=ee[j]}return J}function Vn(J,ee){var j=function(y){Bt(re,y);var F=$i(re);function re(){var C;ri(this,re);for(var z=arguments.length,G=new Array(z),de=0;de<z;de++)G[de]=arguments[de];return C=F.call.apply(F,[this].concat(G)),ee.initialize&&ee.initialize.apply(zt(C),G),C}return ai(re)}(J);return ba(j.prototype,ee),j}var Hn={fullscreenElement:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},requestFullscreen:function(J){if(J.requestFullscreen)return J.requestFullscreen();if(J.webkitRequestFullscreen){if(typeof J.then=="function")return J.webkitRequestFullscreen();J.webkitRequestFullscreen()}else{if(J.mozRequestFullScreen)return J.mozRequestFullScreen();if(J.msRequestFullscreen)return J.msRequestFullscreen();J.querySelector&&J.querySelector("video")&&J.querySelector("video").webkitEnterFullScreen?J.querySelector("video").webkitEnterFullScreen():J.webkitEnterFullScreen&&J.webkitEnterFullScreen()}},cancelFullscreen:function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document;J.exitFullscreen?J.exitFullscreen():J.webkitCancelFullScreen?J.webkitCancelFullScreen():J.webkitExitFullscreen?J.webkitExitFullscreen():J.mozCancelFullScreen?J.mozCancelFullScreen():J.msExitFullscreen&&J.msExitFullscreen()},fullscreenEnabled:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},ps=function(){function J(){ri(this,J)}return ai(J,null,[{key:"_defaultConfig",value:function(){return{volume:{value:100,parse:parseInt}}}},{key:"_defaultValueFor",value:function(ee){try{return this._defaultConfig()[ee].parse(this._defaultConfig()[ee].value)}catch{return}}},{key:"_createKeyspace",value:function(ee){return"clappr.".concat(document.domain,".").concat(ee)}},{key:"restore",value:function(ee){return _t.hasLocalstorage&&localStorage[this._createKeyspace(ee)]?this._defaultConfig()[ee].parse(localStorage[this._createKeyspace(ee)]):this._defaultValueFor(ee)}},{key:"persist",value:function(ee,j){if(_t.hasLocalstorage)try{return localStorage[this._createKeyspace(ee)]=j,!0}catch{return!1}}}]),J}(),ti=function(){function J(){ri(this,J)}return ai(J,null,[{key:"params",get:function(){var ee=window.location.search.substring(1);return ee!==this.query&&(this._urlParams=this.parse(ee),this.query=ee),this._urlParams}},{key:"hashParams",get:function(){var ee=window.location.hash.substring(1);return ee!==this.hash&&(this._hashParams=this.parse(ee),this.hash=ee),this._hashParams}},{key:"parse",value:function(ee){for(var j,y=/\+/g,F=/([^&=]+)=?([^&]*)/g,re=function(z){return decodeURIComponent(z.replace(y," "))},C={};j=F.exec(ee);)C[re(j[1]).toLowerCase()]=re(j[2]);return C}}]),J}();function Dn(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"t",ee=0,j=ti.params[J]||ti.hashParams[J]||"",y=j.match(/[0-9]+[hms]+/g)||[];if(y.length>0){var F={h:3600,m:60,s:1};y.forEach(function(re){if(re){var C=re[re.length-1],z=parseInt(re.slice(0,re.length-1),10);ee+=z*F[C]}})}else j&&(ee=parseInt(j,10));return ee}function Gi(J){return Qe[J]||(Qe[J]=0),J+ ++Qe[J]}function gs(J){return J-parseFloat(J)+1>=0}function ko(){var J=document.getElementsByTagName("script");return J.length?J[J.length-1].src:""}function Do(){return window.navigator&&window.navigator.language}function io(J,ee){var j=(ee=Object.assign({inline:!1,muted:!1,timeout:250,type:"video",source:Ct.mp4,element:null},ee)).element?ee.element:document.createElement(ee.type);j.muted=ee.muted,ee.muted===!0&&j.setAttribute("muted","muted"),ee.inline===!0&&j.setAttribute("playsinline","playsinline"),j.src=ee.source;var y=j.play(),F=setTimeout(function(){re(!1,new Error("Timeout ".concat(ee.timeout," ms has been reached")))},ee.timeout),re=function(C){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;clearTimeout(F),J(C,z)};y!==void 0?y.then(function(){return re(!0)}).catch(function(C){return re(!1,C)}):re(!0)}var gn=function(){function J(){ri(this,J)}return ai(J,null,[{key:"configure",value:function(ee){this.options=je.extend(!0,this.options,ee)}},{key:"create",value:function(ee){return this.options.recycleVideo&&ee==="video"&&qs.length>0?qs.shift():document.createElement(ee)}},{key:"garbage",value:function(ee){this.options.recycleVideo&&ee.tagName.toUpperCase()==="VIDEO"&&(je(ee).children().remove(),Object.values(ee.attributes).forEach(function(j){return ee.removeAttribute(j.name)}),qs.push(ee))}}]),J}();gn.options={recycleVideo:!1};var ms=function(){function J(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:500;ri(this,J),this.delay=ee,this.lastTime=0}return ai(J,[{key:"handle",value:function(ee,j){var y=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],F=new Date().getTime(),re=F-this.lastTime;re<this.delay&&re>0&&(j(),y&&ee.preventDefault()),this.lastTime=F}}]),J}(),mn={Config:ps,Fullscreen:Hn,QueryString:ti,DomRecycler:gn,assign:ba,extend:Vn,formatTime:function(J,ee){if(!isFinite(J))return"--:--";J*=1e3;var j=(J=parseInt(J/1e3))%60,y=(J=parseInt(J/60))%60,F=(J=parseInt(J/60))%24,re=parseInt(J/24),C="";return re&&re>0&&(C+=re+":",F<1&&(C+="00:")),(F&&F>0||ee)&&(C+=("0"+F).slice(-2)+":"),C+=("0"+y).slice(-2)+":",(C+=("0"+j).slice(-2)).trim()},seekStringToSeconds:Dn,uniqueId:Gi,currentScriptUrl:ko,isNumber:gs,requestAnimationFrame:$s,cancelAnimationFrame:Ti,getBrowserLanguage:Do,now:function(){return window.performance&&window.performance.now?performance.now():Date.now()},removeArrayItem:function(J,ee){var j=J.indexOf(ee);j>=0&&J.splice(j,1)},listContainsIgnoreCase:function(J,ee){return J!==void 0&&ee!==void 0&&ee.find(function(j){return J.toLowerCase()===j.toLowerCase()})!==void 0},canAutoPlayMedia:io,Media:Ct,DoubleEventHandler:ms},vs="font-weight: bold; font-size: 13px;",Rt="color: #ff8000;"+vs,ii="color: #ff0000;"+vs,gr=["color: #0000ff;"+vs,"color: #006600;"+vs,Rt,ii,ii],ys=["debug","info","warn","error","disabled"],Gt=function(){function J(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;ri(this,J),this.EXCLUDE_LIST=["timeupdate","playback:timeupdate","playback:progress","container:hover","container:timeupdate","container:progress"],this.level=ee,this.previousLevel=this.level,this.offLevel=j}return ai(J,[{key:"level",get:function(){return this._level},set:function(ee){this._level=ee}},{key:"debug",value:function(ee){this.log(ee,0,Array.prototype.slice.call(arguments,1))}},{key:"info",value:function(ee){this.log(ee,1,Array.prototype.slice.call(arguments,1))}},{key:"warn",value:function(ee){this.log(ee,2,Array.prototype.slice.call(arguments,1))}},{key:"error",value:function(ee){this.log(ee,3,Array.prototype.slice.call(arguments,1))}},{key:"onOff",value:function(){this.level===this.offLevel?this.level=this.previousLevel:(this.previousLevel=this.level,this.level=this.offLevel),window.console&&window.console.log&&window.console.log("%c[Clappr.Log] set log level to "+ys[this.level],Rt)}},{key:"log",value:function(ee,j,y){if(!(this.EXCLUDE_LIST.indexOf(y[0])>=0||j<this.level)){y||(y=ee,ee=null);var F=gr[j],re="";ee&&(re="["+ee+"]"),window.console&&window.console.log&&window.console.log.apply(console,["%c["+ys[j]+"]"+re,F].concat(y))}}}]),J}();Gt.LEVEL_DEBUG=0,Gt.LEVEL_INFO=1,Gt.LEVEL_WARN=2,Gt.LEVEL_ERROR=3,Gt.getInstance=function(){return this._instance===void 0&&(this._instance=new this),this._instance},Gt.setLevel=function(J){this.getInstance().level=J},Gt.debug=function(){this.getInstance().debug.apply(this.getInstance(),arguments)},Gt.info=function(){this.getInstance().info.apply(this.getInstance(),arguments)},Gt.warn=function(){this.getInstance().warn.apply(this.getInstance(),arguments)},Gt.error=function(){this.getInstance().error.apply(this.getInstance(),arguments)};var Aa=Array.prototype.slice,ro=/\s+/,Ts=function(J,ee,j,y){if(!j)return!0;if(fs(j)==="object"){for(var F in j)J[ee].apply(J,[F,j[F]].concat(y));return!1}if(ro.test(j)){for(var re=j.split(ro),C=0,z=re.length;C<z;C++)J[ee].apply(J,[re[C]].concat(y));return!1}return!0},wn=function(J,ee,j,y){var F,re=-1,C=J.length,z=ee[0],G=ee[1],de=ee[2];(function te(){try{switch(ee.length){case 0:for(;++re<C;)(F=J[re]).callback.call(F.ctx);return;case 1:for(;++re<C;)(F=J[re]).callback.call(F.ctx,z);return;case 2:for(;++re<C;)(F=J[re]).callback.call(F.ctx,z,G);return;case 3:for(;++re<C;)(F=J[re]).callback.call(F.ctx,z,G,de);return;default:for(;++re<C;)(F=J[re]).callback.apply(F.ctx,ee);return}}catch(le){Gt.error.apply(Gt,[j,"error on event",y,"trigger","-",le]),te()}})()},Ae=function(){function J(){ri(this,J)}return ai(J,[{key:"on",value:function(ee,j,y){return Ts(this,"on",ee,[j,y])&&j?(this._events||(this._events={}),(this._events[ee]||(this._events[ee]=[])).push({callback:j,context:y,ctx:y||this}),this):this}},{key:"once",value:function(ee,j,y){var F,re=this;if(!Ts(this,"once",ee,[j,y])||!j)return this;var C=function(){return re.off(ee,F)};return F=function(){C(),j.apply(this,arguments)},this.on(ee,F,y)}},{key:"off",value:function(ee,j,y){var F,re,C,z,G,de,te,le;if(!this._events||!Ts(this,"off",ee,[j,y]))return this;if(!ee&&!j&&!y)return this._events=void 0,this;for(G=0,de=(z=ee?[ee]:Object.keys(this._events)).length;G<de;G++)if(ee=z[G],C=this._events[ee]){if(this._events[ee]=F=[],j||y)for(te=0,le=C.length;te<le;te++)re=C[te],(j&&j!==re.callback&&j!==re.callback._callback||y&&y!==re.context)&&F.push(re);F.length||delete this._events[ee]}return this}},{key:"trigger",value:function(ee){var j=this.name||this.constructor.name;if(Gt.debug.apply(Gt,[j].concat(Array.prototype.slice.call(arguments))),!this._events)return this;var y=Aa.call(arguments,1);if(!Ts(this,"trigger",ee,y))return this;var F=this._events[ee],re=this._events.all;return F&&wn(F,y,j,ee),re&&wn(re,arguments,j,ee),this}},{key:"stopListening",value:function(ee,j,y){var F=this._listeningTo;if(!F)return this;var re=!j&&!y;for(var C in y||fs(j)!=="object"||(y=this),ee&&((F={})[ee._listenId]=ee),F)(ee=F[C]).off(j,y,this),(re||Object.keys(ee._events).length===0)&&delete this._listeningTo[C];return this}}],[{key:"register",value:function(ee){J.Custom||(J.Custom={});var j=typeof ee=="string"&&ee.toUpperCase().trim();j&&!J.Custom[j]?J.Custom[j]=j.toLowerCase().split("_").map(function(y,F){return F===0?y:y=y[0].toUpperCase()+y.slice(1)}).join(""):Gt.error("Events","Error when register event: "+ee)}},{key:"listAvailableCustomEvents",value:function(){return J.Custom||(J.Custom={}),Object.keys(J.Custom).filter(function(ee){return typeof J.Custom[ee]=="string"})}}]),J}(),Es={listenTo:"on",listenToOnce:"once"};Object.keys(Es).forEach(function(J){Ae.prototype[J]=function(ee,j,y){return(this._listeningTo||(this._listeningTo={}))[ee._listenId||(ee._listenId=Gi("l"))]=ee,y||fs(j)!=="object"||(y=this),ee[Es[J]](j,y,this),this}}),Ae.PLAYER_READY="ready",Ae.PLAYER_RESIZE="resize",Ae.PLAYER_FULLSCREEN="fullscreen",Ae.PLAYER_PLAY="play",Ae.PLAYER_PAUSE="pause",Ae.PLAYER_STOP="stop",Ae.PLAYER_ENDED="ended",Ae.PLAYER_SEEK="seek",Ae.PLAYER_ERROR="playererror",Ae.ERROR="error",Ae.PLAYER_TIMEUPDATE="timeupdate",Ae.PLAYER_VOLUMEUPDATE="volumeupdate",Ae.PLAYER_SUBTITLE_AVAILABLE="subtitleavailable",Ae.PLAYBACK_PROGRESS="playback:progress",Ae.PLAYBACK_TIMEUPDATE="playback:timeupdate",Ae.PLAYBACK_READY="playback:ready",Ae.PLAYBACK_BUFFERING="playback:buffering",Ae.PLAYBACK_BUFFERFULL="playback:bufferfull",Ae.PLAYBACK_SETTINGSUPDATE="playback:settingsupdate",Ae.PLAYBACK_LOADEDMETADATA="playback:loadedmetadata",Ae.PLAYBACK_HIGHDEFINITIONUPDATE="playback:highdefinitionupdate",Ae.PLAYBACK_BITRATE="playback:bitrate",Ae.PLAYBACK_LEVELS_AVAILABLE="playback:levels:available",Ae.PLAYBACK_LEVEL_SWITCH_START="playback:levels:switch:start",Ae.PLAYBACK_LEVEL_SWITCH_END="playback:levels:switch:end",Ae.PLAYBACK_PLAYBACKSTATE="playback:playbackstate",Ae.PLAYBACK_DVR="playback:dvr",Ae.PLAYBACK_MEDIACONTROL_DISABLE="playback:mediacontrol:disable",Ae.PLAYBACK_MEDIACONTROL_ENABLE="playback:mediacontrol:enable",Ae.PLAYBACK_ENDED="playback:ended",Ae.PLAYBACK_PLAY_INTENT="playback:play:intent",Ae.PLAYBACK_PLAY="playback:play",Ae.PLAYBACK_PAUSE="playback:pause",Ae.PLAYBACK_SEEK="playback:seek",Ae.PLAYBACK_SEEKED="playback:seeked",Ae.PLAYBACK_STOP="playback:stop",Ae.PLAYBACK_ERROR="playback:error",Ae.PLAYBACK_STATS_ADD="playback:stats:add",Ae.PLAYBACK_FRAGMENT_LOADED="playback:fragment:loaded",Ae.PLAYBACK_LEVEL_SWITCH="playback:level:switch",Ae.PLAYBACK_SUBTITLE_AVAILABLE="playback:subtitle:available",Ae.PLAYBACK_SUBTITLE_CHANGED="playback:subtitle:changed",Ae.PLAYBACK_AUDIO_AVAILABLE="playback:audio:available",Ae.PLAYBACK_AUDIO_CHANGED="playback:audio:changed",Ae.CORE_CONTAINERS_CREATED="core:containers:created",Ae.CORE_ACTIVE_CONTAINER_CHANGED="core:active:container:changed",Ae.CORE_OPTIONS_CHANGE="core:options:change",Ae.CORE_READY="core:ready",Ae.CORE_FULLSCREEN="core:fullscreen",Ae.CORE_RESIZE="core:resize",Ae.CORE_SCREEN_ORIENTATION_CHANGED="core:screen:orientation:changed",Ae.CORE_MOUSE_MOVE="core:mousemove",Ae.CORE_MOUSE_LEAVE="core:mouseleave",Ae.CONTAINER_PLAYBACKSTATE="container:playbackstate",Ae.CONTAINER_PLAYBACKDVRSTATECHANGED="container:dvr",Ae.CONTAINER_BITRATE="container:bitrate",Ae.CONTAINER_STATS_REPORT="container:stats:report",Ae.CONTAINER_DESTROYED="container:destroyed",Ae.CONTAINER_READY="container:ready",Ae.CONTAINER_RESIZE="container:resize",Ae.CONTAINER_ERROR="container:error",Ae.CONTAINER_LOADEDMETADATA="container:loadedmetadata",Ae.CONTAINER_SUBTITLE_AVAILABLE="container:subtitle:available",Ae.CONTAINER_SUBTITLE_CHANGED="container:subtitle:changed",Ae.CONTAINER_AUDIO_AVAILABLE="container:audio:available",Ae.CONTAINER_AUDIO_CHANGED="container:audio:changed",Ae.CONTAINER_TIMEUPDATE="container:timeupdate",Ae.CONTAINER_PROGRESS="container:progress",Ae.CONTAINER_PLAY="container:play",Ae.CONTAINER_STOP="container:stop",Ae.CONTAINER_PAUSE="container:pause",Ae.CONTAINER_ENDED="container:ended",Ae.CONTAINER_CLICK="container:click",Ae.CONTAINER_DBLCLICK="container:dblclick",Ae.CONTAINER_CONTEXTMENU="container:contextmenu",Ae.CONTAINER_MOUSE_ENTER="container:mouseenter",Ae.CONTAINER_MOUSE_LEAVE="container:mouseleave",Ae.CONTAINER_MOUSE_UP="container:mouseup",Ae.CONTAINER_MOUSE_DOWN="container:mousedown",Ae.CONTAINER_SEEK="container:seek",Ae.CONTAINER_SEEKED="container:seeked",Ae.CONTAINER_VOLUME="container:volume",Ae.CONTAINER_FULLSCREEN="container:fullscreen",Ae.CONTAINER_STATE_BUFFERING="container:state:buffering",Ae.CONTAINER_STATE_BUFFERFULL="container:state:bufferfull",Ae.CONTAINER_SETTINGSUPDATE="container:settingsupdate",Ae.CONTAINER_HIGHDEFINITIONUPDATE="container:highdefinitionupdate",Ae.CONTAINER_MEDIACONTROL_SHOW="container:mediacontrol:show",Ae.CONTAINER_MEDIACONTROL_HIDE="container:mediacontrol:hide",Ae.CONTAINER_MEDIACONTROL_DISABLE="container:mediacontrol:disable",Ae.CONTAINER_MEDIACONTROL_ENABLE="container:mediacontrol:enable",Ae.CONTAINER_STATS_ADD="container:stats:add",Ae.CONTAINER_OPTIONS_CHANGE="container:options:change",Ae.MEDIACONTROL_RENDERED="mediacontrol:rendered",Ae.MEDIACONTROL_FULLSCREEN="mediacontrol:fullscreen",Ae.MEDIACONTROL_SHOW="mediacontrol:show",Ae.MEDIACONTROL_HIDE="mediacontrol:hide",Ae.MEDIACONTROL_MOUSEMOVE_SEEKBAR="mediacontrol:mousemove:seekbar",Ae.MEDIACONTROL_MOUSELEAVE_SEEKBAR="mediacontrol:mouseleave:seekbar",Ae.MEDIACONTROL_PLAYING="mediacontrol:playing",Ae.MEDIACONTROL_NOTPLAYING="mediacontrol:notplaying",Ae.MEDIACONTROL_CONTAINERCHANGED="mediacontrol:containerchanged",Ae.MEDIACONTROL_OPTIONS_CHANGE="mediacontrol:options:change";var lr=function(J){Bt(j,J);var ee=$i(j);function j(){var y,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ri(this,j),(y=ee.call(this,F))._options=F,y.uniqueId=Gi("o"),y}return ai(j,[{key:"options",get:function(){return this._options}}]),j}(Ae),Ln={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Sa=/(.)^/,In={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},is=/\\|'|\r|\n|\t|\u2028|\u2029/g,no={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},so=new RegExp(`[&<>"']`,"g"),Ws=function(J){return J===null?"":(""+J).replace(so,function(ee){return no[ee]})},yl=0,mr=function(J,ee){var j,y=new RegExp([(Ln.escape||Sa).source,(Ln.interpolate||Sa).source,(Ln.evaluate||Sa).source].join("|")+"|$","g"),F=0,re="__p+='";J.replace(y,function(z,G,de,te,le){return re+=J.slice(F,le).replace(is,function(Q){return"\\"+In[Q]}),G&&(re+=`'+
((__t=(`+G+`))==null?'':escapeExpr(__t))+
'`),de&&(re+=`'+
((__t=(`+de+`))==null?'':__t)+
'`),te&&(re+=`';
`+te+`
__p+='`),F=le+z.length,z}),re+=`';
`,Ln.variable||(re=`with(obj||{}){
`+re+`}
`),re=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+re+`return __p;
//# sourceURL=/microtemplates/source[`+yl+++"]";try{j=new Function(Ln.variable||"obj","escapeExpr",re)}catch(z){throw z.source=re,z}if(ee)return j(ee,Ws);var C=function(z){return j.call(this,z,Ws)};return C.source="function("+(Ln.variable||"obj")+`){
`+re+"}",C};mr.settings=Ln;var vr={getStyleFor:function(J){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{baseUrl:""};return je('<style class="clappr-style"></style>').html(mr(J.toString())(ee))}},xa=/^(\S+)\s*(.*)$/,jr=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y)).cid=Gi("c"),F._ensureElement(),F.delegateEvents(),F}return ai(j,[{key:"tagName",get:function(){return"div"}},{key:"events",get:function(){return{}}},{key:"attributes",get:function(){return{}}},{key:"$",value:function(y){return this.$el.find(y)}},{key:"render",value:function(){return this}},{key:"destroy",value:function(){return this.$el.remove(),this.stopListening(),this.undelegateEvents(),this}},{key:"setElement",value:function(y,F){return this.$el&&this.undelegateEvents(),this.$el=je.zepto.isZ(y)?y:je(y),this.el=this.$el[0],F!==!1&&this.delegateEvents(),this}},{key:"delegateEvents",value:function(y){for(var F in y||(y=this.events),this.undelegateEvents(),y){var re=y[F];if(re&&re.constructor!==Function&&(re=this[y[F]]),re){var C=F.match(xa),z=C[1],G=C[2];z+=".delegateEvents"+this.cid,G===""?this.$el.on(z,re.bind(this)):this.$el.on(z,G,re.bind(this))}}return this}},{key:"undelegateEvents",value:function(){return this.$el.off(".delegateEvents"+this.cid),this}},{key:"_ensureElement",value:function(){if(this.el)this.setElement(this.el,!1);else{var y=je.extend(!0,{},this.attributes);this.id&&(y.id=this.id),this.className&&(y.class=this.className);var F=je(gn.create(this.tagName)).attr(y);this.setElement(F,!1)}}}]),j}(lr),Kr=function(J){Bt(j,J);var ee=$i(j);function j(){var y,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},re=arguments.length>1?arguments[1]:void 0;return ri(this,j),(y=ee.call(this,F)).core=re,y}return ai(j,[{key:"name",get:function(){return"error"}},{key:"createError",value:function(y){this.core?this.core.trigger(Ae.ERROR,y):Gt.warn(this.name,"Core is not set. Error: ",y)}}],[{key:"Levels",get:function(){return{FATAL:"FATAL",WARN:"WARN",INFO:"INFO"}}}]),j}(lr),qr={createError:function(J){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{useCodePrefix:!0},j=this.constructor&&this.constructor.type||"",y=this.name||j,F=this.i18n||this.core&&this.core.i18n||this.container&&this.container.i18n,re="".concat(y,":").concat(J&&J.code||"unknown"),C={description:"",level:Kr.Levels.FATAL,origin:y,scope:j,raw:{}},z=Object.assign({},C,J,{code:ee.useCodePrefix?re:J.code});if(F&&z.level==Kr.Levels.FATAL&&!z.UI){var G={title:F.t("default_error_title"),message:F.t("default_error_message")};z.UI=G}return this.playerError?this.playerError.createError(z):Gt.warn(y,"PlayerError is not defined. Error: ",z),z}},Vi=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y.options)).core=y,F.enabled=!0,F.bindEvents(),F.render(),F}return ai(j,[{key:"playerError",get:function(){return this.core.playerError}},{key:"bindEvents",value:function(){}},{key:"getExternalInterface",value:function(){return{}}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.$el.show(),this.enabled=!0)}},{key:"disable",value:function(){this.stopListening(),this.$el.hide(),this.enabled=!1}},{key:"render",value:function(){return this}}]),j}(jr);Object.assign(Vi.prototype,qr),Vi.extend=function(J){return Vn(Vi,J)},Vi.type="core";var zs=function(J){Bt(j,J);var ee=$i(j);function j(y,F,re){var C;return ri(this,j),(C=ee.call(this,y))._i18n=F,C.currentTime=0,C.volume=100,C.playback=y.playback,C.playerError=re,C.settings=je.extend(!0,{},C.playback.settings),C.isReady=!1,C.mediaControlDisabled=!1,C.plugins=[C.playback],C.dblTapHandler=new ms(500),C.clickTimer=null,C.clickDelay=200,C.actionsMetadata={},C.bindEvents(),C}return ai(j,[{key:"name",get:function(){return"Container"}},{key:"attributes",get:function(){return{class:"container","data-container":""}}},{key:"events",get:function(){return{click:"clicked",dblclick:"dblClicked",touchend:"dblTap",contextmenu:"onContextMenu",mouseenter:"mouseEnter",mouseleave:"mouseLeave",mouseup:"onMouseUp",mousedown:"onMouseDown"}}},{key:"ended",get:function(){return this.playback.ended}},{key:"buffering",get:function(){return this.playback.buffering}},{key:"i18n",get:function(){return this._i18n}},{key:"hasClosedCaptionsTracks",get:function(){return this.playback.hasClosedCaptionsTracks}},{key:"closedCaptionsTracks",get:function(){return this.playback.closedCaptionsTracks}},{key:"closedCaptionsTrackId",get:function(){return this.playback.closedCaptionsTrackId},set:function(y){this.playback.closedCaptionsTrackId=y}},{key:"audioTracks",get:function(){return this.playback.audioTracks}},{key:"currentAudioTrack",get:function(){return this.playback.currentAudioTrack}},{key:"bindEvents",value:function(){this.listenTo(this.playback,Ae.PLAYBACK_PROGRESS,this.onProgress),this.listenTo(this.playback,Ae.PLAYBACK_TIMEUPDATE,this.timeUpdated),this.listenTo(this.playback,Ae.PLAYBACK_READY,this.ready),this.listenTo(this.playback,Ae.PLAYBACK_BUFFERING,this.onBuffering),this.listenTo(this.playback,Ae.PLAYBACK_BUFFERFULL,this.bufferfull),this.listenTo(this.playback,Ae.PLAYBACK_SETTINGSUPDATE,this.settingsUpdate),this.listenTo(this.playback,Ae.PLAYBACK_LOADEDMETADATA,this.loadedMetadata),this.listenTo(this.playback,Ae.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinitionUpdate),this.listenTo(this.playback,Ae.PLAYBACK_BITRATE,this.updateBitrate),this.listenTo(this.playback,Ae.PLAYBACK_PLAYBACKSTATE,this.playbackStateChanged),this.listenTo(this.playback,Ae.PLAYBACK_DVR,this.playbackDvrStateChanged),this.listenTo(this.playback,Ae.PLAYBACK_MEDIACONTROL_DISABLE,this.disableMediaControl),this.listenTo(this.playback,Ae.PLAYBACK_MEDIACONTROL_ENABLE,this.enableMediaControl),this.listenTo(this.playback,Ae.PLAYBACK_SEEK,this.onSeek),this.listenTo(this.playback,Ae.PLAYBACK_SEEKED,this.onSeeked),this.listenTo(this.playback,Ae.PLAYBACK_ENDED,this.onEnded),this.listenTo(this.playback,Ae.PLAYBACK_PLAY,this.playing),this.listenTo(this.playback,Ae.PLAYBACK_PAUSE,this.paused),this.listenTo(this.playback,Ae.PLAYBACK_STOP,this.stopped),this.listenTo(this.playback,Ae.PLAYBACK_ERROR,this.error),this.listenTo(this.playback,Ae.PLAYBACK_SUBTITLE_AVAILABLE,this.subtitleAvailable),this.listenTo(this.playback,Ae.PLAYBACK_SUBTITLE_CHANGED,this.subtitleChanged),this.listenTo(this.playback,Ae.PLAYBACK_AUDIO_AVAILABLE,this.audioAvailable),this.listenTo(this.playback,Ae.PLAYBACK_AUDIO_CHANGED,this.audioChanged)}},{key:"subtitleAvailable",value:function(){this.trigger(Ae.CONTAINER_SUBTITLE_AVAILABLE)}},{key:"subtitleChanged",value:function(y){this.trigger(Ae.CONTAINER_SUBTITLE_CHANGED,y)}},{key:"audioAvailable",value:function(y){this.trigger(Ae.CONTAINER_AUDIO_AVAILABLE,y)}},{key:"audioChanged",value:function(y){this.trigger(Ae.CONTAINER_AUDIO_CHANGED,y)}},{key:"playbackStateChanged",value:function(y){this.trigger(Ae.CONTAINER_PLAYBACKSTATE,y)}},{key:"playbackDvrStateChanged",value:function(y){this.settings=this.playback.settings,this.dvrInUse=y,this.trigger(Ae.CONTAINER_PLAYBACKDVRSTATECHANGED,y)}},{key:"updateBitrate",value:function(y){this.trigger(Ae.CONTAINER_BITRATE,y)}},{key:"statsReport",value:function(y){this.trigger(Ae.CONTAINER_STATS_REPORT,y)}},{key:"getPlaybackType",value:function(){return this.playback.getPlaybackType()}},{key:"isDvrEnabled",value:function(){return!!this.playback.dvrEnabled}},{key:"isDvrInUse",value:function(){return!!this.dvrInUse}},{key:"destroy",value:function(){this.disableResizeObserver(),this.trigger(Ae.CONTAINER_DESTROYED,this,this.name),this.stopListening(),this.plugins.forEach(function(y){return y.destroy()}),this.$el.remove()}},{key:"setStyle",value:function(y){this.$el.css(y)}},{key:"animate",value:function(y,F){return this.$el.animate(y,F).promise()}},{key:"ready",value:function(){this.isReady=!0,this.trigger(Ae.CONTAINER_READY,this.name)}},{key:"isPlaying",value:function(){return this.playback.isPlaying()}},{key:"getStartTimeOffset",value:function(){return this.playback.getStartTimeOffset()}},{key:"getCurrentTime",value:function(){return this.currentTime}},{key:"getDuration",value:function(){return this.playback.getDuration()}},{key:"error",value:function(y){this.isReady||this.ready(),this.trigger(Ae.CONTAINER_ERROR,y,this.name)}},{key:"loadedMetadata",value:function(y){this.trigger(Ae.CONTAINER_LOADEDMETADATA,y)}},{key:"timeUpdated",value:function(y){this.currentTime=y.current,this.trigger(Ae.CONTAINER_TIMEUPDATE,y,this.name)}},{key:"onProgress",value:function(){for(var y=arguments.length,F=new Array(y),re=0;re<y;re++)F[re]=arguments[re];this.trigger.apply(this,[Ae.CONTAINER_PROGRESS].concat(F,[this.name]))}},{key:"playing",value:function(){this.trigger(Ae.CONTAINER_PLAY,this.name,this.actionsMetadata.playEvent||{}),this.actionsMetadata.playEvent={}}},{key:"paused",value:function(){this.trigger(Ae.CONTAINER_PAUSE,this.name,this.actionsMetadata.pauseEvent||{}),this.actionsMetadata.pauseEvent={}}},{key:"stopped",value:function(){this.trigger(Ae.CONTAINER_STOP,this.actionsMetadata.stopEvent||{}),this.actionsMetadata.stopEvent={}}},{key:"play",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.actionsMetadata.playEvent=y,this.playback.play(y)}},{key:"stop",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.actionsMetadata.stopEvent=y,this.playback.stop(y),this.currentTime=0}},{key:"switchAudioTrack",value:function(y){this.playback.switchAudioTrack(y)}},{key:"pause",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.actionsMetadata.pauseEvent=y,this.playback.pause(y)}},{key:"onEnded",value:function(){this.trigger(Ae.CONTAINER_ENDED,this,this.name),this.currentTime=0}},{key:"clicked",value:function(){var y=this;this.options.chromeless&&!this.options.allowUserInteraction||(this.clickTimer=setTimeout(function(){y.clickTimer&&y.trigger(Ae.CONTAINER_CLICK,y,y.name)},this.clickDelay))}},{key:"cancelClicked",value:function(){clearTimeout(this.clickTimer),this.clickTimer=null}},{key:"dblClicked",value:function(){this.options.chromeless&&!this.options.allowUserInteraction||(this.cancelClicked(),this.trigger(Ae.CONTAINER_DBLCLICK,this,this.name))}},{key:"dblTap",value:function(y){var F=this;this.options.chromeless&&!this.options.allowUserInteraction||this.dblTapHandler.handle(y,function(){F.cancelClicked(),F.trigger(Ae.CONTAINER_DBLCLICK,F,F.name)})}},{key:"onContextMenu",value:function(y){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(Ae.CONTAINER_CONTEXTMENU,y,this.name)}},{key:"seek",value:function(y){this.playback.seek(y)}},{key:"onSeek",value:function(y){this.trigger(Ae.CONTAINER_SEEK,y,this.name)}},{key:"onSeeked",value:function(){this.trigger(Ae.CONTAINER_SEEKED,this.name)}},{key:"seekPercentage",value:function(y){var F=this.getDuration();if(y>=0&&y<=100){var re=F*(y/100);this.seek(re)}}},{key:"setVolume",value:function(y){this.volume=parseFloat(y),this.trigger(Ae.CONTAINER_VOLUME,this.volume,this.name),this.playback.volume(this.volume)}},{key:"fullscreen",value:function(){this.trigger(Ae.CONTAINER_FULLSCREEN,this.name)}},{key:"onBuffering",value:function(){this.trigger(Ae.CONTAINER_STATE_BUFFERING,this.name)}},{key:"bufferfull",value:function(){this.trigger(Ae.CONTAINER_STATE_BUFFERFULL,this.name)}},{key:"addPlugin",value:function(y){this.plugins.push(y)}},{key:"hasPlugin",value:function(y){return!!this.getPlugin(y)}},{key:"getPlugin",value:function(y){return this.plugins.filter(function(F){return F.name===y})[0]}},{key:"mouseEnter",value:function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(Ae.CONTAINER_MOUSE_ENTER)}},{key:"mouseLeave",value:function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(Ae.CONTAINER_MOUSE_LEAVE)}},{key:"mouseUp",value:function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(Ae.CONTAINER_MOUSE_UP)}},{key:"mouseDown",value:function(){this.options.chromeless&&!this.options.allowUserInteraction||this.trigger(Ae.CONTAINER_MOUSE_DOWN)}},{key:"settingsUpdate",value:function(){this.settings=this.playback.settings,this.trigger(Ae.CONTAINER_SETTINGSUPDATE)}},{key:"highDefinitionUpdate",value:function(y){this.trigger(Ae.CONTAINER_HIGHDEFINITIONUPDATE,y)}},{key:"isHighDefinitionInUse",value:function(){return this.playback.isHighDefinitionInUse()}},{key:"disableMediaControl",value:function(){this.mediaControlDisabled||(this.mediaControlDisabled=!0,this.trigger(Ae.CONTAINER_MEDIACONTROL_DISABLE))}},{key:"enableMediaControl",value:function(){this.mediaControlDisabled&&(this.mediaControlDisabled=!1,this.trigger(Ae.CONTAINER_MEDIACONTROL_ENABLE))}},{key:"updateStyle",value:function(){!this.options.chromeless||this.options.allowUserInteraction?this.$el.removeClass("chromeless"):this.$el.addClass("chromeless")}},{key:"enableResizeObserver",value:function(){var y=this;this.disableResizeObserver(),this.resizeObserverInterval=setInterval(function(){return y.checkResize()},500)}},{key:"disableResizeObserver",value:function(){this.resizeObserverInterval&&clearInterval(this.resizeObserverInterval)}},{key:"checkResize",value:function(){var y={width:this.el.clientWidth,height:this.el.clientHeight},F=this.currentSize||{},re=F.width;(F.height!==y.height||re!==y.width)&&(this.currentSize=y,this.trigger(Ae.CONTAINER_RESIZE,y))}},{key:"configure",value:function(y){this._options=je.extend(!0,this._options,y),this.updateStyle(),this.playback.configure(this.options),this.trigger(Ae.CONTAINER_OPTIONS_CHANGE)}},{key:"render",value:function(){var y=vr.getStyleFor(`.container[data-container] {
  position: absolute;
  background-color: black;
  height: 100%;
  width: 100%;
  max-width: 100%; }
  .container[data-container] .chromeless {
    cursor: default; }

[data-player]:not(.nocursor) .container[data-container]:not(.chromeless).pointer-enabled {
  cursor: pointer; }
`,{baseUrl:this.options.baseUrl});return this.$el.append(y[0]),this.$el.append(this.playback.render().el),this.updateStyle(),this.checkResize(),this.enableResizeObserver(),this}}]),j}(jr);Object.assign(zs.prototype,qr);var qt=function(J){Bt(j,J);var ee=$i(j);function j(y,F,re){var C;return ri(this,j),(C=ee.call(this,y)).settings={},C._i18n=F,C.playerError=re,C._consented=!1,C}return ai(j,[{key:"isAudioOnly",get:function(){return!1}},{key:"isAdaptive",get:function(){return!1}},{key:"ended",get:function(){return!1}},{key:"i18n",get:function(){return this._i18n}},{key:"buffering",get:function(){return!1}},{key:"consent",value:function(y){typeof y=="function"&&y()}},{key:"play",value:function(){}},{key:"pause",value:function(){}},{key:"stop",value:function(){}},{key:"seek",value:function(y){}},{key:"seekPercentage",value:function(y){}},{key:"getStartTimeOffset",value:function(){return 0}},{key:"getDuration",value:function(){return 0}},{key:"isPlaying",value:function(){return!1}},{key:"isReady",get:function(){return!1}},{key:"hasClosedCaptionsTracks",get:function(){return this.closedCaptionsTracks.length>0}},{key:"closedCaptionsTracks",get:function(){return[]}},{key:"closedCaptionsTrackId",get:function(){return-1},set:function(y){}},{key:"audioTracks",get:function(){return[]}},{key:"currentAudioTrack",get:function(){return null}},{key:"switchAudioTrack",value:function(y){}},{key:"getPlaybackType",value:function(){return j.NO_OP}},{key:"isHighDefinitionInUse",value:function(){return!1}},{key:"mute",value:function(){}},{key:"unmute",value:function(){}},{key:"volume",value:function(y){}},{key:"configure",value:function(y){this._options=je.extend(!0,this._options,y)}},{key:"attemptAutoPlay",value:function(){var y=this;this.canAutoPlay(function(F,re){F&&y.play()})}},{key:"canAutoPlay",value:function(y){y(!0,null)}}]),j}(jr);Object.assign(qt.prototype,qr),qt.extend=function(J){return Vn(qt,J)},qt.canPlay=function(J,ee){return!1},qt.VOD="vod",qt.AOD="aod",qt.LIVE="live",qt.NO_OP="no_op",qt.type="playback";var tn=function(J){Bt(j,J);var ee=$i(j);function j(y,F,re,C){var z;return ri(this,j),(z=ee.call(this,y))._i18n=re,z.loader=F,z.playerError=C,z}return ai(j,[{key:"options",get:function(){return this._options},set:function(y){this._options=y}},{key:"createContainers",value:function(){var y=this;return je.Deferred(function(F){F.resolve(y.options.sources.map(function(re){return y.createContainer(re)}))})}},{key:"findPlaybackPlugin",value:function(y,F){return this.loader.playbackPlugins.filter(function(re){return re.canPlay(y,F)})[0]}},{key:"createContainer",value:function(y){var F=null,re=this.options.mimeType;fs(y)==="object"?(F=y.source.toString(),y.mimeType&&(re=y.mimeType)):F=y.toString(),F.match(/^\/\//)&&(F=window.location.protocol+F);var C=Ea(Ea({},this.options),{},{src:F,mimeType:re}),z=this.findPlaybackPlugin(F,re),G=z?new z(C,this._i18n,this.playerError):new qt;C=Ea(Ea({},C),{},{playback:G});var de=new zs(C,this._i18n,this.playerError),te=je.Deferred();return te.promise(de),this.addContainerPlugins(de),this.listenToOnce(de,Ae.CONTAINER_READY,function(){return te.resolve(de)}),de}},{key:"addContainerPlugins",value:function(y){this.loader.containerPlugins.forEach(function(F){y.addPlugin(new F(y))})}}]),j}(lr),Ys=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y)).playerError=new Kr(y,zt(F)),F.configureDomRecycler(),F.firstResize=!0,F.plugins=[],F.containers=[],F._boundFullscreenHandler=function(){return F.handleFullscreenChange()},je(document).bind("fullscreenchange",F._boundFullscreenHandler),je(document).bind("MSFullscreenChange",F._boundFullscreenHandler),je(document).bind("mozfullscreenchange",F._boundFullscreenHandler),_t.isMobile&&je(window).bind("resize",function(re){F.handleWindowResize(re)}),F}return ai(j,[{key:"events",get:function(){return{webkitfullscreenchange:"handleFullscreenChange",mousemove:"onMouseMove",mouseleave:"onMouseLeave"}}},{key:"attributes",get:function(){return{"data-player":"",tabindex:9999}}},{key:"isReady",get:function(){return!!this.ready}},{key:"i18n",get:function(){return this.getPlugin("strings")||{t:function(y){return y}}}},{key:"mediaControl",get:function(){return this._mediaControl||(this._mediaControl=this.getPlugin("media_control"))||this.dummyMediaControl}},{key:"dummyMediaControl",get:function(){return this._dummyMediaControl||(this._dummyMediaControl=new Vi(this)),this._dummyMediaControl}},{key:"activeContainer",get:function(){return this._activeContainer},set:function(y){this._activeContainer=y,this.trigger(Ae.CORE_ACTIVE_CONTAINER_CHANGED,this._activeContainer)}},{key:"activePlayback",get:function(){return this.activeContainer&&this.activeContainer.playback}},{key:"activePlaybackEl",get:function(){if(this.activePlayback)return this.activePlayback.$el?this.activePlayback.$el.find("video")[0]:this.activePlayback.el}},{key:"configureDomRecycler",value:function(){var y=this.options&&this.options.playback&&this.options.playback.recycleVideo;gn.configure({recycleVideo:y})}},{key:"createContainers",value:function(y){this.defer=je.Deferred(),this.defer.promise(this),this.containerFactory=new tn(y,y.loader,this.i18n,this.playerError),this.prepareContainers()}},{key:"prepareContainers",value:function(){var y=this;this.containerFactory.createContainers().then(function(F){return y.setupContainers(F)}).then(function(F){return y.resolveOnContainersReady(F)})}},{key:"updateSize",value:function(){this.isFullscreen()?this.setFullscreen():this.setPlayerSize()}},{key:"setFullscreen",value:function(){_t.isiOS||(this.$el.addClass("fullscreen"),this.$el.removeAttr("style"),this.previousSize={width:this.options.width,height:this.options.height},this.currentSize={width:je(window).width(),height:je(window).height()})}},{key:"setPlayerSize",value:function(){this.$el.removeClass("fullscreen"),this.currentSize=this.previousSize,this.previousSize={width:je(window).width(),height:je(window).height()},this.resize(this.currentSize)}},{key:"resize",value:function(y){gs(y.height)||gs(y.width)?(this.el.style.height="".concat(y.height,"px"),this.el.style.width="".concat(y.width,"px")):(this.el.style.height="".concat(y.height),this.el.style.width="".concat(y.width)),this.previousSize={width:this.options.width,height:this.options.height},this.options.width=y.width,this.options.height=y.height,this.currentSize=y,this.triggerResize(this.currentSize)}},{key:"enableResizeObserver",value:function(){var y=this;this.disableResizeObserver(),this.resizeObserverInterval=setInterval(function(){y.triggerResize({width:y.el.clientWidth,height:y.el.clientHeight})},500)}},{key:"triggerResize",value:function(y){(this.firstResize||this.oldHeight!==y.height||this.oldWidth!==y.width)&&(this.oldHeight=y.height,this.oldWidth=y.width,this.computedSize=y,this.firstResize=!1,this.trigger(Ae.CORE_RESIZE,y))}},{key:"disableResizeObserver",value:function(){this.resizeObserverInterval&&clearInterval(this.resizeObserverInterval),this.resizeObserverInterval=null}},{key:"resolveOnContainersReady",value:function(y){var F=this;je.when.apply(je,y).done(function(){F.defer.resolve(F),F.ready=!0,F.trigger(Ae.CORE_READY)})}},{key:"addPlugin",value:function(y){this.plugins.push(y)}},{key:"hasPlugin",value:function(y){return!!this.getPlugin(y)}},{key:"getPlugin",value:function(y){return this.plugins.filter(function(F){return F.name===y})[0]}},{key:"load",value:function(y,F){this.options.mimeType=F,y=y&&y.constructor===Array?y:[y],this.options.sources=y,this.containers.forEach(function(re){return re.destroy()}),this.containerFactory.options=je.extend(!0,this.options,{sources:y}),this.prepareContainers()}},{key:"destroy",value:function(){this.disableResizeObserver(),this.containers.forEach(function(y){return y.destroy()}),this.plugins.forEach(function(y){return y.destroy()}),this.$el.remove(),je(document).unbind("fullscreenchange",this._boundFullscreenHandler),je(document).unbind("MSFullscreenChange",this._boundFullscreenHandler),je(document).unbind("mozfullscreenchange",this._boundFullscreenHandler),this.stopListening()}},{key:"handleFullscreenChange",value:function(){this.trigger(Ae.CORE_FULLSCREEN,this.isFullscreen()),this.updateSize()}},{key:"handleWindowResize",value:function(y){var F=window.innerWidth>window.innerHeight?"landscape":"portrait";this._screenOrientation!==F&&(this._screenOrientation=F,this.triggerResize({width:this.el.clientWidth,height:this.el.clientHeight}),this.trigger(Ae.CORE_SCREEN_ORIENTATION_CHANGED,{event:y,orientation:this._screenOrientation}))}},{key:"removeContainer",value:function(y){this.stopListening(y),this.containers=this.containers.filter(function(F){return F!==y})}},{key:"setupContainer",value:function(y){this.listenTo(y,Ae.CONTAINER_DESTROYED,this.removeContainer),this.containers.push(y)}},{key:"setupContainers",value:function(y){return y.forEach(this.setupContainer.bind(this)),this.trigger(Ae.CORE_CONTAINERS_CREATED),this.renderContainers(),this.activeContainer=y[0],this.render(),this.appendToParent(),this.containers}},{key:"renderContainers",value:function(){var y=this;this.containers.forEach(function(F){return y.el.appendChild(F.render().el)})}},{key:"createContainer",value:function(y,F){var re=this.containerFactory.createContainer(y,F);return this.setupContainer(re),this.el.appendChild(re.render().el),re}},{key:"getCurrentContainer",value:function(){return this.activeContainer}},{key:"getCurrentPlayback",value:function(){return this.activePlayback}},{key:"getPlaybackType",value:function(){return this.activeContainer&&this.activeContainer.getPlaybackType()}},{key:"isFullscreen",value:function(){var y=Hn.fullscreenElement();return y&&y===this.el||y&&y===this.activePlaybackEl||this.activePlaybackEl&&this.activePlaybackEl.webkitDisplayingFullscreen||!1}},{key:"toggleFullscreen",value:function(){var y=this;if(this.isFullscreen()){var F=_t.isiOS?this.activePlaybackEl:document;Hn.cancelFullscreen(F),!_t.isiOS&&this.$el.removeClass("fullscreen nocursor")}else{var re=_t.isiOS?this.activePlaybackEl:this.el;if(!re)return;_t.isSafari||_t.isiOS?Hn.requestFullscreen(re):Hn.requestFullscreen(re).then(function(C){return C},function(C){return setTimeout(function(){if(!y.isFullscreen())throw new ReferenceError(C)},600)}),!_t.isiOS&&this.$el.addClass("fullscreen")}}},{key:"onMouseMove",value:function(y){this.trigger(Ae.CORE_MOUSE_MOVE,y)}},{key:"onMouseLeave",value:function(y){this.trigger(Ae.CORE_MOUSE_LEAVE,y)}},{key:"configure",value:function(y){var F=this;this._options=je.extend(!0,this._options,y),this.configureDomRecycler();var re=y.source||y.sources;re&&this.load(re,y.mimeType||this.options.mimeType),this.trigger(Ae.CORE_OPTIONS_CHANGE,y),this.containers.forEach(function(C){return C.configure(F.options)})}},{key:"appendToParent",value:function(){var y=vr.getStyleFor(`[data-player] {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -o-user-select: none;
  user-select: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transform: translate3d(0, 0, 0);
  position: relative;
  margin: 0;
  padding: 0;
  border: 0;
  font-style: normal;
  font-weight: normal;
  text-align: center;
  overflow: hidden;
  font-size: 100%;
  font-family: "Roboto", "Open Sans", Arial, sans-serif;
  text-shadow: 0 0 0;
  box-sizing: border-box; }
  [data-player]:focus {
    outline: 0; }
  [data-player] * {
    box-sizing: inherit; }
  [data-player] > * {
    float: none;
    max-width: none; }
  [data-player] > div {
    display: block; }
  [data-player].fullscreen {
    width: 100% !important;
    height: 100% !important;
    top: 0;
    left: 0; }
  [data-player].nocursor {
    cursor: none; }

.clappr-style {
  display: none !important; }
`,{baseUrl:this.options.baseUrl}),F=vr.getStyleFor(`[data-player] div, [data-player] span, [data-player] applet, [data-player] object, [data-player] iframe,
[data-player] h1, [data-player] h2, [data-player] h3, [data-player] h4, [data-player] h5, [data-player] h6, [data-player] p, [data-player] blockquote, [data-player] pre,
[data-player] a, [data-player] abbr, [data-player] acronym, [data-player] address, [data-player] big, [data-player] cite, [data-player] code,
[data-player] del, [data-player] dfn, [data-player] em, [data-player] img, [data-player] ins, [data-player] kbd, [data-player] q, [data-player] s, [data-player] samp,
[data-player] small, [data-player] strike, [data-player] strong, [data-player] sub, [data-player] sup, [data-player] tt, [data-player] var,
[data-player] b, [data-player] u, [data-player] i, [data-player] center,
[data-player] dl, [data-player] dt, [data-player] dd, [data-player] ol, [data-player] ul, [data-player] li,
[data-player] fieldset, [data-player] form, [data-player] label, [data-player] legend,
[data-player] table, [data-player] caption, [data-player] tbody, [data-player] tfoot, [data-player] thead, [data-player] tr, [data-player] th, [data-player] td,
[data-player] article, [data-player] aside, [data-player] canvas, [data-player] details, [data-player] embed,
[data-player] figure, [data-player] figcaption, [data-player] footer, [data-player] header, [data-player] hgroup,
[data-player] menu, [data-player] nav, [data-player] output, [data-player] ruby, [data-player] section, [data-player] summary,
[data-player] time, [data-player] mark, [data-player] audio, [data-player] video {
  margin: 0;
  padding: 0;
  border: 0;
  font: inherit;
  font-size: 100%;
  vertical-align: baseline; }

[data-player] table {
  border-collapse: collapse;
  border-spacing: 0; }

[data-player] caption, [data-player] th, [data-player] td {
  text-align: left;
  font-weight: normal;
  vertical-align: middle; }

[data-player] q, [data-player] blockquote {
  quotes: none; }
  [data-player] q:before, [data-player] q:after, [data-player] blockquote:before, [data-player] blockquote:after {
    content: "";
    content: none; }

[data-player] a img {
  border: none; }
`,{baseUrl:this.options.baseUrl});this.$el.append(y[0]),this.options.includeResetStyle&&this.$el.append(F[0]),!(this.$el.parent()&&this.$el.parent().length)&&this.$el.appendTo(this.options.parentElement)}},{key:"render",value:function(){this.options.width=this.options.width||this.$el.width(),this.options.height=this.options.height||this.$el.height();var y={width:this.options.width,height:this.options.height};return this.previousSize=this.currentSize=this.computedSize=y,this.updateSize(),this.enableResizeObserver(),this}}]),j}(jr);Object.assign(Ys.prototype,qr);var Rr,Xs,Wi=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y.options)).player=y,F}return ai(j,[{key:"loader",get:function(){return this.player.loader}},{key:"create",value:function(){return this.options.loader=this.loader,this.core=new Ys(this.options),this.addCorePlugins(),this.core.createContainers(this.options),this.core}},{key:"addCorePlugins",value:function(){var y=this;return this.loader.corePlugins.forEach(function(F){var re=new F(y.core);y.core.addPlugin(re),y.setupExternalInterface(re)}),this.core}},{key:"setupExternalInterface",value:function(y){var F=y.getExternalInterface();for(var re in F)this.player[re]=F[re].bind(y)}}]),j}(lr),wo=/(\d+)(?:\.(\d+))?(?:\.(\d+))?/,At=function(){function J(ee,j,y){ri(this,J),this.major=parseInt(ee||0,10),this.minor=parseInt(j||0,10),this.patch=parseInt(y||0,10)}return ai(J,[{key:"compare",value:function(ee){var j=this.major-ee.major;return j=(j=j||this.minor-ee.minor)||this.patch-ee.patch}},{key:"inc",value:function(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"patch";return this[ee]!==void 0&&(this[ee]+=1),this}},{key:"satisfies",value:function(ee,j){return this.compare(ee)>=0&&(!j||this.compare(j)<0)}},{key:"toString",value:function(){return"".concat(this.major,".").concat(this.minor,".").concat(this.patch)}}],[{key:"parse",value:function(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",j=ee.match(wo)||[],y=Ja(j,4),F=y[1],re=y[2],C=y[3];return F===void 0?null:new J(F,re,C)}}]),J}(),Tl=function(J,ee){return J&&ee?Object.entries(J).filter(function(j){return Ja(j,2)[1].type===ee}).reduce(function(j,y){var F=Ja(y,2),re=F[0],C=F[1];return j[re]=C,j},{}):{}},Rn=(Rr={plugins:{},playbacks:[]},Xs="0.4.27",function(){function J(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ri(this,J),this.playerId=j,this.playbackPlugins=pr(Rr.playbacks);var y=J.registeredPlugins,F=y.core,re=y.container;this.containerPlugins=Object.values(re),this.corePlugins=Object.values(F),Array.isArray(ee)||this.validateExternalPluginsType(ee),this.addExternalPlugins(ee)}return ai(J,[{key:"groupPluginsByType",value:function(ee){return Array.isArray(ee)&&(ee=ee.reduce(function(j,y){return j[y.type]||(j[y.type]=[]),j[y.type].push(y),j},{})),ee}},{key:"removeDups",value:function(ee){var j=arguments.length>1&&arguments[1]!==void 0&&arguments[1],y=function(z,G){return z[G.prototype.name]&&j||(z[G.prototype.name]&&delete z[G.prototype.name],z[G.prototype.name]=G),z},F=ee.reduceRight(y,Object.create(null)),re=[];for(var C in F)re.unshift(F[C]);return re}},{key:"addExternalPlugins",value:function(ee){var j=typeof ee.loadExternalPluginsFirst!="boolean"||ee.loadExternalPluginsFirst,y=typeof ee.loadExternalPlaybacksFirst!="boolean"||ee.loadExternalPlaybacksFirst;if((ee=this.groupPluginsByType(ee)).playback){var F=ee.playback.filter(function(z){return J.checkVersionSupport(z),!0});this.playbackPlugins=y?this.removeDups(F.concat(this.playbackPlugins)):this.removeDups(this.playbackPlugins.concat(F),!0)}if(ee.container){var re=ee.container.filter(function(z){return J.checkVersionSupport(z),!0});this.containerPlugins=j?this.removeDups(re.concat(this.containerPlugins)):this.removeDups(this.containerPlugins.concat(re),!0)}if(ee.core){var C=ee.core.filter(function(z){return J.checkVersionSupport(z),!0});this.corePlugins=j?this.removeDups(C.concat(this.corePlugins)):this.removeDups(this.corePlugins.concat(C),!0)}}},{key:"validateExternalPluginsType",value:function(ee){["playback","container","core"].forEach(function(j){(ee[j]||[]).forEach(function(y){var F="external "+y.type+" plugin on "+j+" array";if(y.type!==j)throw new ReferenceError(F)})})}}],[{key:"registeredPlaybacks",get:function(){return pr(Rr.playbacks)}},{key:"registeredPlugins",get:function(){var ee=Rr.plugins;return{core:Tl(ee,"core"),container:Tl(ee,"container")}}},{key:"checkVersionSupport",value:function(ee){var j=ee.prototype,y=j.supportedVersion,F=j.name;if(!y||!y.min)return Gt.warn("Loader","missing version information for ".concat(F)),!1;var re=y.max?At.parse(y.max):At.parse(y.min).inc("minor"),C=At.parse(y.min);return!!At.parse(Xs).satisfies(C,re)||(Gt.warn("Loader","unsupported plugin ".concat(F,": Clappr version ").concat(Xs," does not match required range [").concat(C,",").concat(re,")")),!1)}},{key:"registerPlugin",value:function(ee){if(!ee||!ee.prototype.name)return Gt.warn("Loader","missing information to register plugin: ".concat(ee)),!1;J.checkVersionSupport(ee);var j=Rr.plugins;if(!j)return!1;var y=j[ee.prototype.name];return y&&Gt.warn("Loader","overriding plugin entry: ".concat(ee.prototype.name," - ").concat(y)),j[ee.prototype.name]=ee,!0}},{key:"registerPlayback",value:function(ee){if(!ee||!ee.prototype.name)return!1;J.checkVersionSupport(ee);var j=Rr.playbacks,y=j.findIndex(function(re){return re.prototype.name===ee.prototype.name});if(y>=0){var F=j[y];j.splice(y,1),Gt.warn("Loader","overriding playback entry: ".concat(F.name," - ").concat(F))}return Rr.playbacks=[ee].concat(pr(j)),!0}},{key:"unregisterPlugin",value:function(ee){if(!ee)return!1;var j=Rr.plugins;return!!j[ee]&&(delete j[ee],!0)}},{key:"unregisterPlayback",value:function(ee){if(!ee)return!1;var j=Rr.playbacks,y=j.findIndex(function(F){return F.prototype.name===ee});return!(y<0||(j.splice(y,1),Rr.playbacks=j,0))}},{key:"clearPlugins",value:function(){Rr.plugins={}}},{key:"clearPlaybacks",value:function(){Rr.playbacks=[]}}]),J}()),Pr=ko().replace(/\/[^/]+$/,""),Lo=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;ri(this,j),F=ee.call(this,y);var re={playerId:Gi(""),persistConfig:!0,width:640,height:360,baseUrl:Pr,allowUserInteraction:_t.isMobile,includeResetStyle:!0,playback:{recycleVideo:!0}};F._options=je.extend(!0,re,y),F.options.sources=F._normalizeSources(y),F.options.chromeless||(F.options.allowUserInteraction=!0),F.options.allowUserInteraction||(F.options.disableKeyboardShortcuts=!0),F._registerOptionEventListeners(F.options.events),F._coreFactory=new Wi(zt(F));var C=F._getParentElement(F.options);return C&&F.attachTo(C),F}return ai(j,[{key:"loader",get:function(){return this._loader||(this._loader=new Rn(this.options.plugins||{},this.options.playerId)),this._loader},set:function(y){this._loader=y}},{key:"ended",get:function(){return this.core.activeContainer.ended}},{key:"buffering",get:function(){return this.core.activeContainer.buffering}},{key:"isReady",get:function(){return!!this._ready}},{key:"eventsMapping",get:function(){return{onReady:Ae.PLAYER_READY,onResize:Ae.PLAYER_RESIZE,onPlay:Ae.PLAYER_PLAY,onPause:Ae.PLAYER_PAUSE,onStop:Ae.PLAYER_STOP,onEnded:Ae.PLAYER_ENDED,onSeek:Ae.PLAYER_SEEK,onError:Ae.PLAYER_ERROR,onTimeUpdate:Ae.PLAYER_TIMEUPDATE,onVolumeUpdate:Ae.PLAYER_VOLUMEUPDATE,onSubtitleAvailable:Ae.PLAYER_SUBTITLE_AVAILABLE}}},{key:"_getParentElement",value:function(y){var F=y.parentId,re=y.parent;return F?document.querySelector(F):re}},{key:"attachTo",value:function(y){return this.options.parentElement=y,this.core=this._coreFactory.create(),this._addEventListeners(),this}},{key:"_addEventListeners",value:function(){return this.core.isReady?this._onReady():this.listenToOnce(this.core,Ae.CORE_READY,this._onReady),this.listenTo(this.core,Ae.CORE_ACTIVE_CONTAINER_CHANGED,this._containerChanged),this.listenTo(this.core,Ae.CORE_FULLSCREEN,this._onFullscreenChange),this.listenTo(this.core,Ae.CORE_RESIZE,this._onResize),this}},{key:"_addContainerEventListeners",value:function(){var y=this.core.activeContainer;return y&&(this.listenTo(y,Ae.CONTAINER_PLAY,this._onPlay),this.listenTo(y,Ae.CONTAINER_PAUSE,this._onPause),this.listenTo(y,Ae.CONTAINER_STOP,this._onStop),this.listenTo(y,Ae.CONTAINER_ENDED,this._onEnded),this.listenTo(y,Ae.CONTAINER_SEEK,this._onSeek),this.listenTo(y,Ae.CONTAINER_ERROR,this._onError),this.listenTo(y,Ae.CONTAINER_TIMEUPDATE,this._onTimeUpdate),this.listenTo(y,Ae.CONTAINER_VOLUME,this._onVolumeUpdate),this.listenTo(y,Ae.CONTAINER_SUBTITLE_AVAILABLE,this._onSubtitleAvailable)),this}},{key:"_registerOptionEventListeners",value:function(){var y=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=Object.keys(F).length>0;return C&&Object.keys(re).forEach(function(z){var G=y.eventsMapping[z];G&&y.off(G,re[z])}),Object.keys(F).forEach(function(z){var G=y.eventsMapping[z];if(G){var de=F[z];(de=typeof de=="function"&&de)&&y.on(G,de)}}),this}},{key:"_containerChanged",value:function(){this.stopListening(),this._addEventListeners()}},{key:"_onReady",value:function(){this._ready=!0,this._addContainerEventListeners(),this.trigger(Ae.PLAYER_READY)}},{key:"_onFullscreenChange",value:function(y){this.trigger(Ae.PLAYER_FULLSCREEN,y)}},{key:"_onVolumeUpdate",value:function(y){this.trigger(Ae.PLAYER_VOLUMEUPDATE,y)}},{key:"_onSubtitleAvailable",value:function(){this.trigger(Ae.PLAYER_SUBTITLE_AVAILABLE)}},{key:"_onResize",value:function(y){this.trigger(Ae.PLAYER_RESIZE,y)}},{key:"_onPlay",value:function(y){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.trigger(Ae.PLAYER_PLAY,F)}},{key:"_onPause",value:function(y){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.trigger(Ae.PLAYER_PAUSE,F)}},{key:"_onStop",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.trigger(Ae.PLAYER_STOP,this.getCurrentTime(),y)}},{key:"_onEnded",value:function(){this.trigger(Ae.PLAYER_ENDED)}},{key:"_onSeek",value:function(y){this.trigger(Ae.PLAYER_SEEK,y)}},{key:"_onTimeUpdate",value:function(y){this.trigger(Ae.PLAYER_TIMEUPDATE,y)}},{key:"_onError",value:function(y){this.trigger(Ae.PLAYER_ERROR,y)}},{key:"_normalizeSources",value:function(y){var F=y.sources||(y.source!==void 0?[y.source]:[]);return F.length===0?[{source:"",mimeType:""}]:F}},{key:"resize",value:function(y){return this.core.resize(y),this}},{key:"load",value:function(y,F,re){return re!==void 0&&this.configure({autoPlay:!!re}),this.core.load(y,F),this}},{key:"destroy",value:function(){return this.stopListening(),this.core.destroy(),this}},{key:"consent",value:function(y){this.core.getCurrentPlayback().consent(y)}},{key:"play",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.core.activeContainer.play(y),this}},{key:"pause",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.core.activeContainer.pause(y),this}},{key:"stop",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.core.activeContainer.stop(y),this}},{key:"seek",value:function(y){return this.core.activeContainer.seek(y),this}},{key:"seekPercentage",value:function(y){return this.core.activeContainer.seekPercentage(y),this}},{key:"mute",value:function(){return this.core.activePlayback.mute(),this}},{key:"unmute",value:function(){return this.core.activePlayback.unmute(),this}},{key:"isPlaying",value:function(){return this.core.activeContainer.isPlaying()}},{key:"isDvrEnabled",value:function(){return this.core.activeContainer.isDvrEnabled()}},{key:"isDvrInUse",value:function(){return this.core.activeContainer.isDvrInUse()}},{key:"configure",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._registerOptionEventListeners(y.events,this.options.events),this.core.configure(y),this}},{key:"getPlugin",value:function(y){return this.core.plugins.concat(this.core.activeContainer.plugins).filter(function(F){return F.name===y})[0]}},{key:"getCurrentTime",value:function(){return this.core.activeContainer.getCurrentTime()}},{key:"getStartTimeOffset",value:function(){return this.core.activeContainer.getStartTimeOffset()}},{key:"getDuration",value:function(){return this.core.activeContainer.getDuration()}}]),j}(lr);Object.assign(Lo.prototype,qr);var Mt=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y.options)).container=y,F.enabled=!0,F.bindEvents(),F}return ai(j,[{key:"playerError",get:function(){return this.container.playerError}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.enabled=!0)}},{key:"disable",value:function(){this.enabled&&(this.stopListening(),this.enabled=!1)}},{key:"bindEvents",value:function(){}},{key:"destroy",value:function(){this.stopListening()}}]),j}(lr);Object.assign(Mt.prototype,qr),Mt.extend=function(J){return Vn(Mt,J)},Mt.type="container";var rn=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y.options)).core=y,F.enabled=!0,F.bindEvents(),F}return ai(j,[{key:"playerError",get:function(){return this.core.playerError}},{key:"bindEvents",value:function(){}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.enabled=!0)}},{key:"disable",value:function(){this.enabled&&(this.stopListening(),this.enabled=!1)}},{key:"getExternalInterface",value:function(){return{}}},{key:"destroy",value:function(){this.stopListening()}}]),j}(lr);Object.assign(rn.prototype,qr),rn.extend=function(J){return Vn(rn,J)},rn.type="core";var nn=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y.options)).container=y,F.enabled=!0,F.bindEvents(),F}return ai(j,[{key:"playerError",get:function(){return this.container.playerError}},{key:"enable",value:function(){this.enabled||(this.bindEvents(),this.$el.show(),this.enabled=!0)}},{key:"disable",value:function(){this.stopListening(),this.$el.hide(),this.enabled=!1}},{key:"bindEvents",value:function(){}}]),j}(jr);Object.assign(nn.prototype,qr),nn.extend=function(J){return Vn(nn,J)},nn.type="container";var Qs={mp4:["avc1.42E01E","avc1.58A01E","avc1.4D401E","avc1.64001E","mp4v.20.8","mp4v.20.240","mp4a.40.2"].map(function(J){return'video/mp4; codecs="'+J+', mp4a.40.2"'}),ogg:['video/ogg; codecs="theora, vorbis"','video/ogg; codecs="dirac"','video/ogg; codecs="theora, speex"'],"3gpp":['video/3gpp; codecs="mp4v.20.8, samr"'],webm:['video/webm; codecs="vp8, vorbis"'],mkv:['video/x-matroska; codecs="theora, vorbis"'],m3u8:["application/x-mpegurl"]};Qs.ogv=Qs.ogg,Qs["3gp"]=Qs["3gpp"];var _s={wav:["audio/wav"],mp3:["audio/mp3",'audio/mpeg;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.5"'],oga:["audio/ogg"]},yr=Object.keys(_s).reduce(function(J,ee){return[].concat(pr(J),pr(_s[ee]))},[]),fi={code:"unknown",message:"unknown"},Tr=function(J){Bt(j,J);var ee=$i(j);function j(){var y;ri(this,j);for(var F=arguments.length,re=new Array(F),C=0;C<F;C++)re[C]=arguments[C];(y=ee.call.apply(ee,[this].concat(re)))._destroyed=!1,y._loadStarted=!1,y._isBuffering=!1,y._playheadMoving=!1,y._playheadMovingTimer=null,y._stopped=!1,y._ccTrackId=-1,y._setupSrc(y.options.src),y.options.playback||(y.options.playback=y.options||{}),y.options.playback.disableContextMenu=y.options.playback.disableContextMenu||y.options.disableVideoTagContextMenu,y._minDvrSize=y.isValidMinimumDVRSizeConfig?y.minimumDVRSizeConfig:60;var z,G=y.options.playback,de=G.preload||(_t.isSafari?"auto":y.options.preload);return y.options.poster&&(typeof y.options.poster=="string"?z=y.options.poster:typeof y.options.poster.url=="string"&&(z=y.options.poster.url)),je.extend(!0,y.el,{muted:y.options.mute,defaultMuted:y.options.mute,loop:y.options.loop,poster:z,preload:de||"metadata",crossOrigin:G.crossOrigin,"x-webkit-playsinline":G.playInline}),(G.controls||y.options.useVideoTagDefaultControls)&&y.$el.attr("controls",""),G.playInline&&y.$el.attr({playsinline:"playsinline"}),G.crossOrigin&&y.$el.attr({crossorigin:G.crossOrigin}),y.settings={default:["seekbar"]},y.settings.left=["playpause","position","duration"],y.settings.right=["fullscreen","volume","hd-indicator"],G.externalTracks&&y._setupExternalTracks(G.externalTracks),y.options.autoPlay&&y.attemptAutoPlay(),y}return ai(j,[{key:"name",get:function(){return"html5_video"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"tagName",get:function(){return this.isAudioOnly?"audio":"video"}},{key:"isAudioOnly",get:function(){var y=this.options.src,F=j._mimeTypesForUrl(y,_s,this.options.mimeType);return this.options.playback&&this.options.playback.audioOnly||this.options.audioOnly||yr.indexOf(F[0])>=0}},{key:"attributes",get:function(){return{"data-html5-video":""}}},{key:"events",get:function(){return{canplay:"_onCanPlay",canplaythrough:"_handleBufferingEvents",durationchange:"_onDurationChange",ended:"_onEnded",error:"_onError",loadeddata:"_onLoadedData",loadedmetadata:"_onLoadedMetadata",pause:"_onPause",playing:"_onPlaying",progress:"_onProgress",seeking:"_onSeeking",seeked:"_onSeeked",stalled:"_handleBufferingEvents",timeupdate:"_onTimeUpdate",waiting:"_onWaiting"}}},{key:"ended",get:function(){return this.el.ended}},{key:"buffering",get:function(){return this._isBuffering}},{key:"isLive",get:function(){return this.getPlaybackType()===qt.LIVE}},{key:"dvrEnabled",get:function(){return this.getDuration()>=this._minDvrSize&&this.isLive}},{key:"minimumDVRSizeConfig",get:function(){return this.options.playback&&this.options.playback.minimumDvrSize}},{key:"isValidMinimumDVRSizeConfig",get:function(){return this.minimumDVRSizeConfig!==void 0&&typeof this.minimumDVRSizeConfig=="number"}},{key:"configure",value:function(y){fn(hn(j.prototype),"configure",this).call(this,y),this.el.loop=!!y.loop}},{key:"attemptAutoPlay",value:function(){var y=this;this.canAutoPlay(function(F,re){re&&Gt.warn(y.name,"autoplay error.",{result:F,error:re}),F&&setTimeout(function(){return!y._destroyed&&y.play()},0)})}},{key:"canAutoPlay",value:function(y){if(this.options.disableCanAutoPlay)y(!0,null);else{var F={timeout:this.options.autoPlayTimeout||500,inline:this.options.playback.playInline||!1,muted:this.options.mute||!1};_t.isMobile&&gn.options.recycleVideo&&(F.element=this.el),io(y,F)}}},{key:"_setupExternalTracks",value:function(y){this._externalTracks=y.map(function(F){return{kind:F.kind||"subtitles",label:F.label,lang:F.lang,src:F.src}})}},{key:"_setupSrc",value:function(y){this.el.src!==y&&(this._ccIsSetup=!1,this.el.src=y,this._src=this.el.src)}},{key:"_onLoadedMetadata",value:function(y){this._handleBufferingEvents(),this.trigger(Ae.PLAYBACK_LOADEDMETADATA,{duration:y.target.duration,data:y}),this._updateSettings();var F=this._options.autoSeekFromUrl===void 0||this._options.autoSeekFromUrl;this.getPlaybackType()!==qt.LIVE&&F&&this._checkInitialSeek()}},{key:"_onDurationChange",value:function(){this._updateSettings(),this._onTimeUpdate(),this._onProgress()}},{key:"_updateSettings",value:function(){this.getPlaybackType()===qt.VOD||this.getPlaybackType()===qt.AOD?this.settings.left=["playpause","position","duration"]:this.settings.left=["playstop"],this.settings.seekEnabled=this.isSeekEnabled(),this.trigger(Ae.PLAYBACK_SETTINGSUPDATE)}},{key:"isSeekEnabled",value:function(){return isFinite(this.getDuration())}},{key:"getPlaybackType",value:function(){var y=this.tagName==="audio"?qt.AOD:qt.VOD;return[0,void 0,1/0].indexOf(this.el.duration)>=0?qt.LIVE:y}},{key:"isHighDefinitionInUse",value:function(){return!1}},{key:"consent",value:function(y){var F=this;if(this.isPlaying()||this.el._consented)fn(hn(j.prototype),"consent",this).call(this,y);else{var re=function C(){F.el.removeEventListener("loadedmetadata",C,!1),F.el.removeEventListener("error",C,!1),F.el._consented=!0,fn(hn(j.prototype),"consent",F).call(F,y)};this.el.addEventListener("loadedmetadata",re,!1),this.el.addEventListener("error",re,!1),this.el.load()}}},{key:"play",value:function(){this.trigger(Ae.PLAYBACK_PLAY_INTENT),this._stopped=!1,this._setupSrc(this._src),this._handleBufferingEvents();var y=this.el.play();y&&y.catch&&y.catch(function(){})}},{key:"pause",value:function(){this.el.pause(),this.dvrEnabled&&this._updateDvr(!0)}},{key:"stop",value:function(){this.pause(),this._stopped=!0,this.el.removeAttribute("src"),this.el.load(),this._stopPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(Ae.PLAYBACK_STOP)}},{key:"volume",value:function(y){y===0?(this.$el.attr({muted:"true"}),this.el.muted=!0):(this.$el.attr({muted:null}),this.el.muted=!1,this.el.volume=y/100)}},{key:"mute",value:function(){this.el.muted=!0}},{key:"unmute",value:function(){this.el.muted=!1}},{key:"isMuted",value:function(){return this.el.muted===!0||this.el.volume===0}},{key:"isPlaying",value:function(){return!this.el.paused&&!this.el.ended}},{key:"isReady",get:function(){return this._isReadyState}},{key:"_startPlayheadMovingChecks",value:function(){this._playheadMovingTimer===null&&(this._playheadMovingTimeOnCheck=null,this._determineIfPlayheadMoving(),this._playheadMovingTimer=setInterval(this._determineIfPlayheadMoving.bind(this),500))}},{key:"_stopPlayheadMovingChecks",value:function(){this._playheadMovingTimer!==null&&(clearInterval(this._playheadMovingTimer),this._playheadMovingTimer=null,this._playheadMoving=!1)}},{key:"_determineIfPlayheadMoving",value:function(){var y=this._playheadMovingTimeOnCheck,F=this.el.currentTime;this._playheadMoving=y!==F,this._playheadMovingTimeOnCheck=F,this._handleBufferingEvents()}},{key:"_onWaiting",value:function(){this._loadStarted=!0,this._handleBufferingEvents()}},{key:"_onLoadedData",value:function(){this._loadStarted=!0,this._handleBufferingEvents()}},{key:"_onCanPlay",value:function(){this._handleBufferingEvents()}},{key:"_onPlaying",value:function(){this._checkForClosedCaptions(),this._startPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(Ae.PLAYBACK_PLAY)}},{key:"_onPause",value:function(){this._stopPlayheadMovingChecks(),this._handleBufferingEvents(),this.trigger(Ae.PLAYBACK_PAUSE)}},{key:"_onSeeking",value:function(){this.trigger(Ae.PLAYBACK_SEEK,this.getCurrentTime()),this._handleBufferingEvents()}},{key:"_onSeeked",value:function(){this._handleBufferingEvents(),this.trigger(Ae.PLAYBACK_SEEKED)}},{key:"_onEnded",value:function(){this._handleBufferingEvents(),this.trigger(Ae.PLAYBACK_ENDED,this.name)}},{key:"_handleBufferingEvents",value:function(){var y=!this.el.ended&&!this.el.paused,F=this._loadStarted&&!this.el.ended&&!this._stopped&&(y&&!this._playheadMoving||this.el.readyState<this.el.HAVE_FUTURE_DATA);this._isBuffering!==F&&(this._isBuffering=F,F?this.trigger(Ae.PLAYBACK_BUFFERING,this.name):this.trigger(Ae.PLAYBACK_BUFFERFULL,this.name))}},{key:"_onError",value:function(){var y=this.el.error||fi,F=y.code,re=y.message,C=F===fi.code,z=this.createError({code:F,description:re,raw:this.el.error,level:C?Kr.Levels.WARN:Kr.Levels.FATAL});C?Gt.warn(this.name,"HTML5 unknown error: ",z):this.trigger(Ae.PLAYBACK_ERROR,z)}},{key:"destroy",value:function(){this._destroyed=!0,this.handleTextTrackChange&&this.el.textTracks.removeEventListener("change",this.handleTextTrackChange),fn(hn(j.prototype),"destroy",this).call(this),this.el.removeAttribute("src"),this.el.load(),this._src=null,gn.garbage(this.el)}},{key:"_updateDvr",value:function(y){this.trigger(Ae.PLAYBACK_DVR,y),this.trigger(Ae.PLAYBACK_STATS_ADD,{dvr:y})}},{key:"seek",value:function(y){y<0&&(Gt.warn("Attempt to seek to a negative time. Resetting to live point. Use seekToLivePoint() to seek to the live point."),y=this.getDuration()),this.dvrEnabled&&this._updateDvr(y<this.getDuration()-3),y+=this.el.seekable.start(0),this.el.currentTime=y}},{key:"seekPercentage",value:function(y){var F=this.el.duration*(y/100);this.seek(F)}},{key:"_checkInitialSeek",value:function(){var y=Dn();y!==0&&this.seek(y)}},{key:"getCurrentTime",value:function(){return this.el.currentTime}},{key:"getDuration",value:function(){if(this.isLive){if(this.el.seekable.length>0)return this.el.seekable.end(0)-this.el.seekable.start(0);this._scheduleUpdateSettingsCheck()}return this.el.duration}},{key:"_scheduleUpdateSettingsCheck",value:function(){var y=this;this._updateSettingsCheckInFlight||(this._updateSettingsCheckInFlight=setTimeout(function(){y._updateSettings(),y._updateSettingsCheckInFlight=null},1e3))}},{key:"_onTimeUpdate",value:function(){var y=this.isLive?this.getDuration():this.el.duration;this.trigger(Ae.PLAYBACK_TIMEUPDATE,{current:this.el.currentTime,total:y},this.name)}},{key:"_onProgress",value:function(){if(this.el.buffered.length){for(var y=[],F=0,re=0;re<this.el.buffered.length;re++)y=[].concat(pr(y),[{start:this.el.buffered.start(re),end:this.el.buffered.end(re)}]),this.el.currentTime>=y[re].start&&this.el.currentTime<=y[re].end&&(F=re);var C={start:y[F].start,current:y[F].end,total:this.el.duration};this.trigger(Ae.PLAYBACK_PROGRESS,C,y)}}},{key:"_typeFor",value:function(y){var F=j._mimeTypesForUrl(y,Qs,this.options.mimeType);return F.length===0&&(F=j._mimeTypesForUrl(y,_s,this.options.mimeType)),(F[0]||"").split(";")[0]}},{key:"_ready",value:function(){this._isReadyState||(this._isReadyState=!0,this.trigger(Ae.PLAYBACK_READY,this.name))}},{key:"_checkForClosedCaptions",value:function(){if(this.isHTML5Video&&!this._ccIsSetup){if(this.hasClosedCaptionsTracks){this.trigger(Ae.PLAYBACK_SUBTITLE_AVAILABLE);var y=this.closedCaptionsTrackId;this.closedCaptionsTrackId=y,this.handleTextTrackChange=this._handleTextTrackChange.bind(this),this.el.textTracks.addEventListener("change",this.handleTextTrackChange)}this._ccIsSetup=!0}}},{key:"_handleTextTrackChange",value:function(){var y=this.closedCaptionsTracks.find(function(F){return F.track.mode==="showing"})||{id:-1};this._ccTrackId!==y.id&&(this._ccTrackId=y.id,this.trigger(Ae.PLAYBACK_SUBTITLE_CHANGED,{id:y.id}))}},{key:"isHTML5Video",get:function(){return this.name===j.prototype.name}},{key:"closedCaptionsTracks",get:function(){var y=0;return(this.el.textTracks?Array.from(this.el.textTracks):[]).filter(function(F){return F.kind==="subtitles"||F.kind==="captions"}).map(function(F){return{id:y++,name:F.label,track:F}})}},{key:"closedCaptionsTrackId",get:function(){return this._ccTrackId},set:function(y){if(gs(y)){var F,re=this.closedCaptionsTracks;if(y!==-1&&(!(F=re.find(function(C){return C.id===y}))||F.track.mode==="showing"))return;re.filter(function(C){return C.track.mode!=="hidden"}).forEach(function(C){return C.track.mode="hidden"}),F&&(F.track.mode="showing"),this._ccTrackId=y,this.trigger(Ae.PLAYBACK_SUBTITLE_CHANGED,{id:y})}}},{key:"template",get:function(){return mr(`<% for (var i = 0; i < tracks.length; i++) { %>
  <track data-html5-video-track="<%= i %>" kind="<%= tracks[i].kind %>" label="<%= tracks[i].label %>" srclang="<%= tracks[i].lang %>" src="<%= tracks[i].src %>">
<% }; %>
`)}},{key:"render",value:function(){this.options.playback.disableContextMenu&&this.$el.on("contextmenu",function(){return!1}),this._externalTracks&&this._externalTracks.length>0&&this.$el.html(this.template({tracks:this._externalTracks})),this._ready();var y=vr.getStyleFor(`[data-html5-video] {
  position: absolute;
  height: 100%;
  width: 100%;
  display: block; }
`,{baseUrl:this.options.baseUrl});return this.$el.append(y[0]),this}}]),j}(qt);Tr._mimeTypesForUrl=function(J,ee,j){var y=(J.split("?")[0].match(/.*\.(.*)$/)||[])[1],F=j||y&&ee[y.toLowerCase()]||[];return F.constructor===Array?F:[F]},Tr._canPlay=function(J,ee,j,y){var F=Tr._mimeTypesForUrl(j,ee,y),re=document.createElement(J);return!!F.filter(function(C){return!!re.canPlayType(C).replace(/no/,"")})[0]},Tr.canPlay=function(J,ee){return Tr._canPlay("audio",_s,J,ee)||Tr._canPlay("video",Qs,J,ee)};var bs=function(J){Bt(j,J);var ee=$i(j);function j(){return ri(this,j),ee.apply(this,arguments)}return ai(j,[{key:"name",get:function(){return"html5_audio"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"tagName",get:function(){return"audio"}},{key:"isAudioOnly",get:function(){return!0}},{key:"updateSettings",value:function(){this.settings.left=["playpause","position","duration"],this.settings.seekEnabled=this.isSeekEnabled(),this.trigger(Ae.PLAYBACK_SETTINGSUPDATE)}},{key:"getPlaybackType",value:function(){return qt.AOD}}]),j}(Tr);bs.canPlay=function(J,ee){return Tr._canPlay("audio",{wav:["audio/wav"],mp3:["audio/mp3",'audio/mpeg;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.5"'],oga:["audio/ogg"]},J,ee)};var Ca=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y)).el.src=y.src,F}return ai(j,[{key:"name",get:function(){return"html_img"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"tagName",get:function(){return"img"}},{key:"attributes",get:function(){return{"data-html-img":""}}},{key:"events",get:function(){return{load:"_onLoad",abort:"_onError",error:"_onError"}}},{key:"getPlaybackType",value:function(){return qt.NO_OP}},{key:"render",value:function(){var y=vr.getStyleFor(`[data-html-img] {
  max-width: 100%;
  max-height: 100%; }
`,{baseUrl:this.options.baseUrl});return this.$el.append(y[0]),this.trigger(Ae.PLAYBACK_READY,this.name),this}},{key:"_onLoad",value:function(){this.trigger(Ae.PLAYBACK_ENDED,this.name)}},{key:"_onError",value:function(y){var F=y.type==="error"?"load error":"loading aborted";this.trigger(Ae.PLAYBACK_ERROR,{message:F},this.name)}}]),j}(qt);Ca.canPlay=function(J){return/\.(png|jpg|jpeg|gif|bmp|tiff|pgm|pnm|webp)(|\?.*)$/i.test(J)};var El=function(J){Bt(j,J);var ee=$i(j);function j(){var y;ri(this,j);for(var F=arguments.length,re=new Array(F),C=0;C<F;C++)re[C]=arguments[C];return(y=ee.call.apply(ee,[this].concat(re)))._noiseFrameNum=-1,y}return ai(j,[{key:"name",get:function(){return"no_op"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"template",get:function(){return mr(`<canvas data-no-op-canvas></canvas>
<p data-no-op-msg><%=message%></p><p>
</p>`)}},{key:"attributes",get:function(){return{"data-no-op":""}}},{key:"render",value:function(){var y=this.options.playbackNotSupportedMessage||this.i18n.t("playback_not_supported"),F=vr.getStyleFor(`[data-no-op] {
  position: absolute;
  height: 100%;
  width: 100%;
  text-align: center; }

[data-no-op] p[data-no-op-msg] {
  position: absolute;
  text-align: center;
  font-size: 25px;
  left: 0;
  right: 0;
  color: white;
  padding: 10px;
  /* center vertically */
  top: 50%;
  transform: translateY(-50%);
  max-height: 100%;
  overflow: auto; }

[data-no-op] canvas[data-no-op-canvas] {
  background-color: #777;
  height: 100%;
  width: 100%; }
`,{baseUrl:this.options.baseUrl});this.$el.append(F[0]),this.$el.html(this.template({message:y})),this.trigger(Ae.PLAYBACK_READY,this.name);var re=!(!this.options.poster||!this.options.poster.showForNoOp);return!this.options.autoPlay&&re||this._animate(),this}},{key:"_noise",value:function(){if(this._noiseFrameNum=(this._noiseFrameNum+1)%5,!this._noiseFrameNum){var y,F=this.context.createImageData(this.context.canvas.width,this.context.canvas.height);try{y=new Uint32Array(F.data.buffer)}catch{y=new Uint32Array(this.context.canvas.width*this.context.canvas.height*4);for(var re=F.data,C=0;C<re.length;C++)y[C]=re[C]}for(var z=y.length,G=6*Math.random()+4,de=0,te=0,le=0;le<z;)de<0&&(de=G*Math.random(),te=255*Math.pow(Math.random(),.4)<<24),de-=1,y[le++]=te;this.context.putImageData(F,0,0)}}},{key:"_loop",value:function(){var y=this;this._stop||(this._noise(),this._animationHandle=$s(function(){return y._loop()}))}},{key:"destroy",value:function(){this._animationHandle&&(Ti(this._animationHandle),this._stop=!0)}},{key:"_animate",value:function(){this.canvas=this.$el.find("canvas[data-no-op-canvas]")[0],this.context=this.canvas.getContext("2d"),this._loop()}}]),j}(qt);El.canPlay=function(J){return!0};var sn=function(J){Bt(j,J);var ee=$i(j);function j(y){var F;return ri(this,j),(F=ee.call(this,y))._initializeMessages(),F}return ai(j,[{key:"name",get:function(){return"strings"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"t",value:function(y){var F=this._language(),re=this._messages.en;return(F&&this._messages[F]||re)[y]||re[y]||y}},{key:"_language",value:function(){return this.core.options.language||Do()}},{key:"_initializeMessages",value:function(){this._messages=je.extend(!0,{en:{live:"live",back_to_live:"back to live",disabled:"Disabled",playback_not_supported:"Your browser does not support the playback of this video. Please try using a different browser.",default_error_title:"Could not play video.",default_error_message:"There was a problem trying to load the video."},de:{live:"Live",back_to_live:"Zur\xFCck zum Live-Video",disabled:"Deaktiviert",playback_not_supported:"Ihr Browser unterst\xFCtzt das Playback Verfahren nicht. Bitte vesuchen Sie es mit einem anderen Browser.",default_error_title:"Video kann nicht abgespielt werden",default_error_message:"Es gab ein Problem beim Laden des Videos"},pt:{live:"ao vivo",back_to_live:"voltar para o ao vivo",disabled:"Desativado",playback_not_supported:"Seu navegador n\xE3o supporta a reprodu\xE7\xE3o deste video. Por favor, tente usar um navegador diferente.",default_error_title:"N\xE3o foi poss\xEDvel reproduzir o v\xEDdeo.",default_error_message:"Ocorreu um problema ao tentar carregar o v\xEDdeo."},es_am:{live:"vivo",back_to_live:"volver en vivo",disabled:"No disponible",playback_not_supported:"Su navegador no soporta la reproducci\xF3n de este video. Por favor, utilice un navegador diferente.",default_error_title:"No se puede reproducir el video.",default_error_message:"Se ha producido un error al cargar el video."},es:{live:"en directo",back_to_live:"volver al directo",disabled:"No disponible",playback_not_supported:"Este navegador no es compatible para reproducir este v\xEDdeo. Utilice un navegador diferente.",default_error_title:"No se puede reproducir el v\xEDdeo.",default_error_message:"Se ha producido un problema al cargar el v\xEDdeo."},ru:{live:"\u043F\u0440\u044F\u043C\u043E\u0439 \u044D\u0444\u0438\u0440",back_to_live:"\u043A \u043F\u0440\u044F\u043C\u043E\u043C\u0443 \u044D\u0444\u0438\u0440\u0443",disabled:"\u041E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u043E",playback_not_supported:"\u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0432\u043E\u0441\u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435 \u044D\u0442\u043E\u0433\u043E \u0432\u0438\u0434\u0435\u043E. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0434\u0440\u0443\u0433\u043E\u0439 \u0431\u0440\u0430\u0443\u0437\u0435\u0440."},bg:{live:"\u043D\u0430 \u0436\u0438\u0432\u043E",back_to_live:"\u0412\u044A\u0440\u043D\u0438 \u043D\u0430 \u0436\u0438\u0432\u043E",disabled:"\u0418\u0437\u043A\u043B\u044E\u0447\u0435\u043D\u043E",playback_not_supported:"\u0412\u0430\u0448\u0438\u044F\u0442 \u0431\u0440\u0430\u0443\u0437\u044A\u0440 \u043D\u0435 \u043F\u043E\u0434\u0434\u044A\u0440\u0436\u0430 \u0432\u044A\u0437\u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0436\u0434\u0430\u043D\u0435\u0442\u043E \u043D\u0430 \u0442\u043E\u0432\u0430 \u0432\u0438\u0434\u0435\u043E. \u041C\u043E\u043B\u044F, \u043F\u0440\u043E\u0431\u0432\u0430\u0439\u0442\u0435 \u0441 \u0434\u0440\u0443\u0433 \u0431\u0440\u0430\u0443\u0437\u044A\u0440.",default_error_title:"\u0412\u0438\u0434\u0435\u043E\u0442\u043E \u043D\u0435 \u043C\u043E\u0436\u0435 \u0434\u0430 \u0441\u0435 \u0432\u044A\u0437\u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435.",default_error_message:"\u0412\u044A\u0437\u043D\u0438\u043A\u043D\u0430 \u043F\u0440\u043E\u0431\u043B\u0435\u043C \u043F\u0440\u0438 \u0437\u0430\u0440\u0435\u0436\u0434\u0430\u043D\u0435\u0442\u043E \u043D\u0430 \u0432\u0438\u0434\u0435\u043E\u0442\u043E."},fr:{live:"en direct",back_to_live:"retour au direct",disabled:"D\xE9sactiv\xE9",playback_not_supported:"Votre navigateur ne supporte pas la lecture de cette vid\xE9o. Merci de tenter sur un autre navigateur.",default_error_title:"Impossible de lire la vid\xE9o.",default_error_message:"Un probl\xE8me est survenu lors du chargement de la vid\xE9o."},tr:{live:"canl\u0131",back_to_live:"canl\u0131 yay\u0131na d\xF6n",disabled:"Engelli",playback_not_supported:"Taray\u0131c\u0131n\u0131z bu videoyu oynatma deste\u011Fine sahip de\u011Fil. L\xFCtfen farkl\u0131 bir taray\u0131c\u0131 ile deneyin."},et:{live:"Otse\xFClekanne",back_to_live:"Tagasi otse\xFClekande juurde",disabled:"Keelatud",playback_not_supported:"Teie brauser ei toeta selle video taasesitust. Proovige kasutada muud brauserit."},ar:{live:"\u0645\u0628\u0627\u0634\u0631",back_to_live:"\u0627\u0644\u0631\u062C\u0648\u0639 \u0625\u0644\u0649 \u0627\u0644\u0645\u0628\u0627\u0634\u0631",disabled:"\u0645\u0639\u0637\u0651\u0644",playback_not_supported:"\u0627\u0644\u0645\u062A\u0635\u0641\u062D \u0627\u0644\u0630\u064A \u062A\u0633\u062A\u062E\u062F\u0645\u0647 \u0644\u0627 \u064A\u062F\u0639\u0645 \u062A\u0634\u063A\u064A\u0644 \u0647\u0630\u0627 \u0627\u0644\u0641\u064A\u062F\u064A\u0648. \u0627\u0644\u0631\u062C\u0627\u0621 \u0625\u0633\u062A\u062E\u062F\u0627\u0645 \u0645\u062A\u0635\u0641\u062D \u0622\u062E\u0631.",default_error_title:"\u063A\u064A\u0631 \u0642\u0627\u062F\u0631 \u0627\u0644\u0649 \u0627\u0644\u062A\u0634\u063A\u064A\u0644.",default_error_message:"\u062D\u062F\u062B\u062A \u0645\u0634\u0643\u0644\u0629 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0641\u064A\u062F\u064A\u0648."},zh:{live:"\u76F4\u64AD",back_to_live:"\u8FD4\u56DE\u76F4\u64AD",disabled:"\u5DF2\u7981\u7528",playback_not_supported:"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u8BE5\u89C6\u9891\u7684\u64AD\u653E\u3002\u8BF7\u5C1D\u8BD5\u4F7F\u7528\u53E6\u4E00\u4E2A\u6D4F\u89C8\u5668\u3002",default_error_title:"\u65E0\u6CD5\u64AD\u653E\u89C6\u9891\u3002",default_error_message:"\u5728\u5C1D\u8BD5\u52A0\u8F7D\u89C6\u9891\u65F6\u51FA\u73B0\u4E86\u95EE\u9898\u3002"}},this.core.options.strings||{}),this._messages["de-DE"]=this._messages.de,this._messages["pt-BR"]=this._messages.pt,this._messages["en-US"]=this._messages.en,this._messages["bg-BG"]=this._messages.bg,this._messages["es-419"]=this._messages.es_am,this._messages["es-ES"]=this._messages.es,this._messages["fr-FR"]=this._messages.fr,this._messages["tr-TR"]=this._messages.tr,this._messages["et-EE"]=this._messages.et,this._messages["ar-IQ"]=this._messages.ar,this._messages["zh-CN"]=this._messages.zh}}]),j}(rn),pi=function(J){Bt(j,J);var ee=$i(j);function j(){return ri(this,j),ee.apply(this,arguments)}return ai(j,[{key:"name",get:function(){return"sources"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"bindEvents",value:function(){this.listenTo(this.core,Ae.CORE_CONTAINERS_CREATED,this.onContainersCreated)}},{key:"onContainersCreated",value:function(){var y=this.core.containers.filter(function(F){return F.playback.name!=="no_op"})[0]||this.core.containers[0];y&&this.core.containers.forEach(function(F){F!==y&&F.destroy()})}}]),j}(rn);Rn.registerPlugin(sn),Rn.registerPlugin(pi),Rn.registerPlayback(El),Rn.registerPlayback(Ca),Rn.registerPlayback(bs),Rn.registerPlayback(Tr);var Pn={Player:Lo,Events:Ae,Browser:_t,ContainerPlugin:Mt,UIContainerPlugin:nn,CorePlugin:rn,UICorePlugin:Vi,Playback:qt,Container:zs,Core:Ys,PlayerError:Kr,Loader:Rn,BaseObject:lr,UIObject:jr,Utils:mn,HTML5Audio:bs,HTML5Video:Tr,HTMLImg:Ca,Log:Gt,Styler:vr,version:"0.4.27",template:mr,$:je};function Ei(J,ee){if(!(J instanceof ee))throw new TypeError("Cannot call a class as a function")}function Io(J,ee){for(var j=0;j<ee.length;j++){var y=ee[j];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(J,(F=y.key,re=void 0,typeof(re=function(C,z){if(typeof C!="object"||C===null)return C;var G=C[Symbol.toPrimitive];if(G!==void 0){var de=G.call(C,z||"default");if(typeof de!="object")return de;throw new TypeError("@@toPrimitive must return a primitive value.")}return(z==="string"?String:Number)(C)}(F,"string"))=="symbol"?re:String(re)),y)}var F,re}function ur(J,ee,j){return ee&&Io(J.prototype,ee),j&&Io(J,j),Object.defineProperty(J,"prototype",{writable:!1}),J}function _i(J,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function");J.prototype=Object.create(ee&&ee.prototype,{constructor:{value:J,writable:!0,configurable:!0}}),Object.defineProperty(J,"prototype",{writable:!1}),ee&&on(J,ee)}function an(J){return an=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(ee){return ee.__proto__||Object.getPrototypeOf(ee)},an(J)}function on(J,ee){return on=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(j,y){return j.__proto__=y,j},on(J,ee)}function _l(J,ee){if(ee&&(typeof ee=="object"||typeof ee=="function"))return ee;if(ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(j){if(j===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j}(J)}function Sr(J){var ee=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var j,y=an(J);if(ee){var F=an(this).constructor;j=Reflect.construct(y,arguments,F)}else j=y.apply(this,arguments);return _l(this,j)}}function ao(J,ee){for(;!Object.prototype.hasOwnProperty.call(J,ee)&&(J=an(J))!==null;);return J}function Js(){return Js=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(J,ee,j){var y=ao(J,ee);if(y){var F=Object.getOwnPropertyDescriptor(y,ee);return F.get?F.get.call(arguments.length<3?J:j):F.value}},Js.apply(this,arguments)}var bl=function(J){_i(j,J);var ee=Sr(j);function j(y){return Ei(this,j),ee.call(this,y)}return ur(j,[{key:"name",get:function(){return"click_to_pause"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"config",get:function(){return this.container.options.clickToPauseConfig||{}}},{key:"bindEvents",value:function(){this.listenTo(this.container,Ae.CONTAINER_CLICK,this.click),this.listenTo(this.container,Ae.CONTAINER_SETTINGSUPDATE,this.settingsUpdate)}},{key:"click",value:function(){var y=this.config.onClickPayload;(this.container.getPlaybackType()!==qt.LIVE||this.container.isDvrEnabled())&&(this.container.isPlaying()?this.container.pause(y):this.container.play(y))}},{key:"settingsUpdate",value:function(){var y=this.container.getPlaybackType()!==qt.LIVE||this.container.isDvrEnabled();if(y!==this.pointerEnabled){var F=y?"addClass":"removeClass";this.container.$el[F]("pointer-enabled"),this.pointerEnabled=y}}}]),j}(Mt),Zs=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;Ei(this,j),F=ee.call(this,y);var re=y.options.closedCaptionsConfig;return F._title=re&&re.title?re.title:null,F._ariaLabel=re&&re.ariaLabel?re.ariaLabel:"cc-button",F._labelCb=re&&re.labelCallback&&typeof re.labelCallback=="function"?re.labelCallback:function(C){return C.name},F}return ur(j,[{key:"name",get:function(){return"closed_captions"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"template",get:function(){return mr(`<button type="button" class="cc-button media-control-button media-control-icon" data-cc-button aria-label="<%= ariaLabel %>"></button>
<ul>
  <% if (title) { %>
  <li data-title><%= title %></li>
  <% }; %>
  <li><a href="#" data-cc-select="-1"><%= disabledLabel %></a></li>
  <% for (var i = 0; i < tracks.length; i++) { %>
    <li><a href="#" data-cc-select="<%= tracks[i].id %>"><%= tracks[i].label %></a></li>
  <% }; %>
</ul>
`)}},{key:"events",get:function(){return{"click [data-cc-button]":"toggleContextMenu","click [data-cc-select]":"onTrackSelect"}}},{key:"attributes",get:function(){return{class:"cc-controls","data-cc-controls":""}}},{key:"bindEvents",value:function(){this.listenTo(this.core,Ae.CORE_ACTIVE_CONTAINER_CHANGED,this.containerChanged),this.listenTo(this.core.mediaControl,Ae.MEDIACONTROL_RENDERED,this.render),this.listenTo(this.core.mediaControl,Ae.MEDIACONTROL_HIDE,this.hideContextMenu),this.bindContainerEvents()}},{key:"bindContainerEvents",value:function(){this.container=this.core.activeContainer,this.container&&(this.listenTo(this.container,Ae.CONTAINER_SUBTITLE_AVAILABLE,this.onSubtitleAvailable),this.listenTo(this.container,Ae.CONTAINER_SUBTITLE_CHANGED,this.onSubtitleChanged),this.listenTo(this.container,Ae.CONTAINER_STOP,this.onContainerStop))}},{key:"onContainerStop",value:function(){this.ccAvailable(!1)}},{key:"containerChanged",value:function(){this.ccAvailable(!1),this.stopListening(),this.bindEvents()}},{key:"onSubtitleAvailable",value:function(){this.renderCcButton(),this.ccAvailable(!0)}},{key:"onSubtitleChanged",value:function(y){this.setCurrentContextMenuElement(y.id)}},{key:"onTrackSelect",value:function(y){var F=parseInt(y.target.dataset.ccSelect,10);return this.container.closedCaptionsTrackId=F,this.hideContextMenu(),y.stopPropagation(),!1}},{key:"ccAvailable",value:function(y){var F=y?"addClass":"removeClass";this.$el[F]("available")}},{key:"toggleContextMenu",value:function(){this.$el.find("ul").toggle()}},{key:"hideContextMenu",value:function(){this.$el.find("ul").hide()}},{key:"contextMenuElement",value:function(y){return this.$el.find("ul a"+(isNaN(y)?"":'[data-cc-select="'+y+'"]')).parent()}},{key:"setCurrentContextMenuElement",value:function(y){if(this._trackId!==y){this.contextMenuElement().removeClass("current"),this.contextMenuElement(y).addClass("current");var F=y>-1?"addClass":"removeClass";this.$ccButton[F]("enabled"),this._trackId=y}}},{key:"renderCcButton",value:function(){for(var y=this.container?this.container.closedCaptionsTracks:[],F=0;F<y.length;F++)y[F].label=this._labelCb(y[F]);var re=vr.getStyleFor(`.cc-controls[data-cc-controls] {
  float: right;
  position: relative;
  display: none; }
  .cc-controls[data-cc-controls].available {
    display: block; }
  .cc-controls[data-cc-controls] .cc-button {
    padding: 6px !important; }
    .cc-controls[data-cc-controls] .cc-button.enabled {
      display: block;
      opacity: 1.0; }
      .cc-controls[data-cc-controls] .cc-button.enabled:hover {
        opacity: 1.0;
        text-shadow: none; }
  .cc-controls[data-cc-controls] > ul {
    list-style-type: none;
    position: absolute;
    bottom: 25px;
    border: 1px solid black;
    display: none;
    background-color: #e6e6e6; }
  .cc-controls[data-cc-controls] li {
    font-size: 10px; }
    .cc-controls[data-cc-controls] li[data-title] {
      background-color: #c3c2c2;
      padding: 5px; }
    .cc-controls[data-cc-controls] li a {
      color: #444;
      padding: 2px 10px;
      display: block;
      text-decoration: none; }
      .cc-controls[data-cc-controls] li a:hover {
        background-color: #555;
        color: white; }
        .cc-controls[data-cc-controls] li a:hover a {
          color: white;
          text-decoration: none; }
    .cc-controls[data-cc-controls] li.current a {
      color: #f00; }
`,{baseUrl:this.options.baseUrl});this.$el.html(this.template({ariaLabel:this._ariaLabel,disabledLabel:this.core.i18n.t("disabled"),title:this._title,tracks:y})),this.$ccButton=this.$el.find("button.cc-button[data-cc-button]"),this.$ccButton.append(`<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 49 41.8" style="enable-background:new 0 0 49 41.8;" xml:space="preserve">
<path d="M47.1,0H3.2C1.6,0,0,1.2,0,2.8v31.5C0,35.9,1.6,37,3.2,37h11.9l3.2,1.9l4.7,2.7c0.9,0.5,2-0.1,2-1.1V37h22.1
	c1.6,0,1.9-1.1,1.9-2.7V2.8C49,1.2,48.7,0,47.1,0z M7.2,18.6c0-4.8,3.5-9.3,9.9-9.3c4.8,0,7.1,2.7,7.1,2.7l-2.5,4
	c0,0-1.7-1.7-4.2-1.7c-2.8,0-4.3,2.1-4.3,4.3c0,2.1,1.5,4.4,4.5,4.4c2.5,0,4.9-2.1,4.9-2.1l2.2,4.2c0,0-2.7,2.9-7.6,2.9
	C10.8,27.9,7.2,23.5,7.2,18.6z M36.9,27.9c-6.4,0-9.9-4.4-9.9-9.3c0-4.8,3.5-9.3,9.9-9.3C41.7,9.3,44,12,44,12l-2.5,4
	c0,0-1.7-1.7-4.2-1.7c-2.8,0-4.3,2.1-4.3,4.3c0,2.1,1.5,4.4,4.5,4.4c2.5,0,4.9-2.1,4.9-2.1l2.2,4.2C44.5,25,41.9,27.9,36.9,27.9z"/>
</svg>`),this.$el.append(re[0])}},{key:"render",value:function(){this.renderCcButton();var y=this.core.mediaControl.$el.find("button[data-fullscreen]");return y[0]?this.$el.insertAfter(y):this.core.mediaControl.$el.find(".media-control-right-panel[data-media-control]").prepend(this.$el),this}}]),j}(Vi),jn=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).settingsUpdate(),F}return ur(j,[{key:"template",get:function(){return mr(`<div class="live-info"><%= live %></div>
<button type="button" class="live-button" aria-label="<%= backToLive %>"><%= backToLive %></button>
`)}},{key:"name",get:function(){return"dvr_controls"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"events",get:function(){return{"click .live-button":"click"}}},{key:"attributes",get:function(){return{class:"dvr-controls","data-dvr-controls":""}}},{key:"bindEvents",value:function(){this.bindCoreEvents(),this.bindContainerEvents()}},{key:"bindCoreEvents",value:function(){var y=this;this.core.mediaControl.settings?(this.listenTo(this.core.mediaControl,Ae.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this.listenTo(this.core.mediaControl,Ae.MEDIACONTROL_RENDERED,this.settingsUpdate),this.listenTo(this.core,Ae.CORE_OPTIONS_CHANGE,this.render)):setTimeout(function(){return y.bindCoreEvents()},100)}},{key:"bindContainerEvents",value:function(){this.core.activeContainer&&(this.listenToOnce(this.core.activeContainer,Ae.CONTAINER_TIMEUPDATE,this.render),this.listenTo(this.core.activeContainer,Ae.CONTAINER_PLAYBACKDVRSTATECHANGED,this.dvrChanged))}},{key:"containerChanged",value:function(){this.stopListening(),this.bindEvents()}},{key:"dvrChanged",value:function(y){this.core.getPlaybackType()===qt.LIVE&&(this.settingsUpdate(),this.core.mediaControl.$el.addClass("live"),y?(this.core.mediaControl.$el.addClass("dvr"),this.core.mediaControl.$el.find(".media-control-indicator[data-position], .media-control-indicator[data-duration]").hide()):this.core.mediaControl.$el.removeClass("dvr"))}},{key:"click",value:function(){var y=this.core.mediaControl,F=y.container;F.isPlaying()||F.play(),y.$el.hasClass("dvr")&&F.seek(F.getDuration())}},{key:"settingsUpdate",value:function(){var y=this;this.stopListening(),this.core.mediaControl.$el.removeClass("live"),this.shouldRender()&&(this.render(),this.$el.click(function(){return y.click()})),this.bindEvents()}},{key:"shouldRender",value:function(){return(this.core.options.useDvrControls===void 0||!!this.core.options.useDvrControls)&&this.core.getPlaybackType()===qt.LIVE}},{key:"render",value:function(){var y=vr.getStyleFor(`.dvr-controls[data-dvr-controls] {
  display: inline-block;
  float: left;
  color: #fff;
  line-height: 32px;
  font-size: 10px;
  font-weight: bold;
  margin-left: 6px; }
  .dvr-controls[data-dvr-controls] .live-info {
    cursor: default;
    font-family: "Roboto", "Open Sans", Arial, sans-serif;
    text-transform: uppercase; }
    .dvr-controls[data-dvr-controls] .live-info:before {
      content: "";
      display: inline-block;
      position: relative;
      width: 7px;
      height: 7px;
      border-radius: 3.5px;
      margin-right: 3.5px;
      background-color: #ff0101; }
    .dvr-controls[data-dvr-controls] .live-info.disabled {
      opacity: 0.3; }
      .dvr-controls[data-dvr-controls] .live-info.disabled:before {
        background-color: #fff; }
  .dvr-controls[data-dvr-controls] .live-button {
    cursor: pointer;
    outline: none;
    display: none;
    border: 0;
    color: #fff;
    background-color: transparent;
    height: 32px;
    padding: 0;
    opacity: 0.7;
    font-family: "Roboto", "Open Sans", Arial, sans-serif;
    text-transform: uppercase;
    transition: all 0.1s ease; }
    .dvr-controls[data-dvr-controls] .live-button:before {
      content: "";
      display: inline-block;
      position: relative;
      width: 7px;
      height: 7px;
      border-radius: 3.5px;
      margin-right: 3.5px;
      background-color: #fff; }
    .dvr-controls[data-dvr-controls] .live-button:hover {
      opacity: 1;
      text-shadow: rgba(255, 255, 255, 0.75) 0 0 5px; }

.dvr .dvr-controls[data-dvr-controls] .live-info {
  display: none; }

.dvr .dvr-controls[data-dvr-controls] .live-button {
  display: block; }

.dvr.media-control.live[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-2[data-seekbar] {
  background-color: #005aff; }

.media-control.live[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-2[data-seekbar] {
  background-color: #ff0101; }
`,{baseUrl:this.options.baseUrl});return this.$el.html(this.template({live:this.core.i18n.t("live"),backToLive:this.core.i18n.t("back_to_live")})),this.$el.append(y[0]),this.shouldRender()&&(this.core.mediaControl.$el.addClass("live"),this.core.mediaControl.$(".media-control-left-panel[data-media-control]").append(this.$el)),this}}]),j}(Vi),Su=function(J){_i(j,J);var ee=Sr(j);function j(){return Ei(this,j),ee.apply(this,arguments)}return ur(j,[{key:"name",get:function(){return"end_video"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"bindEvents",value:function(){this.listenTo(this.core,Ae.CORE_ACTIVE_CONTAINER_CHANGED,this.containerChanged);var y=this.core.activeContainer;y&&(this.listenTo(y,Ae.CONTAINER_ENDED,this.ended),this.listenTo(y,Ae.CONTAINER_STOP,this.ended))}},{key:"containerChanged",value:function(){this.stopListening(),this.bindEvents()}},{key:"ended",value:function(){(this.core.options.exitFullscreenOnEnd===void 0||this.core.options.exitFullscreenOnEnd)&&this.core.isFullscreen()&&this.core.toggleFullscreen()}}]),j}(rn),oo=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).options.disableErrorScreen?_l(F,F.disable()):F}return ur(j,[{key:"name",get:function(){return"error_screen"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"template",get:function(){return mr(`<div class="player-error-screen__content" data-error-screen>
  <% if (icon) { %>
  <div class="player-error-screen__icon" data-error-screen><%= icon %></div>
  <% } %>
  <div class="player-error-screen__title" data-error-screen><%= title %></div>
  <div class="player-error-screen__message" data-error-screen><%= message %></div>
  <div class="player-error-screen__code" data-error-screen>Error code: <%= code %></div>
  <div class="player-error-screen__reload" data-error-screen><%= reloadIcon %></div>
</div>
`)}},{key:"container",get:function(){return this.core.getCurrentContainer()}},{key:"attributes",get:function(){return{class:"player-error-screen","data-error-screen":""}}},{key:"bindEvents",value:function(){this.listenTo(this.core,Ae.ERROR,this.onError),this.listenTo(this.core,Ae.CORE_ACTIVE_CONTAINER_CHANGED,this.onContainerChanged)}},{key:"bindReload",value:function(){this.reloadButton=this.$el.find(".player-error-screen__reload"),this.reloadButton&&this.reloadButton.on("click",this.reload.bind(this))}},{key:"reload",value:function(){var y=this;this.listenToOnce(this.core,Ae.CORE_READY,function(){return y.container.play()}),this.core.load(this.options.sources,this.options.mimeType),this.unbindReload()}},{key:"unbindReload",value:function(){this.reloadButton&&this.reloadButton.off("click")}},{key:"onContainerChanged",value:function(){this.err=null,this.unbindReload(),this.hide()}},{key:"onError",value:function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};y.level===Kr.Levels.FATAL&&(this.err=y,this.container.disableMediaControl(),this.container.stop(),this.show())}},{key:"show",value:function(){this.render(),this.$el.show()}},{key:"hide",value:function(){this.$el.hide()}},{key:"render",value:function(){if(this.err){var y=vr.getStyleFor(`[data-player] .player-error-screen {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  color: #CCCACA;
  position: absolute;
  top: 0;
  height: 100%;
  width: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 2000;
  display: flex;
  flex-direction: column;
  justify-content: center; }
  [data-player] .player-error-screen__content[data-error-screen] {
    font-size: 14px;
    color: #CCCACA;
    margin-top: 45px; }
  [data-player] .player-error-screen__title[data-error-screen] {
    font-weight: bold;
    line-height: 30px;
    font-size: 18px; }
  [data-player] .player-error-screen__message[data-error-screen] {
    width: 90%;
    margin: 0 auto; }
  [data-player] .player-error-screen__code[data-error-screen] {
    font-size: 13px;
    margin-top: 15px; }
  [data-player] .player-error-screen__reload {
    cursor: pointer;
    width: 30px;
    margin: 15px auto 0 !important; }
`,{baseUrl:this.options.baseUrl});return this.$el.html(this.template({title:this.err.UI.title,message:this.err.UI.message,code:this.err.code,icon:this.err.UI.icon||"",reloadIcon:`<svg fill="#FFFFFF" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`})),this.$el.append(y[0]),this.core.$el.append(this.el),this.bindReload(),this}}}]),j}(Vi),rs=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill="#010101" d="M1.425.35L14.575 8l-13.15 7.65V.35z"/>
</svg>`,cr=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#010101" d="M1.712 14.76H6.43V1.24H1.71v13.52zm7.86-13.52v13.52h4.716V1.24H9.573z"/>
</svg>`,As=je('link[rel="shortcut icon"]'),Ri=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y))._container=null,F.configure(),F}return ur(j,[{key:"name",get:function(){return"favicon"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"oldIcon",get:function(){return As}},{key:"configure",value:function(){this.core.options.changeFavicon?this.enabled||(this.stopListening(this.core,Ae.CORE_OPTIONS_CHANGE),this.enable()):this.enabled&&(this.disable(),this.listenTo(this.core,Ae.CORE_OPTIONS_CHANGE,this.configure))}},{key:"bindEvents",value:function(){this.listenTo(this.core,Ae.CORE_OPTIONS_CHANGE,this.configure),this.listenTo(this.core,Ae.CORE_ACTIVE_CONTAINER_CHANGED,this.containerChanged),this.core.activeContainer&&this.containerChanged()}},{key:"containerChanged",value:function(){this._container&&this.stopListening(this._container),this._container=this.core.activeContainer,this.listenTo(this._container,Ae.CONTAINER_PLAY,this.setPlayIcon),this.listenTo(this._container,Ae.CONTAINER_PAUSE,this.setPauseIcon),this.listenTo(this._container,Ae.CONTAINER_STOP,this.resetIcon),this.listenTo(this._container,Ae.CONTAINER_ENDED,this.resetIcon),this.listenTo(this._container,Ae.CONTAINER_ERROR,this.resetIcon),this.resetIcon()}},{key:"disable",value:function(){Js(an(j.prototype),"disable",this).call(this),this.resetIcon()}},{key:"destroy",value:function(){Js(an(j.prototype),"destroy",this).call(this),this.resetIcon()}},{key:"createIcon",value:function(y){var F=je("<canvas/>");F[0].width=16,F[0].height=16;var re=F[0].getContext("2d");re.fillStyle="#000";var C=je(y).find("path").attr("d"),z=new Path2D(C);re.fill(z);var G=je('<link rel="shortcut icon" type="image/png"/>');return G.attr("href",F[0].toDataURL("image/png")),G}},{key:"setPlayIcon",value:function(){this.playIcon||(this.playIcon=this.createIcon(rs)),this.changeIcon(this.playIcon)}},{key:"setPauseIcon",value:function(){this.pauseIcon||(this.pauseIcon=this.createIcon(cr)),this.changeIcon(this.pauseIcon)}},{key:"resetIcon",value:function(){je('link[rel="shortcut icon"]').remove(),je("head").append(this.oldIcon)}},{key:"changeIcon",value:function(y){y&&(je('link[rel="shortcut icon"]').remove(),je("head").append(y))}}]),j}(rn),Al=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).container.options.gaAccount&&(F.account=F.container.options.gaAccount,F.trackerName=F.container.options.gaTrackerName?F.container.options.gaTrackerName+".":"Clappr.",F.domainName=F.container.options.gaDomainName,F.currentHDState=void 0,F.embedScript()),F}return ur(j,[{key:"name",get:function(){return"google_analytics"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"embedScript",value:function(){var y=this;if(window._gat)this.addEventListeners();else{var F=document.createElement("script");F.setAttribute("type","text/javascript"),F.setAttribute("async","async"),F.setAttribute("src","//www.google-analytics.com/ga.js"),F.onload=function(){return y.addEventListeners()},document.body.appendChild(F)}}},{key:"addEventListeners",value:function(){var y=this;this.container&&(this.listenTo(this.container,Ae.CONTAINER_READY,this.onReady),this.listenTo(this.container,Ae.CONTAINER_PLAY,this.onPlay),this.listenTo(this.container,Ae.CONTAINER_STOP,this.onStop),this.listenTo(this.container,Ae.CONTAINER_PAUSE,this.onPause),this.listenTo(this.container,Ae.CONTAINER_ENDED,this.onEnded),this.listenTo(this.container,Ae.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this.container,Ae.CONTAINER_STATE_BUFFERFULL,this.onBufferFull),this.listenTo(this.container,Ae.CONTAINER_ERROR,this.onError),this.listenTo(this.container,Ae.CONTAINER_PLAYBACKSTATE,this.onPlaybackChanged),this.listenTo(this.container,Ae.CONTAINER_VOLUME,function(F){return y.onVolumeChanged(F)}),this.listenTo(this.container,Ae.CONTAINER_SEEK,function(F){return y.onSeek(F)}),this.listenTo(this.container,Ae.CONTAINER_FULL_SCREEN,this.onFullscreen),this.listenTo(this.container,Ae.CONTAINER_HIGHDEFINITIONUPDATE,this.onHD),this.listenTo(this.container,Ae.CONTAINER_PLAYBACKDVRSTATECHANGED,this.onDVR)),_gaq.push([this.trackerName+"_setAccount",this.account]),this.domainName&&_gaq.push([this.trackerName+"_setDomainName",this.domainName])}},{key:"onReady",value:function(){this.push(["Video","Playback",this.container.playback.name])}},{key:"onPlay",value:function(){this.push(["Video","Play",this.container.playback.src])}},{key:"onStop",value:function(){this.push(["Video","Stop",this.container.playback.src])}},{key:"onEnded",value:function(){this.push(["Video","Ended",this.container.playback.src])}},{key:"onBuffering",value:function(){this.push(["Video","Buffering",this.container.playback.src])}},{key:"onBufferFull",value:function(){this.push(["Video","Bufferfull",this.container.playback.src])}},{key:"onError",value:function(){this.push(["Video","Error",this.container.playback.src])}},{key:"onHD",value:function(y){var F=y?"ON":"OFF";F!==this.currentHDState&&(this.currentHDState=F,this.push(["Video","HD - "+F,this.container.playback.src]))}},{key:"onPlaybackChanged",value:function(y){y.type!==null&&this.push(["Video","Playback Type - "+y.type,this.container.playback.src])}},{key:"onDVR",value:function(y){var F=y?"ON":"OFF";this.push(["Interaction","DVR - "+F,this.container.playback.src])}},{key:"onPause",value:function(){this.push(["Video","Pause",this.container.playback.src])}},{key:"onSeek",value:function(){this.push(["Video","Seek",this.container.playback.src])}},{key:"onVolumeChanged",value:function(){this.push(["Interaction","Volume",this.container.playback.src])}},{key:"onFullscreen",value:function(){this.push(["Interaction","Fullscreen",this.container.playback.src])}},{key:"push",value:function(y){var F=[this.trackerName+"_trackEvent"].concat(y);_gaq.push(F)}}]),j}(Mt),Tt=function(J){this.element=J||window.document,this.initialize()};Tt.KEY_NAMES_BY_CODE={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"caps_lock",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},Tt.KEY_CODES_BY_NAME={},function(){for(var J in Tt.KEY_NAMES_BY_CODE)Object.prototype.hasOwnProperty.call(Tt.KEY_NAMES_BY_CODE,J)&&(Tt.KEY_CODES_BY_NAME[Tt.KEY_NAMES_BY_CODE[J]]=+J)}(),Tt.MODIFIERS=["shift","ctrl","alt"],Tt.registerEvent=document.addEventListener?function(J,ee,j){J.addEventListener(ee,j,!1)}:document.attachEvent?function(J,ee,j){J.attachEvent("on"+ee,j)}:void 0,Tt.unregisterEvent=document.removeEventListener?function(J,ee,j){J.removeEventListener(ee,j,!1)}:document.detachEvent?function(J,ee,j){J.detachEvent("on"+ee,j)}:void 0,Tt.stringContains=function(J,ee){return J.indexOf(ee)!==-1},Tt.neatString=function(J){return J.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")},Tt.capitalize=function(J){return J.toLowerCase().replace(/^./,function(ee){return ee.toUpperCase()})},Tt.isString=function(J){return Tt.stringContains(Object.prototype.toString.call(J),"String")},Tt.arrayIncludes=Array.prototype.indexOf?function(J,ee){return J.indexOf(ee)!==-1}:function(J,ee){for(var j=0;j<J.length;j++)if(J[j]===ee)return!0;return!1},Tt.extractModifiers=function(J){var ee,j;for(ee=[],j=0;j<Tt.MODIFIERS.length;j++)Tt.stringContains(J,Tt.MODIFIERS[j])&&ee.push(Tt.MODIFIERS[j]);return ee},Tt.extractKey=function(J){var ee,j;for(ee=Tt.neatString(J).split(" "),j=0;j<ee.length;j++)if(!Tt.arrayIncludes(Tt.MODIFIERS,ee[j]))return ee[j]},Tt.modifiersAndKey=function(J){var ee,j;return Tt.stringContains(J,"any")?Tt.neatString(J).split(" ").slice(0,2).join(" "):(ee=Tt.extractModifiers(J),(j=Tt.extractKey(J))&&!Tt.arrayIncludes(Tt.MODIFIERS,j)&&ee.push(j),ee.join(" "))},Tt.keyName=function(J){return Tt.KEY_NAMES_BY_CODE[J+""]},Tt.keyCode=function(J){return+Tt.KEY_CODES_BY_NAME[J]},Tt.prototype.initialize=function(){var J,ee=this;for(this.lastKeyCode=-1,this.lastModifiers={},J=0;J<Tt.MODIFIERS.length;J++)this.lastModifiers[Tt.MODIFIERS[J]]=!1;this.keysDown={any:[]},this.keysUp={any:[]},this.downHandler=this.handler("down"),this.upHandler=this.handler("up"),Tt.registerEvent(this.element,"keydown",this.downHandler),Tt.registerEvent(this.element,"keyup",this.upHandler),Tt.registerEvent(window,"unload",function j(){Tt.unregisterEvent(ee.element,"keydown",ee.downHandler),Tt.unregisterEvent(ee.element,"keyup",ee.upHandler),Tt.unregisterEvent(window,"unload",j)})},Tt.prototype.handler=function(J){var ee=this;return function(j){var y,F,re;for(j=j||window.event,ee.lastKeyCode=j.keyCode,y=0;y<Tt.MODIFIERS.length;y++)ee.lastModifiers[Tt.MODIFIERS[y]]=j[Tt.MODIFIERS[y]+"Key"];for(Tt.arrayIncludes(Tt.MODIFIERS,Tt.keyName(ee.lastKeyCode))&&(ee.lastModifiers[Tt.keyName(ee.lastKeyCode)]=!0),F=ee["keys"+Tt.capitalize(J)],y=0;y<F.any.length;y++)F.any[y](j)===!1&&j.preventDefault&&j.preventDefault();if(F[re=ee.lastModifiersAndKey()])for(y=0;y<F[re].length;y++)F[re][y](j)===!1&&j.preventDefault&&j.preventDefault()}},Tt.prototype.registerKeys=function(J,ee,j){var y,F,re=this["keys"+Tt.capitalize(J)];for(Tt.isString(ee)&&(ee=[ee]),y=0;y<ee.length;y++)F=ee[y],re[F=Tt.modifiersAndKey(F+"")]?re[F].push(j):re[F]=[j];return this},Tt.prototype.unregisterKeys=function(J,ee,j){var y,F,re,C=this["keys"+Tt.capitalize(J)];for(Tt.isString(ee)&&(ee=[ee]),y=0;y<ee.length;y++)if(re=ee[y],re=Tt.modifiersAndKey(re+""),j===null)delete C[re];else if(C[re]){for(F=0;F<C[re].length;F++)if(String(C[re][F])===String(j)){C[re].splice(F,1);break}}return this},Tt.prototype.off=function(J){return this.unregisterKeys("down",J,null)},Tt.prototype.delegate=function(J,ee,j){return j!==null||j!==void 0?this.registerKeys(J,ee,j):this.unregisterKeys(J,ee,j)},Tt.prototype.down=function(J,ee){return this.delegate("down",J,ee)},Tt.prototype.up=function(J,ee){return this.delegate("up",J,ee)},Tt.prototype.lastKey=function(J){return J?this.lastModifiers[J]:Tt.keyName(this.lastKeyCode)},Tt.prototype.lastModifiersAndKey=function(){var J,ee;for(J=[],ee=0;ee<Tt.MODIFIERS.length;ee++)this.lastKey(Tt.MODIFIERS[ee])&&J.push(Tt.MODIFIERS[ee]);return Tt.arrayIncludes(J,this.lastKey())||J.push(this.lastKey()),J.join(" ")};var lt={Kibo:Tt},ka=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#010101" d="M1.712 1.24h12.6v13.52h-12.6z"/>
</svg>`,Ro=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#010101" d="M11.5 11h-.002v1.502L7.798 10H4.5V6h3.297l3.7-2.502V4.5h.003V11zM11 4.49L7.953 6.5H5v3h2.953L11 11.51V4.49z"/>
</svg>`,ea=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill="#010101" d="M7.156 8L4 11.156V8.5H3V13h4.5v-1H4.844L8 8.844 7.156 8zM8.5 3v1h2.657L8 7.157 8.846 8 12 4.844V7.5h1V3H8.5z"/>
</svg>`,$r=mn.Config,Ss=mn.Fullscreen,Da=mn.formatTime,wa=mn.extend,ta=mn.removeArrayItem,Kn=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).persistConfig=F.options.persistConfig,F.currentPositionValue=null,F.currentDurationValue=null,F.keepVisible=!1,F.fullScreenOnVideoTagSupported=null,F.setInitialVolume(),F.settings={left:["play","stop","pause"],right:["volume"],default:["position","seekbar","duration"]},F.kibo=new Tt(F.options.focusElement),F.bindKeyEvents(),F.container?je.isEmptyObject(F.container.settings)||(F.settings=je.extend({},F.container.settings)):F.settings={},F.userDisabled=!1,(F.container&&F.container.mediaControlDisabled||F.options.chromeless)&&F.disable(),F.stopDragHandler=function(re){return F.stopDrag(re)},F.updateDragHandler=function(re){return F.updateDrag(re)},je(document).bind("mouseup",F.stopDragHandler),je(document).bind("mousemove",F.updateDragHandler),F}return ur(j,[{key:"name",get:function(){return"media_control"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"disabled",get:function(){var y=this.container&&this.container.getPlaybackType()===qt.NO_OP;return this.userDisabled||y}},{key:"container",get:function(){return this.core&&this.core.activeContainer}},{key:"playback",get:function(){return this.core&&this.core.activePlayback}},{key:"attributes",get:function(){return{class:"media-control","data-media-control":""}}},{key:"events",get:function(){return{"click [data-play]":"play","click [data-pause]":"pause","click [data-playpause]":"togglePlayPause","click [data-stop]":"stop","click [data-playstop]":"togglePlayStop","click [data-fullscreen]":"toggleFullscreen","click .bar-container[data-seekbar]":"seek","click .bar-container[data-volume]":"onVolumeClick","click .drawer-icon[data-volume]":"toggleMute","mouseenter .drawer-container[data-volume]":"showVolumeBar","mouseleave .drawer-container[data-volume]":"hideVolumeBar","mousedown .bar-container[data-volume]":"startVolumeDrag","mousemove .bar-container[data-volume]":"mousemoveOnVolumeBar","mousedown .bar-scrubber[data-seekbar]":"startSeekDrag","mousemove .bar-container[data-seekbar]":"mousemoveOnSeekBar","mouseleave .bar-container[data-seekbar]":"mouseleaveOnSeekBar","mouseenter .media-control-layer[data-controls]":"setUserKeepVisible","mouseleave .media-control-layer[data-controls]":"resetUserKeepVisible"}}},{key:"template",get:function(){return mr(`<div class="media-control-background" data-background></div>
<div class="media-control-layer" data-controls>
  <%  var renderBar = function(name) { %>
      <div class="bar-container" data-<%= name %>>
        <div class="bar-background" data-<%= name %>>
          <div class="bar-fill-1" data-<%= name %>></div>
          <div class="bar-fill-2" data-<%= name %>></div>
          <div class="bar-hover" data-<%= name %>></div>
        </div>
        <div class="bar-scrubber" data-<%= name %>>
          <div class="bar-scrubber-icon" data-<%= name %>></div>
        </div>
      </div>
  <%  }; %>
  <%  var renderSegmentedBar = function(name, segments) {
      segments = segments || 10; %>
    <div class="bar-container" data-<%= name %>>
    <% for (var i = 0; i < segments; i++) { %>
      <div class="segmented-bar-element" data-<%= name %>></div>
    <% } %>
    </div>
  <% }; %>
  <% var renderDrawer = function(name, renderContent) { %>
      <div class="drawer-container" data-<%= name %>>
        <div class="drawer-icon-container" data-<%= name %>>
          <div class="drawer-icon media-control-icon" data-<%= name %>></div>
          <span class="drawer-text" data-<%= name %>></span>
        </div>
        <% renderContent(name); %>
      </div>
  <% }; %>
  <% var renderIndicator = function(name) { %>
      <div class="media-control-indicator" data-<%= name %>></div>
  <% }; %>
  <% var renderButton = function(name) { %>
    <button type="button" class="media-control-button media-control-icon" data-<%= name %> aria-label="<%= name %>"></button>
  <% }; %>
  <%  var templates = {
        bar: renderBar,
        segmentedBar: renderSegmentedBar,
      };
      var render = function(settingsList) {
        settingsList.forEach(function(setting) {
          if(setting === "seekbar") {
            renderBar(setting);
          } else if (setting === "volume") {
            renderDrawer(setting, settings.volumeBarTemplate ? templates[settings.volumeBarTemplate] : function(name) { return renderSegmentedBar(name); });
          } else if (setting === "duration" || setting === "position") {
            renderIndicator(setting);
          } else {
            renderButton(setting);
          }
        });
      }; %>
  <% if (settings.default && settings.default.length) { %>
  <div class="media-control-center-panel" data-media-control>
    <% render(settings.default); %>
  </div>
  <% } %>
  <% if (settings.left && settings.left.length) { %>
  <div class="media-control-left-panel" data-media-control>
    <% render(settings.left); %>
  </div>
  <% } %>
  <% if (settings.right && settings.right.length) { %>
  <div class="media-control-right-panel" data-media-control>
    <% render(settings.right); %>
  </div>
  <% } %>
</div>
`)}},{key:"volume",get:function(){return this.container&&this.container.isReady?this.container.volume:this.intendedVolume}},{key:"muted",get:function(){return this.volume===0}},{key:"getExternalInterface",value:function(){var y=this;return{setVolume:this.setVolume,getVolume:function(){return y.volume}}}},{key:"bindEvents",value:function(){var y=this;this.stopListening(),this.listenTo(this.core,Ae.CORE_ACTIVE_CONTAINER_CHANGED,this.onActiveContainerChanged),this.listenTo(this.core,Ae.CORE_MOUSE_MOVE,this.show),this.listenTo(this.core,Ae.CORE_MOUSE_LEAVE,function(){return y.hide(y.options.hideMediaControlDelay)}),this.listenTo(this.core,Ae.CORE_FULLSCREEN,this.show),this.listenTo(this.core,Ae.CORE_OPTIONS_CHANGE,this.configure),this.listenTo(this.core,Ae.CORE_RESIZE,this.playerResize),this.bindContainerEvents()}},{key:"bindContainerEvents",value:function(){this.container&&(this.listenTo(this.container,Ae.CONTAINER_PLAY,this.changeTogglePlay),this.listenTo(this.container,Ae.CONTAINER_PAUSE,this.changeTogglePlay),this.listenTo(this.container,Ae.CONTAINER_STOP,this.changeTogglePlay),this.listenTo(this.container,Ae.CONTAINER_DBLCLICK,this.toggleFullscreen),this.listenTo(this.container,Ae.CONTAINER_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this.container,Ae.CONTAINER_PROGRESS,this.updateProgressBar),this.listenTo(this.container,Ae.CONTAINER_SETTINGSUPDATE,this.settingsUpdate),this.listenTo(this.container,Ae.CONTAINER_PLAYBACKDVRSTATECHANGED,this.settingsUpdate),this.listenTo(this.container,Ae.CONTAINER_HIGHDEFINITIONUPDATE,this.highDefinitionUpdate),this.listenTo(this.container,Ae.CONTAINER_MEDIACONTROL_DISABLE,this.disable),this.listenTo(this.container,Ae.CONTAINER_MEDIACONTROL_ENABLE,this.enable),this.listenTo(this.container,Ae.CONTAINER_ENDED,this.ended),this.listenTo(this.container,Ae.CONTAINER_VOLUME,this.onVolumeChanged),this.listenTo(this.container,Ae.CONTAINER_OPTIONS_CHANGE,this.setInitialVolume),this.container.playback.el.nodeName.toLowerCase()==="video"&&this.listenToOnce(this.container,Ae.CONTAINER_LOADEDMETADATA,this.onLoadedMetadataOnVideoTag))}},{key:"disable",value:function(){this.userDisabled=!0,this.hide(),this.unbindKeyEvents(),this.$el.hide()}},{key:"enable",value:function(){this.options.chromeless||(this.userDisabled=!1,this.bindKeyEvents(),this.show())}},{key:"play",value:function(){this.container&&this.container.play()}},{key:"pause",value:function(){this.container&&this.container.pause()}},{key:"stop",value:function(){this.container&&this.container.stop()}},{key:"setInitialVolume",value:function(){var y=this.persistConfig?$r.restore("volume"):100,F=this.container&&this.container.options||this.options;this.setVolume(F.mute?0:y,!0)}},{key:"onVolumeChanged",value:function(){this.updateVolumeUI()}},{key:"onLoadedMetadataOnVideoTag",value:function(){var y=this.playback&&this.playback.el;!Ss.fullscreenEnabled()&&y.webkitSupportsFullscreen&&(this.fullScreenOnVideoTagSupported=!0,this.settingsUpdate())}},{key:"updateVolumeUI",value:function(){if(this.rendered){this.$volumeBarContainer.find(".bar-fill-2").css({});var y=this.$volumeBarContainer.width(),F=this.$volumeBarBackground.width(),re=(y-F)/2,C=F*this.volume/100+re;this.$volumeBarFill.css({width:"".concat(this.volume,"%")}),this.$volumeBarScrubber.css({left:C}),this.$volumeBarContainer.find(".segmented-bar-element").removeClass("fill");var z=Math.ceil(this.volume/10);this.$volumeBarContainer.find(".segmented-bar-element").slice(0,z).addClass("fill"),this.$volumeIcon.html(""),this.$volumeIcon.removeClass("muted"),this.muted?(this.$volumeIcon.append(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#010101" d="M9.75 11.51L6.7 9.5H3.75v-3H6.7L9.75 4.49v.664l.497.498V3.498L6.547 6H3.248v4h3.296l3.7 2.502v-2.154l-.497.5v.662zm3-5.165L12.404 6l-1.655 1.653L9.093 6l-.346.345L10.402 8 8.747 9.654l.346.347 1.655-1.653L12.403 10l.348-.346L11.097 8l1.655-1.655z"/>
</svg>`),this.$volumeIcon.addClass("muted")):this.$volumeIcon.append(Ro),this.applyButtonStyle(this.$volumeIcon)}}},{key:"changeTogglePlay",value:function(){this.$playPauseToggle.html(""),this.$playStopToggle.html(""),this.container&&this.container.isPlaying()?(this.$playPauseToggle.append(cr),this.$playStopToggle.append(ka),this.trigger(Ae.MEDIACONTROL_PLAYING)):(this.$playPauseToggle.append(rs),this.$playStopToggle.append(rs),this.trigger(Ae.MEDIACONTROL_NOTPLAYING),_t.isMobile&&this.show()),this.applyButtonStyle(this.$playPauseToggle),this.applyButtonStyle(this.$playStopToggle)}},{key:"mousemoveOnSeekBar",value:function(y){if(this.settings.seekEnabled){var F=y.pageX-this.$seekBarContainer.offset().left-this.$seekBarHover.width()/2;this.$seekBarHover.css({left:F})}this.trigger(Ae.MEDIACONTROL_MOUSEMOVE_SEEKBAR,y)}},{key:"mouseleaveOnSeekBar",value:function(y){this.trigger(Ae.MEDIACONTROL_MOUSELEAVE_SEEKBAR,y)}},{key:"onVolumeClick",value:function(y){this.setVolume(this.getVolumeFromUIEvent(y))}},{key:"mousemoveOnVolumeBar",value:function(y){this.draggingVolumeBar&&this.setVolume(this.getVolumeFromUIEvent(y))}},{key:"playerResize",value:function(y){this.$fullscreenToggle.html("");var F=this.core.isFullscreen()?`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill="#010101" d="M13.5 3.344l-.844-.844L9.5 5.656V3h-1v4.5H13v-1h-2.656L13.5 3.344zM3 9.5h2.656L2.5 12.656l.844.844L6.5 10.344V13h1V8.5H3v1z"/>
</svg>`:ea;this.$fullscreenToggle.append(F),this.applyButtonStyle(this.$fullscreenToggle),this.$el.find(".media-control").length!==0&&this.$el.removeClass("w320"),(y.width<=320||this.options.hideVolumeBar)&&this.$el.addClass("w320")}},{key:"togglePlayPause",value:function(){return this.container.isPlaying()?this.container.pause():this.container.play(),!1}},{key:"togglePlayStop",value:function(){this.container.isPlaying()?this.container.stop():this.container.play()}},{key:"startSeekDrag",value:function(y){this.settings.seekEnabled&&(this.draggingSeekBar=!0,this.$el.addClass("dragging"),this.$seekBarLoaded.addClass("media-control-notransition"),this.$seekBarPosition.addClass("media-control-notransition"),this.$seekBarScrubber.addClass("media-control-notransition"),y&&y.preventDefault())}},{key:"startVolumeDrag",value:function(y){this.draggingVolumeBar=!0,this.$el.addClass("dragging"),y&&y.preventDefault()}},{key:"stopDrag",value:function(y){this.draggingSeekBar&&this.seek(y),this.$el.removeClass("dragging"),this.$seekBarLoaded.removeClass("media-control-notransition"),this.$seekBarPosition.removeClass("media-control-notransition"),this.$seekBarScrubber.removeClass("media-control-notransition dragging"),this.draggingSeekBar=!1,this.draggingVolumeBar=!1}},{key:"updateDrag",value:function(y){if(this.draggingSeekBar){y.preventDefault();var F=(y.pageX-this.$seekBarContainer.offset().left)/this.$seekBarContainer.width()*100;F=Math.min(100,Math.max(F,0)),this.setSeekPercentage(F)}else this.draggingVolumeBar&&(y.preventDefault(),this.setVolume(this.getVolumeFromUIEvent(y)))}},{key:"getVolumeFromUIEvent",value:function(y){return(y.pageX-this.$volumeBarContainer.offset().left)/this.$volumeBarContainer.width()*100}},{key:"toggleMute",value:function(){this.setVolume(this.muted?100:0)}},{key:"setVolume",value:function(y){var F=this,re=arguments.length>1&&arguments[1]!==void 0&&arguments[1];y=Math.min(100,Math.max(y,0)),this.intendedVolume=y,this.persistConfig&&!re&&$r.persist("volume",y);var C=function(){F.container&&F.container.isReady?F.container.setVolume(y):F.listenToOnce(F.container,Ae.CONTAINER_READY,function(){F.container.setVolume(y)})};this.container?C():this.listenToOnce(this,Ae.MEDIACONTROL_CONTAINERCHANGED,function(){return C()})}},{key:"toggleFullscreen",value:function(){this.trigger(Ae.MEDIACONTROL_FULLSCREEN,this.name),this.container.fullscreen(),this.core.toggleFullscreen(),this.resetUserKeepVisible()}},{key:"onActiveContainerChanged",value:function(){this.fullScreenOnVideoTagSupported=null,this.bindEvents(),this.setInitialVolume(),this.changeTogglePlay(),this.bindContainerEvents(),this.settingsUpdate(),this.container&&this.container.trigger(Ae.CONTAINER_PLAYBACKDVRSTATECHANGED,this.container.isDvrInUse()),this.container&&this.container.mediaControlDisabled&&this.disable(),this.trigger(Ae.MEDIACONTROL_CONTAINERCHANGED)}},{key:"showVolumeBar",value:function(){this.hideVolumeId&&clearTimeout(this.hideVolumeId),this.$volumeBarContainer.removeClass("volume-bar-hide")}},{key:"hideVolumeBar",value:function(){var y=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:400;this.$volumeBarContainer&&(this.draggingVolumeBar?this.hideVolumeId=setTimeout(function(){return y.hideVolumeBar()},F):(this.hideVolumeId&&clearTimeout(this.hideVolumeId),this.hideVolumeId=setTimeout(function(){return y.$volumeBarContainer.addClass("volume-bar-hide")},F)))}},{key:"ended",value:function(){this.changeTogglePlay()}},{key:"updateProgressBar",value:function(y){var F=y.start/y.total*100,re=y.current/y.total*100;this.$seekBarLoaded.css({left:"".concat(F,"%"),width:"".concat(re-F,"%")})}},{key:"onTimeUpdate",value:function(y){if(!this.draggingSeekBar){var F=y.current<0?y.total:y.current;this.currentPositionValue=F,this.currentDurationValue=y.total,this.renderSeekBar()}}},{key:"renderSeekBar",value:function(){if(this.currentPositionValue!==null&&this.currentDurationValue!==null){this.currentSeekBarPercentage=100,this.container&&(this.container.getPlaybackType()!==qt.LIVE||this.container.isDvrInUse())&&(this.currentSeekBarPercentage=this.currentPositionValue/this.currentDurationValue*100),this.setSeekPercentage(this.currentSeekBarPercentage);var y=Da(this.currentPositionValue),F=Da(this.currentDurationValue);y!==this.displayedPosition&&(this.$position.text(y),this.displayedPosition=y),F!==this.displayedDuration&&(this.$duration.text(F),this.displayedDuration=F)}}},{key:"seek",value:function(y){if(this.settings.seekEnabled){var F=(y.pageX-this.$seekBarContainer.offset().left)/this.$seekBarContainer.width()*100;return F=Math.min(100,Math.max(F,0)),this.container&&this.container.seekPercentage(F),this.setSeekPercentage(F),!1}}},{key:"setKeepVisible",value:function(){this.keepVisible=!0}},{key:"resetKeepVisible",value:function(){this.keepVisible=!1}},{key:"setUserKeepVisible",value:function(){this.userKeepVisible=!0}},{key:"resetUserKeepVisible",value:function(){this.userKeepVisible=!1}},{key:"isVisible",value:function(){return!this.$el.hasClass("media-control-hide")}},{key:"show",value:function(y){var F=this;if(!this.disabled){var re=y&&y.clientX!==this.lastMouseX&&y.clientY!==this.lastMouseY;(!y||re||navigator.userAgent.match(/firefox/i))&&(clearTimeout(this.hideId),this.$el.show(),this.trigger(Ae.MEDIACONTROL_SHOW,this.name),this.container&&this.container.trigger(Ae.CONTAINER_MEDIACONTROL_SHOW,this.name),this.$el.removeClass("media-control-hide"),this.hideId=setTimeout(function(){return F.hide()},2e3),y&&(this.lastMouseX=y.clientX,this.lastMouseY=y.clientY)),this.updateCursorStyle(!0)}}},{key:"hide",value:function(){var y=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this.isVisible()){var re=F||2e3;if(clearTimeout(this.hideId),this.disabled||this.options.hideMediaControl!==!1){var C=this.userKeepVisible||this.keepVisible,z=this.draggingSeekBar||this.draggingVolumeBar;if(!this.disabled&&(F||C||z))this.hideId=setTimeout(function(){return y.hide()},re);else{this.trigger(Ae.MEDIACONTROL_HIDE,this.name),this.container&&this.container.trigger(Ae.CONTAINER_MEDIACONTROL_HIDE,this.name),this.$el.addClass("media-control-hide"),this.hideVolumeBar(0);var G=!1;this.updateCursorStyle(G)}}}}},{key:"updateCursorStyle",value:function(y){y?this.core.$el.removeClass("nocursor"):this.core.isFullscreen()&&this.core.$el.addClass("nocursor")}},{key:"settingsUpdate",value:function(){var y=this.getSettings();!y||this.fullScreenOnVideoTagSupported||Ss.fullscreenEnabled()||(y.default&&ta(y.default,"fullscreen"),y.left&&ta(y.left,"fullscreen"),y.right&&ta(y.right,"fullscreen")),JSON.stringify(this.settings)!==JSON.stringify(y)&&(this.settings=y,this.render())}},{key:"getSettings",value:function(){return je.extend(!0,{},this.container&&this.container.settings)}},{key:"highDefinitionUpdate",value:function(y){this.isHD=y;var F=y?"addClass":"removeClass";this.$hdIndicator[F]("enabled")}},{key:"createCachedElements",value:function(){var y=this.$el.find(".media-control-layer");this.$duration=y.find(".media-control-indicator[data-duration]"),this.$fullscreenToggle=y.find("button.media-control-button[data-fullscreen]"),this.$playPauseToggle=y.find("button.media-control-button[data-playpause]"),this.$playStopToggle=y.find("button.media-control-button[data-playstop]"),this.$position=y.find(".media-control-indicator[data-position]"),this.$seekBarContainer=y.find(".bar-container[data-seekbar]"),this.$seekBarHover=y.find(".bar-hover[data-seekbar]"),this.$seekBarLoaded=y.find(".bar-fill-1[data-seekbar]"),this.$seekBarPosition=y.find(".bar-fill-2[data-seekbar]"),this.$seekBarScrubber=y.find(".bar-scrubber[data-seekbar]"),this.$volumeBarContainer=y.find(".bar-container[data-volume]"),this.$volumeContainer=y.find(".drawer-container[data-volume]"),this.$volumeIcon=y.find(".drawer-icon[data-volume]"),this.$volumeBarBackground=this.$el.find(".bar-background[data-volume]"),this.$volumeBarFill=this.$el.find(".bar-fill-1[data-volume]"),this.$volumeBarScrubber=this.$el.find(".bar-scrubber[data-volume]"),this.$hdIndicator=this.$el.find("button.media-control-button[data-hd-indicator]"),this.resetIndicators(),this.initializeIcons()}},{key:"resetIndicators",value:function(){this.displayedPosition=this.$position.text(),this.displayedDuration=this.$duration.text()}},{key:"initializeIcons",value:function(){var y=this.$el.find(".media-control-layer");y.find("button.media-control-button[data-play]").append(rs),y.find("button.media-control-button[data-pause]").append(cr),y.find("button.media-control-button[data-stop]").append(ka),this.$playPauseToggle.append(rs),this.$playStopToggle.append(rs),this.$volumeIcon.append(Ro),this.$fullscreenToggle.append(ea),this.$hdIndicator.append(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
  <path fill="#010101" d="M5.375 7.062H2.637V4.26H.502v7.488h2.135V8.9h2.738v2.848h2.133V4.26H5.375v2.802zm5.97-2.81h-2.84v7.496h2.798c2.65 0 4.195-1.607 4.195-3.77v-.022c0-2.162-1.523-3.704-4.154-3.704zm2.06 3.758c0 1.21-.81 1.896-2.03 1.896h-.83V6.093h.83c1.22 0 2.03.696 2.03 1.896v.02z"/>
</svg>`)}},{key:"setSeekPercentage",value:function(y){y=Math.max(Math.min(y,100),0),this.displayedSeekBarPercentage!==y&&(this.displayedSeekBarPercentage=y,this.$seekBarPosition.removeClass("media-control-notransition"),this.$seekBarScrubber.removeClass("media-control-notransition"),this.$seekBarPosition.css({width:"".concat(y,"%")}),this.$seekBarScrubber.css({left:"".concat(y,"%")}))}},{key:"seekRelative",value:function(y){if(this.settings.seekEnabled){var F=this.container.getCurrentTime(),re=this.container.getDuration(),C=Math.min(Math.max(F+y,0),re);C=Math.min(100*C/re,100),this.container.seekPercentage(C)}}},{key:"bindKeyAndShow",value:function(y,F){var re=this;this.kibo.down(y,function(){return re.show(),F()})}},{key:"bindKeyEvents",value:function(){var y=this;!_t.isMobile&&!this.options.disableKeyboardShortcuts&&(this.unbindKeyEvents(),this.kibo=new Tt(this.options.focusElement||this.options.parentElement),this.bindKeyAndShow("space",function(){return y.togglePlayPause()}),this.bindKeyAndShow("left",function(){return y.seekRelative(-5)}),this.bindKeyAndShow("right",function(){return y.seekRelative(5)}),this.bindKeyAndShow("shift left",function(){return y.seekRelative(-10)}),this.bindKeyAndShow("shift right",function(){return y.seekRelative(10)}),this.bindKeyAndShow("shift ctrl left",function(){return y.seekRelative(-15)}),this.bindKeyAndShow("shift ctrl right",function(){return y.seekRelative(15)}),["1","2","3","4","5","6","7","8","9","0"].forEach(function(F){y.bindKeyAndShow(F,function(){y.settings.seekEnabled&&y.container&&y.container.seekPercentage(10*F)})}))}},{key:"unbindKeyEvents",value:function(){this.kibo&&(this.kibo.off("space"),this.kibo.off("left"),this.kibo.off("right"),this.kibo.off("shift left"),this.kibo.off("shift right"),this.kibo.off("shift ctrl left"),this.kibo.off("shift ctrl right"),this.kibo.off(["1","2","3","4","5","6","7","8","9","0"]))}},{key:"parseColors",value:function(){if(this.options.mediacontrol){this.buttonsColor=this.options.mediacontrol.buttons;var y=this.options.mediacontrol.seekbar;this.$el.find(".bar-fill-2[data-seekbar]").css("background-color",y),this.$el.find(".media-control-icon svg path").css("fill",this.buttonsColor),this.$el.find(".segmented-bar-element[data-volume]").css("boxShadow","inset 2px 0 0 "+this.buttonsColor)}}},{key:"applyButtonStyle",value:function(y){this.buttonsColor&&y&&je(y).find("svg path").css("fill",this.buttonsColor)}},{key:"destroy",value:function(){je(document).unbind("mouseup",this.stopDragHandler),je(document).unbind("mousemove",this.updateDragHandler),this.unbindKeyEvents(),this.stopListening(),Js(an(j.prototype),"destroy",this).call(this)}},{key:"configure",value:function(y){this.options.chromeless||y.source||y.sources?this.disable():this.enable(),this.trigger(Ae.MEDIACONTROL_OPTIONS_CHANGE)}},{key:"render",value:function(){var y=this,F=this.options.hideMediaControlDelay||2e3;this.settings&&this.$el.html(this.template({settings:this.settings}));var re=vr.getStyleFor(`.media-control-notransition {
  transition: none !important; }

.media-control[data-media-control] {
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: 9999;
  pointer-events: none; }
  .media-control[data-media-control].dragging {
    pointer-events: auto;
    cursor: grabbing !important;
    cursor: url("closed-hand.cur"), move; }
    .media-control[data-media-control].dragging * {
      cursor: grabbing !important;
      cursor: url("closed-hand.cur"), move; }
  .media-control[data-media-control] .media-control-background[data-background] {
    position: absolute;
    height: 40%;
    width: 100%;
    bottom: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
    will-change: transform, opacity;
    transition: opacity 0.6s ease-out; }
  .media-control[data-media-control] .media-control-icon {
    line-height: 0;
    letter-spacing: 0;
    speak: none;
    color: #fff;
    opacity: 0.5;
    vertical-align: middle;
    text-align: left;
    transition: all 0.1s ease; }
  .media-control[data-media-control] .media-control-icon:hover {
    color: white;
    opacity: 0.75;
    text-shadow: rgba(255, 255, 255, 0.8) 0 0 5px; }
  .media-control[data-media-control].media-control-hide .media-control-background[data-background] {
    opacity: 0; }
  .media-control[data-media-control].media-control-hide .media-control-layer[data-controls] {
    transform: translateY(50px); }
    .media-control[data-media-control].media-control-hide .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-scrubber[data-seekbar] {
      opacity: 0; }
  .media-control[data-media-control] .media-control-layer[data-controls] {
    position: absolute;
    transform: translateY(-7px);
    bottom: 0;
    width: 100%;
    height: 32px;
    font-size: 0;
    vertical-align: middle;
    pointer-events: auto;
    transition: bottom 0.4s ease-out; }
    .media-control[data-media-control] .media-control-layer[data-controls] .media-control-left-panel[data-media-control] {
      position: absolute;
      top: 0;
      left: 4px;
      height: 100%; }
    .media-control[data-media-control] .media-control-layer[data-controls] .media-control-center-panel[data-media-control] {
      height: 100%;
      text-align: center;
      line-height: 32px; }
    .media-control[data-media-control] .media-control-layer[data-controls] .media-control-right-panel[data-media-control] {
      position: absolute;
      top: 0;
      right: 4px;
      height: 100%; }
    .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button {
      background-color: transparent;
      border: 0;
      margin: 0 6px;
      padding: 0;
      cursor: pointer;
      display: inline-block;
      width: 32px;
      height: 100%; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button svg {
        width: 100%;
        height: 22px; }
        .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button svg path {
          fill: white; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button:focus {
        outline: none; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-play] {
        float: left;
        height: 100%; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-pause] {
        float: left;
        height: 100%; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-stop] {
        float: left;
        height: 100%; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-fullscreen] {
        float: right;
        background-color: transparent;
        border: 0;
        height: 100%; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-hd-indicator] {
        background-color: transparent;
        border: 0;
        cursor: default;
        display: none;
        float: right;
        height: 100%; }
        .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-hd-indicator].enabled {
          display: block;
          opacity: 1.0; }
          .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-hd-indicator].enabled:hover {
            opacity: 1.0;
            text-shadow: none; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-playpause] {
        float: left; }
      .media-control[data-media-control] .media-control-layer[data-controls] button.media-control-button[data-playstop] {
        float: left; }
    .media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-position], .media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-duration] {
      display: inline-block;
      font-size: 10px;
      color: white;
      cursor: default;
      line-height: 32px;
      position: relative; }
    .media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-position] {
      margin: 0 6px 0 7px; }
    .media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-duration] {
      color: rgba(255, 255, 255, 0.5);
      margin-right: 6px; }
      .media-control[data-media-control] .media-control-layer[data-controls] .media-control-indicator[data-duration]:before {
        content: "|";
        margin-right: 7px; }
    .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] {
      position: absolute;
      top: -20px;
      left: 0;
      display: inline-block;
      vertical-align: middle;
      width: 100%;
      height: 25px;
      cursor: pointer; }
      .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] {
        width: 100%;
        height: 1px;
        position: relative;
        top: 12px;
        background-color: #666666; }
        .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-1[data-seekbar] {
          position: absolute;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          background-color: #c2c2c2;
          transition: all 0.1s ease-out; }
        .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-fill-2[data-seekbar] {
          position: absolute;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          background-color: #005aff;
          transition: all 0.1s ease-out; }
        .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-background[data-seekbar] .bar-hover[data-seekbar] {
          opacity: 0;
          position: absolute;
          top: -3px;
          width: 5px;
          height: 7px;
          background-color: rgba(255, 255, 255, 0.5);
          transition: opacity 0.1s ease; }
      .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar]:hover .bar-background[data-seekbar] .bar-hover[data-seekbar] {
        opacity: 1; }
      .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar].seek-disabled {
        cursor: default; }
        .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar].seek-disabled:hover .bar-background[data-seekbar] .bar-hover[data-seekbar] {
          opacity: 0; }
      .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-scrubber[data-seekbar] {
        position: absolute;
        transform: translateX(-50%);
        top: 2px;
        left: 0;
        width: 20px;
        height: 20px;
        opacity: 1;
        transition: all 0.1s ease-out; }
        .media-control[data-media-control] .media-control-layer[data-controls] .bar-container[data-seekbar] .bar-scrubber[data-seekbar] .bar-scrubber-icon[data-seekbar] {
          position: absolute;
          left: 6px;
          top: 6px;
          width: 8px;
          height: 8px;
          border-radius: 10px;
          box-shadow: 0 0 0 6px rgba(255, 255, 255, 0.2);
          background-color: white; }
    .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] {
      float: right;
      display: inline-block;
      height: 32px;
      cursor: pointer;
      margin: 0 6px;
      box-sizing: border-box; }
      .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] {
        float: left;
        bottom: 0; }
        .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume] {
          background-color: transparent;
          border: 0;
          box-sizing: content-box;
          width: 32px;
          height: 32px;
          opacity: 0.5; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume]:hover {
            opacity: 0.75; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume] svg {
            height: 24px;
            position: relative;
            top: 3px; }
            .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume] svg path {
              fill: white; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .drawer-icon-container[data-volume] .drawer-icon[data-volume].muted svg {
            margin-left: 2px; }
      .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] {
        float: left;
        position: relative;
        overflow: hidden;
        top: 6px;
        width: 42px;
        height: 18px;
        padding: 3px 0;
        transition: width .2s ease-out; }
        .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume] {
          height: 1px;
          position: relative;
          top: 7px;
          margin: 0 3px;
          background-color: #666666; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume] .bar-fill-1[data-volume] {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: #c2c2c2;
            transition: all 0.1s ease-out; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume] .bar-fill-2[data-volume] {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background-color: #005aff;
            transition: all 0.1s ease-out; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-background[data-volume] .bar-hover[data-volume] {
            opacity: 0;
            position: absolute;
            top: -3px;
            width: 5px;
            height: 7px;
            background-color: rgba(255, 255, 255, 0.5);
            transition: opacity 0.1s ease; }
        .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-scrubber[data-volume] {
          position: absolute;
          transform: translateX(-50%);
          top: 0px;
          left: 0;
          width: 20px;
          height: 20px;
          opacity: 1;
          transition: all 0.1s ease-out; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .bar-scrubber[data-volume] .bar-scrubber-icon[data-volume] {
            position: absolute;
            left: 6px;
            top: 6px;
            width: 8px;
            height: 8px;
            border-radius: 10px;
            box-shadow: 0 0 0 6px rgba(255, 255, 255, 0.2);
            background-color: white; }
        .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume] {
          float: left;
          width: 4px;
          padding-left: 2px;
          height: 12px;
          opacity: 0.5;
          box-shadow: inset 2px 0 0 white;
          transition: transform .2s ease-out; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume].fill {
            box-shadow: inset 2px 0 0 #fff;
            opacity: 1; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume]:nth-of-type(1) {
            padding-left: 0; }
          .media-control[data-media-control] .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume] .segmented-bar-element[data-volume]:hover {
            transform: scaleY(1.5); }
  .media-control[data-media-control].w320 .media-control-layer[data-controls] .drawer-container[data-volume] .bar-container[data-volume].volume-bar-hide {
    width: 0;
    height: 12px;
    top: 9px;
    padding: 0; }
`,{baseUrl:this.options.baseUrl});this.$el.append(re[0]),this.createCachedElements(),this.$playPauseToggle.addClass("paused"),this.$playStopToggle.addClass("stopped"),this.changeTogglePlay(),this.container&&(this.hideId=setTimeout(function(){return y.hide()},F),this.disabled&&this.hide()),_t.isSafari&&_t.isMobile&&(_t.version<10?this.$volumeContainer.css("display","none"):this.$volumeBarContainer.css("display","none")),this.$seekBarPosition.addClass("media-control-notransition"),this.$seekBarScrubber.addClass("media-control-notransition");var C=0;return this.displayedSeekBarPercentage&&(C=this.displayedSeekBarPercentage),this.displayedSeekBarPercentage=null,this.setSeekPercentage(C),setTimeout(function(){!y.settings.seekEnabled&&y.$seekBarContainer.addClass("seek-disabled"),!_t.isMobile&&!y.options.disableKeyboardShortcuts&&y.bindKeyEvents(),y.playerResize({width:y.options.width,height:y.options.height}),y.hideVolumeBar(0)},0),this.parseColors(),this.highDefinitionUpdate(this.isHD),this.core.$el.append(this.el),this.rendered=!0,this.updateVolumeUI(),this.trigger(Ae.MEDIACONTROL_RENDERED),this}}]),j}(Vi);Kn.extend=function(J){return wa(Kn,J)};for(var xu=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).hasStartedPlaying=!1,F.playRequested=!1,F.render(),setTimeout(function(){return F.update()},0),F}return ur(j,[{key:"name",get:function(){return"poster"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"template",get:function(){return mr(`<div class="play-wrapper" data-poster></div>
`)}},{key:"shouldRender",get:function(){var y=!(!this.options.poster||!this.options.poster.showForNoOp);return this.container.playback.name!=="html_img"&&(this.container.playback.getPlaybackType()!==qt.NO_OP||y)}},{key:"attributes",get:function(){return{class:"player-poster","data-poster":""}}},{key:"events",get:function(){return{click:"clicked"}}},{key:"showOnVideoEnd",get:function(){return!this.options.poster||this.options.poster.showOnVideoEnd||this.options.poster.showOnVideoEnd===void 0}},{key:"bindEvents",value:function(){this.listenTo(this.container,Ae.CONTAINER_STOP,this.onStop),this.listenTo(this.container,Ae.CONTAINER_PLAY,this.onPlay),this.listenTo(this.container,Ae.CONTAINER_STATE_BUFFERING,this.update),this.listenTo(this.container,Ae.CONTAINER_STATE_BUFFERFULL,this.update),this.listenTo(this.container,Ae.CONTAINER_OPTIONS_CHANGE,this.render),this.listenTo(this.container,Ae.CONTAINER_ERROR,this.onError),this.showOnVideoEnd&&this.listenTo(this.container,Ae.CONTAINER_ENDED,this.onStop)}},{key:"onError",value:function(y){this.hasFatalError=y.level===Kr.Levels.FATAL,this.hasFatalError&&(this.hasStartedPlaying=!1,this.playRequested=!1,this.showPlayButton())}},{key:"onPlay",value:function(){this.hasStartedPlaying=!0,this.update()}},{key:"onStop",value:function(){this.hasStartedPlaying=!1,this.playRequested=!1,this.update()}},{key:"updatePlayButton",value:function(y){!y||this.options.chromeless&&!this.options.allowUserInteraction?this.hidePlayButton():this.showPlayButton()}},{key:"showPlayButton",value:function(){this.hasFatalError&&!this.options.disableErrorScreen||(this.$playButton.show(),this.$el.addClass("clickable"))}},{key:"hidePlayButton",value:function(){this.$playButton.hide(),this.$el.removeClass("clickable")}},{key:"clicked",value:function(){if(!this.hasStartedPlaying)return this.options.chromeless&&!this.options.allowUserInteraction||(this.playRequested=!0,this.update(),this.container.playback&&(this.container.playback._consented=!0),this.container.play()),!1}},{key:"shouldHideOnPlay",value:function(){return!this.container.playback.isAudioOnly}},{key:"update",value:function(){if(this.shouldRender){var y=!this.playRequested&&!this.hasStartedPlaying&&!this.container.buffering;this.updatePlayButton(y),this.updatePoster()}}},{key:"updatePoster",value:function(){this.hasStartedPlaying?this.hidePoster():this.showPoster()}},{key:"showPoster",value:function(){this.container.disableMediaControl(),this.$el.show()}},{key:"hidePoster",value:function(){this.container.enableMediaControl(),this.shouldHideOnPlay()&&this.$el.hide()}},{key:"render",value:function(){if(this.shouldRender){var y=vr.getStyleFor(`.player-poster[data-poster] {
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  height: 100%;
  width: 100%;
  z-index: 998;
  top: 0;
  left: 0;
  background-color: transparent;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: 50% 50%; }
  .player-poster[data-poster].clickable {
    cursor: pointer; }
  .player-poster[data-poster]:hover .play-wrapper[data-poster] {
    opacity: 1; }
  .player-poster[data-poster] .play-wrapper[data-poster] {
    width: 100%;
    height: 25%;
    margin: 0 auto;
    opacity: 0.75;
    transition: opacity 0.1s ease; }
    .player-poster[data-poster] .play-wrapper[data-poster] svg {
      height: 100%; }
      .player-poster[data-poster] .play-wrapper[data-poster] svg path {
        fill: #fff; }
`,{baseUrl:this.options.baseUrl});if(this.$el.html(this.template()),this.$el.append(y[0]),this.options.poster&&this.options.poster.custom===void 0){var F=this.options.poster.url||this.options.poster;this.$el.css({"background-image":"url("+F+")"}),this.removeVideoElementPoster()}else this.options.poster&&(this.$el.css({background:this.options.poster.custom}),this.removeVideoElementPoster());this.container.$el.append(this.el),this.$playWrapper=this.$el.find(".play-wrapper"),this.$playWrapper.append(rs),this.$playButton=this.$playWrapper.find("svg"),this.$playButton.addClass("poster-icon"),this.$playButton.attr("data-poster","");var re=this.options.mediacontrol&&this.options.mediacontrol.buttons;return re&&this.$el.find("svg path").css("fill",re),this.options.mediacontrol&&this.options.mediacontrol.buttons&&(re=this.options.mediacontrol.buttons,this.$playButton.css("color",re)),this.update(),this}}},{key:"removeVideoElementPoster",value:function(){this.container.playback&&this.container.playback.$el&&this.container.playback.$el[0]&&this.container.playback.$el[0].removeAttribute&&this.container.playback.$el[0].removeAttribute("poster")}}]),j}(nn),ia=mn.formatTime,wi=function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).hoveringOverSeekBar=!1,F.hoverPosition=null,F.duration=null,F.firstFragDateTime=null,F.actualLiveTime=!!F.mediaControl.options.actualLiveTime,F.actualLiveTime&&(F.mediaControl.options.actualLiveServerTime?F.actualLiveServerTimeDiff=new Date().getTime()-new Date(F.mediaControl.options.actualLiveServerTime).getTime():F.actualLiveServerTimeDiff=0),F}return ur(j,[{key:"name",get:function(){return"seek_time"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"template",get:function(){return mr(`<span data-seek-time></span>
<span data-duration></span>
`)}},{key:"attributes",get:function(){return{class:"seek-time","data-seek-time":""}}},{key:"mediaControl",get:function(){return this.core.mediaControl}},{key:"mediaControlContainer",get:function(){return this.mediaControl.container}},{key:"isLiveStreamWithDvr",get:function(){return this.mediaControlContainer&&this.mediaControlContainer.getPlaybackType()===qt.LIVE&&this.mediaControlContainer.isDvrEnabled()}},{key:"durationShown",get:function(){return this.isLiveStreamWithDvr&&!this.actualLiveTime}},{key:"useActualLiveTime",get:function(){return this.actualLiveTime&&this.isLiveStreamWithDvr}},{key:"bindEvents",value:function(){this.listenTo(this.mediaControl,Ae.MEDIACONTROL_RENDERED,this.render),this.listenTo(this.mediaControl,Ae.MEDIACONTROL_MOUSEMOVE_SEEKBAR,this.showTime),this.listenTo(this.mediaControl,Ae.MEDIACONTROL_MOUSELEAVE_SEEKBAR,this.hideTime),this.listenTo(this.mediaControl,Ae.MEDIACONTROL_CONTAINERCHANGED,this.onContainerChanged),this.mediaControlContainer&&(this.listenTo(this.mediaControlContainer,Ae.CONTAINER_PLAYBACKDVRSTATECHANGED,this.update),this.listenTo(this.mediaControlContainer,Ae.CONTAINER_TIMEUPDATE,this.updateDuration))}},{key:"onContainerChanged",value:function(){this.stopListening(),this.bindEvents()}},{key:"updateDuration",value:function(y){this.duration=y.total,this.firstFragDateTime=y.firstFragDateTime,this.update()}},{key:"showTime",value:function(y){this.hoveringOverSeekBar=!0,this.calculateHoverPosition(y),this.update()}},{key:"hideTime",value:function(){this.hoveringOverSeekBar=!1,this.update()}},{key:"calculateHoverPosition",value:function(y){var F=y.pageX-this.mediaControl.$seekBarContainer.offset().left;this.hoverPosition=Math.min(1,Math.max(F/this.mediaControl.$seekBarContainer.width(),0))}},{key:"getSeekTime",value:function(){var y,F,re,C;return this.useActualLiveTime?(this.firstFragDateTime?(C=new Date(this.firstFragDateTime),(re=new Date(this.firstFragDateTime)).setHours(0,0,0,0),F=(C.getTime()-re.getTime())/1e3+this.duration):(re=new Date(new Date().getTime()-this.actualLiveServerTimeDiff),F=((C=new Date(re))-re.setHours(0,0,0,0))/1e3),(y=F-this.duration+this.hoverPosition*this.duration)<0&&(y+=86400)):y=this.hoverPosition*this.duration,{seekTime:y,secondsSinceMidnight:F}}},{key:"update",value:function(){if(this.rendered)if(this.shouldBeVisible()){var y=this.getSeekTime(),F=ia(y.seekTime,this.useActualLiveTime);if(F!==this.displayedSeekTime&&(this.$seekTimeEl.text(F),this.displayedSeekTime=F),this.durationShown){this.$durationEl.show();var re=ia(this.actualLiveTime?y.secondsSinceMidnight:this.duration,this.actualLiveTime);re!==this.displayedDuration&&(this.$durationEl.text(re),this.displayedDuration=re)}else this.$durationEl.hide();this.$el.show();var C=this.mediaControl.$seekBarContainer.width(),z=this.$el.width(),G=this.hoverPosition*C;G-=z/2,G=Math.max(0,Math.min(G,C-z)),this.$el.css("left",G)}else this.$el.hide(),this.$el.css("left","-100%")}},{key:"shouldBeVisible",value:function(){return this.mediaControlContainer&&this.mediaControlContainer.settings.seekEnabled&&this.hoveringOverSeekBar&&this.hoverPosition!==null&&this.duration!==null}},{key:"render",value:function(){var y=vr.getStyleFor(`.seek-time[data-seek-time] {
  position: absolute;
  white-space: nowrap;
  height: 20px;
  line-height: 20px;
  font-size: 0;
  left: -100%;
  bottom: 55px;
  background-color: rgba(2, 2, 2, 0.5);
  z-index: 9999;
  transition: opacity 0.1s ease; }
  .seek-time[data-seek-time].hidden[data-seek-time] {
    opacity: 0; }
  .seek-time[data-seek-time] [data-seek-time] {
    display: inline-block;
    color: white;
    font-size: 10px;
    padding-left: 7px;
    padding-right: 7px;
    vertical-align: top; }
  .seek-time[data-seek-time] [data-duration] {
    display: inline-block;
    color: rgba(255, 255, 255, 0.5);
    font-size: 10px;
    padding-right: 7px;
    vertical-align: top; }
    .seek-time[data-seek-time] [data-duration]:before {
      content: "|";
      margin-right: 7px; }
`,{baseUrl:this.options.baseUrl});this.rendered=!0,this.displayedDuration=null,this.displayedSeekTime=null,this.$el.html(this.template()),this.$el.append(y[0]),this.$el.hide(),this.mediaControl.$el.append(this.el),this.$seekTimeEl=this.$el.find("[data-seek-time]"),this.$durationEl=this.$el.find("[data-duration]"),this.$durationEl.hide(),this.update()}}]),j}(Vi),Ji={ClickToPause:bl,ClosedCaptions:Zs,DVRControls:jn,EndVideo:Su,ErrorScreen:oo,Favicon:Ri,GoogleAnalytics:Al,MediaControl:Kn,Poster:xu,SeekTime:wi,SpinnerThreeBounce:function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).template=mr(`<div data-bounce1></div><div data-bounce2></div><div data-bounce3></div>
`),F.showTimeout=null,F.listenTo(F.container,Ae.CONTAINER_STATE_BUFFERING,F.onBuffering),F.listenTo(F.container,Ae.CONTAINER_STATE_BUFFERFULL,F.onBufferFull),F.listenTo(F.container,Ae.CONTAINER_STOP,F.onStop),F.listenTo(F.container,Ae.CONTAINER_ENDED,F.onStop),F.listenTo(F.container,Ae.CONTAINER_ERROR,F.onStop),F.render(),F}return ur(j,[{key:"name",get:function(){return"spinner"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"attributes",get:function(){return{"data-spinner":"",class:"spinner-three-bounce"}}},{key:"onBuffering",value:function(){this.show()}},{key:"onBufferFull",value:function(){this.hide()}},{key:"onStop",value:function(){this.hide()}},{key:"show",value:function(){var y=this;this.showTimeout===null&&(this.showTimeout=setTimeout(function(){return y.$el.show()},300))}},{key:"hide",value:function(){this.showTimeout!==null&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.$el.hide()}},{key:"render",value:function(){var y=vr.getStyleFor(`.spinner-three-bounce[data-spinner] {
  position: absolute;
  margin: 0 auto;
  width: 70px;
  text-align: center;
  z-index: 999;
  left: 0;
  right: 0;
  margin-left: auto;
  margin-right: auto;
  /* center vertically */
  top: 50%;
  transform: translateY(-50%); }
  .spinner-three-bounce[data-spinner] > div {
    width: 18px;
    height: 18px;
    background-color: #FFFFFF;
    border-radius: 100%;
    display: inline-block;
    animation: bouncedelay 1.4s infinite ease-in-out;
    /* Prevent first frame from flickering when animation starts */
    animation-fill-mode: both; }
  .spinner-three-bounce[data-spinner] [data-bounce1] {
    animation-delay: -0.32s; }
  .spinner-three-bounce[data-spinner] [data-bounce2] {
    animation-delay: -0.16s; }

@keyframes bouncedelay {
  0%, 80%, 100% {
    transform: scale(0); }
  40% {
    transform: scale(1); } }
`,{baseUrl:this.options.baseUrl});return this.$el.html(this.template()),this.$el.append(y[0]),this.container.$el.append(this.$el),this.$el.hide(),this.container.buffering&&this.onBuffering(),this}}]),j}(nn),Stats:function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).setInitialAttrs(),F.reportInterval=F.options.reportInterval||5e3,F.state="IDLE",F}return ur(j,[{key:"name",get:function(){return"stats"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"bindEvents",value:function(){this.listenTo(this.container.playback,Ae.PLAYBACK_PLAY,this.onPlay),this.listenTo(this.container,Ae.CONTAINER_STOP,this.onStop),this.listenTo(this.container,Ae.CONTAINER_ENDED,this.onStop),this.listenTo(this.container,Ae.CONTAINER_DESTROYED,this.onStop),this.listenTo(this.container,Ae.CONTAINER_STATE_BUFFERING,this.onBuffering),this.listenTo(this.container,Ae.CONTAINER_STATE_BUFFERFULL,this.onBufferFull),this.listenTo(this.container,Ae.CONTAINER_STATS_ADD,this.onStatsAdd),this.listenTo(this.container,Ae.CONTAINER_BITRATE,this.onStatsAdd),this.listenTo(this.container.playback,Ae.PLAYBACK_STATS_ADD,this.onStatsAdd)}},{key:"setInitialAttrs",value:function(){this.firstPlay=!0,this.startupTime=0,this.rebufferingTime=0,this.watchingTime=0,this.rebuffers=0,this.externalMetrics={}}},{key:"onPlay",value:function(){this.state="PLAYING",this.watchingTimeInit=Date.now(),this.intervalId||(this.intervalId=setInterval(this.report.bind(this),this.reportInterval))}},{key:"onStop",value:function(){clearInterval(this.intervalId),this.report(),this.intervalId=void 0,this.state="STOPPED"}},{key:"onBuffering",value:function(){this.firstPlay?this.startupTimeInit=Date.now():this.rebufferingTimeInit=Date.now(),this.state="BUFFERING",this.rebuffers++}},{key:"onBufferFull",value:function(){this.firstPlay&&this.startupTimeInit?(this.firstPlay=!1,this.startupTime=Date.now()-this.startupTimeInit,this.watchingTimeInit=Date.now()):this.rebufferingTimeInit&&(this.rebufferingTime+=this.getRebufferingTime()),this.rebufferingTimeInit=void 0,this.state="PLAYING"}},{key:"getRebufferingTime",value:function(){return Date.now()-this.rebufferingTimeInit}},{key:"getWatchingTime",value:function(){return Date.now()-this.watchingTimeInit-this.rebufferingTime}},{key:"isRebuffering",value:function(){return!!this.rebufferingTimeInit}},{key:"onStatsAdd",value:function(y){je.extend(this.externalMetrics,y)}},{key:"getStats",value:function(){var y={startupTime:this.startupTime,rebuffers:this.rebuffers,rebufferingTime:this.isRebuffering()?this.rebufferingTime+this.getRebufferingTime():this.rebufferingTime,watchingTime:this.isRebuffering()?this.getWatchingTime()-this.getRebufferingTime():this.getWatchingTime()};return je.extend(y,this.externalMetrics),y}},{key:"report",value:function(){this.container.statsReport(this.getStats())}}]),j}(Mt),WaterMark:function(J){_i(j,J);var ee=Sr(j);function j(y){var F;return Ei(this,j),(F=ee.call(this,y)).configure(),F}return ur(j,[{key:"name",get:function(){return"watermark"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"template",get:function(){return mr(`<div class="clappr-watermark" data-watermark data-watermark-<%=position %>>
<% if(typeof imageLink !== 'undefined') { %>
<a target="_blank" href="<%= imageLink %>">
<% } %>
<img src="<%= imageUrl %>">
<% if(typeof imageLink !== 'undefined') { %>
</a>
<% } %>
</div>
`)}},{key:"bindEvents",value:function(){this.listenTo(this.container,Ae.CONTAINER_PLAY,this.onPlay),this.listenTo(this.container,Ae.CONTAINER_STOP,this.onStop),this.listenTo(this.container,Ae.CONTAINER_OPTIONS_CHANGE,this.configure)}},{key:"configure",value:function(){this.position=this.options.position||"bottom-right",this.options.watermark?(this.imageUrl=this.options.watermark,this.imageLink=this.options.watermarkLink,this.render()):this.$el.remove()}},{key:"onPlay",value:function(){this.hidden||this.$el.show()}},{key:"onStop",value:function(){this.$el.hide()}},{key:"render",value:function(){this.$el.hide();var y=vr.getStyleFor(`.clappr-watermark[data-watermark] {
  position: absolute;
  min-width: 70px;
  max-width: 200px;
  width: 12%;
  text-align: center;
  z-index: 10; }

.clappr-watermark[data-watermark] a {
  outline: none;
  cursor: pointer; }

.clappr-watermark[data-watermark] img {
  max-width: 100%; }

.clappr-watermark[data-watermark-bottom-left] {
  bottom: 10px;
  left: 10px; }

.clappr-watermark[data-watermark-bottom-right] {
  bottom: 10px;
  right: 42px; }

.clappr-watermark[data-watermark-top-left] {
  top: 10px;
  left: 10px; }

.clappr-watermark[data-watermark-top-right] {
  top: 10px;
  right: 37px; }
`,{baseUrl:this.options.baseUrl}),F={position:this.position,imageUrl:this.imageUrl,imageLink:this.imageLink};return this.$el.html(this.template(F)),this.$el.append(y[0]),this.container.$el.append(this.$el),this}}]),j}(nn)},Wr=0,La=Object.values(Ji);Wr<La.length;Wr++){var jc=La[Wr];Rn.registerPlugin(jc)}var Cu=Ji.ClickToPause,Sl=Ji.ClosedCaptions,xs=Ji.DVRControls,Cs=Ji.EndVideo,ks=Ji.ErrorScreen,Po=Ji.Favicon,xl=Ji.GoogleAnalytics,Oo=Ji.MediaControl,Cl=Ji.Poster,Mo=Ji.SeekTime,kl=Ji.SpinnerThreeBounce,Jt=Ji.Stats,Nt=Ji.WaterMark,No=or(or({},Pn),{},{ClickToPause:Cu,ClosedCaptions:Sl,DVRControls:xs,EndVideo:Cs,ErrorScreen:ks,Favicon:Po,GoogleAnalytics:xl,MediaControl:Oo,Poster:Cl,SeekTime:Mo,SpinnerThreeBounce:kl,Stats:Jt,WaterMark:Nt,Vendor:lt,Plugins:Ji,version:"0.5.0"});function lo(J,ee){var j=Object.keys(J);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(J);ee&&(y=y.filter(function(F){return Object.getOwnPropertyDescriptor(J,F).enumerable})),j.push.apply(j,y)}return j}function Ia(J){for(var ee=1;ee<arguments.length;ee++){var j=arguments[ee]!=null?arguments[ee]:{};ee%2?lo(Object(j),!0).forEach(function(y){Ds(J,y,j[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(j)):lo(Object(j)).forEach(function(y){Object.defineProperty(J,y,Object.getOwnPropertyDescriptor(j,y))})}return J}function uo(J,ee){if(!(J instanceof ee))throw new TypeError("Cannot call a class as a function")}function Ra(J,ee){for(var j=0;j<ee.length;j++){var y=ee[j];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(J,na(y.key),y)}}function Ds(J,ee,j){return(ee=na(ee))in J?Object.defineProperty(J,ee,{value:j,enumerable:!0,configurable:!0,writable:!0}):J[ee]=j,J}function Or(J){return Or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(ee){return ee.__proto__||Object.getPrototypeOf(ee)},Or(J)}function ra(J,ee){return ra=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(j,y){return j.__proto__=y,j},ra(J,ee)}function ku(J,ee){if(ee&&(typeof ee=="object"||typeof ee=="function"))return ee;if(ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(j){if(j===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j}(J)}function ns(J){var ee=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var j,y=Or(J);if(ee){var F=Or(this).constructor;j=Reflect.construct(y,arguments,F)}else j=y.apply(this,arguments);return ku(this,j)}}function vn(J,ee){for(;!Object.prototype.hasOwnProperty.call(J,ee)&&(J=Or(J))!==null;);return J}function On(){return On=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(J,ee,j){var y=vn(J,ee);if(y){var F=Object.getOwnPropertyDescriptor(y,ee);return F.get?F.get.call(arguments.length<3?J:j):F.value}},On.apply(this,arguments)}function ws(J){return function(ee){if(Array.isArray(ee))return xr(ee)}(J)||function(ee){if(typeof Symbol<"u"&&ee[Symbol.iterator]!=null||ee["@@iterator"]!=null)return Array.from(ee)}(J)||function(ee,j){if(ee){if(typeof ee=="string")return xr(ee,j);var y=Object.prototype.toString.call(ee).slice(8,-1);if(y==="Object"&&ee.constructor&&(y=ee.constructor.name),y==="Map"||y==="Set")return Array.from(ee);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return xr(ee,j)}}(J)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function xr(J,ee){(ee==null||ee>J.length)&&(ee=J.length);for(var j=0,y=new Array(ee);j<ee;j++)y[j]=J[j];return y}function na(J){var ee=function(j,y){if(typeof j!="object"||j===null)return j;var F=j[Symbol.toPrimitive];if(F!==void 0){var re=F.call(j,y||"default");if(typeof re!="object")return re;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(j)}(J,"string");return typeof ee=="symbol"?ee:String(ee)}typeof globalThis<"u"||typeof window<"u"||(typeof global<"u"?global:typeof self<"u");function Hi(J){return J&&J.__esModule&&Object.prototype.hasOwnProperty.call(J,"default")?J.default:J}var Dl,wl,Ll={exports:{}};Dl=Ll,typeof window<"u"&&(wl=()=>(()=>{var J={"./src/config.ts":(F,re,C)=>{C.r(re),C.d(re,{enableStreamingMode:()=>K,hlsDefaultConfig:()=>D,mergeConfig:()=>O});var z=C("./src/controller/abr-controller.ts"),G=C("./src/controller/audio-stream-controller.ts"),de=C("./src/controller/audio-track-controller.ts"),te=C("./src/controller/subtitle-stream-controller.ts"),le=C("./src/controller/subtitle-track-controller.ts"),Q=C("./src/controller/buffer-controller.ts"),X=C("./src/controller/timeline-controller.ts"),ie=C("./src/controller/cap-level-controller.ts"),W=C("./src/controller/fps-controller.ts"),se=C("./src/controller/eme-controller.ts"),Y=C("./src/controller/cmcd-controller.ts"),V=C("./src/utils/xhr-loader.ts"),M=C("./src/utils/fetch-loader.ts"),b=C("./src/utils/cues.ts"),I=C("./src/utils/mediakeys-helper.ts"),w=C("./src/utils/logger.ts");function P(){return P=Object.assign?Object.assign.bind():function(k){for(var L=1;L<arguments.length;L++){var R=arguments[L];for(var Z in R)Object.prototype.hasOwnProperty.call(R,Z)&&(k[Z]=R[Z])}return k},P.apply(this,arguments)}function _(k,L){var R=Object.keys(k);if(Object.getOwnPropertySymbols){var Z=Object.getOwnPropertySymbols(k);L&&(Z=Z.filter(function(ae){return Object.getOwnPropertyDescriptor(k,ae).enumerable})),R.push.apply(R,Z)}return R}function v(k){for(var L=1;L<arguments.length;L++){var R=arguments[L]!=null?arguments[L]:{};L%2?_(Object(R),!0).forEach(function(Z){A(k,Z,R[Z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(R)):_(Object(R)).forEach(function(Z){Object.defineProperty(k,Z,Object.getOwnPropertyDescriptor(R,Z))})}return k}function A(k,L,R){return L in k?Object.defineProperty(k,L,{value:R,enumerable:!0,configurable:!0,writable:!0}):k[L]=R,k}var D=v(v({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:V.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:z.default,bufferController:Q.default,capLevelController:ie.default,fpsController:W.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:I.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:b.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:te.SubtitleStreamController,subtitleTrackController:le.default,timelineController:X.TimelineController,audioStreamController:G.default,audioTrackController:de.default,emeController:se.default,cmcdController:Y.default});function O(k,L){if((L.liveSyncDurationCount||L.liveMaxLatencyDurationCount)&&(L.liveSyncDuration||L.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(L.liveMaxLatencyDurationCount!==void 0&&(L.liveSyncDurationCount===void 0||L.liveMaxLatencyDurationCount<=L.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(L.liveMaxLatencyDuration!==void 0&&(L.liveSyncDuration===void 0||L.liveMaxLatencyDuration<=L.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return P({},k,L)}function K(k){var L=k.loader;L!==M.default&&L!==V.default?(w.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),k.progressive=!1):(0,M.fetchSupported)()&&(k.loader=M.default,k.progressive=!0,k.enableSoftwareAES=!0,w.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>W});var z=C("./src/polyfills/number.ts"),G=C("./src/utils/ewma-bandwidth-estimator.ts"),de=C("./src/events.ts"),te=C("./src/errors.ts"),le=C("./src/types/loader.ts"),Q=C("./src/utils/logger.ts");function X(se,Y){for(var V=0;V<Y.length;V++){var M=Y[V];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(se,M.key,M)}}var ie=function(){function se(I){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=I;var w=I.config;this.bwEstimator=new G.default(w.abrEwmaSlowVoD,w.abrEwmaFastVoD,w.abrEwmaDefaultEstimate),this.registerListeners()}var Y,V,M,b=se.prototype;return b.registerListeners=function(){var I=this.hls;I.on(de.Events.FRAG_LOADING,this.onFragLoading,this),I.on(de.Events.FRAG_LOADED,this.onFragLoaded,this),I.on(de.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.on(de.Events.LEVEL_LOADED,this.onLevelLoaded,this),I.on(de.Events.ERROR,this.onError,this)},b.unregisterListeners=function(){var I=this.hls;I.off(de.Events.FRAG_LOADING,this.onFragLoading,this),I.off(de.Events.FRAG_LOADED,this.onFragLoaded,this),I.off(de.Events.FRAG_BUFFERED,this.onFragBuffered,this),I.off(de.Events.LEVEL_LOADED,this.onLevelLoaded,this),I.off(de.Events.ERROR,this.onError,this)},b.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},b.onFragLoading=function(I,w){var P,_=w.frag;_.type===le.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=_,this.partCurrent=(P=w.part)!=null?P:null,this.timer=self.setInterval(this.onCheck,100)))},b.onLevelLoaded=function(I,w){var P=this.hls.config;w.details.live?this.bwEstimator.update(P.abrEwmaSlowLive,P.abrEwmaFastLive):this.bwEstimator.update(P.abrEwmaSlowVoD,P.abrEwmaFastVoD)},b._abandonRulesCheck=function(){var I=this.fragCurrent,w=this.partCurrent,P=this.hls,_=P.autoLevelEnabled;P.config;var v=P.media;if(I&&v){var A=w?w.stats:I.stats,D=w?w.duration:I.duration;if(A.aborted||A.loaded&&A.loaded===A.total||I.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(_&&!v.paused&&v.playbackRate&&v.readyState){var O=P.mainForwardBufferInfo;if(O!==null){var K=performance.now()-A.loading.start,k=Math.abs(v.playbackRate);if(!(K<=500*D/k)){var L=A.loaded&&A.loading.first,R=this.bwEstimator.getEstimate(),Z=P.levels,ae=P.minAutoLevel,fe=Z[I.level],ce=A.total||Math.max(A.loaded,Math.round(D*fe.maxBitrate/8)),me=L?1e3*A.loaded/K:0,Ee=me?(ce-A.loaded)/me:8*ce/R,be=O.len/k;if(!(Ee<=be)){var Re,Ce=Number.POSITIVE_INFINITY;for(Re=I.level-1;Re>ae;Re--){var Ne=Z[Re].maxBitrate;if((Ce=me?D*Ne/(6.4*me):D*Ne/R)<be)break}Ce>=Ee||(Q.logger.warn("Fragment "+I.sn+(w?" part "+w.index:"")+" of level "+I.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+Re+`
      Current BW estimate: `+((0,z.isFiniteNumber)(R)?(R/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+Ee.toFixed(3)+` s
      Estimated load time for the next fragment: `+Ce.toFixed(3)+` s
      Time to underbuffer: `+be.toFixed(3)+" s"),P.nextLoadLevel=Re,L&&this.bwEstimator.sample(K,A.loaded),this.clearTimer(),I.loader&&(this.fragCurrent=this.partCurrent=null,I.loader.abort()),P.trigger(de.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:I,part:w,stats:A}))}}}}}},b.onFragLoaded=function(I,w){var P=w.frag,_=w.part;if(P.type===le.PlaylistLevelType.MAIN&&(0,z.isFiniteNumber)(P.sn)){var v=_?_.stats:P.stats,A=_?_.duration:P.duration;if(this.clearTimer(),this.lastLoadedFragLevel=P.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var D=this.hls.levels[P.level],O=(D.loaded?D.loaded.bytes:0)+v.loaded,K=(D.loaded?D.loaded.duration:0)+A;D.loaded={bytes:O,duration:K},D.realBitrate=Math.round(8*O/K)}if(P.bitrateTest){var k={stats:v,frag:P,part:_,id:P.type};this.onFragBuffered(de.Events.FRAG_BUFFERED,k)}}},b.onFragBuffered=function(I,w){var P=w.frag,_=w.part,v=_?_.stats:P.stats;if(!v.aborted&&P.type===le.PlaylistLevelType.MAIN&&P.sn!=="initSegment"){var A=v.parsing.end-v.loading.start;this.bwEstimator.sample(A,v.loaded),v.bwEstimate=this.bwEstimator.getEstimate(),P.bitrateTest?this.bitrateTestDelay=A/1e3:this.bitrateTestDelay=0}},b.onError=function(I,w){switch(w.details){case te.ErrorDetails.FRAG_LOAD_ERROR:case te.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},b.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},b.getNextABRAutoLevel=function(){var I=this.fragCurrent,w=this.partCurrent,P=this.hls,_=P.maxAutoLevel,v=P.config,A=P.minAutoLevel,D=P.media,O=w?w.duration:I?I.duration:0;D&&D.currentTime;var K=D&&D.playbackRate!==0?Math.abs(D.playbackRate):1,k=this.bwEstimator?this.bwEstimator.getEstimate():v.abrEwmaDefaultEstimate,L=P.mainForwardBufferInfo,R=(L?L.len:0)/K,Z=this.findBestLevel(k,A,_,R,v.abrBandWidthFactor,v.abrBandWidthUpFactor);if(Z>=0)return Z;Q.logger.trace((R?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var ae=O?Math.min(O,v.maxStarvationDelay):v.maxStarvationDelay,fe=v.abrBandWidthFactor,ce=v.abrBandWidthUpFactor;if(!R){var me=this.bitrateTestDelay;me&&(ae=(O?Math.min(O,v.maxLoadingDelay):v.maxLoadingDelay)-me,Q.logger.trace("bitrate test took "+Math.round(1e3*me)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*ae)+" ms"),fe=ce=1)}return Z=this.findBestLevel(k,A,_,R+ae,fe,ce),Math.max(Z,0)},b.findBestLevel=function(I,w,P,_,v,A){for(var D,O=this.fragCurrent,K=this.partCurrent,k=this.lastLoadedFragLevel,L=this.hls.levels,R=L[k],Z=!(R==null||(D=R.details)===null||D===void 0||!D.live),ae=R?.codecSet,fe=K?K.duration:O?O.duration:0,ce=P;ce>=w;ce--){var me=L[ce];if(me&&(!ae||me.codecSet===ae)){var Ee=me.details,be=(K?Ee?.partTarget:Ee?.averagetargetduration)||fe,Re=void 0;Re=ce<=k?v*I:A*I;var Ce=L[ce].maxBitrate,Ne=Ce*be/Re;if(Q.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+ce+"/"+Math.round(Re)+"/"+Ce+"/"+be+"/"+_+"/"+Ne),Re>Ce&&(Ne===0||!(0,z.isFiniteNumber)(Ne)||Z&&!this.bitrateTestDelay||Ne<_))return ce}}return-1},Y=se,(V=[{key:"nextAutoLevel",get:function(){var I=this._nextAutoLevel,w=this.bwEstimator;if(I!==-1&&!w.canEstimate())return I;var P=this.getNextABRAutoLevel();return I!==-1&&this.hls.levels[P].loadError?I:(I!==-1&&(P=Math.min(I,P)),P)},set:function(I){this._nextAutoLevel=I}}])&&X(Y.prototype,V),M&&X(Y,M),Object.defineProperty(Y,"prototype",{writable:!1}),se}();const W=ie},"./src/controller/audio-stream-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>_});var z=C("./src/polyfills/number.ts"),G=C("./src/controller/base-stream-controller.ts"),de=C("./src/events.ts"),te=C("./src/utils/buffer-helper.ts"),le=C("./src/controller/fragment-tracker.ts"),Q=C("./src/types/level.ts"),X=C("./src/types/loader.ts"),ie=C("./src/loader/fragment.ts"),W=C("./src/demux/chunk-cache.ts"),se=C("./src/demux/transmuxer-interface.ts"),Y=C("./src/types/transmuxer.ts"),V=C("./src/controller/fragment-finders.ts"),M=C("./src/utils/discontinuities.ts"),b=C("./src/errors.ts");function I(){return I=Object.assign?Object.assign.bind():function(v){for(var A=1;A<arguments.length;A++){var D=arguments[A];for(var O in D)Object.prototype.hasOwnProperty.call(D,O)&&(v[O]=D[O])}return v},I.apply(this,arguments)}function w(v,A){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,O){return D.__proto__=O,D},w(v,A)}var P=function(v){var A,D;function O(k,L){var R;return(R=v.call(this,k,L,"[audio-stream-controller]")||this).videoBuffer=null,R.videoTrackCC=-1,R.waitingVideoCC=-1,R.audioSwitch=!1,R.trackId=-1,R.waitingData=null,R.mainDetails=null,R.bufferFlushed=!1,R.cachedTrackLoadedData=null,R._registerListeners(),R}D=v,(A=O).prototype=Object.create(D.prototype),A.prototype.constructor=A,w(A,D);var K=O.prototype;return K.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},K._registerListeners=function(){var k=this.hls;k.on(de.Events.MEDIA_ATTACHED,this.onMediaAttached,this),k.on(de.Events.MEDIA_DETACHING,this.onMediaDetaching,this),k.on(de.Events.MANIFEST_LOADING,this.onManifestLoading,this),k.on(de.Events.LEVEL_LOADED,this.onLevelLoaded,this),k.on(de.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),k.on(de.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),k.on(de.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),k.on(de.Events.ERROR,this.onError,this),k.on(de.Events.BUFFER_RESET,this.onBufferReset,this),k.on(de.Events.BUFFER_CREATED,this.onBufferCreated,this),k.on(de.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),k.on(de.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),k.on(de.Events.FRAG_BUFFERED,this.onFragBuffered,this)},K._unregisterListeners=function(){var k=this.hls;k.off(de.Events.MEDIA_ATTACHED,this.onMediaAttached,this),k.off(de.Events.MEDIA_DETACHING,this.onMediaDetaching,this),k.off(de.Events.MANIFEST_LOADING,this.onManifestLoading,this),k.off(de.Events.LEVEL_LOADED,this.onLevelLoaded,this),k.off(de.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),k.off(de.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),k.off(de.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),k.off(de.Events.ERROR,this.onError,this),k.off(de.Events.BUFFER_RESET,this.onBufferReset,this),k.off(de.Events.BUFFER_CREATED,this.onBufferCreated,this),k.off(de.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),k.off(de.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),k.off(de.Events.FRAG_BUFFERED,this.onFragBuffered,this)},K.onInitPtsFound=function(k,L){var R=L.frag,Z=L.id,ae=L.initPTS;if(Z==="main"){var fe=R.cc;this.initPTS[R.cc]=ae,this.log("InitPTS for cc: "+fe+" found from main: "+ae),this.videoTrackCC=fe,this.state===G.State.WAITING_INIT_PTS&&this.tick()}},K.startLoad=function(k){if(!this.levels)return this.startPosition=k,void(this.state=G.State.STOPPED);var L=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,L>0&&k===-1?(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),k=L,this.state=G.State.IDLE):(this.loadedmetadata=!1,this.state=G.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=k,this.tick()},K.doTick=function(){switch(this.state){case G.State.IDLE:this.doTickIdle();break;case G.State.WAITING_TRACK:var k,L=this.levels,R=this.trackId,Z=L==null||(k=L[R])===null||k===void 0?void 0:k.details;if(Z){if(this.waitForCdnTuneIn(Z))break;this.state=G.State.WAITING_INIT_PTS}break;case G.State.FRAG_LOADING_WAITING_RETRY:var ae,fe=performance.now(),ce=this.retryDate;(!ce||fe>=ce||(ae=this.media)!==null&&ae!==void 0&&ae.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=G.State.IDLE);break;case G.State.WAITING_INIT_PTS:var me=this.waitingData;if(me){var Ee=me.frag,be=me.part,Re=me.cache,Ce=me.complete;if(this.initPTS[Ee.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=G.State.FRAG_LOADING;var Ne={frag:Ee,part:be,payload:Re.flush(),networkDetails:null};this._handleFragmentLoadProgress(Ne),Ce&&v.prototype._handleFragmentLoadComplete.call(this,Ne)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+Ee.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Ue=this.getLoadPosition(),Xe=te.BufferHelper.bufferInfo(this.mediaBuffer,Ue,this.config.maxBufferHole);(0,V.fragmentWithinToleranceTest)(Xe.end,this.config.maxFragLookUpTolerance,Ee)<0&&(this.log("Waiting fragment cc ("+Ee.cc+") @ "+Ee.start+" cancelled because another fragment at "+Xe.end+" is needed"),this.clearWaitingFragment())}}else this.state=G.State.IDLE}this.onTickEnd()},K.clearWaitingFragment=function(){var k=this.waitingData;k&&(this.fragmentTracker.removeFragment(k.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=G.State.IDLE)},K.resetLoadingState=function(){this.clearWaitingFragment(),v.prototype.resetLoadingState.call(this)},K.onTickEnd=function(){var k=this.media;k&&k.readyState&&(this.lastCurrentTime=k.currentTime)},K.doTickIdle=function(){var k,L,R=this.hls,Z=this.levels,ae=this.media,fe=this.trackId,ce=R.config;if(Z&&Z[fe]&&(ae||!this.startFragRequested&&ce.startFragPrefetch)){var me=Z[fe].details;if(!me||me.live&&this.levelLastLoaded!==fe||this.waitForCdnTuneIn(me))this.state=G.State.WAITING_TRACK;else{var Ee=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&Ee&&(this.bufferFlushed=!1,this.afterBufferFlushed(Ee,ie.ElementaryStreamTypes.AUDIO,X.PlaylistLevelType.AUDIO));var be=this.getFwdBufferInfo(Ee,X.PlaylistLevelType.AUDIO);if(be!==null){var Re=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,X.PlaylistLevelType.MAIN),Ce=be.len,Ne=this.getMaxBufferLength(Re?.len),Ue=this.audioSwitch;if(!(Ce>=Ne)||Ue){if(!Ue&&this._streamEnded(be,me))return R.trigger(de.Events.BUFFER_EOS,{type:"audio"}),void(this.state=G.State.ENDED);var Xe=me.fragments[0].start,ut=be.end;if(Ue&&ae){var gt=this.getLoadPosition();ut=gt,me.PTSKnown&&gt<Xe&&(be.end>Xe||be.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),ae.currentTime=Xe+.05)}if(!(Re&&ut>Re.end+me.targetduration)&&(Re&&Re.len||!be.len)){var ft=this.getNextFragment(ut,me);ft?((k=ft.decryptdata)===null||k===void 0?void 0:k.keyFormat)!=="identity"||(L=ft.decryptdata)!==null&&L!==void 0&&L.key?this.loadFragment(ft,me,ut):this.loadKey(ft,me):this.bufferFlushed=!0}}}}}},K.getMaxBufferLength=function(k){var L=v.prototype.getMaxBufferLength.call(this);return k?Math.max(L,k):L},K.onMediaDetaching=function(){this.videoBuffer=null,v.prototype.onMediaDetaching.call(this)},K.onAudioTracksUpdated=function(k,L){var R=L.audioTracks;this.resetTransmuxer(),this.levels=R.map(function(Z){return new Q.Level(Z)})},K.onAudioTrackSwitching=function(k,L){var R=!!L.url;this.trackId=L.id;var Z=this.fragCurrent;Z!=null&&Z.loader&&Z.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),R?this.setInterval(100):this.resetTransmuxer(),R?(this.audioSwitch=!0,this.state=G.State.IDLE):this.state=G.State.STOPPED,this.tick()},K.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},K.onLevelLoaded=function(k,L){this.mainDetails=L.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(de.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},K.onAudioTrackLoaded=function(k,L){var R;if(this.mainDetails!=null){var Z=this.levels,ae=L.details,fe=L.id;if(Z){this.log("Track "+fe+" loaded ["+ae.startSN+","+ae.endSN+"],duration:"+ae.totalduration);var ce=Z[fe],me=0;if(ae.live||(R=ce.details)!==null&&R!==void 0&&R.live){var Ee=this.mainDetails;if(ae.fragments[0]||(ae.deltaUpdateFailed=!0),ae.deltaUpdateFailed||!Ee)return;!ce.details&&ae.hasProgramDateTime&&Ee.hasProgramDateTime?((0,M.alignMediaPlaylistByPDT)(ae,Ee),me=ae.fragments[0].start):me=this.alignPlaylists(ae,ce.details)}ce.details=ae,this.levelLastLoaded=fe,this.startFragRequested||!this.mainDetails&&ae.live||this.setStartPosition(ce.details,me),this.state!==G.State.WAITING_TRACK||this.waitForCdnTuneIn(ae)||(this.state=G.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+fe)}else this.cachedTrackLoadedData=L},K._handleFragmentLoadProgress=function(k){var L,R=k.frag,Z=k.part,ae=k.payload,fe=this.config,ce=this.trackId,me=this.levels;if(me){var Ee=me[ce];console.assert(Ee,"Audio track is defined on fragment load progress");var be=Ee.details;console.assert(be,"Audio track details are defined on fragment load progress");var Re=fe.defaultAudioCodec||Ee.audioCodec||"mp4a.40.2",Ce=this.transmuxer;Ce||(Ce=this.transmuxer=new se.default(this.hls,X.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var Ne=this.initPTS[R.cc],Ue=(L=R.initSegment)===null||L===void 0?void 0:L.data;if(Ne!==void 0){var Xe=Z?Z.index:-1,ut=Xe!==-1,gt=new Y.ChunkMetadata(R.level,R.sn,R.stats.chunkCount,ae.byteLength,Xe,ut);Ce.push(ae,Ue,Re,"",R,Z,be.totalduration,!1,gt,Ne)}else this.log("Unknown video PTS for cc "+R.cc+", waiting for video PTS before demuxing audio frag "+R.sn+" of ["+be.startSN+" ,"+be.endSN+"],track "+ce),(this.waitingData=this.waitingData||{frag:R,part:Z,cache:new W.default,complete:!1}).cache.push(new Uint8Array(ae)),this.waitingVideoCC=this.videoTrackCC,this.state=G.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+R.sn+" of level "+R.level+" will not be buffered")},K._handleFragmentLoadComplete=function(k){this.waitingData?this.waitingData.complete=!0:v.prototype._handleFragmentLoadComplete.call(this,k)},K.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},K.onBufferCreated=function(k,L){var R=L.tracks.audio;R&&(this.mediaBuffer=R.buffer||null),L.tracks.video&&(this.videoBuffer=L.tracks.video.buffer||null)},K.onFragBuffered=function(k,L){var R,Z=L.frag,ae=L.part;Z.type===X.PlaylistLevelType.AUDIO?this.fragContextChanged(Z)?this.warn("Fragment "+Z.sn+(ae?" p: "+ae.index:"")+" of level "+Z.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(Z.sn!=="initSegment"&&(this.fragPrevious=Z,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(de.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(Z,ae)):this.loadedmetadata||Z.type!==X.PlaylistLevelType.MAIN||(R=this.videoBuffer||this.media)!==null&&R!==void 0&&R.buffered.length&&(this.loadedmetadata=!0)},K.onError=function(k,L){switch(L.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(X.PlaylistLevelType.AUDIO,L);break;case b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==G.State.ERROR&&this.state!==G.State.STOPPED&&(this.state=L.fatal?G.State.ERROR:G.State.IDLE,this.warn(L.details+" while loading frag, switching to "+this.state+" state"));break;case b.ErrorDetails.BUFFER_FULL_ERROR:if(L.parent==="audio"&&(this.state===G.State.PARSING||this.state===G.State.PARSED)){var R=!0,Z=this.getFwdBufferInfo(this.mediaBuffer,X.PlaylistLevelType.AUDIO);Z&&Z.len>.5&&(R=!this.reduceMaxBufferLength(Z.len)),R&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},K.onBufferFlushed=function(k,L){L.type===ie.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},K._handleTransmuxComplete=function(k){var L,R="audio",Z=this.hls,ae=k.remuxResult,fe=k.chunkMeta,ce=this.getCurrentContext(fe);if(!ce)return this.warn("The loading context changed while buffering fragment "+fe.sn+" of level "+fe.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(fe.level);var me=ce.frag,Ee=ce.part,be=ce.level.details,Re=ae.audio,Ce=ae.text,Ne=ae.id3,Ue=ae.initSegment;if(!this.fragContextChanged(me)&&be){if(this.state=G.State.PARSING,this.audioSwitch&&Re&&this.completeAudioSwitch(),Ue!=null&&Ue.tracks&&(this._bufferInitSegment(Ue.tracks,me,fe),Z.trigger(de.Events.FRAG_PARSING_INIT_SEGMENT,{frag:me,id:R,tracks:Ue.tracks})),Re){var Xe=Re.startPTS,ut=Re.endPTS,gt=Re.startDTS,ft=Re.endDTS;Ee&&(Ee.elementaryStreams[ie.ElementaryStreamTypes.AUDIO]={startPTS:Xe,endPTS:ut,startDTS:gt,endDTS:ft}),me.setElementaryStreamInfo(ie.ElementaryStreamTypes.AUDIO,Xe,ut,gt,ft),this.bufferFragmentData(Re,me,Ee,fe)}if(Ne!=null&&(L=Ne.samples)!==null&&L!==void 0&&L.length){var St=I({id:R,frag:me,details:be},Ne);Z.trigger(de.Events.FRAG_PARSING_METADATA,St)}if(Ce){var Et=I({id:R,frag:me,details:be},Ce);Z.trigger(de.Events.FRAG_PARSING_USERDATA,Et)}}},K._bufferInitSegment=function(k,L,R){if(this.state===G.State.PARSING){k.video&&delete k.video;var Z=k.audio;if(Z){Z.levelCodec=Z.codec,Z.id="audio",this.log("Init audio buffer, container:"+Z.container+", codecs[parsed]=["+Z.codec+"]"),this.hls.trigger(de.Events.BUFFER_CODECS,k);var ae=Z.initSegment;if(ae!=null&&ae.byteLength){var fe={type:"audio",frag:L,part:null,chunkMeta:R,parent:L.type,data:ae};this.hls.trigger(de.Events.BUFFER_APPENDING,fe)}this.tick()}}},K.loadFragment=function(k,L,R){var Z=this.fragmentTracker.getState(k);this.fragCurrent=k,(this.audioSwitch||Z===le.FragmentState.NOT_LOADED||Z===le.FragmentState.PARTIAL)&&(k.sn==="initSegment"?this._loadInitSegment(k):L.live&&!(0,z.isFiniteNumber)(this.initPTS[k.cc])?(this.log("Waiting for video PTS in continuity counter "+k.cc+" of live stream before loading audio fragment "+k.sn+" of level "+this.trackId),this.state=G.State.WAITING_INIT_PTS):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,k,L,R)))},K.completeAudioSwitch=function(){var k=this.hls,L=this.media,R=this.trackId;L&&(this.log("Switching audio track : flushing all audio"),v.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,k.trigger(de.Events.AUDIO_TRACK_SWITCHED,{id:R})},O}(G.default);const _=P},"./src/controller/audio-track-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>ie});var z=C("./src/events.ts"),G=C("./src/errors.ts"),de=C("./src/controller/base-playlist-controller.ts"),te=C("./src/types/loader.ts");function le(W,se){for(var Y=0;Y<se.length;Y++){var V=se[Y];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(W,V.key,V)}}function Q(W,se){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Y,V){return Y.__proto__=V,Y},Q(W,se)}var X=function(W){var se,Y;function V(P){var _;return(_=W.call(this,P,"[audio-track-controller]")||this).tracks=[],_.groupId=null,_.tracksInGroup=[],_.trackId=-1,_.trackName="",_.selectDefaultTrack=!0,_.registerListeners(),_}Y=W,(se=V).prototype=Object.create(Y.prototype),se.prototype.constructor=se,Q(se,Y);var M,b,I,w=V.prototype;return w.registerListeners=function(){var P=this.hls;P.on(z.Events.MANIFEST_LOADING,this.onManifestLoading,this),P.on(z.Events.MANIFEST_PARSED,this.onManifestParsed,this),P.on(z.Events.LEVEL_LOADING,this.onLevelLoading,this),P.on(z.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),P.on(z.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),P.on(z.Events.ERROR,this.onError,this)},w.unregisterListeners=function(){var P=this.hls;P.off(z.Events.MANIFEST_LOADING,this.onManifestLoading,this),P.off(z.Events.MANIFEST_PARSED,this.onManifestParsed,this),P.off(z.Events.LEVEL_LOADING,this.onLevelLoading,this),P.off(z.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),P.off(z.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),P.off(z.Events.ERROR,this.onError,this)},w.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,W.prototype.destroy.call(this)},w.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},w.onManifestParsed=function(P,_){this.tracks=_.audioTracks||[]},w.onAudioTrackLoaded=function(P,_){var v=_.id,A=_.details,D=this.tracksInGroup[v];if(D){var O=D.details;D.details=_.details,this.log("audioTrack "+v+" loaded ["+A.startSN+"-"+A.endSN+"]"),v===this.trackId&&(this.retryCount=0,this.playlistLoaded(v,_,O))}else this.warn("Invalid audio track id "+v)},w.onLevelLoading=function(P,_){this.switchLevel(_.level)},w.onLevelSwitching=function(P,_){this.switchLevel(_.level)},w.switchLevel=function(P){var _=this.hls.levels[P];if(_!=null&&_.audioGroupIds){var v=_.audioGroupIds[_.urlId];if(this.groupId!==v){this.groupId=v;var A=this.tracks.filter(function(O){return!v||O.groupId===v});this.selectDefaultTrack&&!A.some(function(O){return O.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=A;var D={audioTracks:A};this.log("Updating audio tracks, "+A.length+' track(s) found in "'+v+'" group-id'),this.hls.trigger(z.Events.AUDIO_TRACKS_UPDATED,D),this.selectInitialTrack()}}},w.onError=function(P,_){W.prototype.onError.call(this,P,_),!_.fatal&&_.context&&_.context.type===te.PlaylistContextType.AUDIO_TRACK&&_.context.id===this.trackId&&_.context.groupId===this.groupId&&this.retryLoadingOrFail(_)},w.setAudioTrack=function(P){var _=this.tracksInGroup;if(P<0||P>=_.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var v=_[this.trackId];this.log("Now switching to audio-track index "+P);var A=_[P],D=A.id,O=A.groupId,K=O===void 0?"":O,k=A.name,L=A.type,R=A.url;if(this.trackId=P,this.trackName=k,this.selectDefaultTrack=!1,this.hls.trigger(z.Events.AUDIO_TRACK_SWITCHING,{id:D,groupId:K,name:k,type:L,url:R}),!A.details||A.details.live){var Z=this.switchParams(A.url,v?.details);this.loadPlaylist(Z)}}},w.selectInitialTrack=function(){var P=this.tracksInGroup;console.assert(P.length,"Initial audio track should be selected when tracks are known");var _=this.trackName,v=this.findTrackId(_)||this.findTrackId();v!==-1?this.setAudioTrack(v):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},w.findTrackId=function(P){for(var _=this.tracksInGroup,v=0;v<_.length;v++){var A=_[v];if((!this.selectDefaultTrack||A.default)&&(!P||P===A.name))return A.id}return-1},w.loadPlaylist=function(P){var _=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(_)){var v=_.id,A=_.groupId,D=_.url;if(P)try{D=P.addDirectives(D)}catch(O){this.warn("Could not construct new URL with HLS Delivery Directives: "+O)}this.log("loading audio-track playlist for id: "+v),this.clearTimer(),this.hls.trigger(z.Events.AUDIO_TRACK_LOADING,{url:D,id:v,groupId:A,deliveryDirectives:P||null})}},M=V,(b=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(P){this.selectDefaultTrack=!1,this.setAudioTrack(P)}}])&&le(M.prototype,b),I&&le(M,I),Object.defineProperty(M,"prototype",{writable:!1}),V}(de.default);const ie=X},"./src/controller/base-playlist-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>Q});var z=C("./src/polyfills/number.ts"),G=C("./src/types/level.ts"),de=C("./src/controller/level-helper.ts"),te=C("./src/utils/logger.ts"),le=C("./src/errors.ts"),Q=function(){function X(W,se){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=te.logger.log.bind(te.logger,se+":"),this.warn=te.logger.warn.bind(te.logger,se+":"),this.hls=W}var ie=X.prototype;return ie.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},ie.onError=function(W,se){se.fatal&&se.type===le.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},ie.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},ie.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},ie.stopLoad=function(){this.canLoad=!1,this.clearTimer()},ie.switchParams=function(W,se){var Y=se?.renditionReports;if(Y)for(var V=0;V<Y.length;V++){var M=Y[V],b=""+M.URI;if(b===W.slice(-b.length)){var I=parseInt(M["LAST-MSN"]),w=parseInt(M["LAST-PART"]);if(se&&this.hls.config.lowLatencyMode){var P=Math.min(se.age-se.partTarget,se.targetduration);w!==void 0&&P>se.partTarget&&(w+=1)}if((0,z.isFiniteNumber)(I))return new G.HlsUrlParameters(I,(0,z.isFiniteNumber)(w)?w:void 0,G.HlsSkip.No)}}},ie.loadPlaylist=function(W){},ie.shouldLoadTrack=function(W){return this.canLoad&&W&&!!W.url&&(!W.details||W.details.live)},ie.playlistLoaded=function(W,se,Y){var V=this,M=se.details,b=se.stats,I=b.loading.end?Math.max(0,self.performance.now()-b.loading.end):0;if(M.advancedDateTime=Date.now()-I,M.live||Y!=null&&Y.live){if(M.reloaded(Y),Y&&this.log("live playlist "+W+" "+(M.advanced?"REFRESHED "+M.lastPartSn+"-"+M.lastPartIndex:"MISSED")),Y&&M.fragments.length>0&&(0,de.mergeDetails)(Y,M),!this.canLoad||!M.live)return;var w,P=void 0,_=void 0;if(M.canBlockReload&&M.endSN&&M.advanced){var v=this.hls.config.lowLatencyMode,A=M.lastPartSn,D=M.endSN,O=M.lastPartIndex,K=A===D;O!==-1?(P=K?D+1:A,_=K?v?0:O:O+1):P=D+1;var k=M.age,L=k+M.ageHeader,R=Math.min(L-M.partTarget,1.5*M.targetduration);if(R>0){if(Y&&R>Y.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+Y.tuneInGoal+" to: "+R+" with playlist age: "+M.age),R=0;else{var Z=Math.floor(R/M.targetduration);P+=Z,_!==void 0&&(_+=Math.round(R%M.targetduration/M.partTarget)),this.log("CDN Tune-in age: "+M.ageHeader+"s last advanced "+k.toFixed(2)+"s goal: "+R+" skip sn "+Z+" to part "+_)}M.tuneInGoal=R}if(w=this.getDeliveryDirectives(M,se.deliveryDirectives,P,_),v||!K)return void this.loadPlaylist(w)}else w=this.getDeliveryDirectives(M,se.deliveryDirectives,P,_);var ae=(0,de.computeReloadInterval)(M,b);P!==void 0&&M.canBlockReload&&(ae-=M.partTarget||1),this.log("reload live playlist "+W+" in "+Math.round(ae)+" ms"),this.timer=self.setTimeout(function(){return V.loadPlaylist(w)},ae)}else this.clearTimer()},ie.getDeliveryDirectives=function(W,se,Y,V){var M=(0,G.getSkipValue)(W,Y);return se!=null&&se.skip&&W.deltaUpdateFailed&&(Y=se.msn,V=se.part,M=G.HlsSkip.No),new G.HlsUrlParameters(Y,V,M)},ie.retryLoadingOrFail=function(W){var se,Y=this,V=this.hls.config,M=this.retryCount<V.levelLoadingMaxRetry;if(M)if(this.retryCount++,W.details.indexOf("LoadTimeOut")>-1&&(se=W.context)!==null&&se!==void 0&&se.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+W.details+'"'),this.loadPlaylist();else{var b=Math.min(Math.pow(2,this.retryCount)*V.levelLoadingRetryDelay,V.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return Y.loadPlaylist()},b),this.warn("retry playlist loading #"+this.retryCount+" in "+b+' ms after "'+W.details+'"')}else this.warn('cannot recover from error "'+W.details+'"'),this.clearTimer(),W.fatal=!0;return M},X}()},"./src/controller/base-stream-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{State:()=>A,default:()=>D});var z=C("./src/polyfills/number.ts"),G=C("./src/task-loop.ts"),de=C("./src/controller/fragment-tracker.ts"),te=C("./src/utils/buffer-helper.ts"),le=C("./src/utils/logger.ts"),Q=C("./src/events.ts"),X=C("./src/errors.ts"),ie=C("./src/types/transmuxer.ts"),W=C("./src/utils/mp4-tools.ts"),se=C("./src/utils/discontinuities.ts"),Y=C("./src/controller/fragment-finders.ts"),V=C("./src/controller/level-helper.ts"),M=C("./src/loader/fragment-loader.ts"),b=C("./src/crypt/decrypter.ts"),I=C("./src/utils/time-ranges.ts"),w=C("./src/types/loader.ts");function P(O,K){for(var k=0;k<K.length;k++){var L=K[k];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(O,L.key,L)}}function _(O){if(O===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}function v(O,K){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(k,L){return k.__proto__=L,k},v(O,K)}var A={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},D=function(O){var K,k;function L(ce,me,Ee){var be;return(be=O.call(this)||this).hls=void 0,be.fragPrevious=null,be.fragCurrent=null,be.fragmentTracker=void 0,be.transmuxer=null,be._state=A.STOPPED,be.media=null,be.mediaBuffer=null,be.config=void 0,be.bitrateTest=!1,be.lastCurrentTime=0,be.nextLoadPosition=0,be.startPosition=0,be.loadedmetadata=!1,be.fragLoadError=0,be.retryDate=0,be.levels=null,be.fragmentLoader=void 0,be.levelLastLoaded=null,be.startFragRequested=!1,be.decrypter=void 0,be.initPTS=[],be.onvseeking=null,be.onvended=null,be.logPrefix="",be.log=void 0,be.warn=void 0,be.logPrefix=Ee,be.log=le.logger.log.bind(le.logger,Ee+":"),be.warn=le.logger.warn.bind(le.logger,Ee+":"),be.hls=ce,be.fragmentLoader=new M.default(ce.config),be.fragmentTracker=me,be.config=ce.config,be.decrypter=new b.default(ce,ce.config),ce.on(Q.Events.KEY_LOADED,be.onKeyLoaded,_(be)),ce.on(Q.Events.LEVEL_SWITCHING,be.onLevelSwitching,_(be)),be}k=O,(K=L).prototype=Object.create(k.prototype),K.prototype.constructor=K,v(K,k);var R,Z,ae,fe=L.prototype;return fe.doTick=function(){this.onTickEnd()},fe.onTickEnd=function(){},fe.startLoad=function(ce){},fe.stopLoad=function(){this.fragmentLoader.abort();var ce=this.fragCurrent;ce&&this.fragmentTracker.removeFragment(ce),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=A.STOPPED},fe._streamEnded=function(ce,me){var Ee=this.fragCurrent,be=this.fragmentTracker;if(!me.live&&Ee&&this.media&&Ee.sn>=me.endSN&&!ce.nextStart){var Re=me.partList;if(Re!=null&&Re.length){var Ce=Re[Re.length-1];return te.BufferHelper.isBuffered(this.media,Ce.start+Ce.duration/2)}var Ne=be.getState(Ee);return Ne===de.FragmentState.PARTIAL||Ne===de.FragmentState.OK}return!1},fe.onMediaAttached=function(ce,me){var Ee=this.media=this.mediaBuffer=me.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),Ee.addEventListener("seeking",this.onvseeking),Ee.addEventListener("ended",this.onvended);var be=this.config;this.levels&&be.autoStartLoad&&this.state===A.STOPPED&&this.startLoad(be.startPosition)},fe.onMediaDetaching=function(){var ce=this.media;ce!=null&&ce.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ce&&this.onvseeking&&this.onvended&&(ce.removeEventListener("seeking",this.onvseeking),ce.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},fe.onMediaSeeking=function(){var ce=this.config,me=this.fragCurrent,Ee=this.media,be=this.mediaBuffer,Re=this.state,Ce=Ee?Ee.currentTime:0,Ne=te.BufferHelper.bufferInfo(be||Ee,Ce,ce.maxBufferHole);if(this.log("media seeking to "+((0,z.isFiniteNumber)(Ce)?Ce.toFixed(3):Ce)+", state: "+Re),Re===A.ENDED)this.resetLoadingState();else if(me){var Ue=ce.maxFragLookUpTolerance,Xe=me.start-Ue,ut=me.start+me.duration+Ue;if(!Ne.len||ut<Ne.start||Xe>Ne.end){var gt=Ce>ut;(Ce<Xe||gt)&&(gt&&me.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),me.loader.abort()),this.resetLoadingState())}}Ee&&(this.lastCurrentTime=Ce),this.loadedmetadata||Ne.len||(this.nextLoadPosition=this.startPosition=Ce),this.tickImmediate()},fe.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},fe.onKeyLoaded=function(ce,me){if(this.state===A.KEY_LOADING&&me.frag===this.fragCurrent&&this.levels){this.state=A.IDLE;var Ee=this.levels[me.frag.level].details;Ee&&this.loadFragment(me.frag,Ee,me.frag.start)}},fe.onLevelSwitching=function(ce,me){this.fragLoadError=0},fe.onHandlerDestroying=function(){this.stopLoad(),O.prototype.onHandlerDestroying.call(this)},fe.onHandlerDestroyed=function(){this.state=A.STOPPED,this.hls.off(Q.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(Q.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,O.prototype.onHandlerDestroyed.call(this)},fe.loadKey=function(ce,me){this.log("Loading key for "+ce.sn+" of ["+me.startSN+"-"+me.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+ce.level),this.state=A.KEY_LOADING,this.fragCurrent=ce,this.hls.trigger(Q.Events.KEY_LOADING,{frag:ce})},fe.loadFragment=function(ce,me,Ee){this._loadFragForPlayback(ce,me,Ee)},fe._loadFragForPlayback=function(ce,me,Ee){var be=this;this._doFragLoad(ce,me,Ee,function(Re){if(be.fragContextChanged(ce))return be.warn("Fragment "+ce.sn+(Re.part?" p: "+Re.part.index:"")+" of level "+ce.level+" was dropped during download."),void be.fragmentTracker.removeFragment(ce);ce.stats.chunkCount++,be._handleFragmentLoadProgress(Re)}).then(function(Re){if(Re){be.fragLoadError=0;var Ce=be.state;be.fragContextChanged(ce)?(Ce===A.FRAG_LOADING||!be.fragCurrent&&Ce===A.PARSING)&&(be.fragmentTracker.removeFragment(ce),be.state=A.IDLE):("payload"in Re&&(be.log("Loaded fragment "+ce.sn+" of level "+ce.level),be.hls.trigger(Q.Events.FRAG_LOADED,Re)),be._handleFragmentLoadComplete(Re))}}).catch(function(Re){be.state!==A.STOPPED&&be.state!==A.ERROR&&(be.warn(Re),be.resetFragmentLoading(ce))})},fe.flushMainBuffer=function(ce,me,Ee){if(Ee===void 0&&(Ee=null),ce-me){var be={startOffset:ce,endOffset:me,type:Ee};this.fragLoadError=0,this.hls.trigger(Q.Events.BUFFER_FLUSHING,be)}},fe._loadInitSegment=function(ce){var me=this;this._doFragLoad(ce).then(function(Ee){if(!Ee||me.fragContextChanged(ce)||!me.levels)throw new Error("init load aborted");return Ee}).then(function(Ee){var be=me.hls,Re=Ee.payload,Ce=ce.decryptdata;if(Re&&Re.byteLength>0&&Ce&&Ce.key&&Ce.iv&&Ce.method==="AES-128"){var Ne=self.performance.now();return me.decrypter.webCryptoDecrypt(new Uint8Array(Re),Ce.key.buffer,Ce.iv.buffer).then(function(Ue){var Xe=self.performance.now();return be.trigger(Q.Events.FRAG_DECRYPTED,{frag:ce,payload:Ue,stats:{tstart:Ne,tdecrypt:Xe}}),Ee.payload=Ue,Ee})}return Ee}).then(function(Ee){var be=me.fragCurrent,Re=me.hls,Ce=me.levels;if(!Ce)throw new Error("init load aborted, missing levels");var Ne=Ce[ce.level].details;console.assert(Ne,"Level details are defined when init segment is loaded");var Ue=ce.stats;me.state=A.IDLE,me.fragLoadError=0,ce.data=new Uint8Array(Ee.payload),Ue.parsing.start=Ue.buffering.start=self.performance.now(),Ue.parsing.end=Ue.buffering.end=self.performance.now(),Ee.frag===be&&Re.trigger(Q.Events.FRAG_BUFFERED,{stats:Ue,frag:be,part:null,id:ce.type}),me.tick()}).catch(function(Ee){me.state!==A.STOPPED&&me.state!==A.ERROR&&(me.warn(Ee),me.resetFragmentLoading(ce))})},fe.fragContextChanged=function(ce){var me=this.fragCurrent;return!ce||!me||ce.level!==me.level||ce.sn!==me.sn||ce.urlId!==me.urlId},fe.fragBufferedComplete=function(ce,me){var Ee,be,Re=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+ce.type+" sn: "+ce.sn+(me?" part: "+me.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+ce.level+" "+(Re?I.default.toString(te.BufferHelper.getBuffered(Re)):"(detached)")),this.state=A.IDLE,Re&&(!this.loadedmetadata&&ce.type==w.PlaylistLevelType.MAIN&&Re.buffered.length&&((Ee=this.fragCurrent)===null||Ee===void 0?void 0:Ee.sn)===((be=this.fragPrevious)===null||be===void 0?void 0:be.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},fe.seekToStartPos=function(){},fe._handleFragmentLoadComplete=function(ce){var me=this.transmuxer;if(me){var Ee=ce.frag,be=ce.part,Re=ce.partsLoaded,Ce=!Re||Re.length===0||Re.some(function(Ue){return!Ue}),Ne=new ie.ChunkMetadata(Ee.level,Ee.sn,Ee.stats.chunkCount+1,0,be?be.index:-1,!Ce);me.flush(Ne)}},fe._handleFragmentLoadProgress=function(ce){},fe._doFragLoad=function(ce,me,Ee,be){var Re=this;if(Ee===void 0&&(Ee=null),!this.levels)throw new Error("frag load aborted, missing levels");if(Ee=Math.max(ce.start,Ee||0),this.config.lowLatencyMode&&me){var Ce=me.partList;if(Ce&&be){Ee>ce.end&&me.fragmentHint&&(ce=me.fragmentHint);var Ne=this.getNextPart(Ce,ce,Ee);if(Ne>-1){var Ue=Ce[Ne];return this.log("Loading part sn: "+ce.sn+" p: "+Ue.index+" cc: "+ce.cc+" of playlist ["+me.startSN+"-"+me.endSN+"] parts [0-"+Ne+"-"+(Ce.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+ce.level+", target: "+parseFloat(Ee.toFixed(3))),this.nextLoadPosition=Ue.start+Ue.duration,this.state=A.FRAG_LOADING,this.hls.trigger(Q.Events.FRAG_LOADING,{frag:ce,part:Ce[Ne],targetBufferTime:Ee}),this.doFragPartsLoad(ce,Ce,Ne,be).catch(function(Xe){return Re.handleFragLoadError(Xe)})}if(!ce.url||this.loadedEndOfParts(Ce,Ee))return Promise.resolve(null)}}return this.log("Loading fragment "+ce.sn+" cc: "+ce.cc+" "+(me?"of ["+me.startSN+"-"+me.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+ce.level+", target: "+parseFloat(Ee.toFixed(3))),(0,z.isFiniteNumber)(ce.sn)&&!this.bitrateTest&&(this.nextLoadPosition=ce.start+ce.duration),this.state=A.FRAG_LOADING,this.hls.trigger(Q.Events.FRAG_LOADING,{frag:ce,targetBufferTime:Ee}),this.fragmentLoader.load(ce,be).catch(function(Xe){return Re.handleFragLoadError(Xe)})},fe.doFragPartsLoad=function(ce,me,Ee,be){var Re=this;return new Promise(function(Ce,Ne){var Ue=[];(function Xe(ut){var gt=me[ut];Re.fragmentLoader.loadPart(ce,gt,be).then(function(ft){Ue[gt.index]=ft;var St=ft.part;Re.hls.trigger(Q.Events.FRAG_LOADED,ft);var Et=me[ut+1];if(!Et||Et.fragment!==ce)return Ce({frag:ce,part:St,partsLoaded:Ue});Xe(ut+1)}).catch(Ne)})(Ee)})},fe.handleFragLoadError=function(ce){var me=ce.data;return me&&me.details===X.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(me.frag,me.part):this.hls.trigger(Q.Events.ERROR,me),null},fe._handleTransmuxerFlush=function(ce){var me=this.getCurrentContext(ce);if(me&&this.state===A.PARSING){var Ee=me.frag,be=me.part,Re=me.level,Ce=self.performance.now();Ee.stats.parsing.end=Ce,be&&(be.stats.parsing.end=Ce),this.updateLevelTiming(Ee,be,Re,ce.partial)}else this.fragCurrent||(this.state=A.IDLE)},fe.getCurrentContext=function(ce){var me=this.levels,Ee=ce.level,be=ce.sn,Re=ce.part;if(!me||!me[Ee])return this.warn("Levels object was unset while buffering fragment "+be+" of level "+Ee+". The current chunk will not be buffered."),null;var Ce=me[Ee],Ne=Re>-1?(0,V.getPartWith)(Ce,be,Re):null,Ue=Ne?Ne.fragment:(0,V.getFragmentWithSN)(Ce,be,this.fragCurrent);return Ue?{frag:Ue,part:Ne,level:Ce}:null},fe.bufferFragmentData=function(ce,me,Ee,be){if(ce&&this.state===A.PARSING){var Re=ce.data1,Ce=ce.data2,Ne=Re;if(Re&&Ce&&(Ne=(0,W.appendUint8Array)(Re,Ce)),Ne&&Ne.length){var Ue={type:ce.type,frag:me,part:Ee,chunkMeta:be,parent:me.type,data:Ne};this.hls.trigger(Q.Events.BUFFER_APPENDING,Ue),ce.dropped&&ce.independent&&!Ee&&this.flushBufferGap(me)}}},fe.flushBufferGap=function(ce){var me=this.media;if(me)if(te.BufferHelper.isBuffered(me,me.currentTime)){var Ee=me.currentTime,be=te.BufferHelper.bufferInfo(me,Ee,0),Re=ce.duration,Ce=Math.min(2*this.config.maxFragLookUpTolerance,.25*Re),Ne=Math.max(Math.min(ce.start-Ce,be.end-Ce),Ee+Ce);ce.start-Ne>Ce&&this.flushMainBuffer(Ne,ce.start)}else this.flushMainBuffer(0,ce.start)},fe.getFwdBufferInfo=function(ce,me){var Ee=this.config,be=this.getLoadPosition();if(!(0,z.isFiniteNumber)(be))return null;var Re=te.BufferHelper.bufferInfo(ce,be,Ee.maxBufferHole);if(Re.len===0&&Re.nextStart!==void 0){var Ce=this.fragmentTracker.getBufferedFrag(be,me);if(Ce&&Re.nextStart<Ce.end)return te.BufferHelper.bufferInfo(ce,be,Math.max(Re.nextStart,Ee.maxBufferHole))}return Re},fe.getMaxBufferLength=function(ce){var me,Ee=this.config;return me=ce?Math.max(8*Ee.maxBufferSize/ce,Ee.maxBufferLength):Ee.maxBufferLength,Math.min(me,Ee.maxMaxBufferLength)},fe.reduceMaxBufferLength=function(ce){var me=this.config,Ee=ce||me.maxBufferLength;return me.maxMaxBufferLength>=Ee&&(me.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+me.maxMaxBufferLength+"s"),!0)},fe.getNextFragment=function(ce,me){var Ee=me.fragments,be=Ee.length;if(!be)return null;var Re,Ce=this.config,Ne=Ee[0].start;if(me.live){var Ue=Ce.initialLiveManifestSize;if(be<Ue)return this.warn("Not enough fragments to start playback (have: "+be+", need: "+Ue+")"),null;me.PTSKnown||this.startFragRequested||this.startPosition!==-1||(Re=this.getInitialLiveFragment(me,Ee),this.startPosition=Re?this.hls.liveSyncPosition||Re.start:ce)}else ce<=Ne&&(Re=Ee[0]);if(!Re){var Xe=Ce.lowLatencyMode?me.partEnd:me.fragmentEnd;Re=this.getFragmentAtPosition(ce,Xe,me)}return this.mapToInitFragWhenRequired(Re)},fe.mapToInitFragWhenRequired=function(ce){return ce==null||!ce.initSegment||ce!=null&&ce.initSegment.data||this.bitrateTest?ce:ce.initSegment},fe.getNextPart=function(ce,me,Ee){for(var be=-1,Re=!1,Ce=!0,Ne=0,Ue=ce.length;Ne<Ue;Ne++){var Xe=ce[Ne];if(Ce=Ce&&!Xe.independent,be>-1&&Ee<Xe.start)break;var ut=Xe.loaded;!ut&&(Re||Xe.independent||Ce)&&Xe.fragment===me&&(be=Ne),Re=ut}return be},fe.loadedEndOfParts=function(ce,me){var Ee=ce[ce.length-1];return Ee&&me>Ee.start&&Ee.loaded},fe.getInitialLiveFragment=function(ce,me){var Ee=this.fragPrevious,be=null;if(Ee){if(ce.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+Ee.programDateTime),be=(0,Y.findFragmentByPDT)(me,Ee.endProgramDateTime,this.config.maxFragLookUpTolerance)),!be){var Re=Ee.sn+1;if(Re>=ce.startSN&&Re<=ce.endSN){var Ce=me[Re-ce.startSN];Ee.cc===Ce.cc&&(be=Ce,this.log("Live playlist, switching playlist, load frag with next SN: "+be.sn))}be||(be=(0,Y.findFragWithCC)(me,Ee.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+be.sn)}}else{var Ne=this.hls.liveSyncPosition;Ne!==null&&(be=this.getFragmentAtPosition(Ne,this.bitrateTest?ce.fragmentEnd:ce.edge,ce))}return be},fe.getFragmentAtPosition=function(ce,me,Ee){var be,Re=this.config,Ce=this.fragPrevious,Ne=Ee.fragments,Ue=Ee.endSN,Xe=Ee.fragmentHint,ut=Re.maxFragLookUpTolerance,gt=!!(Re.lowLatencyMode&&Ee.partList&&Xe);if(gt&&Xe&&!this.bitrateTest&&(Ne=Ne.concat(Xe),Ue=Xe.sn),ce<me){var ft=ce>me-ut?0:ut;be=(0,Y.findFragmentByPTS)(Ce,Ne,ce,ft)}else be=Ne[Ne.length-1];if(be){var St=be.sn-Ee.startSN;if(this.fragmentTracker.getState(be)===de.FragmentState.OK&&(Ce=be),Ce&&be.sn===Ce.sn&&!gt&&Ce&&be.level===Ce.level){var Et=Ne[St+1];be.sn<Ue&&this.fragmentTracker.getState(Et)!==de.FragmentState.OK?(this.log("SN "+be.sn+" just loaded, load next one: "+Et.sn),be=Et):be=null}}return be},fe.synchronizeToLiveEdge=function(ce){var me=this.config,Ee=this.media;if(Ee){var be=this.hls.liveSyncPosition,Re=Ee.currentTime,Ce=ce.fragments[0].start,Ne=ce.edge,Ue=Re>=Ce-me.maxFragLookUpTolerance&&Re<=Ne;if(be!==null&&Ee.duration>be&&(Re<be||!Ue)){var Xe=me.liveMaxLatencyDuration!==void 0?me.liveMaxLatencyDuration:me.liveMaxLatencyDurationCount*ce.targetduration;(!Ue&&Ee.readyState<4||Re<Ne-Xe)&&(this.loadedmetadata||(this.nextLoadPosition=be),Ee.readyState&&(this.warn("Playback: "+Re.toFixed(3)+" is located too far from the end of live sliding playlist: "+Ne+", reset currentTime to : "+be.toFixed(3)),Ee.currentTime=be))}}},fe.alignPlaylists=function(ce,me){var Ee=this.levels,be=this.levelLastLoaded,Re=this.fragPrevious,Ce=be!==null?Ee[be]:null,Ne=ce.fragments.length;if(!Ne)return this.warn("No fragments in live playlist"),0;var Ue=ce.fragments[0].start,Xe=!me,ut=ce.alignedSliding&&(0,z.isFiniteNumber)(Ue);if(Xe||!ut&&!Ue){(0,se.alignStream)(Re,Ce,ce);var gt=ce.fragments[0].start;return this.log("Live playlist sliding: "+gt.toFixed(2)+" start-sn: "+(me?me.startSN:"na")+"->"+ce.startSN+" prev-sn: "+(Re?Re.sn:"na")+" fragments: "+Ne),gt}return Ue},fe.waitForCdnTuneIn=function(ce){return ce.live&&ce.canBlockReload&&ce.partTarget&&ce.tuneInGoal>Math.max(ce.partHoldBack,3*ce.partTarget)},fe.setStartPosition=function(ce,me){var Ee=this.startPosition;if(Ee<me&&(Ee=-1),Ee===-1||this.lastCurrentTime===-1){var be=ce.startTimeOffset;(0,z.isFiniteNumber)(be)?(Ee=me+be,be<0&&(Ee+=ce.totalduration),Ee=Math.min(Math.max(me,Ee),me+ce.totalduration),this.log("Start time offset "+be+" found in playlist, adjust startPosition to "+Ee),this.startPosition=Ee):ce.live?Ee=this.hls.liveSyncPosition||me:this.startPosition=Ee=0,this.lastCurrentTime=Ee}this.nextLoadPosition=Ee},fe.getLoadPosition=function(){var ce=this.media,me=0;return this.loadedmetadata&&ce?me=ce.currentTime:this.nextLoadPosition&&(me=this.nextLoadPosition),me},fe.handleFragLoadAborted=function(ce,me){this.transmuxer&&ce.sn!=="initSegment"&&ce.stats.aborted&&(this.warn("Fragment "+ce.sn+(me?" part"+me.index:"")+" of level "+ce.level+" was aborted"),this.resetFragmentLoading(ce))},fe.resetFragmentLoading=function(ce){this.fragCurrent&&(this.fragContextChanged(ce)||this.state===A.FRAG_LOADING_WAITING_RETRY)||(this.state=A.IDLE)},fe.onFragmentOrKeyLoadError=function(ce,me){if(!me.fatal){var Ee=me.frag;if(Ee&&Ee.type===ce){var be=this.fragCurrent;console.assert(be&&Ee.sn===be.sn&&Ee.level===be.level&&Ee.urlId===be.urlId,"Frag load error must match current frag to retry");var Re=this.config;if(this.fragLoadError+1<=Re.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var Ce=Math.min(Math.pow(2,this.fragLoadError)*Re.fragLoadingRetryDelay,Re.fragLoadingMaxRetryTimeout);this.warn("Fragment "+Ee.sn+" of "+ce+" "+Ee.level+" failed to load, retrying in "+Ce+"ms"),this.retryDate=self.performance.now()+Ce,this.fragLoadError++,this.state=A.FRAG_LOADING_WAITING_RETRY}else me.levelRetry?(ce===w.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=A.IDLE):(le.logger.error(me.details+" reaches max retry, redispatch as fatal ..."),me.fatal=!0,this.hls.stopLoad(),this.state=A.ERROR)}}},fe.afterBufferFlushed=function(ce,me,Ee){if(ce){var be=te.BufferHelper.getBuffered(ce);this.fragmentTracker.detectEvictedFragments(me,be,Ee),this.state===A.ENDED&&this.resetLoadingState()}},fe.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=A.IDLE},fe.resetStartWhenNotLoaded=function(ce){if(!this.loadedmetadata){this.startFragRequested=!1;var me=this.levels?this.levels[ce].details:null;me!=null&&me.live?(this.startPosition=-1,this.setStartPosition(me,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},fe.updateLevelTiming=function(ce,me,Ee,be){var Re=this,Ce=Ee.details;console.assert(!!Ce,"level.details must be defined"),Object.keys(ce.elementaryStreams).reduce(function(Ne,Ue){var Xe=ce.elementaryStreams[Ue];if(Xe){var ut=Xe.endPTS-Xe.startPTS;if(ut<=0)return Re.warn("Could not parse fragment "+ce.sn+" "+Ue+" duration reliably ("+ut+")"),Ne||!1;var gt=be?0:(0,V.updateFragPTSDTS)(Ce,ce,Xe.startPTS,Xe.endPTS,Xe.startDTS,Xe.endDTS);return Re.hls.trigger(Q.Events.LEVEL_PTS_UPDATED,{details:Ce,level:Ee,drift:gt,type:Ue,frag:ce,start:Xe.startPTS,end:Xe.endPTS}),!0}return Ne},!1)||(this.warn("Found no media in fragment "+ce.sn+" of level "+Ee.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=A.PARSED,this.hls.trigger(Q.Events.FRAG_PARSED,{frag:ce,part:me})},fe.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},R=L,(Z=[{key:"state",get:function(){return this._state},set:function(ce){var me=this._state;me!==ce&&(this._state=ce,this.log(me+"->"+ce))}}])&&P(R.prototype,Z),ae&&P(R,ae),Object.defineProperty(R,"prototype",{writable:!1}),L}(G.default)},"./src/controller/buffer-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>Y});var z=C("./src/polyfills/number.ts"),G=C("./src/events.ts"),de=C("./src/utils/logger.ts"),te=C("./src/errors.ts"),le=C("./src/utils/buffer-helper.ts"),Q=C("./src/utils/mediasource-helper.ts"),X=C("./src/loader/fragment.ts"),ie=C("./src/controller/buffer-operation-queue.ts"),W=(0,Q.getMediaSource)(),se=/([ha]vc.)(?:\.[^.,]+)+/,Y=function(){function V(b){var I=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var w=I.hls,P=I.media,_=I.mediaSource;de.logger.log("[buffer-controller]: Media source opened"),P&&(I.updateMediaElementDuration(),w.trigger(G.Events.MEDIA_ATTACHED,{media:P})),_&&_.removeEventListener("sourceopen",I._onMediaSourceOpen),I.checkPendingTracks()},this._onMediaSourceClose=function(){de.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){de.logger.log("[buffer-controller]: Media source ended")},this.hls=b,this._initSourceBuffer(),this.registerListeners()}var M=V.prototype;return M.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},M.destroy=function(){this.unregisterListeners(),this.details=null},M.registerListeners=function(){var b=this.hls;b.on(G.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),b.on(G.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(G.Events.MANIFEST_PARSED,this.onManifestParsed,this),b.on(G.Events.BUFFER_RESET,this.onBufferReset,this),b.on(G.Events.BUFFER_APPENDING,this.onBufferAppending,this),b.on(G.Events.BUFFER_CODECS,this.onBufferCodecs,this),b.on(G.Events.BUFFER_EOS,this.onBufferEos,this),b.on(G.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),b.on(G.Events.LEVEL_UPDATED,this.onLevelUpdated,this),b.on(G.Events.FRAG_PARSED,this.onFragParsed,this),b.on(G.Events.FRAG_CHANGED,this.onFragChanged,this)},M.unregisterListeners=function(){var b=this.hls;b.off(G.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),b.off(G.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(G.Events.MANIFEST_PARSED,this.onManifestParsed,this),b.off(G.Events.BUFFER_RESET,this.onBufferReset,this),b.off(G.Events.BUFFER_APPENDING,this.onBufferAppending,this),b.off(G.Events.BUFFER_CODECS,this.onBufferCodecs,this),b.off(G.Events.BUFFER_EOS,this.onBufferEos,this),b.off(G.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),b.off(G.Events.LEVEL_UPDATED,this.onLevelUpdated,this),b.off(G.Events.FRAG_PARSED,this.onFragParsed,this),b.off(G.Events.FRAG_CHANGED,this.onFragChanged,this)},M._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new ie.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},M.onManifestParsed=function(b,I){var w=2;(I.audio&&!I.video||!I.altAudio)&&(w=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=w,this.details=null,de.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},M.onMediaAttaching=function(b,I){var w=this.media=I.media;if(w&&W){var P=this.mediaSource=new W;P.addEventListener("sourceopen",this._onMediaSourceOpen),P.addEventListener("sourceended",this._onMediaSourceEnded),P.addEventListener("sourceclose",this._onMediaSourceClose),w.src=self.URL.createObjectURL(P),this._objectUrl=w.src}},M.onMediaDetaching=function(){var b=this.media,I=this.mediaSource,w=this._objectUrl;if(I){if(de.logger.log("[buffer-controller]: media source detaching"),I.readyState==="open")try{I.endOfStream()}catch(P){de.logger.warn("[buffer-controller]: onMediaDetaching: "+P.message+" while calling endOfStream")}this.onBufferReset(),I.removeEventListener("sourceopen",this._onMediaSourceOpen),I.removeEventListener("sourceended",this._onMediaSourceEnded),I.removeEventListener("sourceclose",this._onMediaSourceClose),b&&(w&&self.URL.revokeObjectURL(w),b.src===w?(b.removeAttribute("src"),b.load()):de.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(G.Events.MEDIA_DETACHED,void 0)},M.onBufferReset=function(){var b=this;this.getSourceBufferTypes().forEach(function(I){var w=b.sourceBuffer[I];try{w&&(b.removeBufferListeners(I),b.mediaSource&&b.mediaSource.removeSourceBuffer(w),b.sourceBuffer[I]=void 0)}catch(P){de.logger.warn("[buffer-controller]: Failed to reset the "+I+" buffer",P)}}),this._initSourceBuffer()},M.onBufferCodecs=function(b,I){var w=this,P=this.getSourceBufferTypes().length;Object.keys(I).forEach(function(_){if(P){var v=w.tracks[_];if(v&&typeof v.buffer.changeType=="function"){var A=I[_],D=A.id,O=A.codec,K=A.levelCodec,k=A.container,L=A.metadata,R=(v.levelCodec||v.codec).replace(se,"$1"),Z=(K||O).replace(se,"$1");if(R!==Z){var ae=k+";codecs="+(K||O);w.appendChangeType(_,ae),de.logger.log("[buffer-controller]: switching codec "+R+" to "+Z),w.tracks[_]={buffer:v.buffer,codec:O,container:k,levelCodec:K,metadata:L,id:D}}}}else w.pendingTracks[_]=I[_]}),P||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},M.appendChangeType=function(b,I){var w=this,P=this.operationQueue,_={execute:function(){var v=w.sourceBuffer[b];v&&(de.logger.log("[buffer-controller]: changing "+b+" sourceBuffer type to "+I),v.changeType(I)),P.shiftAndExecuteNext(b)},onStart:function(){},onComplete:function(){},onError:function(v){de.logger.warn("[buffer-controller]: Failed to change "+b+" SourceBuffer type",v)}};P.append(_,b)},M.onBufferAppending=function(b,I){var w=this,P=this.hls,_=this.operationQueue,v=this.tracks,A=I.data,D=I.type,O=I.frag,K=I.part,k=I.chunkMeta,L=k.buffering[D],R=self.performance.now();L.start=R;var Z=O.stats.buffering,ae=K?K.stats.buffering:null;Z.start===0&&(Z.start=R),ae&&ae.start===0&&(ae.start=R);var fe=v.audio,ce=D==="audio"&&k.id===1&&fe?.container==="audio/mpeg",me={execute:function(){if(L.executeStart=self.performance.now(),ce){var Ee=w.sourceBuffer[D];if(Ee){var be=O.start-Ee.timestampOffset;Math.abs(be)>=.1&&(de.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+O.start+" (delta: "+be+") sn: "+O.sn+")"),Ee.timestampOffset=O.start)}}w.appendExecutor(A,D)},onStart:function(){},onComplete:function(){var Ee=self.performance.now();L.executeEnd=L.end=Ee,Z.first===0&&(Z.first=Ee),ae&&ae.first===0&&(ae.first=Ee);var be=w.sourceBuffer,Re={};for(var Ce in be)Re[Ce]=le.BufferHelper.getBuffered(be[Ce]);w.appendError=0,w.hls.trigger(G.Events.BUFFER_APPENDED,{type:D,frag:O,part:K,chunkMeta:k,parent:O.type,timeRanges:Re})},onError:function(Ee){de.logger.error("[buffer-controller]: Error encountered while trying to append to the "+D+" SourceBuffer",Ee);var be={type:te.ErrorTypes.MEDIA_ERROR,parent:O.type,details:te.ErrorDetails.BUFFER_APPEND_ERROR,err:Ee,fatal:!1};Ee.code===DOMException.QUOTA_EXCEEDED_ERR?be.details=te.ErrorDetails.BUFFER_FULL_ERROR:(w.appendError++,be.details=te.ErrorDetails.BUFFER_APPEND_ERROR,w.appendError>P.config.appendErrorMaxRetry&&(de.logger.error("[buffer-controller]: Failed "+P.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),be.fatal=!0,P.stopLoad())),P.trigger(G.Events.ERROR,be)}};_.append(me,D)},M.onBufferFlushing=function(b,I){var w=this,P=this.operationQueue,_=function(v){return{execute:w.removeExecutor.bind(w,v,I.startOffset,I.endOffset),onStart:function(){},onComplete:function(){w.hls.trigger(G.Events.BUFFER_FLUSHED,{type:v})},onError:function(A){de.logger.warn("[buffer-controller]: Failed to remove from "+v+" SourceBuffer",A)}}};I.type?P.append(_(I.type),I.type):this.getSourceBufferTypes().forEach(function(v){P.append(_(v),v)})},M.onFragParsed=function(b,I){var w=this,P=I.frag,_=I.part,v=[],A=_?_.elementaryStreams:P.elementaryStreams;A[X.ElementaryStreamTypes.AUDIOVIDEO]?v.push("audiovideo"):(A[X.ElementaryStreamTypes.AUDIO]&&v.push("audio"),A[X.ElementaryStreamTypes.VIDEO]&&v.push("video")),v.length===0&&de.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+P.type+" level: "+P.level+" sn: "+P.sn),this.blockBuffers(function(){var D=self.performance.now();P.stats.buffering.end=D,_&&(_.stats.buffering.end=D);var O=_?_.stats:P.stats;w.hls.trigger(G.Events.FRAG_BUFFERED,{frag:P,part:_,stats:O,id:P.type})},v)},M.onFragChanged=function(b,I){this.flushBackBuffer()},M.onBufferEos=function(b,I){var w=this;this.getSourceBufferTypes().reduce(function(P,_){var v=w.sourceBuffer[_];return I.type&&I.type!==_||v&&!v.ended&&(v.ended=!0,de.logger.log("[buffer-controller]: "+_+" sourceBuffer now EOS")),P&&!(v&&!v.ended)},!0)&&this.blockBuffers(function(){var P=w.mediaSource;P&&P.readyState==="open"&&P.endOfStream()})},M.onLevelUpdated=function(b,I){var w=I.details;w.fragments.length&&(this.details=w,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},M.flushBackBuffer=function(){var b=this.hls,I=this.details,w=this.media,P=this.sourceBuffer;if(w&&I!==null){var _=this.getSourceBufferTypes();if(_.length){var v=I.live&&b.config.liveBackBufferLength!==null?b.config.liveBackBufferLength:b.config.backBufferLength;if((0,z.isFiniteNumber)(v)&&!(v<0)){var A=w.currentTime,D=I.levelTargetDuration,O=Math.max(v,D),K=Math.floor(A/D)*D-O;_.forEach(function(k){var L=P[k];if(L){var R=le.BufferHelper.getBuffered(L);R.length>0&&K>R.start(0)&&(b.trigger(G.Events.BACK_BUFFER_REACHED,{bufferEnd:K}),I.live&&b.trigger(G.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:K}),b.trigger(G.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:K,type:k}))}})}}}},M.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var b=this.details,I=this.hls,w=this.media,P=this.mediaSource,_=b.fragments[0].start+b.totalduration,v=w.duration,A=(0,z.isFiniteNumber)(P.duration)?P.duration:0;b.live&&I.config.liveDurationInfinity?(de.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),P.duration=1/0,this.updateSeekableRange(b)):(_>A&&_>v||!(0,z.isFiniteNumber)(v))&&(de.logger.log("[buffer-controller]: Updating Media Source duration to "+_.toFixed(3)),P.duration=_)}},M.updateSeekableRange=function(b){var I=this.mediaSource,w=b.fragments;if(w.length&&b.live&&I!=null&&I.setLiveSeekableRange){var P=Math.max(0,w[0].start),_=Math.max(P,P+b.totalduration);I.setLiveSeekableRange(P,_)}},M.checkPendingTracks=function(){var b=this.bufferCodecEventsExpected,I=this.operationQueue,w=this.pendingTracks,P=Object.keys(w).length;if(P&&!b||P===2){this.createSourceBuffers(w),this.pendingTracks={};var _=this.getSourceBufferTypes();if(_.length===0)return void this.hls.trigger(G.Events.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});_.forEach(function(v){I.executeNext(v)})}},M.createSourceBuffers=function(b){var I=this.sourceBuffer,w=this.mediaSource;if(!w)throw Error("createSourceBuffers called when mediaSource was null");var P=0;for(var _ in b)if(!I[_]){var v=b[_];if(!v)throw Error("source buffer exists for track "+_+", however track does not");var A=v.levelCodec||v.codec,D=v.container+";codecs="+A;de.logger.log("[buffer-controller]: creating sourceBuffer("+D+")");try{var O=I[_]=w.addSourceBuffer(D),K=_;this.addBufferListener(K,"updatestart",this._onSBUpdateStart),this.addBufferListener(K,"updateend",this._onSBUpdateEnd),this.addBufferListener(K,"error",this._onSBUpdateError),this.tracks[_]={buffer:O,codec:A,container:v.container,levelCodec:v.levelCodec,metadata:v.metadata,id:v.id},P++}catch(k){de.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+k.message),this.hls.trigger(G.Events.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:k,mimeType:D})}}P&&this.hls.trigger(G.Events.BUFFER_CREATED,{tracks:this.tracks})},M._onSBUpdateStart=function(b){this.operationQueue.current(b).onStart()},M._onSBUpdateEnd=function(b){var I=this.operationQueue;I.current(b).onComplete(),I.shiftAndExecuteNext(b)},M._onSBUpdateError=function(b,I){de.logger.error("[buffer-controller]: "+b+" SourceBuffer error",I),this.hls.trigger(G.Events.ERROR,{type:te.ErrorTypes.MEDIA_ERROR,details:te.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var w=this.operationQueue.current(b);w&&w.onError(I)},M.removeExecutor=function(b,I,w){var P=this.media,_=this.mediaSource,v=this.operationQueue,A=this.sourceBuffer[b];if(!P||!_||!A)return de.logger.warn("[buffer-controller]: Attempting to remove from the "+b+" SourceBuffer, but it does not exist"),void v.shiftAndExecuteNext(b);var D=(0,z.isFiniteNumber)(P.duration)?P.duration:1/0,O=(0,z.isFiniteNumber)(_.duration)?_.duration:1/0,K=Math.max(0,I),k=Math.min(w,D,O);k>K?(de.logger.log("[buffer-controller]: Removing ["+K+","+k+"] from the "+b+" SourceBuffer"),console.assert(!A.updating,b+" sourceBuffer must not be updating"),A.remove(K,k)):v.shiftAndExecuteNext(b)},M.appendExecutor=function(b,I){var w=this.operationQueue,P=this.sourceBuffer[I];if(!P)return de.logger.warn("[buffer-controller]: Attempting to append to the "+I+" SourceBuffer, but it does not exist"),void w.shiftAndExecuteNext(I);P.ended=!1,console.assert(!P.updating,I+" sourceBuffer must not be updating"),P.appendBuffer(b)},M.blockBuffers=function(b,I){var w=this;if(I===void 0&&(I=this.getSourceBufferTypes()),!I.length)return de.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(b);var P=this.operationQueue,_=I.map(function(v){return P.appendBlocker(v)});Promise.all(_).then(function(){b(),I.forEach(function(v){var A=w.sourceBuffer[v];A&&A.updating||P.shiftAndExecuteNext(v)})})},M.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},M.addBufferListener=function(b,I,w){var P=this.sourceBuffer[b];if(P){var _=w.bind(this,b);this.listeners[b].push({event:I,listener:_}),P.addEventListener(I,_)}},M.removeBufferListeners=function(b){var I=this.sourceBuffer[b];I&&this.listeners[b].forEach(function(w){I.removeEventListener(w.event,w.listener)})},V}()},"./src/controller/buffer-operation-queue.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>G});var z=C("./src/utils/logger.ts"),G=function(){function de(le){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=le}var te=de.prototype;return te.append=function(le,Q){var X=this.queues[Q];X.push(le),X.length===1&&this.buffers[Q]&&this.executeNext(Q)},te.insertAbort=function(le,Q){this.queues[Q].unshift(le),this.executeNext(Q)},te.appendBlocker=function(le){var Q,X=new Promise(function(W){Q=W}),ie={execute:Q,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(ie,le),X},te.executeNext=function(le){var Q=this.buffers,X=this.queues,ie=Q[le],W=X[le];if(W.length){var se=W[0];try{se.execute()}catch(Y){z.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),se.onError(Y),ie&&ie.updating||(W.shift(),this.executeNext(le))}}},te.shiftAndExecuteNext=function(le){this.queues[le].shift(),this.executeNext(le)},te.current=function(le){return this.queues[le][0]},de}()},"./src/controller/cap-level-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>te});var z=C("./src/events.ts");function G(le,Q){for(var X=0;X<Q.length;X++){var ie=Q[X];ie.enumerable=ie.enumerable||!1,ie.configurable=!0,"value"in ie&&(ie.writable=!0),Object.defineProperty(le,ie.key,ie)}}var de=function(){function le(se){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=se,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var Q,X,ie,W=le.prototype;return W.setStreamController=function(se){this.streamController=se},W.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},W.registerListeners=function(){var se=this.hls;se.on(z.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),se.on(z.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),se.on(z.Events.MANIFEST_PARSED,this.onManifestParsed,this),se.on(z.Events.BUFFER_CODECS,this.onBufferCodecs,this),se.on(z.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},W.unregisterListener=function(){var se=this.hls;se.off(z.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),se.off(z.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),se.off(z.Events.MANIFEST_PARSED,this.onManifestParsed,this),se.off(z.Events.BUFFER_CODECS,this.onBufferCodecs,this),se.off(z.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},W.onFpsDropLevelCapping=function(se,Y){le.isLevelAllowed(Y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(Y.droppedLevel)},W.onMediaAttaching=function(se,Y){this.media=Y.media instanceof HTMLVideoElement?Y.media:null},W.onManifestParsed=function(se,Y){var V=this.hls;this.restrictedLevels=[],this.firstLevel=Y.firstLevel,V.config.capLevelToPlayerSize&&Y.video&&this.startCapping()},W.onBufferCodecs=function(se,Y){this.hls.config.capLevelToPlayerSize&&Y.video&&this.startCapping()},W.onMediaDetaching=function(){this.stopCapping()},W.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var se=this.hls.levels;if(se.length){var Y=this.hls;Y.autoLevelCapping=this.getMaxLevel(se.length-1),Y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=Y.autoLevelCapping}}},W.getMaxLevel=function(se){var Y=this,V=this.hls.levels;if(!V.length)return-1;var M=V.filter(function(b,I){return le.isLevelAllowed(I,Y.restrictedLevels)&&I<=se});return this.clientRect=null,le.getMaxLevelByMediaSize(M,this.mediaWidth,this.mediaHeight)},W.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},W.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},W.getDimensions=function(){if(this.clientRect)return this.clientRect;var se=this.media,Y={width:0,height:0};if(se){var V=se.getBoundingClientRect();Y.width=V.width,Y.height=V.height,Y.width||Y.height||(Y.width=V.right-V.left||se.width||0,Y.height=V.bottom-V.top||se.height||0)}return this.clientRect=Y,Y},le.isLevelAllowed=function(se,Y){return Y===void 0&&(Y=[]),Y.indexOf(se)===-1},le.getMaxLevelByMediaSize=function(se,Y,V){if(!se||!se.length)return-1;for(var M,b,I=se.length-1,w=0;w<se.length;w+=1){var P=se[w];if((P.width>=Y||P.height>=V)&&(M=P,!(b=se[w+1])||M.width!==b.width||M.height!==b.height)){I=w;break}}return I},Q=le,(X=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var se=1;if(!this.hls.config.ignoreDevicePixelRatio)try{se=self.devicePixelRatio}catch{}return se}}])&&G(Q.prototype,X),ie&&G(Q,ie),Object.defineProperty(Q,"prototype",{writable:!1}),le}();const te=de},"./src/controller/cmcd-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>se});var z=C("./src/events.ts"),G=C("./src/types/cmcd.ts"),de=C("./src/utils/buffer-helper.ts"),te=C("./src/utils/logger.ts");function le(Y,V){for(var M=0;M<V.length;M++){var b=V[M];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(Y,b.key,b)}}function Q(Y,V,M){return V&&le(Y.prototype,V),M&&le(Y,M),Object.defineProperty(Y,"prototype",{writable:!1}),Y}function X(Y,V){var M=typeof Symbol<"u"&&Y[Symbol.iterator]||Y["@@iterator"];if(M)return(M=M.call(Y)).next.bind(M);if(Array.isArray(Y)||(M=function(I,w){if(I){if(typeof I=="string")return ie(I,w);var P=Object.prototype.toString.call(I).slice(8,-1);return P==="Object"&&I.constructor&&(P=I.constructor.name),P==="Map"||P==="Set"?Array.from(I):P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P)?ie(I,w):void 0}}(Y))||V&&Y&&typeof Y.length=="number"){M&&(Y=M);var b=0;return function(){return b>=Y.length?{done:!0}:{done:!1,value:Y[b++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ie(Y,V){(V==null||V>Y.length)&&(V=Y.length);for(var M=0,b=new Array(V);M<V;M++)b[M]=Y[M];return b}function W(){return W=Object.assign?Object.assign.bind():function(Y){for(var V=1;V<arguments.length;V++){var M=arguments[V];for(var b in M)Object.prototype.hasOwnProperty.call(M,b)&&(Y[b]=M[b])}return Y},W.apply(this,arguments)}var se=function(){function Y(M){var b=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){b.initialized&&(b.starved=!0),b.buffering=!0},this.onPlaying=function(){b.initialized||(b.initialized=!0),b.buffering=!1},this.applyPlaylistData=function(P){try{b.apply(P,{ot:G.CMCDObjectType.MANIFEST,su:!b.initialized})}catch(_){te.logger.warn("Could not generate manifest CMCD data.",_)}},this.applyFragmentData=function(P){try{var _=P.frag,v=b.hls.levels[_.level],A=b.getObjectType(_),D={d:1e3*_.duration,ot:A};A!==G.CMCDObjectType.VIDEO&&A!==G.CMCDObjectType.AUDIO&&A!=G.CMCDObjectType.MUXED||(D.br=v.bitrate/1e3,D.tb=b.getTopBandwidth(A)/1e3,D.bl=b.getBufferLength(A)),b.apply(P,D)}catch(O){te.logger.warn("Could not generate segment CMCD data.",O)}},this.hls=M;var I=this.config=M.config,w=I.cmcd;w!=null&&(I.pLoader=this.createPlaylistLoader(),I.fLoader=this.createFragmentLoader(),this.sid=w.sessionId||Y.uuid(),this.cid=w.contentId,this.useHeaders=w.useHeaders===!0,this.registerListeners())}var V=Y.prototype;return V.registerListeners=function(){var M=this.hls;M.on(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),M.on(z.Events.MEDIA_DETACHED,this.onMediaDetached,this),M.on(z.Events.BUFFER_CREATED,this.onBufferCreated,this)},V.unregisterListeners=function(){var M=this.hls;M.off(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),M.off(z.Events.MEDIA_DETACHED,this.onMediaDetached,this),M.off(z.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},V.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},V.onMediaAttached=function(M,b){this.media=b.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},V.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},V.onBufferCreated=function(M,b){var I,w;this.audioBuffer=(I=b.tracks.audio)===null||I===void 0?void 0:I.buffer,this.videoBuffer=(w=b.tracks.video)===null||w===void 0?void 0:w.buffer},V.createData=function(){var M;return{v:G.CMCDVersion,sf:G.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(M=this.media)===null||M===void 0?void 0:M.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},V.apply=function(M,b){b===void 0&&(b={}),W(b,this.createData());var I=b.ot===G.CMCDObjectType.INIT||b.ot===G.CMCDObjectType.VIDEO||b.ot===G.CMCDObjectType.MUXED;if(this.starved&&I&&(b.bs=!0,b.su=!0,this.starved=!1),b.su==null&&(b.su=this.buffering),this.useHeaders){var w=Y.toHeaders(b);if(!Object.keys(w).length)return;M.headers||(M.headers={}),W(M.headers,w)}else{var P=Y.toQuery(b);if(!P)return;M.url=Y.appendQueryToUri(M.url,P)}},V.getObjectType=function(M){var b=M.type;return b==="subtitle"?G.CMCDObjectType.TIMED_TEXT:M.sn==="initSegment"?G.CMCDObjectType.INIT:b==="audio"?G.CMCDObjectType.AUDIO:b==="main"?this.hls.audioTracks.length?G.CMCDObjectType.VIDEO:G.CMCDObjectType.MUXED:void 0},V.getTopBandwidth=function(M){var b,I=0,w=this.hls;if(M===G.CMCDObjectType.AUDIO)b=w.audioTracks;else{var P=w.maxAutoLevel,_=P>-1?P+1:w.levels.length;b=w.levels.slice(0,_)}for(var v,A=X(b);!(v=A()).done;){var D=v.value;D.bitrate>I&&(I=D.bitrate)}return I>0?I:NaN},V.getBufferLength=function(M){var b=this.hls.media,I=M===G.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return I&&b?1e3*de.BufferHelper.bufferInfo(I,b.currentTime,this.config.maxBufferHole).len:NaN},V.createPlaylistLoader=function(){var M=this.config.pLoader,b=this.applyPlaylistData,I=M||this.config.loader;return function(){function w(_){this.loader=void 0,this.loader=new I(_)}var P=w.prototype;return P.destroy=function(){this.loader.destroy()},P.abort=function(){this.loader.abort()},P.load=function(_,v,A){b(_),this.loader.load(_,v,A)},Q(w,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),w}()},V.createFragmentLoader=function(){var M=this.config.fLoader,b=this.applyFragmentData,I=M||this.config.loader;return function(){function w(_){this.loader=void 0,this.loader=new I(_)}var P=w.prototype;return P.destroy=function(){this.loader.destroy()},P.abort=function(){this.loader.abort()},P.load=function(_,v,A){b(_),this.loader.load(_,v,A)},Q(w,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),w}()},Y.uuid=function(){var M=URL.createObjectURL(new Blob),b=M.toString();return URL.revokeObjectURL(M),b.slice(b.lastIndexOf("/")+1)},Y.serialize=function(M){for(var b,I=[],w=function(R){return!Number.isNaN(R)&&R!=null&&R!==""&&R!==!1},P=function(R){return Math.round(R)},_=function(R){return 100*P(R/100)},v={br:P,d:P,bl:_,dl:_,mtp:_,nor:function(R){return encodeURIComponent(R)},rtp:_,tb:P},A=X(Object.keys(M||{}).sort());!(b=A()).done;){var D=b.value,O=M[D];if(w(O)&&!(D==="v"&&O===1||D=="pr"&&O===1)){var K=v[D];K&&(O=K(O));var k=typeof O,L=void 0;L=D==="ot"||D==="sf"||D==="st"?D+"="+O:k==="boolean"?D:k==="number"?D+"="+O:D+"="+JSON.stringify(O),I.push(L)}}return I.join(",")},Y.toHeaders=function(M){for(var b={},I=["Object","Request","Session","Status"],w=[{},{},{},{}],P={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},_=0,v=Object.keys(M);_<v.length;_++){var A=v[_];w[P[A]!=null?P[A]:1][A]=M[A]}for(var D=0;D<w.length;D++){var O=Y.serialize(w[D]);O&&(b["CMCD-"+I[D]]=O)}return b},Y.toQuery=function(M){return"CMCD="+encodeURIComponent(Y.serialize(M))},Y.appendQueryToUri=function(M,b){if(!b)return M;var I=M.includes("?")?"&":"?";return""+M+I+b},Y}()},"./src/controller/eme-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>X});var z=C("./src/events.ts"),G=C("./src/errors.ts"),de=C("./src/utils/logger.ts"),te=C("./src/utils/mediakeys-helper.ts");function le(ie,W){for(var se=0;se<W.length;se++){var Y=W[se];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(ie,Y.key,Y)}}var Q=function(){function ie(M){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=M,this._config=M.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var W,se,Y,V=ie.prototype;return V.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},V._registerListeners=function(){this.hls.on(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(z.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(z.Events.MANIFEST_PARSED,this.onManifestParsed,this)},V._unregisterListeners=function(){this.hls.off(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(z.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(z.Events.MANIFEST_PARSED,this.onManifestParsed,this)},V.getLicenseServerUrl=function(M){switch(M){case te.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+M+'"')},V._attemptKeySystemAccess=function(M,b,I){var w=this,P=function(v,A,D,O){if(v===te.KeySystems.WIDEVINE)return function(K,k,L){var R={audioCapabilities:[],videoCapabilities:[]};return K.forEach(function(Z){R.audioCapabilities.push({contentType:'audio/mp4; codecs="'+Z+'"',robustness:L.audioRobustness||""})}),k.forEach(function(Z){R.videoCapabilities.push({contentType:'video/mp4; codecs="'+Z+'"',robustness:L.videoRobustness||""})}),[R]}(A,D,O);throw new Error("Unknown key-system: "+v)}(M,b,I,this._drmSystemOptions);de.logger.log("Requesting encrypted media key-system access");var _=this.requestMediaKeySystemAccess(M,P);this.mediaKeysPromise=_.then(function(v){return w._onMediaKeySystemAccessObtained(M,v)}),_.catch(function(v){de.logger.error('Failed to obtain key-system "'+M+'" access:',v)})},V._onMediaKeySystemAccessObtained=function(M,b){var I=this;de.logger.log('Access for key-system "'+M+'" obtained');var w={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:b,mediaKeySystemDomain:M};this._mediaKeysList.push(w);var P=Promise.resolve().then(function(){return b.createMediaKeys()}).then(function(_){return w.mediaKeys=_,de.logger.log('Media-keys created for key-system "'+M+'"'),I._onMediaKeysCreated(),_});return P.catch(function(_){de.logger.error("Failed to create media-keys:",_)}),P},V._onMediaKeysCreated=function(){var M=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),M._onNewMediaKeySession(b.mediaKeysSession))})},V._onNewMediaKeySession=function(M){var b=this;de.logger.log("New key-system session "+M.sessionId),M.addEventListener("message",function(I){b._onKeySessionMessage(M,I.message)},!1)},V._onKeySessionMessage=function(M,b){de.logger.log("Got EME message event, creating license request"),this._requestLicense(b,function(I){de.logger.log("Received license data (length: "+(I&&I.byteLength)+"), updating key-session"),M.update(I).catch(function(w){de.logger.warn("Updating key-session failed: "+w)})})},V.onMediaEncrypted=function(M){var b=this;if(de.logger.log('Media is encrypted using "'+M.initDataType+'" init data type'),!this.mediaKeysPromise)return de.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var I=function(w){b._media&&(b._attemptSetMediaKeys(w),b._generateRequestWithPreferredKeySession(M.initDataType,M.initData))};this.mediaKeysPromise.then(I).catch(I)},V._attemptSetMediaKeys=function(M){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var b=this._mediaKeysList[0];if(!b||!b.mediaKeys)return de.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});de.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(b.mediaKeys),this._hasSetMediaKeys=!0}},V._generateRequestWithPreferredKeySession=function(M,b){var I=this,w=this._mediaKeysList[0];if(!w)return de.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(w.mediaKeysSessionInitialized)de.logger.warn("Key-Session already initialized but requested again");else{var P=w.mediaKeysSession;if(!P)return de.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!b)return de.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});de.logger.log('Generating key-session request for "'+M+'" init data type'),w.mediaKeysSessionInitialized=!0,P.generateRequest(M,b).then(function(){de.logger.debug("Key-session generation succeeded")}).catch(function(_){de.logger.error("Error generating key-session request:",_),I.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},V._createLicenseXhr=function(M,b,I){var w=new XMLHttpRequest;w.responseType="arraybuffer",w.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,w,M,b,I);var P=this._licenseXhrSetup;if(P)try{P.call(this.hls,w,M),P=void 0}catch(_){de.logger.error(_)}try{w.readyState||w.open("POST",M,!0),P&&P.call(this.hls,w,M)}catch(_){throw new Error("issue setting up KeySystem license XHR "+_)}return w},V._onLicenseRequestReadyStageChange=function(M,b,I,w){if(M.readyState===4)if(M.status===200){this._requestLicenseFailureCount=0,de.logger.log("License request succeeded");var P=M.response,_=this._licenseResponseCallback;if(_)try{P=_.call(this.hls,M,b)}catch(A){de.logger.error(A)}w(P)}else{if(de.logger.error("License Request XHR failed ("+b+"). Status: "+M.status+" ("+M.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var v=3-this._requestLicenseFailureCount+1;de.logger.warn("Retrying license request, "+v+" attempts left"),this._requestLicense(I,w)}},V._generateLicenseRequestChallenge=function(M,b){if(M.mediaKeySystemDomain===te.KeySystems.WIDEVINE)return b;throw new Error("unsupported key-system: "+M.mediaKeySystemDomain)},V._requestLicense=function(M,b){de.logger.log("Requesting content license for key-system");var I=this._mediaKeysList[0];if(!I)return de.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var w=this.getLicenseServerUrl(I.mediaKeySystemDomain),P=this._createLicenseXhr(w,M,b);de.logger.log("Sending license request to URL: "+w);var _=this._generateLicenseRequestChallenge(I,M);P.send(_)}catch(v){de.logger.error("Failure requesting DRM license: "+v),this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.KEY_SYSTEM_ERROR,details:G.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},V.onMediaAttached=function(M,b){if(this._emeEnabled){var I=b.media;this._media=I,I.addEventListener("encrypted",this._onMediaEncrypted)}},V.onMediaDetached=function(){var M=this._media,b=this._mediaKeysList;M&&(M.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(b.map(function(I){if(I.mediaKeysSession)return I.mediaKeysSession.close().catch(function(){})})).then(function(){return M.setMediaKeys(null)}).catch(function(){}))},V.onManifestParsed=function(M,b){if(this._emeEnabled){var I=b.levels.map(function(P){return P.audioCodec}).filter(function(P){return!!P}),w=b.levels.map(function(P){return P.videoCodec}).filter(function(P){return!!P});this._attemptKeySystemAccess(te.KeySystems.WIDEVINE,I,w)}},W=ie,(se=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&le(W.prototype,se),Y&&le(W,Y),Object.defineProperty(W,"prototype",{writable:!1}),ie}();const X=Q},"./src/controller/fps-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>te});var z=C("./src/events.ts"),G=C("./src/utils/logger.ts"),de=function(){function le(X){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=X,this.registerListeners()}var Q=le.prototype;return Q.setStreamController=function(X){this.streamController=X},Q.registerListeners=function(){this.hls.on(z.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},Q.unregisterListeners=function(){this.hls.off(z.Events.MEDIA_ATTACHING,this.onMediaAttaching)},Q.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},Q.onMediaAttaching=function(X,ie){var W=this.hls.config;if(W.capLevelOnFPSDrop){var se=ie.media instanceof self.HTMLVideoElement?ie.media:null;this.media=se,se&&typeof se.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),W.fpsDroppedMonitoringPeriod)}},Q.checkFPS=function(X,ie,W){var se=performance.now();if(ie){if(this.lastTime){var Y=se-this.lastTime,V=W-this.lastDroppedFrames,M=ie-this.lastDecodedFrames,b=1e3*V/Y,I=this.hls;if(I.trigger(z.Events.FPS_DROP,{currentDropped:V,currentDecoded:M,totalDroppedFrames:W}),b>0&&V>I.config.fpsDroppedMonitoringThreshold*M){var w=I.currentLevel;G.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+w),w>0&&(I.autoLevelCapping===-1||I.autoLevelCapping>=w)&&(w-=1,I.trigger(z.Events.FPS_DROP_LEVEL_CAPPING,{level:w,droppedLevel:I.currentLevel}),I.autoLevelCapping=w,this.streamController.nextLevelSwitch())}}this.lastTime=se,this.lastDroppedFrames=W,this.lastDecodedFrames=ie}},Q.checkFPSInterval=function(){var X=this.media;if(X)if(this.isVideoPlaybackQualityAvailable){var ie=X.getVideoPlaybackQuality();this.checkFPS(X,ie.totalVideoFrames,ie.droppedVideoFrames)}else this.checkFPS(X,X.webkitDecodedFrameCount,X.webkitDroppedFrameCount)},le}();const te=de},"./src/controller/fragment-finders.ts":(F,re,C)=>{C.r(re),C.d(re,{findFragWithCC:()=>X,findFragmentByPDT:()=>de,findFragmentByPTS:()=>te,fragmentWithinToleranceTest:()=>le,pdtWithinToleranceTest:()=>Q});var z=C("./src/polyfills/number.ts"),G=C("./src/utils/binary-search.ts");function de(ie,W,se){if(W===null||!Array.isArray(ie)||!ie.length||!(0,z.isFiniteNumber)(W)||W<(ie[0].programDateTime||0)||W>=(ie[ie.length-1].endProgramDateTime||0))return null;se=se||0;for(var Y=0;Y<ie.length;++Y){var V=ie[Y];if(Q(W,se,V))return V}return null}function te(ie,W,se,Y){se===void 0&&(se=0),Y===void 0&&(Y=0);var V=null;if(ie?V=W[ie.sn-W[0].sn+1]||null:se===0&&W[0].start===0&&(V=W[0]),V&&le(se,Y,V)===0)return V;var M=G.default.search(W,le.bind(null,se,Y));return M||V}function le(ie,W,se){ie===void 0&&(ie=0),W===void 0&&(W=0);var Y=Math.min(W,se.duration+(se.deltaPTS?se.deltaPTS:0));return se.start+se.duration-Y<=ie?1:se.start-Y>ie&&se.start?-1:0}function Q(ie,W,se){var Y=1e3*Math.min(W,se.duration+(se.deltaPTS?se.deltaPTS:0));return(se.endProgramDateTime||0)-Y>ie}function X(ie,W){return G.default.search(ie,function(se){return se.cc<W?1:se.cc>W?-1:0})}},"./src/controller/fragment-tracker.ts":(F,re,C)=>{C.r(re),C.d(re,{FragmentState:()=>z,FragmentTracker:()=>te});var z,G=C("./src/events.ts"),de=C("./src/types/loader.ts");(function(X){X.NOT_LOADED="NOT_LOADED",X.APPENDING="APPENDING",X.PARTIAL="PARTIAL",X.OK="OK"})(z||(z={}));var te=function(){function X(W){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=W,this._registerListeners()}var ie=X.prototype;return ie._registerListeners=function(){var W=this.hls;W.on(G.Events.BUFFER_APPENDED,this.onBufferAppended,this),W.on(G.Events.FRAG_BUFFERED,this.onFragBuffered,this),W.on(G.Events.FRAG_LOADED,this.onFragLoaded,this)},ie._unregisterListeners=function(){var W=this.hls;W.off(G.Events.BUFFER_APPENDED,this.onBufferAppended,this),W.off(G.Events.FRAG_BUFFERED,this.onFragBuffered,this),W.off(G.Events.FRAG_LOADED,this.onFragLoaded,this)},ie.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},ie.getAppendedFrag=function(W,se){if(se===de.PlaylistLevelType.MAIN){var Y=this.activeFragment,V=this.activeParts;if(!Y)return null;if(V)for(var M=V.length;M--;){var b=V[M],I=b?b.end:Y.appendedPTS;if(b.start<=W&&I!==void 0&&W<=I)return M>9&&(this.activeParts=V.slice(M-9)),b}else if(Y.start<=W&&Y.appendedPTS!==void 0&&W<=Y.appendedPTS)return Y}return this.getBufferedFrag(W,se)},ie.getBufferedFrag=function(W,se){for(var Y=this.fragments,V=Object.keys(Y),M=V.length;M--;){var b=Y[V[M]];if(b?.body.type===se&&b.buffered){var I=b.body;if(I.start<=W&&W<=I.end)return I}}return null},ie.detectEvictedFragments=function(W,se,Y){var V=this;Object.keys(this.fragments).forEach(function(M){var b=V.fragments[M];if(b)if(b.buffered){var I=b.range[W];I&&I.time.some(function(w){var P=!V.isTimeBuffered(w.startPTS,w.endPTS,se);return P&&V.removeFragment(b.body),P})}else b.body.type===Y&&V.removeFragment(b.body)})},ie.detectPartialFragments=function(W){var se=this,Y=this.timeRanges,V=W.frag,M=W.part;if(Y&&V.sn!=="initSegment"){var b=Q(V),I=this.fragments[b];I&&(Object.keys(Y).forEach(function(w){var P=V.elementaryStreams[w];if(P){var _=Y[w],v=M!==null||P.partial===!0;I.range[w]=se.getBufferedTimes(V,M,v,_)}}),I.loaded=null,Object.keys(I.range).length?I.buffered=!0:this.removeFragment(I.body))}},ie.fragBuffered=function(W){var se=Q(W),Y=this.fragments[se];Y&&(Y.loaded=null,Y.buffered=!0)},ie.getBufferedTimes=function(W,se,Y,V){for(var M={time:[],partial:Y},b=se?se.start:W.start,I=se?se.end:W.end,w=W.minEndPTS||I,P=W.maxStartPTS||b,_=0;_<V.length;_++){var v=V.start(_)-this.bufferPadding,A=V.end(_)+this.bufferPadding;if(P>=v&&w<=A){M.time.push({startPTS:Math.max(b,V.start(_)),endPTS:Math.min(I,V.end(_))});break}if(b<A&&I>v)M.partial=!0,M.time.push({startPTS:Math.max(b,V.start(_)),endPTS:Math.min(I,V.end(_))});else if(I<=v)break}return M},ie.getPartialFragment=function(W){var se,Y,V,M=null,b=0,I=this.bufferPadding,w=this.fragments;return Object.keys(w).forEach(function(P){var _=w[P];_&&le(_)&&(Y=_.body.start-I,V=_.body.end+I,W>=Y&&W<=V&&(se=Math.min(W-Y,V-W),b<=se&&(M=_.body,b=se)))}),M},ie.getState=function(W){var se=Q(W),Y=this.fragments[se];return Y?Y.buffered?le(Y)?z.PARTIAL:z.OK:z.APPENDING:z.NOT_LOADED},ie.isTimeBuffered=function(W,se,Y){for(var V,M,b=0;b<Y.length;b++){if(V=Y.start(b)-this.bufferPadding,M=Y.end(b)+this.bufferPadding,W>=V&&se<=M)return!0;if(se<=V)return!1}return!1},ie.onFragLoaded=function(W,se){var Y=se.frag,V=se.part;if(Y.sn!=="initSegment"&&!Y.bitrateTest&&!V){var M=Q(Y);this.fragments[M]={body:Y,loaded:se,buffered:!1,range:Object.create(null)}}},ie.onBufferAppended=function(W,se){var Y=this,V=se.frag,M=se.part,b=se.timeRanges;if(V.type===de.PlaylistLevelType.MAIN)if(this.activeFragment=V,M){var I=this.activeParts;I||(this.activeParts=I=[]),I.push(M)}else this.activeParts=null;this.timeRanges=b,Object.keys(b).forEach(function(w){var P=b[w];if(Y.detectEvictedFragments(w,P),!M)for(var _=0;_<P.length;_++)V.appendedPTS=Math.max(P.end(_),V.appendedPTS||0)})},ie.onFragBuffered=function(W,se){this.detectPartialFragments(se)},ie.hasFragment=function(W){var se=Q(W);return!!this.fragments[se]},ie.removeFragmentsInRange=function(W,se,Y){var V=this;Object.keys(this.fragments).forEach(function(M){var b=V.fragments[M];if(b&&b.buffered){var I=b.body;I.type===Y&&I.start<se&&I.end>W&&V.removeFragment(I)}})},ie.removeFragment=function(W){var se=Q(W);W.stats.loaded=0,W.clearElementaryStreamInfo(),delete this.fragments[se]},ie.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},X}();function le(X){var ie,W;return X.buffered&&(((ie=X.range.video)===null||ie===void 0?void 0:ie.partial)||((W=X.range.audio)===null||W===void 0?void 0:W.partial))}function Q(X){return X.type+"_"+X.level+"_"+X.urlId+"_"+X.sn}},"./src/controller/gap-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{MAX_START_GAP_JUMP:()=>Q,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>X,SKIP_BUFFER_RANGE_START:()=>ie,STALL_MINIMUM_DURATION_MS:()=>le,default:()=>W});var z=C("./src/utils/buffer-helper.ts"),G=C("./src/errors.ts"),de=C("./src/events.ts"),te=C("./src/utils/logger.ts"),le=250,Q=2,X=.1,ie=.05,W=function(){function se(V,M,b,I){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=V,this.media=M,this.fragmentTracker=b,this.hls=I}var Y=se.prototype;return Y.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},Y.poll=function(V,M){var b=this.config,I=this.media,w=this.stalled;if(I!==null){var P=I.currentTime,_=I.seeking,v=this.seeking&&!_,A=!this.seeking&&_;if(this.seeking=_,P===V){if((A||v)&&(this.stalled=null),!(I.paused&&!_||I.ended||I.playbackRate===0)&&z.BufferHelper.getBuffered(I).length){var D=z.BufferHelper.bufferInfo(I,P,0),O=D.len>0,K=D.nextStart||0;if(O||K){if(_){var k=D.len>Q,L=!K||M&&M.start<=P||K-P>Q&&!this.fragmentTracker.getPartialFragment(P);if(k||L)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var R,Z=Math.max(K,D.start||0)-P,ae=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,fe=!(ae==null||(R=ae.details)===null||R===void 0)&&R.live?2*ae.details.targetduration:Q;if(Z>0&&Z<=fe)return void this._trySkipBufferHole(null)}var ce=self.performance.now();if(w!==null){var me=ce-w;if(_||!(me>=le)||(this._reportStall(D),this.media)){var Ee=z.BufferHelper.bufferInfo(I,P,b.maxBufferHole);this._tryFixBufferStall(Ee,me)}}else this.stalled=ce}}}else if(this.moved=!0,w!==null){if(this.stallReported){var be=self.performance.now()-w;te.logger.warn("playback not stuck anymore @"+P+", after "+Math.round(be)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},Y._tryFixBufferStall=function(V,M){var b=this.config,I=this.fragmentTracker,w=this.media;if(w!==null){var P=w.currentTime,_=I.getPartialFragment(P);if(_&&(this._trySkipBufferHole(_)||!this.media))return;V.len>b.maxBufferHole&&M>1e3*b.highBufferWatchdogPeriod&&(te.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},Y._reportStall=function(V){var M=this.hls,b=this.media;!this.stallReported&&b&&(this.stallReported=!0,te.logger.warn("Playback stalling at @"+b.currentTime+" due to low buffer ("+JSON.stringify(V)+")"),M.trigger(de.Events.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:V.len}))},Y._trySkipBufferHole=function(V){var M=this.config,b=this.hls,I=this.media;if(I===null)return 0;for(var w=I.currentTime,P=0,_=z.BufferHelper.getBuffered(I),v=0;v<_.length;v++){var A=_.start(v);if(w+M.maxBufferHole>=P&&w<A){var D=Math.max(A+ie,I.currentTime+X);return te.logger.warn("skipping hole, adjusting currentTime from "+w+" to "+D),this.moved=!0,this.stalled=null,I.currentTime=D,V&&b.trigger(de.Events.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+w+" to "+D,frag:V}),D}P=_.end(v)}return 0},Y._tryNudgeBuffer=function(){var V=this.config,M=this.hls,b=this.media,I=this.nudgeRetry;if(b!==null){var w=b.currentTime;if(this.nudgeRetry++,I<V.nudgeMaxRetry){var P=w+(I+1)*V.nudgeOffset;te.logger.warn("Nudging 'currentTime' from "+w+" to "+P),b.currentTime=P,M.trigger(de.Events.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else te.logger.error("Playhead still not moving while enough data buffered @"+w+" after "+V.nudgeMaxRetry+" nudges"),M.trigger(de.Events.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},se}()},"./src/controller/id3-track-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>Y});var z=C("./src/polyfills/number.ts"),G=C("./src/events.ts"),de=C("./src/utils/texttrack-utils.ts"),te=C("./src/demux/id3.ts"),le=C("./src/loader/date-range.ts"),Q=C("./src/types/demuxer.ts");function X(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var ie=function(){var V=X();try{new V(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function W(V,M){return V.getTime()/1e3-M}var se=function(){function V(b){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=b,this._registerListeners()}var M=V.prototype;return M.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},M._registerListeners=function(){var b=this.hls;b.on(G.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.on(G.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(G.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(G.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),b.on(G.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),b.on(G.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},M._unregisterListeners=function(){var b=this.hls;b.off(G.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.off(G.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(G.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(G.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),b.off(G.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),b.off(G.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},M.onMediaAttached=function(b,I){this.media=I.media},M.onMediaDetaching=function(){this.id3Track&&((0,de.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},M.onManifestLoading=function(){this.dateRangeCuesAppended={}},M.createTrack=function(b){var I=this.getID3Track(b.textTracks);return I.mode="hidden",I},M.getID3Track=function(b){if(this.media){for(var I=0;I<b.length;I++){var w=b[I];if(w.kind==="metadata"&&w.label==="id3")return(0,de.sendAddTrackEvent)(w,this.media),w}return this.media.addTextTrack("metadata","id3")}},M.onFragParsingMetadata=function(b,I){if(this.media){var w=this.hls.config,P=w.enableEmsgMetadataCues,_=w.enableID3MetadataCues;if(P||_){I.frag;var v=I.samples;I.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var A=X(),D=0;D<v.length;D++){var O=v[D].type;if((O!==Q.MetadataSchema.emsg||P)&&_){var K=te.getID3Frames(v[D].data);if(K){var k=v[D].pts,L=k+v[D].duration;L>ie&&(L=ie),L-k<=0&&(L=k+.25);for(var R=0;R<K.length;R++){var Z=K[R];if(!te.isTimeStampFrame(Z)){this.updateId3CueEnds(k);var ae=new A(k,L,"");ae.value=Z,O&&(ae.type=O),this.id3Track.addCue(ae)}}}}}}}},M.updateId3CueEnds=function(b){var I,w=(I=this.id3Track)===null||I===void 0?void 0:I.cues;if(w)for(var P=w.length;P--;){var _=w[P];_.startTime<b&&_.endTime===ie&&(_.endTime=b)}},M.onBufferFlushing=function(b,I){var w=I.startOffset,P=I.endOffset,_=I.type,v=this.id3Track,A=this.hls;if(A){var D,O=A.config,K=O.enableEmsgMetadataCues,k=O.enableID3MetadataCues;v&&(K||k)&&(D=_==="audio"?function(L){return L.type===Q.MetadataSchema.audioId3&&k}:_==="video"?function(L){return L.type===Q.MetadataSchema.emsg&&K}:function(L){return L.type===Q.MetadataSchema.audioId3&&k||L.type===Q.MetadataSchema.emsg&&K},(0,de.removeCuesInRange)(v,w,P,D))}},M.onLevelUpdated=function(b,I){var w=this,P=I.details;if(this.media&&P.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var _=this.dateRangeCuesAppended,v=this.id3Track,A=P.dateRanges,D=Object.keys(A);if(v)for(var O=Object.keys(_).filter(function(ce){return!D.includes(ce)}),K=function(ce){var me=O[ce];Object.keys(_[me].cues).forEach(function(Ee){v.removeCue(_[me].cues[Ee])}),delete _[me]},k=O.length;k--;)K(k);var L=P.fragments[P.fragments.length-1];if(D.length!==0&&(0,z.isFiniteNumber)(L?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var R=L.programDateTime/1e3-L.start,Z=X(),ae=function(ce){var me=D[ce],Ee=A[me],be=_[me],Re=be?.cues||{},Ce=be?.durationKnown||!1,Ne=W(Ee.startDate,R),Ue=ie,Xe=Ee.endDate;if(Xe)Ue=W(Xe,R),Ce=!0;else if(Ee.endOnNext&&!Ce){var ut=D.reduce(function(Ke,nt){var vt=A[nt];return vt.class===Ee.class&&vt.id!==nt&&vt.startDate>Ee.startDate&&Ke.push(vt),Ke},[]).sort(function(Ke,nt){return Ke.startDate.getTime()-nt.startDate.getTime()})[0];ut&&(Ue=W(ut.startDate,R),Ce=!0)}for(var gt,ft=Object.keys(Ee.attr),St=0;St<ft.length;St++){var Et=ft[St];if(Et!==le.DateRangeAttribute.ID&&Et!==le.DateRangeAttribute.CLASS&&Et!==le.DateRangeAttribute.START_DATE&&Et!==le.DateRangeAttribute.DURATION&&Et!==le.DateRangeAttribute.END_DATE&&Et!==le.DateRangeAttribute.END_ON_NEXT){var ve=Re[Et];if(ve)Ce&&!be.durationKnown&&(ve.endTime=Ue);else{var Oe=Ee.attr[Et];ve=new Z(Ne,Ue,""),Et!==le.DateRangeAttribute.SCTE35_OUT&&Et!==le.DateRangeAttribute.SCTE35_IN||(gt=Oe,Oe=Uint8Array.from(gt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),ve.value={key:Et,data:Oe},ve.type=Q.MetadataSchema.dateRange,w.id3Track.addCue(ve),Re[Et]=ve}}}_[me]={cues:Re,dateRange:Ee,durationKnown:Ce}},fe=0;fe<D.length;fe++)ae(fe)}}},V}();const Y=se},"./src/controller/latency-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>le});var z=C("./src/errors.ts"),G=C("./src/events.ts"),de=C("./src/utils/logger.ts");function te(Q,X){for(var ie=0;ie<X.length;ie++){var W=X[ie];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(Q,W.key,W)}}var le=function(){function Q(Y){var V=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return V.timeupdate()},this.hls=Y,this.config=Y.config,this.registerListeners()}var X,ie,W,se=Q.prototype;return se.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},se.registerListeners=function(){this.hls.on(G.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(G.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(G.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(G.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(G.Events.ERROR,this.onError,this)},se.unregisterListeners=function(){this.hls.off(G.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(G.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(G.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(G.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(G.Events.ERROR,this.onError)},se.onMediaAttached=function(Y,V){this.media=V.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},se.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},se.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},se.onLevelUpdated=function(Y,V){var M=V.details;this.levelDetails=M,M.advanced&&this.timeupdate(),!M.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},se.onError=function(Y,V){V.details===z.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,de.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},se.timeupdate=function(){var Y=this.media,V=this.levelDetails;if(Y&&V){this.currentTime=Y.currentTime;var M=this.computeLatency();if(M!==null){this._latency=M;var b=this.config,I=b.lowLatencyMode,w=b.maxLiveSyncPlaybackRate;if(I&&w!==1){var P=this.targetLatency;if(P!==null){var _=M-P,v=_<Math.min(this.maxLatency,P+V.targetduration);if(V.live&&v&&_>.05&&this.forwardBufferLength>1){var A=Math.min(2,Math.max(1,w)),D=Math.round(2/(1+Math.exp(-.75*_-this.edgeStalled))*20)/20;Y.playbackRate=Math.min(A,Math.max(1,D))}else Y.playbackRate!==1&&Y.playbackRate!==0&&(Y.playbackRate=1)}}}}},se.estimateLiveEdge=function(){var Y=this.levelDetails;return Y===null?null:Y.edge+Y.age},se.computeLatency=function(){var Y=this.estimateLiveEdge();return Y===null?null:Y-this.currentTime},X=Q,(ie=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var Y=this.config,V=this.levelDetails;return Y.liveMaxLatencyDuration!==void 0?Y.liveMaxLatencyDuration:V?Y.liveMaxLatencyDurationCount*V.targetduration:0}},{key:"targetLatency",get:function(){var Y=this.levelDetails;if(Y===null)return null;var V=Y.holdBack,M=Y.partHoldBack,b=Y.targetduration,I=this.config,w=I.liveSyncDuration,P=I.liveSyncDurationCount,_=I.lowLatencyMode,v=this.hls.userConfig,A=_&&M||V;(v.liveSyncDuration||v.liveSyncDurationCount||A===0)&&(A=w!==void 0?w:P*b);var D=b;return A+Math.min(1*this.stallCount,D)}},{key:"liveSyncPosition",get:function(){var Y=this.estimateLiveEdge(),V=this.targetLatency,M=this.levelDetails;if(Y===null||V===null||M===null)return null;var b=M.edge,I=Y-V-this.edgeStalled,w=b-M.totalduration,P=b-(this.config.lowLatencyMode&&M.partTarget||M.targetduration);return Math.min(Math.max(w,I),P)}},{key:"drift",get:function(){var Y=this.levelDetails;return Y===null?1:Y.drift}},{key:"edgeStalled",get:function(){var Y=this.levelDetails;if(Y===null)return 0;var V=3*(this.config.lowLatencyMode&&Y.partTarget||Y.targetduration);return Math.max(Y.age-V,0)}},{key:"forwardBufferLength",get:function(){var Y=this.media,V=this.levelDetails;if(!Y||!V)return 0;var M=Y.buffered.length;return(M?Y.buffered.end(M-1):V.edge)-this.currentTime}}])&&te(X.prototype,ie),W&&te(X,W),Object.defineProperty(X,"prototype",{writable:!1}),Q}()},"./src/controller/level-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>V});var z=C("./src/types/level.ts"),G=C("./src/events.ts"),de=C("./src/errors.ts"),te=C("./src/utils/codecs.ts"),le=C("./src/controller/level-helper.ts"),Q=C("./src/controller/base-playlist-controller.ts"),X=C("./src/types/loader.ts");function ie(){return ie=Object.assign?Object.assign.bind():function(M){for(var b=1;b<arguments.length;b++){var I=arguments[b];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(M[w]=I[w])}return M},ie.apply(this,arguments)}function W(M,b){for(var I=0;I<b.length;I++){var w=b[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(M,w.key,w)}}function se(M,b){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(I,w){return I.__proto__=w,I},se(M,b)}var Y=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),V=function(M){var b,I;function w(D){var O;return(O=M.call(this,D,"[level-controller]")||this)._levels=[],O._firstLevel=-1,O._startLevel=void 0,O.currentLevelIndex=-1,O.manualLevelIndex=-1,O.onParsedComplete=void 0,O._registerListeners(),O}I=M,(b=w).prototype=Object.create(I.prototype),b.prototype.constructor=b,se(b,I);var P,_,v,A=w.prototype;return A._registerListeners=function(){var D=this.hls;D.on(G.Events.MANIFEST_LOADED,this.onManifestLoaded,this),D.on(G.Events.LEVEL_LOADED,this.onLevelLoaded,this),D.on(G.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),D.on(G.Events.FRAG_LOADED,this.onFragLoaded,this),D.on(G.Events.ERROR,this.onError,this)},A._unregisterListeners=function(){var D=this.hls;D.off(G.Events.MANIFEST_LOADED,this.onManifestLoaded,this),D.off(G.Events.LEVEL_LOADED,this.onLevelLoaded,this),D.off(G.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),D.off(G.Events.FRAG_LOADED,this.onFragLoaded,this),D.off(G.Events.ERROR,this.onError,this)},A.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,M.prototype.destroy.call(this)},A.startLoad=function(){this._levels.forEach(function(D){D.loadError=0}),M.prototype.startLoad.call(this)},A.onManifestLoaded=function(D,O){var K,k,L=[],R=[],Z=[],ae={},fe=!1,ce=!1,me=!1;if(O.levels.forEach(function(Ce){var Ne=Ce.attrs;fe=fe||!(!Ce.width||!Ce.height),ce=ce||!!Ce.videoCodec,me=me||!!Ce.audioCodec,Y&&Ce.audioCodec&&Ce.audioCodec.indexOf("mp4a.40.34")!==-1&&(Ce.audioCodec=void 0);var Ue=Ce.bitrate+"-"+Ce.attrs.RESOLUTION+"-"+Ce.attrs.CODECS;(k=ae[Ue])?k.url.push(Ce.url):(k=new z.Level(Ce),ae[Ue]=k,L.push(k)),Ne&&(Ne.AUDIO&&(0,le.addGroupId)(k,"audio",Ne.AUDIO),Ne.SUBTITLES&&(0,le.addGroupId)(k,"text",Ne.SUBTITLES))}),(fe||ce)&&me&&(L=L.filter(function(Ce){var Ne=Ce.videoCodec,Ue=Ce.width,Xe=Ce.height;return!!Ne||!(!Ue||!Xe)})),L=L.filter(function(Ce){var Ne=Ce.audioCodec,Ue=Ce.videoCodec;return(!Ne||(0,te.isCodecSupportedInMp4)(Ne,"audio"))&&(!Ue||(0,te.isCodecSupportedInMp4)(Ue,"video"))}),O.audioTracks&&(R=O.audioTracks.filter(function(Ce){return!Ce.audioCodec||(0,te.isCodecSupportedInMp4)(Ce.audioCodec,"audio")}),(0,le.assignTrackIdsByGroup)(R)),O.subtitles&&(Z=O.subtitles,(0,le.assignTrackIdsByGroup)(Z)),L.length>0){K=L[0].bitrate,L.sort(function(Ce,Ne){return Ce.bitrate-Ne.bitrate}),this._levels=L;for(var Ee=0;Ee<L.length;Ee++)if(L[Ee].bitrate===K){this._firstLevel=Ee,this.log("manifest loaded, "+L.length+" level(s) found, first bitrate: "+K);break}var be=me&&!ce,Re={levels:L,audioTracks:R,subtitleTracks:Z,firstLevel:this._firstLevel,stats:O.stats,audio:me,video:ce,altAudio:!be&&R.some(function(Ce){return!!Ce.url})};this.hls.trigger(G.Events.MANIFEST_PARSED,Re),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(G.Events.ERROR,{type:de.ErrorTypes.MEDIA_ERROR,details:de.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:O.url,reason:"no level with compatible codecs found in manifest"})},A.onError=function(D,O){var K;if(M.prototype.onError.call(this,D,O),!O.fatal){var k=O.context,L=this._levels[this.currentLevelIndex];if(k&&(k.type===X.PlaylistContextType.AUDIO_TRACK&&L.audioGroupIds&&k.groupId===L.audioGroupIds[L.urlId]||k.type===X.PlaylistContextType.SUBTITLE_TRACK&&L.textGroupIds&&k.groupId===L.textGroupIds[L.urlId]))this.redundantFailover(this.currentLevelIndex);else{var R,Z=!1,ae=!0;switch(O.details){case de.ErrorDetails.FRAG_LOAD_ERROR:case de.ErrorDetails.FRAG_LOAD_TIMEOUT:case de.ErrorDetails.KEY_LOAD_ERROR:case de.ErrorDetails.KEY_LOAD_TIMEOUT:if(O.frag){var fe=O.frag.type===X.PlaylistLevelType.MAIN?O.frag.level:this.currentLevelIndex,ce=this._levels[fe];ce?(ce.fragmentError++,ce.fragmentError>this.hls.config.fragLoadingMaxRetry&&(R=fe)):R=fe}break;case de.ErrorDetails.LEVEL_LOAD_ERROR:case de.ErrorDetails.LEVEL_LOAD_TIMEOUT:k&&(k.deliveryDirectives&&(ae=!1),R=k.level),Z=!0;break;case de.ErrorDetails.REMUX_ALLOC_ERROR:R=(K=O.level)!=null?K:this.currentLevelIndex,Z=!0}R!==void 0&&this.recoverLevel(O,R,Z,ae)}}},A.recoverLevel=function(D,O,K,k){var L=D.details,R=this._levels[O];if(R.loadError++,K){if(!this.retryLoadingOrFail(D))return void(this.currentLevelIndex=-1);D.levelRetry=!0}if(k){var Z=R.url.length;if(Z>1&&R.loadError<Z)D.levelRetry=!0,this.redundantFailover(O);else if(this.manualLevelIndex===-1){for(var ae=-1,fe=this._levels,ce=fe.length;ce--;){var me=(ce+this.currentLevelIndex)%fe.length;if(me!==this.currentLevelIndex&&fe[me].loadError===0){ae=me;break}}ae>-1&&this.currentLevelIndex!==ae&&(this.warn(L+": switch to "+ae),D.levelRetry=!0,this.hls.nextAutoLevel=ae)}}},A.redundantFailover=function(D){var O=this._levels[D],K=O.url.length;if(K>1){var k=(O.urlId+1)%K;this.warn("Switching to redundant URL-id "+k),this._levels.forEach(function(L){L.urlId=k}),this.level=D}},A.onFragLoaded=function(D,O){var K=O.frag;if(K!==void 0&&K.type===X.PlaylistLevelType.MAIN){var k=this._levels[K.level];k!==void 0&&(k.fragmentError=0,k.loadError=0)}},A.onLevelLoaded=function(D,O){var K,k,L=O.level,R=O.details,Z=this._levels[L];if(!Z)return this.warn("Invalid level index "+L),void((k=O.deliveryDirectives)!==null&&k!==void 0&&k.skip&&(R.deltaUpdateFailed=!0));L===this.currentLevelIndex?(Z.fragmentError===0&&(Z.loadError=0,this.retryCount=0),this.playlistLoaded(L,O,Z.details)):(K=O.deliveryDirectives)!==null&&K!==void 0&&K.skip&&(R.deltaUpdateFailed=!0)},A.onAudioTrackSwitched=function(D,O){var K=this.hls.levels[this.currentLevelIndex];if(K&&K.audioGroupIds){for(var k=-1,L=this.hls.audioTracks[O.id].groupId,R=0;R<K.audioGroupIds.length;R++)if(K.audioGroupIds[R]===L){k=R;break}k!==K.urlId&&(K.urlId=k,this.startLoad())}},A.loadPlaylist=function(D){var O=this.currentLevelIndex,K=this._levels[O];if(this.canLoad&&K&&K.url.length>0){var k=K.urlId,L=K.url[k];if(D)try{L=D.addDirectives(L)}catch(R){this.warn("Could not construct new URL with HLS Delivery Directives: "+R)}this.log("Attempt loading level index "+O+(D?" at sn "+D.msn+" part "+D.part:"")+" with URL-id "+k+" "+L),this.clearTimer(),this.hls.trigger(G.Events.LEVEL_LOADING,{url:L,level:O,id:k,deliveryDirectives:D||null})}},A.removeLevel=function(D,O){var K=function(L,R){return R!==O},k=this._levels.filter(function(L,R){return R!==D||L.url.length>1&&O!==void 0&&(L.url=L.url.filter(K),L.audioGroupIds&&(L.audioGroupIds=L.audioGroupIds.filter(K)),L.textGroupIds&&(L.textGroupIds=L.textGroupIds.filter(K)),L.urlId=0,!0)}).map(function(L,R){var Z=L.details;return Z!=null&&Z.fragments&&Z.fragments.forEach(function(ae){ae.level=R}),L});this._levels=k,this.hls.trigger(G.Events.LEVELS_UPDATED,{levels:k})},P=w,(_=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(D){var O,K=this._levels;if(K.length!==0&&(this.currentLevelIndex!==D||(O=K[D])===null||O===void 0||!O.details)){if(D<0||D>=K.length){var k=D<0;if(this.hls.trigger(G.Events.ERROR,{type:de.ErrorTypes.OTHER_ERROR,details:de.ErrorDetails.LEVEL_SWITCH_ERROR,level:D,fatal:k,reason:"invalid level idx"}),k)return;D=Math.min(D,K.length-1)}this.clearTimer();var L=this.currentLevelIndex,R=K[L],Z=K[D];this.log("switching to level "+D+" from "+L),this.currentLevelIndex=D;var ae=ie({},Z,{level:D,maxBitrate:Z.maxBitrate,uri:Z.uri,urlId:Z.urlId});delete ae._urlId,this.hls.trigger(G.Events.LEVEL_SWITCHING,ae);var fe=Z.details;if(!fe||fe.live){var ce=this.switchParams(Z.uri,R?.details);this.loadPlaylist(ce)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(D){this.manualLevelIndex=D,this._startLevel===void 0&&(this._startLevel=D),D!==-1&&(this.level=D)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(D){this._firstLevel=D}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var D=this.hls.config.startLevel;return D!==void 0?D:this._firstLevel}return this._startLevel},set:function(D){this._startLevel=D}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(D){this.level=D,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=D)}}])&&W(P.prototype,_),v&&W(P,v),Object.defineProperty(P,"prototype",{writable:!1}),w}(Q.default)},"./src/controller/level-helper.ts":(F,re,C)=>{C.r(re),C.d(re,{addGroupId:()=>le,addSliding:()=>b,adjustSliding:()=>M,assignTrackIdsByGroup:()=>Q,computeReloadInterval:()=>I,getFragmentWithSN:()=>w,getPartWith:()=>P,mapFragmentIntersection:()=>V,mapPartIntersection:()=>Y,mergeDetails:()=>se,updateFragPTSDTS:()=>W,updatePTS:()=>X});var z=C("./src/polyfills/number.ts"),G=C("./src/utils/logger.ts"),de=C("./src/loader/date-range.ts");function te(){return te=Object.assign?Object.assign.bind():function(_){for(var v=1;v<arguments.length;v++){var A=arguments[v];for(var D in A)Object.prototype.hasOwnProperty.call(A,D)&&(_[D]=A[D])}return _},te.apply(this,arguments)}function le(_,v,A){switch(v){case"audio":_.audioGroupIds||(_.audioGroupIds=[]),_.audioGroupIds.push(A);break;case"text":_.textGroupIds||(_.textGroupIds=[]),_.textGroupIds.push(A)}}function Q(_){var v={};_.forEach(function(A){var D=A.groupId||"";A.id=v[D]=v[D]||0,v[D]++})}function X(_,v,A){ie(_[v],_[A])}function ie(_,v){var A=v.startPTS;if((0,z.isFiniteNumber)(A)){var D,O=0;v.sn>_.sn?(O=A-_.start,D=_):(O=_.start-A,D=v),D.duration!==O&&(D.duration=O)}else v.sn>_.sn?_.cc===v.cc&&_.minEndPTS?v.start=_.start+(_.minEndPTS-_.start):v.start=_.start+_.duration:v.start=Math.max(_.start-v.duration,0)}function W(_,v,A,D,O,K){D-A<=0&&(G.logger.warn("Fragment should have a positive duration",v),D=A+v.duration,K=O+v.duration);var k=A,L=D,R=v.startPTS,Z=v.endPTS;if((0,z.isFiniteNumber)(R)){var ae=Math.abs(R-A);(0,z.isFiniteNumber)(v.deltaPTS)?v.deltaPTS=Math.max(ae,v.deltaPTS):v.deltaPTS=ae,k=Math.max(A,R),A=Math.min(A,R),O=Math.min(O,v.startDTS),L=Math.min(D,Z),D=Math.max(D,Z),K=Math.max(K,v.endDTS)}v.duration=D-A;var fe=A-v.start;v.appendedPTS=D,v.start=v.startPTS=A,v.maxStartPTS=k,v.startDTS=O,v.endPTS=D,v.minEndPTS=L,v.endDTS=K;var ce,me=v.sn;if(!_||me<_.startSN||me>_.endSN)return 0;var Ee=me-_.startSN,be=_.fragments;for(be[Ee]=v,ce=Ee;ce>0;ce--)ie(be[ce],be[ce-1]);for(ce=Ee;ce<be.length-1;ce++)ie(be[ce],be[ce+1]);return _.fragmentHint&&ie(be[be.length-1],_.fragmentHint),_.PTSKnown=_.alignedSliding=!0,fe}function se(_,v){for(var A=null,D=_.fragments,O=D.length-1;O>=0;O--){var K=D[O].initSegment;if(K){A=K;break}}_.fragmentHint&&delete _.fragmentHint.endPTS;var k,L,R,Z,ae,fe=0;if(V(_,v,function(Ce,Ne){Ce.relurl&&(fe=Ce.cc-Ne.cc),(0,z.isFiniteNumber)(Ce.startPTS)&&(0,z.isFiniteNumber)(Ce.endPTS)&&(Ne.start=Ne.startPTS=Ce.startPTS,Ne.startDTS=Ce.startDTS,Ne.appendedPTS=Ce.appendedPTS,Ne.maxStartPTS=Ce.maxStartPTS,Ne.endPTS=Ce.endPTS,Ne.endDTS=Ce.endDTS,Ne.minEndPTS=Ce.minEndPTS,Ne.duration=Ce.endPTS-Ce.startPTS,Ne.duration&&(k=Ne),v.PTSKnown=v.alignedSliding=!0),Ne.elementaryStreams=Ce.elementaryStreams,Ne.loader=Ce.loader,Ne.stats=Ce.stats,Ne.urlId=Ce.urlId,Ce.initSegment&&(Ne.initSegment=Ce.initSegment,A=Ce.initSegment)}),A&&(v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments).forEach(function(Ce){var Ne;Ce.initSegment&&Ce.initSegment.relurl!==((Ne=A)===null||Ne===void 0?void 0:Ne.relurl)||(Ce.initSegment=A)}),v.skippedSegments)if(v.deltaUpdateFailed=v.fragments.some(function(Ce){return!Ce}),v.deltaUpdateFailed){G.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var ce=v.skippedSegments;ce--;)v.fragments.shift();v.startSN=v.fragments[0].sn,v.startCC=v.fragments[0].cc}else v.canSkipDateRanges&&(v.dateRanges=(L=_.dateRanges,R=v.dateRanges,Z=v.recentlyRemovedDateranges,ae=te({},L),Z&&Z.forEach(function(Ce){delete ae[Ce]}),Object.keys(R).forEach(function(Ce){var Ne=new de.DateRange(R[Ce].attr,ae[Ce]);Ne.isValid?ae[Ce]=Ne:G.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(R[Ce].attr)+'"')}),ae));var me=v.fragments;if(fe){G.logger.warn("discontinuity sliding from playlist, take drift into account");for(var Ee=0;Ee<me.length;Ee++)me[Ee].cc+=fe}v.skippedSegments&&(v.startCC=v.fragments[0].cc),Y(_.partList,v.partList,function(Ce,Ne){Ne.elementaryStreams=Ce.elementaryStreams,Ne.stats=Ce.stats}),k?W(v,k,k.startPTS,k.endPTS,k.startDTS,k.endDTS):M(_,v),me.length&&(v.totalduration=v.edge-me[0].start),v.driftStartTime=_.driftStartTime,v.driftStart=_.driftStart;var be=v.advancedDateTime;if(v.advanced&&be){var Re=v.edge;v.driftStart||(v.driftStartTime=be,v.driftStart=Re),v.driftEndTime=be,v.driftEnd=Re}else v.driftEndTime=_.driftEndTime,v.driftEnd=_.driftEnd,v.advancedDateTime=_.advancedDateTime}function Y(_,v,A){if(_&&v)for(var D=0,O=0,K=_.length;O<=K;O++){var k=_[O],L=v[O+D];k&&L&&k.index===L.index&&k.fragment.sn===L.fragment.sn?A(k,L):D--}}function V(_,v,A){for(var D=v.skippedSegments,O=Math.max(_.startSN,v.startSN)-v.startSN,K=(_.fragmentHint?1:0)+(D?v.endSN:Math.min(_.endSN,v.endSN))-v.startSN,k=v.startSN-_.startSN,L=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,R=_.fragmentHint?_.fragments.concat(_.fragmentHint):_.fragments,Z=O;Z<=K;Z++){var ae=R[k+Z],fe=L[Z];D&&!fe&&Z<D&&(fe=v.fragments[Z]=ae),ae&&fe&&A(ae,fe)}}function M(_,v){var A=v.startSN+v.skippedSegments-_.startSN,D=_.fragments;A<0||A>=D.length||b(v,D[A].start)}function b(_,v){if(v){for(var A=_.fragments,D=_.skippedSegments;D<A.length;D++)A[D].start+=v;_.fragmentHint&&(_.fragmentHint.start+=v)}}function I(_,v){var A,D=1e3*_.levelTargetDuration,O=D/2,K=_.age,k=K>0&&K<3*D,L=v.loading.end-v.loading.start,R=_.availabilityDelay;if(_.updated===!1)if(k){var Z=333*_.misses;A=Math.max(Math.min(O,2*L),Z),_.availabilityDelay=(_.availabilityDelay||0)+A}else A=O;else k?(R=Math.min(R||D/2,K),_.availabilityDelay=R,A=R+D-K):A=D-L;return Math.round(A)}function w(_,v,A){if(!_||!_.details)return null;var D=_.details,O=D.fragments[v-D.startSN];return O||((O=D.fragmentHint)&&O.sn===v?O:v<D.startSN&&A&&A.sn===v?A:null)}function P(_,v,A){if(!_||!_.details)return null;var D=_.details.partList;if(D)for(var O=D.length;O--;){var K=D[O];if(K.index===A&&K.fragment.sn===v)return K}return null}},"./src/controller/stream-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>I});var z=C("./src/polyfills/number.ts"),G=C("./src/controller/base-stream-controller.ts"),de=C("./src/is-supported.ts"),te=C("./src/events.ts"),le=C("./src/utils/buffer-helper.ts"),Q=C("./src/controller/fragment-tracker.ts"),X=C("./src/types/loader.ts"),ie=C("./src/loader/fragment.ts"),W=C("./src/demux/transmuxer-interface.ts"),se=C("./src/types/transmuxer.ts"),Y=C("./src/controller/gap-controller.ts"),V=C("./src/errors.ts");function M(w,P){for(var _=0;_<P.length;_++){var v=P[_];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(w,v.key,v)}}function b(w,P){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,v){return _.__proto__=v,_},b(w,P)}var I=function(w){var P,_;function v(k,L){var R;return(R=w.call(this,k,L,"[stream-controller]")||this).audioCodecSwap=!1,R.gapController=null,R.level=-1,R._forceStartLoad=!1,R.altAudio=!1,R.audioOnly=!1,R.fragPlaying=null,R.onvplaying=null,R.onvseeked=null,R.fragLastKbps=0,R.couldBacktrack=!1,R.backtrackFragment=null,R.audioCodecSwitch=!1,R.videoBuffer=null,R._registerListeners(),R}_=w,(P=v).prototype=Object.create(_.prototype),P.prototype.constructor=P,b(P,_);var A,D,O,K=v.prototype;return K._registerListeners=function(){var k=this.hls;k.on(te.Events.MEDIA_ATTACHED,this.onMediaAttached,this),k.on(te.Events.MEDIA_DETACHING,this.onMediaDetaching,this),k.on(te.Events.MANIFEST_LOADING,this.onManifestLoading,this),k.on(te.Events.MANIFEST_PARSED,this.onManifestParsed,this),k.on(te.Events.LEVEL_LOADING,this.onLevelLoading,this),k.on(te.Events.LEVEL_LOADED,this.onLevelLoaded,this),k.on(te.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),k.on(te.Events.ERROR,this.onError,this),k.on(te.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),k.on(te.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),k.on(te.Events.BUFFER_CREATED,this.onBufferCreated,this),k.on(te.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),k.on(te.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),k.on(te.Events.FRAG_BUFFERED,this.onFragBuffered,this)},K._unregisterListeners=function(){var k=this.hls;k.off(te.Events.MEDIA_ATTACHED,this.onMediaAttached,this),k.off(te.Events.MEDIA_DETACHING,this.onMediaDetaching,this),k.off(te.Events.MANIFEST_LOADING,this.onManifestLoading,this),k.off(te.Events.MANIFEST_PARSED,this.onManifestParsed,this),k.off(te.Events.LEVEL_LOADED,this.onLevelLoaded,this),k.off(te.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),k.off(te.Events.ERROR,this.onError,this),k.off(te.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),k.off(te.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),k.off(te.Events.BUFFER_CREATED,this.onBufferCreated,this),k.off(te.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),k.off(te.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),k.off(te.Events.FRAG_BUFFERED,this.onFragBuffered,this)},K.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},K.startLoad=function(k){if(this.levels){var L=this.lastCurrentTime,R=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var Z=R.startLevel;Z===-1&&(R.config.testBandwidth&&this.levels.length>1?(Z=0,this.bitrateTest=!0):Z=R.nextAutoLevel),this.level=R.nextLoadLevel=Z,this.loadedmetadata=!1}L>0&&k===-1&&(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),k=L),this.state=G.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=k,this.tick()}else this._forceStartLoad=!0,this.state=G.State.STOPPED},K.stopLoad=function(){this._forceStartLoad=!1,w.prototype.stopLoad.call(this)},K.doTick=function(){switch(this.state){case G.State.IDLE:this.doTickIdle();break;case G.State.WAITING_LEVEL:var k,L=this.levels,R=this.level,Z=L==null||(k=L[R])===null||k===void 0?void 0:k.details;if(Z&&(!Z.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(Z))break;this.state=G.State.IDLE;break}break;case G.State.FRAG_LOADING_WAITING_RETRY:var ae,fe=self.performance.now(),ce=this.retryDate;(!ce||fe>=ce||(ae=this.media)!==null&&ae!==void 0&&ae.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=G.State.IDLE)}this.onTickEnd()},K.onTickEnd=function(){w.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},K.doTickIdle=function(){var k,L,R=this.hls,Z=this.levelLastLoaded,ae=this.levels,fe=this.media,ce=R.config,me=R.nextLoadLevel;if(Z!==null&&(fe||!this.startFragRequested&&ce.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&ae&&ae[me]){var Ee=ae[me];this.level=R.nextLoadLevel=me;var be=Ee.details;if(!be||this.state===G.State.WAITING_LEVEL||be.live&&this.levelLastLoaded!==me)this.state=G.State.WAITING_LEVEL;else{var Re=this.getMainFwdBufferInfo();if(Re!==null&&!(Re.len>=this.getMaxBufferLength(Ee.maxBitrate))){if(this._streamEnded(Re,be)){var Ce={};return this.altAudio&&(Ce.type="video"),this.hls.trigger(te.Events.BUFFER_EOS,Ce),void(this.state=G.State.ENDED)}this.backtrackFragment&&this.backtrackFragment.start>Re.end&&(this.backtrackFragment=null);var Ne=this.backtrackFragment?this.backtrackFragment.start:Re.end,Ue=this.getNextFragment(Ne,be);if(this.couldBacktrack&&!this.fragPrevious&&Ue&&Ue.sn!=="initSegment"&&this.fragmentTracker.getState(Ue)!==Q.FragmentState.OK){var Xe,ut=((Xe=this.backtrackFragment)!=null?Xe:Ue).sn-be.startSN,gt=be.fragments[ut-1];gt&&Ue.cc===gt.cc&&(Ue=gt,this.fragmentTracker.removeFragment(gt))}else this.backtrackFragment&&Re.len&&(this.backtrackFragment=null);if(Ue&&this.fragmentTracker.getState(Ue)===Q.FragmentState.OK&&this.nextLoadPosition>Ne){var ft=this.audioOnly&&!this.altAudio?ie.ElementaryStreamTypes.AUDIO:ie.ElementaryStreamTypes.VIDEO;fe&&this.afterBufferFlushed(fe,ft,X.PlaylistLevelType.MAIN),Ue=this.getNextFragment(this.nextLoadPosition,be)}Ue&&(!Ue.initSegment||Ue.initSegment.data||this.bitrateTest||(Ue=Ue.initSegment),((k=Ue.decryptdata)===null||k===void 0?void 0:k.keyFormat)!=="identity"||(L=Ue.decryptdata)!==null&&L!==void 0&&L.key?this.loadFragment(Ue,be,Ne):this.loadKey(Ue,be))}}}},K.loadFragment=function(k,L,R){var Z,ae=this.fragmentTracker.getState(k);this.fragCurrent=k,ae===Q.FragmentState.NOT_LOADED?k.sn==="initSegment"?this._loadInitSegment(k):this.bitrateTest?(this.log("Fragment "+k.sn+" of level "+k.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(k)):(this.startFragRequested=!0,w.prototype.loadFragment.call(this,k,L,R)):ae===Q.FragmentState.APPENDING?this.reduceMaxBufferLength(k.duration)&&this.fragmentTracker.removeFragment(k):((Z=this.media)===null||Z===void 0?void 0:Z.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},K.getAppendedFrag=function(k){var L=this.fragmentTracker.getAppendedFrag(k,X.PlaylistLevelType.MAIN);return L&&"fragment"in L?L.fragment:L},K.getBufferedFrag=function(k){return this.fragmentTracker.getBufferedFrag(k,X.PlaylistLevelType.MAIN)},K.followingBufferedFrag=function(k){return k?this.getBufferedFrag(k.end+.5):null},K.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},K.nextLevelSwitch=function(){var k=this.levels,L=this.media;if(L!=null&&L.readyState){var R,Z=this.getAppendedFrag(L.currentTime);if(Z&&Z.start>1&&this.flushMainBuffer(0,Z.start-1),!L.paused&&k){var ae=k[this.hls.nextLoadLevel],fe=this.fragLastKbps;R=fe&&this.fragCurrent?this.fragCurrent.duration*ae.maxBitrate/(1e3*fe)+1:0}else R=0;var ce=this.getBufferedFrag(L.currentTime+R);if(ce){var me=this.followingBufferedFrag(ce);if(me){this.abortCurrentFrag();var Ee=me.maxStartPTS?me.maxStartPTS:me.start,be=me.duration,Re=Math.max(ce.end,Ee+Math.min(Math.max(be-this.config.maxFragLookUpTolerance,.5*be),.75*be));this.flushMainBuffer(Re,Number.POSITIVE_INFINITY)}}}},K.abortCurrentFrag=function(){var k=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,k!=null&&k.loader&&k.loader.abort(),this.state){case G.State.KEY_LOADING:case G.State.FRAG_LOADING:case G.State.FRAG_LOADING_WAITING_RETRY:case G.State.PARSING:case G.State.PARSED:this.state=G.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},K.flushMainBuffer=function(k,L){w.prototype.flushMainBuffer.call(this,k,L,this.altAudio?"video":null)},K.onMediaAttached=function(k,L){w.prototype.onMediaAttached.call(this,k,L);var R=L.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),R.addEventListener("playing",this.onvplaying),R.addEventListener("seeked",this.onvseeked),this.gapController=new Y.default(this.config,R,this.fragmentTracker,this.hls)},K.onMediaDetaching=function(){var k=this.media;k&&this.onvplaying&&this.onvseeked&&(k.removeEventListener("playing",this.onvplaying),k.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),w.prototype.onMediaDetaching.call(this)},K.onMediaPlaying=function(){this.tick()},K.onMediaSeeked=function(){var k=this.media,L=k?k.currentTime:null;(0,z.isFiniteNumber)(L)&&this.log("Media seeked to "+L.toFixed(3)),this.tick()},K.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(te.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},K.onManifestParsed=function(k,L){var R,Z=!1,ae=!1;L.levels.forEach(function(fe){(R=fe.audioCodec)&&(R.indexOf("mp4a.40.2")!==-1&&(Z=!0),R.indexOf("mp4a.40.5")!==-1&&(ae=!0))}),this.audioCodecSwitch=Z&&ae&&!(0,de.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=L.levels,this.startFragRequested=!1},K.onLevelLoading=function(k,L){var R=this.levels;if(R&&this.state===G.State.IDLE){var Z=R[L.level];(!Z.details||Z.details.live&&this.levelLastLoaded!==L.level||this.waitForCdnTuneIn(Z.details))&&(this.state=G.State.WAITING_LEVEL)}},K.onLevelLoaded=function(k,L){var R,Z=this.levels,ae=L.level,fe=L.details,ce=fe.totalduration;if(Z){this.log("Level "+ae+" loaded ["+fe.startSN+","+fe.endSN+"], cc ["+fe.startCC+", "+fe.endCC+"] duration:"+ce);var me=this.fragCurrent;!me||this.state!==G.State.FRAG_LOADING&&this.state!==G.State.FRAG_LOADING_WAITING_RETRY||me.level!==L.level&&me.loader&&(this.state=G.State.IDLE,this.backtrackFragment=null,me.loader.abort());var Ee=Z[ae],be=0;if(fe.live||(R=Ee.details)!==null&&R!==void 0&&R.live){if(fe.fragments[0]||(fe.deltaUpdateFailed=!0),fe.deltaUpdateFailed)return;be=this.alignPlaylists(fe,Ee.details)}if(Ee.details=fe,this.levelLastLoaded=ae,this.hls.trigger(te.Events.LEVEL_UPDATED,{details:fe,level:ae}),this.state===G.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(fe))return;this.state=G.State.IDLE}this.startFragRequested?fe.live&&this.synchronizeToLiveEdge(fe):this.setStartPosition(fe,be),this.tick()}else this.warn("Levels were reset while loading level "+ae)},K._handleFragmentLoadProgress=function(k){var L,R=k.frag,Z=k.part,ae=k.payload,fe=this.levels;if(fe){var ce=fe[R.level],me=ce.details;if(me){var Ee=ce.videoCodec,be=me.PTSKnown||!me.live,Re=(L=R.initSegment)===null||L===void 0?void 0:L.data,Ce=this._getAudioCodec(ce),Ne=this.transmuxer=this.transmuxer||new W.default(this.hls,X.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Ue=Z?Z.index:-1,Xe=Ue!==-1,ut=new se.ChunkMetadata(R.level,R.sn,R.stats.chunkCount,ae.byteLength,Ue,Xe),gt=this.initPTS[R.cc];Ne.push(ae,Re,Ce,Ee,R,Z,me.totalduration,be,ut,gt)}else this.warn("Dropping fragment "+R.sn+" of level "+R.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+R.sn+" of level "+R.level+" will not be buffered")},K.onAudioTrackSwitching=function(k,L){var R=this.altAudio,Z=!!L.url,ae=L.id;if(!Z){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var fe=this.fragCurrent;fe!=null&&fe.loader&&(this.log("Switching to main audio track, cancel main fragment load"),fe.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var ce=this.hls;R&&ce.trigger(te.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),ce.trigger(te.Events.AUDIO_TRACK_SWITCHED,{id:ae})}},K.onAudioTrackSwitched=function(k,L){var R=L.id,Z=!!this.hls.audioTracks[R].url;if(Z){var ae=this.videoBuffer;ae&&this.mediaBuffer!==ae&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=ae)}this.altAudio=Z,this.tick()},K.onBufferCreated=function(k,L){var R,Z,ae=L.tracks,fe=!1;for(var ce in ae){var me=ae[ce];if(me.id==="main"){if(Z=ce,R=me,ce==="video"){var Ee=ae[ce];Ee&&(this.videoBuffer=Ee.buffer)}}else fe=!0}fe&&R?(this.log("Alternate track found, use "+Z+".buffered to schedule main fragment loading"),this.mediaBuffer=R.buffer):this.mediaBuffer=this.media},K.onFragBuffered=function(k,L){var R=L.frag,Z=L.part;if(!R||R.type===X.PlaylistLevelType.MAIN){if(this.fragContextChanged(R))return this.warn("Fragment "+R.sn+(Z?" p: "+Z.index:"")+" of level "+R.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===G.State.PARSED&&(this.state=G.State.IDLE));var ae=Z?Z.stats:R.stats;this.fragLastKbps=Math.round(8*ae.total/(ae.buffering.end-ae.loading.first)),R.sn!=="initSegment"&&(this.fragPrevious=R),this.fragBufferedComplete(R,Z)}},K.onError=function(k,L){switch(L.details){case V.ErrorDetails.FRAG_LOAD_ERROR:case V.ErrorDetails.FRAG_LOAD_TIMEOUT:case V.ErrorDetails.KEY_LOAD_ERROR:case V.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(X.PlaylistLevelType.MAIN,L);break;case V.ErrorDetails.LEVEL_LOAD_ERROR:case V.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==G.State.ERROR&&(L.fatal?(this.warn(""+L.details),this.state=G.State.ERROR):L.levelRetry||this.state!==G.State.WAITING_LEVEL||(this.state=G.State.IDLE));break;case V.ErrorDetails.BUFFER_FULL_ERROR:if(L.parent==="main"&&(this.state===G.State.PARSING||this.state===G.State.PARSED)){var R=!0,Z=this.getFwdBufferInfo(this.media,X.PlaylistLevelType.MAIN);Z&&Z.len>.5&&(R=!this.reduceMaxBufferLength(Z.len)),R&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},K.checkBuffer=function(){var k=this.media,L=this.gapController;if(k&&L&&k.readyState){if(this.loadedmetadata||!le.BufferHelper.getBuffered(k).length){var R=this.state!==G.State.IDLE?this.fragCurrent:null;L.poll(this.lastCurrentTime,R)}this.lastCurrentTime=k.currentTime}},K.onFragLoadEmergencyAborted=function(){this.state=G.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},K.onBufferFlushed=function(k,L){var R=L.type;if(R!==ie.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var Z=(R===ie.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(Z,R,X.PlaylistLevelType.MAIN)}},K.onLevelsUpdated=function(k,L){this.levels=L.levels},K.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},K.seekToStartPos=function(){var k=this.media;if(k){var L=k.currentTime,R=this.startPosition;if(R>=0&&L<R){if(k.seeking)return void this.log("could not seek to "+R+", already seeking at "+L);var Z=le.BufferHelper.getBuffered(k),ae=(Z.length?Z.start(0):0)-R;ae>0&&(ae<this.config.maxBufferHole||ae<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+ae+" to match buffer start"),R+=ae,this.startPosition=R),this.log("seek to target start position "+R+" from current time "+L),k.currentTime=R}}},K._getAudioCodec=function(k){var L=this.config.defaultAudioCodec||k.audioCodec;return this.audioCodecSwap&&L&&(this.log("Swapping audio codec"),L=L.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),L},K._loadBitrateTestFrag=function(k){var L=this;k.bitrateTest=!0,this._doFragLoad(k).then(function(R){var Z=L.hls;if(R&&!Z.nextLoadLevel&&!L.fragContextChanged(k)){L.fragLoadError=0,L.state=G.State.IDLE,L.startFragRequested=!1,L.bitrateTest=!1;var ae=k.stats;ae.parsing.start=ae.parsing.end=ae.buffering.start=ae.buffering.end=self.performance.now(),Z.trigger(te.Events.FRAG_LOADED,R),k.bitrateTest=!1}})},K._handleTransmuxComplete=function(k){var L,R="main",Z=this.hls,ae=k.remuxResult,fe=k.chunkMeta,ce=this.getCurrentContext(fe);if(!ce)return this.warn("The loading context changed while buffering fragment "+fe.sn+" of level "+fe.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(fe.level);var me=ce.frag,Ee=ce.part,be=ce.level,Re=ae.video,Ce=ae.text,Ne=ae.id3,Ue=ae.initSegment,Xe=be.details,ut=this.altAudio?void 0:ae.audio;if(!this.fragContextChanged(me)){if(this.state=G.State.PARSING,Ue){Ue.tracks&&(this._bufferInitSegment(be,Ue.tracks,me,fe),Z.trigger(te.Events.FRAG_PARSING_INIT_SEGMENT,{frag:me,id:R,tracks:Ue.tracks}));var gt=Ue.initPTS,ft=Ue.timescale;(0,z.isFiniteNumber)(gt)&&(this.initPTS[me.cc]=gt,Z.trigger(te.Events.INIT_PTS_FOUND,{frag:me,id:R,initPTS:gt,timescale:ft}))}if(Re&&ae.independent!==!1){if(Xe){var St=Re.startPTS,Et=Re.endPTS,ve=Re.startDTS,Oe=Re.endDTS;if(Ee)Ee.elementaryStreams[Re.type]={startPTS:St,endPTS:Et,startDTS:ve,endDTS:Oe};else if(Re.firstKeyFrame&&Re.independent&&(this.couldBacktrack=!0),Re.dropped&&Re.independent){var Ke=this.getMainFwdBufferInfo();if((Ke?Ke.end:this.getLoadPosition())+this.config.maxBufferHole<(Re.firstKeyFramePTS?Re.firstKeyFramePTS:St)-this.config.maxBufferHole)return void this.backtrack(me);me.setElementaryStreamInfo(Re.type,me.start,Et,me.start,Oe,!0)}me.setElementaryStreamInfo(Re.type,St,Et,ve,Oe),this.backtrackFragment&&(this.backtrackFragment=me),this.bufferFragmentData(Re,me,Ee,fe)}}else if(ae.independent===!1)return void this.backtrack(me);if(ut){var nt=ut.startPTS,vt=ut.endPTS,mt=ut.startDTS,Qt=ut.endDTS;Ee&&(Ee.elementaryStreams[ie.ElementaryStreamTypes.AUDIO]={startPTS:nt,endPTS:vt,startDTS:mt,endDTS:Qt}),me.setElementaryStreamInfo(ie.ElementaryStreamTypes.AUDIO,nt,vt,mt,Qt),this.bufferFragmentData(ut,me,Ee,fe)}if(Xe&&Ne!=null&&(L=Ne.samples)!==null&&L!==void 0&&L.length){var Yt={id:R,frag:me,details:Xe,samples:Ne.samples};Z.trigger(te.Events.FRAG_PARSING_METADATA,Yt)}if(Xe&&Ce){var Wt={id:R,frag:me,details:Xe,samples:Ce.samples};Z.trigger(te.Events.FRAG_PARSING_USERDATA,Wt)}}},K._bufferInitSegment=function(k,L,R,Z){var ae=this;if(this.state===G.State.PARSING){this.audioOnly=!!L.audio&&!L.video,this.altAudio&&!this.audioOnly&&delete L.audio;var fe=L.audio,ce=L.video,me=L.audiovideo;if(fe){var Ee=k.audioCodec,be=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(Ee&&(Ee=Ee.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),fe.metadata.channelCount!==1&&be.indexOf("firefox")===-1&&(Ee="mp4a.40.5")),be.indexOf("android")!==-1&&fe.container!=="audio/mpeg"&&(Ee="mp4a.40.2",this.log("Android: force audio codec to "+Ee)),k.audioCodec&&k.audioCodec!==Ee&&this.log('Swapping manifest audio codec "'+k.audioCodec+'" for "'+Ee+'"'),fe.levelCodec=Ee,fe.id="main",this.log("Init audio buffer, container:"+fe.container+", codecs[selected/level/parsed]=["+(Ee||"")+"/"+(k.audioCodec||"")+"/"+fe.codec+"]")}ce&&(ce.levelCodec=k.videoCodec,ce.id="main",this.log("Init video buffer, container:"+ce.container+", codecs[level/parsed]=["+(k.videoCodec||"")+"/"+ce.codec+"]")),me&&this.log("Init audiovideo buffer, container:"+me.container+", codecs[level/parsed]=["+(k.attrs.CODECS||"")+"/"+me.codec+"]"),this.hls.trigger(te.Events.BUFFER_CODECS,L),Object.keys(L).forEach(function(Re){var Ce=L[Re].initSegment;Ce!=null&&Ce.byteLength&&ae.hls.trigger(te.Events.BUFFER_APPENDING,{type:Re,data:Ce,frag:R,part:null,chunkMeta:Z,parent:R.type})}),this.tick()}},K.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,X.PlaylistLevelType.MAIN)},K.backtrack=function(k){this.couldBacktrack=!0,this.backtrackFragment=k,this.resetTransmuxer(),this.flushBufferGap(k),this.fragmentTracker.removeFragment(k),this.fragPrevious=null,this.nextLoadPosition=k.start,this.state=G.State.IDLE},K.checkFragmentChanged=function(){var k=this.media,L=null;if(k&&k.readyState>1&&k.seeking===!1){var R=k.currentTime;if(le.BufferHelper.isBuffered(k,R)?L=this.getAppendedFrag(R):le.BufferHelper.isBuffered(k,R+.1)&&(L=this.getAppendedFrag(R+.1)),L){this.backtrackFragment=null;var Z=this.fragPlaying,ae=L.level;Z&&L.sn===Z.sn&&Z.level===ae&&L.urlId===Z.urlId||(this.hls.trigger(te.Events.FRAG_CHANGED,{frag:L}),Z&&Z.level===ae||this.hls.trigger(te.Events.LEVEL_SWITCHED,{level:ae}),this.fragPlaying=L)}}},A=v,(D=[{key:"nextLevel",get:function(){var k=this.nextBufferedFrag;return k?k.level:-1}},{key:"currentFrag",get:function(){var k=this.media;return k?this.fragPlaying||this.getAppendedFrag(k.currentTime):null}},{key:"currentProgramDateTime",get:function(){var k=this.media;if(k){var L=k.currentTime,R=this.currentFrag;if(R&&(0,z.isFiniteNumber)(L)&&(0,z.isFiniteNumber)(R.programDateTime)){var Z=R.programDateTime+1e3*(L-R.start);return new Date(Z)}}return null}},{key:"currentLevel",get:function(){var k=this.currentFrag;return k?k.level:-1}},{key:"nextBufferedFrag",get:function(){var k=this.currentFrag;return k?this.followingBufferedFrag(k):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&M(A.prototype,D),O&&M(A,O),Object.defineProperty(A,"prototype",{writable:!1}),v}(G.default)},"./src/controller/subtitle-stream-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{SubtitleStreamController:()=>V});var z=C("./src/events.ts"),G=C("./src/utils/buffer-helper.ts"),de=C("./src/controller/fragment-finders.ts"),te=C("./src/utils/discontinuities.ts"),le=C("./src/controller/level-helper.ts"),Q=C("./src/controller/fragment-tracker.ts"),X=C("./src/controller/base-stream-controller.ts"),ie=C("./src/types/loader.ts"),W=C("./src/types/level.ts");function se(b,I){for(var w=0;w<I.length;w++){var P=I[w];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(b,P.key,P)}}function Y(b,I){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,P){return w.__proto__=P,w},Y(b,I)}var V=function(b){var I,w;function P(O,K){var k;return(k=b.call(this,O,K,"[subtitle-stream-controller]")||this).levels=[],k.currentTrackId=-1,k.tracksBuffered=[],k.mainDetails=null,k._registerListeners(),k}w=b,(I=P).prototype=Object.create(w.prototype),I.prototype.constructor=I,Y(I,w);var _,v,A,D=P.prototype;return D.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},D._registerListeners=function(){var O=this.hls;O.on(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),O.on(z.Events.MEDIA_DETACHING,this.onMediaDetaching,this),O.on(z.Events.MANIFEST_LOADING,this.onManifestLoading,this),O.on(z.Events.LEVEL_LOADED,this.onLevelLoaded,this),O.on(z.Events.ERROR,this.onError,this),O.on(z.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),O.on(z.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),O.on(z.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),O.on(z.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),O.on(z.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),O.on(z.Events.FRAG_BUFFERED,this.onFragBuffered,this)},D._unregisterListeners=function(){var O=this.hls;O.off(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),O.off(z.Events.MEDIA_DETACHING,this.onMediaDetaching,this),O.off(z.Events.MANIFEST_LOADING,this.onManifestLoading,this),O.off(z.Events.LEVEL_LOADED,this.onLevelLoaded,this),O.off(z.Events.ERROR,this.onError,this),O.off(z.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),O.off(z.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),O.off(z.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),O.off(z.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),O.off(z.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),O.off(z.Events.FRAG_BUFFERED,this.onFragBuffered,this)},D.startLoad=function(O){this.stopLoad(),this.state=X.State.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=O,this.tick()},D.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},D.onLevelLoaded=function(O,K){this.mainDetails=K.details},D.onSubtitleFragProcessed=function(O,K){var k=K.frag,L=K.success;if(this.fragPrevious=k,this.state=X.State.IDLE,L){var R=this.tracksBuffered[this.currentTrackId];if(R){for(var Z,ae=k.start,fe=0;fe<R.length;fe++)if(ae>=R[fe].start&&ae<=R[fe].end){Z=R[fe];break}var ce=k.start+k.duration;Z?Z.end=ce:(Z={start:ae,end:ce},R.push(Z)),this.fragmentTracker.fragBuffered(k)}}},D.onBufferFlushing=function(O,K){var k=K.startOffset,L=K.endOffset;if(k===0&&L!==Number.POSITIVE_INFINITY){var R=this.currentTrackId,Z=this.levels;if(!Z.length||!Z[R]||!Z[R].details)return;var ae=L-Z[R].details.targetduration;if(ae<=0)return;K.endOffsetSubtitles=Math.max(0,ae),this.tracksBuffered.forEach(function(fe){for(var ce=0;ce<fe.length;)if(fe[ce].end<=ae)fe.shift();else{if(!(fe[ce].start<ae))break;fe[ce].start=ae,ce++}}),this.fragmentTracker.removeFragmentsInRange(k,ae,ie.PlaylistLevelType.SUBTITLE)}},D.onFragBuffered=function(O,K){var k;this.loadedmetadata||K.frag.type!==ie.PlaylistLevelType.MAIN||(k=this.media)!==null&&k!==void 0&&k.buffered.length&&(this.loadedmetadata=!0)},D.onError=function(O,K){var k,L=K.frag;L&&L.type===ie.PlaylistLevelType.SUBTITLE&&((k=this.fragCurrent)!==null&&k!==void 0&&k.loader&&this.fragCurrent.loader.abort(),this.state=X.State.IDLE)},D.onSubtitleTracksUpdated=function(O,K){var k=this,L=K.subtitleTracks;this.tracksBuffered=[],this.levels=L.map(function(R){return new W.Level(R)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(R){k.tracksBuffered[R.id]=[]}),this.mediaBuffer=null},D.onSubtitleTrackSwitch=function(O,K){if(this.currentTrackId=K.id,this.levels.length&&this.currentTrackId!==-1){var k=this.levels[this.currentTrackId];k!=null&&k.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,k&&this.setInterval(500)}else this.clearInterval()},D.onSubtitleTrackLoaded=function(O,K){var k,L=K.details,R=K.id,Z=this.currentTrackId,ae=this.levels;if(ae.length){var fe=ae[Z];if(!(R>=ae.length||R!==Z)&&fe){this.mediaBuffer=this.mediaBufferTimeRanges;var ce=0;if(L.live||(k=fe.details)!==null&&k!==void 0&&k.live){var me=this.mainDetails;if(L.deltaUpdateFailed||!me)return;var Ee=me.fragments[0];fe.details?(ce=this.alignPlaylists(L,fe.details))===0&&Ee&&(ce=Ee.start,(0,le.addSliding)(L,ce)):L.hasProgramDateTime&&me.hasProgramDateTime?((0,te.alignMediaPlaylistByPDT)(L,me),ce=L.fragments[0].start):Ee&&(ce=Ee.start,(0,le.addSliding)(L,ce))}fe.details=L,this.levelLastLoaded=R,this.startFragRequested||!this.mainDetails&&L.live||this.setStartPosition(fe.details,ce),this.tick(),L.live&&!this.fragCurrent&&this.media&&this.state===X.State.IDLE&&((0,de.findFragmentByPTS)(null,L.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),fe.details=void 0))}}},D._handleFragmentLoadComplete=function(O){var K=O.frag,k=O.payload,L=K.decryptdata,R=this.hls;if(!this.fragContextChanged(K)&&k&&k.byteLength>0&&L&&L.key&&L.iv&&L.method==="AES-128"){var Z=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(k),L.key.buffer,L.iv.buffer).then(function(ae){var fe=performance.now();R.trigger(z.Events.FRAG_DECRYPTED,{frag:K,payload:ae,stats:{tstart:Z,tdecrypt:fe}})})}},D.doTick=function(){if(this.media){if(this.state===X.State.IDLE){var O=this.currentTrackId,K=this.levels;if(!K.length||!K[O]||!K[O].details)return;var k=K[O].details,L=k.targetduration,R=this.config,Z=this.getLoadPosition(),ae=G.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],Z-L,R.maxBufferHole),fe=ae.end,ce=ae.len,me=this.getFwdBufferInfo(this.media,ie.PlaylistLevelType.MAIN);if(ce>this.getMaxBufferLength(me?.len)+L)return;console.assert(k,"Subtitle track details are defined on idle subtitle stream controller tick");var Ee,be=k.fragments,Re=be.length,Ce=k.edge,Ne=this.fragPrevious;if(fe<Ce){var Ue=R.maxFragLookUpTolerance;!(Ee=(0,de.findFragmentByPTS)(Ne,be,Math.max(be[0].start,fe),Ue))&&Ne&&Ne.start<be[0].start&&(Ee=be[0])}else Ee=be[Re-1];if(!(Ee=this.mapToInitFragWhenRequired(Ee))||this.fragmentTracker.getState(Ee)!==Q.FragmentState.NOT_LOADED)return;Ee.encrypted?this.loadKey(Ee,k):this.loadFragment(Ee,k,fe)}}else this.state=X.State.IDLE},D.getMaxBufferLength=function(O){var K=b.prototype.getMaxBufferLength.call(this);return O?Math.max(K,O):K},D.loadFragment=function(O,K,k){this.fragCurrent=O,O.sn==="initSegment"?this._loadInitSegment(O):(this.startFragRequested=!0,b.prototype.loadFragment.call(this,O,K,k))},_=P,(v=[{key:"mediaBufferTimeRanges",get:function(){return new M(this.tracksBuffered[this.currentTrackId]||[])}}])&&se(_.prototype,v),A&&se(_,A),Object.defineProperty(_,"prototype",{writable:!1}),P}(X.default),M=function(b){this.buffered=void 0;var I=function(w,P,_){if((P>>>=0)>_-1)throw new DOMException("Failed to execute '"+w+"' on 'TimeRanges': The index provided ("+P+") is greater than the maximum bound ("+_+")");return b[P][w]};this.buffered={get length(){return b.length},end:function(w){return I("end",w,b.length)},start:function(w){return I("start",w,b.length)}}}},"./src/controller/subtitle-track-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>W});var z=C("./src/events.ts"),G=C("./src/utils/texttrack-utils.ts"),de=C("./src/controller/base-playlist-controller.ts"),te=C("./src/types/loader.ts");function le(se,Y){for(var V=0;V<Y.length;V++){var M=Y[V];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(se,M.key,M)}}function Q(se,Y){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(V,M){return V.__proto__=M,V},Q(se,Y)}var X=function(se){var Y,V;function M(_){var v;return(v=se.call(this,_,"[subtitle-track-controller]")||this).media=null,v.tracks=[],v.groupId=null,v.tracksInGroup=[],v.trackId=-1,v.selectDefaultTrack=!0,v.queuedDefaultTrack=-1,v.trackChangeListener=function(){return v.onTextTracksChanged()},v.asyncPollTrackChange=function(){return v.pollTrackChange(0)},v.useTextTrackPolling=!1,v.subtitlePollingInterval=-1,v._subtitleDisplay=!0,v.registerListeners(),v}V=se,(Y=M).prototype=Object.create(V.prototype),Y.prototype.constructor=Y,Q(Y,V);var b,I,w,P=M.prototype;return P.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,se.prototype.destroy.call(this)},P.registerListeners=function(){var _=this.hls;_.on(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),_.on(z.Events.MEDIA_DETACHING,this.onMediaDetaching,this),_.on(z.Events.MANIFEST_LOADING,this.onManifestLoading,this),_.on(z.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.on(z.Events.LEVEL_LOADING,this.onLevelLoading,this),_.on(z.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_.on(z.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),_.on(z.Events.ERROR,this.onError,this)},P.unregisterListeners=function(){var _=this.hls;_.off(z.Events.MEDIA_ATTACHED,this.onMediaAttached,this),_.off(z.Events.MEDIA_DETACHING,this.onMediaDetaching,this),_.off(z.Events.MANIFEST_LOADING,this.onManifestLoading,this),_.off(z.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.off(z.Events.LEVEL_LOADING,this.onLevelLoading,this),_.off(z.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),_.off(z.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),_.off(z.Events.ERROR,this.onError,this)},P.onMediaAttached=function(_,v){this.media=v.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},P.pollTrackChange=function(_){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,_)},P.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),ie(this.media.textTracks).forEach(function(_){(0,G.clearCurrentCues)(_)}),this.subtitleTrack=-1,this.media=null)},P.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},P.onManifestParsed=function(_,v){this.tracks=v.subtitleTracks},P.onSubtitleTrackLoaded=function(_,v){var A=v.id,D=v.details,O=this.trackId,K=this.tracksInGroup[O];if(K){var k=K.details;K.details=v.details,this.log("subtitle track "+A+" loaded ["+D.startSN+"-"+D.endSN+"]"),A===this.trackId&&(this.retryCount=0,this.playlistLoaded(A,v,k))}else this.warn("Invalid subtitle track id "+A)},P.onLevelLoading=function(_,v){this.switchLevel(v.level)},P.onLevelSwitching=function(_,v){this.switchLevel(v.level)},P.switchLevel=function(_){var v=this.hls.levels[_];if(v!=null&&v.textGroupIds){var A=v.textGroupIds[v.urlId];if(this.groupId!==A){var D=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,O=this.tracks.filter(function(L){return!A||L.groupId===A});this.tracksInGroup=O;var K=this.findTrackId(D?.name)||this.findTrackId();this.groupId=A;var k={subtitleTracks:O};this.log("Updating subtitle tracks, "+O.length+' track(s) found in "'+A+'" group-id'),this.hls.trigger(z.Events.SUBTITLE_TRACKS_UPDATED,k),K!==-1&&this.setSubtitleTrack(K,D)}}},P.findTrackId=function(_){for(var v=this.tracksInGroup,A=0;A<v.length;A++){var D=v[A];if((!this.selectDefaultTrack||D.default)&&(!_||_===D.name))return D.id}return-1},P.onError=function(_,v){se.prototype.onError.call(this,_,v),!v.fatal&&v.context&&v.context.type===te.PlaylistContextType.SUBTITLE_TRACK&&v.context.id===this.trackId&&v.context.groupId===this.groupId&&this.retryLoadingOrFail(v)},P.loadPlaylist=function(_){var v=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(v)){var A=v.id,D=v.groupId,O=v.url;if(_)try{O=_.addDirectives(O)}catch(K){this.warn("Could not construct new URL with HLS Delivery Directives: "+K)}this.log("Loading subtitle playlist for id "+A),this.hls.trigger(z.Events.SUBTITLE_TRACK_LOADING,{url:O,id:A,groupId:D,deliveryDirectives:_||null})}},P.toggleTrackModes=function(_){var v=this,A=this.media,D=this.trackId;if(A){var O=ie(A.textTracks),K=O.filter(function(R){return R.groupId===v.groupId});if(_===-1)[].slice.call(O).forEach(function(R){R.mode="disabled"});else{var k=K[D];k&&(k.mode="disabled")}var L=K[_];L&&(L.mode=this.subtitleDisplay?"showing":"hidden")}},P.setSubtitleTrack=function(_,v){var A,D=this.tracksInGroup;if(this.media){if(this.trackId!==_&&this.toggleTrackModes(_),!(this.trackId===_&&(_===-1||(A=D[_])!==null&&A!==void 0&&A.details)||_<-1||_>=D.length)){this.clearTimer();var O=D[_];if(this.log("Switching to subtitle track "+_),this.trackId=_,O){var K=O.id,k=O.groupId,L=k===void 0?"":k,R=O.name,Z=O.type,ae=O.url;this.hls.trigger(z.Events.SUBTITLE_TRACK_SWITCH,{id:K,groupId:L,name:R,type:Z,url:ae});var fe=this.switchParams(O.url,v?.details);this.loadPlaylist(fe)}else this.hls.trigger(z.Events.SUBTITLE_TRACK_SWITCH,{id:_})}}else this.queuedDefaultTrack=_},P.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var _=-1,v=ie(this.media.textTracks),A=0;A<v.length;A++)if(v[A].mode==="hidden")_=A;else if(v[A].mode==="showing"){_=A;break}this.subtitleTrack!==_&&(this.subtitleTrack=_)}},b=M,(I=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(_){this._subtitleDisplay=_,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(_){this.selectDefaultTrack=!1;var v=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(_,v)}}])&&le(b.prototype,I),w&&le(b,w),Object.defineProperty(b,"prototype",{writable:!1}),M}(de.default);function ie(se){for(var Y=[],V=0;V<se.length;V++){var M=se[V];M.kind==="subtitles"&&M.label&&Y.push(se[V])}return Y}const W=X},"./src/controller/timeline-controller.ts":(F,re,C)=>{C.r(re),C.d(re,{TimelineController:()=>Y});var z=C("./src/polyfills/number.ts"),G=C("./src/events.ts"),de=C("./src/utils/cea-608-parser.ts"),te=C("./src/utils/output-filter.ts"),le=C("./src/utils/webvtt-parser.ts"),Q=C("./src/utils/texttrack-utils.ts"),X=C("./src/utils/imsc1-ttml-parser.ts"),ie=C("./src/utils/mp4-tools.ts"),W=C("./src/types/loader.ts"),se=C("./src/utils/logger.ts"),Y=function(){function M(I){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=I,this.config=I.config,this.Cues=I.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var w=new te.default(this,"textTrack1"),P=new te.default(this,"textTrack2"),_=new te.default(this,"textTrack3"),v=new te.default(this,"textTrack4");this.cea608Parser1=new de.default(1,w,P),this.cea608Parser2=new de.default(3,_,v)}I.on(G.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),I.on(G.Events.MEDIA_DETACHING,this.onMediaDetaching,this),I.on(G.Events.MANIFEST_LOADING,this.onManifestLoading,this),I.on(G.Events.MANIFEST_LOADED,this.onManifestLoaded,this),I.on(G.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),I.on(G.Events.FRAG_LOADING,this.onFragLoading,this),I.on(G.Events.FRAG_LOADED,this.onFragLoaded,this),I.on(G.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),I.on(G.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),I.on(G.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),I.on(G.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),I.on(G.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var b=M.prototype;return b.destroy=function(){var I=this.hls;I.off(G.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),I.off(G.Events.MEDIA_DETACHING,this.onMediaDetaching,this),I.off(G.Events.MANIFEST_LOADING,this.onManifestLoading,this),I.off(G.Events.MANIFEST_LOADED,this.onManifestLoaded,this),I.off(G.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),I.off(G.Events.FRAG_LOADING,this.onFragLoading,this),I.off(G.Events.FRAG_LOADED,this.onFragLoaded,this),I.off(G.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),I.off(G.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),I.off(G.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),I.off(G.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),I.off(G.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},b.addCues=function(I,w,P,_,v){for(var A,D,O,K,k=!1,L=v.length;L--;){var R=v[L],Z=(A=R[0],D=R[1],O=w,K=P,Math.min(D,K)-Math.max(A,O));if(Z>=0&&(R[0]=Math.min(R[0],w),R[1]=Math.max(R[1],P),k=!0,Z/(P-w)>.5))return}if(k||v.push([w,P]),this.config.renderTextTracksNatively){var ae=this.captionsTracks[I];this.Cues.newCue(ae,w,P,_)}else{var fe=this.Cues.newCue(null,w,P,_);this.hls.trigger(G.Events.CUES_PARSED,{type:"captions",cues:fe,track:I})}},b.onInitPtsFound=function(I,w){var P=this,_=w.frag,v=w.id,A=w.initPTS,D=w.timescale,O=this.unparsedVttFrags;v==="main"&&(this.initPTS[_.cc]=A,this.timescale[_.cc]=D),O.length&&(this.unparsedVttFrags=[],O.forEach(function(K){P.onFragLoaded(G.Events.FRAG_LOADED,K)}))},b.getExistingTrack=function(I){var w=this.media;if(w)for(var P=0;P<w.textTracks.length;P++){var _=w.textTracks[P];if(_[I])return _}return null},b.createCaptionsTrack=function(I){this.config.renderTextTracksNatively?this.createNativeTrack(I):this.createNonNativeTrack(I)},b.createNativeTrack=function(I){if(!this.captionsTracks[I]){var w=this.captionsProperties,P=this.captionsTracks,_=this.media,v=w[I],A=v.label,D=v.languageCode,O=this.getExistingTrack(I);if(O)P[I]=O,(0,Q.clearCurrentCues)(P[I]),(0,Q.sendAddTrackEvent)(P[I],_);else{var K=this.createTextTrack("captions",A,D);K&&(K[I]=!0,P[I]=K)}}},b.createNonNativeTrack=function(I){if(!this.nonNativeCaptionsTracks[I]){var w=this.captionsProperties[I];if(w){var P={_id:I,label:w.label,kind:"captions",default:!!w.media&&!!w.media.default,closedCaptions:w.media};this.nonNativeCaptionsTracks[I]=P,this.hls.trigger(G.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[P]})}}},b.createTextTrack=function(I,w,P){var _=this.media;if(_)return _.addTextTrack(I,w,P)},b.onMediaAttaching=function(I,w){this.media=w.media,this._cleanTracks()},b.onMediaDetaching=function(){var I=this.captionsTracks;Object.keys(I).forEach(function(w){(0,Q.clearCurrentCues)(I[w]),delete I[w]}),this.nonNativeCaptionsTracks={}},b.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},b._cleanTracks=function(){var I=this.media;if(I){var w=I.textTracks;if(w)for(var P=0;P<w.length;P++)(0,Q.clearCurrentCues)(w[P])}},b.onSubtitleTracksUpdated=function(I,w){var P=this;this.textTracks=[];var _=w.subtitleTracks||[],v=_.some(function(K){return K.textCodec===X.IMSC1_CODEC});if(this.config.enableWebVTT||v&&this.config.enableIMSC1){var A=this.tracks&&_&&this.tracks.length===_.length;if(this.tracks=_||[],this.config.renderTextTracksNatively){var D=this.media?this.media.textTracks:[];this.tracks.forEach(function(K,k){var L;if(k<D.length){for(var R=null,Z=0;Z<D.length;Z++)if(V(D[Z],K)){R=D[Z];break}R&&(L=R)}if(L)(0,Q.clearCurrentCues)(L);else{var ae=P._captionsOrSubtitlesFromCharacteristics(K);(L=P.createTextTrack(ae,K.name,K.lang))&&(L.mode="disabled")}L&&(L.groupId=K.groupId,P.textTracks.push(L))})}else if(!A&&this.tracks&&this.tracks.length){var O=this.tracks.map(function(K){return{label:K.name,kind:K.type.toLowerCase(),default:K.default,subtitleTrack:K}});this.hls.trigger(G.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:O})}}},b._captionsOrSubtitlesFromCharacteristics=function(I){var w;if((w=I.attrs)!==null&&w!==void 0&&w.CHARACTERISTICS){var P=/transcribes-spoken-dialog/gi.test(I.attrs.CHARACTERISTICS),_=/describes-music-and-sound/gi.test(I.attrs.CHARACTERISTICS);if(P&&_)return"captions"}return"subtitles"},b.onManifestLoaded=function(I,w){var P=this;this.config.enableCEA708Captions&&w.captions&&w.captions.forEach(function(_){var v=/(?:CC|SERVICE)([1-4])/.exec(_.instreamId);if(v){var A="textTrack"+v[1],D=P.captionsProperties[A];D&&(D.label=_.name,_.lang&&(D.languageCode=_.lang),D.media=_)}})},b.closedCaptionsForLevel=function(I){var w=this.hls.levels[I.level];return w?.attrs["CLOSED-CAPTIONS"]},b.onFragLoading=function(I,w){var P=this.cea608Parser1,_=this.cea608Parser2,v=this.lastSn,A=this.lastPartIndex;if(this.enabled&&P&&_&&w.frag.type===W.PlaylistLevelType.MAIN){var D,O,K=w.frag.sn,k=(D=w==null||(O=w.part)===null||O===void 0?void 0:O.index)!=null?D:-1;K===v+1||K===v&&k===A+1||(P.reset(),_.reset()),this.lastSn=K,this.lastPartIndex=k}},b.onFragLoaded=function(I,w){var P=w.frag,_=w.payload,v=this.initPTS,A=this.unparsedVttFrags;if(P.type===W.PlaylistLevelType.SUBTITLE)if(_.byteLength){if(!(0,z.isFiniteNumber)(v[P.cc]))return A.push(w),void(v.length&&this.hls.trigger(G.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:P,error:new Error("Missing initial subtitle PTS")}));var D=P.decryptdata,O="stats"in w;if(D==null||D.key==null||D.method!=="AES-128"||O){var K=this.tracks[P.level],k=this.vttCCs;k[P.cc]||(k[P.cc]={start:P.start,prevCC:this.prevCC,new:!0},this.prevCC=P.cc),K&&K.textCodec===X.IMSC1_CODEC?this._parseIMSC1(P,_):this._parseVTTs(P,_,k)}}else this.hls.trigger(G.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:P,error:new Error("Empty subtitle payload")})},b._parseIMSC1=function(I,w){var P=this,_=this.hls;(0,X.parseIMSC1)(w,this.initPTS[I.cc],this.timescale[I.cc],function(v){P._appendCues(v,I.level),_.trigger(G.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:I})},function(v){se.logger.log("Failed to parse IMSC1: "+v),_.trigger(G.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:I,error:v})})},b._parseVTTs=function(I,w,P){var _,v=this,A=this.hls,D=(_=I.initSegment)!==null&&_!==void 0&&_.data?(0,ie.appendUint8Array)(I.initSegment.data,new Uint8Array(w)):w;(0,le.parseWebVTT)(D,this.initPTS[I.cc],this.timescale[I.cc],P,I.cc,I.start,function(O){v._appendCues(O,I.level),A.trigger(G.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:I})},function(O){v._fallbackToIMSC1(I,w),se.logger.log("Failed to parse VTT cue: "+O),A.trigger(G.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:I,error:O})})},b._fallbackToIMSC1=function(I,w){var P=this,_=this.tracks[I.level];_.textCodec||(0,X.parseIMSC1)(w,this.initPTS[I.cc],this.timescale[I.cc],function(){_.textCodec=X.IMSC1_CODEC,P._parseIMSC1(I,w)},function(){_.textCodec="wvtt"})},b._appendCues=function(I,w){var P=this.hls;if(this.config.renderTextTracksNatively){var _=this.textTracks[w];if(!_||_.mode==="disabled")return;I.forEach(function(D){return(0,Q.addCueToTrack)(_,D)})}else{var v=this.tracks[w];if(!v)return;var A=v.default?"default":"subtitles"+w;P.trigger(G.Events.CUES_PARSED,{type:"subtitles",cues:I,track:A})}},b.onFragDecrypted=function(I,w){var P=w.frag;if(P.type===W.PlaylistLevelType.SUBTITLE){if(!(0,z.isFiniteNumber)(this.initPTS[P.cc]))return void this.unparsedVttFrags.push(w);this.onFragLoaded(G.Events.FRAG_LOADED,w)}},b.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},b.onFragParsingUserdata=function(I,w){var P=this.cea608Parser1,_=this.cea608Parser2;if(this.enabled&&P&&_){var v=w.frag,A=w.samples;if(v.type!==W.PlaylistLevelType.MAIN||this.closedCaptionsForLevel(v)!=="NONE")for(var D=0;D<A.length;D++){var O=A[D].bytes;if(O){var K=this.extractCea608Data(O);P.addData(A[D].pts,K[0]),_.addData(A[D].pts,K[1])}}}},b.onBufferFlushing=function(I,w){var P=w.startOffset,_=w.endOffset,v=w.endOffsetSubtitles,A=w.type,D=this.media;if(D&&!(D.currentTime<_)){if(!A||A==="video"){var O=this.captionsTracks;Object.keys(O).forEach(function(k){return(0,Q.removeCuesInRange)(O[k],P,_)})}if(this.config.renderTextTracksNatively&&P===0&&v!==void 0){var K=this.textTracks;Object.keys(K).forEach(function(k){return(0,Q.removeCuesInRange)(K[k],P,v)})}}},b.extractCea608Data=function(I){for(var w=[[],[]],P=31&I[0],_=2,v=0;v<P;v++){var A=I[_++],D=127&I[_++],O=127&I[_++];if((D!==0||O!==0)&&4&A){var K=3&A;K!==0&&K!==1||(w[K].push(D),w[K].push(O))}}return w},M}();function V(M,b){return M&&M.label===b.name&&!(M.textTrack1||M.textTrack2)}},"./src/crypt/aes-crypto.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});var z=function(){function G(de,te){this.subtle=void 0,this.aesIV=void 0,this.subtle=de,this.aesIV=te}return G.prototype.decrypt=function(de,te){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},te,de)},G}()},"./src/crypt/aes-decryptor.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>de,removePadding:()=>G});var z=C("./src/utils/typed-array.ts");function G(te){var le=te.byteLength,Q=le&&new DataView(te.buffer).getUint8(le-1);return Q?(0,z.sliceUint8)(te,0,le-Q):te}var de=function(){function te(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var le=te.prototype;return le.uint8ArrayToUint32Array_=function(Q){for(var X=new DataView(Q),ie=new Uint32Array(4),W=0;W<4;W++)ie[W]=X.getUint32(4*W);return ie},le.initTable=function(){var Q=this.sBox,X=this.invSBox,ie=this.subMix,W=ie[0],se=ie[1],Y=ie[2],V=ie[3],M=this.invSubMix,b=M[0],I=M[1],w=M[2],P=M[3],_=new Uint32Array(256),v=0,A=0,D=0;for(D=0;D<256;D++)_[D]=D<128?D<<1:D<<1^283;for(D=0;D<256;D++){var O=A^A<<1^A<<2^A<<3^A<<4;O=O>>>8^255&O^99,Q[v]=O,X[O]=v;var K=_[v],k=_[K],L=_[k],R=257*_[O]^16843008*O;W[v]=R<<24|R>>>8,se[v]=R<<16|R>>>16,Y[v]=R<<8|R>>>24,V[v]=R,R=16843009*L^65537*k^257*K^16843008*v,b[O]=R<<24|R>>>8,I[O]=R<<16|R>>>16,w[O]=R<<8|R>>>24,P[O]=R,v?(v=K^_[_[_[L^K]]],A^=_[_[A]]):v=A=1}},le.expandKey=function(Q){for(var X=this.uint8ArrayToUint32Array_(Q),ie=!0,W=0;W<X.length&&ie;)ie=X[W]===this.key[W],W++;if(!ie){this.key=X;var se=this.keySize=X.length;if(se!==4&&se!==6&&se!==8)throw new Error("Invalid aes key size="+se);var Y,V,M,b,I=this.ksRows=4*(se+6+1),w=this.keySchedule=new Uint32Array(I),P=this.invKeySchedule=new Uint32Array(I),_=this.sBox,v=this.rcon,A=this.invSubMix,D=A[0],O=A[1],K=A[2],k=A[3];for(Y=0;Y<I;Y++)Y<se?M=w[Y]=X[Y]:(b=M,Y%se==0?(b=_[(b=b<<8|b>>>24)>>>24]<<24|_[b>>>16&255]<<16|_[b>>>8&255]<<8|_[255&b],b^=v[Y/se|0]<<24):se>6&&Y%se==4&&(b=_[b>>>24]<<24|_[b>>>16&255]<<16|_[b>>>8&255]<<8|_[255&b]),w[Y]=M=(w[Y-se]^b)>>>0);for(V=0;V<I;V++)Y=I-V,b=3&V?w[Y]:w[Y-4],P[V]=V<4||Y<=4?b:D[_[b>>>24]]^O[_[b>>>16&255]]^K[_[b>>>8&255]]^k[_[255&b]],P[V]=P[V]>>>0}},le.networkToHostOrderSwap=function(Q){return Q<<24|(65280&Q)<<8|(16711680&Q)>>8|Q>>>24},le.decrypt=function(Q,X,ie){for(var W,se,Y,V,M,b,I,w,P,_,v,A,D,O,K=this.keySize+6,k=this.invKeySchedule,L=this.invSBox,R=this.invSubMix,Z=R[0],ae=R[1],fe=R[2],ce=R[3],me=this.uint8ArrayToUint32Array_(ie),Ee=me[0],be=me[1],Re=me[2],Ce=me[3],Ne=new Int32Array(Q),Ue=new Int32Array(Ne.length),Xe=this.networkToHostOrderSwap;X<Ne.length;){for(P=Xe(Ne[X]),_=Xe(Ne[X+1]),v=Xe(Ne[X+2]),A=Xe(Ne[X+3]),M=P^k[0],b=A^k[1],I=v^k[2],w=_^k[3],D=4,O=1;O<K;O++)W=Z[M>>>24]^ae[b>>16&255]^fe[I>>8&255]^ce[255&w]^k[D],se=Z[b>>>24]^ae[I>>16&255]^fe[w>>8&255]^ce[255&M]^k[D+1],Y=Z[I>>>24]^ae[w>>16&255]^fe[M>>8&255]^ce[255&b]^k[D+2],V=Z[w>>>24]^ae[M>>16&255]^fe[b>>8&255]^ce[255&I]^k[D+3],M=W,b=se,I=Y,w=V,D+=4;W=L[M>>>24]<<24^L[b>>16&255]<<16^L[I>>8&255]<<8^L[255&w]^k[D],se=L[b>>>24]<<24^L[I>>16&255]<<16^L[w>>8&255]<<8^L[255&M]^k[D+1],Y=L[I>>>24]<<24^L[w>>16&255]<<16^L[M>>8&255]<<8^L[255&b]^k[D+2],V=L[w>>>24]<<24^L[M>>16&255]<<16^L[b>>8&255]<<8^L[255&I]^k[D+3],Ue[X]=Xe(W^Ee),Ue[X+1]=Xe(V^be),Ue[X+2]=Xe(Y^Re),Ue[X+3]=Xe(se^Ce),Ee=P,be=_,Re=v,Ce=A,X+=4}return Ue.buffer},te}()},"./src/crypt/decrypter.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>X});var z=C("./src/crypt/aes-crypto.ts"),G=C("./src/crypt/fast-aes-key.ts"),de=C("./src/crypt/aes-decryptor.ts"),te=C("./src/utils/logger.ts"),le=C("./src/utils/mp4-tools.ts"),Q=C("./src/utils/typed-array.ts"),X=function(){function ie(se,Y,V){var M=(V===void 0?{}:V).removePKCS7Padding,b=M===void 0||M;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=se,this.config=Y,this.removePKCS7Padding=b,b)try{var I=self.crypto;I&&(this.subtle=I.subtle||I.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var W=ie.prototype;return W.destroy=function(){this.observer=null},W.isSync=function(){return this.config.enableSoftwareAES},W.flush=function(){var se=this.currentResult;if(se){var Y=new Uint8Array(se);return this.reset(),this.removePKCS7Padding?(0,de.removePadding)(Y):Y}this.reset()},W.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},W.decrypt=function(se,Y,V,M){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(se),Y,V);var b=this.flush();b&&M(b.buffer)}else this.webCryptoDecrypt(new Uint8Array(se),Y,V).then(M)},W.softwareDecrypt=function(se,Y,V){var M=this.currentIV,b=this.currentResult,I=this.remainderData;this.logOnce("JS AES decrypt"),I&&(se=(0,le.appendUint8Array)(I,se),this.remainderData=null);var w=this.getValidChunk(se);if(!w.length)return null;M&&(V=M);var P=this.softwareDecrypter;P||(P=this.softwareDecrypter=new de.default),P.expandKey(Y);var _=b;return this.currentResult=P.decrypt(w.buffer,0,V),this.currentIV=(0,Q.sliceUint8)(w,-16).buffer,_||null},W.webCryptoDecrypt=function(se,Y,V){var M=this,b=this.subtle;return this.key===Y&&this.fastAesKey||(this.key=Y,this.fastAesKey=new G.default(b,Y)),this.fastAesKey.expandKey().then(function(I){return b?new z.default(b,V).decrypt(se.buffer,I):Promise.reject(new Error("web crypto not initialized"))}).catch(function(I){return M.onWebCryptoError(I,se,Y,V)})},W.onWebCryptoError=function(se,Y,V,M){return te.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",se),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(Y,V,M)},W.getValidChunk=function(se){var Y=se,V=se.length-se.length%16;return V!==se.length&&(Y=(0,Q.sliceUint8)(se,0,V),this.remainderData=(0,Q.sliceUint8)(se,V)),Y},W.logOnce=function(se){this.logEnabled&&(te.logger.log("[decrypter.ts]: "+se),this.logEnabled=!1)},ie}()},"./src/crypt/fast-aes-key.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});var z=function(){function G(de,te){this.subtle=void 0,this.key=void 0,this.subtle=de,this.key=te}return G.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},G}()},"./src/demux/aacdemuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>Q});var z=C("./src/demux/base-audio-demuxer.ts"),G=C("./src/demux/adts.ts"),de=C("./src/utils/logger.ts"),te=C("./src/demux/id3.ts");function le(X,ie){return le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(W,se){return W.__proto__=se,W},le(X,ie)}const Q=function(X){var ie,W;function se(V,M){var b;return(b=X.call(this)||this).observer=void 0,b.config=void 0,b.observer=V,b.config=M,b}W=X,(ie=se).prototype=Object.create(W.prototype),ie.prototype.constructor=ie,le(ie,W);var Y=se.prototype;return Y.resetInitSegment=function(V,M,b,I){X.prototype.resetInitSegment.call(this,V,M,b,I),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:M,duration:I,inputTimeScale:9e4,dropped:0}},se.probe=function(V){if(!V)return!1;for(var M=(te.getID3Data(V,0)||[]).length,b=V.length;M<b;M++)if(G.probe(V,M))return de.logger.log("ADTS sync word found !"),!0;return!1},Y.canParse=function(V,M){return G.canParse(V,M)},Y.appendFrame=function(V,M,b){G.initTrackConfig(V,this.observer,M,b,V.manifestCodec);var I=G.appendFrame(V,M,b,this.basePTS,this.frameIndex);if(I&&I.missing===0)return I},se}(z.default)},"./src/demux/adts.ts":(F,re,C)=>{C.r(re),C.d(re,{appendFrame:()=>I,canGetFrameLength:()=>ie,canParse:()=>se,getAudioConfig:()=>te,getFrameDuration:()=>M,getFullFrameLength:()=>X,getHeaderLength:()=>Q,initTrackConfig:()=>V,isHeader:()=>W,isHeaderPattern:()=>le,parseFrameHeader:()=>b,probe:()=>Y});var z=C("./src/utils/logger.ts"),G=C("./src/errors.ts"),de=C("./src/events.ts");function te(w,P,_,v){var A,D,O,K,k=navigator.userAgent.toLowerCase(),L=v,R=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];A=1+((192&P[_+2])>>>6);var Z=(60&P[_+2])>>>2;if(!(Z>R.length-1))return O=(1&P[_+2])<<2,O|=(192&P[_+3])>>>6,z.logger.log("manifest codec:"+v+", ADTS type:"+A+", samplingIndex:"+Z),/firefox/i.test(k)?Z>=6?(A=5,K=new Array(4),D=Z-3):(A=2,K=new Array(2),D=Z):k.indexOf("android")!==-1?(A=2,K=new Array(2),D=Z):(A=5,K=new Array(4),v&&(v.indexOf("mp4a.40.29")!==-1||v.indexOf("mp4a.40.5")!==-1)||!v&&Z>=6?D=Z-3:((v&&v.indexOf("mp4a.40.2")!==-1&&(Z>=6&&O===1||/vivaldi/i.test(k))||!v&&O===1)&&(A=2,K=new Array(2)),D=Z)),K[0]=A<<3,K[0]|=(14&Z)>>1,K[1]|=(1&Z)<<7,K[1]|=O<<3,A===5&&(K[1]|=(14&D)>>1,K[2]=(1&D)<<7,K[2]|=8,K[3]=0),{config:K,samplerate:R[Z],channelCount:O,codec:"mp4a.40."+A,manifestCodec:L};w.trigger(de.Events.ERROR,{type:G.ErrorTypes.MEDIA_ERROR,details:G.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+Z})}function le(w,P){return w[P]===255&&(246&w[P+1])==240}function Q(w,P){return 1&w[P+1]?7:9}function X(w,P){return(3&w[P+3])<<11|w[P+4]<<3|(224&w[P+5])>>>5}function ie(w,P){return P+5<w.length}function W(w,P){return P+1<w.length&&le(w,P)}function se(w,P){return ie(w,P)&&le(w,P)&&X(w,P)<=w.length-P}function Y(w,P){if(W(w,P)){var _=Q(w,P);if(P+_>=w.length)return!1;var v=X(w,P);if(v<=_)return!1;var A=P+v;return A===w.length||W(w,A)}return!1}function V(w,P,_,v,A){if(!w.samplerate){var D=te(P,_,v,A);if(!D)return;w.config=D.config,w.samplerate=D.samplerate,w.channelCount=D.channelCount,w.codec=D.codec,w.manifestCodec=D.manifestCodec,z.logger.log("parsed codec:"+w.codec+", rate:"+D.samplerate+", channels:"+D.channelCount)}}function M(w){return 9216e4/w}function b(w,P){var _=Q(w,P);if(P+_<=w.length){var v=X(w,P)-_;if(v>0)return{headerLength:_,frameLength:v}}}function I(w,P,_,v,A){var D,O=v+A*M(w.samplerate),K=b(P,_);if(K){var k=K.frameLength,L=K.headerLength,R=L+k,Z=Math.max(0,_+R-P.length);Z?(D=new Uint8Array(R-L)).set(P.subarray(_+L,P.length),0):D=P.subarray(_+L,_+R);var ae={unit:D,pts:O};return Z||w.samples.push(ae),{sample:ae,length:R,missing:Z}}var fe=P.length-_;return(D=new Uint8Array(fe)).set(P.subarray(_,P.length),0),{sample:{unit:D,pts:O},length:fe,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>W,initPTSFn:()=>ie});var z=C("./src/polyfills/number.ts"),G=C("./src/demux/id3.ts"),de=C("./src/types/demuxer.ts"),te=C("./src/demux/dummy-demuxed-track.ts"),le=C("./src/utils/mp4-tools.ts"),Q=C("./src/utils/typed-array.ts"),X=function(){function se(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var Y=se.prototype;return Y.resetInitSegment=function(V,M,b,I){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},Y.resetTimeStamp=function(V){this.initPTS=V,this.resetContiguity()},Y.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},Y.canParse=function(V,M){return!1},Y.appendFrame=function(V,M,b){},Y.demux=function(V,M){this.cachedData&&(V=(0,le.appendUint8Array)(this.cachedData,V),this.cachedData=null);var b,I=G.getID3Data(V,0),w=I?I.length:0,P=this._audioTrack,_=this._id3Track,v=I?G.getTimeStamp(I):void 0,A=V.length;for((this.basePTS===null||this.frameIndex===0&&(0,z.isFiniteNumber)(v))&&(this.basePTS=ie(v,M,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),I&&I.length>0&&_.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:I,type:de.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});w<A;){if(this.canParse(V,w)){var D=this.appendFrame(P,V,w);D?(this.frameIndex++,this.lastPTS=D.sample.pts,b=w+=D.length):w=A}else G.canParse(V,w)?(I=G.getID3Data(V,w),_.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:I,type:de.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),b=w+=I.length):w++;if(w===A&&b!==A){var O=(0,Q.sliceUint8)(V,b);this.cachedData?this.cachedData=(0,le.appendUint8Array)(this.cachedData,O):this.cachedData=O}}return{audioTrack:P,videoTrack:(0,te.dummyTrack)(),id3Track:_,textTrack:(0,te.dummyTrack)()}},Y.demuxSampleAes=function(V,M,b){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},Y.flush=function(V){var M=this.cachedData;return M&&(this.cachedData=null,this.demux(M,0)),{audioTrack:this._audioTrack,videoTrack:(0,te.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,te.dummyTrack)()}},Y.destroy=function(){},se}(),ie=function(se,Y,V){return(0,z.isFiniteNumber)(se)?90*se:9e4*Y+(V||0)};const W=X},"./src/demux/chunk-cache.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});var z=function(){function G(){this.chunks=[],this.dataLength=0}var de=G.prototype;return de.push=function(te){this.chunks.push(te),this.dataLength+=te.length},de.flush=function(){var te,le=this.chunks,Q=this.dataLength;return le.length?(te=le.length===1?le[0]:function(X,ie){for(var W=new Uint8Array(ie),se=0,Y=0;Y<X.length;Y++){var V=X[Y];W.set(V,se),se+=V.length}return W}(le,Q),this.reset(),te):new Uint8Array(0)},de.reset=function(){this.chunks.length=0,this.dataLength=0},G}()},"./src/demux/dummy-demuxed-track.ts":(F,re,C)=>{function z(G,de){return G===void 0&&(G=""),de===void 0&&(de=9e4),{type:G,id:-1,pid:-1,inputTimeScale:de,sequenceNumber:-1,samples:[],dropped:0}}C.r(re),C.d(re,{dummyTrack:()=>z})},"./src/demux/exp-golomb.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>G});var z=C("./src/utils/logger.ts");const G=function(){function de(le){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=le,this.bytesAvailable=le.byteLength,this.word=0,this.bitsAvailable=0}var te=de.prototype;return te.loadWord=function(){var le=this.data,Q=this.bytesAvailable,X=le.byteLength-Q,ie=new Uint8Array(4),W=Math.min(4,Q);if(W===0)throw new Error("no bytes available");ie.set(le.subarray(X,X+W)),this.word=new DataView(ie.buffer).getUint32(0),this.bitsAvailable=8*W,this.bytesAvailable-=W},te.skipBits=function(le){var Q;this.bitsAvailable>le?(this.word<<=le,this.bitsAvailable-=le):(le-=this.bitsAvailable,le-=(Q=le>>3)>>3,this.bytesAvailable-=Q,this.loadWord(),this.word<<=le,this.bitsAvailable-=le)},te.readBits=function(le){var Q=Math.min(this.bitsAvailable,le),X=this.word>>>32-Q;return le>32&&z.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=Q,this.bitsAvailable>0?this.word<<=Q:this.bytesAvailable>0&&this.loadWord(),(Q=le-Q)>0&&this.bitsAvailable?X<<Q|this.readBits(Q):X},te.skipLZ=function(){var le;for(le=0;le<this.bitsAvailable;++le)if(this.word&2147483648>>>le)return this.word<<=le,this.bitsAvailable-=le,le;return this.loadWord(),le+this.skipLZ()},te.skipUEG=function(){this.skipBits(1+this.skipLZ())},te.skipEG=function(){this.skipBits(1+this.skipLZ())},te.readUEG=function(){var le=this.skipLZ();return this.readBits(le+1)-1},te.readEG=function(){var le=this.readUEG();return 1&le?1+le>>>1:-1*(le>>>1)},te.readBoolean=function(){return this.readBits(1)===1},te.readUByte=function(){return this.readBits(8)},te.readUShort=function(){return this.readBits(16)},te.readUInt=function(){return this.readBits(32)},te.skipScalingList=function(le){for(var Q=8,X=8,ie=0;ie<le;ie++)X!==0&&(X=(Q+this.readEG()+256)%256),Q=X===0?Q:X},te.readSPS=function(){var le,Q,X,ie=0,W=0,se=0,Y=0,V=this.readUByte.bind(this),M=this.readBits.bind(this),b=this.readUEG.bind(this),I=this.readBoolean.bind(this),w=this.skipBits.bind(this),P=this.skipEG.bind(this),_=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);V();var A=V();if(M(5),w(3),V(),_(),A===100||A===110||A===122||A===244||A===44||A===83||A===86||A===118||A===128){var D=b();if(D===3&&w(1),_(),_(),w(1),I())for(Q=D!==3?8:12,X=0;X<Q;X++)I()&&v(X<6?16:64)}_();var O=b();if(O===0)b();else if(O===1)for(w(1),P(),P(),le=b(),X=0;X<le;X++)P();_(),w(1);var K=b(),k=b(),L=M(1);L===0&&w(1),w(1),I()&&(ie=b(),W=b(),se=b(),Y=b());var R=[1,1];if(I()&&I())switch(V()){case 1:R=[1,1];break;case 2:R=[12,11];break;case 3:R=[10,11];break;case 4:R=[16,11];break;case 5:R=[40,33];break;case 6:R=[24,11];break;case 7:R=[20,11];break;case 8:R=[32,11];break;case 9:R=[80,33];break;case 10:R=[18,11];break;case 11:R=[15,11];break;case 12:R=[64,33];break;case 13:R=[160,99];break;case 14:R=[4,3];break;case 15:R=[3,2];break;case 16:R=[2,1];break;case 255:R=[V()<<8|V(),V()<<8|V()]}return{width:Math.ceil(16*(K+1)-2*ie-2*W),height:(2-L)*(k+1)*16-(L?2:4)*(se+Y),pixelRatio:R}},te.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},de}()},"./src/demux/id3.ts":(F,re,C)=>{C.r(re),C.d(re,{canParse:()=>Q,decodeFrame:()=>Y,getID3Data:()=>te,getID3Frames:()=>se,getTimeStamp:()=>X,isFooter:()=>de,isHeader:()=>G,isTimeStampFrame:()=>ie,testables:()=>P,utf8ArrayToStr:()=>w});var z,G=function(v,A){return A+10<=v.length&&v[A]===73&&v[A+1]===68&&v[A+2]===51&&v[A+3]<255&&v[A+4]<255&&v[A+6]<128&&v[A+7]<128&&v[A+8]<128&&v[A+9]<128},de=function(v,A){return A+10<=v.length&&v[A]===51&&v[A+1]===68&&v[A+2]===73&&v[A+3]<255&&v[A+4]<255&&v[A+6]<128&&v[A+7]<128&&v[A+8]<128&&v[A+9]<128},te=function(v,A){for(var D=A,O=0;G(v,A);)O+=10,O+=le(v,A+6),de(v,A+10)&&(O+=10),A+=O;if(O>0)return v.subarray(D,D+O)},le=function(v,A){var D=0;return D=(127&v[A])<<21,D|=(127&v[A+1])<<14,D|=(127&v[A+2])<<7,D|=127&v[A+3]},Q=function(v,A){return G(v,A)&&le(v,A+6)+10<=v.length-A},X=function(v){for(var A=se(v),D=0;D<A.length;D++){var O=A[D];if(ie(O))return I(O)}},ie=function(v){return v&&v.key==="PRIV"&&v.info==="com.apple.streaming.transportStreamTimestamp"},W=function(v){var A=String.fromCharCode(v[0],v[1],v[2],v[3]),D=le(v,4);return{type:A,size:D,data:v.subarray(10,10+D)}},se=function(v){for(var A=0,D=[];G(v,A);){for(var O=le(v,A+6),K=(A+=10)+O;A+8<K;){var k=W(v.subarray(A)),L=Y(k);L&&D.push(L),A+=k.size+10}de(v,A)&&(A+=10)}return D},Y=function(v){return v.type==="PRIV"?V(v):v.type[0]==="W"?b(v):M(v)},V=function(v){if(!(v.size<2)){var A=w(v.data,!0),D=new Uint8Array(v.data.subarray(A.length+1));return{key:v.type,info:A,data:D.buffer}}},M=function(v){if(!(v.size<2)){if(v.type==="TXXX"){var A=1,D=w(v.data.subarray(A),!0);A+=D.length+1;var O=w(v.data.subarray(A));return{key:v.type,info:D,data:O}}var K=w(v.data.subarray(1));return{key:v.type,data:K}}},b=function(v){if(v.type==="WXXX"){if(v.size<2)return;var A=1,D=w(v.data.subarray(A),!0);A+=D.length+1;var O=w(v.data.subarray(A));return{key:v.type,info:D,data:O}}var K=w(v.data);return{key:v.type,data:K}},I=function(v){if(v.data.byteLength===8){var A=new Uint8Array(v.data),D=1&A[3],O=(A[4]<<23)+(A[5]<<15)+(A[6]<<7)+A[7];return O/=45,D&&(O+=4772185884e-2),Math.round(O)}},w=function(v,A){A===void 0&&(A=!1);var D=_();if(D){var O=D.decode(v);if(A){var K=O.indexOf("\0");return K!==-1?O.substring(0,K):O}return O.replace(/\0/g,"")}for(var k,L,R,Z=v.length,ae="",fe=0;fe<Z;){if((k=v[fe++])===0&&A)return ae;if(k!==0&&k!==3)switch(k>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:ae+=String.fromCharCode(k);break;case 12:case 13:L=v[fe++],ae+=String.fromCharCode((31&k)<<6|63&L);break;case 14:L=v[fe++],R=v[fe++],ae+=String.fromCharCode((15&k)<<12|(63&L)<<6|(63&R)<<0)}}return ae},P={decodeTextFrame:M};function _(){return z||self.TextDecoder===void 0||(z=new self.TextDecoder("utf-8")),z}},"./src/demux/mp3demuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>X});var z=C("./src/demux/base-audio-demuxer.ts"),G=C("./src/demux/id3.ts"),de=C("./src/utils/logger.ts"),te=C("./src/demux/mpegaudio.ts");function le(ie,W){return le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(se,Y){return se.__proto__=Y,se},le(ie,W)}var Q=function(ie){var W,se;function Y(){return ie.apply(this,arguments)||this}se=ie,(W=Y).prototype=Object.create(se.prototype),W.prototype.constructor=W,le(W,se);var V=Y.prototype;return V.resetInitSegment=function(M,b,I,w){ie.prototype.resetInitSegment.call(this,M,b,I,w),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:b,duration:w,inputTimeScale:9e4,dropped:0}},Y.probe=function(M){if(!M)return!1;for(var b=(G.getID3Data(M,0)||[]).length,I=M.length;b<I;b++)if(te.probe(M,b))return de.logger.log("MPEG Audio sync word found !"),!0;return!1},V.canParse=function(M,b){return te.canParse(M,b)},V.appendFrame=function(M,b,I){if(this.basePTS!==null)return te.appendFrame(M,b,I,this.basePTS,this.frameIndex)},Y}(z.default);const X=Q},"./src/demux/mp4demuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>Q});var z=C("./src/polyfills/number.ts"),G=C("./src/types/demuxer.ts"),de=C("./src/utils/mp4-tools.ts"),te=C("./src/demux/dummy-demuxed-track.ts"),le=/\/emsg[-/]ID3/i;const Q=function(){function X(W,se){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=se}var ie=X.prototype;return ie.resetTimeStamp=function(){},ie.resetInitSegment=function(W,se,Y,V){var M=(0,de.parseInitSegment)(W),b=this.videoTrack=(0,te.dummyTrack)("video",1),I=this.audioTrack=(0,te.dummyTrack)("audio",1),w=this.txtTrack=(0,te.dummyTrack)("text",1);if(this.id3Track=(0,te.dummyTrack)("id3",1),this.timeOffset=0,M.video){var P=M.video,_=P.id,v=P.timescale,A=P.codec;b.id=_,b.timescale=w.timescale=v,b.codec=A}if(M.audio){var D=M.audio,O=D.id,K=D.timescale,k=D.codec;I.id=O,I.timescale=K,I.codec=k}w.id=de.RemuxerTrackIdConfig.text,b.sampleDuration=0,b.duration=I.duration=V},ie.resetContiguity=function(){},X.probe=function(W){return W=W.length>16384?W.subarray(0,16384):W,(0,de.findBox)(W,["moof"]).length>0},ie.demux=function(W,se){this.timeOffset=se;var Y=W,V=this.videoTrack,M=this.txtTrack;if(this.config.progressive){this.remainderData&&(Y=(0,de.appendUint8Array)(this.remainderData,W));var b=(0,de.segmentValidRange)(Y);this.remainderData=b.remainder,V.samples=b.valid||new Uint8Array}else V.samples=Y;var I=this.extractID3Track(V,se);return M.samples=(0,de.parseSamples)(se,V),{videoTrack:V,audioTrack:this.audioTrack,id3Track:I,textTrack:this.txtTrack}},ie.flush=function(){var W=this.timeOffset,se=this.videoTrack,Y=this.txtTrack;se.samples=this.remainderData||new Uint8Array,this.remainderData=null;var V=this.extractID3Track(se,this.timeOffset);return Y.samples=(0,de.parseSamples)(W,se),{videoTrack:se,audioTrack:(0,te.dummyTrack)(),id3Track:V,textTrack:(0,te.dummyTrack)()}},ie.extractID3Track=function(W,se){var Y=this.id3Track;if(W.samples.length){var V=(0,de.findBox)(W.samples,["emsg"]);V&&V.forEach(function(M){var b=(0,de.parseEmsg)(M);if(le.test(b.schemeIdUri)){var I=(0,z.isFiniteNumber)(b.presentationTime)?b.presentationTime/b.timeScale:se+b.presentationTimeDelta/b.timeScale,w=b.eventDuration===4294967295?Number.POSITIVE_INFINITY:b.eventDuration/b.timeScale;w<=.001&&(w=Number.POSITIVE_INFINITY);var P=b.payload;Y.samples.push({data:P,len:P.byteLength,dts:I,pts:I,type:G.MetadataSchema.emsg,duration:w})}})}return Y},ie.demuxSampleAes=function(W,se,Y){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},ie.destroy=function(){},X}()},"./src/demux/mpegaudio.ts":(F,re,C)=>{C.r(re),C.d(re,{appendFrame:()=>Q,canParse:()=>se,isHeader:()=>W,isHeaderPattern:()=>ie,parseHeader:()=>X,probe:()=>Y});var z=null,G=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],de=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],te=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],le=[0,1,1,4];function Q(V,M,b,I,w){if(!(b+24>M.length)){var P=X(M,b);if(P&&b+P.frameLength<=M.length){var _=I+w*(9e4*P.samplesPerFrame/P.sampleRate),v={unit:M.subarray(b,b+P.frameLength),pts:_,dts:_};return V.config=[],V.channelCount=P.channelCount,V.samplerate=P.sampleRate,V.samples.push(v),{sample:v,length:P.frameLength,missing:0}}}}function X(V,M){var b=V[M+1]>>3&3,I=V[M+1]>>1&3,w=V[M+2]>>4&15,P=V[M+2]>>2&3;if(b!==1&&w!==0&&w!==15&&P!==3){var _=V[M+2]>>1&1,v=V[M+3]>>6,A=1e3*G[14*(b===3?3-I:I===3?3:4)+w-1],D=de[3*(b===3?0:b===2?1:2)+P],O=v===3?1:2,K=te[b][I],k=le[I],L=8*K*k,R=Math.floor(K*A/D+_)*k;if(z===null){var Z=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);z=Z?parseInt(Z[1]):0}return z&&z<=87&&I===2&&A>=224e3&&v===0&&(V[M+3]=128|V[M+3]),{sampleRate:D,channelCount:O,frameLength:R,samplesPerFrame:L}}}function ie(V,M){return V[M]===255&&(224&V[M+1])==224&&(6&V[M+1])!=0}function W(V,M){return M+1<V.length&&ie(V,M)}function se(V,M){return ie(V,M)&&4<=V.length-M}function Y(V,M){if(M+1<V.length&&ie(V,M)){var b=X(V,M),I=4;b!=null&&b.frameLength&&(I=b.frameLength);var w=M+I;return w===V.length||W(V,w)}return!1}},"./src/demux/sample-aes.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>de});var z=C("./src/crypt/decrypter.ts"),G=C("./src/utils/mp4-tools.ts");const de=function(){function te(Q,X,ie){this.keyData=void 0,this.decrypter=void 0,this.keyData=ie,this.decrypter=new z.default(Q,X,{removePKCS7Padding:!1})}var le=te.prototype;return le.decryptBuffer=function(Q,X){this.decrypter.decrypt(Q,this.keyData.key.buffer,this.keyData.iv.buffer,X)},le.decryptAacSample=function(Q,X,ie,W){var se=Q[X].unit;if(!(se.length<=16)){var Y=se.subarray(16,se.length-se.length%16),V=Y.buffer.slice(Y.byteOffset,Y.byteOffset+Y.length),M=this;this.decryptBuffer(V,function(b){var I=new Uint8Array(b);se.set(I,16),W||M.decryptAacSamples(Q,X+1,ie)})}},le.decryptAacSamples=function(Q,X,ie){for(;;X++){if(X>=Q.length)return void ie();if(!(Q[X].unit.length<32)){var W=this.decrypter.isSync();if(this.decryptAacSample(Q,X,ie,W),!W)return}}},le.getAvcEncryptedData=function(Q){for(var X=16*Math.floor((Q.length-48)/160)+16,ie=new Int8Array(X),W=0,se=32;se<Q.length-16;se+=160,W+=16)ie.set(Q.subarray(se,se+16),W);return ie},le.getAvcDecryptedUnit=function(Q,X){for(var ie=new Uint8Array(X),W=0,se=32;se<Q.length-16;se+=160,W+=16)Q.set(ie.subarray(W,W+16),se);return Q},le.decryptAvcSample=function(Q,X,ie,W,se,Y){var V=(0,G.discardEPB)(se.data),M=this.getAvcEncryptedData(V),b=this;this.decryptBuffer(M.buffer,function(I){se.data=b.getAvcDecryptedUnit(V,I),Y||b.decryptAvcSamples(Q,X,ie+1,W)})},le.decryptAvcSamples=function(Q,X,ie,W){if(Q instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;X++,ie=0){if(X>=Q.length)return void W();for(var se=Q[X].units;!(ie>=se.length);ie++){var Y=se[ie];if(!(Y.data.length<=48||Y.type!==1&&Y.type!==5)){var V=this.decrypter.isSync();if(this.decryptAvcSample(Q,X,ie,W,Y,V),!V)return}}}},te}()},"./src/demux/transmuxer-interface.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>W});var z=C("./src/demux/webworkify-webpack.js"),G=C("./src/events.ts"),de=C("./src/demux/transmuxer.ts"),te=C("./src/utils/logger.ts"),le=C("./src/errors.ts"),Q=C("./src/utils/mediasource-helper.ts"),X=C("./node_modules/eventemitter3/index.js"),ie=(0,Q.getMediaSource)()||{isTypeSupported:function(){return!1}},W=function(){function se(V,M,b,I){var w=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var P=V.config;this.hls=V,this.id=M,this.useWorker=!!P.enableWorker,this.onTransmuxComplete=b,this.onFlush=I;var _=function(O,K){(K=K||{}).frag=w.frag,K.id=w.id,w.hls.trigger(O,K)};this.observer=new X.EventEmitter,this.observer.on(G.Events.FRAG_DECRYPTED,_),this.observer.on(G.Events.ERROR,_);var v={mp4:ie.isTypeSupported("video/mp4"),mpeg:ie.isTypeSupported("audio/mpeg"),mp3:ie.isTypeSupported('audio/mp4; codecs="mp3"')},A=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){var D;te.logger.log("demuxing in webworker");try{D=this.worker=(0,z.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),D.addEventListener("message",this.onwmsg),D.onerror=function(O){w.useWorker=!1,te.logger.warn("Exception in webworker, fallback to inline"),w.hls.trigger(G.Events.ERROR,{type:le.ErrorTypes.OTHER_ERROR,details:le.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(O.message+"  ("+O.filename+":"+O.lineno+")")})},D.postMessage({cmd:"init",typeSupported:v,vendor:A,id:M,config:JSON.stringify(P)})}catch(O){te.logger.warn("Error in worker:",O),te.logger.error("Error while initializing DemuxerWorker, fallback to inline"),D&&self.URL.revokeObjectURL(D.objectURL),this.transmuxer=new de.default(this.observer,v,P,A,M),this.worker=null}}else this.transmuxer=new de.default(this.observer,v,P,A,M)}var Y=se.prototype;return Y.destroy=function(){var V=this.worker;if(V)V.removeEventListener("message",this.onwmsg),V.terminate(),this.worker=null,this.onwmsg=void 0;else{var M=this.transmuxer;M&&(M.destroy(),this.transmuxer=null)}var b=this.observer;b&&b.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},Y.push=function(V,M,b,I,w,P,_,v,A,D){var O,K,k=this;A.transmuxing.start=self.performance.now();var L=this.transmuxer,R=this.worker,Z=P?P.start:w.start,ae=w.decryptdata,fe=this.frag,ce=!(fe&&w.cc===fe.cc),me=!(fe&&A.level===fe.level),Ee=fe?A.sn-fe.sn:-1,be=this.part?A.part-this.part.index:-1,Re=Ee===0&&A.id>1&&A.id===fe?.stats.chunkCount,Ce=!me&&(Ee===1||Ee===0&&(be===1||Re&&be<=0)),Ne=self.performance.now();(me||Ee||w.stats.parsing.start===0)&&(w.stats.parsing.start=Ne),!P||!be&&Ce||(P.stats.parsing.start=Ne);var Ue=!(fe&&((O=w.initSegment)===null||O===void 0?void 0:O.url)===((K=fe.initSegment)===null||K===void 0?void 0:K.url)),Xe=new de.TransmuxState(ce,Ce,v,me,Z,Ue);if(!Ce||ce||Ue){te.logger.log("[transmuxer-interface, "+w.type+"]: Starting new transmux session for sn: "+A.sn+" p: "+A.part+" level: "+A.level+" id: "+A.id+`
        discontinuity: `+ce+`
        trackSwitch: `+me+`
        contiguous: `+Ce+`
        accurateTimeOffset: `+v+`
        timeOffset: `+Z+`
        initSegmentChange: `+Ue);var ut=new de.TransmuxConfig(b,I,M,_,D);this.configureTransmuxer(ut)}if(this.frag=w,this.part=P,R)R.postMessage({cmd:"demux",data:V,decryptdata:ae,chunkMeta:A,state:Xe},V instanceof ArrayBuffer?[V]:[]);else if(L){var gt=L.push(V,ae,A,Xe);(0,de.isPromise)(gt)?gt.then(function(ft){k.handleTransmuxComplete(ft)}):this.handleTransmuxComplete(gt)}},Y.flush=function(V){var M=this;V.transmuxing.start=self.performance.now();var b=this.transmuxer,I=this.worker;if(I)I.postMessage({cmd:"flush",chunkMeta:V});else if(b){var w=b.flush(V);(0,de.isPromise)(w)?w.then(function(P){M.handleFlushResult(P,V)}):this.handleFlushResult(w,V)}},Y.handleFlushResult=function(V,M){var b=this;V.forEach(function(I){b.handleTransmuxComplete(I)}),this.onFlush(M)},Y.onWorkerMessage=function(V){var M=V.data,b=this.hls;switch(M.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(M.data);break;case"flush":this.onFlush(M.data);break;case"workerLog":te.logger[M.data.logType]&&te.logger[M.data.logType](M.data.message);break;default:M.data=M.data||{},M.data.frag=this.frag,M.data.id=this.id,b.trigger(M.event,M.data)}},Y.configureTransmuxer=function(V){var M=this.worker,b=this.transmuxer;M?M.postMessage({cmd:"configure",config:V}):b&&b.configure(V)},Y.handleTransmuxComplete=function(V){V.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(V)},se}()},"./src/demux/transmuxer-worker.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>le});var z=C("./src/demux/transmuxer.ts"),G=C("./src/events.ts"),de=C("./src/utils/logger.ts"),te=C("./node_modules/eventemitter3/index.js");function le(W){var se=new te.EventEmitter,Y=function(V,M){W.postMessage({event:V,data:M})};se.on(G.Events.FRAG_DECRYPTED,Y),se.on(G.Events.ERROR,Y),W.addEventListener("message",function(V){var M=V.data;switch(M.cmd){case"init":var b=JSON.parse(M.config);W.transmuxer=new z.default(se,M.typeSupported,b,M.vendor,M.id),(0,de.enableLogs)(b.debug,M.id),function(){var _=function(A){de.logger[A]=function(D){Y("workerLog",{logType:A,message:D})}};for(var v in de.logger)_(v)}(),Y("init",null);break;case"configure":W.transmuxer.configure(M.config);break;case"demux":var I=W.transmuxer.push(M.data,M.decryptdata,M.chunkMeta,M.state);(0,z.isPromise)(I)?I.then(function(_){Q(W,_)}):Q(W,I);break;case"flush":var w=M.chunkMeta,P=W.transmuxer.flush(w);(0,z.isPromise)(P)?P.then(function(_){ie(W,_,w)}):ie(W,P,w)}})}function Q(W,se){if(!((Y=se.remuxResult).audio||Y.video||Y.text||Y.id3||Y.initSegment))return!1;var Y,V=[],M=se.remuxResult,b=M.audio,I=M.video;return b&&X(V,b),I&&X(V,I),W.postMessage({event:"transmuxComplete",data:se},V),!0}function X(W,se){se.data1&&W.push(se.data1.buffer),se.data2&&W.push(se.data2.buffer)}function ie(W,se,Y){se.reduce(function(V,M){return Q(W,M)||V},!1)||W.postMessage({event:"transmuxComplete",data:se[0]}),W.postMessage({event:"flush",data:Y})}},"./src/demux/transmuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{TransmuxConfig:()=>w,TransmuxState:()=>P,default:()=>M,isPromise:()=>I});var z,G=C("./src/events.ts"),de=C("./src/errors.ts"),te=C("./src/crypt/decrypter.ts"),le=C("./src/demux/aacdemuxer.ts"),Q=C("./src/demux/mp4demuxer.ts"),X=C("./src/demux/tsdemuxer.ts"),ie=C("./src/demux/mp3demuxer.ts"),W=C("./src/remux/mp4-remuxer.ts"),se=C("./src/remux/passthrough-remuxer.ts"),Y=C("./src/utils/logger.ts");try{z=self.performance.now.bind(self.performance)}catch{Y.logger.debug("Unable to use Performance API on this environment"),z=self.Date.now}var V=[{demux:X.default,remux:W.default},{demux:Q.default,remux:se.default},{demux:le.default,remux:W.default},{demux:ie.default,remux:W.default}],M=function(){function _(A,D,O,K,k){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=A,this.typeSupported=D,this.config=O,this.vendor=K,this.id=k}var v=_.prototype;return v.configure=function(A){this.transmuxConfig=A,this.decrypter&&this.decrypter.reset()},v.push=function(A,D,O,K){var k=this,L=O.transmuxing;L.executeStart=z();var R=new Uint8Array(A),Z=this.config,ae=this.currentTransmuxState,fe=this.transmuxConfig;K&&(this.currentTransmuxState=K);var ce=K||ae,me=ce.contiguous,Ee=ce.discontinuity,be=ce.trackSwitch,Re=ce.accurateTimeOffset,Ce=ce.timeOffset,Ne=ce.initSegmentChange,Ue=fe.audioCodec,Xe=fe.videoCodec,ut=fe.defaultInitPts,gt=fe.duration,ft=fe.initSegmentData;(Ee||be||Ne)&&this.resetInitSegment(ft,Ue,Xe,gt),(Ee||Ne)&&this.resetInitialTimestamp(ut),me||this.resetContiguity();var St=function(nt,vt){var mt=null;return nt.byteLength>0&&vt!=null&&vt.key!=null&&vt.iv!==null&&vt.method!=null&&(mt=vt),mt}(R,D);if(St&&St.method==="AES-128"){var Et=this.getDecrypter();if(!Z.enableSoftwareAES)return this.decryptionPromise=Et.webCryptoDecrypt(R,St.key.buffer,St.iv.buffer).then(function(nt){var vt=k.push(nt,null,O);return k.decryptionPromise=null,vt}),this.decryptionPromise;var ve=Et.softwareDecrypt(R,St.key.buffer,St.iv.buffer);if(!ve)return L.executeEnd=z(),b(O);R=new Uint8Array(ve)}this.needsProbing(R,Ee,be)&&this.configureTransmuxer(R,fe);var Oe=this.transmux(R,St,Ce,Re,O),Ke=this.currentTransmuxState;return Ke.contiguous=!0,Ke.discontinuity=!1,Ke.trackSwitch=!1,L.executeEnd=z(),Oe},v.flush=function(A){var D=this,O=A.transmuxing;O.executeStart=z();var K=this.decrypter,k=this.currentTransmuxState,L=this.decryptionPromise;if(L)return L.then(function(){return D.flush(A)});var R=[],Z=k.timeOffset;if(K){var ae=K.flush();ae&&R.push(this.push(ae,null,A))}var fe=this.demuxer,ce=this.remuxer;if(!fe||!ce)return this.observer.emit(G.Events.ERROR,G.Events.ERROR,{type:de.ErrorTypes.MEDIA_ERROR,details:de.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),O.executeEnd=z(),[b(A)];var me=fe.flush(Z);return I(me)?me.then(function(Ee){return D.flushRemux(R,Ee,A),R}):(this.flushRemux(R,me,A),R)},v.flushRemux=function(A,D,O){var K=D.audioTrack,k=D.videoTrack,L=D.id3Track,R=D.textTrack,Z=this.currentTransmuxState,ae=Z.accurateTimeOffset,fe=Z.timeOffset;Y.logger.log("[transmuxer.ts]: Flushed fragment "+O.sn+(O.part>-1?" p: "+O.part:"")+" of level "+O.level);var ce=this.remuxer.remux(K,k,L,R,fe,ae,!0,this.id);A.push({remuxResult:ce,chunkMeta:O}),O.transmuxing.executeEnd=z()},v.resetInitialTimestamp=function(A){var D=this.demuxer,O=this.remuxer;D&&O&&(D.resetTimeStamp(A),O.resetTimeStamp(A))},v.resetContiguity=function(){var A=this.demuxer,D=this.remuxer;A&&D&&(A.resetContiguity(),D.resetNextTimestamp())},v.resetInitSegment=function(A,D,O,K){var k=this.demuxer,L=this.remuxer;k&&L&&(k.resetInitSegment(A,D,O,K),L.resetInitSegment(A,D,O))},v.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},v.transmux=function(A,D,O,K,k){return D&&D.method==="SAMPLE-AES"?this.transmuxSampleAes(A,D,O,K,k):this.transmuxUnencrypted(A,O,K,k)},v.transmuxUnencrypted=function(A,D,O,K){var k=this.demuxer.demux(A,D,!1,!this.config.progressive),L=k.audioTrack,R=k.videoTrack,Z=k.id3Track,ae=k.textTrack;return{remuxResult:this.remuxer.remux(L,R,Z,ae,D,O,!1,this.id),chunkMeta:K}},v.transmuxSampleAes=function(A,D,O,K,k){var L=this;return this.demuxer.demuxSampleAes(A,D,O).then(function(R){return{remuxResult:L.remuxer.remux(R.audioTrack,R.videoTrack,R.id3Track,R.textTrack,O,K,!1,L.id),chunkMeta:k}})},v.configureTransmuxer=function(A,D){for(var O,K=this.config,k=this.observer,L=this.typeSupported,R=this.vendor,Z=D.audioCodec,ae=D.defaultInitPts,fe=D.duration,ce=D.initSegmentData,me=D.videoCodec,Ee=0,be=V.length;Ee<be;Ee++)if(V[Ee].demux.probe(A)){O=V[Ee];break}O||(Y.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),O={demux:Q.default,remux:se.default});var Re=this.demuxer,Ce=this.remuxer,Ne=O.remux,Ue=O.demux;Ce&&Ce instanceof Ne||(this.remuxer=new Ne(k,K,L,R)),Re&&Re instanceof Ue||(this.demuxer=new Ue(k,K,L),this.probe=Ue.probe),this.resetInitSegment(ce,Z,me,fe),this.resetInitialTimestamp(ae)},v.needsProbing=function(A,D,O){return!this.demuxer||!this.remuxer||D||O},v.getDecrypter=function(){var A=this.decrypter;return A||(A=this.decrypter=new te.default(this.observer,this.config)),A},_}(),b=function(_){return{remuxResult:{},chunkMeta:_}};function I(_){return"then"in _&&_.then instanceof Function}var w=function(_,v,A,D,O){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=_,this.videoCodec=v,this.initSegmentData=A,this.duration=D,this.defaultInitPts=O},P=function(_,v,A,D,O,K){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=_,this.contiguous=v,this.accurateTimeOffset=A,this.trackSwitch=D,this.timeOffset=O,this.initSegmentChange=K}},"./src/demux/tsdemuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>P});var z=C("./src/demux/adts.ts"),G=C("./src/demux/mpegaudio.ts"),de=C("./src/demux/exp-golomb.ts"),te=C("./src/demux/sample-aes.ts"),le=C("./src/events.ts"),Q=C("./src/utils/mp4-tools.ts"),X=C("./src/utils/logger.ts"),ie=C("./src/errors.ts"),W=C("./src/types/demuxer.ts");function se(){return se=Object.assign?Object.assign.bind():function(_){for(var v=1;v<arguments.length;v++){var A=arguments[v];for(var D in A)Object.prototype.hasOwnProperty.call(A,D)&&(_[D]=A[D])}return _},se.apply(this,arguments)}var Y=188;function V(_,v,A,D){return{key:_,frame:!1,pts:v,dts:A,units:[],debug:D,length:0}}function M(_,v){return(31&_[v+10])<<8|_[v+11]}function b(_,v,A,D){var O={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},K=v+3+((15&_[v+1])<<8|_[v+2])-4;for(v+=12+((15&_[v+10])<<8|_[v+11]);v<K;){var k=(31&_[v+1])<<8|_[v+2];switch(_[v]){case 207:if(!D){X.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:O.audio===-1&&(O.audio=k);break;case 21:O.id3===-1&&(O.id3=k);break;case 219:if(!D){X.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:O.avc===-1&&(O.avc=k);break;case 3:case 4:A.mpeg!==!0&&A.mp3!==!0?X.logger.log("MPEG audio found, not supported in this browser"):O.audio===-1&&(O.audio=k,O.segmentCodec="mp3");break;case 36:X.logger.warn("Unsupported HEVC stream type found")}v+=5+((15&_[v+3])<<8|_[v+4])}return O}function I(_){var v,A,D,O,K,k=0,L=_.data;if(!_||_.size===0)return null;for(;L[0].length<19&&L.length>1;){var R=new Uint8Array(L[0].length+L[1].length);R.set(L[0]),R.set(L[1],L[0].length),L[0]=R,L.splice(1,1)}if(((v=L[0])[0]<<16)+(v[1]<<8)+v[2]===1){if((A=(v[4]<<8)+v[5])&&A>_.size-6)return null;var Z=v[7];192&Z&&(O=536870912*(14&v[9])+4194304*(255&v[10])+16384*(254&v[11])+128*(255&v[12])+(254&v[13])/2,64&Z?O-(K=536870912*(14&v[14])+4194304*(255&v[15])+16384*(254&v[16])+128*(255&v[17])+(254&v[18])/2)>54e5&&(X.logger.warn(Math.round((O-K)/9e4)+"s delta between PTS and DTS, align them"),O=K):K=O);var ae=(D=v[8])+9;if(_.size<=ae)return null;_.size-=ae;for(var fe=new Uint8Array(_.size),ce=0,me=L.length;ce<me;ce++){var Ee=(v=L[ce]).byteLength;if(ae){if(ae>Ee){ae-=Ee;continue}v=v.subarray(ae),Ee-=ae,ae=0}fe.set(v,k),k+=Ee}return A&&(A-=D+3),{data:fe,pts:O,dts:K,len:A}}return null}function w(_,v){if(_.units.length&&_.frame){if(_.pts===void 0){var A=v.samples,D=A.length;if(!D)return void v.dropped++;var O=A[D-1];_.pts=O.pts,_.dts=O.dts}v.samples.push(_)}_.debug.length&&X.logger.log(_.pts+"/"+_.dts+":"+_.debug)}const P=function(){function _(A,D,O){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=A,this.config=D,this.typeSupported=O}_.probe=function(A){var D=_.syncOffset(A);return D>0&&X.logger.warn("MPEG2-TS detected but first sync word found @ offset "+D),D!==-1},_.syncOffset=function(A){for(var D=Math.min(940,A.length-376)+1,O=0;O<D;){if(A[O]===71&&A[O+Y]===71)return O;O++}return-1},_.createTrack=function(A,D){return{container:A==="video"||A==="audio"?"video/mp2t":void 0,type:A,id:Q.RemuxerTrackIdConfig[A],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:A==="audio"?D:void 0}};var v=_.prototype;return v.resetInitSegment=function(A,D,O,K){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=_.createTrack("video"),this._audioTrack=_.createTrack("audio",K),this._id3Track=_.createTrack("id3"),this._txtTrack=_.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=D,this.videoCodec=O,this._duration=K},v.resetTimeStamp=function(){},v.resetContiguity=function(){var A=this._audioTrack,D=this._avcTrack,O=this._id3Track;A&&(A.pesData=null),D&&(D.pesData=null),O&&(O.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},v.demux=function(A,D,O,K){var k;O===void 0&&(O=!1),K===void 0&&(K=!1),O||(this.sampleAes=null);var L=this._avcTrack,R=this._audioTrack,Z=this._id3Track,ae=this._txtTrack,fe=L.pid,ce=L.pesData,me=R.pid,Ee=Z.pid,be=R.pesData,Re=Z.pesData,Ce=null,Ne=this.pmtParsed,Ue=this._pmtId,Xe=A.length;if(this.remainderData&&(Xe=(A=(0,Q.appendUint8Array)(this.remainderData,A)).length,this.remainderData=null),Xe<Y&&!K)return this.remainderData=A,{audioTrack:R,videoTrack:L,id3Track:Z,textTrack:ae};var ut=Math.max(0,_.syncOffset(A));(Xe-=(Xe-ut)%Y)<A.byteLength&&!K&&(this.remainderData=new Uint8Array(A.buffer,Xe,A.buffer.byteLength-Xe));for(var gt=0,ft=ut;ft<Xe;ft+=Y)if(A[ft]===71){var St=!!(64&A[ft+1]),Et=((31&A[ft+1])<<8)+A[ft+2],ve=void 0;if((48&A[ft+3])>>4>1){if((ve=ft+5+A[ft+4])===ft+Y)continue}else ve=ft+4;switch(Et){case fe:St&&(ce&&(k=I(ce))&&this.parseAVCPES(L,ae,k,!1),ce={data:[],size:0}),ce&&(ce.data.push(A.subarray(ve,ft+Y)),ce.size+=ft+Y-ve);break;case me:if(St){if(be&&(k=I(be)))switch(R.segmentCodec){case"aac":this.parseAACPES(R,k);break;case"mp3":this.parseMPEGPES(R,k)}be={data:[],size:0}}be&&(be.data.push(A.subarray(ve,ft+Y)),be.size+=ft+Y-ve);break;case Ee:St&&(Re&&(k=I(Re))&&this.parseID3PES(Z,k),Re={data:[],size:0}),Re&&(Re.data.push(A.subarray(ve,ft+Y)),Re.size+=ft+Y-ve);break;case 0:St&&(ve+=A[ve]+1),Ue=this._pmtId=M(A,ve);break;case Ue:St&&(ve+=A[ve]+1);var Oe=b(A,ve,this.typeSupported,O);(fe=Oe.avc)>0&&(L.pid=fe),(me=Oe.audio)>0&&(R.pid=me,R.segmentCodec=Oe.segmentCodec),(Ee=Oe.id3)>0&&(Z.pid=Ee),Ce===null||Ne||(X.logger.log("unknown PID '"+Ce+"' in TS found"),Ce=null,ft=ut-188),Ne=this.pmtParsed=!0;break;case 17:case 8191:break;default:Ce=Et}}else gt++;gt>0&&this.observer.emit(le.Events.ERROR,le.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+gt+" TS packet/s that do not start with 0x47"}),L.pesData=ce,R.pesData=be,Z.pesData=Re;var Ke={audioTrack:R,videoTrack:L,id3Track:Z,textTrack:ae};return K&&this.extractRemainingSamples(Ke),Ke},v.flush=function(){var A,D=this.remainderData;return this.remainderData=null,A=D?this.demux(D,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(A),this.sampleAes?this.decrypt(A,this.sampleAes):A},v.extractRemainingSamples=function(A){var D,O=A.audioTrack,K=A.videoTrack,k=A.id3Track,L=A.textTrack,R=K.pesData,Z=O.pesData,ae=k.pesData;if(R&&(D=I(R))?(this.parseAVCPES(K,L,D,!0),K.pesData=null):K.pesData=R,Z&&(D=I(Z))){switch(O.segmentCodec){case"aac":this.parseAACPES(O,D);break;case"mp3":this.parseMPEGPES(O,D)}O.pesData=null}else Z!=null&&Z.size&&X.logger.log("last AAC PES packet truncated,might overlap between fragments"),O.pesData=Z;ae&&(D=I(ae))?(this.parseID3PES(k,D),k.pesData=null):k.pesData=ae},v.demuxSampleAes=function(A,D,O){var K=this.demux(A,O,!0,!this.config.progressive),k=this.sampleAes=new te.default(this.observer,this.config,D);return this.decrypt(K,k)},v.decrypt=function(A,D){return new Promise(function(O){var K=A.audioTrack,k=A.videoTrack;K.samples&&K.segmentCodec==="aac"?D.decryptAacSamples(K.samples,0,function(){k.samples?D.decryptAvcSamples(k.samples,0,0,function(){O(A)}):O(A)}):k.samples&&D.decryptAvcSamples(k.samples,0,0,function(){O(A)})})},v.destroy=function(){this._duration=0},v.parseAVCPES=function(A,D,O,K){var k,L=this,R=this.parseAVCNALu(A,O.data),Z=this.avcSample,ae=!1;O.data=null,Z&&R.length&&!A.audFound&&(w(Z,A),Z=this.avcSample=V(!1,O.pts,O.dts,"")),R.forEach(function(fe){switch(fe.type){case 1:k=!0,Z||(Z=L.avcSample=V(!0,O.pts,O.dts,"")),Z.frame=!0;var ce=fe.data;if(ae&&ce.length>4){var me=new de.default(ce).readSliceType();me!==2&&me!==4&&me!==7&&me!==9||(Z.key=!0)}break;case 5:k=!0,Z||(Z=L.avcSample=V(!0,O.pts,O.dts,"")),Z.key=!0,Z.frame=!0;break;case 6:k=!0,(0,Q.parseSEIMessageFromNALu)(fe.data,1,O.pts,D.samples);break;case 7:if(k=!0,ae=!0,!A.sps){var Ee=new de.default(fe.data).readSPS();A.width=Ee.width,A.height=Ee.height,A.pixelRatio=Ee.pixelRatio,A.sps=[fe.data],A.duration=L._duration;for(var be=fe.data.subarray(1,4),Re="avc1.",Ce=0;Ce<3;Ce++){var Ne=be[Ce].toString(16);Ne.length<2&&(Ne="0"+Ne),Re+=Ne}A.codec=Re}break;case 8:k=!0,A.pps||(A.pps=[fe.data]);break;case 9:k=!1,A.audFound=!0,Z&&w(Z,A),Z=L.avcSample=V(!1,O.pts,O.dts,"");break;case 12:k=!0;break;default:k=!1,Z&&(Z.debug+="unknown NAL "+fe.type+" ")}Z&&k&&Z.units.push(fe)}),K&&Z&&(w(Z,A),this.avcSample=null)},v.getLastNalUnit=function(A){var D,O,K=this.avcSample;if(K&&K.units.length!==0||(K=A[A.length-1]),(D=K)!==null&&D!==void 0&&D.units){var k=K.units;O=k[k.length-1]}return O},v.parseAVCNALu=function(A,D){var O,K,k=D.byteLength,L=A.naluState||0,R=L,Z=[],ae=0,fe=-1,ce=0;for(L===-1&&(fe=0,ce=31&D[0],L=0,ae=1);ae<k;)if(O=D[ae++],L)if(L!==1)if(O)if(O===1){if(fe>=0){var me={data:D.subarray(fe,ae-L-1),type:ce};Z.push(me)}else{var Ee=this.getLastNalUnit(A.samples);if(Ee&&(R&&ae<=4-R&&Ee.state&&(Ee.data=Ee.data.subarray(0,Ee.data.byteLength-R)),(K=ae-L-1)>0)){var be=new Uint8Array(Ee.data.byteLength+K);be.set(Ee.data,0),be.set(D.subarray(0,K),Ee.data.byteLength),Ee.data=be,Ee.state=0}}ae<k?(fe=ae,ce=31&D[ae],L=0):L=-1}else L=0;else L=3;else L=O?0:2;else L=O?0:1;if(fe>=0&&L>=0){var Re={data:D.subarray(fe,k),type:ce,state:L};Z.push(Re)}if(Z.length===0){var Ce=this.getLastNalUnit(A.samples);if(Ce){var Ne=new Uint8Array(Ce.data.byteLength+D.byteLength);Ne.set(Ce.data,0),Ne.set(D,Ce.data.byteLength),Ce.data=Ne}}return A.naluState=L,Z},v.parseAACPES=function(A,D){var O,K,k,L,R,Z=0,ae=this.aacOverFlow,fe=D.data;if(ae){this.aacOverFlow=null;var ce=ae.missing,me=ae.sample.unit.byteLength;if(ce===-1){var Ee=new Uint8Array(me+fe.byteLength);Ee.set(ae.sample.unit,0),Ee.set(fe,me),fe=Ee}else{var be=me-ce;ae.sample.unit.set(fe.subarray(0,ce),be),A.samples.push(ae.sample),Z=ae.missing}}for(O=Z,K=fe.length;O<K-1&&!z.isHeader(fe,O);O++);if(O===Z||(O<K-1?(k="AAC PES did not start with ADTS header,offset:"+O,L=!1):(k="no ADTS header found in AAC PES",L=!0),X.logger.warn("parsing error:"+k),this.observer.emit(le.Events.ERROR,le.Events.ERROR,{type:ie.ErrorTypes.MEDIA_ERROR,details:ie.ErrorDetails.FRAG_PARSING_ERROR,fatal:L,reason:k}),!L)){if(z.initTrackConfig(A,this.observer,fe,O,this.audioCodec),D.pts!==void 0)R=D.pts;else{if(!ae)return void X.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var Re=z.getFrameDuration(A.samplerate);R=ae.sample.pts+Re}for(var Ce,Ne=0;O<K;){if(O+=(Ce=z.appendFrame(A,fe,O,R,Ne)).length,Ce.missing){this.aacOverFlow=Ce;break}for(Ne++;O<K-1&&!z.isHeader(fe,O);O++);}}},v.parseMPEGPES=function(A,D){var O=D.data,K=O.length,k=0,L=0,R=D.pts;if(R!==void 0)for(;L<K;)if(G.isHeader(O,L)){var Z=G.appendFrame(A,O,L,R,k);if(!Z)break;L+=Z.length,k++}else L++;else X.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},v.parseID3PES=function(A,D){if(D.pts!==void 0){var O=se({},D,{type:this._avcTrack?W.MetadataSchema.emsg:W.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});A.samples.push(O)}else X.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},_}()},"./src/demux/webworkify-webpack.js":(F,re,C)=>{C.r(re),C.d(re,{default:()=>ie});var z=function(){var W=ENTRY_MODULE,se={},Y=function M(b){var I=se[b];if(I!==void 0)return I.exports;var w=se[b]={exports:{}};return W[b].call(w.exports,w,w.exports,M),w.exports};Y.m=W,Y.n=function(M){var b=M&&M.__esModule?function(){return M.default}:function(){return M};return Y.d(b,{a:b}),b},Y.d=function(M,b){for(var I in b)Y.o(b,I)&&!Y.o(M,I)&&Object.defineProperty(M,I,{enumerable:!0,get:b[I]})},Y.o=function(M,b){return Object.prototype.hasOwnProperty.call(M,b)},Y.r=function(M){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})};var V=Y(ENTRY_MODULE);return V.default||V}.toString().split("ENTRY_MODULE"),G="[\\.|\\-|\\+|\\w|/|@]+",de="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+G+").*?\\)";function te(W){return(W+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function le(W,se,Y){var V={};V[Y]=[];var M=se.toString().replace(/^"[^"]+"/,"function"),b=M.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||M.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!b)return V;for(var I,w=b[1],P=new RegExp("(\\\\n|\\W)"+te(w)+de,"g");I=P.exec(M);)I[3]!=="dll-reference"&&V[Y].push(I[3]);for(P=new RegExp("\\("+te(w)+'\\("(dll-reference\\s('+G+'))"\\)\\)'+de,"g");I=P.exec(M);)W[I[2]]||(V[Y].push(I[1]),W[I[2]]=C(I[1]).m),V[I[2]]=V[I[2]]||[],V[I[2]].push(I[4]);for(var _,v=Object.keys(V),A=0;A<v.length;A++)for(var D=0;D<V[v[A]].length;D++)_=V[v[A]][D],isNaN(1*_)||(V[v[A]][D]=1*V[v[A]][D]);return V}function Q(W){return Object.keys(W).reduce(function(se,Y){return se||W[Y].length>0},!1)}function X(W,se,Y,V){var M=W[V].map(function(b){return'"'+b+'": '+se[V][b].toString().replace(/^"[^"]+"/,"function")}).join(",");return z[0]+"{"+M+"}"+z[1]+'"'+Y+'"'+z[2]}function ie(W,se){se=se||{};var Y={main:C.m},V=se.all?{main:Object.keys(Y.main)}:function(P,_){for(var v={main:[_]},A={main:[]},D={main:{}};Q(v);)for(var O=Object.keys(v),K=0;K<O.length;K++){var k=O[K],L=v[k].pop();if(D[k]=D[k]||{},!D[k][L]&&P[k][L]){D[k][L]=!0,A[k]=A[k]||[],A[k].push(L);for(var R=le(P,P[k][L],k),Z=Object.keys(R),ae=0;ae<Z.length;ae++)v[Z[ae]]=v[Z[ae]]||[],v[Z[ae]]=v[Z[ae]].concat(R[Z[ae]])}}return A}(Y,W),M="";Object.keys(V).filter(function(P){return P!=="main"}).forEach(function(P){for(var _=0;V[P][_];)_++;V[P].push(_),Y[P][_]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",M=M+"var "+P+" = ("+X(V,Y,_,modules)+`)();
`}),M=M+"new (("+X(V,Y,W,"main")+")())(self);";var b=new window.Blob([M],{type:"text/javascript"}),I=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(b),w=new window.Worker(I);return w.objectURL=I,w}},"./src/errors.ts":(F,re,C)=>{var z,G;C.r(re),C.d(re,{ErrorDetails:()=>G,ErrorTypes:()=>z}),function(de){de.NETWORK_ERROR="networkError",de.MEDIA_ERROR="mediaError",de.KEY_SYSTEM_ERROR="keySystemError",de.MUX_ERROR="muxError",de.OTHER_ERROR="otherError"}(z||(z={})),function(de){de.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",de.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",de.KEY_SYSTEM_NO_SESSION="keySystemNoSession",de.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",de.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",de.MANIFEST_LOAD_ERROR="manifestLoadError",de.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",de.MANIFEST_PARSING_ERROR="manifestParsingError",de.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",de.LEVEL_EMPTY_ERROR="levelEmptyError",de.LEVEL_LOAD_ERROR="levelLoadError",de.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",de.LEVEL_SWITCH_ERROR="levelSwitchError",de.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",de.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",de.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",de.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",de.FRAG_LOAD_ERROR="fragLoadError",de.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",de.FRAG_DECRYPT_ERROR="fragDecryptError",de.FRAG_PARSING_ERROR="fragParsingError",de.REMUX_ALLOC_ERROR="remuxAllocError",de.KEY_LOAD_ERROR="keyLoadError",de.KEY_LOAD_TIMEOUT="keyLoadTimeOut",de.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",de.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",de.BUFFER_APPEND_ERROR="bufferAppendError",de.BUFFER_APPENDING_ERROR="bufferAppendingError",de.BUFFER_STALLED_ERROR="bufferStalledError",de.BUFFER_FULL_ERROR="bufferFullError",de.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",de.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",de.INTERNAL_EXCEPTION="internalException",de.INTERNAL_ABORTED="aborted",de.UNKNOWN="unknown"}(G||(G={}))},"./src/events.ts":(F,re,C)=>{var z;C.r(re),C.d(re,{Events:()=>z}),function(G){G.MEDIA_ATTACHING="hlsMediaAttaching",G.MEDIA_ATTACHED="hlsMediaAttached",G.MEDIA_DETACHING="hlsMediaDetaching",G.MEDIA_DETACHED="hlsMediaDetached",G.BUFFER_RESET="hlsBufferReset",G.BUFFER_CODECS="hlsBufferCodecs",G.BUFFER_CREATED="hlsBufferCreated",G.BUFFER_APPENDING="hlsBufferAppending",G.BUFFER_APPENDED="hlsBufferAppended",G.BUFFER_EOS="hlsBufferEos",G.BUFFER_FLUSHING="hlsBufferFlushing",G.BUFFER_FLUSHED="hlsBufferFlushed",G.MANIFEST_LOADING="hlsManifestLoading",G.MANIFEST_LOADED="hlsManifestLoaded",G.MANIFEST_PARSED="hlsManifestParsed",G.LEVEL_SWITCHING="hlsLevelSwitching",G.LEVEL_SWITCHED="hlsLevelSwitched",G.LEVEL_LOADING="hlsLevelLoading",G.LEVEL_LOADED="hlsLevelLoaded",G.LEVEL_UPDATED="hlsLevelUpdated",G.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",G.LEVELS_UPDATED="hlsLevelsUpdated",G.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",G.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",G.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",G.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",G.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",G.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",G.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",G.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",G.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",G.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",G.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",G.CUES_PARSED="hlsCuesParsed",G.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",G.INIT_PTS_FOUND="hlsInitPtsFound",G.FRAG_LOADING="hlsFragLoading",G.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",G.FRAG_LOADED="hlsFragLoaded",G.FRAG_DECRYPTED="hlsFragDecrypted",G.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",G.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",G.FRAG_PARSING_METADATA="hlsFragParsingMetadata",G.FRAG_PARSED="hlsFragParsed",G.FRAG_BUFFERED="hlsFragBuffered",G.FRAG_CHANGED="hlsFragChanged",G.FPS_DROP="hlsFpsDrop",G.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",G.ERROR="hlsError",G.DESTROYING="hlsDestroying",G.KEY_LOADING="hlsKeyLoading",G.KEY_LOADED="hlsKeyLoaded",G.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",G.BACK_BUFFER_REACHED="hlsBackBufferReached"}(z||(z={}))},"./src/hls.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>w});var z=C("./node_modules/url-toolkit/src/url-toolkit.js"),G=C("./src/loader/playlist-loader.ts"),de=C("./src/loader/key-loader.ts"),te=C("./src/controller/id3-track-controller.ts"),le=C("./src/controller/latency-controller.ts"),Q=C("./src/controller/level-controller.ts"),X=C("./src/controller/fragment-tracker.ts"),ie=C("./src/controller/stream-controller.ts"),W=C("./src/is-supported.ts"),se=C("./src/utils/logger.ts"),Y=C("./src/config.ts"),V=C("./node_modules/eventemitter3/index.js"),M=C("./src/events.ts"),b=C("./src/errors.ts");function I(P,_){for(var v=0;v<_.length;v++){var A=_[v];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(P,A.key,A)}}var w=function(){function P(O){O===void 0&&(O={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new V.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var K=this.config=(0,Y.mergeConfig)(P.DefaultConfig,O);this.userConfig=O,(0,se.enableLogs)(K.debug,"Hls instance"),this._autoLevelCapping=-1,K.progressive&&(0,Y.enableStreamingMode)(K);var k=K.abrController,L=K.bufferController,R=K.capLevelController,Z=K.fpsController,ae=this.abrController=new k(this),fe=this.bufferController=new L(this),ce=this.capLevelController=new R(this),me=new Z(this),Ee=new G.default(this),be=new de.default(this),Re=new te.default(this),Ce=this.levelController=new Q.default(this),Ne=new X.FragmentTracker(this),Ue=this.streamController=new ie.default(this,Ne);ce.setStreamController(Ue),me.setStreamController(Ue);var Xe=[Ee,be,Ce,Ue];this.networkControllers=Xe;var ut=[ae,fe,ce,me,Re,Ne];this.audioTrackController=this.createController(K.audioTrackController,null,Xe),this.createController(K.audioStreamController,Ne,Xe),this.subtitleTrackController=this.createController(K.subtitleTrackController,null,Xe),this.createController(K.subtitleStreamController,Ne,Xe),this.createController(K.timelineController,null,ut),this.emeController=this.createController(K.emeController,null,ut),this.cmcdController=this.createController(K.cmcdController,null,ut),this.latencyController=this.createController(le.default,null,ut),this.coreComponents=ut}P.isSupported=function(){return(0,W.isSupported)()};var _,v,A,D=P.prototype;return D.createController=function(O,K,k){if(O){var L=K?new O(this,K):new O(this);return k&&k.push(L),L}return null},D.on=function(O,K,k){k===void 0&&(k=this),this._emitter.on(O,K,k)},D.once=function(O,K,k){k===void 0&&(k=this),this._emitter.once(O,K,k)},D.removeAllListeners=function(O){this._emitter.removeAllListeners(O)},D.off=function(O,K,k,L){k===void 0&&(k=this),this._emitter.off(O,K,k,L)},D.listeners=function(O){return this._emitter.listeners(O)},D.emit=function(O,K,k){return this._emitter.emit(O,K,k)},D.trigger=function(O,K){if(this.config.debug)return this.emit(O,O,K);try{return this.emit(O,O,K)}catch(k){se.logger.error("An internal error happened while handling event "+O+'. Error message: "'+k.message+'". Here is a stacktrace:',k),this.trigger(M.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:O,error:k})}return!1},D.listenerCount=function(O){return this._emitter.listenerCount(O)},D.destroy=function(){se.logger.log("destroy"),this.trigger(M.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(O){return O.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(O){return O.destroy()}),this.coreComponents.length=0},D.attachMedia=function(O){se.logger.log("attachMedia"),this._media=O,this.trigger(M.Events.MEDIA_ATTACHING,{media:O})},D.detachMedia=function(){se.logger.log("detachMedia"),this.trigger(M.Events.MEDIA_DETACHING,void 0),this._media=null},D.loadSource=function(O){this.stopLoad();var K=this.media,k=this.url,L=this.url=z.buildAbsoluteURL(self.location.href,O,{alwaysNormalize:!0});se.logger.log("loadSource:"+L),K&&k&&k!==L&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(K)),this.trigger(M.Events.MANIFEST_LOADING,{url:O})},D.startLoad=function(O){O===void 0&&(O=-1),se.logger.log("startLoad("+O+")"),this.networkControllers.forEach(function(K){K.startLoad(O)})},D.stopLoad=function(){se.logger.log("stopLoad"),this.networkControllers.forEach(function(O){O.stopLoad()})},D.swapAudioCodec=function(){se.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},D.recoverMediaError=function(){se.logger.log("recoverMediaError");var O=this._media;this.detachMedia(),O&&this.attachMedia(O)},D.removeLevel=function(O,K){K===void 0&&(K=0),this.levelController.removeLevel(O,K)},_=P,A=[{key:"version",get:function(){return"1.2.9"}},{key:"Events",get:function(){return M.Events}},{key:"ErrorTypes",get:function(){return b.ErrorTypes}},{key:"ErrorDetails",get:function(){return b.ErrorDetails}},{key:"DefaultConfig",get:function(){return P.defaultConfig?P.defaultConfig:Y.hlsDefaultConfig},set:function(O){P.defaultConfig=O}}],(v=[{key:"levels",get:function(){var O=this.levelController.levels;return O||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(O){se.logger.log("set currentLevel:"+O),this.loadLevel=O,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(O){se.logger.log("set nextLevel:"+O),this.levelController.manualLevel=O,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(O){se.logger.log("set loadLevel:"+O),this.levelController.manualLevel=O}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(O){this.levelController.nextLoadLevel=O}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(O){se.logger.log("set firstLevel:"+O),this.levelController.firstLevel=O}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(O){se.logger.log("set startLevel:"+O),O!==-1&&(O=Math.max(O,this.minAutoLevel)),this.levelController.startLevel=O}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(O){var K=!!O;K!==this.config.capLevelToPlayerSize&&(K?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=K)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(O){this._autoLevelCapping!==O&&(se.logger.log("set autoLevelCapping:"+O),this._autoLevelCapping=O)}},{key:"bandwidthEstimate",get:function(){var O=this.abrController.bwEstimator;return O?O.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var O=this.levels,K=this.config.minAutoBitrate;if(!O)return 0;for(var k=O.length,L=0;L<k;L++)if(O[L].maxBitrate>=K)return L;return 0}},{key:"maxAutoLevel",get:function(){var O=this.levels,K=this.autoLevelCapping;return K===-1&&O&&O.length?O.length-1:K}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(O){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,O)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var O=this.audioTrackController;return O?O.audioTracks:[]}},{key:"audioTrack",get:function(){var O=this.audioTrackController;return O?O.audioTrack:-1},set:function(O){var K=this.audioTrackController;K&&(K.audioTrack=O)}},{key:"subtitleTracks",get:function(){var O=this.subtitleTrackController;return O?O.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var O=this.subtitleTrackController;return O?O.subtitleTrack:-1},set:function(O){var K=this.subtitleTrackController;K&&(K.subtitleTrack=O)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var O=this.subtitleTrackController;return!!O&&O.subtitleDisplay},set:function(O){var K=this.subtitleTrackController;K&&(K.subtitleDisplay=O)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(O){this.config.lowLatencyMode=O}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&I(_.prototype,v),A&&I(_,A),Object.defineProperty(_,"prototype",{writable:!1}),P}();w.defaultConfig=void 0},"./src/is-supported.ts":(F,re,C)=>{C.r(re),C.d(re,{changeTypeSupported:()=>te,isSupported:()=>de});var z=C("./src/utils/mediasource-helper.ts");function G(){return self.SourceBuffer||self.WebKitSourceBuffer}function de(){var le=(0,z.getMediaSource)();if(!le)return!1;var Q=G(),X=le&&typeof le.isTypeSupported=="function"&&le.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),ie=!Q||Q.prototype&&typeof Q.prototype.appendBuffer=="function"&&typeof Q.prototype.remove=="function";return!!X&&!!ie}function te(){var le,Q=G();return typeof(Q==null||(le=Q.prototype)===null||le===void 0?void 0:le.changeType)=="function"}},"./src/loader/date-range.ts":(F,re,C)=>{C.r(re),C.d(re,{DateRange:()=>X,DateRangeAttribute:()=>z});var z,G=C("./src/polyfills/number.ts"),de=C("./src/utils/attr-list.ts"),te=C("./src/utils/logger.ts");function le(){return le=Object.assign?Object.assign.bind():function(ie){for(var W=1;W<arguments.length;W++){var se=arguments[W];for(var Y in se)Object.prototype.hasOwnProperty.call(se,Y)&&(ie[Y]=se[Y])}return ie},le.apply(this,arguments)}function Q(ie,W){for(var se=0;se<W.length;se++){var Y=W[se];Y.enumerable=Y.enumerable||!1,Y.configurable=!0,"value"in Y&&(Y.writable=!0),Object.defineProperty(ie,Y.key,Y)}}(function(ie){ie.ID="ID",ie.CLASS="CLASS",ie.START_DATE="START-DATE",ie.DURATION="DURATION",ie.END_DATE="END-DATE",ie.END_ON_NEXT="END-ON-NEXT",ie.PLANNED_DURATION="PLANNED-DURATION",ie.SCTE35_OUT="SCTE35-OUT",ie.SCTE35_IN="SCTE35-IN"})(z||(z={}));var X=function(){function ie(V,M){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,M){var b=M.attr;for(var I in b)if(Object.prototype.hasOwnProperty.call(V,I)&&V[I]!==b[I]){te.logger.warn('DATERANGE tag attribute: "'+I+'" does not match for tags with ID: "'+V.ID+'"'),this._badValueForSameId=I;break}V=le(new de.AttrList({}),b,V)}if(this.attr=V,this._startDate=new Date(V[z.START_DATE]),z.END_DATE in this.attr){var w=new Date(this.attr[z.END_DATE]);(0,G.isFiniteNumber)(w.getTime())&&(this._endDate=w)}}var W,se,Y;return W=ie,(se=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var V=this.duration;return V!==null?new Date(this._startDate.getTime()+1e3*V):null}},{key:"duration",get:function(){if(z.DURATION in this.attr){var V=this.attr.decimalFloatingPoint(z.DURATION);if((0,G.isFiniteNumber)(V))return V}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return z.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(z.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(z.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,G.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&Q(W.prototype,se),Y&&Q(W,Y),Object.defineProperty(W,"prototype",{writable:!1}),ie}()},"./src/loader/fragment-loader.ts":(F,re,C)=>{C.r(re),C.d(re,{LoadError:()=>Y,default:()=>W});var z=C("./src/polyfills/number.ts"),G=C("./src/errors.ts");function de(V){var M=typeof Map=="function"?new Map:void 0;return de=function(b){if(b===null||(I=b,Function.toString.call(I).indexOf("[native code]")===-1))return b;var I;if(typeof b!="function")throw new TypeError("Super expression must either be null or a function");if(M!==void 0){if(M.has(b))return M.get(b);M.set(b,w)}function w(){return te(b,arguments,X(this).constructor)}return w.prototype=Object.create(b.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),Q(w,b)},de(V)}function te(V,M,b){return te=le()?Reflect.construct.bind():function(I,w,P){var _=[null];_.push.apply(_,w);var v=new(Function.bind.apply(I,_));return P&&Q(v,P.prototype),v},te.apply(null,arguments)}function le(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Q(V,M){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,I){return b.__proto__=I,b},Q(V,M)}function X(V){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(M){return M.__proto__||Object.getPrototypeOf(M)},X(V)}var ie=Math.pow(2,17),W=function(){function V(b){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=b}var M=V.prototype;return M.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},M.abort=function(){this.loader&&this.loader.abort()},M.load=function(b,I){var w=this,P=b.url;if(!P)return Promise.reject(new Y({type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b,networkDetails:null},"Fragment does not have a "+(P?"part list":"url")));this.abort();var _=this.config,v=_.fLoader,A=_.loader;return new Promise(function(D,O){w.loader&&w.loader.destroy();var K=w.loader=b.loader=v?new v(_):new A(_),k=se(b),L={timeout:_.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:_.fragLoadingMaxRetryTimeout,highWaterMark:b.sn==="initSegment"?1/0:ie};b.stats=K.stats,K.load(k,L,{onSuccess:function(R,Z,ae,fe){w.resetLoader(b,K),D({frag:b,part:null,payload:R.data,networkDetails:fe})},onError:function(R,Z,ae){w.resetLoader(b,K),O(new Y({type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b,response:R,networkDetails:ae}))},onAbort:function(R,Z,ae){w.resetLoader(b,K),O(new Y({type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:b,networkDetails:ae}))},onTimeout:function(R,Z,ae){w.resetLoader(b,K),O(new Y({type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b,networkDetails:ae}))},onProgress:function(R,Z,ae,fe){I&&I({frag:b,part:null,payload:ae,networkDetails:fe})}})})},M.loadPart=function(b,I,w){var P=this;this.abort();var _=this.config,v=_.fLoader,A=_.loader;return new Promise(function(D,O){P.loader&&P.loader.destroy();var K=P.loader=b.loader=v?new v(_):new A(_),k=se(b,I),L={timeout:_.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:_.fragLoadingMaxRetryTimeout,highWaterMark:ie};I.stats=K.stats,K.load(k,L,{onSuccess:function(R,Z,ae,fe){P.resetLoader(b,K),P.updateStatsFromPart(b,I);var ce={frag:b,part:I,payload:R.data,networkDetails:fe};w(ce),D(ce)},onError:function(R,Z,ae){P.resetLoader(b,K),O(new Y({type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b,part:I,response:R,networkDetails:ae}))},onAbort:function(R,Z,ae){b.stats.aborted=I.stats.aborted,P.resetLoader(b,K),O(new Y({type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:b,part:I,networkDetails:ae}))},onTimeout:function(R,Z,ae){P.resetLoader(b,K),O(new Y({type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b,part:I,networkDetails:ae}))}})})},M.updateStatsFromPart=function(b,I){var w=b.stats,P=I.stats,_=P.total;if(w.loaded+=P.loaded,_){var v=Math.round(b.duration/I.duration),A=Math.min(Math.round(w.loaded/_),v),D=(v-A)*Math.round(w.loaded/A);w.total=w.loaded+D}else w.total=Math.max(w.loaded,w.total);var O=w.loading,K=P.loading;O.start?O.first+=K.first-K.start:(O.start=K.start,O.first=K.first),O.end=K.end},M.resetLoader=function(b,I){b.loader=null,this.loader===I&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),I.destroy()},V}();function se(V,M){M===void 0&&(M=null);var b=M||V,I={frag:V,part:M,responseType:"arraybuffer",url:b.url,headers:{},rangeStart:0,rangeEnd:0},w=b.byteRangeStartOffset,P=b.byteRangeEndOffset;return(0,z.isFiniteNumber)(w)&&(0,z.isFiniteNumber)(P)&&(I.rangeStart=w,I.rangeEnd=P),I}var Y=function(V){var M,b;function I(w){for(var P,_=arguments.length,v=new Array(_>1?_-1:0),A=1;A<_;A++)v[A-1]=arguments[A];return(P=V.call.apply(V,[this].concat(v))||this).data=void 0,P.data=w,P}return b=V,(M=I).prototype=Object.create(b.prototype),M.prototype.constructor=M,Q(M,b),I}(de(Error))},"./src/loader/fragment.ts":(F,re,C)=>{C.r(re),C.d(re,{BaseSegment:()=>Y,ElementaryStreamTypes:()=>z,Fragment:()=>V,Part:()=>M});var z,G=C("./src/polyfills/number.ts"),de=C("./node_modules/url-toolkit/src/url-toolkit.js"),te=C("./src/utils/logger.ts"),le=C("./src/loader/level-key.ts"),Q=C("./src/loader/load-stats.ts");function X(b,I){b.prototype=Object.create(I.prototype),b.prototype.constructor=b,ie(b,I)}function ie(b,I){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,P){return w.__proto__=P,w},ie(b,I)}function W(b,I){for(var w=0;w<I.length;w++){var P=I[w];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(b,P.key,P)}}function se(b,I,w){return I&&W(b.prototype,I),w&&W(b,w),Object.defineProperty(b,"prototype",{writable:!1}),b}(function(b){b.AUDIO="audio",b.VIDEO="video",b.AUDIOVIDEO="audiovideo"})(z||(z={}));var Y=function(){function b(I){var w;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((w={})[z.AUDIO]=null,w[z.VIDEO]=null,w[z.AUDIOVIDEO]=null,w),this.baseurl=I}return b.prototype.setByteRange=function(I,w){var P=I.split("@",2),_=[];P.length===1?_[0]=w?w.byteRangeEndOffset:0:_[0]=parseInt(P[1]),_[1]=parseInt(P[0])+_[0],this._byteRange=_},se(b,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,de.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(I){this._url=I}}]),b}(),V=function(b){function I(P,_){var v;return(v=b.call(this,_)||this)._decryptdata=null,v.rawProgramDateTime=null,v.programDateTime=null,v.tagList=[],v.duration=0,v.sn=0,v.levelkey=void 0,v.type=void 0,v.loader=null,v.level=-1,v.cc=0,v.startPTS=void 0,v.endPTS=void 0,v.appendedPTS=void 0,v.startDTS=void 0,v.endDTS=void 0,v.start=0,v.deltaPTS=void 0,v.maxStartPTS=void 0,v.minEndPTS=void 0,v.stats=new Q.LoadStats,v.urlId=0,v.data=void 0,v.bitrateTest=!1,v.title=null,v.initSegment=null,v.type=P,v}X(I,b);var w=I.prototype;return w.createInitializationVector=function(P){for(var _=new Uint8Array(16),v=12;v<16;v++)_[v]=P>>8*(15-v)&255;return _},w.setDecryptDataFromLevelKey=function(P,_){var v=P;return P?.method==="AES-128"&&P.uri&&!P.iv&&((v=le.LevelKey.fromURI(P.uri)).method=P.method,v.iv=this.createInitializationVector(_),v.keyFormat="identity"),v},w.setElementaryStreamInfo=function(P,_,v,A,D,O){O===void 0&&(O=!1);var K=this.elementaryStreams,k=K[P];k?(k.startPTS=Math.min(k.startPTS,_),k.endPTS=Math.max(k.endPTS,v),k.startDTS=Math.min(k.startDTS,A),k.endDTS=Math.max(k.endDTS,D)):K[P]={startPTS:_,endPTS:v,startDTS:A,endDTS:D,partial:O}},w.clearElementaryStreamInfo=function(){var P=this.elementaryStreams;P[z.AUDIO]=null,P[z.VIDEO]=null,P[z.AUDIOVIDEO]=null},se(I,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var P=this.sn;typeof P!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&te.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),P=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,P)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,G.isFiniteNumber)(this.programDateTime))return null;var P=(0,G.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*P}},{key:"encrypted",get:function(){var P;return!((P=this.decryptdata)===null||P===void 0||!P.keyFormat||!this.decryptdata.uri)}}]),I}(Y),M=function(b){function I(w,P,_,v,A){var D;(D=b.call(this,_)||this).fragOffset=0,D.duration=0,D.gap=!1,D.independent=!1,D.relurl=void 0,D.fragment=void 0,D.index=void 0,D.stats=new Q.LoadStats,D.duration=w.decimalFloatingPoint("DURATION"),D.gap=w.bool("GAP"),D.independent=w.bool("INDEPENDENT"),D.relurl=w.enumeratedString("URI"),D.fragment=P,D.index=v;var O=w.enumeratedString("BYTERANGE");return O&&D.setByteRange(O,A),A&&(D.fragOffset=A.fragOffset+A.duration),D}return X(I,b),se(I,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var w=this.elementaryStreams;return!!(w.audio||w.video||w.audiovideo)}}]),I}(Y)},"./src/loader/key-loader.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>te});var z=C("./src/events.ts"),G=C("./src/errors.ts"),de=C("./src/utils/logger.ts"),te=function(){function le(X){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=X,this.registerListeners()}var Q=le.prototype;return Q.startLoad=function(X){},Q.stopLoad=function(){this.destroyInternalLoaders()},Q.registerListeners=function(){this.hls.on(z.Events.KEY_LOADING,this.onKeyLoading,this)},Q.unregisterListeners=function(){this.hls.off(z.Events.KEY_LOADING,this.onKeyLoading)},Q.destroyInternalLoaders=function(){for(var X in this.loaders){var ie=this.loaders[X];ie&&ie.destroy()}this.loaders={}},Q.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},Q.onKeyLoading=function(X,ie){var W=ie.frag,se=W.type,Y=this.loaders[se];if(W.decryptdata){var V=W.decryptdata.uri;if(V!==this.decrypturl||this.decryptkey===null){var M=this.hls.config;if(Y&&(de.logger.warn("abort previous key loader for type:"+se),Y.abort()),!V)return void de.logger.warn("key uri is falsy");var b=M.loader,I=W.loader=this.loaders[se]=new b(M);this.decrypturl=V,this.decryptkey=null;var w={url:V,frag:W,responseType:"arraybuffer"},P={timeout:M.fragLoadingTimeOut,maxRetry:0,retryDelay:M.fragLoadingRetryDelay,maxRetryDelay:M.fragLoadingMaxRetryTimeout,highWaterMark:0},_={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};I.load(w,P,_)}else this.decryptkey&&(W.decryptdata.key=this.decryptkey,this.hls.trigger(z.Events.KEY_LOADED,{frag:W}))}else de.logger.warn("Missing decryption data on fragment in onKeyLoading")},Q.loadsuccess=function(X,ie,W){var se=W.frag;se.decryptdata?(this.decryptkey=se.decryptdata.key=new Uint8Array(X.data),se.loader=null,delete this.loaders[se.type],this.hls.trigger(z.Events.KEY_LOADED,{frag:se})):de.logger.error("after key load, decryptdata unset")},Q.loaderror=function(X,ie){var W=ie.frag,se=W.loader;se&&se.abort(),delete this.loaders[W.type],this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:W,response:X})},Q.loadtimeout=function(X,ie){var W=ie.frag,se=W.loader;se&&se.abort(),delete this.loaders[W.type],this.hls.trigger(z.Events.ERROR,{type:G.ErrorTypes.NETWORK_ERROR,details:G.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:W})},le}()},"./src/loader/level-details.ts":(F,re,C)=>{C.r(re),C.d(re,{LevelDetails:()=>de});var z=C("./src/polyfills/number.ts");function G(te,le){for(var Q=0;Q<le.length;Q++){var X=le[Q];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(te,X.key,X)}}var de=function(){function te(ie){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=ie}var le,Q,X;return te.prototype.reloaded=function(ie){if(!ie)return this.advanced=!0,void(this.updated=!0);var W=this.lastPartSn-ie.lastPartSn,se=this.lastPartIndex-ie.lastPartIndex;this.updated=this.endSN!==ie.endSN||!!se||!!W,this.advanced=this.endSN>ie.endSN||W>0||W===0&&se>0,this.updated||this.advanced?this.misses=Math.floor(.6*ie.misses):this.misses=ie.misses+1,this.availabilityDelay=ie.availabilityDelay},le=te,(Q=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,z.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var ie=this.driftEndTime-this.driftStartTime;return ie>0?1e3*(this.driftEnd-this.driftStart)/ie:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var ie;return(ie=this.partList)!==null&&ie!==void 0&&ie.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var ie;return(ie=this.fragments)!==null&&ie!==void 0&&ie.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var ie;return(ie=this.partList)!==null&&ie!==void 0&&ie.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var ie;return(ie=this.partList)!==null&&ie!==void 0&&ie.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&G(le.prototype,Q),X&&G(le,X),Object.defineProperty(le,"prototype",{writable:!1}),te}()},"./src/loader/level-key.ts":(F,re,C)=>{C.r(re),C.d(re,{LevelKey:()=>de});var z=C("./node_modules/url-toolkit/src/url-toolkit.js");function G(te,le){for(var Q=0;Q<le.length;Q++){var X=le[Q];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(te,X.key,X)}}var de=function(){function te(ie,W){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=W?(0,z.buildAbsoluteURL)(ie,W,{alwaysNormalize:!0}):ie}var le,Q,X;return te.fromURL=function(ie,W){return new te(ie,W)},te.fromURI=function(ie){return new te(ie)},le=te,(Q=[{key:"uri",get:function(){return this._uri}}])&&G(le.prototype,Q),X&&G(le,X),Object.defineProperty(le,"prototype",{writable:!1}),te}()},"./src/loader/load-stats.ts":(F,re,C)=>{C.r(re),C.d(re,{LoadStats:()=>z});var z=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>I});var z=C("./src/polyfills/number.ts"),G=C("./node_modules/url-toolkit/src/url-toolkit.js"),de=C("./src/loader/date-range.ts"),te=C("./src/loader/fragment.ts"),le=C("./src/loader/level-details.ts"),Q=C("./src/loader/level-key.ts"),X=C("./src/utils/attr-list.ts"),ie=C("./src/utils/logger.ts"),W=C("./src/utils/codecs.ts"),se=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,Y=/#EXT-X-MEDIA:(.*)/g,V=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),M=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|"0.5.0"): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),b=/\.(mp4|m4s|m4v|m4a)$/i,I=function(){function A(){}return A.findGroup=function(D,O){for(var K=0;K<D.length;K++){var k=D[K];if(k.id===O)return k}},A.convertAVC1ToAVCOTI=function(D){var O=D.split(".");if(O.length>2){var K=O.shift()+".";return K+=parseInt(O.shift()).toString(16),K+=("000"+parseInt(O.shift()).toString(16)).slice(-4)}return D},A.resolve=function(D,O){return G.buildAbsoluteURL(O,D,{alwaysNormalize:!0})},A.parseMasterPlaylist=function(D,O){var K,k=[],L=[],R={},Z=!1;for(se.lastIndex=0;(K=se.exec(D))!=null;)if(K[1]){var ae,fe=new X.AttrList(K[1]),ce={attrs:fe,bitrate:fe.decimalInteger("AVERAGE-BANDWIDTH")||fe.decimalInteger("BANDWIDTH"),name:fe.NAME,url:A.resolve(K[2],O)},me=fe.decimalResolution("RESOLUTION");me&&(ce.width=me.width,ce.height=me.height),w((fe.CODECS||"").split(/[ ,]+/).filter(function(be){return be}),ce),ce.videoCodec&&ce.videoCodec.indexOf("avc1")!==-1&&(ce.videoCodec=A.convertAVC1ToAVCOTI(ce.videoCodec)),(ae=ce.unknownCodecs)!==null&&ae!==void 0&&ae.length||L.push(ce),k.push(ce)}else if(K[3]){var Ee=new X.AttrList(K[3]);Ee["DATA-ID"]&&(Z=!0,R[Ee["DATA-ID"]]=Ee)}return{levels:L.length>0&&L.length<k.length?L:k,sessionData:Z?R:null}},A.parseMasterPlaylistMedia=function(D,O,K,k){var L;k===void 0&&(k=[]);var R=[],Z=0;for(Y.lastIndex=0;(L=Y.exec(D))!==null;){var ae=new X.AttrList(L[1]);if(ae.TYPE===K){var fe={attrs:ae,bitrate:0,id:Z++,groupId:ae["GROUP-ID"],instreamId:ae["INSTREAM-ID"],name:ae.NAME||ae.LANGUAGE||"",type:K,default:ae.bool("DEFAULT"),autoselect:ae.bool("AUTOSELECT"),forced:ae.bool("FORCED"),lang:ae.LANGUAGE,url:ae.URI?A.resolve(ae.URI,O):""};if(k.length){var ce=A.findGroup(k,fe.groupId)||k[0];P(fe,ce,"audioCodec"),P(fe,ce,"textCodec")}R.push(fe)}}return R},A.parseLevelPlaylist=function(D,O,K,k,L){var R,Z,ae,fe=new le.LevelDetails(O),ce=fe.fragments,me=null,Ee=0,be=0,Re=0,Ce=0,Ne=null,Ue=new te.Fragment(k,O),Xe=-1,ut=!1;for(V.lastIndex=0,fe.m3u8=D;(R=V.exec(D))!==null;){ut&&(ut=!1,(Ue=new te.Fragment(k,O)).start=Re,Ue.sn=Ee,Ue.cc=Ce,Ue.level=K,me&&(Ue.initSegment=me,Ue.rawProgramDateTime=me.rawProgramDateTime,me.rawProgramDateTime=null));var gt=R[1];if(gt){Ue.duration=parseFloat(gt);var ft=(" "+R[2]).slice(1);Ue.title=ft||null,Ue.tagList.push(ft?["INF",gt,ft]:["INF",gt])}else if(R[3])(0,z.isFiniteNumber)(Ue.duration)&&(Ue.start=Re,ae&&(Ue.levelkey=ae),Ue.sn=Ee,Ue.level=K,Ue.cc=Ce,Ue.urlId=L,ce.push(Ue),Ue.relurl=(" "+R[3]).slice(1),_(Ue,Ne),Ne=Ue,Re+=Ue.duration,Ee++,be=0,ut=!0);else if(R[4]){var St=(" "+R[4]).slice(1);Ne?Ue.setByteRange(St,Ne):Ue.setByteRange(St)}else if(R[5])Ue.rawProgramDateTime=(" "+R[5]).slice(1),Ue.tagList.push(["PROGRAM-DATE-TIME",Ue.rawProgramDateTime]),Xe===-1&&(Xe=ce.length);else{if(!(R=R[0].match(M))){ie.logger.warn("No matches on slow regex match for level playlist!");continue}for(Z=1;Z<R.length&&R[Z]===void 0;Z++);var Et=(" "+R[Z]).slice(1),ve=(" "+R[Z+1]).slice(1),Oe=R[Z+2]?(" "+R[Z+2]).slice(1):"";switch(Et){case"PLAYLIST-TYPE":fe.type=ve.toUpperCase();break;case"MEDIA-SEQUENCE":Ee=fe.startSN=parseInt(ve);break;case"SKIP":var Ke=new X.AttrList(ve),nt=Ke.decimalInteger("SKIPPED-SEGMENTS");if((0,z.isFiniteNumber)(nt)){fe.skippedSegments=nt;for(var vt=nt;vt--;)ce.unshift(null);Ee+=nt}var mt=Ke.enumeratedString("RECENTLY-REMOVED-DATERANGES");mt&&(fe.recentlyRemovedDateranges=mt.split("	"));break;case"TARGETDURATION":fe.targetduration=parseFloat(ve);break;case'"0.5.0"':fe.version=parseInt(ve);break;case"EXTM3U":break;case"ENDLIST":fe.live=!1;break;case"#":(ve||Oe)&&Ue.tagList.push(Oe?[ve,Oe]:[ve]);break;case"DISCONTINUITY":Ce++,Ue.tagList.push(["DIS"]);break;case"GAP":Ue.tagList.push([Et]);break;case"BITRATE":Ue.tagList.push([Et,ve]);break;case"DATERANGE":var Qt=new X.AttrList(ve),Yt=new de.DateRange(Qt,fe.dateRanges[Qt.ID]);Yt.isValid||fe.skippedSegments?fe.dateRanges[Yt.id]=Yt:ie.logger.warn('Ignoring invalid DATERANGE tag: "'+ve+'"'),Ue.tagList.push(["EXT-X-DATERANGE",ve]);break;case"DISCONTINUITY-SEQUENCE":Ce=parseInt(ve);break;case"KEY":var Wt,ni=new X.AttrList(ve),Vt=ni.enumeratedString("METHOD"),bi=ni.URI,sr=ni.hexadecimalInteger("IV"),mi=ni.enumeratedString("KEYFORMATVERSIONS"),Mr=ni.enumeratedString("KEYID"),Li=(Wt=ni.enumeratedString("KEYFORMAT"))!=null?Wt:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Li)>-1){ie.logger.warn("Keyformat "+Li+" is not supported from the manifest");continue}if(Li!=="identity")continue;Vt&&(ae=Q.LevelKey.fromURL(O,bi),bi&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Vt)>=0&&(ae.method=Vt,ae.keyFormat=Li,Mr&&(ae.keyID=Mr),mi&&(ae.keyFormatVersions=mi),ae.iv=sr));break;case"START":var Zi=new X.AttrList(ve).decimalFloatingPoint("TIME-OFFSET");(0,z.isFiniteNumber)(Zi)&&(fe.startTimeOffset=Zi);break;case"MAP":var er=new X.AttrList(ve);if(Ue.duration){var Lt=new te.Fragment(k,O);v(Lt,er,K,ae),me=Lt,Ue.initSegment=me,me.rawProgramDateTime&&!Ue.rawProgramDateTime&&(Ue.rawProgramDateTime=me.rawProgramDateTime)}else v(Ue,er,K,ae),me=Ue,ut=!0;break;case"SERVER-CONTROL":var ji=new X.AttrList(ve);fe.canBlockReload=ji.bool("CAN-BLOCK-RELOAD"),fe.canSkipUntil=ji.optionalFloat("CAN-SKIP-UNTIL",0),fe.canSkipDateRanges=fe.canSkipUntil>0&&ji.bool("CAN-SKIP-DATERANGES"),fe.partHoldBack=ji.optionalFloat("PART-HOLD-BACK",0),fe.holdBack=ji.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var ln=new X.AttrList(ve);fe.partTarget=ln.decimalFloatingPoint("PART-TARGET");break;case"PART":var tr=fe.partList;tr||(tr=fe.partList=[]);var Fo=be>0?tr[tr.length-1]:void 0,Oa=be++,Ma=new te.Part(new X.AttrList(ve),Ue,O,Oa,Fo);tr.push(Ma),Ue.duration+=Ma.duration;break;case"PRELOAD-HINT":var zr=new X.AttrList(ve);fe.preloadHint=zr;break;case"RENDITION-REPORT":var sa=new X.AttrList(ve);fe.renditionReports=fe.renditionReports||[],fe.renditionReports.push(sa);break;default:ie.logger.warn("line parsed but not handled: "+R)}}}Ne&&!Ne.relurl?(ce.pop(),Re-=Ne.duration,fe.partList&&(fe.fragmentHint=Ne)):fe.partList&&(_(Ue,Ne),Ue.cc=Ce,fe.fragmentHint=Ue);var Is=ce.length,qn=ce[0],Na=ce[Is-1];if((Re+=fe.skippedSegments*fe.targetduration)>0&&Is&&Na){fe.averagetargetduration=Re/Is;var Rs=Na.sn;fe.endSN=Rs!=="initSegment"?Rs:0,qn&&(fe.startCC=qn.cc,qn.initSegment||fe.fragments.every(function(yn){return yn.relurl&&(ss=yn.relurl,b.test((ht=(zi=G.parseURL(ss))===null||zi===void 0?void 0:zi.path)!=null?ht:""));var ss,ht,zi})&&(ie.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(Ue=new te.Fragment(k,O)).relurl=Na.relurl,Ue.level=K,Ue.sn="initSegment",qn.initSegment=Ue,fe.needSidxRanges=!0))}else fe.endSN=0,fe.startCC=0;return fe.fragmentHint&&(Re+=fe.fragmentHint.duration),fe.totalduration=Re,fe.endCC=Ce,Xe>0&&function(yn,ss){for(var ht=yn[ss],zi=ss;zi--;){var Nr=yn[zi];if(!Nr)return;Nr.programDateTime=ht.programDateTime-1e3*Nr.duration,ht=Nr}}(ce,Xe),fe},A}();function w(A,D){["video","audio","text"].forEach(function(O){var K=A.filter(function(L){return(0,W.isCodecType)(L,O)});if(K.length){var k=K.filter(function(L){return L.lastIndexOf("avc1",0)===0||L.lastIndexOf("mp4a",0)===0});D[O+"Codec"]=k.length>0?k[0]:K[0],A=A.filter(function(L){return K.indexOf(L)===-1})}}),D.unknownCodecs=A}function P(A,D,O){var K=D[O];K&&(A[O]=K)}function _(A,D){A.rawProgramDateTime?A.programDateTime=Date.parse(A.rawProgramDateTime):D!=null&&D.programDateTime&&(A.programDateTime=D.endProgramDateTime),(0,z.isFiniteNumber)(A.programDateTime)||(A.programDateTime=null,A.rawProgramDateTime=null)}function v(A,D,O,K){A.relurl=D.URI,D.BYTERANGE&&A.setByteRange(D.BYTERANGE),A.level=O,A.sn="initSegment",K&&(A.levelkey=K),A.initSegment=null}},"./src/loader/playlist-loader.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>Y});var z=C("./src/polyfills/number.ts"),G=C("./src/events.ts"),de=C("./src/errors.ts"),te=C("./src/utils/logger.ts"),le=C("./src/utils/mp4-tools.ts"),Q=C("./src/loader/m3u8-parser.ts"),X=C("./src/types/loader.ts"),ie=C("./src/utils/attr-list.ts");function W(V,M){var b=V.url;return b!==void 0&&b.indexOf("data:")!==0||(b=M.url),b}var se=function(){function V(b){this.hls=void 0,this.loaders=Object.create(null),this.hls=b,this.registerListeners()}var M=V.prototype;return M.startLoad=function(b){},M.stopLoad=function(){this.destroyInternalLoaders()},M.registerListeners=function(){var b=this.hls;b.on(G.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(G.Events.LEVEL_LOADING,this.onLevelLoading,this),b.on(G.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),b.on(G.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},M.unregisterListeners=function(){var b=this.hls;b.off(G.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(G.Events.LEVEL_LOADING,this.onLevelLoading,this),b.off(G.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),b.off(G.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},M.createInternalLoader=function(b){var I=this.hls.config,w=I.pLoader,P=I.loader,_=new(w||P)(I);return b.loader=_,this.loaders[b.type]=_,_},M.getInternalLoader=function(b){return this.loaders[b.type]},M.resetInternalLoader=function(b){this.loaders[b]&&delete this.loaders[b]},M.destroyInternalLoaders=function(){for(var b in this.loaders){var I=this.loaders[b];I&&I.destroy(),this.resetInternalLoader(b)}},M.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},M.onManifestLoading=function(b,I){var w=I.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:X.PlaylistContextType.MANIFEST,url:w,deliveryDirectives:null})},M.onLevelLoading=function(b,I){var w=I.id,P=I.level,_=I.url,v=I.deliveryDirectives;this.load({id:w,groupId:null,level:P,responseType:"text",type:X.PlaylistContextType.LEVEL,url:_,deliveryDirectives:v})},M.onAudioTrackLoading=function(b,I){var w=I.id,P=I.groupId,_=I.url,v=I.deliveryDirectives;this.load({id:w,groupId:P,level:null,responseType:"text",type:X.PlaylistContextType.AUDIO_TRACK,url:_,deliveryDirectives:v})},M.onSubtitleTrackLoading=function(b,I){var w=I.id,P=I.groupId,_=I.url,v=I.deliveryDirectives;this.load({id:w,groupId:P,level:null,responseType:"text",type:X.PlaylistContextType.SUBTITLE_TRACK,url:_,deliveryDirectives:v})},M.load=function(b){var I,w,P,_,v,A,D=this.hls.config,O=this.getInternalLoader(b);if(O){var K=O.context;if(K&&K.url===b.url)return void te.logger.trace("[playlist-loader]: playlist request ongoing");te.logger.log("[playlist-loader]: aborting previous loader for type: "+b.type),O.abort()}switch(b.type){case X.PlaylistContextType.MANIFEST:w=D.manifestLoadingMaxRetry,P=D.manifestLoadingTimeOut,_=D.manifestLoadingRetryDelay,v=D.manifestLoadingMaxRetryTimeout;break;case X.PlaylistContextType.LEVEL:case X.PlaylistContextType.AUDIO_TRACK:case X.PlaylistContextType.SUBTITLE_TRACK:w=0,P=D.levelLoadingTimeOut;break;default:w=D.levelLoadingMaxRetry,P=D.levelLoadingTimeOut,_=D.levelLoadingRetryDelay,v=D.levelLoadingMaxRetryTimeout}if(O=this.createInternalLoader(b),(I=b.deliveryDirectives)!==null&&I!==void 0&&I.part&&(b.type===X.PlaylistContextType.LEVEL&&b.level!==null?A=this.hls.levels[b.level].details:b.type===X.PlaylistContextType.AUDIO_TRACK&&b.id!==null?A=this.hls.audioTracks[b.id].details:b.type===X.PlaylistContextType.SUBTITLE_TRACK&&b.id!==null&&(A=this.hls.subtitleTracks[b.id].details),A)){var k=A.partTarget,L=A.targetduration;k&&L&&(P=Math.min(1e3*Math.max(3*k,.8*L),P))}var R={timeout:P,maxRetry:w,retryDelay:_,maxRetryDelay:v,highWaterMark:0},Z={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};O.load(b,R,Z)},M.loadsuccess=function(b,I,w,P){if(P===void 0&&(P=null),w.isSidxRequest)return this.handleSidxRequest(b,w),void this.handlePlaylistLoaded(b,I,w,P);this.resetInternalLoader(w.type);var _=b.data;_.indexOf("#EXTM3U")===0?(I.parsing.start=performance.now(),_.indexOf("#EXTINF:")>0||_.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(b,I,w,P):this.handleMasterPlaylist(b,I,w,P)):this.handleManifestParsingError(b,w,"no EXTM3U delimiter",P)},M.loaderror=function(b,I,w){w===void 0&&(w=null),this.handleNetworkError(I,w,!1,b)},M.loadtimeout=function(b,I,w){w===void 0&&(w=null),this.handleNetworkError(I,w,!0)},M.handleMasterPlaylist=function(b,I,w,P){var _=this.hls,v=b.data,A=W(b,w),D=Q.default.parseMasterPlaylist(v,A),O=D.levels,K=D.sessionData;if(O.length){var k=O.map(function(fe){return{id:fe.attrs.AUDIO,audioCodec:fe.audioCodec}}),L=O.map(function(fe){return{id:fe.attrs.SUBTITLES,textCodec:fe.textCodec}}),R=Q.default.parseMasterPlaylistMedia(v,A,"AUDIO",k),Z=Q.default.parseMasterPlaylistMedia(v,A,"SUBTITLES",L),ae=Q.default.parseMasterPlaylistMedia(v,A,"CLOSED-CAPTIONS");R.length&&(R.some(function(fe){return!fe.url})||!O[0].audioCodec||O[0].attrs.AUDIO||(te.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),R.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ie.AttrList({}),bitrate:0,url:""}))),_.trigger(G.Events.MANIFEST_LOADED,{levels:O,audioTracks:R,subtitles:Z,captions:ae,url:A,stats:I,networkDetails:P,sessionData:K})}else this.handleManifestParsingError(b,w,"no level found in manifest",P)},M.handleTrackOrLevelPlaylist=function(b,I,w,P){var _=this.hls,v=w.id,A=w.level,D=w.type,O=W(b,w),K=(0,z.isFiniteNumber)(v)?v:0,k=(0,z.isFiniteNumber)(A)?A:K,L=function(ce){switch(ce.type){case X.PlaylistContextType.AUDIO_TRACK:return X.PlaylistLevelType.AUDIO;case X.PlaylistContextType.SUBTITLE_TRACK:return X.PlaylistLevelType.SUBTITLE;default:return X.PlaylistLevelType.MAIN}}(w),R=Q.default.parseLevelPlaylist(b.data,O,k,L,K);if(R.fragments.length){if(D===X.PlaylistContextType.MANIFEST){var Z={attrs:new ie.AttrList({}),bitrate:0,details:R,name:"",url:O};_.trigger(G.Events.MANIFEST_LOADED,{levels:[Z],audioTracks:[],url:O,stats:I,networkDetails:P,sessionData:null})}if(I.parsing.end=performance.now(),R.needSidxRanges){var ae,fe=(ae=R.fragments[0].initSegment)===null||ae===void 0?void 0:ae.url;this.load({url:fe,isSidxRequest:!0,type:D,level:A,levelDetails:R,id:v,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else w.levelDetails=R,this.handlePlaylistLoaded(b,I,w,P)}else _.trigger(G.Events.ERROR,{type:de.ErrorTypes.NETWORK_ERROR,details:de.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:O,reason:"no fragments found in level",level:typeof w.level=="number"?w.level:void 0})},M.handleSidxRequest=function(b,I){var w=new Uint8Array(b.data),P=(0,le.findBox)(w,["sidx"])[0];if(P){var _=(0,le.parseSegmentIndex)(P);if(_){var v=_.references,A=I.levelDetails;v.forEach(function(D,O){var K=D.info,k=A.fragments[O];if(k.byteRange.length===0&&k.setByteRange(String(1+K.end-K.start)+"@"+String(K.start)),k.initSegment){var L=(0,le.findBox)(w,["moov"])[0],R=L?L.length:null;k.initSegment.setByteRange(String(R)+"@0")}})}}},M.handleManifestParsingError=function(b,I,w,P){this.hls.trigger(G.Events.ERROR,{type:de.ErrorTypes.NETWORK_ERROR,details:de.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:I.type===X.PlaylistContextType.MANIFEST,url:b.url,reason:w,response:b,context:I,networkDetails:P})},M.handleNetworkError=function(b,I,w,P){w===void 0&&(w=!1),te.logger.warn("[playlist-loader]: A network "+(w?"timeout":"error")+" occurred while loading "+b.type+" level: "+b.level+" id: "+b.id+' group-id: "'+b.groupId+'"');var _=de.ErrorDetails.UNKNOWN,v=!1,A=this.getInternalLoader(b);switch(b.type){case X.PlaylistContextType.MANIFEST:_=w?de.ErrorDetails.MANIFEST_LOAD_TIMEOUT:de.ErrorDetails.MANIFEST_LOAD_ERROR,v=!0;break;case X.PlaylistContextType.LEVEL:_=w?de.ErrorDetails.LEVEL_LOAD_TIMEOUT:de.ErrorDetails.LEVEL_LOAD_ERROR,v=!1;break;case X.PlaylistContextType.AUDIO_TRACK:_=w?de.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:de.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,v=!1;break;case X.PlaylistContextType.SUBTITLE_TRACK:_=w?de.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:de.ErrorDetails.SUBTITLE_LOAD_ERROR,v=!1}A&&this.resetInternalLoader(b.type);var D={type:de.ErrorTypes.NETWORK_ERROR,details:_,fatal:v,url:b.url,loader:A,context:b,networkDetails:I};P&&(D.response=P),this.hls.trigger(G.Events.ERROR,D)},M.handlePlaylistLoaded=function(b,I,w,P){var _=w.type,v=w.level,A=w.id,D=w.groupId,O=w.loader,K=w.levelDetails,k=w.deliveryDirectives;if(K!=null&&K.targetduration){if(O)switch(K.live&&(O.getCacheAge&&(K.ageHeader=O.getCacheAge()||0),O.getCacheAge&&!isNaN(K.ageHeader)||(K.ageHeader=0)),_){case X.PlaylistContextType.MANIFEST:case X.PlaylistContextType.LEVEL:this.hls.trigger(G.Events.LEVEL_LOADED,{details:K,level:v||0,id:A||0,stats:I,networkDetails:P,deliveryDirectives:k});break;case X.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(G.Events.AUDIO_TRACK_LOADED,{details:K,id:A||0,groupId:D||"",stats:I,networkDetails:P,deliveryDirectives:k});break;case X.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(G.Events.SUBTITLE_TRACK_LOADED,{details:K,id:A||0,groupId:D||"",stats:I,networkDetails:P,deliveryDirectives:k})}}else this.handleManifestParsingError(b,w,"invalid target duration",P)},V}();const Y=se},"./src/polyfills/number.ts":(F,re,C)=>{C.r(re),C.d(re,{MAX_SAFE_INTEGER:()=>G,isFiniteNumber:()=>z});var z=Number.isFinite||function(de){return typeof de=="number"&&isFinite(de)},G=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});const z=function(){function G(){}return G.getSilentFrame=function(de,te){if(de==="mp4a.40.2"){if(te===1)return new Uint8Array([0,200,0,128,35,128]);if(te===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(te===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(te===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(te===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(te===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(te===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(te===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(te===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},G}()},"./src/remux/mp4-generator.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>de});var z=Math.pow(2,32)-1,G=function(){function te(){}return te.init=function(){var le;for(le in te.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},te.types)te.types.hasOwnProperty(le)&&(te.types[le]=[le.charCodeAt(0),le.charCodeAt(1),le.charCodeAt(2),le.charCodeAt(3)]);var Q=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),X=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);te.HDLR_TYPES={video:Q,audio:X};var ie=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),W=new Uint8Array([0,0,0,0,0,0,0,0]);te.STTS=te.STSC=te.STCO=W,te.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),te.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),te.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),te.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var se=new Uint8Array([105,115,111,109]),Y=new Uint8Array([97,118,99,49]),V=new Uint8Array([0,0,0,1]);te.FTYP=te.box(te.types.ftyp,se,V,se,Y),te.DINF=te.box(te.types.dinf,te.box(te.types.dref,ie))},te.box=function(le){for(var Q=8,X=arguments.length,ie=new Array(X>1?X-1:0),W=1;W<X;W++)ie[W-1]=arguments[W];for(var se=ie.length,Y=se;se--;)Q+=ie[se].byteLength;var V=new Uint8Array(Q);for(V[0]=Q>>24&255,V[1]=Q>>16&255,V[2]=Q>>8&255,V[3]=255&Q,V.set(le,4),se=0,Q=8;se<Y;se++)V.set(ie[se],Q),Q+=ie[se].byteLength;return V},te.hdlr=function(le){return te.box(te.types.hdlr,te.HDLR_TYPES[le])},te.mdat=function(le){return te.box(te.types.mdat,le)},te.mdhd=function(le,Q){Q*=le;var X=Math.floor(Q/(z+1)),ie=Math.floor(Q%(z+1));return te.box(te.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,le>>24&255,le>>16&255,le>>8&255,255&le,X>>24,X>>16&255,X>>8&255,255&X,ie>>24,ie>>16&255,ie>>8&255,255&ie,85,196,0,0]))},te.mdia=function(le){return te.box(te.types.mdia,te.mdhd(le.timescale,le.duration),te.hdlr(le.type),te.minf(le))},te.mfhd=function(le){return te.box(te.types.mfhd,new Uint8Array([0,0,0,0,le>>24,le>>16&255,le>>8&255,255&le]))},te.minf=function(le){return le.type==="audio"?te.box(te.types.minf,te.box(te.types.smhd,te.SMHD),te.DINF,te.stbl(le)):te.box(te.types.minf,te.box(te.types.vmhd,te.VMHD),te.DINF,te.stbl(le))},te.moof=function(le,Q,X){return te.box(te.types.moof,te.mfhd(le),te.traf(X,Q))},te.moov=function(le){for(var Q=le.length,X=[];Q--;)X[Q]=te.trak(le[Q]);return te.box.apply(null,[te.types.moov,te.mvhd(le[0].timescale,le[0].duration)].concat(X).concat(te.mvex(le)))},te.mvex=function(le){for(var Q=le.length,X=[];Q--;)X[Q]=te.trex(le[Q]);return te.box.apply(null,[te.types.mvex].concat(X))},te.mvhd=function(le,Q){Q*=le;var X=Math.floor(Q/(z+1)),ie=Math.floor(Q%(z+1)),W=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,le>>24&255,le>>16&255,le>>8&255,255&le,X>>24,X>>16&255,X>>8&255,255&X,ie>>24,ie>>16&255,ie>>8&255,255&ie,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return te.box(te.types.mvhd,W)},te.sdtp=function(le){var Q,X,ie=le.samples||[],W=new Uint8Array(4+ie.length);for(Q=0;Q<ie.length;Q++)X=ie[Q].flags,W[Q+4]=X.dependsOn<<4|X.isDependedOn<<2|X.hasRedundancy;return te.box(te.types.sdtp,W)},te.stbl=function(le){return te.box(te.types.stbl,te.stsd(le),te.box(te.types.stts,te.STTS),te.box(te.types.stsc,te.STSC),te.box(te.types.stsz,te.STSZ),te.box(te.types.stco,te.STCO))},te.avc1=function(le){var Q,X,ie,W=[],se=[];for(Q=0;Q<le.sps.length;Q++)ie=(X=le.sps[Q]).byteLength,W.push(ie>>>8&255),W.push(255&ie),W=W.concat(Array.prototype.slice.call(X));for(Q=0;Q<le.pps.length;Q++)ie=(X=le.pps[Q]).byteLength,se.push(ie>>>8&255),se.push(255&ie),se=se.concat(Array.prototype.slice.call(X));var Y=te.box(te.types.avcC,new Uint8Array([1,W[3],W[4],W[5],255,224|le.sps.length].concat(W).concat([le.pps.length]).concat(se))),V=le.width,M=le.height,b=le.pixelRatio[0],I=le.pixelRatio[1];return te.box(te.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,V>>8&255,255&V,M>>8&255,255&M,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Y,te.box(te.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),te.box(te.types.pasp,new Uint8Array([b>>24,b>>16&255,b>>8&255,255&b,I>>24,I>>16&255,I>>8&255,255&I])))},te.esds=function(le){var Q=le.config.length;return new Uint8Array([0,0,0,0,3,23+Q,0,1,0,4,15+Q,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([Q]).concat(le.config).concat([6,1,2]))},te.mp4a=function(le){var Q=le.samplerate;return te.box(te.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,le.channelCount,0,16,0,0,0,0,Q>>8&255,255&Q,0,0]),te.box(te.types.esds,te.esds(le)))},te.mp3=function(le){var Q=le.samplerate;return te.box(te.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,le.channelCount,0,16,0,0,0,0,Q>>8&255,255&Q,0,0]))},te.stsd=function(le){return le.type==="audio"?le.segmentCodec==="mp3"&&le.codec==="mp3"?te.box(te.types.stsd,te.STSD,te.mp3(le)):te.box(te.types.stsd,te.STSD,te.mp4a(le)):te.box(te.types.stsd,te.STSD,te.avc1(le))},te.tkhd=function(le){var Q=le.id,X=le.duration*le.timescale,ie=le.width,W=le.height,se=Math.floor(X/(z+1)),Y=Math.floor(X%(z+1));return te.box(te.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,Q>>24&255,Q>>16&255,Q>>8&255,255&Q,0,0,0,0,se>>24,se>>16&255,se>>8&255,255&se,Y>>24,Y>>16&255,Y>>8&255,255&Y,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,ie>>8&255,255&ie,0,0,W>>8&255,255&W,0,0]))},te.traf=function(le,Q){var X=te.sdtp(le),ie=le.id,W=Math.floor(Q/(z+1)),se=Math.floor(Q%(z+1));return te.box(te.types.traf,te.box(te.types.tfhd,new Uint8Array([0,0,0,0,ie>>24,ie>>16&255,ie>>8&255,255&ie])),te.box(te.types.tfdt,new Uint8Array([1,0,0,0,W>>24,W>>16&255,W>>8&255,255&W,se>>24,se>>16&255,se>>8&255,255&se])),te.trun(le,X.length+16+20+8+16+8+8),X)},te.trak=function(le){return le.duration=le.duration||4294967295,te.box(te.types.trak,te.tkhd(le),te.mdia(le))},te.trex=function(le){var Q=le.id;return te.box(te.types.trex,new Uint8Array([0,0,0,0,Q>>24,Q>>16&255,Q>>8&255,255&Q,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},te.trun=function(le,Q){var X,ie,W,se,Y,V,M=le.samples||[],b=M.length,I=12+16*b,w=new Uint8Array(I);for(Q+=8+I,w.set([le.type==="video"?1:0,0,15,1,b>>>24&255,b>>>16&255,b>>>8&255,255&b,Q>>>24&255,Q>>>16&255,Q>>>8&255,255&Q],0),X=0;X<b;X++)W=(ie=M[X]).duration,se=ie.size,Y=ie.flags,V=ie.cts,w.set([W>>>24&255,W>>>16&255,W>>>8&255,255&W,se>>>24&255,se>>>16&255,se>>>8&255,255&se,Y.isLeading<<2|Y.dependsOn,Y.isDependedOn<<6|Y.hasRedundancy<<4|Y.paddingValue<<1|Y.isNonSync,61440&Y.degradPrio,15&Y.degradPrio,V>>>24&255,V>>>16&255,V>>>8&255,255&V],12+16*X);return te.box(te.types.trun,w)},te.initSegment=function(le){te.types||te.init();var Q=te.moov(le),X=new Uint8Array(te.FTYP.byteLength+Q.byteLength);return X.set(te.FTYP),X.set(Q,te.FTYP.byteLength),X},te}();G.types=void 0,G.HDLR_TYPES=void 0,G.STTS=void 0,G.STSC=void 0,G.STCO=void 0,G.STSZ=void 0,G.VMHD=void 0,G.SMHD=void 0,G.STSD=void 0,G.FTYP=void 0,G.DINF=void 0;const de=G},"./src/remux/mp4-remuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>V,flushTextTrackMetadataCueSamples:()=>b,flushTextTrackUserdataCueSamples:()=>I,normalizePts:()=>M});var z=C("./src/polyfills/number.ts"),G=C("./src/remux/aac-helper.ts"),de=C("./src/remux/mp4-generator.ts"),te=C("./src/events.ts"),le=C("./src/errors.ts"),Q=C("./src/utils/logger.ts"),X=C("./src/types/loader.ts"),ie=C("./src/utils/timescale-conversion.ts");function W(){return W=Object.assign?Object.assign.bind():function(_){for(var v=1;v<arguments.length;v++){var A=arguments[v];for(var D in A)Object.prototype.hasOwnProperty.call(A,D)&&(_[D]=A[D])}return _},W.apply(this,arguments)}var se=null,Y=null,V=function(){function _(A,D,O,K){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=A,this.config=D,this.typeSupported=O,this.ISGenerated=!1,se===null){var k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);se=k?parseInt(k[1]):0}if(Y===null){var L=navigator.userAgent.match(/Safari\/(\d+)/i);Y=L?parseInt(L[1]):0}}var v=_.prototype;return v.destroy=function(){},v.resetTimeStamp=function(A){Q.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=A},v.resetNextTimestamp=function(){Q.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},v.resetInitSegment=function(){Q.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},v.getVideoStartPts=function(A){var D=!1,O=A.reduce(function(K,k){var L=k.pts-K;return L<-4294967296?(D=!0,M(K,k.pts)):L>0?K:k.pts},A[0].pts);return D&&Q.logger.debug("PTS rollover detected"),O},v.remux=function(A,D,O,K,k,L,R,Z){var ae,fe,ce,me,Ee,be,Re=k,Ce=k,Ne=A.pid>-1,Ue=D.pid>-1,Xe=D.samples.length,ut=A.samples.length>0,gt=R&&Xe>0||Xe>1;if((!Ne||ut)&&(!Ue||gt)||this.ISGenerated||R){this.ISGenerated||(ce=this.generateIS(A,D,k));var ft,St=this.isVideoContiguous,Et=-1;if(gt&&(Et=function(vt){for(var mt=0;mt<vt.length;mt++)if(vt[mt].key)return mt;return-1}(D.samples),!St&&this.config.forceKeyFrameOnDiscontinuity))if(be=!0,Et>0){Q.logger.warn("[mp4-remuxer]: Dropped "+Et+" out of "+Xe+" video samples due to a missing keyframe");var ve=this.getVideoStartPts(D.samples);D.samples=D.samples.slice(Et),D.dropped+=Et,ft=Ce+=(D.samples[0].pts-ve)/D.inputTimeScale}else Et===-1&&(Q.logger.warn("[mp4-remuxer]: No keyframe found out of "+Xe+" video samples"),be=!1);if(this.ISGenerated){if(ut&&gt){var Oe=this.getVideoStartPts(D.samples),Ke=(M(A.samples[0].pts,Oe)-Oe)/D.inputTimeScale;Re+=Math.max(0,Ke),Ce+=Math.max(0,-Ke)}if(ut){if(A.samplerate||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),ce=this.generateIS(A,D,k)),fe=this.remuxAudio(A,Re,this.isAudioContiguous,L,Ue||gt||Z===X.PlaylistLevelType.AUDIO?Ce:void 0),gt){var nt=fe?fe.endPTS-fe.startPTS:0;D.inputTimeScale||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),ce=this.generateIS(A,D,k)),ae=this.remuxVideo(D,Ce,St,nt)}}else gt&&(ae=this.remuxVideo(D,Ce,St,0));ae&&(ae.firstKeyFrame=Et,ae.independent=Et!==-1,ae.firstKeyFramePTS=ft)}}return this.ISGenerated&&(O.samples.length&&(Ee=b(O,k,this._initPTS,this._initDTS)),K.samples.length&&(me=I(K,k,this._initPTS))),{audio:fe,video:ae,initSegment:ce,independent:be,text:me,id3:Ee}},v.generateIS=function(A,D,O){var K,k,L,R=A.samples,Z=D.samples,ae=this.typeSupported,fe={},ce=!(0,z.isFiniteNumber)(this._initPTS),me="audio/mp4";if(ce&&(K=k=1/0),A.config&&R.length&&(A.timescale=A.samplerate,A.segmentCodec==="mp3"&&(ae.mpeg?(me="audio/mpeg",A.codec=""):ae.mp3&&(A.codec="mp3")),fe.audio={id:"audio",container:me,codec:A.codec,initSegment:A.segmentCodec==="mp3"&&ae.mpeg?new Uint8Array(0):de.default.initSegment([A]),metadata:{channelCount:A.channelCount}},ce&&(L=A.inputTimeScale,K=k=R[0].pts-Math.round(L*O))),D.sps&&D.pps&&Z.length&&(D.timescale=D.inputTimeScale,fe.video={id:"main",container:"video/mp4",codec:D.codec,initSegment:de.default.initSegment([D]),metadata:{width:D.width,height:D.height}},ce)){L=D.inputTimeScale;var Ee=this.getVideoStartPts(Z),be=Math.round(L*O);k=Math.min(k,M(Z[0].dts,Ee)-be),K=Math.min(K,Ee-be)}if(Object.keys(fe).length)return this.ISGenerated=!0,ce&&(this._initPTS=K,this._initDTS=k),{tracks:fe,initPTS:K,timescale:L}},v.remuxVideo=function(A,D,O,K){var k,L,R=A.inputTimeScale,Z=A.samples,ae=[],fe=Z.length,ce=this._initPTS,me=this.nextAvcDts,Ee=8,be=this.videoSampleDuration,Re=Number.POSITIVE_INFINITY,Ce=Number.NEGATIVE_INFINITY,Ne=!1;O&&me!==null||(me=D*R-(Z[0].pts-M(Z[0].dts,Z[0].pts)));for(var Ue=0;Ue<fe;Ue++){var Xe=Z[Ue];Xe.pts=M(Xe.pts-ce,me),Xe.dts=M(Xe.dts-ce,me),Xe.dts<Z[Ue>0?Ue-1:Ue].dts&&(Ne=!0)}Ne&&Z.sort(function(co,Uo){var Go=co.dts-Uo.dts,as=co.pts-Uo.pts;return Go||as}),k=Z[0].dts;var ut=(L=Z[Z.length-1].dts)-k,gt=ut?Math.round(ut/(fe-1)):be||A.inputTimeScale/30;if(O){var ft=k-me,St=ft>gt,Et=ft<-1;if((St||Et)&&(St?Q.logger.warn("AVC: "+(0,ie.toMsFromMpegTsClock)(ft,!0)+" ms ("+ft+"dts) hole between fragments detected, filling it"):Q.logger.warn("AVC: "+(0,ie.toMsFromMpegTsClock)(-ft,!0)+" ms ("+ft+"dts) overlapping between fragments detected"),!Et||me>Z[0].pts)){k=me;var ve=Z[0].pts-ft;Z[0].dts=k,Z[0].pts=ve,Q.logger.log("Video: First PTS/DTS adjusted: "+(0,ie.toMsFromMpegTsClock)(ve,!0)+"/"+(0,ie.toMsFromMpegTsClock)(k,!0)+", delta: "+(0,ie.toMsFromMpegTsClock)(ft,!0)+" ms")}}k=Math.max(0,k);for(var Oe=0,Ke=0,nt=0;nt<fe;nt++){for(var vt=Z[nt],mt=vt.units,Qt=mt.length,Yt=0,Wt=0;Wt<Qt;Wt++)Yt+=mt[Wt].data.length;Ke+=Yt,Oe+=Qt,vt.length=Yt,vt.dts=Math.max(vt.dts,k),Re=Math.min(vt.pts,Re),Ce=Math.max(vt.pts,Ce)}L=Z[fe-1].dts;var ni,Vt=Ke+4*Oe+8;try{ni=new Uint8Array(Vt)}catch{return void this.observer.emit(te.Events.ERROR,te.Events.ERROR,{type:le.ErrorTypes.MUX_ERROR,details:le.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Vt,reason:"fail allocating video mdat "+Vt})}var bi=new DataView(ni.buffer);bi.setUint32(0,Vt),ni.set(de.default.types.mdat,4);for(var sr=!1,mi=Number.POSITIVE_INFINITY,Mr=Number.POSITIVE_INFINITY,Li=Number.NEGATIVE_INFINITY,Zi=Number.NEGATIVE_INFINITY,er=0;er<fe;er++){for(var Lt=Z[er],ji=Lt.units,ln=0,tr=0,Fo=ji.length;tr<Fo;tr++){var Oa=ji[tr],Ma=Oa.data,zr=Oa.data.byteLength;bi.setUint32(Ee,zr),Ee+=4,ni.set(Ma,Ee),Ee+=zr,ln+=4+zr}var sa=void 0;if(er<fe-1)be=Z[er+1].dts-Lt.dts,sa=Z[er+1].pts-Lt.pts;else{var Is=this.config,qn=er>0?Lt.dts-Z[er-1].dts:gt;if(sa=er>0?Lt.pts-Z[er-1].pts:gt,Is.stretchShortVideoTrack&&this.nextAudioPts!==null){var Na=Math.floor(Is.maxBufferHole*R),Rs=(K?Re+K*R:this.nextAudioPts)-Lt.pts;Rs>Na?((be=Rs-qn)<0?be=qn:sr=!0,Q.logger.log("[mp4-remuxer]: It is approximately "+Rs/90+" ms to the next segment; using duration "+be/90+" ms for the last video frame.")):be=qn}else be=qn}var yn=Math.round(Lt.pts-Lt.dts);mi=Math.min(mi,be),Li=Math.max(Li,be),Mr=Math.min(Mr,sa),Zi=Math.max(Zi,sa),ae.push(new w(Lt.key,be,ln,yn))}if(ae.length){if(se){if(se<70){var ss=ae[0].flags;ss.dependsOn=2,ss.isNonSync=0}}else if(Y&&Zi-Mr<Li-mi&&gt/Li<.025&&ae[0].cts===0){Q.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ht=k,zi=0,Nr=ae.length;zi<Nr;zi++){var Il=ht+ae[zi].duration,Yr=ht+ae[zi].cts;if(zi<Nr-1){var Bo=Il+ae[zi+1].cts;ae[zi].duration=Bo-Yr}else ae[zi].duration=zi?ae[zi-1].duration:gt;ae[zi].cts=0,ht=Il}}}console.assert(be!==null,"mp4SampleDuration must be computed"),be=sr||!be?gt:be,this.nextAvcDts=me=L+be,this.videoSampleDuration=be,this.isVideoContiguous=!0;var Rl={data1:de.default.moof(A.sequenceNumber++,k,W({},A,{samples:ae})),data2:ni,startPTS:Re/R,endPTS:(Ce+be)/R,startDTS:k/R,endDTS:me/R,type:"video",hasAudio:!1,hasVideo:!0,nb:ae.length,dropped:A.dropped};return A.samples=[],A.dropped=0,console.assert(ni.length,"MDAT length must not be zero"),Rl},v.remuxAudio=function(A,D,O,K,k){var L=A.inputTimeScale,R=L/(A.samplerate?A.samplerate:L),Z=A.segmentCodec==="aac"?1024:1152,ae=Z*R,fe=this._initPTS,ce=A.segmentCodec==="mp3"&&this.typeSupported.mpeg,me=[],Ee=k!==void 0,be=A.samples,Re=ce?0:8,Ce=this.nextAudioPts||-1,Ne=D*L;if(this.isAudioContiguous=O=O||be.length&&Ce>0&&(K&&Math.abs(Ne-Ce)<9e3||Math.abs(M(be[0].pts-fe,Ne)-Ce)<20*ae),be.forEach(function(tr){tr.pts=M(tr.pts-fe,Ne)}),!O||Ce<0){if(be=be.filter(function(tr){return tr.pts>=0}),!be.length)return;Ce=k===0?0:K&&!Ee?Math.max(0,Ne):be[0].pts}if(A.segmentCodec==="aac")for(var Ue=this.config.maxAudioFramesDrift,Xe=0,ut=Ce;Xe<be.length;Xe++){var gt=be[Xe],ft=gt.pts,St=ft-ut,Et=Math.abs(1e3*St/L);if(St<=-Ue*ae&&Ee)Xe===0&&(Q.logger.warn("Audio frame @ "+(ft/L).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*St/L)+" ms."),this.nextAudioPts=Ce=ut=ft);else if(St>=Ue*ae&&Et<1e4&&Ee){var ve=Math.round(St/ae);(ut=ft-ve*ae)<0&&(ve--,ut+=ae),Xe===0&&(this.nextAudioPts=Ce=ut),Q.logger.warn("[mp4-remuxer]: Injecting "+ve+" audio frame @ "+(ut/L).toFixed(3)+"s due to "+Math.round(1e3*St/L)+" ms gap.");for(var Oe=0;Oe<ve;Oe++){var Ke=Math.max(ut,0),nt=G.default.getSilentFrame(A.manifestCodec||A.codec,A.channelCount);nt||(Q.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),nt=gt.unit.subarray()),be.splice(Xe,0,{unit:nt,pts:Ke}),ut+=ae,Xe++}}gt.pts=ut,ut+=ae}for(var vt,mt=null,Qt=null,Yt=0,Wt=be.length;Wt--;)Yt+=be[Wt].unit.byteLength;for(var ni=0,Vt=be.length;ni<Vt;ni++){var bi=be[ni],sr=bi.unit,mi=bi.pts;if(Qt!==null)me[ni-1].duration=Math.round((mi-Qt)/R);else{if(O&&A.segmentCodec==="aac"&&(mi=Ce),mt=mi,!(Yt>0))return;Yt+=Re;try{vt=new Uint8Array(Yt)}catch{return void this.observer.emit(te.Events.ERROR,te.Events.ERROR,{type:le.ErrorTypes.MUX_ERROR,details:le.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Yt,reason:"fail allocating audio mdat "+Yt})}ce||(new DataView(vt.buffer).setUint32(0,Yt),vt.set(de.default.types.mdat,4))}vt.set(sr,Re);var Mr=sr.byteLength;Re+=Mr,me.push(new w(!0,Z,Mr,0)),Qt=mi}var Li=me.length;if(Li){var Zi=me[me.length-1];this.nextAudioPts=Ce=Qt+R*Zi.duration;var er=ce?new Uint8Array(0):de.default.moof(A.sequenceNumber++,mt/R,W({},A,{samples:me}));A.samples=[];var Lt=mt/L,ji=Ce/L,ln={data1:er,data2:vt,startPTS:Lt,endPTS:ji,startDTS:Lt,endDTS:ji,type:"audio",hasAudio:!0,hasVideo:!1,nb:Li};return this.isAudioContiguous=!0,console.assert(vt.length,"MDAT length must not be zero"),ln}},v.remuxEmptyAudio=function(A,D,O,K){var k=A.inputTimeScale,L=k/(A.samplerate?A.samplerate:k),R=this.nextAudioPts,Z=(R!==null?R:K.startDTS*k)+this._initDTS,ae=K.endDTS*k+this._initDTS,fe=1024*L,ce=Math.ceil((ae-Z)/fe),me=G.default.getSilentFrame(A.manifestCodec||A.codec,A.channelCount);if(Q.logger.warn("[mp4-remuxer]: remux empty Audio"),me){for(var Ee=[],be=0;be<ce;be++){var Re=Z+be*fe;Ee.push({unit:me,pts:Re,dts:Re})}return A.samples=Ee,this.remuxAudio(A,D,O,!1)}Q.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},_}();function M(_,v){var A;if(v===null)return _;for(A=v<_?-8589934592:8589934592;Math.abs(_-v)>4294967296;)_+=A;return _}function b(_,v,A,D){var O=_.samples.length;if(O){for(var K=_.inputTimeScale,k=0;k<O;k++){var L=_.samples[k];L.pts=M(L.pts-A,v*K)/K,L.dts=M(L.dts-D,v*K)/K}var R=_.samples;return _.samples=[],{samples:R}}}function I(_,v,A){var D=_.samples.length;if(D){for(var O=_.inputTimeScale,K=0;K<D;K++){var k=_.samples[K];k.pts=M(k.pts-A,v*O)/O}_.samples.sort(function(R,Z){return R.pts-Z.pts});var L=_.samples;return _.samples=[],{samples:L}}}var w=function(_,v,A,D){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=v,this.size=A,this.cts=D,this.flags=new P(_)},P=function(_){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=_?2:1,this.isNonSync=_?0:1}},"./src/remux/passthrough-remuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>X});var z=C("./src/polyfills/number.ts"),G=C("./src/remux/mp4-remuxer.ts"),de=C("./src/utils/mp4-tools.ts"),te=C("./src/loader/fragment.ts"),le=C("./src/utils/logger.ts");function Q(ie,W){var se=ie?.codec;return se&&se.length>4?se:se==="hvc1"||se==="hev1"?"hvc1.1.c.L120.90":se==="av01"?"av01.0.04M.08":se==="avc1"||W===te.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const X=function(){function ie(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var W=ie.prototype;return W.destroy=function(){},W.resetTimeStamp=function(se){this.initPTS=se,this.lastEndTime=null},W.resetNextTimestamp=function(){this.lastEndTime=null},W.resetInitSegment=function(se,Y,V){this.audioCodec=Y,this.videoCodec=V,this.generateInitSegment(se),this.emitInitSegment=!0},W.generateInitSegment=function(se){var Y=this.audioCodec,V=this.videoCodec;if(!se||!se.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var M=this.initData=(0,de.parseInitSegment)(se);Y||(Y=Q(M.audio,te.ElementaryStreamTypes.AUDIO)),V||(V=Q(M.video,te.ElementaryStreamTypes.VIDEO));var b={};M.audio&&M.video?b.audiovideo={container:"video/mp4",codec:Y+","+V,initSegment:se,id:"main"}:M.audio?b.audio={container:"audio/mp4",codec:Y,initSegment:se,id:"audio"}:M.video?b.video={container:"video/mp4",codec:V,initSegment:se,id:"main"}:le.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=b},W.remux=function(se,Y,V,M,b){var I,w=this.initPTS,P=this.lastEndTime,_={audio:void 0,video:void 0,text:M,id3:V,initSegment:void 0};(0,z.isFiniteNumber)(P)||(P=this.lastEndTime=b||0);var v=Y.samples;if(!v||!v.length)return _;var A={initPTS:void 0,timescale:1},D=this.initData;if(D&&D.length||(this.generateInitSegment(v),D=this.initData),!D||!D.length)return le.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),_;this.emitInitSegment&&(A.tracks=this.initTracks,this.emitInitSegment=!1);var O=(0,de.getStartDTS)(D,v);(0,z.isFiniteNumber)(w)||(this.initPTS=A.initPTS=w=O-b);var K=(0,de.getDuration)(v,D),k=se?O-w:P,L=k+K;(0,de.offsetStartDTS)(D,v,w),K>0?this.lastEndTime=L:(le.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var R=!!D.audio,Z=!!D.video,ae="";R&&(ae+="audio"),Z&&(ae+="video");var fe={data1:v,startPTS:k,startDTS:k,endPTS:L,endDTS:L,type:ae,hasAudio:R,hasVideo:Z,nb:1,dropped:0};_.audio=fe.type==="audio"?fe:void 0,_.video=fe.type!=="audio"?fe:void 0,_.initSegment=A;var ce=(I=this.initPTS)!=null?I:0;return _.id3=(0,G.flushTextTrackMetadataCueSamples)(V,b,ce,ce),M.samples.length&&(_.text=(0,G.flushTextTrackUserdataCueSamples)(M,b,ce)),_},ie}()},"./src/task-loop.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});var z=function(){function G(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var de=G.prototype;return de.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},de.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},de.onHandlerDestroyed=function(){},de.hasInterval=function(){return!!this._tickInterval},de.hasNextTick=function(){return!!this._tickTimer},de.setInterval=function(te){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,te),!0)},de.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},de.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},de.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},de.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},de.doTick=function(){},G}()},"./src/types/cmcd.ts":(F,re,C)=>{C.r(re),C.d(re,{CMCDObjectType:()=>z,CMCDStreamType:()=>de,CMCDStreamingFormat:()=>G,CMCDVersion:()=>te});var z,G,de,te=1;(function(le){le.MANIFEST="m",le.AUDIO="a",le.VIDEO="v",le.MUXED="av",le.INIT="i",le.CAPTION="c",le.TIMED_TEXT="tt",le.KEY="k",le.OTHER="o"})(z||(z={})),function(le){le.DASH="d",le.HLS="h",le.SMOOTH="s",le.OTHER="o"}(G||(G={})),function(le){le.VOD="v",le.LIVE="l"}(de||(de={}))},"./src/types/demuxer.ts":(F,re,C)=>{var z;C.r(re),C.d(re,{MetadataSchema:()=>z}),function(G){G.audioId3="org.id3",G.dateRange="com.apple.quicktime.HLS",G.emsg="https://aomedia.org/emsg/ID3"}(z||(z={}))},"./src/types/level.ts":(F,re,C)=>{function z(Q,X){for(var ie=0;ie<X.length;ie++){var W=X[ie];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(Q,W.key,W)}}var G;function de(Q,X){var ie=Q.canSkipUntil,W=Q.canSkipDateRanges,se=Q.endSN;return ie&&(X!==void 0?X-se:0)<ie?W?G.v2:G.Yes:G.No}C.r(re),C.d(re,{HlsSkip:()=>G,HlsUrlParameters:()=>te,Level:()=>le,getSkipValue:()=>de}),function(Q){Q.No="",Q.Yes="YES",Q.v2="v2"}(G||(G={}));var te=function(){function Q(X,ie,W){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=X,this.part=ie,this.skip=W}return Q.prototype.addDirectives=function(X){var ie=new self.URL(X);return this.msn!==void 0&&ie.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&ie.searchParams.set("_HLS_part",this.part.toString()),this.skip&&ie.searchParams.set("_HLS_skip",this.skip),ie.toString()},Q}(),le=function(){function Q(se){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[se.url],this.attrs=se.attrs,this.bitrate=se.bitrate,se.details&&(this.details=se.details),this.id=se.id||0,this.name=se.name,this.width=se.width||0,this.height=se.height||0,this.audioCodec=se.audioCodec,this.videoCodec=se.videoCodec,this.unknownCodecs=se.unknownCodecs,this.codecSet=[se.videoCodec,se.audioCodec].filter(function(Y){return Y}).join(",").replace(/\.[^.,]+/g,"")}var X,ie,W;return X=Q,(ie=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(se){var Y=se%this.url.length;this._urlId!==Y&&(this.details=void 0,this._urlId=Y)}}])&&z(X.prototype,ie),W&&z(X,W),Object.defineProperty(X,"prototype",{writable:!1}),Q}()},"./src/types/loader.ts":(F,re,C)=>{var z,G;C.r(re),C.d(re,{PlaylistContextType:()=>z,PlaylistLevelType:()=>G}),function(de){de.MANIFEST="manifest",de.LEVEL="level",de.AUDIO_TRACK="audioTrack",de.SUBTITLE_TRACK="subtitleTrack"}(z||(z={})),function(de){de.MAIN="main",de.AUDIO="audio",de.SUBTITLE="subtitle"}(G||(G={}))},"./src/types/transmuxer.ts":(F,re,C)=>{C.r(re),C.d(re,{ChunkMetadata:()=>z});var z=function(G,de,te,le,Q,X){le===void 0&&(le=0),Q===void 0&&(Q=-1),X===void 0&&(X=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=G,this.sn=de,this.id=te,this.size=le,this.part=Q,this.partial=X}},"./src/utils/attr-list.ts":(F,re,C)=>{C.r(re),C.d(re,{AttrList:()=>de});var z=/^(\d+)x(\d+)$/,G=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,de=function(){function te(Q){for(var X in typeof Q=="string"&&(Q=te.parseAttrList(Q)),Q)Q.hasOwnProperty(X)&&(this[X]=Q[X])}var le=te.prototype;return le.decimalInteger=function(Q){var X=parseInt(this[Q],10);return X>Number.MAX_SAFE_INTEGER?1/0:X},le.hexadecimalInteger=function(Q){if(this[Q]){var X=(this[Q]||"0x").slice(2);X=(1&X.length?"0":"")+X;for(var ie=new Uint8Array(X.length/2),W=0;W<X.length/2;W++)ie[W]=parseInt(X.slice(2*W,2*W+2),16);return ie}return null},le.hexadecimalIntegerAsNumber=function(Q){var X=parseInt(this[Q],16);return X>Number.MAX_SAFE_INTEGER?1/0:X},le.decimalFloatingPoint=function(Q){return parseFloat(this[Q])},le.optionalFloat=function(Q,X){var ie=this[Q];return ie?parseFloat(ie):X},le.enumeratedString=function(Q){return this[Q]},le.bool=function(Q){return this[Q]==="YES"},le.decimalResolution=function(Q){var X=z.exec(this[Q]);if(X!==null)return{width:parseInt(X[1],10),height:parseInt(X[2],10)}},te.parseAttrList=function(Q){var X,ie={};for(G.lastIndex=0;(X=G.exec(Q))!==null;){var W=X[2];W.indexOf('"')===0&&W.lastIndexOf('"')===W.length-1&&(W=W.slice(1,-1)),ie[X[1]]=W}return ie},te}()},"./src/utils/binary-search.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});const z={search:function(G,de){for(var te=0,le=G.length-1,Q=null,X=null;te<=le;){var ie=de(X=G[Q=(te+le)/2|0]);if(ie>0)te=Q+1;else{if(!(ie<0))return X;le=Q-1}}return null}}},"./src/utils/buffer-helper.ts":(F,re,C)=>{C.r(re),C.d(re,{BufferHelper:()=>de});var z=C("./src/utils/logger.ts"),G={length:0,start:function(){return 0},end:function(){return 0}},de=function(){function te(){}return te.isBuffered=function(le,Q){try{if(le){for(var X=te.getBuffered(le),ie=0;ie<X.length;ie++)if(Q>=X.start(ie)&&Q<=X.end(ie))return!0}}catch{}return!1},te.bufferInfo=function(le,Q,X){try{if(le){var ie,W=te.getBuffered(le),se=[];for(ie=0;ie<W.length;ie++)se.push({start:W.start(ie),end:W.end(ie)});return this.bufferedInfo(se,Q,X)}}catch{}return{len:0,start:Q,end:Q,nextStart:void 0}},te.bufferedInfo=function(le,Q,X){Q=Math.max(0,Q),le.sort(function(v,A){var D=v.start-A.start;return D||A.end-v.end});var ie=[];if(X)for(var W=0;W<le.length;W++){var se=ie.length;if(se){var Y=ie[se-1].end;le[W].start-Y<X?le[W].end>Y&&(ie[se-1].end=le[W].end):ie.push(le[W])}else ie.push(le[W])}else ie=le;for(var V,M=0,b=Q,I=Q,w=0;w<ie.length;w++){var P=ie[w].start,_=ie[w].end;if(Q+X>=P&&Q<_)b=P,M=(I=_)-Q;else if(Q+X<P){V=P;break}}return{len:M,start:b||0,end:I||0,nextStart:V}},te.getBuffered=function(le){try{return le.buffered}catch(Q){return z.logger.log("failed to get media.buffered",Q),G}},te}()},"./src/utils/cea-608-parser.ts":(F,re,C)=>{C.r(re),C.d(re,{CaptionScreen:()=>P,Row:()=>w,default:()=>O});var z,G=C("./src/utils/logger.ts"),de={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},te=function(K){var k=K;return de.hasOwnProperty(K)&&(k=de[K]),String.fromCharCode(k)},le=15,Q=100,X={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ie={17:2,18:4,21:6,22:8,23:10,19:13,20:15},W={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},se={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(function(K){K[K.ERROR=0]="ERROR",K[K.TEXT=1]="TEXT",K[K.WARNING=2]="WARNING",K[K.INFO=2]="INFO",K[K.DEBUG=3]="DEBUG",K[K.DATA=3]="DATA"})(z||(z={}));var V=function(){function K(){this.time=null,this.verboseLevel=z.ERROR}return K.prototype.log=function(k,L){this.verboseLevel>=k&&G.logger.log(this.time+" ["+k+"] "+L)},K}(),M=function(K){for(var k=[],L=0;L<K.length;L++)k.push(K[L].toString(16));return k},b=function(){function K(L,R,Z,ae,fe){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=L||"white",this.underline=R||!1,this.italics=Z||!1,this.background=ae||"black",this.flash=fe||!1}var k=K.prototype;return k.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},k.setStyles=function(L){for(var R=["foreground","underline","italics","background","flash"],Z=0;Z<R.length;Z++){var ae=R[Z];L.hasOwnProperty(ae)&&(this[ae]=L[ae])}},k.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},k.equals=function(L){return this.foreground===L.foreground&&this.underline===L.underline&&this.italics===L.italics&&this.background===L.background&&this.flash===L.flash},k.copy=function(L){this.foreground=L.foreground,this.underline=L.underline,this.italics=L.italics,this.background=L.background,this.flash=L.flash},k.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},K}(),I=function(){function K(L,R,Z,ae,fe,ce){this.uchar=void 0,this.penState=void 0,this.uchar=L||" ",this.penState=new b(R,Z,ae,fe,ce)}var k=K.prototype;return k.reset=function(){this.uchar=" ",this.penState.reset()},k.setChar=function(L,R){this.uchar=L,this.penState.copy(R)},k.setPenState=function(L){this.penState.copy(L)},k.equals=function(L){return this.uchar===L.uchar&&this.penState.equals(L.penState)},k.copy=function(L){this.uchar=L.uchar,this.penState.copy(L.penState)},k.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},K}(),w=function(){function K(L){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var R=0;R<Q;R++)this.chars.push(new I);this.logger=L,this.pos=0,this.currPenState=new b}var k=K.prototype;return k.equals=function(L){for(var R=!0,Z=0;Z<Q;Z++)if(!this.chars[Z].equals(L.chars[Z])){R=!1;break}return R},k.copy=function(L){for(var R=0;R<Q;R++)this.chars[R].copy(L.chars[R])},k.isEmpty=function(){for(var L=!0,R=0;R<Q;R++)if(!this.chars[R].isEmpty()){L=!1;break}return L},k.setCursor=function(L){this.pos!==L&&(this.pos=L),this.pos<0?(this.logger.log(z.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>Q&&(this.logger.log(z.DEBUG,"Too large cursor position "+this.pos),this.pos=Q)},k.moveCursor=function(L){var R=this.pos+L;if(L>1)for(var Z=this.pos+1;Z<R+1;Z++)this.chars[Z].setPenState(this.currPenState);this.setCursor(R)},k.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},k.insertChar=function(L){L>=144&&this.backSpace();var R=te(L);this.pos>=Q?this.logger.log(z.ERROR,"Cannot insert "+L.toString(16)+" ("+R+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(R,this.currPenState),this.moveCursor(1))},k.clearFromPos=function(L){var R;for(R=L;R<Q;R++)this.chars[R].reset()},k.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},k.clearToEndOfRow=function(){this.clearFromPos(this.pos)},k.getTextString=function(){for(var L=[],R=!0,Z=0;Z<Q;Z++){var ae=this.chars[Z].uchar;ae!==" "&&(R=!1),L.push(ae)}return R?"":L.join("")},k.setPenStyles=function(L){this.currPenState.setStyles(L),this.chars[this.pos].setPenState(this.currPenState)},K}(),P=function(){function K(L){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var R=0;R<le;R++)this.rows.push(new w(L));this.logger=L,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var k=K.prototype;return k.reset=function(){for(var L=0;L<le;L++)this.rows[L].clear();this.currRow=14},k.equals=function(L){for(var R=!0,Z=0;Z<le;Z++)if(!this.rows[Z].equals(L.rows[Z])){R=!1;break}return R},k.copy=function(L){for(var R=0;R<le;R++)this.rows[R].copy(L.rows[R])},k.isEmpty=function(){for(var L=!0,R=0;R<le;R++)if(!this.rows[R].isEmpty()){L=!1;break}return L},k.backSpace=function(){this.rows[this.currRow].backSpace()},k.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},k.insertChar=function(L){this.rows[this.currRow].insertChar(L)},k.setPen=function(L){this.rows[this.currRow].setPenStyles(L)},k.moveCursor=function(L){this.rows[this.currRow].moveCursor(L)},k.setCursor=function(L){this.logger.log(z.INFO,"setCursor: "+L),this.rows[this.currRow].setCursor(L)},k.setPAC=function(L){this.logger.log(z.INFO,"pacData = "+JSON.stringify(L));var R=L.row-1;if(this.nrRollUpRows&&R<this.nrRollUpRows-1&&(R=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==R){for(var Z=0;Z<le;Z++)this.rows[Z].clear();var ae=this.currRow+1-this.nrRollUpRows,fe=this.lastOutputScreen;if(fe){var ce=fe.rows[ae].cueStartTime,me=this.logger.time;if(ce&&me!==null&&ce<me)for(var Ee=0;Ee<this.nrRollUpRows;Ee++)this.rows[R-this.nrRollUpRows+Ee+1].copy(fe.rows[ae+Ee])}}this.currRow=R;var be=this.rows[this.currRow];if(L.indent!==null){var Re=L.indent,Ce=Math.max(Re-1,0);be.setCursor(L.indent),L.color=be.chars[Ce].penState.foreground}var Ne={foreground:L.color,underline:L.underline,italics:L.italics,background:"black",flash:!1};this.setPen(Ne)},k.setBkgData=function(L){this.logger.log(z.INFO,"bkgData = "+JSON.stringify(L)),this.backSpace(),this.setPen(L),this.insertChar(32)},k.setRollUpRows=function(L){this.nrRollUpRows=L},k.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(z.TEXT,this.getDisplayText());var L=this.currRow+1-this.nrRollUpRows,R=this.rows.splice(L,1)[0];R.clear(),this.rows.splice(this.currRow,0,R),this.logger.log(z.INFO,"Rolling up")}else this.logger.log(z.DEBUG,"roll_up but nrRollUpRows not set yet")},k.getDisplayText=function(L){L=L||!1;for(var R=[],Z="",ae=-1,fe=0;fe<le;fe++){var ce=this.rows[fe].getTextString();ce&&(ae=fe+1,L?R.push("Row "+ae+": '"+ce+"'"):R.push(ce.trim()))}return R.length>0&&(Z=L?"["+R.join(" | ")+"]":R.join(`
`)),Z},k.getTextAndFormat=function(){return this.rows},K}(),_=function(){function K(L,R,Z){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=L,this.outputFilter=R,this.mode=null,this.verbose=0,this.displayedMemory=new P(Z),this.nonDisplayedMemory=new P(Z),this.lastOutputScreen=new P(Z),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=Z}var k=K.prototype;return k.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},k.getHandler=function(){return this.outputFilter},k.setHandler=function(L){this.outputFilter=L},k.setPAC=function(L){this.writeScreen.setPAC(L)},k.setBkgData=function(L){this.writeScreen.setBkgData(L)},k.setMode=function(L){L!==this.mode&&(this.mode=L,this.logger.log(z.INFO,"MODE="+L),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=L)},k.insertChars=function(L){for(var R=0;R<L.length;R++)this.writeScreen.insertChar(L[R]);var Z=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(z.INFO,Z+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(z.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},k.ccRCL=function(){this.logger.log(z.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},k.ccBS=function(){this.logger.log(z.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},k.ccAOF=function(){},k.ccAON=function(){},k.ccDER=function(){this.logger.log(z.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},k.ccRU=function(L){this.logger.log(z.INFO,"RU("+L+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(L)},k.ccFON=function(){this.logger.log(z.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},k.ccRDC=function(){this.logger.log(z.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},k.ccTR=function(){this.logger.log(z.INFO,"TR"),this.setMode("MODE_TEXT")},k.ccRTD=function(){this.logger.log(z.INFO,"RTD"),this.setMode("MODE_TEXT")},k.ccEDM=function(){this.logger.log(z.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},k.ccCR=function(){this.logger.log(z.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},k.ccENM=function(){this.logger.log(z.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},k.ccEOC=function(){if(this.logger.log(z.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var L=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=L,this.writeScreen=this.nonDisplayedMemory,this.logger.log(z.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},k.ccTO=function(L){this.logger.log(z.INFO,"TO("+L+") - Tab Offset"),this.writeScreen.moveCursor(L)},k.ccMIDROW=function(L){var R={flash:!1};if(R.underline=L%2==1,R.italics=L>=46,R.italics)R.foreground="white";else{var Z=Math.floor(L/2)-16;R.foreground=["white","green","blue","cyan","red","yellow","magenta"][Z]}this.logger.log(z.INFO,"MIDROW: "+JSON.stringify(R)),this.writeScreen.setPen(R)},k.outputDataUpdate=function(L){L===void 0&&(L=!1);var R=this.logger.time;R!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,R,this.lastOutputScreen),L&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:R):this.cueStartTime=R,this.lastOutputScreen.copy(this.displayedMemory))},k.cueSplitAtTime=function(L){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,L,this.displayedMemory),this.cueStartTime=L))},K}(),v=function(){function K(L,R,Z){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var ae=new V;this.channels=[null,new _(L,R,ae),new _(L+1,Z,ae)],this.cmdHistory={a:null,b:null},this.logger=ae}var k=K.prototype;return k.getHandler=function(L){return this.channels[L].getHandler()},k.setHandler=function(L,R){this.channels[L].setHandler(R)},k.addData=function(L,R){var Z,ae,fe,ce=!1;this.logger.time=L;for(var me=0;me<R.length;me+=2)if(ae=127&R[me],fe=127&R[me+1],ae!==0||fe!==0){if(this.logger.log(z.DATA,"["+M([R[me],R[me+1]])+"] -> ("+M([ae,fe])+")"),(Z=this.parseCmd(ae,fe))||(Z=this.parseMidrow(ae,fe)),Z||(Z=this.parsePAC(ae,fe)),Z||(Z=this.parseBackgroundAttributes(ae,fe)),!Z&&(ce=this.parseChars(ae,fe))){var Ee=this.currentChannel;Ee&&Ee>0?this.channels[Ee].insertChars(ce):this.logger.log(z.WARNING,"No channel found yet. TEXT-MODE?")}Z||ce||this.logger.log(z.WARNING,"Couldn't parse cleaned data "+M([ae,fe])+" orig: "+M([R[me],R[me+1]]))}},k.parseCmd=function(L,R){var Z=this.cmdHistory;if(!((L===20||L===28||L===21||L===29)&&R>=32&&R<=47||(L===23||L===31)&&R>=33&&R<=35))return!1;if(D(L,R,Z))return A(null,null,Z),this.logger.log(z.DEBUG,"Repeated command ("+M([L,R])+") is dropped"),!0;var ae=L===20||L===21||L===23?1:2,fe=this.channels[ae];return L===20||L===21||L===28||L===29?R===32?fe.ccRCL():R===33?fe.ccBS():R===34?fe.ccAOF():R===35?fe.ccAON():R===36?fe.ccDER():R===37?fe.ccRU(2):R===38?fe.ccRU(3):R===39?fe.ccRU(4):R===40?fe.ccFON():R===41?fe.ccRDC():R===42?fe.ccTR():R===43?fe.ccRTD():R===44?fe.ccEDM():R===45?fe.ccCR():R===46?fe.ccENM():R===47&&fe.ccEOC():fe.ccTO(R-32),A(L,R,Z),this.currentChannel=ae,!0},k.parseMidrow=function(L,R){var Z=0;if((L===17||L===25)&&R>=32&&R<=47){if((Z=L===17?1:2)!==this.currentChannel)return this.logger.log(z.ERROR,"Mismatch channel in midrow parsing"),!1;var ae=this.channels[Z];return!!ae&&(ae.ccMIDROW(R),this.logger.log(z.DEBUG,"MIDROW ("+M([L,R])+")"),!0)}return!1},k.parsePAC=function(L,R){var Z,ae=this.cmdHistory;if(!((L>=17&&L<=23||L>=25&&L<=31)&&R>=64&&R<=127||(L===16||L===24)&&R>=64&&R<=95))return!1;if(D(L,R,ae))return A(null,null,ae),!0;var fe=L<=23?1:2;Z=R>=64&&R<=95?fe===1?X[L]:W[L]:fe===1?ie[L]:se[L];var ce=this.channels[fe];return!!ce&&(ce.setPAC(this.interpretPAC(Z,R)),A(L,R,ae),this.currentChannel=fe,!0)},k.interpretPAC=function(L,R){var Z,ae={color:null,italics:!1,indent:null,underline:!1,row:L};return Z=R>95?R-96:R-64,ae.underline=(1&Z)==1,Z<=13?ae.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(Z/2)]:Z<=15?(ae.italics=!0,ae.color="white"):ae.indent=4*Math.floor((Z-16)/2),ae},k.parseChars=function(L,R){var Z,ae,fe=null,ce=null;if(L>=25?(Z=2,ce=L-8):(Z=1,ce=L),ce>=17&&ce<=19?(ae=ce===17?R+80:ce===18?R+112:R+144,this.logger.log(z.INFO,"Special char '"+te(ae)+"' in channel "+Z),fe=[ae]):L>=32&&L<=127&&(fe=R===0?[L]:[L,R]),fe){var me=M(fe);this.logger.log(z.DEBUG,"Char codes =  "+me.join(",")),A(L,R,this.cmdHistory)}return fe},k.parseBackgroundAttributes=function(L,R){var Z;if(!((L===16||L===24)&&R>=32&&R<=47||(L===23||L===31)&&R>=45&&R<=47))return!1;var ae={};L===16||L===24?(Z=Math.floor((R-32)/2),ae.background=Y[Z],R%2==1&&(ae.background=ae.background+"_semi")):R===45?ae.background="transparent":(ae.foreground="black",R===47&&(ae.underline=!0));var fe=L<=23?1:2;return this.channels[fe].setBkgData(ae),A(L,R,this.cmdHistory),!0},k.reset=function(){for(var L=0;L<Object.keys(this.channels).length;L++){var R=this.channels[L];R&&R.reset()}this.cmdHistory={a:null,b:null}},k.cueSplitAtTime=function(L){for(var R=0;R<this.channels.length;R++){var Z=this.channels[R];Z&&Z.cueSplitAtTime(L)}},K}();function A(K,k,L){L.a=K,L.b=k}function D(K,k,L){return L.a===K&&L.b===k}const O=v},"./src/utils/codecs.ts":(F,re,C)=>{C.r(re),C.d(re,{isCodecSupportedInMp4:()=>de,isCodecType:()=>G});var z={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function G(te,le){var Q=z[le];return!!Q&&Q[te.slice(0,4)]===!0}function de(te,le){return MediaSource.isTypeSupported((le||"video")+'/mp4;codecs="'+te+'"')}},"./src/utils/cues.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>le});var z=C("./src/utils/vttparser.ts"),G=C("./src/utils/webvtt-parser.ts"),de=C("./src/utils/texttrack-utils.ts"),te=/\s/;const le={newCue:function(Q,X,ie,W){for(var se,Y,V,M,b,I=[],w=self.VTTCue||self.TextTrackCue,P=0;P<W.rows.length;P++)if(V=!0,M=0,b="",!(se=W.rows[P]).isEmpty()){for(var _=0;_<se.chars.length;_++)te.test(se.chars[_].uchar)&&V?M++:(b+=se.chars[_].uchar,V=!1);se.cueStartTime=X,X===ie&&(ie+=1e-4),M>=16?M--:M++;var v=(0,z.fixLineBreaks)(b.trim()),A=(0,G.generateCueId)(X,ie,v);Q&&Q.cues&&Q.cues.getCueById(A)||((Y=new w(X,ie,v)).id=A,Y.line=P+1,Y.align="left",Y.position=10+Math.min(80,10*Math.floor(8*M/32)),I.push(Y))}return Q&&I.length&&(I.sort(function(D,O){return D.line==="auto"||O.line==="auto"?0:D.line>8&&O.line>8?O.line-D.line:D.line-O.line}),I.forEach(function(D){return(0,de.addCueToTrack)(Q,D)})),I}}},"./src/utils/discontinuities.ts":(F,re,C)=>{C.r(re),C.d(re,{adjustSlidingStart:()=>ie,alignMediaPlaylistByPDT:()=>Y,alignPDT:()=>se,alignStream:()=>W,findDiscontinuousReferenceFrag:()=>Q,findFirstFragWithCC:()=>te,shouldAlignOnDiscontinuities:()=>le});var z=C("./src/polyfills/number.ts"),G=C("./src/utils/logger.ts"),de=C("./src/controller/level-helper.ts");function te(V,M){for(var b=null,I=0,w=V.length;I<w;I++){var P=V[I];if(P&&P.cc===M){b=P;break}}return b}function le(V,M,b){return!(!M.details||!(b.endCC>b.startCC||V&&V.cc<b.startCC))}function Q(V,M,b){var I=V.fragments,w=M.fragments;if(w.length&&I.length){var P=te(I,w[0].cc);if(P&&(!P||P.startPTS))return P;G.logger.log("No frag in previous level to align on")}else G.logger.log("No fragments to align")}function X(V,M){if(V){var b=V.start+M;V.start=V.startPTS=b,V.endPTS=b+V.duration}}function ie(V,M){for(var b=M.fragments,I=0,w=b.length;I<w;I++)X(b[I],V);M.fragmentHint&&X(M.fragmentHint,V),M.alignedSliding=!0}function W(V,M,b){M&&(function(I,w,P){if(le(I,P,w)){var _=Q(P.details,w);_&&(0,z.isFiniteNumber)(_.start)&&(G.logger.log("Adjusting PTS using last level due to CC increase within current level "+w.url),ie(_.start,w))}}(V,b,M),!b.alignedSliding&&M.details&&se(b,M.details),b.alignedSliding||!M.details||b.skippedSegments||(0,de.adjustSliding)(M.details,b))}function se(V,M){if(M.fragments.length&&V.hasProgramDateTime&&M.hasProgramDateTime){var b=M.fragments[0].programDateTime,I=V.fragments[0].programDateTime,w=(I-b)/1e3+M.fragments[0].start;w&&(0,z.isFiniteNumber)(w)&&(G.logger.log("Adjusting PTS using programDateTime delta "+(I-b)+"ms, sliding:"+w.toFixed(3)+" "+V.url+" "),ie(w,V))}}function Y(V,M){if(V.hasProgramDateTime&&M.hasProgramDateTime){var b=V.fragments,I=M.fragments;if(b.length&&I.length){var w=I[Math.round(I.length/2)-1],P=te(b,w.cc)||b[Math.round(b.length/2)-1],_=w.programDateTime,v=P.programDateTime;_!==null&&v!==null&&ie((v-_)/1e3-(P.start-w.start),V)}}}},"./src/utils/ewma-bandwidth-estimator.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>G});var z=C("./src/utils/ewma.ts");const G=function(){function de(le,Q,X){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=X,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new z.default(le),this.fast_=new z.default(Q)}var te=de.prototype;return te.update=function(le,Q){var X=this.slow_,ie=this.fast_;this.slow_.halfLife!==le&&(this.slow_=new z.default(le,X.getEstimate(),X.getTotalWeight())),this.fast_.halfLife!==Q&&(this.fast_=new z.default(Q,ie.getEstimate(),ie.getTotalWeight()))},te.sample=function(le,Q){var X=(le=Math.max(le,this.minDelayMs_))/1e3,ie=8*Q/X;this.fast_.sample(X,ie),this.slow_.sample(X,ie)},te.canEstimate=function(){var le=this.fast_;return le&&le.getTotalWeight()>=this.minWeight_},te.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},te.destroy=function(){},de}()},"./src/utils/ewma.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});const z=function(){function G(te,le,Q){le===void 0&&(le=0),Q===void 0&&(Q=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=te,this.alpha_=te?Math.exp(Math.log(.5)/te):0,this.estimate_=le,this.totalWeight_=Q}var de=G.prototype;return de.sample=function(te,le){var Q=Math.pow(this.alpha_,te);this.estimate_=le*(1-Q)+Q*this.estimate_,this.totalWeight_+=te},de.getTotalWeight=function(){return this.totalWeight_},de.getEstimate=function(){if(this.alpha_){var te=1-Math.pow(this.alpha_,this.totalWeight_);if(te)return this.estimate_/te}return this.estimate_},G}()},"./src/utils/fetch-loader.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>b,fetchSupported:()=>se});var z=C("./src/polyfills/number.ts"),G=C("./src/loader/load-stats.ts"),de=C("./src/demux/chunk-cache.ts");function te(I){var w=typeof Map=="function"?new Map:void 0;return te=function(P){if(P===null||(_=P,Function.toString.call(_).indexOf("[native code]")===-1))return P;var _;if(typeof P!="function")throw new TypeError("Super expression must either be null or a function");if(w!==void 0){if(w.has(P))return w.get(P);w.set(P,v)}function v(){return le(P,arguments,ie(this).constructor)}return v.prototype=Object.create(P.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),X(v,P)},te(I)}function le(I,w,P){return le=Q()?Reflect.construct.bind():function(_,v,A){var D=[null];D.push.apply(D,v);var O=new(Function.bind.apply(_,D));return A&&X(O,A.prototype),O},le.apply(null,arguments)}function Q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function X(I,w){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(P,_){return P.__proto__=_,P},X(I,w)}function ie(I){return ie=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(w){return w.__proto__||Object.getPrototypeOf(w)},ie(I)}function W(){return W=Object.assign?Object.assign.bind():function(I){for(var w=1;w<arguments.length;w++){var P=arguments[w];for(var _ in P)Object.prototype.hasOwnProperty.call(P,_)&&(I[_]=P[_])}return I},W.apply(this,arguments)}function se(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var Y=function(){function I(P){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=P.fetchSetup||V,this.controller=new self.AbortController,this.stats=new G.LoadStats}var w=I.prototype;return w.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},w.abortInternal=function(){var P=this.response;P&&P.ok||(this.stats.aborted=!0,this.controller.abort())},w.abort=function(){var P;this.abortInternal(),(P=this.callbacks)!==null&&P!==void 0&&P.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},w.load=function(P,_,v){var A=this,D=this.stats;if(D.loading.start)throw new Error("Loader can only be used once.");D.loading.start=self.performance.now();var O=function(R,Z){var ae={method:"GET",mode:"cors",credentials:"same-origin",signal:Z,headers:new self.Headers(W({},R.headers))};return R.rangeEnd&&ae.headers.set("Range","bytes="+R.rangeStart+"-"+String(R.rangeEnd-1)),ae}(P,this.controller.signal),K=v.onProgress,k=P.responseType==="arraybuffer",L=k?"byteLength":"length";this.context=P,this.config=_,this.callbacks=v,this.request=this.fetchSetup(P,O),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){A.abortInternal(),v.onTimeout(D,P,A.response)},_.timeout),self.fetch(this.request).then(function(R){if(A.response=A.loader=R,!R.ok){var Z=R.status,ae=R.statusText;throw new M(ae||"fetch, bad network response",Z,R)}return D.loading.first=Math.max(self.performance.now(),D.loading.start),D.total=parseInt(R.headers.get("Content-Length")||"0"),K&&(0,z.isFiniteNumber)(_.highWaterMark)?A.loadProgressively(R,D,P,_.highWaterMark,K):k?R.arrayBuffer():R.text()}).then(function(R){var Z=A.response;self.clearTimeout(A.requestTimeout),D.loading.end=Math.max(self.performance.now(),D.loading.first);var ae=R[L];ae&&(D.loaded=D.total=ae);var fe={url:Z.url,data:R};K&&!(0,z.isFiniteNumber)(_.highWaterMark)&&K(D,P,R,Z),v.onSuccess(fe,D,P,Z)}).catch(function(R){if(self.clearTimeout(A.requestTimeout),!D.aborted){var Z=R&&R.code||0,ae=R?R.message:null;v.onError({code:Z,text:ae},P,R?R.details:null)}})},w.getCacheAge=function(){var P=null;if(this.response){var _=this.response.headers.get("age");P=_?parseFloat(_):null}return P},w.loadProgressively=function(P,_,v,A,D){A===void 0&&(A=0);var O=new de.default,K=P.body.getReader();return function k(){return K.read().then(function(L){if(L.done)return O.dataLength&&D(_,v,O.flush(),P),Promise.resolve(new ArrayBuffer(0));var R=L.value,Z=R.length;return _.loaded+=Z,Z<A||O.dataLength?(O.push(R),O.dataLength>=A&&D(_,v,O.flush(),P)):D(_,v,R,P),k()}).catch(function(){return Promise.reject()})}()},I}();function V(I,w){return new self.Request(I.url,w)}var M=function(I){var w,P;function _(v,A,D){var O;return(O=I.call(this,v)||this).code=void 0,O.details=void 0,O.code=A,O.details=D,O}return P=I,(w=_).prototype=Object.create(P.prototype),w.prototype.constructor=w,X(w,P),_}(te(Error));const b=Y},"./src/utils/imsc1-ttml-parser.ts":(F,re,C)=>{C.r(re),C.d(re,{IMSC1_CODEC:()=>ie,parseIMSC1:()=>V});var z=C("./src/utils/mp4-tools.ts"),G=C("./src/utils/vttparser.ts"),de=C("./src/utils/vttcue.ts"),te=C("./src/demux/id3.ts"),le=C("./src/utils/timescale-conversion.ts"),Q=C("./src/utils/webvtt-parser.ts");function X(){return X=Object.assign?Object.assign.bind():function(v){for(var A=1;A<arguments.length;A++){var D=arguments[A];for(var O in D)Object.prototype.hasOwnProperty.call(D,O)&&(v[O]=D[O])}return v},X.apply(this,arguments)}var ie="stpp.ttml.im1t",W=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,se=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Y={left:"start",center:"center",right:"end",start:"start",end:"end"};function V(v,A,D,O,K){var k=(0,z.findBox)(new Uint8Array(v),["mdat"]);if(k.length!==0){var L=k.map(function(Z){return(0,te.utf8ArrayToStr)(Z)}),R=(0,le.toTimescaleFromScale)(A,1,D);try{L.forEach(function(Z){return O(function(ae,fe){var ce=new DOMParser().parseFromString(ae,"text/xml"),me=ce.getElementsByTagName("tt")[0];if(!me)throw new Error("Invalid ttml");var Ee={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},be=Object.keys(Ee).reduce(function(Xe,ut){return Xe[ut]=me.getAttribute("ttp:"+ut)||Ee[ut],Xe},{}),Re=me.getAttribute("xml:space")!=="preserve",Ce=b(M(me,"styling","style")),Ne=b(M(me,"layout","region")),Ue=M(me,"body","[begin]");return[].map.call(Ue,function(Xe){var ut=I(Xe,Re);if(!ut||!Xe.hasAttribute("begin"))return null;var gt=_(Xe.getAttribute("begin"),be),ft=_(Xe.getAttribute("dur"),be),St=_(Xe.getAttribute("end"),be);if(gt===null)throw P(Xe);if(St===null){if(ft===null)throw P(Xe);St=gt+ft}var Et=new de.default(gt-fe,St-fe,ut);Et.id=(0,Q.generateCueId)(Et.startTime,Et.endTime,Et.text);var ve=Ne[Xe.getAttribute("region")],Oe=Ce[Xe.getAttribute("style")];Et.position=10,Et.size=80;var Ke=function(mt,Qt,Yt){var Wt="http://www.w3.org/ns/ttml#styling",ni=null,Vt=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],bi=mt!=null&&mt.hasAttribute("style")?mt.getAttribute("style"):null;return bi&&Yt.hasOwnProperty(bi)&&(ni=Yt[bi]),Vt.reduce(function(sr,mi){var Mr=w(Qt,Wt,mi)||w(mt,Wt,mi)||w(ni,Wt,mi);return Mr&&(sr[mi]=Mr),sr},{})}(ve,Oe,Ce),nt=Ke.textAlign;if(nt){var vt=Y[nt];vt&&(Et.lineAlign=vt),Et.align=nt}return X(Et,Ke),Et}).filter(function(Xe){return Xe!==null})}(Z,R))})}catch(Z){K(Z)}}else K(new Error("Could not parse IMSC1 mdat"))}function M(v,A,D){var O=v.getElementsByTagName(A)[0];return O?[].slice.call(O.querySelectorAll(D)):[]}function b(v){return v.reduce(function(A,D){var O=D.getAttribute("xml:id");return O&&(A[O]=D),A},{})}function I(v,A){return[].slice.call(v.childNodes).reduce(function(D,O,K){var k;return O.nodeName==="br"&&K?D+`
`:(k=O.childNodes)!==null&&k!==void 0&&k.length?I(O,A):A?D+O.textContent.trim().replace(/\s+/g," "):D+O.textContent},"")}function w(v,A,D){return v&&v.hasAttributeNS(A,D)?v.getAttributeNS(A,D):null}function P(v){return new Error("Could not parse ttml timestamp "+v)}function _(v,A){if(!v)return null;var D=(0,G.parseTimeStamp)(v);return D===null&&(W.test(v)?D=function(O,K){var k=W.exec(O),L=(0|k[4])+(0|k[5])/K.subFrameRate;return 3600*(0|k[1])+60*(0|k[2])+(0|k[3])+L/K.frameRate}(v,A):se.test(v)&&(D=function(O,K){var k=se.exec(O),L=Number(k[1]);switch(k[2]){case"h":return 3600*L;case"m":return 60*L;case"ms":return 1e3*L;case"f":return L/K.frameRate;case"t":return L/K.tickRate}return L}(v,A))),D}},"./src/utils/logger.ts":(F,re,C)=>{C.r(re),C.d(re,{enableLogs:()=>le,logger:()=>Q});var z=function(){},G={trace:z,debug:z,log:z,warn:z,info:z,error:z},de=G;function te(X){var ie=self.console[X];return ie?ie.bind(self.console,"["+X+"] >"):z}function le(X,ie){if(self.console&&X===!0||typeof X=="object"){(function(W){for(var se=arguments.length,Y=new Array(se>1?se-1:0),V=1;V<se;V++)Y[V-1]=arguments[V];Y.forEach(function(M){de[M]=W[M]?W[M].bind(W):te(M)})})(X,"debug","log","info","warn","error");try{de.log('Debug logs enabled for "'+ie+'"')}catch{de=G}}else de=G}var Q=G},"./src/utils/mediakeys-helper.ts":(F,re,C)=>{var z;C.r(re),C.d(re,{KeySystems:()=>z,requestMediaKeySystemAccess:()=>G}),function(de){de.WIDEVINE="com.widevine.alpha",de.PLAYREADY="com.microsoft.playready"}(z||(z={}));var G=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":(F,re,C)=>{function z(){return self.MediaSource||self.WebKitMediaSource}C.r(re),C.d(re,{getMediaSource:()=>z})},"./src/utils/mp4-tools.ts":(F,re,C)=>{C.r(re),C.d(re,{RemuxerTrackIdConfig:()=>Q,appendUint8Array:()=>A,bin2str:()=>X,computeRawDurationFromSamples:()=>P,discardEPB:()=>k,findBox:()=>V,getDuration:()=>w,getStartDTS:()=>I,offsetStartDTS:()=>_,parseEmsg:()=>L,parseInitSegment:()=>b,parseSEIMessageFromNALu:()=>K,parseSamples:()=>D,parseSegmentIndex:()=>M,readSint32:()=>se,readUint16:()=>ie,readUint32:()=>W,segmentValidRange:()=>v,writeUint32:()=>Y});var z=C("./src/utils/typed-array.ts"),G=C("./src/loader/fragment.ts"),de=C("./src/demux/id3.ts"),te=Math.pow(2,32)-1,le=[].push,Q={video:1,audio:2,id3:3,text:4};function X(R){return String.fromCharCode.apply(null,R)}function ie(R,Z){var ae=R[Z]<<8|R[Z+1];return ae<0?65536+ae:ae}function W(R,Z){var ae=se(R,Z);return ae<0?4294967296+ae:ae}function se(R,Z){return R[Z]<<24|R[Z+1]<<16|R[Z+2]<<8|R[Z+3]}function Y(R,Z,ae){R[Z]=ae>>24,R[Z+1]=ae>>16&255,R[Z+2]=ae>>8&255,R[Z+3]=255&ae}function V(R,Z){var ae=[];if(!Z.length)return ae;for(var fe=R.byteLength,ce=0;ce<fe;){var me=W(R,ce),Ee=me>1?ce+me:fe;if(X(R.subarray(ce+4,ce+8))===Z[0])if(Z.length===1)ae.push(R.subarray(ce+8,Ee));else{var be=V(R.subarray(ce+8,Ee),Z.slice(1));be.length&&le.apply(ae,be)}ce=Ee}return ae}function M(R){var Z=[],ae=R[0],fe=8,ce=W(R,fe);fe+=4,fe+=ae===0?8:16,fe+=2;var me=R.length+0,Ee=ie(R,fe);fe+=2;for(var be=0;be<Ee;be++){var Re=fe,Ce=W(R,Re);Re+=4;var Ne=2147483647&Ce;if((2147483648&Ce)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Ue=W(R,Re);Re+=4,Z.push({referenceSize:Ne,subsegmentDuration:Ue,info:{duration:Ue/ce,start:me,end:me+Ne-1}}),me+=Ne,fe=Re+=4}return{earliestPresentationTime:0,timescale:ce,version:ae,referencesCount:Ee,references:Z}}function b(R){for(var Z=[],ae=V(R,["moov","trak"]),fe=0;fe<ae.length;fe++){var ce=ae[fe],me=V(ce,["tkhd"])[0];if(me){var Ee=me[0],be=Ee===0?12:20,Re=W(me,be),Ce=V(ce,["mdia","mdhd"])[0];if(Ce){var Ne=W(Ce,be=(Ee=Ce[0])===0?12:20),Ue=V(ce,["mdia","hdlr"])[0];if(Ue){var Xe=X(Ue.subarray(8,12)),ut={soun:G.ElementaryStreamTypes.AUDIO,vide:G.ElementaryStreamTypes.VIDEO}[Xe];if(ut){var gt=V(ce,["mdia","minf","stbl","stsd"])[0],ft=void 0;gt&&(ft=X(gt.subarray(12,16))),Z[Re]={timescale:Ne,type:ut},Z[ut]={timescale:Ne,id:Re,codec:ft}}}}}}return V(R,["moov","mvex","trex"]).forEach(function(St){var Et=W(St,4),ve=Z[Et];ve&&(ve.default={duration:W(St,12),flags:W(St,20)})}),Z}function I(R,Z){return V(Z,["moof","traf"]).reduce(function(ae,fe){var ce=V(fe,["tfdt"])[0],me=ce[0],Ee=V(fe,["tfhd"]).reduce(function(be,Re){var Ce=W(Re,4),Ne=R[Ce];if(Ne){var Ue=W(ce,4);me===1&&(Ue*=Math.pow(2,32),Ue+=W(ce,8));var Xe=Ue/(Ne.timescale||9e4);if(isFinite(Xe)&&(be===null||Xe<be))return Xe}return be},null);return Ee!==null&&isFinite(Ee)&&(ae===null||Ee<ae)?Ee:ae},null)||0}function w(R,Z){for(var ae=0,fe=0,ce=0,me=V(R,["moof","traf"]),Ee=0;Ee<me.length;Ee++){var be=me[Ee],Re=V(be,["tfhd"])[0],Ce=Z[W(Re,4)];if(Ce){var Ne=Ce.default,Ue=W(Re,0)|Ne?.flags,Xe=Ne?.duration;8&Ue&&(Xe=W(Re,2&Ue?12:8));for(var ut=Ce.timescale||9e4,gt=V(be,["trun"]),ft=0;ft<gt.length;ft++)!(ae=P(gt[ft]))&&Xe&&(ae=Xe*W(gt[ft],4)),Ce.type===G.ElementaryStreamTypes.VIDEO?fe+=ae/ut:Ce.type===G.ElementaryStreamTypes.AUDIO&&(ce+=ae/ut)}}if(fe===0&&ce===0){for(var St=0,Et=V(R,["sidx"]),ve=0;ve<Et.length;ve++){var Oe=M(Et[ve]);Oe!=null&&Oe.references&&(St+=Oe.references.reduce(function(Ke,nt){return Ke+nt.info.duration||0},0))}return St}return fe||ce}function P(R){var Z=W(R,0),ae=8;1&Z&&(ae+=4),4&Z&&(ae+=4);for(var fe=0,ce=W(R,4),me=0;me<ce;me++)256&Z&&(fe+=W(R,ae),ae+=4),512&Z&&(ae+=4),1024&Z&&(ae+=4),2048&Z&&(ae+=4);return fe}function _(R,Z,ae){V(Z,["moof","traf"]).forEach(function(fe){V(fe,["tfhd"]).forEach(function(ce){var me=W(ce,4),Ee=R[me];if(Ee){var be=Ee.timescale||9e4;V(fe,["tfdt"]).forEach(function(Re){var Ce=Re[0],Ne=W(Re,4);if(Ce===0)Ne-=ae*be,Y(Re,4,Ne=Math.max(Ne,0));else{Ne*=Math.pow(2,32),Ne+=W(Re,8),Ne-=ae*be,Ne=Math.max(Ne,0);var Ue=Math.floor(Ne/(te+1)),Xe=Math.floor(Ne%(te+1));Y(Re,4,Ue),Y(Re,8,Xe)}})}})})}function v(R){var Z={valid:null,remainder:null},ae=V(R,["moof"]);if(!ae)return Z;if(ae.length<2)return Z.remainder=R,Z;var fe=ae[ae.length-1];return Z.valid=(0,z.sliceUint8)(R,0,fe.byteOffset-8),Z.remainder=(0,z.sliceUint8)(R,fe.byteOffset-8),Z}function A(R,Z){var ae=new Uint8Array(R.length+Z.length);return ae.set(R),ae.set(Z,R.length),ae}function D(R,Z){var ae=[],fe=Z.samples,ce=Z.timescale,me=Z.id,Ee=!1;return V(fe,["moof"]).map(function(be){var Re=be.byteOffset-8;V(be,["traf"]).map(function(Ce){var Ne=V(Ce,["tfdt"]).map(function(Ue){var Xe=Ue[0],ut=W(Ue,4);return Xe===1&&(ut*=Math.pow(2,32),ut+=W(Ue,8)),ut/ce})[0];return Ne!==void 0&&(R=Ne),V(Ce,["tfhd"]).map(function(Ue){var Xe=W(Ue,4),ut=16777215&W(Ue,0),gt=0,ft=(16&ut)!=0,St=0,Et=(32&ut)!=0,ve=8;Xe===me&&(1&ut&&(ve+=8),2&ut&&(ve+=4),8&ut&&(gt=W(Ue,ve),ve+=4),ft&&(St=W(Ue,ve),ve+=4),Et&&(ve+=4),Z.type==="video"&&(Ee=function(Oe){if(!Oe)return!1;var Ke=Oe.indexOf("."),nt=Ke<0?Oe:Oe.substring(0,Ke);return nt==="hvc1"||nt==="hev1"||nt==="dvh1"||nt==="dvhe"}(Z.codec)),V(Ce,["trun"]).map(function(Oe){var Ke=Oe[0],nt=16777215&W(Oe,0),vt=(1&nt)!=0,mt=0,Qt=(4&nt)!=0,Yt=(256&nt)!=0,Wt=0,ni=(512&nt)!=0,Vt=0,bi=(1024&nt)!=0,sr=(2048&nt)!=0,mi=0,Mr=W(Oe,4),Li=8;vt&&(mt=W(Oe,Li),Li+=4),Qt&&(Li+=4);for(var Zi=mt+Re,er=0;er<Mr;er++){if(Yt?(Wt=W(Oe,Li),Li+=4):Wt=gt,ni?(Vt=W(Oe,Li),Li+=4):Vt=St,bi&&(Li+=4),sr&&(mi=Ke===0?W(Oe,Li):se(Oe,Li),Li+=4),Z.type===G.ElementaryStreamTypes.VIDEO)for(var Lt=0;Lt<Vt;){var ji=W(fe,Zi);O(Ee,fe[Zi+=4])&&K(fe.subarray(Zi,Zi+ji),Ee?2:1,R+mi/ce,ae),Zi+=ji,Lt+=ji+4}R+=Wt/ce}}))})})}),ae}function O(R,Z){if(R){var ae=Z>>1&63;return ae===39||ae===40}return(31&Z)==6}function K(R,Z,ae,fe){var ce=k(R),me=0;me+=Z;for(var Ee=0,be=0,Re=!1,Ce=0;me<ce.length;){Ee=0;do{if(me>=ce.length)break;Ee+=Ce=ce[me++]}while(Ce===255);be=0;do{if(me>=ce.length)break;be+=Ce=ce[me++]}while(Ce===255);var Ne=ce.length-me;if(!Re&&Ee===4&&me<ce.length){if(Re=!0,ce[me++]===181){var Ue=ie(ce,me);if(me+=2,Ue===49){var Xe=W(ce,me);if(me+=4,Xe===1195456820){var ut=ce[me++];if(ut===3){var gt=ce[me++],ft=64&gt,St=ft?2+3*(31&gt):0,Et=new Uint8Array(St);if(ft){Et[0]=gt;for(var ve=1;ve<St;ve++)Et[ve]=ce[me++]}fe.push({type:ut,payloadType:Ee,pts:ae,bytes:Et})}}}}}else if(Ee===5&&be<Ne){if(Re=!0,be>16){for(var Oe=[],Ke=0;Ke<16;Ke++){var nt=ce[me++].toString(16);Oe.push(nt.length==1?"0"+nt:nt),Ke!==3&&Ke!==5&&Ke!==7&&Ke!==9||Oe.push("-")}for(var vt=be-16,mt=new Uint8Array(vt),Qt=0;Qt<vt;Qt++)mt[Qt]=ce[me++];fe.push({payloadType:Ee,pts:ae,uuid:Oe.join(""),userData:(0,de.utf8ArrayToStr)(mt),userDataBytes:mt})}}else if(be<Ne)me+=be;else if(be>Ne)break}}function k(R){for(var Z=R.byteLength,ae=[],fe=1;fe<Z-2;)R[fe]===0&&R[fe+1]===0&&R[fe+2]===3?(ae.push(fe+2),fe+=2):fe++;if(ae.length===0)return R;var ce=Z-ae.length,me=new Uint8Array(ce),Ee=0;for(fe=0;fe<ce;Ee++,fe++)Ee===ae[0]&&(Ee++,ae.shift()),me[fe]=R[Ee];return me}function L(R){var Z=R[0],ae="",fe="",ce=0,me=0,Ee=0,be=0,Re=0,Ce=0;if(Z===0){for(;X(R.subarray(Ce,Ce+1))!=="\0";)ae+=X(R.subarray(Ce,Ce+1)),Ce+=1;for(ae+=X(R.subarray(Ce,Ce+1)),Ce+=1;X(R.subarray(Ce,Ce+1))!=="\0";)fe+=X(R.subarray(Ce,Ce+1)),Ce+=1;fe+=X(R.subarray(Ce,Ce+1)),Ce+=1,ce=W(R,12),me=W(R,16),be=W(R,20),Re=W(R,24),Ce=28}else if(Z===1){ce=W(R,Ce+=4);var Ne=W(R,Ce+=4),Ue=W(R,Ce+=4);for(Ce+=4,Ee=Math.pow(2,32)*Ne+Ue,Number.isSafeInteger(Ee)||(Ee=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),be=W(R,Ce),Re=W(R,Ce+=4),Ce+=4;X(R.subarray(Ce,Ce+1))!=="\0";)ae+=X(R.subarray(Ce,Ce+1)),Ce+=1;for(ae+=X(R.subarray(Ce,Ce+1)),Ce+=1;X(R.subarray(Ce,Ce+1))!=="\0";)fe+=X(R.subarray(Ce,Ce+1)),Ce+=1;fe+=X(R.subarray(Ce,Ce+1)),Ce+=1}return{schemeIdUri:ae,value:fe,timeScale:ce,presentationTime:Ee,presentationTimeDelta:me,eventDuration:be,id:Re,payload:R.subarray(Ce,R.byteLength)}}},"./src/utils/output-filter.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});var z=function(){function G(te,le){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=te,this.trackName=le}var de=G.prototype;return de.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},de.newCue=function(te,le,Q){(this.startTime===null||this.startTime>te)&&(this.startTime=te),this.endTime=le,this.screen=Q,this.timelineController.createCaptionsTrack(this.trackName)},de.reset=function(){this.cueRanges=[],this.startTime=null},G}()},"./src/utils/texttrack-utils.ts":(F,re,C)=>{C.r(re),C.d(re,{addCueToTrack:()=>de,clearCurrentCues:()=>te,getCuesInRange:()=>Q,removeCuesInRange:()=>le,sendAddTrackEvent:()=>G});var z=C("./src/utils/logger.ts");function G(X,ie){var W;try{W=new Event("addtrack")}catch{(W=document.createEvent("Event")).initEvent("addtrack",!1,!1)}W.track=X,ie.dispatchEvent(W)}function de(X,ie){var W=X.mode;if(W==="disabled"&&(X.mode="hidden"),X.cues&&!X.cues.getCueById(ie.id))try{if(X.addCue(ie),!X.cues.getCueById(ie.id))throw new Error("addCue is failed for: "+ie)}catch(Y){z.logger.debug("[texttrack-utils]: "+Y);var se=new self.TextTrackCue(ie.startTime,ie.endTime,ie.text);se.id=ie.id,X.addCue(se)}W==="disabled"&&(X.mode=W)}function te(X){var ie=X.mode;if(ie==="disabled"&&(X.mode="hidden"),X.cues)for(var W=X.cues.length;W--;)X.removeCue(X.cues[W]);ie==="disabled"&&(X.mode=ie)}function le(X,ie,W,se){var Y=X.mode;if(Y==="disabled"&&(X.mode="hidden"),X.cues&&X.cues.length>0)for(var V=Q(X.cues,ie,W),M=0;M<V.length;M++)se&&!se(V[M])||X.removeCue(V[M]);Y==="disabled"&&(X.mode=Y)}function Q(X,ie,W){var se=[],Y=function(I,w){if(w<I[0].startTime)return 0;var P=I.length-1;if(w>I[P].endTime)return-1;for(var _=0,v=P;_<=v;){var A=Math.floor((v+_)/2);if(w<I[A].startTime)v=A-1;else{if(!(w>I[A].startTime&&_<P))return A;_=A+1}}return I[_].startTime-w<w-I[v].startTime?_:v}(X,ie);if(Y>-1)for(var V=Y,M=X.length;V<M;V++){var b=X[V];if(b.startTime>=ie&&b.endTime<=W)se.push(b);else if(b.startTime>W)return se}return se}},"./src/utils/time-ranges.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});const z={toString:function(G){for(var de="",te=G.length,le=0;le<te;le++)de+="["+G.start(le).toFixed(3)+","+G.end(le).toFixed(3)+"]";return de}}},"./src/utils/timescale-conversion.ts":(F,re,C)=>{function z(le,Q,X,ie){X===void 0&&(X=1),ie===void 0&&(ie=!1);var W=le*Q*X;return ie?Math.round(W):W}function G(le,Q,X,ie){return X===void 0&&(X=1),ie===void 0&&(ie=!1),z(le,Q,1/X,ie)}function de(le,Q){return Q===void 0&&(Q=!1),z(le,1e3,11111111111111112e-21,Q)}function te(le,Q){return Q===void 0&&(Q=1),z(le,9e4,1/Q)}C.r(re),C.d(re,{toMpegTsClockFromTimescale:()=>te,toMsFromMpegTsClock:()=>de,toTimescaleFromBase:()=>z,toTimescaleFromScale:()=>G})},"./src/utils/typed-array.ts":(F,re,C)=>{function z(G,de,te){return Uint8Array.prototype.slice?G.slice(de,te):new Uint8Array(Array.prototype.slice.call(G,de,te))}C.r(re),C.d(re,{sliceUint8:()=>z})},"./src/utils/vttcue.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>z});const z=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var G=["","lr","rl"],de=["start","middle","end","left","right"];function te(ie,W){if(typeof W!="string"||!Array.isArray(ie))return!1;var se=W.toLowerCase();return!!~ie.indexOf(se)&&se}function le(ie){return te(de,ie)}function Q(ie){for(var W=arguments.length,se=new Array(W>1?W-1:0),Y=1;Y<W;Y++)se[Y-1]=arguments[Y];for(var V=1;V<arguments.length;V++){var M=arguments[V];for(var b in M)ie[b]=M[b]}return ie}function X(ie,W,se){var Y=this,V={enumerable:!0};Y.hasBeenReset=!1;var M="",b=!1,I=ie,w=W,P=se,_=null,v="",A=!0,D="auto",O="start",K=50,k="middle",L=50,R="middle";Object.defineProperty(Y,"id",Q({},V,{get:function(){return M},set:function(Z){M=""+Z}})),Object.defineProperty(Y,"pauseOnExit",Q({},V,{get:function(){return b},set:function(Z){b=!!Z}})),Object.defineProperty(Y,"startTime",Q({},V,{get:function(){return I},set:function(Z){if(typeof Z!="number")throw new TypeError("Start time must be set to a number.");I=Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"endTime",Q({},V,{get:function(){return w},set:function(Z){if(typeof Z!="number")throw new TypeError("End time must be set to a number.");w=Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"text",Q({},V,{get:function(){return P},set:function(Z){P=""+Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"region",Q({},V,{get:function(){return _},set:function(Z){_=Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"vertical",Q({},V,{get:function(){return v},set:function(Z){var ae=function(fe){return te(G,fe)}(Z);if(ae===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=ae,this.hasBeenReset=!0}})),Object.defineProperty(Y,"snapToLines",Q({},V,{get:function(){return A},set:function(Z){A=!!Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"line",Q({},V,{get:function(){return D},set:function(Z){if(typeof Z!="number"&&Z!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"lineAlign",Q({},V,{get:function(){return O},set:function(Z){var ae=le(Z);if(!ae)throw new SyntaxError("An invalid or illegal string was specified.");O=ae,this.hasBeenReset=!0}})),Object.defineProperty(Y,"position",Q({},V,{get:function(){return K},set:function(Z){if(Z<0||Z>100)throw new Error("Position must be between 0 and 100.");K=Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"positionAlign",Q({},V,{get:function(){return k},set:function(Z){var ae=le(Z);if(!ae)throw new SyntaxError("An invalid or illegal string was specified.");k=ae,this.hasBeenReset=!0}})),Object.defineProperty(Y,"size",Q({},V,{get:function(){return L},set:function(Z){if(Z<0||Z>100)throw new Error("Size must be between 0 and 100.");L=Z,this.hasBeenReset=!0}})),Object.defineProperty(Y,"align",Q({},V,{get:function(){return R},set:function(Z){var ae=le(Z);if(!ae)throw new SyntaxError("An invalid or illegal string was specified.");R=ae,this.hasBeenReset=!0}})),Y.displayState=void 0}return X.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},X}()},"./src/utils/vttparser.ts":(F,re,C)=>{C.r(re),C.d(re,{VTTParser:()=>se,fixLineBreaks:()=>W,parseTimeStamp:()=>de});var z=C("./src/utils/vttcue.ts"),G=function(){function Y(){}return Y.prototype.decode=function(V,M){if(!V)return"";if(typeof V!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(V))},Y}();function de(Y){function V(b,I,w,P){return 3600*(0|b)+60*(0|I)+(0|w)+parseFloat(P||0)}var M=Y.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return M?parseFloat(M[2])>59?V(M[2],M[3],0,M[4]):V(M[1],M[2],M[3],M[4]):null}var te=function(){function Y(){this.values=Object.create(null)}var V=Y.prototype;return V.set=function(M,b){this.get(M)||b===""||(this.values[M]=b)},V.get=function(M,b,I){return I?this.has(M)?this.values[M]:b[I]:this.has(M)?this.values[M]:b},V.has=function(M){return M in this.values},V.alt=function(M,b,I){for(var w=0;w<I.length;++w)if(b===I[w]){this.set(M,b);break}},V.integer=function(M,b){/^-?\d+$/.test(b)&&this.set(M,parseInt(b,10))},V.percent=function(M,b){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(b)){var I=parseFloat(b);if(I>=0&&I<=100)return this.set(M,I),!0}return!1},Y}();function le(Y,V,M,b){var I=b?Y.split(b):[Y];for(var w in I)if(typeof I[w]=="string"){var P=I[w].split(M);P.length===2&&V(P[0],P[1])}}var Q=new z.default(0,0,""),X=Q.align==="middle"?"middle":"center";function ie(Y,V,M){var b=Y;function I(){var P=de(Y);if(P===null)throw new Error("Malformed timestamp: "+b);return Y=Y.replace(/^[^\sa-zA-Z-]+/,""),P}function w(){Y=Y.replace(/^\s+/,"")}if(w(),V.startTime=I(),w(),Y.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+b);Y=Y.slice(3),w(),V.endTime=I(),w(),function(P,_){var v=new te;le(P,function(O,K){var k;switch(O){case"region":for(var L=M.length-1;L>=0;L--)if(M[L].id===K){v.set(O,M[L].region);break}break;case"vertical":v.alt(O,K,["rl","lr"]);break;case"line":k=K.split(","),v.integer(O,k[0]),v.percent(O,k[0])&&v.set("snapToLines",!1),v.alt(O,k[0],["auto"]),k.length===2&&v.alt("lineAlign",k[1],["start",X,"end"]);break;case"position":k=K.split(","),v.percent(O,k[0]),k.length===2&&v.alt("positionAlign",k[1],["start",X,"end","line-left","line-right","auto"]);break;case"size":v.percent(O,K);break;case"align":v.alt(O,K,["start",X,"end","left","right"])}},/:/,/\s/),_.region=v.get("region",null),_.vertical=v.get("vertical","");var A=v.get("line","auto");A==="auto"&&Q.line===-1&&(A=-1),_.line=A,_.lineAlign=v.get("lineAlign","start"),_.snapToLines=v.get("snapToLines",!0),_.size=v.get("size",100),_.align=v.get("align",X);var D=v.get("position","auto");D==="auto"&&Q.position===50&&(D=_.align==="start"||_.align==="left"?0:_.align==="end"||_.align==="right"?100:50),_.position=D}(Y,V)}function W(Y){return Y.replace(/<br(?: \/)?>/gi,`
`)}var se=function(){function Y(){this.state="INITIAL",this.buffer="",this.decoder=new G,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var V=Y.prototype;return V.parse=function(M){var b=this;function I(){var A=b.buffer,D=0;for(A=W(A);D<A.length&&A[D]!=="\r"&&A[D]!==`
`;)++D;var O=A.slice(0,D);return A[D]==="\r"&&++D,A[D]===`
`&&++D,b.buffer=A.slice(D),O}M&&(b.buffer+=b.decoder.decode(M,{stream:!0}));try{var w="";if(b.state==="INITIAL"){if(!/\r\n|\n/.test(b.buffer))return this;var P=(w=I()).match(/^()?WEBVTT([ \t].*)?$/);if(!P||!P[0])throw new Error("Malformed WebVTT signature.");b.state="HEADER"}for(var _=!1;b.buffer;){if(!/\r\n|\n/.test(b.buffer))return this;switch(_?_=!1:w=I(),b.state){case"HEADER":/:/.test(w)?le(w,function(A,D){},/:/):w||(b.state="ID");continue;case"NOTE":w||(b.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(w)){b.state="NOTE";break}if(!w)continue;if(b.cue=new z.default(0,0,""),b.state="CUE",w.indexOf("-->")===-1){b.cue.id=w;continue}case"CUE":if(!b.cue){b.state="BADCUE";continue}try{ie(w,b.cue,b.regionList)}catch{b.cue=null,b.state="BADCUE";continue}b.state="CUETEXT";continue;case"CUETEXT":var v=w.indexOf("-->")!==-1;if(!w||v&&(_=!0)){b.oncue&&b.cue&&b.oncue(b.cue),b.cue=null,b.state="ID";continue}if(b.cue===null)continue;b.cue.text&&(b.cue.text+=`
`),b.cue.text+=w;continue;case"BADCUE":w||(b.state="ID")}}}catch{b.state==="CUETEXT"&&b.cue&&b.oncue&&b.oncue(b.cue),b.cue=null,b.state=b.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},V.flush=function(){var M=this;try{if((M.cue||M.state==="HEADER")&&(M.buffer+=`

`,M.parse()),M.state==="INITIAL"||M.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(b){M.onparsingerror&&M.onparsingerror(b)}return M.onflush&&M.onflush(),this},Y}()},"./src/utils/webvtt-parser.ts":(F,re,C)=>{C.r(re),C.d(re,{generateCueId:()=>W,parseWebVTT:()=>se});var z=C("./src/polyfills/number.ts"),G=C("./src/utils/vttparser.ts"),de=C("./src/demux/id3.ts"),te=C("./src/utils/timescale-conversion.ts"),le=C("./src/remux/mp4-remuxer.ts"),Q=/\r\n|\n\r|\n|\r/g,X=function(Y,V,M){return M===void 0&&(M=0),Y.slice(M,M+V.length)===V},ie=function(Y){for(var V=5381,M=Y.length;M;)V=33*V^Y.charCodeAt(--M);return(V>>>0).toString()};function W(Y,V,M){return ie(Y.toString())+ie(V.toString())+ie(M)}function se(Y,V,M,b,I,w,P,_){var v,A=new G.VTTParser,D=(0,de.utf8ArrayToStr)(new Uint8Array(Y)).trim().replace(Q,`
`).split(`
`),O=[],K=(0,te.toMpegTsClockFromTimescale)(V,M),k="00:00.000",L=0,R=0,Z=!0;A.oncue=function(ae){var fe=b[I],ce=b.ccOffset,me=(L-K)/9e4;fe!=null&&fe.new&&(R!==void 0?ce=b.ccOffset=fe.start:function(Ce,Ne,Ue){var Xe=Ce[Ne],ut=Ce[Xe.prevCC];if(!ut||!ut.new&&Xe.new)return Ce.ccOffset=Ce.presentationOffset=Xe.start,void(Xe.new=!1);for(;(gt=ut)!==null&&gt!==void 0&&gt.new;){var gt;Ce.ccOffset+=Xe.start-ut.start,Xe.new=!1,ut=Ce[(Xe=ut).prevCC]}Ce.presentationOffset=Ue}(b,I,me)),me&&(ce=me-b.presentationOffset);var Ee=ae.endTime-ae.startTime,be=(0,le.normalizePts)(9e4*(ae.startTime+ce-R),9e4*w)/9e4;ae.startTime=Math.max(be,0),ae.endTime=Math.max(be+Ee,0);var Re=ae.text.trim();ae.text=decodeURIComponent(encodeURIComponent(Re)),ae.id||(ae.id=W(ae.startTime,ae.endTime,Re)),ae.endTime>0&&O.push(ae)},A.onparsingerror=function(ae){v=ae},A.onflush=function(){v?_(v):P(O)},D.forEach(function(ae){if(Z){if(X(ae,"X-TIMESTAMP-MAP=")){Z=!1,ae.slice(16).split(",").forEach(function(fe){X(fe,"LOCAL:")?k=fe.slice(6):X(fe,"MPEGTS:")&&(L=parseInt(fe.slice(7)))});try{R=function(fe){var ce=parseInt(fe.slice(-3)),me=parseInt(fe.slice(-6,-4)),Ee=parseInt(fe.slice(-9,-7)),be=fe.length>9?parseInt(fe.substring(0,fe.indexOf(":"))):0;if(!((0,z.isFiniteNumber)(ce)&&(0,z.isFiniteNumber)(me)&&(0,z.isFiniteNumber)(Ee)&&(0,z.isFiniteNumber)(be)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+fe);return ce+=1e3*me,(ce+=6e4*Ee)+36e5*be}(k)/1e3}catch(fe){v=fe}return}ae===""&&(Z=!1)}A.parse(ae+`
`)}),A.flush()}},"./src/utils/xhr-loader.ts":(F,re,C)=>{C.r(re),C.d(re,{default:()=>te});var z=C("./src/utils/logger.ts"),G=C("./src/loader/load-stats.ts"),de=/^age:\s*[\d.]+\s*$/m;const te=function(){function le(X){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=X?X.xhrSetup:null,this.stats=new G.LoadStats,this.retryDelay=0}var Q=le.prototype;return Q.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},Q.abortInternal=function(){var X=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),X&&(X.onreadystatechange=null,X.onprogress=null,X.readyState!==4&&(this.stats.aborted=!0,X.abort()))},Q.abort=function(){var X;this.abortInternal(),(X=this.callbacks)!==null&&X!==void 0&&X.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},Q.load=function(X,ie,W){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=X,this.config=ie,this.callbacks=W,this.retryDelay=ie.retryDelay,this.loadInternal()},Q.loadInternal=function(){var X=this.config,ie=this.context;if(X){var W=this.loader=new self.XMLHttpRequest,se=this.stats;se.loading.first=0,se.loaded=0;var Y=this.xhrSetup;try{if(Y)try{Y(W,ie.url)}catch{W.open("GET",ie.url,!0),Y(W,ie.url)}W.readyState||W.open("GET",ie.url,!0);var V=this.context.headers;if(V)for(var M in V)W.setRequestHeader(M,V[M])}catch(b){return void this.callbacks.onError({code:W.status,text:b.message},ie,W)}ie.rangeEnd&&W.setRequestHeader("Range","bytes="+ie.rangeStart+"-"+(ie.rangeEnd-1)),W.onreadystatechange=this.readystatechange.bind(this),W.onprogress=this.loadprogress.bind(this),W.responseType=ie.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),X.timeout),W.send()}},Q.readystatechange=function(){var X=this.context,ie=this.loader,W=this.stats;if(X&&ie){var se=ie.readyState,Y=this.config;if(!W.aborted&&se>=2)if(self.clearTimeout(this.requestTimeout),W.loading.first===0&&(W.loading.first=Math.max(self.performance.now(),W.loading.start)),se===4){ie.onreadystatechange=null,ie.onprogress=null;var V=ie.status,M=ie.responseType==="arraybuffer";if(V>=200&&V<300&&(M&&ie.response||ie.responseText!==null)){var b,I;if(W.loading.end=Math.max(self.performance.now(),W.loading.first),I=M?(b=ie.response).byteLength:(b=ie.responseText).length,W.loaded=W.total=I,!this.callbacks)return;var w=this.callbacks.onProgress;if(w&&w(W,X,b,ie),!this.callbacks)return;var P={url:ie.responseURL,data:b};this.callbacks.onSuccess(P,W,X,ie)}else W.retry>=Y.maxRetry||V>=400&&V<499?(z.logger.error(V+" while loading "+X.url),this.callbacks.onError({code:V,text:ie.statusText},X,ie)):(z.logger.warn(V+" while loading "+X.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,Y.maxRetryDelay),W.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),Y.timeout)}},Q.loadtimeout=function(){z.logger.warn("timeout while loading "+this.context.url);var X=this.callbacks;X&&(this.abortInternal(),X.onTimeout(this.stats,this.context,this.loader))},Q.loadprogress=function(X){var ie=this.stats;ie.loaded=X.loaded,X.lengthComputable&&(ie.total=X.total)},Q.getCacheAge=function(){var X=null;if(this.loader&&de.test(this.loader.getAllResponseHeaders())){var ie=this.loader.getResponseHeader("age");X=ie?parseFloat(ie):null}return X},le}()},"./node_modules/eventemitter3/index.js":F=>{var re=Object.prototype.hasOwnProperty,C="~";function z(){}function G(Q,X,ie){this.fn=Q,this.context=X,this.once=ie||!1}function de(Q,X,ie,W,se){if(typeof ie!="function")throw new TypeError("The listener must be a function");var Y=new G(ie,W||Q,se),V=C?C+X:X;return Q._events[V]?Q._events[V].fn?Q._events[V]=[Q._events[V],Y]:Q._events[V].push(Y):(Q._events[V]=Y,Q._eventsCount++),Q}function te(Q,X){--Q._eventsCount==0?Q._events=new z:delete Q._events[X]}function le(){this._events=new z,this._eventsCount=0}Object.create&&(z.prototype=Object.create(null),new z().__proto__||(C=!1)),le.prototype.eventNames=function(){var Q,X,ie=[];if(this._eventsCount===0)return ie;for(X in Q=this._events)re.call(Q,X)&&ie.push(C?X.slice(1):X);return Object.getOwnPropertySymbols?ie.concat(Object.getOwnPropertySymbols(Q)):ie},le.prototype.listeners=function(Q){var X=C?C+Q:Q,ie=this._events[X];if(!ie)return[];if(ie.fn)return[ie.fn];for(var W=0,se=ie.length,Y=new Array(se);W<se;W++)Y[W]=ie[W].fn;return Y},le.prototype.listenerCount=function(Q){var X=C?C+Q:Q,ie=this._events[X];return ie?ie.fn?1:ie.length:0},le.prototype.emit=function(Q,X,ie,W,se,Y){var V=C?C+Q:Q;if(!this._events[V])return!1;var M,b,I=this._events[V],w=arguments.length;if(I.fn){switch(I.once&&this.removeListener(Q,I.fn,void 0,!0),w){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,X),!0;case 3:return I.fn.call(I.context,X,ie),!0;case 4:return I.fn.call(I.context,X,ie,W),!0;case 5:return I.fn.call(I.context,X,ie,W,se),!0;case 6:return I.fn.call(I.context,X,ie,W,se,Y),!0}for(b=1,M=new Array(w-1);b<w;b++)M[b-1]=arguments[b];I.fn.apply(I.context,M)}else{var P,_=I.length;for(b=0;b<_;b++)switch(I[b].once&&this.removeListener(Q,I[b].fn,void 0,!0),w){case 1:I[b].fn.call(I[b].context);break;case 2:I[b].fn.call(I[b].context,X);break;case 3:I[b].fn.call(I[b].context,X,ie);break;case 4:I[b].fn.call(I[b].context,X,ie,W);break;default:if(!M)for(P=1,M=new Array(w-1);P<w;P++)M[P-1]=arguments[P];I[b].fn.apply(I[b].context,M)}}return!0},le.prototype.on=function(Q,X,ie){return de(this,Q,X,ie,!1)},le.prototype.once=function(Q,X,ie){return de(this,Q,X,ie,!0)},le.prototype.removeListener=function(Q,X,ie,W){var se=C?C+Q:Q;if(!this._events[se])return this;if(!X)return te(this,se),this;var Y=this._events[se];if(Y.fn)Y.fn!==X||W&&!Y.once||ie&&Y.context!==ie||te(this,se);else{for(var V=0,M=[],b=Y.length;V<b;V++)(Y[V].fn!==X||W&&!Y[V].once||ie&&Y[V].context!==ie)&&M.push(Y[V]);M.length?this._events[se]=M.length===1?M[0]:M:te(this,se)}return this},le.prototype.removeAllListeners=function(Q){var X;return Q?(X=C?C+Q:Q,this._events[X]&&te(this,X)):(this._events=new z,this._eventsCount=0),this},le.prototype.off=le.prototype.removeListener,le.prototype.addListener=le.prototype.on,le.prefixed=C,le.EventEmitter=le,F.exports=le},"./node_modules/url-toolkit/src/url-toolkit.js":function(F){var re,C,z,G,de;re=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,C=/^(?=([^\/?#]*))\1([^]*)$/,z=/(?:\/|^)\.(?=\/)/g,G=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,de={buildAbsoluteURL:function(te,le,Q){if(Q=Q||{},te=te.trim(),!(le=le.trim())){if(!Q.alwaysNormalize)return te;var X=de.parseURL(te);if(!X)throw new Error("Error trying to parse base URL.");return X.path=de.normalizePath(X.path),de.buildURLFromParts(X)}var ie=de.parseURL(le);if(!ie)throw new Error("Error trying to parse relative URL.");if(ie.scheme)return Q.alwaysNormalize?(ie.path=de.normalizePath(ie.path),de.buildURLFromParts(ie)):le;var W=de.parseURL(te);if(!W)throw new Error("Error trying to parse base URL.");if(!W.netLoc&&W.path&&W.path[0]!=="/"){var se=C.exec(W.path);W.netLoc=se[1],W.path=se[2]}W.netLoc&&!W.path&&(W.path="/");var Y={scheme:W.scheme,netLoc:ie.netLoc,path:null,params:ie.params,query:ie.query,fragment:ie.fragment};if(!ie.netLoc&&(Y.netLoc=W.netLoc,ie.path[0]!=="/"))if(ie.path){var V=W.path,M=V.substring(0,V.lastIndexOf("/")+1)+ie.path;Y.path=de.normalizePath(M)}else Y.path=W.path,ie.params||(Y.params=W.params,ie.query||(Y.query=W.query));return Y.path===null&&(Y.path=Q.alwaysNormalize?de.normalizePath(ie.path):ie.path),de.buildURLFromParts(Y)},parseURL:function(te){var le=re.exec(te);return le?{scheme:le[1]||"",netLoc:le[2]||"",path:le[3]||"",params:le[4]||"",query:le[5]||"",fragment:le[6]||""}:null},normalizePath:function(te){for(te=te.split("").reverse().join("").replace(z,"");te.length!==(te=te.replace(G,"")).length;);return te.split("").reverse().join("")},buildURLFromParts:function(te){return te.scheme+te.netLoc+te.path+te.params+te.query+te.fragment}},F.exports=de}},ee={};function j(F){var re=ee[F];if(re!==void 0)return re.exports;var C=ee[F]={exports:{}};return J[F].call(C.exports,C,C.exports,j),C.exports}j.m=J,j.n=F=>{var re=F&&F.__esModule?()=>F.default:()=>F;return j.d(re,{a:re}),re},j.d=(F,re)=>{for(var C in re)j.o(re,C)&&!j.o(F,C)&&Object.defineProperty(F,C,{enumerable:!0,get:re[C]})},j.o=(F,re)=>Object.prototype.hasOwnProperty.call(F,re),j.r=F=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})};var y=j("./src/hls.ts");return y=y.default})(),Dl.exports=wl());var gi=Hi(Ll.exports),Du=mn.now,Pa=mn.assign,wu=mn.listContainsIgnoreCase;Ae.register("PLAYBACK_FRAGMENT_CHANGED"),Ae.register("PLAYBACK_FRAGMENT_PARSING_METADATA");var Ls=function(J){(function(C,z){if(typeof z!="function"&&z!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(z&&z.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),z&&ra(C,z)})(re,J);var ee,j,y,F=ns(re);function re(){var C;uo(this,re);for(var z=arguments.length,G=new Array(z),de=0;de<z;de++)G[de]=arguments[de];return(C=F.call.apply(F,[this].concat(G))).options.playback=Ia(Ia({},C.options),C.options.playback),C.options.hlsPlayback=Ia(Ia({},C.defaultOptions),C.options.hlsPlayback),C._minDvrSize=C.options.hlsMinimumDvrSize===void 0?60:C.options.hlsMinimumDvrSize,C._extrapolatedWindowNumSegments=C.options.playback&&C.options.playback.extrapolatedWindowNumSegments!==void 0?C.options.playback.extrapolatedWindowNumSegments:2,C._playbackType=qt.VOD,C._lastTimeUpdate={current:0,total:0},C._lastDuration=null,C._playableRegionStartTime=0,C._localStartTimeCorrelation=null,C._localEndTimeCorrelation=null,C._playableRegionDuration=0,C._programDateTime=0,C._durationExcludesAfterLiveSyncPoint=!1,C._segmentTargetDuration=null,C._playlistType=null,C._recoverAttemptsRemaining=C.options.hlsRecoverAttempts||16,C}return ee=re,j=[{key:"name",get:function(){return"hls"}},{key:"supportedVersion",get:function(){return{min:"0.4.27"}}},{key:"levels",get:function(){return this._levels||[]}},{key:"currentLevel",get:function(){return this._currentLevel===null||this._currentLevel===void 0?-1:this._currentLevel},set:function(C){this._currentLevel=C,this.trigger(Ae.PLAYBACK_LEVEL_SWITCH_START),this.options.playback.hlsUseNextLevel?this._hls.nextLevel=this._currentLevel:this._hls.currentLevel=this._currentLevel}},{key:"isReady",get:function(){return this._isReadyState}},{key:"_startTime",get:function(){return this._playbackType===qt.LIVE&&this._playlistType!=="EVENT"?this._extrapolatedStartTime:this._playableRegionStartTime}},{key:"_now",get:function(){return Du()}},{key:"_extrapolatedStartTime",get:function(){if(!this._localStartTimeCorrelation)return this._playableRegionStartTime;var C=this._localStartTimeCorrelation,z=this._now-C.local,G=(C.remote+z)/1e3;return Math.min(G,this._playableRegionStartTime+this._extrapolatedWindowDuration)}},{key:"_extrapolatedEndTime",get:function(){var C=this._playableRegionStartTime+this._playableRegionDuration;if(!this._localEndTimeCorrelation)return C;var z=this._localEndTimeCorrelation,G=this._now-z.local,de=(z.remote+G)/1e3;return Math.max(C-this._extrapolatedWindowDuration,Math.min(de,C))}},{key:"_duration",get:function(){return this._extrapolatedEndTime-this._startTime}},{key:"_extrapolatedWindowDuration",get:function(){return this._segmentTargetDuration===null?0:this._extrapolatedWindowNumSegments*this._segmentTargetDuration}},{key:"bandwidthEstimate",get:function(){return this._hls&&this._hls.bandwidthEstimate}},{key:"defaultOptions",get:function(){return{preload:!0}}},{key:"customListeners",get:function(){return this.options.hlsPlayback&&this.options.hlsPlayback.customListeners||[]}},{key:"_setup",value:function(){var C=this;this._manifestParsed=!1,this._ccIsSetup=!1,this._ccTracksUpdated=!1,this._hls&&this._hls.destroy(),this._hls=new gi(Pa({},this.options.playback.hlsjsConfig)),this._hls.once(gi.Events.MEDIA_ATTACHED,function(){C.options.hlsPlayback.preload&&C._hls.loadSource(C.options.src)}),this._hls.on(gi.Events.MANIFEST_PARSED,function(){return C._manifestParsed=!0}),this._hls.on(gi.Events.LEVEL_LOADED,function(z,G){return C._updatePlaybackType(z,G)}),this._hls.on(gi.Events.LEVEL_UPDATED,function(z,G){return C._onLevelUpdated(z,G)}),this._hls.on(gi.Events.LEVEL_SWITCHING,function(z,G){return C._onLevelSwitch(z,G)}),this._hls.on(gi.Events.FRAG_CHANGED,function(z,G){return C._onFragmentChanged(z,G)}),this._hls.on(gi.Events.FRAG_LOADED,function(z,G){return C._onFragmentLoaded(z,G)}),this._hls.on(gi.Events.FRAG_PARSING_METADATA,function(z,G){return C._onFragmentParsingMetadata(z,G)}),this._hls.on(gi.Events.ERROR,function(z,G){return C._onHLSJSError(z,G)}),this._hls.on(gi.Events.SUBTITLE_TRACK_LOADED,function(z,G){return C._onSubtitleLoaded(z,G)}),this._hls.on(gi.Events.SUBTITLE_TRACKS_UPDATED,function(){return C._ccTracksUpdated=!0}),this.bindCustomListeners(),this._hls.attachMedia(this.el)}},{key:"bindCustomListeners",value:function(){var C=this;this.customListeners.forEach(function(z){var G=z.eventName,de=z.once?"once":"on";G&&C._hls["".concat(de)](G,z.callback)})}},{key:"unbindCustomListeners",value:function(){var C=this;this.customListeners.forEach(function(z){var G=z.eventName;G&&C._hls.off(G,z.callback)})}},{key:"_onFragmentParsingMetadata",value:function(C,z){this.trigger(Ae.Custom.PLAYBACK_FRAGMENT_PARSING_METADATA,{evt:C,data:z})}},{key:"render",value:function(){return this._ready(),On(Or(re.prototype),"render",this).call(this)}},{key:"_ready",value:function(){this._isReadyState||(!this._hls&&this._setup(),this._isReadyState=!0,this.trigger(Ae.PLAYBACK_READY,this.name))}},{key:"_recover",value:function(C,z,G){if(this._recoveredDecodingError)if(this._recoveredAudioCodecError){Gt.error("hlsjs: failed to recover",{evt:C,data:z}),G.level=Kr.Levels.FATAL;var de=this.createError(G);this.trigger(Ae.PLAYBACK_ERROR,de),this.stop()}else this._recoveredAudioCodecError=!0,this._hls.swapAudioCodec(),this._hls.recoverMediaError();else this._recoveredDecodingError=!0,this._hls.recoverMediaError()}},{key:"_setupSrc",value:function(C){}},{key:"_startTimeUpdateTimer",value:function(){var C=this;this._timeUpdateTimer||(this._timeUpdateTimer=setInterval(function(){C._onDurationChange(),C._onTimeUpdate()},100))}},{key:"_stopTimeUpdateTimer",value:function(){this._timeUpdateTimer&&(clearInterval(this._timeUpdateTimer),this._timeUpdateTimer=null)}},{key:"getProgramDateTime",value:function(){return this._programDateTime}},{key:"getDuration",value:function(){return this._duration}},{key:"getCurrentTime",value:function(){return Math.max(0,this.el.currentTime-this._startTime)}},{key:"getStartTimeOffset",value:function(){return this._startTime}},{key:"seekPercentage",value:function(C){var z=this._duration;C>0&&(z=this._duration*(C/100)),this.seek(z)}},{key:"seek",value:function(C){C<0&&(Gt.warn("Attempt to seek to a negative time. Resetting to live point. Use seekToLivePoint() to seek to the live point."),C=this.getDuration()),this.dvrEnabled&&this._updateDvr(C<this.getDuration()-3),C+=this._startTime,this.el.currentTime=C}},{key:"seekToLivePoint",value:function(){this.seek(this.getDuration())}},{key:"_updateDvr",value:function(C){this.trigger(Ae.PLAYBACK_DVR,C),this.trigger(Ae.PLAYBACK_STATS_ADD,{dvr:C})}},{key:"_updateSettings",value:function(){this._playbackType===qt.VOD?this.settings.left=["playpause","position","duration"]:this.dvrEnabled?this.settings.left=["playpause"]:this.settings.left=["playstop"],this.settings.seekEnabled=this.isSeekEnabled(),this.trigger(Ae.PLAYBACK_SETTINGSUPDATE)}},{key:"_onHLSJSError",value:function(C,z){var G,de={code:"".concat(z.type,"_").concat(z.details),description:"".concat(this.name," error: type: ").concat(z.type,", details: ").concat(z.details),raw:z};if(z.response&&(de.description+=", response: ".concat(JSON.stringify(z.response))),z.fatal)if(this._recoverAttemptsRemaining>0)switch(this._recoverAttemptsRemaining-=1,z.type){case gi.ErrorTypes.NETWORK_ERROR:switch(z.details){case gi.ErrorDetails.MANIFEST_LOAD_ERROR:case gi.ErrorDetails.MANIFEST_LOAD_TIMEOUT:case gi.ErrorDetails.MANIFEST_PARSING_ERROR:case gi.ErrorDetails.LEVEL_LOAD_ERROR:case gi.ErrorDetails.LEVEL_LOAD_TIMEOUT:Gt.error("hlsjs: unrecoverable network fatal error.",{evt:C,data:z}),G=this.createError(de),this.trigger(Ae.PLAYBACK_ERROR,G),this.stop();break;default:Gt.warn("hlsjs: trying to recover from network error.",{evt:C,data:z}),de.level=Kr.Levels.WARN,this._hls.startLoad()}break;case gi.ErrorTypes.MEDIA_ERROR:Gt.warn("hlsjs: trying to recover from media error.",{evt:C,data:z}),de.level=Kr.Levels.WARN,this._recover(C,z,de);break;default:Gt.error("hlsjs: could not recover from error.",{evt:C,data:z}),G=this.createError(de),this.trigger(Ae.PLAYBACK_ERROR,G),this.stop()}else Gt.error("hlsjs: could not recover from error after maximum number of attempts.",{evt:C,data:z}),G=this.createError(de),this.trigger(Ae.PLAYBACK_ERROR,G),this.stop();else{if(this.options.playback.triggerFatalErrorOnResourceDenied&&this._keyIsDenied(z))return Gt.error("hlsjs: could not load decrypt key.",{evt:C,data:z}),G=this.createError(de),this.trigger(Ae.PLAYBACK_ERROR,G),void this.stop();de.level=Kr.Levels.WARN,Gt.warn("hlsjs: non-fatal error occurred",{evt:C,data:z})}}},{key:"_keyIsDenied",value:function(C){return C.type===gi.ErrorTypes.NETWORK_ERROR&&C.details===gi.ErrorDetails.KEY_LOAD_ERROR&&C.response&&C.response.code>=400}},{key:"_onTimeUpdate",value:function(){var C={current:this.getCurrentTime(),total:this.getDuration(),firstFragDateTime:this.getProgramDateTime()};this._lastTimeUpdate&&C.current===this._lastTimeUpdate.current&&C.total===this._lastTimeUpdate.total||(this._lastTimeUpdate=C,this.trigger(Ae.PLAYBACK_TIMEUPDATE,C,this.name))}},{key:"_onDurationChange",value:function(){var C=this.getDuration();this._lastDuration!==C&&(this._lastDuration=C,On(Or(re.prototype),"_onDurationChange",this).call(this))}},{key:"_onProgress",value:function(){if(this.el.buffered.length){for(var C=[],z=0,G=0;G<this.el.buffered.length;G++)C=[].concat(ws(C),[{start:Math.max(0,this.el.buffered.start(G)-this._playableRegionStartTime),end:Math.max(0,this.el.buffered.end(G)-this._playableRegionStartTime)}]),this.el.currentTime>=C[G].start&&this.el.currentTime<=C[G].end&&(z=G);var de={start:C[z].start,current:C[z].end,total:this.getDuration()};this.trigger(Ae.PLAYBACK_PROGRESS,de,C)}}},{key:"play",value:function(){!this._hls&&this._setup(),!this._manifestParsed&&!this.options.hlsPlayback.preload&&this._hls.loadSource(this.options.src),On(Or(re.prototype),"play",this).call(this),this._startTimeUpdateTimer()}},{key:"pause",value:function(){this._hls&&(this.el.pause(),this.dvrEnabled&&this._updateDvr(!0))}},{key:"stop",value:function(){this._stopTimeUpdateTimer(),this._hls&&(On(Or(re.prototype),"stop",this).call(this),this._hls.destroy(),delete this._hls)}},{key:"destroy",value:function(){this._stopTimeUpdateTimer(),this._hls&&(this._hls.destroy(),delete this._hls),On(Or(re.prototype),"destroy",this).call(this)}},{key:"_updatePlaybackType",value:function(C,z){this._playbackType=z.details.live?qt.LIVE:qt.VOD,this._onLevelUpdated(C,z),this._ccTracksUpdated&&this._playbackType===qt.LIVE&&this.hasClosedCaptionsTracks&&this._onSubtitleLoaded()}},{key:"_fillLevels",value:function(){this._levels=this._hls.levels.map(function(C,z){return{id:z,level:C,label:"".concat(C.bitrate/1e3,"Kbps")}}),this.trigger(Ae.PLAYBACK_LEVELS_AVAILABLE,this._levels)}},{key:"_onLevelUpdated",value:function(C,z){this._segmentTargetDuration=z.details.targetduration,this._playlistType=z.details.type||null;var G=!1,de=!1,te=z.details.fragments,le=this._playableRegionStartTime,Q=this._playableRegionDuration;if(te.length!==0){if(te[0].rawProgramDateTime&&(this._programDateTime=te[0].rawProgramDateTime),this._playableRegionStartTime!==te[0].start&&(G=!0,this._playableRegionStartTime=te[0].start),G)if(this._localStartTimeCorrelation){var X=this._localStartTimeCorrelation,ie=this._now-X.local,W=(X.remote+ie)/1e3;W<te[0].start?this._localStartTimeCorrelation={local:this._now,remote:1e3*te[0].start}:W>le+this._extrapolatedWindowDuration&&(this._localStartTimeCorrelation={local:this._now,remote:1e3*Math.max(te[0].start,le+this._extrapolatedWindowDuration)})}else this._localStartTimeCorrelation={local:this._now,remote:1e3*(te[0].start+this._extrapolatedWindowDuration/2)};var se=z.details.totalduration;if(this._playbackType===qt.LIVE){var Y=z.details.targetduration*((this.options.playback.hlsjsConfig||{}).liveSyncDurationCount||gi.DefaultConfig.liveSyncDurationCount);Y<=se?(se-=Y,this._durationExcludesAfterLiveSyncPoint=!0):this._durationExcludesAfterLiveSyncPoint=!1}se!==this._playableRegionDuration&&(de=!0,this._playableRegionDuration=se);var V=te[0].start+se,M=le+Q;if(V!==M)if(this._localEndTimeCorrelation){var b=this._localEndTimeCorrelation,I=this._now-b.local,w=(b.remote+I)/1e3;w>V?this._localEndTimeCorrelation={local:this._now,remote:1e3*V}:w<V-this._extrapolatedWindowDuration?this._localEndTimeCorrelation={local:this._now,remote:1e3*(V-this._extrapolatedWindowDuration)}:w>M&&(this._localEndTimeCorrelation={local:this._now,remote:1e3*M})}else this._localEndTimeCorrelation={local:this._now,remote:1e3*V};de&&this._onDurationChange(),G&&this._onProgress()}}},{key:"_onFragmentChanged",value:function(C,z){this.trigger(Ae.Custom.PLAYBACK_FRAGMENT_CHANGED,z)}},{key:"_onFragmentLoaded",value:function(C,z){this.trigger(Ae.PLAYBACK_FRAGMENT_LOADED,z)}},{key:"_onSubtitleLoaded",value:function(){if(!this._ccIsSetup){this.trigger(Ae.PLAYBACK_SUBTITLE_AVAILABLE);var C=this._playbackType===qt.LIVE?-1:this.closedCaptionsTrackId;this.closedCaptionsTrackId=C,this._ccIsSetup=!0}}},{key:"_onLevelSwitch",value:function(C,z){this.levels.length||this._fillLevels(),this.trigger(Ae.PLAYBACK_LEVEL_SWITCH_END),this.trigger(Ae.PLAYBACK_LEVEL_SWITCH,z);var G=this._hls.levels[z.level];G&&(this.highDefinition=G.height>=720||G.bitrate/1e3>=2e3,this.trigger(Ae.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(Ae.PLAYBACK_BITRATE,{height:G.height,width:G.width,bandwidth:G.bitrate,bitrate:G.bitrate,level:z.level}))}},{key:"dvrEnabled",get:function(){return this._durationExcludesAfterLiveSyncPoint&&this._duration>=this._minDvrSize&&this.getPlaybackType()===qt.LIVE}},{key:"getPlaybackType",value:function(){return this._playbackType}},{key:"isSeekEnabled",value:function(){return this._playbackType===qt.VOD||this.dvrEnabled}}],y=[{key:"HLSJS",get:function(){return gi}}],j&&Ra(ee.prototype,j),y&&Ra(ee,y),Object.defineProperty(ee,"prototype",{writable:!1}),re}(Tr);return Ls.canPlay=function(J,ee){var j=J.split("?")[0].match(/.*\.(.*)$/)||[],y=j.length>1&&j[1].toLowerCase()==="m3u8"||wu(ee,["application/vnd.apple.mpegurl","application/x-mpegURL"]);return!(!gi.isSupported()||!y)},No.Loader.registerPlayback(Ls),or(or({},No),{},{HLS:Ls})}();
